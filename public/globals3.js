function _await(t,e,n){return n?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function _empty(){}function _invokeIgnored(t){var e=t();if(e&&e.then)return e.then(_empty)}function _async(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return Promise.resolve(t.apply(this,e))}catch(t){return Promise.reject(t)}}}function _call(t,e,n){if(n)return e?e(t()):t();try{var i=Promise.resolve(t());return e?i.then(e):i}catch(t){return Promise.reject(t)}}function _settle(t,e,n){if(!t.s){if(n instanceof _Pact){if(!n.s)return void(n.o=_settle.bind(null,t,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(_settle.bind(null,t,e),_settle.bind(null,t,2));t.s=e,t.v=n;const i=t.o;i&&i(t)}}const _Pact=function(){function t(){}return t.prototype.then=function(e,n){const i=new t,r=this.s;if(r){const t=1&r?e:n;if(t){try{_settle(i,1,t(this.v))}catch(t){_settle(i,2,t)}return i}return this}return this.o=function(t){try{const r=t.v;1&t.s?_settle(i,1,e?e(r):r):n?_settle(i,1,n(r)):_settle(i,2,r)}catch(t){_settle(i,2,t)}},i},t}();function _isSettledPact(t){return t instanceof _Pact&&1&t.s}function _for(t,e,n){for(var i;;){var r=t();if(_isSettledPact(r)&&(r=r.v),!r)return s;if(r.then){i=0;break}var s=n();if(s&&s.then){if(!_isSettledPact(s)){i=1;break}s=s.s}if(e){var a=e();if(a&&a.then&&!_isSettledPact(a)){i=2;break}}}var o=new _Pact,l=_settle.bind(null,o,2);return(0===i?r.then(c):1===i?s.then(h):a.then(u)).then(void 0,l),o;function h(i){s=i;do{if(e&&(a=e())&&a.then&&!_isSettledPact(a))return void a.then(u).then(void 0,l);if(!(r=t())||_isSettledPact(r)&&!r.v)return void _settle(o,1,s);if(r.then)return void r.then(c).then(void 0,l);_isSettledPact(s=n())&&(s=s.v)}while(!s||!s.then);s.then(h).then(void 0,l)}function c(t){t?(s=n())&&s.then?s.then(h).then(void 0,l):h(s):_settle(o,1,s)}function u(){(r=t())?r.then?r.then(c).then(void 0,l):c(r):_settle(o,1,s)}}function _continueIgnored(t){if(t&&t.then)return t.then(_empty)}function _invoke(t,e){var n=t();return n&&n.then?n.then(e):e(n)}function _forTo(t,e,n){var i,r,s=-1;return function a(o){try{for(;++s<t.length&&(!n||!n());)if((o=e(s))&&o.then){if(!_isSettledPact(o))return void o.then(a,r||(r=_settle.bind(null,i=new _Pact,2)));o=o.v}i?_settle(i,1,o):i=o}catch(t){_settle(i||(i=new _Pact),2,t)}}(),i}function _forIn(t,e,n){var i=[];for(var r in t)i.push(r);return _forTo(i,function(t){return e(i[t])},n)}function _continue(t,e){return t&&t.then?t.then(e):e(t)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PointerEventsPolyfill=e()}(this,function(){"use strict";var t=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],e=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function n(n,i){i=i||Object.create(null);var r=document.createEvent("Event");r.initEvent(n,i.bubbles||!1,i.cancelable||!1);for(var s,a=2;a<t.length;a++)r[s=t[a]]=i[s]||e[a];r.buttons=i.buttons||0;var o;return o=i.pressure&&r.buttons?i.pressure:r.buttons?.5:0,r.x=r.clientX,r.y=r.clientY,r.pointerId=i.pointerId||0,r.width=i.width||0,r.height=i.height||0,r.pressure=o,r.tiltX=i.tiltX||0,r.tiltY=i.tiltY||0,r.pointerType=i.pointerType||"",r.hwTimestamp=i.hwTimestamp||0,r.isPrimary=i.isPrimary||!1,r}var i=window.Map&&window.Map.prototype.forEach?Map:r;function r(){this.array=[],this.size=0}r.prototype={set:function(t,e){if(void 0===e)return this.delete(t);this.has(t)||this.size++,this.array[t]=e},has:function(t){return void 0!==this.array[t]},delete:function(t){this.has(t)&&(delete this.array[t],this.size--)},get:function(t){return this.array[t]},clear:function(){this.array.length=0,this.size=0},forEach:function(t,e){return this.array.forEach(function(n,i){t.call(e,n,i,this)},this)}};var s=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],a=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],o={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},l="undefined"!=typeof SVGElementInstance,h={pointermap:new i,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(t,e){var n=e,i=n.events;i&&(i.forEach(function(t){n[t]&&(this.eventMap[t]=n[t].bind(n))},this),this.eventSources[t]=n,this.eventSourceList.push(n))},register:function(t){for(var e,n=this.eventSourceList.length,i=0;i<n&&(e=this.eventSourceList[i]);i++)e.register.call(e,t)},unregister:function(t){for(var e,n=this.eventSourceList.length,i=0;i<n&&(e=this.eventSourceList[i]);i++)e.unregister.call(e,t)},contains:function(t,e){try{return t.contains(e)}catch(t){return!1}},down:function(t){t.bubbles=!0,this.fireEvent("pointerdown",t)},move:function(t){t.bubbles=!0,this.fireEvent("pointermove",t)},up:function(t){t.bubbles=!0,this.fireEvent("pointerup",t)},enter:function(t){t.bubbles=!1,this.fireEvent("pointerenter",t)},leave:function(t){t.bubbles=!1,this.fireEvent("pointerleave",t)},over:function(t){t.bubbles=!0,this.fireEvent("pointerover",t)},out:function(t){t.bubbles=!0,this.fireEvent("pointerout",t)},cancel:function(t){t.bubbles=!0,this.fireEvent("pointercancel",t)},leaveOut:function(t){this.out(t),this.propagate(t,this.leave,!1)},enterOver:function(t){this.over(t),this.propagate(t,this.enter,!0)},eventHandler:function(t){if(!t._handledByPE){var e=t.type,n=this.eventMap&&this.eventMap[e];n&&n(t),t._handledByPE=!0}},listen:function(t,e){e.forEach(function(e){this.addEvent(t,e)},this)},unlisten:function(t,e){e.forEach(function(e){this.removeEvent(t,e)},this)},addEvent:function(t,e){t.addEventListener(e,this.boundHandler)},removeEvent:function(t,e){t.removeEventListener(e,this.boundHandler)},makeEvent:function(t,e){this.captureInfo[e.pointerId]&&(e.relatedTarget=null);var i=new n(t,e);return e.preventDefault&&(i.preventDefault=e.preventDefault),i._target=i._target||e.target,i},fireEvent:function(t,e){var n=this.makeEvent(t,e);return this.dispatchEvent(n)},cloneEvent:function(t){for(var e,n=Object.create(null),i=0;i<s.length;i++)n[e=s[i]]=t[e]||a[i],!l||"target"!==e&&"relatedTarget"!==e||n[e]instanceof SVGElementInstance&&(n[e]=n[e].correspondingUseElement);return t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n},getTarget:function(t){var e=this.captureInfo[t.pointerId];return e?t._target!==e&&t.type in o?void 0:e:t._target},propagate:function(t,e,n){for(var i=t.target,r=[];!i.contains(t.relatedTarget)&&i!==document;)r.push(i),i=i.parentNode;n&&r.reverse(),r.forEach(function(n){t.target=n,e.call(this,t)},this)},setCapture:function(t,e){this.captureInfo[t]&&this.releaseCapture(t),this.captureInfo[t]=e;var i=new n("gotpointercapture");i.pointerId=t,this.implicitRelease=this.releaseCapture.bind(this,t),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease),i._target=e,this.asyncDispatchEvent(i)},releaseCapture:function(t){var e=this.captureInfo[t];if(e){var i=new n("lostpointercapture");i.pointerId=t,this.captureInfo[t]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),i._target=e,this.asyncDispatchEvent(i)}},dispatchEvent:function(t){var e=this.getTarget(t);if(e)return e.dispatchEvent(t)},asyncDispatchEvent:function(t){requestAnimationFrame(this.dispatchEvent.bind(this,t))}};h.boundHandler=h.eventHandler.bind(h);var c={shadow:function(t){if(t)return t.shadowRoot||t.webkitShadowRoot},canTarget:function(t){return t&&Boolean(t.elementFromPoint)},targetingShadow:function(t){var e=this.shadow(t);if(this.canTarget(e))return e},olderShadow:function(t){var e=t.olderShadowRoot;if(!e){var n=t.querySelector("shadow");n&&(e=n.olderShadowRoot)}return e},allShadows:function(t){for(var e=[],n=this.shadow(t);n;)e.push(n),n=this.olderShadow(n);return e},searchRoot:function(t,e,n){if(t){var i,r,s=t.elementFromPoint(e,n);for(r=this.targetingShadow(s);r;){if(i=r.elementFromPoint(e,n)){var a=this.targetingShadow(i);return this.searchRoot(a,e,n)||i}r=this.olderShadow(r)}return s}},owner:function(t){for(var e=t;e.parentNode;)e=e.parentNode;return e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(e=document),e},findTarget:function(t){var e=t.clientX,n=t.clientY,i=this.owner(t.target);return i.elementFromPoint(e,n)||(i=document),this.searchRoot(i,e,n)}},u=Array.prototype.forEach.call.bind(Array.prototype.forEach),d=Array.prototype.map.call.bind(Array.prototype.map),p=Array.prototype.slice.call.bind(Array.prototype.slice),f=Array.prototype.filter.call.bind(Array.prototype.filter),g=window.MutationObserver||window.WebKitMutationObserver,m={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function v(t,e,n,i){this.addCallback=t.bind(i),this.removeCallback=e.bind(i),this.changedCallback=n.bind(i),g&&(this.observer=new g(this.mutationWatcher.bind(this)))}function _(t){return"body /shadow-deep/ "+y(t)}function y(t){return'[touch-action="'+t+'"]'}function x(t){return"{ -ms-touch-action: "+t+"; touch-action: "+t+"; }"}v.prototype={watchSubtree:function(t){this.observer&&c.canTarget(t)&&this.observer.observe(t,m)},enableOnSubtree:function(t){this.watchSubtree(t),t===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(t)},installNewSubtree:function(t){u(this.findElements(t),this.addElement,this)},findElements:function(t){return t.querySelectorAll?t.querySelectorAll("[touch-action]"):[]},removeElement:function(t){this.removeCallback(t)},addElement:function(t){this.addCallback(t)},elementChanged:function(t,e){this.changedCallback(t,e)},concatLists:function(t,e){return t.concat(p(e))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(t){return t.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(t){var e=d(t,this.findElements,this);return e.push(f(t,this.isElement)),e.reduce(this.concatLists,[])},mutationWatcher:function(t){t.forEach(this.mutationHandler,this)},mutationHandler:function(t){"childList"===t.type?(this.flattenMutationTree(t.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(t.removedNodes).forEach(this.removeElement,this)):"attributes"===t.type&&this.elementChanged(t.target,t.oldValue)}};var b=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],w="",S=window.PointerEvent||window.MSPointerEvent,M=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,T=h.pointermap,E=[1,4,2,8,16],C=!1;try{C=1===new MouseEvent("test",{buttons:1}).buttons}catch(t){}var A,R={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(t){h.listen(t,this.events)},unregister:function(t){h.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(t){for(var e,n=this.lastTouches,i=t.clientX,r=t.clientY,s=0,a=n.length;s<a&&(e=n[s]);s++){var o=Math.abs(i-e.x),l=Math.abs(r-e.y);if(o<=25&&l<=25)return!0}},prepareEvent:function(t){var e=h.cloneEvent(t),n=e.preventDefault;return e.preventDefault=function(){t.preventDefault(),n()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,e},prepareButtonsForMove:function(t,e){var n=T.get(this.POINTER_ID);0!==e.which&&n?t.buttons=n.buttons:t.buttons=0,e.buttons=t.buttons},mousedown:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=T.get(this.POINTER_ID),n=this.prepareEvent(t);C||(n.buttons=E[n.button],e&&(n.buttons|=e.buttons),t.buttons=n.buttons),T.set(this.POINTER_ID,t),e&&0!==e.buttons?h.move(n):h.down(n)}},mousemove:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);C||this.prepareButtonsForMove(e,t),e.button=-1,T.set(this.POINTER_ID,t),h.move(e)}},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=T.get(this.POINTER_ID),n=this.prepareEvent(t);if(!C){var i=E[n.button];n.buttons=e?e.buttons&~i:0,t.buttons=n.buttons}T.set(this.POINTER_ID,t),n.buttons&=~E[n.button],0===n.buttons?h.up(n):h.move(n)}},mouseover:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);C||this.prepareButtonsForMove(e,t),e.button=-1,T.set(this.POINTER_ID,t),h.enterOver(e)}},mouseout:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);C||this.prepareButtonsForMove(e,t),e.button=-1,h.leaveOut(e)}},cancel:function(t){var e=this.prepareEvent(t);h.cancel(e),this.deactivateMouse()},deactivateMouse:function(){T.delete(this.POINTER_ID)}},L=h.captureInfo,P=c.findTarget.bind(c),k=c.allShadows.bind(c),D=h.pointermap,I={events:["touchstart","touchmove","touchend","touchcancel"],register:function(t){A.enableOnSubtree(t)},unregister:function(){},elementAdded:function(t){var e=t.getAttribute("touch-action"),n=this.touchActionToScrollType(e);n&&(t._scrollType=n,h.listen(t,this.events),k(t).forEach(function(t){t._scrollType=n,h.listen(t,this.events)},this))},elementRemoved:function(t){t._scrollType=void 0,h.unlisten(t,this.events),k(t).forEach(function(t){t._scrollType=void 0,h.unlisten(t,this.events)},this)},elementChanged:function(t,e){var n=t.getAttribute("touch-action"),i=this.touchActionToScrollType(n),r=this.touchActionToScrollType(e);i&&r?(t._scrollType=i,k(t).forEach(function(t){t._scrollType=i},this)):r?this.elementRemoved(t):i&&this.elementAdded(t)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(t){var e=t,n=this.scrollTypes;return"none"===e?"none":e===n.XSCROLLER?"X":e===n.YSCROLLER?"Y":n.SCROLLER.exec(e)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){(0===D.size||1===D.size&&D.has(1))&&(this.firstTouch=t.identifier,this.firstXY={X:t.clientX,Y:t.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(t){t.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var t=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(t,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(t){var e=0;return"touchstart"!==t&&"touchmove"!==t||(e=1),e},touchToPointer:function(t){var e=this.currentTouchEvent,n=h.cloneEvent(t),i=n.pointerId=t.identifier+2;n.target=L[i]||P(n),n.bubbles=!0,n.cancelable=!0,n.detail=this.clickCount,n.button=0,n.buttons=this.typeToButtons(e.type),n.width=t.radiusX||t.webkitRadiusX||0,n.height=t.radiusY||t.webkitRadiusY||0,n.pressure=t.force||t.webkitForce||.5,n.isPrimary=this.isPrimaryTouch(t),n.pointerType=this.POINTER_TYPE,n.altKey=e.altKey,n.ctrlKey=e.ctrlKey,n.metaKey=e.metaKey,n.shiftKey=e.shiftKey;var r=this;return n.preventDefault=function(){r.scrolling=!1,r.firstXY=null,e.preventDefault()},n},processTouches:function(t,e){var n=t.changedTouches;this.currentTouchEvent=t;for(var i,r=0;r<n.length;r++)i=n[r],e.call(this,this.touchToPointer(i))},shouldScroll:function(t){if(this.firstXY){var e,n=t.currentTarget._scrollType;if("none"===n)e=!1;else if("XY"===n)e=!0;else{var i=t.changedTouches[0],r=n,s="Y"===n?"X":"Y";e=Math.abs(i["client"+r]-this.firstXY[r])>=Math.abs(i["client"+s]-this.firstXY[s])}return this.firstXY=null,e}},findTouch:function(t,e){for(var n,i=0,r=t.length;i<r&&(n=t[i]);i++)if(n.identifier===e)return!0},vacuumTouches:function(t){var e=t.touches;if(D.size>=e.length){var n=[];D.forEach(function(t,i){if(1!==i&&!this.findTouch(e,i-2)){var r=t.out;n.push(r)}},this),n.forEach(this.cancelOut,this)}},touchstart:function(t){this.vacuumTouches(t),this.setPrimaryTouch(t.changedTouches[0]),this.dedupSynthMouse(t),this.scrolling||(this.clickCount++,this.processTouches(t,this.overDown))},overDown:function(t){D.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),h.enterOver(t),h.down(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var e=t,n=D.get(e.pointerId);if(n){var i=n.out,r=n.outTarget;h.move(e),i&&r!==e.target&&(i.relatedTarget=e.target,e.relatedTarget=r,i.target=r,e.target?(h.leaveOut(i),h.enterOver(e)):(e.target=r,e.relatedTarget=null,this.cancelOut(e))),n.out=e,n.outTarget=e.target}},touchend:function(t){this.dedupSynthMouse(t),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(h.up(t),h.leaveOut(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){h.cancel(t),h.leaveOut(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){D.delete(t.pointerId),this.removePrimaryPointer(t)},dedupSynthMouse:function(t){var e=R.lastTouches,n=t.changedTouches[0];if(this.isPrimaryTouch(n)){var i={x:n.clientX,y:n.clientY};e.push(i);var r=function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}.bind(null,e,i);setTimeout(r,2500)}}};A=new v(I.elementAdded,I.elementRemoved,I.elementChanged,I);var O,B,F=h.pointermap,N=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,U={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(t){h.listen(t,this.events)},unregister:function(t){h.unlisten(t,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(t){var e=t;return N&&((e=h.cloneEvent(t)).pointerType=this.POINTER_TYPES[t.pointerType]),e},cleanup:function(t){F.delete(t)},MSPointerDown:function(t){F.set(t.pointerId,t);var e=this.prepareEvent(t);h.down(e)},MSPointerMove:function(t){var e=this.prepareEvent(t);h.move(e)},MSPointerUp:function(t){var e=this.prepareEvent(t);h.up(e),this.cleanup(t.pointerId)},MSPointerOut:function(t){var e=this.prepareEvent(t);h.leaveOut(e)},MSPointerOver:function(t){var e=this.prepareEvent(t);h.enterOver(e)},MSPointerCancel:function(t){var e=this.prepareEvent(t);h.cancel(e),this.cleanup(t.pointerId)},MSLostPointerCapture:function(t){var e=h.makeEvent("lostpointercapture",t);h.dispatchEvent(e)},MSGotPointerCapture:function(t){var e=h.makeEvent("gotpointercapture",t);h.dispatchEvent(e)}};function z(t){if(!h.pointermap.has(t)){var e=new Error("InvalidPointerId");throw e.name="InvalidPointerId",e}}function G(t){if(!t.ownerDocument.contains(t)){var e=new Error("InvalidStateError");throw e.name="InvalidStateError",e}}function H(t){return 0!==h.pointermap.get(t).buttons}return window.navigator.msPointerEnabled?(O=function(t){z(t),G(this),H(t)&&this.msSetPointerCapture(t)},B=function(t){z(t),this.msReleasePointerCapture(t)}):(O=function(t){z(t),G(this),H(t)&&h.setCapture(t,this)},B=function(t){z(t),h.releaseCapture(t,this)}),function(){if(S){b.forEach(function(t){String(t)===t?(w+=y(t)+x(t)+"\n",M&&(w+=_(t)+x(t)+"\n")):(w+=t.selectors.map(y)+x(t.rule)+"\n",M&&(w+=t.selectors.map(_)+x(t.rule)+"\n"))});var t=document.createElement("style");t.textContent=w,document.head.appendChild(t)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=n,window.navigator.msPointerEnabled){var t=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:t,enumerable:!0}),h.registerSource("ms",U)}else h.registerSource("mouse",R),void 0!==window.ontouchstart&&h.registerSource("touch",I);h.register(document)}}(),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:O},releasePointerCapture:{value:B}}),{dispatcher:h,Installer:v,PointerEvent:n,PointerMap:i,targetFinding:c}});var QRCode,paper=function(t,e){var n=(t=t||require("./node/self.js")).window,i=t.document,r=new function(){var t=/^(statics|enumerable|beans|preserve)$/,n=[],i=n.slice,r=Object.create,s=Object.getOwnPropertyDescriptor,a=Object.defineProperty,o=n.forEach||function(t,e){for(var n=0,i=this.length;n<i;n++)t.call(e,this[n],n,this)},l=Object.assign||function(t){for(var e=1,n=arguments.length;e<n;e++){var i=arguments[e];for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t},h=function(t,e,n){if(t){var i=s(t,"length");(i&&"number"==typeof i.value?o:function(t,e){for(var n in this)this.hasOwnProperty(n)&&t.call(e,this[n],n,this)}).call(t,e,n=n||t)}return n};function c(e,n,i,r,o){var l={};function h(t,h){"string"==typeof(h=h||(h=s(n,t))&&(h.get?h:h.value))&&"#"===h[0]&&(h=e[h.substring(1)]||h);var c,d="function"==typeof h,p=h,f=o||d&&!h.base?h&&h.get?t in e:e[t]:null;o&&f||(d&&f&&(h.base=f),d&&!1!==r&&(c=t.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),p&&!d&&p.get&&"function"==typeof p.get&&u.isPlainObject(p)||(p={value:p,writable:!0}),(s(e,t)||{configurable:!0}).configurable&&(p.configurable=!0,p.enumerable=null!=i?i:!c),a(e,t,p))}if(n){for(var c in n)n.hasOwnProperty(c)&&!t.test(c)&&h(c);for(var c in l){var d=l[c],p=e["set"+d],f=e["get"+d]||p&&e["is"+d];!f||!0!==r&&0!==f.length||h(c,{get:f,set:p})}}return e}function u(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];n&&l(this,n)}return this}return c(u,{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,n=t.beans,i=t.preserve;e!==t&&c(this.prototype,t,t.enumerable,n,i),c(this,e,null,n,i)}for(var r=1,s=arguments.length;r<s;r++)this.inject(arguments[r]);return this},extend:function(){for(var t,e,n,i=this,s=0,o=arguments.length;s<o&&(!t||!e);s++)n=arguments[s],t=t||n.initialize,e=e||n.prototype;return e=(t=t||function(){i.apply(this,arguments)}).prototype=e||r(this.prototype),a(e,"constructor",{value:t,writable:!0,configurable:!0}),c(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=i,t}}).inject({enumerable:!1,initialize:u,set:u,inject:function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];n&&c(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=r(this);return t.inject.apply(t,arguments)},each:function(t,e){return h(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:l,each:h,create:r,define:a,describe:s,clone:function(t){return l(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===u||"Object"===e.name)},pick:function(t,n){return t!==e?t:n},slice:function(t,e,n){return i.call(t,e,n)}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var n=typeof t;this.push(e+": "+("number"===n?l.instance.number(t):"string"===n?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),n=e.prototype._class;return n&&!r.exports[n]&&(r.exports[n]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((n=t.length)!==e.length)return!1;for(;n--;)if(!r.equals(t[n],e[n]))return!1}else{var n,i=Object.keys(t);if((n=i.length)!==Object.keys(e).length)return!1;for(;n--;){var s=i[n];if(!e.hasOwnProperty(s)||!r.equals(t[s],e[s]))return!1}}return!0}return!1},read:function(t,n,i,s){if(this===r){var a=this.peek(t,n);return t.__index++,a}var o=this.prototype,l=o._readIndex,h=n||l&&t.__index||0,c=t.length,u=t[h];if(s=s||c-h,u instanceof this||i&&i.readNull&&null==u&&s<=1)return l&&(t.__index=h+1),u&&i&&i.clone?u.clone():u;if(u=r.create(o),l&&(u.__read=!0),u=u.initialize.apply(u,h>0||h+s<c?r.slice(t,h,h+s):t)||u,l){t.__index=h+u.__read;var d=u.__filtered;d&&(t.__filtered=d,u.__filtered=e),u.__read=e}return u},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,n,i){for(var r,s=[],a=e||0,o=i?a+i:t.length,l=a;l<o;l++)s.push(Array.isArray(r=t[l])?this.read(r,0,n):this.read(t,l,n,1));return s},readNamed:function(t,n,i,s,a){var o=this.getNamed(t,n),l=o!==e;if(l){var h=t.__filtered;h||((h=t.__filtered=r.create(t[0])).__unfiltered=t[0]),h[n]=e}var c=l?[o]:t;return this.read(c,i,s,a)},getNamed:function(t,n){var i=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(i)),t._hasObject)return n?i[n]:t.__filtered||i},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,n,i,r){var s;function a(r){if(!(i&&r in i||s&&r in s)){var a=n[r];a!==e&&(t[r]=a)}}if(r){for(var o,l={},h=0,c=r.length;h<c;h++)(o=r[h])in n&&(a(o),l[o]=!0);s=l}return Object.keys(n.__unfiltered||n).forEach(a),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,n,i){e=e||{};var s,a=!i;if(a&&(e.formatter=new l(e.precision),i={length:0,definitions:{},references:{},add:function(t,e){var n="#"+t._id,i=this.references[n];if(!i){this.length++;var r=e.call(t),s=t._class;s&&r[0]!==s&&r.unshift(s),this.definitions[n]=r,i=this.references[n]=[n]}return i}}),t&&t._serialize){s=t._serialize(e,i);var o=t._class;!o||t._compactSerialize||!a&&n||s[0]===o||s.unshift(o)}else if(Array.isArray(t)){s=[];for(var h=0,c=t.length;h<c;h++)s[h]=r.serialize(t[h],e,n,i)}else if(r.isPlainObject(t)){s={};var u=Object.keys(t);for(h=0,c=u.length;h<c;h++){var d=u[h];s[d]=r.serialize(t[d],e,n,i)}}else s="number"==typeof t?e.formatter.number(t,e.precision):t;return a&&i.length>0?[["dictionary",i.definitions],s]:s},deserialize:function(t,e,n,i,s){var a=t,o=!n,l=o&&t&&t.length&&"dictionary"===t[0][0];if(n=n||{},Array.isArray(t)){var h=t[0],c="dictionary"===h;if(1==t.length&&/^#/.test(h))return n.dictionary[h];a=[];for(var u=(h=r.exports[h])?1:0,d=t.length;u<d;u++)a.push(r.deserialize(t[u],e,n,c,l));if(h){var p=a;e?a=e(h,p,o||s):(a=r.create(h.prototype),h.apply(a,p))}}else if(r.isPlainObject(t))for(var f in a={},i&&(n.dictionary=a),t)a[f]=r.deserialize(t[f],e,n);return l?a[1]:a},exportJSON:function(t,e){var n=r.serialize(t,e);return e&&0==e.asString?n:JSON.stringify(n)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,n,i){var s=i&&e&&e.constructor===t,a=s?e:r.create(t.prototype);if(1===n.length&&a instanceof x&&(s||!(a instanceof w))){var o=n[0];r.isPlainObject(o)&&(o.insert=!1)}return(s?a.set:t).apply(a,n),s&&(e=null),a})},splice:function(t,n,i,r){var s=n&&n.length,a=i===e;(i=a?t.length:i)>t.length&&(i=t.length);for(var o=0;o<s;o++)n[o]._index=i+o;if(a)return t.push.apply(t,n),[];var l=[i,r];n&&l.push.apply(l,n);for(var h=t.splice.apply(t,l),c=(o=0,h.length);o<c;o++)h[o]._index=e;for(o=i+s,c=t.length;o<c;o++)t[o]._index=o;return h},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var s={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var n=this._eventTypes,i=n&&n[t],s=this._callbacks=this._callbacks||{};-1===(s=s[t]=s[t]||[]).indexOf(e)&&(s.push(e),i&&i.install&&1===s.length&&i.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var n,i=this._eventTypes,s=i&&i[t],a=this._callbacks&&this._callbacks[t];return a&&(!e||-1!==(n=a.indexOf(e))&&1===a.length?(s&&s.uninstall&&s.uninstall.call(this,t),delete this._callbacks[t]):-1!==n&&a.splice(n,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var n=this._callbacks&&this._callbacks[t];if(!n)return!1;var i=r.slice(arguments,1),s=e&&e.target&&!e.currentTarget;n=n.slice(),s&&(e.currentTarget=this);for(var a=0,o=n.length;a<o;a++)if(0==n[a].apply(this,i)){e&&e.stop&&e.stop();break}return s&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,n=this._callbacks,i=t?"install":"uninstall";if(e)for(var r in n)if(n[r].length>0){var s=e[r],a=s&&s[i];a&&a.call(this,r)}},statics:{inject:function t(e){var n=e._events;if(n){var i={};r.each(n,function(t,n){var s="string"==typeof t,a=s?t:n,o=r.capitalize(a),l=a.substring(2).toLowerCase();i[l]=s?{}:t,a="_"+a,e["get"+o]=function(){return this[a]},e["set"+o]=function(t){var e=this[a];e&&this.off(l,e),t&&this.on(l,t),this[a]=t}}),e._eventTypes=i}return t.base.apply(this,arguments)}}},a=r.extend({_class:"PaperScope",initialize:function e(){paper=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var n=e.prototype;if(!this.support){var i=$.getContext(1,1)||{};n.support={nativeDash:"setLineDash"in i||"mozDash"in i,nativeBlendModes:tt.nativeModes},$.release(i)}if(!this.agent){var s=t.navigator.userAgent.toLowerCase(),a=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(s)||[])[0],o="darwin"===a?"mac":a,l=n.agent=n.browser={platform:o};o&&(l[o]=!0),s.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,n,i,r){if(!l.chrome){var s="opera"===e?i:/^(node|trident)$/.test(e)?r:n;l.version=s,l.versionNumber=parseFloat(s),e="trident"===e?"msie":e,l.name=e,l[e]=!0}}),l.chrome&&delete l.webkit,l.atom&&delete l.chrome}},version:"0.11.5",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),j.updateFocus()},install:function(t){var e=this;for(var n in r.each(["project","view","tool"],function(n){r.define(t,n,{configurable:!0,get:function(){return e[n]}})}),this)!/^_/.test(n)&&this[n]&&(t[n]=this[n])},setup:function(t){return paper=this,this.project=new y(t),this},createCanvas:function(t,e){return $.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,n=t.length-1;n>=0;n--)t[n].remove();for(n=e.length-1;n>=0;n--)e[n].remove()},remove:function(){this.clear(),delete a._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,n){return e[t](n)||e[t]("data-paper-"+n)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),o=r.extend(s,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),l=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,n){return this.number(t)+(n||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});l.instance=new l;var h=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,i=Math.sqrt,r=Math.pow,s=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function a(t,e,n){return t<e?e:t>n?n:t}function o(t,e,i){function r(t){var e=134217729*t,n=t-e+e;return[n,t-n]}var s=e*e-t*i,a=e*e+t*i;if(3*n(s)<a){var o=r(t),l=r(e),h=r(i),c=e*e,u=t*i;s=c-u+(l[0]*l[0]-c+2*l[0]*l[1]+l[1]*l[1]-(o[0]*h[0]-u+o[0]*h[1]+o[1]*h[0]+o[1]*h[1]))}return s}function l(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?r(2,-Math.round(s(t))):0}return{EPSILON:1e-12,MACHINE_EPSILON:1.12e-16,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(i(2)-1)/3,isZero:function(t){return t>=-1e-12&&t<=1e-12},clamp:a,integrate:function(n,i,r,s){for(var a=t[s-2],o=e[s-2],l=.5*(r-i),h=l+i,c=0,u=s+1>>1,d=1&s?o[c++]*n(h):0;c<u;){var p=l*a[c];d+=o[c++]*(n(h+p)+n(h-p))}return l*d},findRoot:function(t,e,i,r,s,o,l){for(var h=0;h<o;h++){var c=t(i),u=c/e(i),d=i-u;if(n(u)<l){i=d;break}c>0?(s=i,i=d<=r?.5*(r+s):d):(r=i,i=d>=s?.5*(r+s):d)}return a(i,r,s)},solveQuadratic:function(t,e,r,s,h,c){var u,d=1/0;if(n(t)<1e-12){if(n(e)<1e-12)return n(r)<1e-12?-1:0;u=-r/e}else{var p=o(t,e*=-.5,r);if(p&&n(p)<1.12e-16){var f=l(n(t),n(e),n(r));f&&(p=o(t*=f,e*=f,r*=f))}if(p>=-1.12e-16){var g=p<0?0:i(p),m=e+(e<0?-g:g);0===m?d=-(u=r/t):(u=m/t,d=r/m)}}var v=0,_=null==h,y=h-1e-12,x=c+1e-12;return isFinite(u)&&(_||u>y&&u<x)&&(s[v++]=_?u:a(u,h,c)),d!==u&&isFinite(d)&&(_||d>y&&d<x)&&(s[v++]=_?d:a(d,h,c)),v},solveCubic:function(t,e,s,o,c,u,d){var p,f,g,m,v,_=l(n(t),n(e),n(s),n(o));function y(n){var i=t*(p=n);m=(i+(f=i+e))*p+(g=f*p+s),v=g*p+o}if(_&&(t*=_,e*=_,s*=_,o*=_),n(t)<1e-12)t=e,f=s,g=o,p=1/0;else if(n(o)<1e-12)f=e,g=s,p=0;else{y(-e/t/3);var x=v/t,b=r(n(x),1/3),w=x<0?-1:1,S=-m/t,M=S>0?1.324717957244746*Math.max(b,i(S)):b,T=p-w*M;if(T!==p){do{y(T),T=0===m?p:p-v/m/(1+1.12e-16)}while(w*T>w*p);n(t)*p*p>n(o/p)&&(f=((g=-o/p)-s)/p)}}var E=h.solveQuadratic(t,f,g,c,u,d),C=null==u;return isFinite(p)&&(0===E||E>0&&p!==c[0]&&p!==c[1])&&(C||p>u-1e-12&&p<d+1e-12)&&(c[E++]=C?p:a(p,u,d)),E}}},c={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},u=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var n=typeof t,i=this.__read,r=0;if("number"===n){var s="number"==typeof e;this._set(t,s?e:t),i&&(r=s?2:1)}else if("undefined"===n||null===t)this._set(0,0),i&&(r=null===t?1:0);else{var a="string"===n?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"x"in a?this._set(a.x||0,a.y||0):"width"in a?this._set(a.width||0,a.height||0):"angle"in a?(this._set(a.length||0,0),this.setAngle(a.angle||0)):(this._set(0,0),r=0)}return i&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new u(this.x,this.y)},toString:function(){var t=l.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var n=t/this.getLength();h.isZero(n)&&this.getAngle(),this._set(this.x*n,this.y*n)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=u.read(arguments),e=this.getLength()*t.getLength();if(h.isZero(e))return NaN;var n=this.dot(t)/e;return Math.acos(n<-1?-1:n>1?1:n)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=u.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=u.read(arguments),e=t.x-this.x,n=t.y-this.y,i=e*e+n*n;return r.read(arguments)?i:Math.sqrt(i)},normalize:function(t){t===e&&(t=1);var n=this.getLength(),i=0!==n?t/n:0,r=new u(this.x*i,this.y*i);return i>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var n=e?this.subtract(e):this,i=Math.sin(t),r=Math.cos(t);return n=new u(n.x*r-n.y*i,n.x*i+n.y*r),e?n.add(e):n},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=u.read(arguments);return new u(this.x+t.x,this.y+t.y)},subtract:function(){var t=u.read(arguments);return new u(this.x-t.x,this.y-t.y)},multiply:function(){var t=u.read(arguments);return new u(this.x*t.x,this.y*t.y)},divide:function(){var t=u.read(arguments);return new u(this.x/t.x,this.y/t.y)},modulo:function(){var t=u.read(arguments);return new u(this.x%t.x,this.y%t.y)},negate:function(){return new u(-this.x,-this.y)},isInside:function(){return g.read(arguments).contains(this)},isClose:function(){var t=u.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=u.read(arguments);return u.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=u.read(arguments);return u.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=h.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=u.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=u.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=u.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new u(t.x*e,t.y*e)},statics:{min:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new u(Math.random(),Math.random())},isCollinear:function(t,e,n,i){return Math.abs(t*i-e*n)<=1e-8*Math.sqrt((t*t+e*e)*(n*n+i*i))},isOrthogonal:function(t,e,n,i){return Math.abs(t*n+e*i)<=1e-8*Math.sqrt((t*t+e*e)*(n*n+i*i))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new u(e(this.x),e(this.y))}},{})),d=u.extend({initialize:function(t,e,n,i){this._x=t,this._y=e,this._owner=n,this._setter=i},_set:function(t,e,n){return this._x=t,this._y=e,n||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),p=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var n=typeof t,i=this.__read,r=0;if("number"===n){var s="number"==typeof e;this._set(t,s?e:t),i&&(r=s?2:1)}else if("undefined"===n||null===t)this._set(0,0),i&&(r=null===t?1:0);else{var a="string"===n?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"width"in a?this._set(a.width||0,a.height||0):"x"in a?this._set(a.x||0,a.y||0):(this._set(0,0),r=0)}return i&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new p(this.width,this.height)},toString:function(){var t=l.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=p.read(arguments);return new p(this.width+t.width,this.height+t.height)},subtract:function(){var t=p.read(arguments);return new p(this.width-t.width,this.height-t.height)},multiply:function(){var t=p.read(arguments);return new p(this.width*t.width,this.height*t.height)},divide:function(){var t=p.read(arguments);return new p(this.width/t.width,this.height/t.height)},modulo:function(){var t=p.read(arguments);return new p(this.width%t.width,this.height%t.height)},negate:function(){return new p(-this.width,-this.height)},isZero:function(){var t=h.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new p(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new p(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new p(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new p(e(this.width),e(this.height))}},{})),f=p.extend({initialize:function(t,e,n,i){this._width=t,this._height=e,this._owner=n,this._setter=i},_set:function(t,e,n){return this._width=t,this._height=e,n||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),g=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,n,i,s){var a,o=typeof t;if("number"===o?(this._set(t,n,i,s),a=4):"undefined"===o||null===t?(this._set(0,0,0,0),a=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),a=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),a=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.filter(this,t),a=1)),a===e){var l,h,c=u.readNamed(arguments,"from"),d=r.peek(arguments),f=c.x,g=c.y;if(d&&d.x!==e||r.hasNamed(arguments,"to")){var m=u.readNamed(arguments,"to");l=m.x-f,h=m.y-g,l<0&&(f=m.x,l=-l),h<0&&(g=m.y,h=-h)}else{var v=p.read(arguments);l=v.width,h=v.height}this._set(f,g,l,h),a=arguments.__index;var _=arguments.__filtered;_&&(this.__filtered=_)}return this.__read&&(this.__read=a),this},set:"#initialize",_set:function(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this},clone:function(){return new g(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?g.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=l.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?u:d)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?p:f)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=p.read(arguments),e=this._sx,n=this._sy,i=t.width,r=t.height;e&&(this.x+=(this.width-i)*e),n&&(this.y+=(this.height-r)*n),this.width=i,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var e=t-this.x;this.width-=.5===this._sx?2*e:e}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var e=t-this.y;this.height-=.5===this._sy?2*e:e}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var e=t-this.x;this.width=.5===this._sx?2*e:e}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var e=t-this.y;this.height=.5===this._sy?2*e:e}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?u:d)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=u.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(g.read(arguments)):this._containsPoint(u.read(arguments))},_containsPoint:function(t){var e=t.x,n=t.y;return e>=this.x&&n>=this.y&&e<=this.x+this.width&&n<=this.y+this.height},_containsRectangle:function(t){var e=t.x,n=t.y;return e>=this.x&&n>=this.y&&e+t.width<=this.x+this.width&&n+t.height<=this.y+this.height},intersects:function(){var t=g.read(arguments),e=r.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=g.read(arguments),e=Math.max(this.x,t.x),n=Math.max(this.y,t.y),i=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new g(e,n,i-e,r-n)},unite:function(){var t=g.read(arguments),e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new g(e,n,i-e,r-n)},include:function(){var t=u.read(arguments),e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new g(e,n,i-e,r-n)},expand:function(){var t=p.read(arguments),e=t.width,n=t.height;return new g(this.x-e/2,this.y-n/2,this.width+e,this.height+n)},scale:function(t,n){return this.expand(this.width*t-this.width,this.height*(n===e?t:n)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var n=t.join(""),i=/^[RL]/.test(n);e>=4&&(t[1]+=i?"Y":"X");var r=t[i?0:1],s=t[i?1:0],a="get"+r,o="get"+s,l="set"+r,h="set"+s,c="set"+n;this["get"+n]=function(t){return new(t?u:d)(this[a](),this[o](),this,c)},this[c]=function(){var t=u.read(arguments);this[l](t.x),this[h](t.y)}},{beans:!0})),m=g.extend({initialize:function(t,e,n,i,r,s){this._set(t,e,n,i,!0),this._owner=r,this._setter=s},_set:function(t,e,n,i,r){return this._x=t,this._y=e,this._width=n,this._height=i,r||this._owner[this._setter](this),this}},new function(){var t=g.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),n="_"+t;this["get"+e]=function(){return this[n]},this["set"+e]=function(t){this[n]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var n="set"+e;this[n]=function(){this._dontNotify=!0,t[n].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),v=r.extend({_class:"Matrix",initialize:function t(e,n){var i=arguments.length,r=!0;if(i>=6?this._set.apply(this,arguments):1===i||2===i?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,n):Array.isArray(e)?this._set.apply(this,n?e.concat([n]):e):r=!1:i?r=!1:this.reset(),!r)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,n,i,r,s,a){return this._a=t,this._b=e,this._c=n,this._d=i,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new v(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=l.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var n=this._owner;return!!n&&(n.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=u.read(arguments),e=t.x,n=t.y;return this._tx+=e*this._a+n*this._c,this._ty+=e*this._b+n*this._d,this._changed(),this},scale:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=u.read(arguments,1),n=e.x,i=e.y,r=Math.cos(t),s=Math.sin(t),a=n-n*r+i*s,o=i-n*s-i*r,l=this._a,h=this._b,c=this._c,d=this._d;return this._a=r*l+s*c,this._b=r*h+s*d,this._c=-s*l+r*c,this._d=-s*h+r*d,this._tx+=a*l+o*c,this._ty+=a*h+o*d,this._changed(),this},shear:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});e&&this.translate(e);var n=this._a,i=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*n,this._d+=t.x*i,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0}),n=Math.PI/180,i=new u(Math.tan(t.x*n),Math.tan(t.y*n));return this.shear(i,e)},append:function(t,e){if(t){var n=this._a,i=this._b,r=this._c,s=this._d,a=t._a,o=t._c,l=t._b,h=t._d,c=t._tx,u=t._ty;this._a=a*n+l*r,this._c=o*n+h*r,this._b=a*i+l*s,this._d=o*i+h*s,this._tx+=c*n+u*r,this._ty+=c*i+u*s,e||this._changed()}return this},prepend:function(t,e){if(t){var n=this._a,i=this._b,r=this._c,s=this._d,a=this._tx,o=this._ty,l=t._a,h=t._c,c=t._b,u=t._d,d=t._tx,p=t._ty;this._a=l*n+h*i,this._c=l*r+h*s,this._b=c*n+u*i,this._d=c*r+u*s,this._tx=l*a+h*o+d,this._ty=c*a+u*o+p,e||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,n=this._c,i=this._d,r=this._tx,s=this._ty,a=t*i-e*n,o=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=i/a,this._b=-e/a,this._c=-n/a,this._d=t/a,this._tx=(n*s-i*r)/a,this._ty=(e*r-t*s)/a,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new v(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,n){return arguments.length<3?this._transformPoint(u.read(arguments)):this._transformCoordinates(t,e,n)},_transformPoint:function(t,e,n){var i=t.x,r=t.y;return e||(e=new u),e._set(i*this._a+r*this._c+this._tx,i*this._b+r*this._d+this._ty,n)},_transformCoordinates:function(t,e,n){for(var i=0,r=2*n;i<r;i+=2){var s=t[i],a=t[i+1];e[i]=s*this._a+a*this._c+this._tx,e[i+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,n=t.y,i=e+t.width,r=n+t.height,s=[e,n,i,n,i,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,n){for(var i=this._transformCorners(t),r=i.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=i[a],l=1&a;o<r[l]?r[l]=o:o>s[l]&&(s[l]=o)}return e||(e=new g),e._set(r[0],r[1],s[0]-r[0],s[1]-r[1],n)},inverseTransform:function(){return this._inverseTransform(u.read(arguments))},_inverseTransform:function(t,e,n){var i=this._a,r=this._b,s=this._c,a=this._d,o=this._tx,l=this._ty,h=i*a-r*s,c=null;if(h&&!isNaN(h)&&isFinite(o)&&isFinite(l)){var d=t.x-this._tx,p=t.y-this._ty;e||(e=new u),c=e._set((d*a-p*s)/h,(p*i-d*r)/h,n)}return c},decompose:function(){var t,e,n,i=this._a,r=this._b,s=this._c,a=this._d,o=i*a-r*s,l=Math.sqrt,h=Math.atan2,c=180/Math.PI;if(0!==i||0!==r){var d=l(i*i+r*r);t=Math.acos(i/d)*(r>0?1:-1),e=[d,o/d],n=[h(i*s+r*a,d*d),0]}else if(0!==s||0!==a){var p=l(s*s+a*a);t=Math.asin(s/p)*(a>0?1:-1),e=[o/p,p],n=[0,h(i*s+r*a,p*p)]}else t=0,n=e=[0,0];return{translation:this.getTranslation(),rotation:t*c,scaling:new u(e),skewing:new u(n[0]*c,n[1]*c)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new u(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),n="_"+t;this["get"+e]=function(){return this[n]},this["set"+e]=function(t){this[n]=t,this._changed()}},{})),_=r.extend({_class:"Line",initialize:function(t,e,n,i,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=n,this._vy=i,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=n),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new u(this._px,this._py)},getVector:function(){return new u(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return _.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return _.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return _.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return u.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return u.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,n,i,r,s,a,o,l,c){l||(n-=t,i-=e,a-=r,o-=s);var d=n*o-i*a;if(!h.isZero(d)){var p=t-r,f=e-s,g=(a*f-o*p)/d,m=(n*f-i*p)/d;if(c||-1e-12<g&&g<1+1e-12&&-1e-12<m&&m<1+1e-12)return c||(g=g<=0?0:g>=1?1:g),new u(t+g*n,e+g*i)}},getSide:function(t,e,n,i,r,s,a,o){a||(n-=t,i-=e);var l=r-t,c=l*i-(s-e)*n;return!o&&h.isZero(c)&&(c=(l*n+l*n)/(n*n+i*i))>=0&&c<=1&&(c=0),c<0?-1:c>0?1:0},getSignedDistance:function(t,e,n,i,r,s,a){return a||(n-=t,i-=e),0===n?i>0?r-t:t-r:0===i?n<0?s-e:e-s:((r-t)*i-(s-e)*n)/Math.sqrt(n*n+i*i)},getDistance:function(t,e,n,i,r,s,a){return Math.abs(_.getSignedDistance(t,e,n,i,r,s,a))}}}),y=o.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){o.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new H(null,null,this),this._view=j.create(this,t||$.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var n=this._view;n&&(n._needsUpdate=!0,!n._requested&&n._autoUpdate&&n.requestUpdate())}var i=this._changes;if(i&&e){var r=this._changesById,s=e._id,a=r[s];a?a.flags|=t:i.push(r[s]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new w({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:T,match:function(n){var i=n._definition,r=i._id;return e[r]||(e[r]=!0,t.push(i)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var n in t){var i=t[n],r=i._selection;1&r&&i.isInserted()?e.push(i):r||this._updateSelection(i)}return e},_updateSelection:function(t){var e=t._id,n=this._selectionItems;t._selection?n[e]!==t&&(this._selectionCount++,n[e]=t):n[e]===t&&(this._selectionCount--,delete n[e])},selectAll:function(){for(var t=this._children,e=0,n=t.length;e<n;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof w){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var n=e._name;n&&e.setName(n),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,n,i){return n=this.insertLayer(t,n)||(this._activeLayer||this._insertItem(e,new w(x.NO_INSERT),!0)).insertChild(t,n),i&&n.activate&&n.activate(),n},getItems:function(t){return x._getItems(this,t)},getItem:function(t){return x._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var n=e[t];if(n){for(var i in n){var r=n[i];for(var s in e){var a=e[s];a&&a!=n&&delete a[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,n){this._updateVersion++,t.save(),e.applyToContext(t);for(var i=this._children,s=new r({offset:new u(0,0),pixelRatio:n,viewMatrix:e.isIdentity()?null:e,matrices:[new v],updateMatrix:!0}),a=0,o=i.length;a<o;a++)i[a].draw(t,s);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var l=this._selectionItems,h=this._scope.settings.handleSize,c=this._updateVersion;for(var d in l)l[d]._drawSelection(t,e,h,l,c);t.restore()}}}),x=r.extend(s,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=r.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_enhanceBlendMode:!1,_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new v,pivot:null,visible:!0,blendMode:"normal",enhanceBlendMode:!1,opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,n){var i=t&&r.isPlainObject(t),s=i&&!0===t.internal,a=this._matrix=new v,o=i&&t.project||paper.project,l=paper.settings;return this._id=s?null:c.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&l.applyMatrix,n&&a.translate(n),a._owner=this,this._style=new H(o._currentStyle,this,o),s||i&&0==t.insert||!l.insertItems&&(!i||!0!==t.insert)?this._setProject(o):(i&&t.parent||o)._insertItem(e,this,!0),i&&t!==x.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),i},_serialize:function(t,e){var n={},i=this;function s(s){for(var a in s){var o=i[a];r.equals(o,"leading"===a?1.2*s.fontSize:s[a])||(n[a]=r.serialize(o,t,"data"!==a,e))}}return s(this._serializeFields),this instanceof b||s(this._style._defaults),[this._class,n]},_changed:function(t){var n=this._symbol,i=this._parent||n,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),i&&40&t&&x._clearBoundsCache(i),2&t&&x._clearBoundsCache(this),r&&r._changed(t,this),n&&n._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var n=this._getOwner();if(t&&n){var i=n._children,r=n._namedChildren;(r[t]=r[t]||[]).push(this),t in i||(i[t]=this)}this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide","enhanceBlendMode"],function(t){var e=r.capitalize(t),n="_"+t,i={locked:128,visible:137};this["get"+e]=function(){return this[n]},this["set"+e]=function(e){e!=this[n]&&(this[n]=e,this._changed(i[t]||129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},_changeSelection:function(t,e){var n=this._selection;this.setSelection(e?n|t:n&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,n=t.length;e<n;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,n=0,i=e.length;n<i;n++)e[n].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var n=0,i=t.length;n<i;n++)if(!t[n].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var n=0,i=e.length;n<i;n++)e[n].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,n=t?u:d;if(!e){var i=this._pivot;e=this._position=i?this._matrix._transformPoint(i):this.getBounds().getCenter(!0)}return new n(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(u.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new d(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=u.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var n=e||t instanceof v,i=r.set({},n?e:t,this._boundsOptions);i.stroke&&!this.getStrokeScaling()||(i.cacheItem=this);var s=this._getCachedBounds(n&&t,i).rect;return arguments.length?s:new m(s.x,s.y,s.width,s.height,this,"setBounds")},setBounds:function(){var t=g.read(arguments),e=this.getBounds(),n=this._matrix,i=new v,r=t.getCenter();i.translate(r),t.width==e.width&&t.height==e.height||(n.isInvertible()||(n.set(n._backup||(new v).translate(n.getTranslation())),e=this.getBounds()),i.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),i.translate(-r.x,-r.y),this.transform(i)},_getBounds:function(t,e){var n=this._children;return n&&n.length?(x._updateBoundsCache(this,e.cacheItem),x._getBounds(n,t,e)):new g},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,n){t=t&&t._orNullIfIdentity();var i=e.internal&&!n,r=e.cacheItem,s=i?null:this._matrix._orNullIfIdentity(),a=r&&(!t||t.equals(s))&&this._getBoundsCacheKey(e,i),o=this._bounds;if(x._updateBoundsCache(this._parent||this._symbol,r),a&&o&&a in o)return{rect:(d=o[a]).rect.clone(),nonscaling:d.nonscaling};var l=this._getBounds(t||s,e),h=l.rect||l,c=this._style,u=l.nonscaling||c.hasStroke()&&!c.getStrokeScaling();if(a){o||(this._bounds=o={});var d=o[a]={rect:h.clone(),nonscaling:u,internal:i}}return{rect:h,nonscaling:u}},_getStrokeMatrix:function(t,e){var n=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,i=n?n.getViewMatrix().invert():t;return i&&i._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var n=e._id,i=t._boundsCache=t._boundsCache||{ids:{},list:[]};i.ids[n]||(i.list.push(e),i.ids[n]=e)}},_clearBoundsCache:function(t){var n=t._boundsCache;if(n){t._bounds=t._position=t._boundsCache=e;for(var i=0,r=n.list,s=r.length;i<s;i++){var a=r[i];a!==t&&(a._bounds=a._position=e,a._boundsCache&&x._clearBoundsCache(a))}}},_getBounds:function(t,e,n){var i=1/0,r=-i,s=i,a=r,o=!1;n=n||{};for(var l=0,h=t.length;l<h;l++){var c=t[l];if(c._visible&&!c.isEmpty()){var u=c._getCachedBounds(e&&e.appended(c._matrix),n,!0),d=u.rect;i=Math.min(d.x,i),s=Math.min(d.y,s),r=Math.max(d.x+d.width,r),a=Math.max(d.y+d.height,a),u.nonscaling&&(o=!0)}}return{rect:isFinite(i)?new g(i,s,r-i,a-s):new g,nonscaling:o}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var n=this._decomposed;this.rotate(t-e),n&&(n.rotation=t,this._decomposed=n)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new d(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var n=this.getRotation(),i=this._decomposed,r=new v,s=this.getPosition(!0);r.translate(s),n&&r.rotate(n),r.scale(e.x/t.x,e.y/t.y),n&&r.rotate(-n),r.translate(s.negate()),this.transform(r),i&&(i.scaling=e,this._decomposed=i)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,n=this._project._updateVersion;if(e&&e._updateVersion!==n&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var i=this._parent;i&&e.prepend(i.getGlobalMatrix(!0)),e._updateVersion=n}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var n=this._children,i=0,r=n&&n.length;i<r;i++)n[i]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var n=this._children,i=0,r=n&&n.length;i<r;i++)n[i]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof w)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var n=new this.constructor(x.NO_INSERT),i=this._children,s=r.pick(t?t.insert:e,t===e||!0===t),a=r.pick(t?t.deep:e,!0);i&&n.copyAttributes(this),i&&!a||n.copyContent(this),i||n.copyAttributes(this),s&&n.insertAbove(this);var o=this._name,l=this._parent;if(o&&l){i=l._children;for(var h=o,c=1;i[o];)o=h+" "+c++;o!==h&&n.setName(o)}return n},copyContent:function(t){for(var e=t._children,n=0,i=e&&e.length;n<i;n++)this.addChild(e[n].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var n=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide","_enhanceBlendMode"],i=0,s=n.length;i<s;i++){var a=n[i];t.hasOwnProperty(a)&&(this[a]=t[a])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,l=t._name;this._data=o?r.clone(o):null,l&&this.setName(l)},rasterize:function(t,n){var i=this.getStrokeBounds(),s=(t||this.getView().getResolution())/72,a=i.getTopLeft().floor(),o=i.getBottomRight().ceil(),l=new p(o.subtract(a)),h=new M(x.NO_INSERT);if(!l.isZero()){var c=$.getCanvas(l.multiply(s)),u=c.getContext("2d"),d=(new v).scale(s).translate(a.negate());u.save(),d.applyToContext(u),this.draw(u,new r({matrices:[d]})),u.restore(),h.setCanvas(c)}return h.transform((new v).translate(a.add(l.divide(2))).scale(1/s)),(n===e||n)&&h.insertAbove(this),h},contains:function(){return!!this._contains(this._matrix._inverseTransform(u.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var n=e.length-1;n>=0;n--)if(e[n].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return g.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new D.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof x&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(u.read(arguments),C.getOptions(arguments))}function e(){var t=u.read(arguments),e=C.getOptions(arguments),n=[];return this._hitTest(t,r.set({all:n},e)),n}function n(t,e,n,i){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var a=r[s],o=a!==i&&a._hitTest(t,e,n);if(o&&!e.all)return o}return null}return y.inject({hitTest:t,hitTestAll:e,_hitTest:n}),{hitTest:t,hitTestAll:e,_hitTestChildren:n}},{_hitTest:function(t,e,n){if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var i=this._matrix,s=n?n.appended(i):this.getGlobalMatrix().prepend(this.getView()._matrix),a=Math.max(e.tolerance,1e-12),o=e._tolerancePadding=new p(D._getStrokePadding(a,i._shiftless().invert()));if(!(t=i._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(o.multiply(2))._containsPoint(t))return null;var l,h,c=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),u=e.match,d=this;function f(t){return t&&u&&!u(t)&&(t=null),t&&e.all&&e.all.push(t),t}function g(e,n){var i=n?l["get"+n]():d.getPosition();if(t.subtract(i).divide(o).length<=1)return new C(e,d,{name:n?r.hyphenate(n):e,point:i})}var m=e.position,v=e.center,_=e.bounds;if(c&&this._parent&&(m||v||_)){if((v||_)&&(l=this.getInternalBounds()),!(h=m&&g("position")||v&&g("center","Center"))&&_)for(var y=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],x=0;x<8&&!h;x++)h=g("bounds",y[x]);h=f(h)}return h||(h=this._hitTestChildren(t,e,s)||c&&f(this._hitTestSelf(t,e,s,this.getStrokeScaling()?null:s._shiftless().invert()))||null),h&&h.point&&(h.point=i.transform(h.point)),h},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new C("fill",this)},matches:function(t,e){var n=typeof t;if("object"===n){for(var i in t)if(t.hasOwnProperty(i)&&!this.matches(i,t[i]))return!1;return!0}if("function"===n)return t(this);if("match"===t)return e(this);var s=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;s=this._class}if("function"==typeof e)return!!e(s);if(e){if(e.test)return e.test(s);if(r.isPlainObject(e))return function t(e,n){for(var i in e)if(e.hasOwnProperty(i)){var s=e[i],a=n[i];if(r.isPlainObject(s)&&r.isPlainObject(a)){if(!t(s,a))return!1}else if(!r.equals(s,a))return!1}return!0}(e,s)}return r.equals(s,e)},getItems:function(t){return x._getItems(this,t,this._matrix)},getItem:function(t){return x._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,n,i,s,a){if(!s){var o="object"==typeof n&&n,l=o&&o.overlapping,h=o&&o.inside,c=(x=l||h)&&g.read([x]);s={items:[],recursive:o&&!1!==o.recursive,inside:!!h,overlapping:!!l,rect:c,path:l&&new D.Rectangle({rectangle:c,insert:!1})},o&&(n=r.filter({},n,{recursive:!0,inside:!0,overlapping:!0}))}var u=e._children,d=s.items;i=(c=s.rect)&&(i||new v);for(var p=0,f=u&&u.length;p<f;p++){var m=u[p],_=i&&i.appended(m._matrix),y=!0;if(c){var x=m.getBounds(_);if(!c.intersects(x))continue;c.contains(x)||s.overlapping&&(x.contains(c)||s.path.intersects(m,_))||(y=!1)}if(y&&m.matches(n)&&(d.push(m),a))break;if(!1!==s.recursive&&t(m,n,_,s,a),a&&d.length>0)break}return d}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,e){var n=e?this.insertChildren(t,[e]):null;return n&&n[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var n=this._children;if(n&&e&&e.length>0){for(var i={},s=(e=r.slice(e)).length-1;s>=0;s--){var a=(c=e[s])&&c._id;!c||i[a]?e.splice(s,1):(c._remove(!1,!0),i[a]=!0)}r.splice(n,e,t,0);for(var o=this._project,l=o._changes,h=(s=0,e.length);s<h;s++){var c,u=(c=e[s])._name;c._parent=this,c._setProject(o,!0),u&&c.setName(u),l&&c._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var n=t&&t._getOwner(),i=t!==this&&n?this:null;return i&&(i._remove(!1,!0),n._insertItem(t._index+e,i)),i},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(e,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;if(e&&1===e.length){var n=e[0].reduce(t);return this._parent?(n.insertAbove(this),this.remove()):n.remove(),n}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,n=t._namedChildren,i=this._name,r=n[i],s=r?r.indexOf(this):-1;-1!==s&&(e[i]==this&&delete e[i],r.splice(s,1),r.length?e[i]=r[0]:delete n[i])}},_remove:function(t,e){var n=this._getOwner(),i=this._project,s=this._index;return!!n&&(this._name&&this._removeNamed(),null!=s&&(i._activeLayer===this&&(i._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(n._children,null,s,1)),this._installEvents(!1),t&&i._changes&&this._changed(5),e&&n._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var n=r.splice(this._children,null,t,e-t),i=n.length-1;i>=0;i--)n[i]._remove(!0,!1);return n.length>0&&this._changed(11),n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var n=e(this),i=e(t),r=0,s=Math.min(n.length,i.length);r<s;r++)if(n[r]!=i[r])return n[r]._index<i[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var n=(e?r:u).read(arguments),i=u.read(arguments,0,{readNull:!0});return this.transform((new v)[t](n,i||this.getPosition(!0)))}},{translate:function(){var t=new v;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,n,i){var r=this._matrix,s=t&&!t.isIdentity(),a=(e||this._applyMatrix)&&(!r.isIdentity()||s||e&&n&&this._children);if(!s&&!a)return this;if(s){!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0);var o=this._style,l=o.getFillColor(!0),h=o.getStrokeColor(!0);l&&l.transform(t),h&&h.transform(t)}if(a&&(a=this._transformContent(r,n,i))){var c=this._pivot;c&&r._transformPoint(c,c,!0),r.reset(!0),i&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,d=this._position;(s||a)&&this._changed(9);var p=s&&u&&t.decompose();if(p&&p.skewing.isZero()&&p.rotation%90==0){for(var f in u){var g=u[f];if(g.nonscaling)delete u[f];else if(a||!g.internal){var m=g.rect;t._transformBounds(m,m)}}this._bounds=u;var v=u[this._getBoundsCacheKey(this._boundsOptions||{})];v&&(this._position=v.rect.getCenter(!0))}else s&&d&&this._pivot&&(this._position=t._transformPoint(d,d));return this},_transformContent:function(t,e,n){var i=this._children;if(i){for(var r=0,s=i.length;r<s;r++)i[r].transform(t,!0,e,n);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(u.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(u.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(u.read(arguments))},localToParent:function(){return this._matrix._transformPoint(u.read(arguments))},fitBounds:function(t,e){t=g.read(arguments);var n=this.getBounds(),i=n.height/n.width,r=t.height/t.width,s=(e?i>r:i<r)?t.width/n.width:t.height/n.height,a=new g(new u,new p(n.width*s,n.height*s));a.setCenter(t.getCenter()),this.setBounds(a)}}),{_setStyles:function(t,e,n){var i=this._style,r=this._matrix;if(i.hasFill()&&(t.fillStyle=i.getFillColor().toCanvasStyle(t,r)),i.hasStroke()){t.strokeStyle=i.getStrokeColor().toCanvasStyle(t,r),t.lineWidth=i.getStrokeWidth();var s=i.getStrokeJoin(),a=i.getStrokeCap(),o=i.getMiterLimit();if(s&&(t.lineJoin=s),a&&(t.lineCap=a),o&&(t.miterLimit=o),paper.support.nativeDash){var l=i.getDashArray(),h=i.getDashOffset();l&&l.length&&("setLineDash"in t?(t.setLineDash(l),t.lineDashOffset=h):(t.mozDash=l,t.mozDashOffset=h))}}if(i.hasShadow()){var c=e.pixelRatio||1,d=n._shiftless().prepend((new v).scale(c,c)),p=d.transform(new u(i.getShadowBlur(),0)),f=d.transform(this.getShadowOffset());t.shadowColor=i.getShadowColor().toCanvasStyle(t),t.shadowBlur=p.getLength(),t.shadowOffsetX=f.x,t.shadowOffsetY=f.y}},draw:function(t,e,n){var i=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,s=e.viewMatrix,a=this._matrix,o=r[r.length-1].appended(a);if(o.isInvertible()){s=s?s.appended(o):o,r.push(o),e.updateMatrix&&(o._updateVersion=i,this._globalMatrix=o);var l,h,c,u=this._enhanceBlendMode,d=this._blendMode,p=this._opacity,f="normal"===d,g=tt.nativeModes[d],m=f&&1===p||e.dontStart||e.clip||(g||f&&p<1)&&this._canComposite(),v=e.pixelRatio||1;if(!m){var _=this.getStrokeBounds(s);if(!_.width||!_.height)return;c=e.offset,h=e.offset=_.getTopLeft().floor(),l=t,t=$.getContext(_.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();var y=n?n.appended(a):this._canScaleStroke&&!this.getStrokeScaling(!0)&&s,x=!m&&e.clipItem,b=!y||x;if(m?(t.globalAlpha=p,g&&(t.globalCompositeOperation=d)):b&&t.translate(-h.x,-h.y),b&&(m?a:s).applyToContext(t),x&&e.clipItem.draw(t,e.extend({clip:!0})),y){t.setTransform(v,0,0,v,0,0);var w=e.offset;w&&t.translate(-w.x,-w.y)}this._draw(t,e,s,y),m&&"normal"!=d&&u&&this._draw(t,e,s,y),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),m||(tt.process(d,t,l,p,h.subtract(c).multiply(v)),"normal"!=d&&u&&tt.process(d,t,l,p,h.subtract(c).multiply(v)),$.release(t),e.offset=c)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof I)return e._isUpdated(t);var n=this._updateVersion===t;return!n&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,n=!0),n},_drawSelection:function(t,e,n,i,r){var s=this._selection,a=1&s,o=2&s||a&&this._selectBounds,l=4&s;if(this._drawSelected||(a=!1),(a||o||l)&&this._isUpdated(r)){var h,c=this.getSelectedColor(!0)||(h=this.getLayer())&&h.getSelectedColor(!0),u=e.appended(this.getGlobalMatrix(!0)),d=n/2;if(t.strokeStyle=t.fillStyle=c?c.toCanvasStyle(t):"#009dec",a&&this._drawSelected(t,u,i),l){var p=this.getPosition(!0),f=p.x,g=p.y;t.beginPath(),t.arc(f,g,d,0,2*Math.PI,!0),t.stroke();for(var m=[[0,-1],[1,0],[0,1],[-1,0]],v=d,_=n+1,y=0;y<4;y++){var x=m[y],b=x[0],w=x[1];t.moveTo(f+b*v,g+w*v),t.lineTo(f+b*_,g+w*_),t.stroke()}}if(o){var S=u._transformCorners(this.getInternalBounds());for(t.beginPath(),y=0;y<8;y++)t[y?"lineTo":"moveTo"](S[y],S[++y]);for(t.closePath(),t.stroke(),y=0;y<8;y++)t.fillRect(S[y]-d,S[++y]-d,n,n)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var n="mouse"+e,i=this._project,r=i._removeSets=i._removeSets||{};r[n]=r[n]||{},r[n][this._id]=this}return this}})),b=x.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(n){t.base.call(this,n),1026&n&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var n=this._children,i=0,r=n.length;i<r;i++)if(n[i]._clipMask){t=n[i];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,n){var i=this._getClipItem();return i?i._getCachedBounds(e&&e.appended(i._matrix),r.set({},n,{stroke:!1})):t.base.call(this,e,n)},_hitTestChildren:function t(e,n,i){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,n,i,r)},_draw:function(t,e){var n=e.clip,i=!n&&this._getClipItem();e=e.extend({clipItem:i,clip:!1}),n?(t.beginPath(),e.dontStart=e.dontFinish=!0):i&&i.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,a=r.length;s<a;s++){var o=r[s];o!==i&&o.draw(t,e)}}}),w=b.extend({_class:"Layer",initialize:function(){b.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),S=x.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new f(t.width,t.height,this,"setSize")},setSize:function(){var t=p.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,n=t.width,i=t.height;"rectangle"===e?this._radius.set(p.min(this._radius,t.divide(2))):"circle"===e?(n=i=(n+i)/2,this._radius=n/2):"ellipse"===e&&this._radius._set(n/2,i/2),this._size._set(n,i),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new f(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var n=2*t;this._radius=t,this._size._set(n,n)}else if(t=p.read(arguments),this._radius){if(this._radius.equals(t))return;this._radius.set(t),"rectangle"===e?(n=p.max(this._size,t.multiply(2)),this._size.set(n)):"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var n=new(D[r.capitalize(this._type)])({center:new u,size:this._size,radius:this._radius,insert:!1});return n.copyAttributes(this),paper.settings.applyMatrix&&n.setApplyMatrix(!0),(t===e||t)&&n.insertAbove(this),n},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,n,i){var r=this._style,s=r.hasFill(),a=r.hasStroke(),o=e.dontFinish||e.clip,l=!i;if(s||a||o){var h=this._type,c=this._radius,u="circle"===h;if(e.dontStart||t.beginPath(),l&&u)t.arc(0,0,c,0,2*Math.PI,!0);else{var d=u?c:c.width,p=u?c:c.height,f=this._size,g=f.width,m=f.height;if(l&&"rectangle"===h&&0===d&&0===p)t.rect(-g/2,-m/2,g,m);else{var v=g/2,_=m/2,y=.44771525016920644,x=d*y,b=p*y,w=[-v,-_+p,-v,-_+b,-v+x,-_,-v+d,-_,v-d,-_,v-x,-_,v,-_+b,v,-_+p,v,_-p,v,_-b,v-x,_,v-d,_,-v+d,_,-v+x,_,-v,_-b,-v,_-p];i&&i.transform(w,w,32),t.moveTo(w[0],w[1]),t.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),v!==d&&t.lineTo(w[8],w[9]),t.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),_!==p&&t.lineTo(w[16],w[17]),t.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),v!==d&&t.lineTo(w[24],w[25]),t.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}t.closePath()}o||!s&&!a||(this._setStyles(t,e,n),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var n=new g(this._size).setCenter(0,0),i=this._style,r=e.stroke&&i.hasStroke()&&i.getStrokeWidth();return t&&(n=t._transformBounds(n)),r?n.expand(D._getStrokePadding(r,this._getStrokeMatrix(t,e))):n}},new function(){function t(t,e,n){var i=t._radius;if(!i.isZero())for(var r=t._size.divide(2),s=1;s<=4;s++){var a=new u(s>1&&s<4?-1:1,s>2?-1:1),o=a.multiply(r),l=o.subtract(a.multiply(i));if(new g(n?o.add(a.multiply(n)):o,l).contains(e))return{point:l,quadrant:s}}}function e(t,e,n,i){var r=t.divide(e);return(!i||r.isInQuadrant(i))&&r.subtract(r.normalize()).multiply(e).divide(n).length<=1}return{_contains:function e(n){if("rectangle"===this._type){var i=t(this,n);return i?n.subtract(i.point).divide(this._radius).getLength()<=1:e.base.call(this,n)}return n.divide(this.size).getLength()<=.5},_hitTestSelf:function n(i,r,s,a){var o=!1,l=this._style,h=r.stroke&&l.hasStroke(),c=r.fill&&l.hasFill();if(h||c){var u=this._type,d=this._radius,p=h?l.getStrokeWidth()/2:0,f=r._tolerancePadding.add(D._getStrokePadding(p,!l.getStrokeScaling()&&a));if("rectangle"===u){var m=f.multiply(2),v=t(this,i,m);if(v)o=e(i.subtract(v.point),d,f,v.quadrant);else{var _=new g(this._size).setCenter(0,0),y=_.expand(m),x=_.expand(m.negate());o=y._containsPoint(i)&&!x._containsPoint(i)}}else o=e(i,d,f)}return o?new C(h?"stroke":"fill",this):n.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,n,i,s){var a=new S(r.getNamed(s),e);return a._type=t,a._size=n,a._radius=i,a}return{Circle:function(){var e=u.readNamed(arguments,"center"),n=r.readNamed(arguments,"radius");return t("circle",e,new p(2*n),n,arguments)},Rectangle:function(){var e=g.readNamed(arguments,"rectangle"),n=p.min(p.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),n,arguments)},Ellipse:function(){var e=S._readEllipse(arguments),n=e.radius;return t("ellipse",e.center,n.multiply(2),n,arguments)},_readEllipse:function(t){var e,n;if(r.hasNamed(t,"radius"))e=u.readNamed(t,"center"),n=p.readNamed(t,"radius");else{var i=g.readNamed(t,"rectangle");e=i.getCenter(!0),n=i.getSize(!0).divide(2)}return{center:e,radius:n}}}}}),M=x.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],initialize:function(t,n){if(!this._initialize(t,n!==e&&u.read(arguments,1))){var r="string"==typeof t?i.getElementById(t):t;r?this.setImage(r):this.setSource(t)}this._size||(this._size=new p,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,n=t._canvas;if(e)this._setImage(e);else if(n){var i=$.getCanvas(t._size);i.getContext("2d").drawImage(n,0,0),this._setImage(i)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new f(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=p.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage($.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&$.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new u(0,0).transform(t),n=new u(1,0).transform(t).subtract(e),i=new u(0,1).transform(t).subtract(e);return new p(72/n.getLength(),72/i.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var e=this;function n(t){var n=e.getView(),i=t&&t.type||"load";n&&e.responds(i)&&(paper=n._scope,e.emit(i,new Y(t)))}this._setImage(t),this._loaded?setTimeout(n,0):t&&V.add(t,{load:function(i){e._setImage(t),n(i)},error:n})},_setImage:function(t){this._canvas&&$.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new p(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=$.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){$.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var n=new t.Image,i=this._crossOrigin;i&&(n.crossOrigin=i),n.src=e,this.setImage(n)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=g.read(arguments),e=$.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=g.read(arguments),e=new M(x.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var n=this.getCanvas();return n?n.toDataURL.apply(n,arguments):null},drawImage:function(t){var e=u.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,n;if(t?t instanceof k?(n=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new g(t):"x"in t&&(e=new g(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var i=Math.min(e.width,32),s=Math.min(e.height,32),a=M._sampleContext;a?a.clearRect(0,0,33,33):a=M._sampleContext=$.getContext(new p(32)),a.save();var o=(new v).scale(i/e.width,s/e.height).translate(-e.x,-e.y);o.applyToContext(a),n&&n.draw(a,new r({clip:!0,matrices:[o]})),this._matrix.applyToContext(a);var l=this.getElement(),h=this._size;l&&a.drawImage(l,-h.width/2,-h.height/2),a.restore();for(var c=a.getImageData(.5,.5,Math.ceil(i),Math.ceil(s)).data,u=[0,0,0],d=0,f=0,m=c.length;f<m;f+=4){var _=c[f+3];d+=_,_/=255,u[0]+=c[f]*_,u[1]+=c[f+1]*_,u[2]+=c[f+2]*_}for(f=0;f<3;f++)u[f]/=d;return d?U.read(u):null},getPixel:function(){var t=u.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new U("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=u.read(arguments),e=U.read(arguments),n=e._convert("rgb"),i=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*n[0],a[1]=255*n[1],a[2]=255*n[2],a[3]=null!=i?255*i:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=p.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=g.read(arguments);return t.isEmpty()&&(t=new g(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=u.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var n=new g(this._size).setCenter(0,0);return t?t._transformBounds(n):n},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new C("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),T=x.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,n){this._initialize(t,n!==e&&u.read(arguments,1))||this.setDefinition(t instanceof E?t:new E(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var n=this._definition._item;return n._getCachedBounds(n._matrix.prepended(t),e)},_hitTestSelf:function(t,e,n){var i=this._definition._item._hitTest(t,e,n);return i&&(i.item=this),i},_draw:function(t,e){this._definition._item.draw(t,e)}}),E=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=c.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&x._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new u),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new T(this,t)},clone:function(){return new E(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),C=r.extend({_class:"HitResult",initialize:function(t,e,n){this.type=t,this.item=e,n&&this.inject(n)},statics:{getOptions:function(t){var e=t&&r.read(t);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),A=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,n,i,r,s,a){var o,l,h,c,u=arguments.length;u>0&&(null==t||"object"==typeof t?1===u&&t&&"point"in t?(o=t.point,l=t.handleIn,h=t.handleOut,c=t.selection):(o=t,l=n,h=i,c=r):(o=[t,n],l=i!==e?[i,r]:null,h=s!==e?[s,a]:null)),new R(o,this,"_point"),new R(l,this,"_handleIn"),new R(h,this,"_handleOut"),c&&this.setSelection(c)},_serialize:function(t,e){var n=this._point,i=this._selection,s=i||this.hasHandles()?[n,this._handleIn,this._handleOut]:n;return i&&s.push(i),r.serialize(s,t,!0,e)},_changed:function(t){var e=this._path;if(e){var n,i=e._curves,r=this._index;i&&(t&&t!==this._point&&t!==this._handleIn||!(n=r>0?i[r-1]:e._closed?i[i.length-1]:null)||n._changed(),t&&t!==this._point&&t!==this._handleOut||!(n=i[r])||n._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(u.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(u.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(u.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,n=this._path;this._selection=t=t||0,n&&t!==e&&(n._updateSelection(this,e,t),n._changed(129))},_changeSelection:function(t,e){var n=this._selection;this.setSelection(e?n|t:n&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new P(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,n,i){var r=t||{},s=r.type,a=r.factor,o=this.getPrevious(),l=this.getNext(),h=(o||this)._point,c=this._point,d=(l||this)._point,p=h.getDistance(c),f=c.getDistance(d);if(s&&"catmull-rom"!==s){if("geometric"!==s)throw new Error("Smoothing method '"+s+"' not supported.");if(o&&l){var g=h.subtract(d),m=a===e?.4:a,v=m*p/(p+f);n||this.setHandleIn(g.multiply(v)),i||this.setHandleOut(g.multiply(v-m))}}else{var _=a===e?.5:a,y=Math.pow(p,_),x=y*y,b=Math.pow(f,_),w=b*b;if(!n&&o){var S=2*w+3*b*y+x,M=3*b*(b+y);this.setHandleIn(0!==M?new u((w*h._x+S*c._x-x*d._x)/M-c._x,(w*h._y+S*c._y-x*d._y)/M-c._y):new u)}!i&&l&&(S=2*x+3*y*b+w,M=3*y*(y+b),this.setHandleOut(0!==M?new u((x*d._x+S*c._x-w*h._x)/M-c._x,(x*d._y+S*c._y-w*h._y)/M-c._y):new u))}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,n=t.clone();t.set(e),e.set(n)},reversed:function(){return new A(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new A(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,n){var i=1-n,r=n,s=t._point,a=e._point,o=t._handleIn,l=e._handleIn,h=e._handleOut,c=t._handleOut;this._point._set(i*s._x+r*a._x,i*s._y+r*a._y,!0),this._handleIn._set(i*o._x+r*l._x,i*o._y+r*l._y,!0),this._handleOut._set(i*c._x+r*h._x,i*c._y+r*h._y,!0),this._changed()},_transformCoordinates:function(t,e,n){var i=this._point,r=n&&this._handleIn.isZero()?null:this._handleIn,s=n&&this._handleOut.isZero()?null:this._handleOut,a=i._x,o=i._y,l=2;return e[0]=a,e[1]=o,r&&(e[l++]=r._x+a,e[l++]=r._y+o),s&&(e[l++]=s._x+a,e[l++]=s._y+o),t&&(t._transformCoordinates(e,e,l/2),a=e[0],o=e[1],n?(i._x=a,i._y=o,l=2,r&&(r._x=e[l++]-a,r._y=e[l++]-o),s&&(s._x=e[l++]-a,s._y=e[l++]-o)):(r||(e[l++]=a,e[l++]=o),s||(e[l++]=a,e[l++]=o))),e}}),R=u.extend({initialize:function(t,n,i){var r,s,a;if(t)if((r=t[0])!==e)s=t[1];else{var o=t;(r=o.x)===e&&(r=(o=u.read(arguments)).x),s=o.y,a=o.selected}else r=s=0;this._x=r,this._y=s,this._owner=n,n[i]=this,a&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=h.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),L=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,n,i,r,s,a,o){var l,h,c,u,d,p,f=arguments.length;3===f?(this._path=t,l=e,h=n):f?1===f?"segment1"in t?(l=new A(t.segment1),h=new A(t.segment2)):"point1"in t?(c=t.point1,d=t.handle1,p=t.handle2,u=t.point2):Array.isArray(t)&&(c=[t[0],t[1]],u=[t[6],t[7]],d=[t[2]-t[0],t[3]-t[1]],p=[t[4]-t[6],t[5]-t[7]]):2===f?(l=new A(t),h=new A(e)):4===f?(c=t,d=e,p=n,u=i):8===f&&(c=[t,e],u=[a,o],d=[n-t,i-e],p=[r-a,s-o]):(l=new A,h=new A),this._segment1=l||new A(c,null,d),this._segment2=h||new A(u,p,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new L(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return L.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,n=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(n)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(u.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(u.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(u.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(u.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return L.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],n=0;n<8;n+=2)e.push(new u(t[n],t[n+1]));return e}},{getLength:function(){return null==this._length&&(this._length=L.getLength(this.getValues(),0,1)),this._length},getArea:function(){return L.getArea(this.getValues())},getLine:function(){return new _(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new L(L.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return L.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var n=null;if(t>=1e-8&&t<=1-1e-8){var i=L.subdivide(this.getValues(),t),r=i[0],s=i[1],a=e||this.hasHandles(),o=this._segment1,l=this._segment2,h=this._path;a&&(o._handleOut._set(r[2]-r[0],r[3]-r[1]),l._handleIn._set(s[4]-s[6],s[5]-s[7]));var c=r[6],d=r[7],p=new A(new u(c,d),a&&new u(r[4]-c,r[5]-d),a&&new u(s[2]-c,s[3]-d));h?(h.insert(o._index+1,p),n=this.getNext()):(this._segment2=p,this._changed(),n=new L(p,l))}return n},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,n){return this.divideAtTime(t===e?.5:n?t:this.getTimeAt(t))},split:function(t,n){return this.splitAtTime(t===e?.5:n?t:this.getTimeAt(t))},reversed:function(){return new L(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,n,i){var r=t._point,s=t._handleOut,a=e._handleIn,o=e._point,l=r.x,h=r.y,c=o.x,u=o.y,d=i?[l,h,l,h,c,u,c,u]:[l,h,l+s._x,h+s._y,c+a._x,u+a._y,c,u];return n&&n._transformCoordinates(d,d,4),d},subdivide:function(t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7];n===e&&(n=.5);var u=1-n,d=u*i+n*s,p=u*r+n*a,f=u*s+n*o,g=u*a+n*l,m=u*o+n*h,v=u*l+n*c,_=u*d+n*f,y=u*p+n*g,x=u*f+n*m,b=u*g+n*v,w=u*_+n*x,S=u*y+n*b;return[[i,r,d,p,_,y,w,S],[w,S,x,b,m,v,h,c]]},getMonoCurves:function(t,e){var n=[],i=e?0:1,r=t[i+0],s=t[i+2],a=t[i+4],o=t[i+6];if(r>=s==s>=a&&s>=a==a>=o||L.isStraight(t))n.push(t);else{var l=3*(s-a)-r+o,c=2*(r+a)-4*s,u=s-r,d=[],p=h.solveQuadratic(l,c,u,d,1e-8,1-1e-8);if(p){d.sort();var f=d[0],g=L.subdivide(t,f);n.push(g[0]),p>1&&(f=(d[1]-f)/(1-f),g=L.subdivide(g[1],f),n.push(g[0])),n.push(g[1])}else n.push(t)}return n},solveCubic:function(t,e,n,i,r,s){var a=t[e],o=t[e+2],l=t[e+4],c=t[e+6],u=0;if(!(a<n&&c<n&&o<n&&l<n||a>n&&c>n&&o>n&&l>n)){var d=3*(o-a),p=3*(l-o)-d,f=c-a-d-p;u=h.solveCubic(f,p,d,a-n,i,r,s)}return u},getTimeOf:function(t,e){var n=new u(t[0],t[1]),i=new u(t[6],t[7]);if(null===(e.isClose(n,1e-12)?0:e.isClose(i,1e-12)?1:null))for(var r=[e.x,e.y],s=[],a=0;a<2;a++)for(var o=L.solveCubic(t,a,r[a],s,0,1),l=0;l<o;l++){var h=s[l];if(e.isClose(L.getPoint(t,h),1e-7))return h}return e.isClose(n,1e-7)?0:e.isClose(i,1e-7)?1:null},getNearestTime:function(t,e){if(L.isStraight(t)){var n=t[0],i=t[1],r=t[6]-n,s=t[7]-i,a=r*r+s*s;if(0===a)return 0;var o=((e.x-n)*r+(e.y-i)*s)/a;return o<1e-12?0:o>.999999999999?1:L.getTimeOf(t,new u(n+o*r,i+o*s))}var l=1/0,h=0;function c(n){if(n>=0&&n<=1){var i=e.getDistance(L.getPoint(t,n),!0);if(i<l)return l=i,h=n,!0}}for(var d=0;d<=100;d++)c(d/100);for(var p=.005;p>1e-8;)c(h-p)||c(h+p)||(p/=2);return h},getPart:function(t,e,n){var i=e>n;if(i){var r=e;e=n,n=r}return e>0&&(t=L.subdivide(t,e)[1]),n<1&&(t=L.subdivide(t,(n-e)/(1-e))[0]),i?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=3*r-2*n-l,u=3*s-2*i-h,d=3*a-2*l-n,p=3*o-2*h-i;return Math.max(c*c,d*d)+Math.max(u*u,p*p)<=16*e*e},getArea:function(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7];return 3*((l-n)*(i+s)-(o-e)*(r+a)+r*(e-s)-i*(n-a)+l*(s+e/3)-o*(a+n/3))/20},getBounds:function(t){for(var e=t.slice(0,2),n=e.slice(),i=[0,0],r=0;r<2;r++)L._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,n,i);return new g(e[0],e[1],n[0]-e[0],n[1]-e[1])},_addBounds:function(t,e,n,i,r,s,a,o,l){function c(t,e){var n=t-e,i=t+e;n<a[r]&&(a[r]=n),i>o[r]&&(o[r]=i)}s/=2;var u=a[r]-s,d=o[r]+s;if(t<u||e<u||n<u||i<u||t>d||e>d||n>d||i>d)if(e<t!=e<i&&n<t!=n<i)c(t,s),c(i,s);else{var p=3*(e-n)-t+i,f=2*(t+n)-4*e,g=e-t,m=h.solveQuadratic(p,f,g,l);c(i,0);for(var v=0;v<m;v++){var _=l[v],y=1-_;1e-8<=_&&_<=1-1e-8&&c(y*y*y*t+3*y*y*_*e+3*y*_*_*n+_*_*_*i,s)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=D[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,n,i){if(e.isZero()&&n.isZero())return!0;var r=i.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(n)){var s=new _(t,i);if(s.getDistance(t.add(e))<1e-7&&s.getDistance(i.add(n))<1e-7){var a=r.dot(r),o=r.dot(e)/a,l=r.dot(n)/a;return o>=0&&o<=1&&l<=0&&l>=-1}}return!1},isLinear:function(t,e,n,i){var r=i.subtract(t).divide(3);return e.equals(r)&&n.negate().equals(r)}},function(t,e){this[e]=function(e){var n=this._segment1,i=this._segment2;return t(n._point,n._handleOut,i._handleIn,i._point,e)},this.statics[e]=function(e,n){var i=e[0],r=e[1],s=e[6],a=e[7];return t(new u(i,r),new u(e[2]-i,e[3]-r),new u(e[4]-s,e[5]-a),new u(s,a),n)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new P(this,t):null},getTimeAt:function(t,e){return L.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(u.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return L.getTimeOf(this.getValues(),u.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=u.read(arguments),e=this.getValues(),n=L.getNearestTime(e,t),i=L.getPoint(e,n);return new P(this,n,i,null,t.getDistance(i))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,n){var i=this.getValues();return L[t](i,n?e:L.getTimeAt(i,e))},this[t+"AtTime"]=function(e){return L[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=9*(i-s)+3*(o-e),c=6*(e+s)-12*i,u=3*(i-e),d=9*(r-a)+3*(l-n),p=6*(n+a)-12*r,f=3*(r-n);return function(t){var e=(h*t+c)*t+u,n=(d*t+p)*t+f;return Math.sqrt(e*e+n*n)}}function n(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function i(t,e,n,i){if(null==e||e<0||e>1)return null;var r=t[0],s=t[1],a=t[2],o=t[3],l=t[4],c=t[5],d=t[6],p=t[7],f=h.isZero;f(a-r)&&f(o-s)&&(a=r,o=s),f(l-d)&&f(c-p)&&(l=d,c=p);var g,m,v=3*(a-r),_=3*(l-a)-v,y=d-r-v-_,x=3*(o-s),b=3*(c-o)-x,w=p-s-x-b;if(0===n)g=0===e?r:1===e?d:((y*e+_)*e+v)*e+r,m=0===e?s:1===e?p:((w*e+b)*e+x)*e+s;else{if(e<1e-8?(g=v,m=x):e>1-1e-8?(g=3*(d-l),m=3*(p-c)):(g=(3*y*e+2*_)*e+v,m=(3*w*e+2*b)*e+x),i){0===g&&0===m&&(e<1e-8||e>1-1e-8)&&(g=l-a,m=c-o);var S=Math.sqrt(g*g+m*m);S&&(g/=S,m/=S)}if(3===n){l=6*y*e+2*_,c=6*w*e+2*b;var M=Math.pow(g*g+m*m,1.5);g=0!==M?(g*c-m*l)/M:0,m=0}}return 2===n?new u(m,-g):new u(g,m)}return{statics:{classify:function(t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=r*(i-c)+s*(l-n)+n*c-i*l,d=3*(a*(s-i)+o*(n-r)+r*i-s*n),p=d-u,f=p-u+(n*(c-o)+i*(a-l)+l*o-c*a),g=Math.sqrt(f*f+p*p+d*d),m=0!==g?1/g:0,v=h.isZero;function _(t,n,i){var r=n!==e,s=r&&n>0&&n<1,a=r&&i>0&&i<1;return!r||(s||a)&&("loop"!==t||s&&a)||(t="arch",s=a=!1),{type:t,roots:s||a?s&&a?n<i?[n,i]:[i,n]:[s?n:i]:null}}if(p*=m,d*=m,v(f*=m))return v(p)?_(v(d)?"line":"quadratic"):_("serpentine",d/(3*p));var y=3*p*p-4*f*d;if(v(y))return _("cusp",p/(2*f));var x=y>0?Math.sqrt(y/3):Math.sqrt(-y),b=2*f;return _(y>0?"serpentine":"loop",(p+x)/b,(p-x)/b)},getLength:function(i,r,s,a){if(r===e&&(r=0),s===e&&(s=1),L.isStraight(i)){var o=i;s<1&&(o=L.subdivide(o,s)[0],r/=s),r>0&&(o=L.subdivide(o,r)[1]);var l=o[6]-o[0],c=o[7]-o[1];return Math.sqrt(l*l+c*c)}return h.integrate(a||t(i),r,s,n(r,s))},getTimeAt:function(i,r,s){if(s===e&&(s=r<0?1:0),0===r)return s;var a=Math.abs,o=r>0,l=o?s:0,c=o?1:s,u=t(i),d=L.getLength(i,l,c,u),p=a(r)-d;if(a(p)<1e-12)return o?c:l;if(p>1e-12)return null;var f=r/d,g=0;return h.findRoot(function(t){return g+=h.integrate(u,s,t,n(s,t)),s=t,g-r},u,s+f,l,c,32,1e-12)},getPoint:function(t,e){return i(t,e,0,!1)},getTangent:function(t,e){return i(t,e,1,!0)},getWeightedTangent:function(t,e){return i(t,e,1,!1)},getNormal:function(t,e){return i(t,e,2,!0)},getWeightedNormal:function(t,e){return i(t,e,2,!1)},getCurvature:function(t,e){return i(t,e,3,!1).x},getPeaks:function(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=3*i-e-3*s+t[6],l=3*e-6*i+3*s,c=-3*e+3*i,u=3*r-n-3*a+t[7],d=3*n-6*r+3*a,p=-3*n+3*r,f=[];return h.solveCubic(9*(o*o+u*u),9*(o*l+d*u),2*(l*l+d*d)+3*(c*o+p*u),c*l+d*p,f,1e-8,1-1e-8),f.sort()}}}},new function(){function t(t,e,n,i,r,s,a){var o=!a&&n.getPrevious()===r,l=!a&&n!==r&&n.getNext()===r;if(null!==i&&i>=(o?1e-8:0)&&i<=(l?1-1e-8:1)&&null!==s&&s>=(l?1e-8:0)&&s<=(o?1-1e-8:1)){var h=new P(n,i,null,a),c=new P(r,s,null,a);h._intersection=c,c._intersection=h,e&&!e(h)||P.insert(t,h,!0)}}function e(t,e,i,r){return t[0][1]<i?n(t,!0,i):e[0][1]>r?n(e,!1,r):t[0][0]}function n(t,e,n){for(var i=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],l=t[s][1];if(e?l>=n:l<=n)return l===n?o:i+(n-r)*(o-i)/(l-r);i=o,r=l}return null}function i(t,e,n,i,r){var s=h.isZero;if(s(i)&&s(r)){var a=L.getTimeOf(t,new u(e,n));return null===a?[]:[a]}for(var o=Math.atan2(-r,i),l=Math.sin(o),c=Math.cos(o),d=[],p=[],f=0;f<8;f+=2){var g=t[f]-e,m=t[f+1]-n;d.push(g*c-m*l,g*l+m*c)}return L.solveCubic(d,1,0,p,0,1),p}function r(n,r,s,o,l,h){var c=Math.min,d=Math.max;if(d(n[0],n[2],n[4],n[6])+1e-12>c(r[0],r[2],r[4],r[6])&&c(n[0],n[2],n[4],n[6])-1e-12<d(r[0],r[2],r[4],r[6])&&d(n[1],n[3],n[5],n[7])+1e-12>c(r[1],r[3],r[5],r[7])&&c(n[1],n[3],n[5],n[7])-1e-12<d(r[1],r[3],r[5],r[7])){var p=a(n,r);if(p)for(var f=0;f<2;f++){var g=p[f];t(l,h,s,g[0],o,g[1],!0)}else{var m=L.isStraight(n),v=L.isStraight(r),y=m&&v,x=m&&!v,b=l.length;if((y?function(e,n,i,r,s,a){var o=_.intersect(e[0],e[1],e[6],e[7],n[0],n[1],n[6],n[7]);o&&t(s,a,i,L.getTimeOf(e,o),r,L.getTimeOf(n,o))}:m||v?function(e,n,r,s,a,o,l){for(var h=n[0],c=n[1],u=i(e,h,c,n[6]-h,n[7]-c),d=0,p=u.length;d<p;d++){var f=u[d],g=L.getPoint(e,f),m=L.getTimeOf(n,g);null!==m&&t(a,o,l?s:r,l?m:f,l?r:s,l?f:m)}}:function n(i,r,s,a,o,l,h,c,u,d,p,f,g){if(++u>=4096||++c>=40)return u;var m,v,y=r[0],x=r[1],b=r[6],w=r[7],S=_.getSignedDistance,M=S(y,x,b,w,r[2],r[3]),T=S(y,x,b,w,r[4],r[5]),E=M*T>0?.75:4/9,C=E*Math.min(0,M,T),A=E*Math.max(0,M,T),R=S(y,x,b,w,i[0],i[1]),P=S(y,x,b,w,i[2],i[3]),k=S(y,x,b,w,i[4],i[5]),D=S(y,x,b,w,i[6],i[7]),I=function(t,e,n,i){var r,s=[0,R],a=[1/3,P],o=[2/3,k],l=[1,D],h=P-(2*R+D)/3,c=k-(R+2*D)/3;if(h*c<0)r=[[s,a,l],[s,o,l]];else{var u=h/c;r=[u>=2?[s,a,l]:u<=.5?[s,o,l]:[s,a,o,l],[s,l]]}return(h||c)<0?r.reverse():r}(),O=I[0],B=I[1];if(0===M&&0===T&&0===R&&0===P&&0===k&&0===D||null==(m=e(O,B,C,A))||null==(v=e(O.reverse(),B.reverse(),C,A)))return u;var F=d+(p-d)*m,N=d+(p-d)*v;if(Math.max(g-f,N-F)<1e-9){var U=(F+N)/2,z=(f+g)/2;t(o,l,h?a:s,h?z:U,h?s:a,h?U:z)}else if(i=L.getPart(i,m,v),v-m>.8){var G;if(N-F>g-f)U=(F+N)/2,u=n(r,(G=L.subdivide(i,.5))[0],a,s,o,l,!h,c,u,f,g,F,U),u=n(r,G[1],a,s,o,l,!h,c,u,f,g,U,N);else z=(f+g)/2,u=n((G=L.subdivide(r,.5))[0],i,a,s,o,l,!h,c,u,f,z,F,N),u=n(G[1],i,a,s,o,l,!h,c,u,z,g,F,N)}else u=g-f>=1e-9?n(r,i,a,s,o,l,!h,c,u,f,g,F,N):n(i,r,s,a,o,l,h,c,u,F,N,f,g);return u})(x?r:n,x?n:r,x?o:s,x?s:o,l,h,x,0,0,0,1,0,1),!y||l.length===b)for(f=0;f<4;f++){var w=f>>1,S=1&f,M=6*w,T=6*S,E=new u(n[M],n[M+1]),C=new u(r[T],r[T+1]);E.isClose(C,1e-12)&&t(l,h,s,w,o,S)}}}return l}function s(e,n,i,r){var s=L.classify(e);if("loop"===s.type){var a=s.roots;t(i,r,n,a[0],n,a[1])}return i}function a(t,e){function n(t){var e=t[6]-t[0],n=t[7]-t[1];return e*e+n*n}var i=Math.abs,r=_.getDistance,s=L.isStraight(t),a=L.isStraight(e),o=s&&a,l=n(t)<n(e),h=l?e:t,c=l?t:e,d=h[0],p=h[1],f=h[6]-d,g=h[7]-p;if(r(d,p,f,g,c[0],c[1],!0)<1e-7&&r(d,p,f,g,c[6],c[7],!0)<1e-7)!o&&r(d,p,f,g,h[2],h[3],!0)<1e-7&&r(d,p,f,g,h[4],h[5],!0)<1e-7&&r(d,p,f,g,c[2],c[3],!0)<1e-7&&r(d,p,f,g,c[4],c[5],!0)<1e-7&&(s=a=o=!0);else if(o)return null;if(s^a)return null;for(var m=[t,e],v=[],y=0;y<4&&v.length<2;y++){var x=1&y,b=1^x,w=y>>1,S=L.getTimeOf(m[x],new u(m[b][w?6:0],m[b][w?7:1]));if(null!=S){var M=x?[w,S]:[S,w];(!v.length||i(M[0]-v[0][0])>1e-8&&i(M[1]-v[0][1])>1e-8)&&v.push(M)}if(y>2&&!v.length)break}if(2!==v.length)v=null;else if(!o){var T=L.getPart(t,v[0][0],v[1][0]),E=L.getPart(e,v[0][1],v[1][1]);(i(E[2]-T[2])>1e-7||i(E[3]-T[3])>1e-7||i(E[4]-T[4])>1e-7||i(E[5]-T[5])>1e-7)&&(v=null)}return v}return{getIntersections:function(t){var e=this.getValues(),n=t&&t!==this&&t.getValues();return n?r(e,n,this,t,[]):s(e,this,[])},statics:{getOverlaps:a,getIntersections:function(t,e,n,i,a,o){var l=!e;l&&(e=t);for(var h,c,u=t.length,d=e.length,p=[],f=[],g=0;g<d;g++)p[g]=e[g].getValues(a);for(g=0;g<u;g++){var m=t[g],v=l?p[g]:m.getValues(i),_=m.getPath();_!==c&&(c=_,h=[],f.push(h)),l&&s(v,m,h,n);for(var y=l?g+1:0;y<d;y++){if(o&&h.length)return h;r(v,p[y],m,e[y],h,n)}}h=[],g=0;for(var x=f.length;g<x;g++)h.push.apply(h,f[g]);return h},getCurveLineIntersections:i}}}),P=r.extend({_class:"CurveLocation",initialize:function(t,e,n,i,r){if(e>=.99999999){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=n||t.getPointAtTime(e),this._overlap=i,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),n=this.getTime();0===n?t=e._segment1:1===n?t=e._segment2:null!=n&&(t=e.getPartLength(0,n)<e.getPartLength(n,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){var t=this._path,e=this;function n(t){var n=t&&t.getCurve();if(n&&null!=(e._time=n.getTimeOf(e._point)))return e._setCurve(n),n}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||n(this._segment)||n(this._segment1)||n(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),n=this.getIndex();if(e&&null!=n)for(var i=e.getCurves(),r=0;r<n;r++)t+=i[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),n=this.getTime();this._curveOffset=t=null!=n&&e&&e.getPartLength(0,n)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,n=t&&t.splitAtTime(this.getTime());return n&&this._setSegment(e.getLastSegment()),n},equals:function(t,e){var n=this===t;if(!n&&t instanceof P){var i=this.getCurve(),r=t.getCurve(),s=i._path;if(s===r._path){var a=Math.abs,o=a(this.getOffset()-t.getOffset()),l=!e&&this._intersection,h=!e&&t._intersection;n=(o<1e-7||s&&a(s.getLength()-o)<1e-7)&&(!l&&!h||l&&h&&l.equals(h,!0))}}return n},toString:function(){var t=[],e=this.getPoint(),n=l.instance;e&&t.push("point: "+e);var i=this.getIndex();null!=i&&t.push("index: "+i);var r=this.getTime();return null!=r&&t.push("time: "+n.number(r)),null!=this._distance&&t.push("distance: "+n.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),n=t.getCurve();return!(e.isStraight()&&n.isStraight()&&e.getLine().intersect(n.getLine()))}return!1},isCrossing:function(){var t=this._intersection;if(!t)return!1;var e=this.getTime(),n=t.getTime(),i=e>=1e-8&&e<=1-1e-8,r=n>=1e-8&&n<=1-1e-8;if(i&&r)return!this.isTouching();var s=this.getCurve(),a=e<1e-8?s.getPrevious():s,o=t.getCurve(),l=n<1e-8?o.getPrevious():o;if(e>1-1e-8&&(s=s.getNext()),n>1-1e-8&&(o=o.getNext()),!(a&&s&&l&&o))return!1;var h=[];function c(t,e){var n=t.getValues(),i=L.classify(n).roots||L.getPeaks(n),r=i.length,s=e&&r>1?i[r-1]:r>0?i[0]:.5;h.push(L.getLength(n,e?s:0,e?1:s)/2)}function u(t,e,n){return e<n?t>e&&t<n:t>e||t<n}i||(c(a,!0),c(s,!1)),r||(c(l,!0),c(o,!1));var d=this.getPoint(),p=Math.min.apply(Math,h),f=i?s.getTangentAtTime(e):s.getPointAt(p).subtract(d),g=i?f.negate():a.getPointAt(-p).subtract(d),m=r?o.getTangentAtTime(n):o.getPointAt(p).subtract(d),v=r?m.negate():l.getPointAt(-p).subtract(d),_=g.getAngle(),y=f.getAngle(),x=v.getAngle(),b=m.getAngle();return!!(i?u(_,x,b)^u(y,x,b)&&u(_,b,x)^u(y,b,x):u(x,_,y)^u(b,_,y)&&u(x,y,_)^u(b,y,_))},hasOverlap:function(){return!!this._overlap}},r.each(L._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),n=this.getTime();return null!=n&&t&&t[e](n,!0)}},{preserve:!0}),new function(){function t(t,e,n){var i=t.length,r=0,s=i-1;function a(n,r){for(var s=n+r;s>=-1&&s<=i;s+=r){var a=t[(s%i+i)%i];if(!e.getPoint().isClose(a.getPoint(),1e-7))break;if(e.equals(a))return a}return null}for(;r<=s;){var o,l=r+s>>>1,h=t[l];if(n&&(o=e.equals(h)?h:a(l,-1)||a(l,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var c=e.getPath(),u=h.getPath();(c!==u?c._id-u._id:e.getIndex()+e.getTime()-(h.getIndex()+h.getTime()))<0?s=l-1:r=l+1}return t.splice(r,0,e),e}return{statics:{insert:t,expand:function(e){for(var n=e.slice(),i=e.length-1;i>=0;i--)t(n,e[i]._intersection,!1);return n}}}}),k=x.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,n,i;if(r.isPlainObject(t)?(n=t.segments,e=t.pathData):Array.isArray(t)?n=t:"string"==typeof t&&(e=t),n){var s=n[0];i=s&&Array.isArray(s[0])}else e&&(i=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(i?I:D)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var e,n,i,r=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),s=!1,a=new u,o=new u;function l(t,n){var i=+e[t];return s&&(i+=a[n]),i}function h(t){return new u(l(t,"x"),l(t+1,"y"))}this.clear();for(var c=0,d=r&&r.length;c<d;c++){var f=r[c],g=f[0],m=g.toLowerCase(),v=(e=f.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&e.length;switch(s=g===m,"z"!==n||/[mz]/.test(m)||this.moveTo(a),m){case"m":case"l":for(var _="m"===m,y=0;y<v;y+=2)this[_?"moveTo":"lineTo"](a=h(y)),_&&(o=a,_=!1);i=a;break;case"h":case"v":var x="h"===m?"x":"y";for(a=a.clone(),y=0;y<v;y++)a[x]=l(y,x),this.lineTo(a);i=a;break;case"c":for(y=0;y<v;y+=6)this.cubicCurveTo(h(y),i=h(y+2),a=h(y+4));break;case"s":for(y=0;y<v;y+=4)this.cubicCurveTo(/[cs]/.test(n)?a.multiply(2).subtract(i):a,i=h(y),a=h(y+2)),n=m;break;case"q":for(y=0;y<v;y+=4)this.quadraticCurveTo(i=h(y),a=h(y+2));break;case"t":for(y=0;y<v;y+=2)this.quadraticCurveTo(i=/[qt]/.test(n)?a.multiply(2).subtract(i):a,a=h(y)),n=m;break;case"a":for(y=0;y<v;y+=7)this.arcTo(a=h(y+5),new p(+e[y],+e[y+1]),+e[y+2],+e[y+4],+e[y+3]);break;case"z":this.closePath(1e-12),a=o}n=m}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,n,i){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(n||t._matrix)._orNullIfIdentity();return r||this.getBounds(s).intersects(t.getBounds(a),1e-12)?L.getIntersections(this.getCurves(),!r&&t.getCurves(),e,s,a,i):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=u.read(arguments),e=this.getCurves(),n=1/0,i=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);a._distance<n&&(n=a._distance,i=a)}return i},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,n){var i=!this._children,r=i?"_segments":"_children",s=t[r],a=e[r],o=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var l=o.length,h=a.length;if(l<h)for(var c=i?A:D,u=l;u<h;u++)this.add(new c);else l>h&&this[i?"removeSegments":"removeChildren"](h,l);for(u=0;u<h;u++)o[u].interpolate(s[u],a[u],n);i&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var n=this._children||[this],i=t._children?t._children.slice():[t],r=n.length,s=i.length,a=[],o=0;e=!0;for(var l=r-1;l>=0&&e;l--){var h=n[l];e=!1;for(var c=s-1;c>=0&&!e;c--)h.compare(i[c])&&(a[c]||(a[c]=!0,o++),e=!0)}e=e&&o===s}return e}}),D=k.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var n=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;n&&n.length>0?this.setSegments(n):(this._curves=e,this._segmentSelection=0,n||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!n&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(n){if(t.base.call(this,n),8&n){if(this._length=this._area=e,16&n)this._version++;else if(this._curves)for(var i=0,r=this._curves.length;i<r;i++)this._curves[i]._changed()}else 32&n&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof I?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var n=this.isFullySelected(),i=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,i){var r=t[i-1];"boolean"==typeof r&&(this.setClosed(r),i--),this._add(A.readList(t,0,{},i))}n&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var n=this._countCurves();t=this._curves=new Array(n);for(var i=0;i<n;i++)t[i]=new L(this,e[i],e[i+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new L(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){var n,i,r,s,a,o,h,c,u=this._segments,d=u.length,p=new l(e),f=new Array(6),g=!0,m=[];function v(e,l){if(e._transformCoordinates(t,f),n=f[0],i=f[1],g)m.push("M"+p.pair(n,i)),g=!1;else if(a=f[2],o=f[3],a===n&&o===i&&h===r&&c===s){if(!l){var u=n-r,d=i-s;m.push(0===u?"v"+p.number(d):0===d?"h"+p.number(u):"l"+p.pair(u,d))}}else m.push("c"+p.pair(h-r,c-s)+" "+p.pair(a-r,o-s)+" "+p.pair(n-r,i-s));r=n,s=i,h=f[4],c=f[5]}if(!d)return"";for(var _=0;_<d;_++)v(u[_]);return this._closed&&d>0&&(v(u[0],!0),m.push("z")),m.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,n=new Array(6),i=0,r=e.length;i<r;i++)e[i]._transformCoordinates(t,n,!0);return!0},_add:function(t,e){for(var n=this._segments,i=this._curves,r=t.length,s=null==e,a=(e=s?n.length:e,0);a<r;a++){var o=t[a];o._path&&(o=t[a]=o.clone()),o._path=this,o._index=e+a,o._selection&&this._updateSelection(o,0,o._selection)}if(s)n.push.apply(n,t);else{n.splice.apply(n,[e,0].concat(t)),a=e+r;for(var l=n.length;a<l;a++)n[a]._index=a}if(i){var h=this._countCurves(),c=e>0&&e+r-1===h?e-1:e,u=c,d=Math.min(c+r,h);for(t._curves&&(i.splice.apply(i,[c,0].concat(t._curves)),u+=t._curves.length),a=u;a<d;a++)i.splice(a,0,new L(this,null,null));this._adjustCurves(c,d)}return this._changed(25),t},_adjustCurves:function(t,e){for(var n,i=this._segments,r=this._curves,s=t;s<e;s++)(n=r[s])._path=this,n._segment1=i[s],n._segment2=i[s+1]||i[0],n._changed();(n=r[this._closed&&!t?i.length-1:t-1])&&(n._segment2=i[t]||i[0],n._changed()),(n=r[e])&&(n._segment1=i[e],n._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(A.readList(arguments)):this._add([A.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(A.readList(arguments,1),t):this._add([A.read(arguments,1)],t)[0]},addSegment:function(){return this._add([A.read(arguments)])[0]},insertSegment:function(t){return this._add([A.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(A.readList(t))},insertSegments:function(t,e){return this._add(A.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,n){t=t||0,e=r.pick(e,this._segments.length);var i=this._segments,s=this._curves,a=i.length,o=i.splice(t,e-t),l=o.length;if(!l)return o;for(var h=0;h<l;h++){var c=o[h];c._selection&&this._updateSelection(c,c._selection,0),c._index=c._path=null}h=t;for(var u=i.length;h<u;h++)i[h]._index=h;if(s){var d=t>0&&e===a+(this._closed?1:0)?t-1:t;for(h=(s=s.splice(d,l)).length-1;h>=0;h--)s[h]._path=null;n&&(o._curves=s.slice(1)),this._adjustCurves(d,d)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,n=t.length;e<n;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,n=t.length;e<n;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,n=0,i=t.length;n<i;n++)e+=t[n].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,n=this._closed;t=0;for(var i=0,r=e.length;i<r;i++){var s=i+1===r;t+=L.getArea(L.getValues(e[i],e[s?0:i+1],null,s&&!n))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,n=e.length,i=t?7:0;this._segmentSelection=i*n;for(var r=0;r<n;r++)e[r]._selection=i},_updateSelection:function(t,e,n){t._selection=n,(this._segmentSelection+=n-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,n=this.getLocationAt(t);return n&&(e=n.getCurve().divideAt(n.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),n=e&&e.index,i=e&&e.time;i>1-1e-8&&(n++,i=0);var r=this.getCurves();if(n>=0&&n<r.length){i>=1e-8&&r[n++].divideAtTime(i);var s,a=this.removeSegments(n,this._segments.length,!0);return this._closed?(this.setClosed(!1),s=this):((s=new D(x.NO_INSERT)).insertAbove(this),s.copyAttributes(this)),s._add(a,0),this.addSegment(a[0]),s}return null},split:function(t,n){var i,r=n===e?t:(i=this.getCurves()[t])&&i.getLocationAtTime(n);return null!=r?this.splitAt(r):null},join:function(t,e){var n=e||0;if(t&&t!==this){var i=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,n)&&t.reverse();var a=t.getFirstSegment();if(r&&r._point.isClose(a._point,n))r.setHandleOut(a._handleOut),this._add(i.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(a._point,n)&&t.reverse(),s=t.getLastSegment(),o&&o._point.isClose(s._point,n)?(o.setHandleIn(s._handleIn),this._add(i.slice(0,i.length-1),0)):this._add(i.slice())}t._closed&&this._add([i[0]]),t.remove()}var l=this.getFirstSegment(),h=this.getLastSegment();return l!==h&&l._point.isClose(h._point,n)&&(l.setHandleIn(h._handleIn),h.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),n=t&&t.simplify,i=n?1e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(!s.hasLength(i)||n&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var n=this._segments[t],i=n._handleIn;n._handleIn=n._handleOut,n._handleOut=i,n._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new O(this,t||.25,256,!0).parts,n=e.length,i=[],r=0;r<n;r++)i.push(new A(e[r].curve.slice(0,2)));!this._closed&&n>0&&i.push(new A(e[n-1].curve.slice(6))),this.setSegments(i)},simplify:function(t){var e=new B(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){var n=this,i=t||{},r=i.type||"asymmetric",s=this._segments,a=s.length,o=this._closed;function l(t,e){var i=t&&t.index;if(null!=i){var r=t.path;if(r&&r!==n)throw new Error(t._class+" "+i+" of "+r+" is not part of "+n);e&&t instanceof L&&i++}else i="number"==typeof t?t:e;return Math.min(i<0&&o?i%a:i<0?i+a:i,a-1)}var h=o&&i.from===e&&i.to===e,c=l(i.from,0),u=l(i.to,a-1);if(c>u)if(o)c-=a;else{var d=c;c=u,u=d}if(/^(?:asymmetric|continuous)$/.test(r)){var p="asymmetric"===r,f=Math.min,g=u-c+1,m=g-1,v=h?f(g,4):1,_=v,y=v,x=[];if(o||(_=f(1,c),y=f(1,a-u-1)),(m+=_+y)<=1)return;for(var b=0,w=c-_;b<=m;b++,w++)x[b]=s[(w<0?w+a:w)%a]._point;var S=x[0]._x+2*x[1]._x,M=x[0]._y+2*x[1]._y,T=2,E=m-1,C=[S],A=[M],R=[T],P=[],k=[];for(b=1;b<m;b++){var D=b<E,I=D?4:p?2:7,O=D?4:p?3:8,B=D?2:p?0:1,F=(D?1:p?1:2)/T;T=R[b]=I-F,S=C[b]=O*x[b]._x+B*x[b+1]._x-F*S,M=A[b]=O*x[b]._y+B*x[b+1]._y-F*M}for(P[E]=C[E]/R[E],k[E]=A[E]/R[E],b=m-2;b>=0;b--)P[b]=(C[b]-P[b+1])/R[b],k[b]=(A[b]-k[b+1])/R[b];P[m]=(3*x[m]._x-P[E])/2,k[m]=(3*x[m]._y-k[E])/2,b=_;var N=m-y;for(w=c;b<=N;b++,w++){var U=s[w<0?w+a:w],z=U._point,G=P[b]-z._x,H=k[b]-z._y;(h||b<N)&&U.setHandleOut(G,H),(h||b>_)&&U.setHandleIn(-G,-H)}}else for(b=c;b<=u;b++)s[b<0?b+a:b].smooth(i,!h&&b===c,!h&&b===u)},toShape:function(t){if(!this._closed)return null;var n,i,r,s,a,o,l,c=this._segments;function u(t,e){var n=c[t],i=n.getNext(),r=c[e],s=r.getNext();return n._handleOut.isZero()&&i._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&i._point.subtract(n._point).isCollinear(s._point.subtract(r._point))}function d(t){var e=c[t],n=e.getNext(),i=e._handleOut,r=n._handleIn;if(i.isOrthogonal(r)){var s=e._point,a=n._point,o=new _(s,i,!0).intersect(new _(a,r,!0),!0);return o&&h.isZero(i.getLength()/o.subtract(s).getLength()-.5522847498307936)&&h.isZero(r.getLength()/o.subtract(a).getLength()-.5522847498307936)}return!1}function f(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this.hasHandles()&&4===c.length&&u(0,2)&&u(1,3)&&(o=(a=c[1]).getPrevious(),l=a.getNext(),o._handleOut.isZero()&&a._handleIn.isZero()&&a._handleOut.isZero()&&l._handleIn.isZero()&&a._point.subtract(o._point).isOrthogonal(l._point.subtract(a._point)))?(n=S.Rectangle,i=new p(f(0,3),f(0,1)),s=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&d(0)&&d(2)&&d(4)&&d(6)&&u(1,5)&&u(3,7)?(n=S.Rectangle,r=(i=new p(f(1,6),f(0,3))).subtract(new p(f(0,7),f(1,2))).divide(2),s=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&d(0)&&d(1)&&d(2)&&d(3)&&(h.isZero(f(0,2)-f(1,3))?(n=S.Circle,r=f(0,2)/2):(n=S.Ellipse,r=new p(f(2,0)/2,f(3,1)/2)),s=c[1]._point),n){var g=this.getPosition(!0),m=new n({center:g,size:i,radius:r,insert:!1});return m.copyAttributes(this,!0),m._matrix.prepend(this._matrix),m.rotate(s.subtract(g).getAngle()+90),(t===e||t)&&m.insertAbove(this),m}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof I)return t.base.call(this,e);var n=this.getCurves(),i=e.getCurves(),r=n.length,s=i.length;if(!r||!s)return r==s;for(var a,o,l=n[0].getValues(),h=[],c=0,u=0,d=0;d<s;d++){var p=i[d].getValues();if(h.push(p),m=L.getOverlaps(l,p)){a=!d&&m[0][0]>0?s-1:d,o=m[0][1];break}}var f,g=Math.abs;for(p=h[a];l&&p;){var m;if((m=L.getOverlaps(l,p))&&g(m[0][0]-u)<1e-8){1===(u=m[1][0])&&(l=++c<r?n[c].getValues():null,u=0);var v=m[0][1];if(g(v-o)<1e-8){if(f||(f=[a,v]),1===(o=m[1][1])&&(++a>=s&&(a=0),p=h[a]||i[a].getValues(),o=0),!l)return f[0]===a&&f[1]===o;continue}}break}return!1},_hitTestSelf:function(t,e,n,i){var r,s,a,o,l,h,c=this,u=this.getStyle(),d=this._segments,p=d.length,f=this._closed,g=e._tolerancePadding,m=g,v=e.stroke&&u.hasStroke(),_=e.fill&&u.hasFill(),y=e.curves,x=v?u.getStrokeWidth()/2:_&&e.tolerance>0||y?0:null;function b(e,n){return t.subtract(e).divide(n).length<=1}function w(t,n,i){if(!e.selected||n.isSelected()){var r=t._point;if(n!==r&&(n=n.add(r)),b(n,m))return new C(i,c,{segment:t,point:n})}}function S(t,n){return(n||e.segments)&&w(t,t._point,"segment")||!n&&e.handles&&(w(t,t._handleIn,"handle-in")||w(t,t._handleOut,"handle-out"))}function M(t){o.add(t)}function T(e){var n,l=f||e._index>0&&e._index<p-1;return"round"===(l?r:s)?b(e._point,m):(o=new D({internal:!0,closed:!0}),l?e.isSmooth()||D._addBevelJoin(e,r,x,a,null,i,M,!0):"square"===s&&D._addSquareCap(e,s,x,null,i,M,!0),o.isEmpty()?void 0:o.contains(t)||(n=o.getNearestLocation(t))&&b(n.getPoint(),g))}if(null!==x&&(x>0?(r=u.getStrokeJoin(),s=u.getStrokeCap(),a=u.getMiterLimit(),m=m.add(D._getStrokePadding(x,i))):r=s="round"),!e.ends||e.segments||f){if(e.segments||e.handles)for(var E=0;E<p;E++)if(h=S(d[E]))return h}else if(h=S(d[0],!0)||S(d[p-1],!0))return h;if(null!==x){if(l=this.getNearestLocation(t)){var A=l.getTime();0===A||1===A&&p>1?T(l.getSegment())||(l=null):b(l.getPoint(),m)||(l=null)}if(!l&&"miter"===r&&p>1)for(E=0;E<p;E++){var R=d[E];if(t.getDistance(R._point)<=a*x&&T(R)){l=R.getLocation();break}}}return!l&&_&&this._contains(t)||l&&!v&&!y?new C("fill",this):l?new C(v?"stroke":"curve",this,{location:l,point:l.getPoint()}):null}},r.each(L._evaluateMethods,function(t){this[t+"At"]=function(e){var n=this.getLocationAt(e);return n&&n[t]()}},{beans:!1,getLocationOf:function(){for(var t=u.read(arguments),e=this.getCurves(),n=0,i=e.length;n<i;n++){var r=e[n].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),n=0,i=0,r=e.length;i<r;i++){var s=n,a=e[i];if((n+=a.getLength())>t)return a.getLocationAt(t-s)}if(e.length>0&&t<=this.getLength())return new P(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null}}),new function(){function t(t,e,n){var i,r,s,a,o,l,h,c,u=e._segments,d=u.length,p=new Array(6),f=!0;function g(e){if(n)e._transformCoordinates(n,p),i=p[0],r=p[1];else{var u=e._point;i=u._x,r=u._y}if(f)t.moveTo(i,r),f=!1;else{if(n)o=p[2],l=p[3];else{var d=e._handleIn;o=i+d._x,l=r+d._y}o===i&&l===r&&h===s&&c===a?t.lineTo(i,r):t.bezierCurveTo(h,c,o,l,i,r)}s=i,a=r,n?(h=p[4],c=p[5]):(d=e._handleOut,h=s+d._x,c=a+d._y)}for(var m=0;m<d;m++)g(u[m]);e._closed&&d>0&&g(u[0])}return{_draw:function(e,n,i,r){var s=n.dontStart,a=n.dontFinish||n.clip,o=this.getStyle(),l=o.hasFill(),h=o.hasStroke(),c=o.getDashArray(),u=!paper.support.nativeDash&&h&&c&&c.length;function d(t){return c[(t%u+u)%u]}if(s||e.beginPath(),(l||h&&!u||a)&&(t(e,this,r),this._closed&&e.closePath()),!a&&(l||h)&&(this._setStyles(e,n,i),l&&(e.fill(o.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),h)){if(u){s||e.beginPath();var p,f=new O(this,.25,32,!1,r),g=f.length,m=-o.getDashOffset(),v=0;for(m%=g;m>0;)m-=d(v--)+d(v--);for(;m<g;)p=m+d(v++),(m>0||p>0)&&f.drawPart(e,Math.max(m,0),Math.max(p,0)),m=p+d(v++)}e.stroke()}},_drawSelected:function(e,n){e.beginPath(),t(e,this,n),e.stroke(),function(t,e,n,i){var r,s,a=i/2,o=new Array(6);function l(e){var n=o[e],i=o[e+1];r==n&&s==i||(t.beginPath(),t.moveTo(r,s),t.lineTo(n,i),t.stroke(),t.beginPath(),t.arc(n,i,a,0,2*Math.PI,!0),t.fill())}for(var h=0,c=e.length;h<c;h++){var u=e[h],d=u._selection;if(u._transformCoordinates(n,o),r=o[0],s=o[1],2&d&&l(2),4&d&&l(4),t.fillRect(r-a,s-a,i,i),!(1&d)){var p=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(r-a+1,s-a+1,i-2,i-2),t.fillStyle=p}}}(e,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new A(u.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new A(u.read(arguments))])},cubicCurveTo:function(){var e=u.read(arguments),n=u.read(arguments),i=u.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new A(i,n.subtract(i))])},quadraticCurveTo:function(){var e=u.read(arguments),n=u.read(arguments),i=t(this)._point;this.cubicCurveTo(e.add(i.subtract(e).multiply(1/3)),e.add(n.subtract(e).multiply(1/3)),n)},curveTo:function(){var e=u.read(arguments),n=u.read(arguments),i=r.pick(r.read(arguments),.5),s=1-i,a=t(this)._point,o=e.subtract(a.multiply(s*s)).subtract(n.multiply(i*i)).divide(2*i*s);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+i);this.quadraticCurveTo(o,n)},arcTo:function(){var e,n,i,s,a=Math.abs,o=Math.sqrt,l=t(this),c=l._point,d=u.read(arguments),f=r.peek(arguments);if("boolean"==typeof(b=r.pick(f,!0)))var g=(S=c.add(d).divide(2)).add(S.subtract(c).rotate(b?-90:90));else if(r.remain(arguments)<=2)g=d,d=u.read(arguments);else{var m=p.read(arguments),y=h.isZero;if(y(m.width)||y(m.height))return this.lineTo(d);var x=r.read(arguments),b=!!r.read(arguments),w=!!r.read(arguments),S=c.add(d).divide(2),M=(X=c.subtract(S).rotate(-x)).x,T=X.y,E=a(m.width),C=a(m.height),R=E*E,L=C*C,P=M*M,k=T*T,D=o(P/R+k/L);if(D>1&&(R=(E*=D)*E,L=(C*=D)*C),a(D=(R*L-R*k-L*P)/(R*k+L*P))<1e-12&&(D=0),D<0)throw new Error("Cannot create an arc with the given arguments");e=new u(E*T/C,-C*M/E).multiply((w===b?-1:1)*o(D)).rotate(x).add(S),n=(i=(s=(new v).translate(e).rotate(x).scale(E,C))._inverseTransform(c)).getDirectedAngle(s._inverseTransform(d)),!b&&n>0?n-=360:b&&n<0&&(n+=360)}if(g){var I=new _(c.add(g).divide(2),g.subtract(c).rotate(90),!0),O=new _(g.add(d).divide(2),d.subtract(g).rotate(90),!0),B=new _(c,d),F=B.getSide(g);if(!(e=I.intersect(O,!0))){if(!F)return this.lineTo(d);throw new Error("Cannot create an arc with the given arguments")}n=(i=c.subtract(e)).getDirectedAngle(d.subtract(e));var N=B.getSide(e);0===N?n=F*a(n):F===N&&(n+=n<0?360:-360)}for(var U=a(n),z=U>=360?4:Math.ceil((U-1e-7)/90),G=n/z,H=G*Math.PI/360,W=4/3*Math.sin(H)/(1+Math.cos(H)),V=[],j=0;j<=z;j++){var X=d,Y=null;if(j<z&&(Y=i.rotate(90).multiply(W),s?(X=s._transformPoint(i),Y=s._transformPoint(i.add(Y)).subtract(X)):X=e.add(i)),j){var Z=i.rotate(-90).multiply(W);s&&(Z=s._transformPoint(i.add(Z)).subtract(X)),V.push(new A(X,Z,Y))}else l.setHandleOut(Y);i=i.rotate(G)}this._add(V)},lineBy:function(){var e=u.read(arguments),n=t(this)._point;this.lineTo(n.add(e))},curveBy:function(){var e=u.read(arguments),n=u.read(arguments),i=r.read(arguments),s=t(this)._point;this.curveTo(s.add(e),s.add(n),i)},cubicCurveBy:function(){var e=u.read(arguments),n=u.read(arguments),i=u.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(n),r.add(i))},quadraticCurveBy:function(){var e=u.read(arguments),n=u.read(arguments),i=t(this)._point;this.quadraticCurveTo(i.add(e),i.add(n))},arcBy:function(){var e=t(this)._point,n=e.add(u.read(arguments)),i=r.pick(r.peek(arguments),!0);"boolean"==typeof i?this.arcTo(n,i):this.arcTo(n,e.add(u.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var n=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return D[n](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,n,i,r,s){var a=t[0];if(!a)return new g;var o=new Array(6),l=a._transformCoordinates(i,new Array(6)),h=l.slice(0,2),c=h.slice(),u=new Array(2);function d(t){t._transformCoordinates(i,o);for(var e=0;e<2;e++)L._addBounds(l[e],l[e+4],o[e+2],o[e],e,s?s[e]:0,h,c,u);var n=l;l=o,o=n}for(var p=1,f=t.length;p<f;p++)d(t[p]);return e&&d(a),new g(h[0],h[1],c[0]-h[0],c[1]-h[1])},getStrokeBounds:function(t,e,n,i,r){var s=n.getStyle(),a=s.hasStroke(),o=s.getStrokeWidth(),l=a&&n._getStrokeMatrix(i,r),h=a&&D._getStrokePadding(o,l),c=D.getBounds(t,e,n,i,r,h);if(!a)return c;var u=o/2,d=s.getStrokeJoin(),f=s.getStrokeCap(),m=s.getMiterLimit(),v=new g(new p(h));function _(t){c=c.include(t)}function y(t){c=c.unite(v.setCenter(t._point.transform(i)))}function x(t,e){"round"===e||t.isSmooth()?y(t):D._addBevelJoin(t,e,u,m,i,l,_)}function b(t,e){"round"===e?y(t):D._addSquareCap(t,e,u,i,l,_)}for(var w=t.length-(e?0:1),S=1;S<w;S++)x(t[S],d);return e?x(t[0],d):w>0&&(b(t[0],f),b(t[t.length-1],f)),c},_getStrokePadding:function(t,e){if(!e)return[t,t];var n=new u(t,0).transform(e),i=new u(0,t).transform(e),r=n.getAngleInRadians(),s=n.getLength(),a=i.getLength(),o=Math.sin(r),l=Math.cos(r),h=Math.tan(r),c=Math.atan2(a*h,s),d=Math.atan2(a,h*s);return[Math.abs(s*Math.cos(c)*l+a*Math.sin(c)*o),Math.abs(a*Math.sin(d)*l+s*Math.cos(d)*o)]},_addBevelJoin:function(t,e,n,i,r,s,a,o){var l=t.getCurve(),h=l.getPrevious(),c=l.getPoint1().transform(r),d=h.getNormalAtTime(1).multiply(n).transform(s),p=l.getNormalAtTime(0).multiply(n).transform(s);if(d.getDirectedAngle(p)<0&&(d=d.negate(),p=p.negate()),o&&a(c),a(c.add(d)),"miter"===e){var f=new _(c.add(d),new u(-d.y,d.x),!0).intersect(new _(c.add(p),new u(-p.y,p.x),!0),!0);f&&c.getDistance(f)<=i*n&&a(f)}a(c.add(p))},_addSquareCap:function(t,e,n,i,r,s,a){var o=t._point.transform(i),l=t.getLocation(),h=l.getNormal().multiply(0===l.getTime()?n:-n).transform(r);"square"===e&&(a&&(s(o.subtract(h)),s(o.add(h))),o=o.add(h.rotate(-90))),s(o.add(h)),s(o.subtract(h))},getHandleBounds:function(t,e,n,i,r){var s,a,o=n.getStyle();if(r.stroke&&o.hasStroke()){var l=n._getStrokeMatrix(i,r),h=o.getStrokeWidth()/2,c=h;"miter"===o.getStrokeJoin()&&(c=h*o.getMiterLimit()),"square"===o.getStrokeCap()&&(c=Math.max(c,h*Math.SQRT2)),s=D._getStrokePadding(h,l),a=D._getStrokePadding(c,l)}for(var u=new Array(6),d=1/0,p=-d,f=d,m=p,v=0,_=t.length;v<_;v++){t[v]._transformCoordinates(i,u);for(var y=0;y<6;y+=2){var x=y?s:a,b=x?x[0]:0,w=x?x[1]:0,S=u[y],M=u[y+1],T=S-b,E=S+b,C=M-w,A=M+w;T<d&&(d=T),E>p&&(p=E),C<f&&(f=C),A>m&&(m=A)}}return new g(d,f,p-d,m-f)}}});D.inject({statics:new function(){var t=.5522847498307936,e=[new A([-1,0],[0,t],[0,-t]),new A([0,-1],[-t,0],[t,0]),new A([1,0],[0,-t],[0,t]),new A([0,1],[t,0],[-t,0])];function n(t,e,n){var i=r.getNamed(n),s=new D(i&&0==i.insert&&x.NO_INSERT);return s._add(t),s._closed=e,s.set(i,{insert:!0})}function i(t,i,r){for(var s=new Array(4),a=0;a<4;a++){var o=e[a];s[a]=new A(o._point.multiply(i).add(t),o._handleIn.multiply(i),o._handleOut.multiply(i))}return n(s,!0,r)}return{Line:function(){return n([new A(u.readNamed(arguments,"from")),new A(u.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=u.readNamed(arguments,"center"),e=r.readNamed(arguments,"radius");return i(t,new p(e),arguments)},Rectangle:function(){var e,i=g.readNamed(arguments,"rectangle"),r=p.readNamed(arguments,"radius",0,{readNull:!0}),s=i.getBottomLeft(!0),a=i.getTopLeft(!0),o=i.getTopRight(!0),l=i.getBottomRight(!0);if(!r||r.isZero())e=[new A(s),new A(a),new A(o),new A(l)];else{var h=(r=p.min(r,i.getSize(!0).divide(2))).width,c=r.height,u=h*t,d=c*t;e=[new A(s.add(h,0),null,[-u,0]),new A(s.subtract(0,c),[0,d]),new A(a.add(0,c),null,[0,-d]),new A(a.add(h,0),[-u,0],null),new A(o.subtract(h,0),null,[u,0]),new A(o.add(0,c),[0,-d],null),new A(l.subtract(0,c),null,[0,d]),new A(l.subtract(h,0),[u,0])]}return n(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=S._readEllipse(arguments);return i(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=u.readNamed(arguments,"from"),e=u.readNamed(arguments,"through"),n=u.readNamed(arguments,"to"),i=r.getNamed(arguments),s=new D(i&&0==i.insert&&x.NO_INSERT);return s.moveTo(t),s.arcTo(e,n),s.set(i)},RegularPolygon:function(){for(var t=u.readNamed(arguments,"center"),e=r.readNamed(arguments,"sides"),i=r.readNamed(arguments,"radius"),s=360/e,a=e%3==0,o=new u(0,a?-i:i),l=a?-1:.5,h=new Array(e),c=0;c<e;c++)h[c]=new A(t.add(o.rotate((c+l)*s)));return n(h,!0,arguments)},Star:function(){for(var t=u.readNamed(arguments,"center"),e=2*r.readNamed(arguments,"points"),i=r.readNamed(arguments,"radius1"),s=r.readNamed(arguments,"radius2"),a=360/e,o=new u(0,-1),l=new Array(e),h=0;h<e;h++)l[h]=new A(t.add(o.rotate(a*h).multiply(h%2?s:i)));return n(l,!0,arguments)}}}});var I=k.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,n){var i=n,s=i[0];s&&"number"==typeof s[0]&&(i=[i]);for(var a=n.length-1;a>=0;a--){var o=i[a];i!==n||o instanceof D||(i=r.slice(i)),Array.isArray(o)?i[a]=new D({segments:o,insert:!1}):o instanceof I&&(i.splice.apply(i,[a,1].concat(o.removeChildren())),o.remove())}return t.base.call(this,e,i)},reduce:function t(e){for(var n=this._children,i=n.length-1;i>=0;i--){var r;(r=n[i].reduce(e)).isEmpty()&&r.remove()}return n.length?t.base.call(this):((r=new D(x.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var t=this._children,e=0,n=t.length;e<n;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,n=0,i=e.length;n<i;n++)e[n].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],n=0,i=t.length;n<i;n++)e.push.apply(e,t[n].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,n=0,i=t.length;n<i;n++)e+=t[n].getArea();return e},getLength:function(){for(var t=this._children,e=0,n=0,i=t.length;n<i;n++)e+=t[n].getLength();return e},getPathData:function(t,e){for(var n=this._children,i=[],r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;i.push(a.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return i.join("")},_hitTestChildren:function t(e,n,i){return t.base.call(this,e,n.class===D||"path"===n.type?n:r.set({},n,{fill:!1}),i)},_draw:function(t,e,n,i){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;s<a;s++)r[s].draw(t,e,i);if(!e.clip){this._setStyles(t,e,n);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,n){for(var i=this._children,r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n[a._id]||a._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var n=t._children;if(e&&!n.length)throw new Error("Use a moveTo() command first");return n[n.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var n=t(this,!0);n[e].apply(n,arguments)}},{moveTo:function(){var e=t(this),n=e&&e.isEmpty()?e:new D(x.NO_INSERT);n!==e&&this.addChild(n),n.moveTo.apply(n,arguments)},moveBy:function(){var e=t(this,!0),n=e&&e.getLastSegment(),i=u.read(arguments);this.moveTo(n?i.add(n._point):i)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var n,i=this._children,r=0,s=i.length;r<s;r++)n=i[r][t](e)||n;return n}},{}));k.inject(new function(){var t=Math.min,n=Math.max,i=Math.abs,s={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function a(t,e){var n=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?n.resolveCrossings().reorient("nonzero"===n.getFillRule(),!0):n}function o(t,e,n,i,r){var s=new I(x.NO_INSERT);return s.addChildren(t,!0),s=s.reduce({simplify:e}),r&&0==r.insert||s.insertAbove(i&&n.isSibling(i)&&n.getIndex()<i.getIndex()?i:n),s.copyAttributes(n,!0),s}function l(t,e,n,i){if(i&&(0==i.trace||i.stroke)&&/^(subtract|intersect)$/.test(n))return c(t,e,n);var r=a(t,!0),l=e&&t!==e&&a(e,!0),h=s[n];h[n]=!0,l&&(h.subtract||h.exclude)^l.isClockwise()^r.isClockwise()&&l.reverse();var u,d=f(P.expand(r.getCrossings(l))),g=r._children||[r],_=l&&(l._children||[l]),y=[],x=[];function b(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];y.push.apply(y,i._segments),x.push.apply(x,i.getCurves()),i._overlapsOnly=!0}}if(d.length){b(g),_&&b(_);for(var w=0,S=d.length;w<S;w++)m(d[w]._segment,r,l,x,h);for(w=0,S=y.length;w<S;w++){var M=y[w],T=M._intersection;M._winding||m(M,r,l,x,h),T&&T._overlap||(M._path._overlapsOnly=!1)}u=v(y,h)}else u=p(_?g.concat(_):g.slice(),function(t){return!!h[t]});return o(u,!0,t,e,i)}function c(t,e,n){var i=a(t),r=a(e),s=i.getCrossings(r),l="subtract"===n,h="divide"===n,c={},u=[];function d(t){if(!c[t._id]&&(h||r.contains(t.getPointAt(t.getLength()/2))^l))return u.unshift(t),c[t._id]=!0}for(var p=s.length-1;p>=0;p--){var f=s[p].split();f&&(d(f)&&f.getFirstSegment().setHandleIn(0,0),i.getLastSegment().setHandleOut(0,0))}return d(i),o(u,!1,t,e)}function u(t,e){for(var n=t;n;){if(n===e)return;n=n._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function d(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function p(t,e,n){var s=t&&t.length;if(s){var a=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),o=t.slice().sort(function(t,e){return i(e.getArea())-i(t.getArea())}),l=o[0];null==n&&(n=l.isClockwise());for(var h=0;h<s;h++){for(var c=o[h],u=a[c._id],d=c.getInteriorPoint(),p=0,f=h-1;f>=0;f--){var g=o[f];if(g.contains(d)){var m=a[g._id];p=m.winding,u.winding+=p,u.container=m.exclude?m.container:g;break}}if(e(u.winding)===e(p))u.exclude=!0,t[u.index]=null;else{var v=u.container;c.setClockwise(v?!v.isClockwise():n)}}}return t}function f(t,e,n){var i,r,s,a=e&&[],o=!1,l=n||[],h=n&&{};function c(t){return t._path._id+"."+t._segment1._index}for(var p=(n&&n.length)-1;p>=0;p--)(f=n[p])._path&&(h[c(f)]=!0);for(p=t.length-1;p>=0;p--){var f,g,m=t[p],v=m._time,_=v,y=e&&!e(m);if((f=m._curve)&&(f!==r?(o=!f.hasHandles()||h&&h[c(f)],i=[],s=null,r=f):s>=1e-8&&(v/=s)),y)i&&i.push(m);else{if(e&&a.unshift(m),s=_,v<1e-8)g=f._segment1;else if(v>1-1e-8)g=f._segment2;else{var x=f.divideAtTime(v,!0);o&&l.push(f,x),g=x._segment1;for(var b=i.length-1;b>=0;b--){var w=i[b];w._time=(w._time-v)/(1-v)}}m._setSegment(g);var S=g._intersection,M=m._intersection;if(S){u(S,M);for(var T=S;T;)u(T._intersection,S),T=T._next}else g._intersection=M}}return n||d(l),a||t}function g(e,r,s,a,o){var l,h,c=s?1:0,u=1^c,d=[e.x,e.y],p=d[c],f=d[u],m=1e-6,v=p-1e-9,_=p+1e-9,y=0,x=0,b=0,w=0,S=!1,M=!1,T=1,E=[];function C(i){var h=i[u+0],d=i[u+6];if(!(f<t(h,d)||f>n(h,d))){var y=i[c+0],x=i[c+2],M=i[c+4],C=i[c+6];if(h!==d){var A=f===h?0:f===d?1:v>n(y,x,M,C)||_<t(y,x,M,C)?1:L.solveCubic(i,u,f,E,0,1)>0?E[0]:1,R=0===A?y:1===A?C:L.getPoint(i,A)[s?"y":"x"],P=h>d?1:-1,k=l[u]>l[u+6]?1:-1,D=l[c+6];return f!==h?(R<v?b+=P:R>_?w+=P:S=!0,R>p-m&&R<p+m&&(T/=2)):(P!==k?y<v?b+=P:y>_&&(w+=P):y!=D&&(D<_&&R>_?(w+=P,S=!0):D>v&&R<v&&(b+=P,S=!0)),T=0),l=i,!o&&R>v&&R<_&&0===L.getTangent(i,A)[s?"x":"y"]&&g(e,r,!s,a,!0)}(y<_&&C>v||C<_&&y>v)&&(S=!0)}}function A(e){var i=e[u+0],r=e[u+2],a=e[u+4],o=e[u+6];if(f<=n(i,r,a,o)&&f>=t(i,r,a,o))for(var l,h=e[c+0],d=e[c+2],p=e[c+4],g=e[c+6],m=v>n(h,d,p,g)||_<t(h,d,p,g)?[e]:L.getMonoCurves(e,s),y=0,x=m.length;y<x;y++)if(l=C(m[y]))return l}for(var R=0,P=r.length;R<P;R++){var k,D=r[R],I=D._path,O=D.getValues();if(!(R&&r[R-1]._path===I||(l=null,I._closed||(h=L.getValues(I.getLastCurve().getSegment2(),D.getSegment1(),null,!a))[u]!==h[u+6]&&(l=h),l))){l=O;for(var B=I.getLastCurve();B&&B!==D;){var F=B.getValues();if(F[u]!==F[u+6]){l=F;break}B=B.getPrevious()}}if(k=A(O))return k;if(R+1===P||r[R+1]._path!==I){if(h&&(k=A(h)))return k;!S||b||w||(b=w=I.isClockwise(a)^s?1:-1),y+=b,x+=w,b=w=0,S&&(M=!0,S=!1),h=null}}return y=i(y),x=i(x),{winding:n(y,x),windingL:y,windingR:x,quality:T,onPath:M}}function m(t,e,n,r,s){var a=[],o=t,l=0;do{var c=(y=t.getCurve()).getLength();a.push({segment:t,curve:y,length:c}),l+=c,t=t.getNext()}while(t&&!t._intersection&&t!==o);for(var u=[.5,.25,.75],d={winding:0,quality:-1},p=0;p<u.length&&d.quality<.5;p++){c=l*u[p];for(var f=0,m=a.length;f<m;f++){var v=a[f],_=v.length;if(c<=_){var y,x=(y=v.curve)._path,b=x._parent,w=b instanceof I?b:x,S=h.clamp(y.getTimeAt(c),1e-8,1-1e-8),M=y.getPointAtTime(S),T=i(y.getTangentAtTime(S).y)<Math.SQRT1_2,E=s.subtract&&n&&(w===e&&n._getWinding(M,T,!0).winding||w===n&&!e._getWinding(M,T,!0).winding)?{winding:0,quality:1}:g(M,r,T,!0);E.quality>d.quality&&(d=E);break}c-=_}}for(f=a.length-1;f>=0;f--)a[f].segment._winding=d}function v(t,e){var n,i=[];function r(t){var n;return!(!t||t._visited||e&&(!e[(n=t._winding||{}).winding]||e.unite&&2===n.winding&&n.windingL&&n.windingR))}function s(t){if(t)for(var e=0,i=n.length;e<i;e++)if(t===n[e])return!0;return!1}function a(t){for(var e=t._segments,n=0,i=e.length;n<i;n++)e[n]._visited=!0}function o(t,e){var i=t._intersection,a=i,o=[];function l(i,a){for(;i&&i!==a;){var l=i._segment,h=l&&l._path;if(h){var c=l.getNext()||h.getFirstSegment(),u=c._intersection;l!==t&&(s(l)||s(c)||c&&r(l)&&(r(c)||u&&r(u._segment)))&&o.push(l),e&&n.push(l)}i=i._next}}if(e&&(n=[t]),i){for(l(i);i&&i._prev;)i=i._prev;l(i,a)}return o}t.sort(function(t,e){var n=t._intersection,i=e._intersection,r=!(!n||!n._overlap),s=!(!i||!i._overlap),a=t._path,o=e._path;return r^s?r?1:-1:!n^!i?n?1:-1:a!==o?a._id-o._id:t._index-e._index});for(var l=0,h=t.length;l<h;l++){var c,u,d,p=t[l],f=r(p),g=null,m=!1,v=!0,_=[];if(f&&p._path._overlapsOnly){var y=p._path,b=p._intersection._segment._path;y.compare(b)&&(y.getArea()&&i.push(y.clone(!1)),a(y),a(b),f=!1)}for(;f;){var w=!g,S=o(p,w),M=S.shift(),T=!(m=!w&&(s(p)||s(M)))&&M;if(w&&(g=new D(x.NO_INSERT),c=null),m){(p.isFirst()||p.isLast())&&(v=p._path._closed),p._visited=!0;break}if(T&&c&&(_.push(c),c=null),c||(T&&S.push(p),c={start:g._segments.length,crossings:S,visited:u=[],handleIn:d}),T&&(p=M),!r(p)){g.removeSegments(c.start);for(var E=0,C=u.length;E<C;E++)u[E]._visited=!1;u.length=0;do{(p=c&&c.crossings.shift())&&p._path||(p=null,(c=_.pop())&&(u=c.visited,d=c.handleIn))}while(c&&!r(p));if(!p)break}var R=p.getNext();g.add(new A(p._point,d,R&&p._handleOut)),p._visited=!0,u.push(p),p=R||p._path.getFirstSegment(),d=R&&R._handleIn}m&&(v&&(g.getFirstSegment().setHandleIn(d),g.setClosed(v)),0!==g.getArea()&&i.push(g))}return i}return{_getWinding:function(t,e,n){return g(t,this.getCurves(),e,n)},unite:function(t,e){return l(this,t,"unite",e)},intersect:function(t,e){return l(this,t,"intersect",e)},subtract:function(t,e){return l(this,t,"subtract",e)},exclude:function(t,e){return l(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?c(this,t,"divide"):o([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function n(t,e){var n=t&&t._intersection;return n&&n._overlap&&n._path===e}var i=!1,s=!1,a=this.getIntersections(null,function(t){return t.hasOverlap()&&(i=!0)||t.isCrossing()&&(s=!0)}),o=i&&s&&[];if(a=P.expand(a),i)for(var l=f(a,function(t){return t.hasOverlap()},o),h=l.length-1;h>=0;h--){var c=l[h],u=c._path,p=c._segment,g=p.getPrevious(),m=p.getNext();n(g,u)&&n(m,u)&&(p.remove(),g._handleOut._set(0,0),m._handleIn._set(0,0),g===p||g.getCurve().hasLength()||(m._handleIn.set(g._handleIn),g.remove()))}s&&(f(a,i&&function(t){var e=t.getCurve(),n=t.getSegment(),i=t._intersection,r=i._curve,s=i._segment;if(e&&r&&e._path&&r._path)return!0;n&&(n._intersection=null),s&&(s._intersection=null)},o),o&&d(o),e=v(r.each(e,function(t){this.push.apply(this,t._segments)},[])));var _,y=e.length;return y>1&&t?(e!==t&&this.setChildren(e),_=this):1!==y||t||(e[0]!==this&&this.setSegments(e[0].removeSegments()),_=this),_||((_=new I(x.NO_INSERT)).addChildren(e),(_=_.reduce()).copyAttributes(this),this.replaceWith(_)),_},reorient:function(t,n){var i=this._children;return i&&i.length?this.setChildren(p(this.removeChildren(),function(e){return!!(t?e:1&e)},n)):n!==e&&this.setClockwise(n),this},getInteriorPoint:function(){var e=this.getBounds().getCenter(!0);if(!this.contains(e)){for(var i=this.getCurves(),r=e.y,s=[],a=[],o=0,l=i.length;o<l;o++){var h=i[o].getValues(),c=h[1],u=h[3],d=h[5],p=h[7];if(r>=t(c,u,d,p)&&r<=n(c,u,d,p))for(var f=L.getMonoCurves(h),g=0,m=f.length;g<m;g++){var v=f[g],_=v[1],y=v[7];if(_!==y&&(r>=_&&r<=y||r>=y&&r<=_)){var x=r===_?v[0]:r===y?v[6]:1===L.solveCubic(v,1,r,a,0,1)?L.getPoint(v,a[0]).x:(v[0]+v[6])/2;s.push(x)}}}s.length>1&&(s.sort(function(t,e){return t-e}),e.x=(s[0]+s[1])/2)}return e}}});var O=r.extend({_class:"PathFlattener",initialize:function(t,e,n,i,r){var s,a=[],o=[],l=0,h=1/(n||32),c=t._segments,u=c[0];function d(t,n){var s=L.getValues(t,n,r);a.push(s),function t(n,r,s,a){if(!(a-s>h)||i&&L.isStraight(n)||L.isFlatEnough(n,e||.25)){var c=n[6]-n[0],u=n[7]-n[1],d=Math.sqrt(c*c+u*u);d>0&&(l+=d,o.push({offset:l,curve:n,index:r,time:a}))}else{var p=L.subdivide(n,.5),f=(s+a)/2;t(p[0],r,s,f),t(p[1],r,f,a)}}(s,t._index,0,1)}for(var p=1,f=c.length;p<f;p++)d(u,s=c[p]),u=s;t._closed&&d(s,c[0]),this.curves=a,this.parts=o,this.length=l,this.index=0},_get:function(t){for(var e,n=this.parts,i=n.length,r=this.index;e=r,r&&!(n[--r].offset<t););for(;e<i;e++){var s=n[e];if(s.offset>=t){this.index=e;var a=n[e-1],o=a&&a.index===s.index?a.time:0,l=a?a.offset:0;return{index:s.index,time:o+(s.time-o)*(t-l)/(s.offset-l)}}}return{index:n[i-1].index,time:1}},drawPart:function(t,e,n){for(var i=this._get(e),r=this._get(n),s=i.index,a=r.index;s<=a;s++){var o=L.getPart(this.curves[s],s===i.index?i.time:0,s===r.index?r.time:1);s===i.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(L._evaluateMethods,function(t){this[t+"At"]=function(e){var n=this._get(e);return L[t](this.curves[n.index],n.time)}},{})),B=r.extend({initialize:function(t){for(var e,n=this.points=[],i=t._segments,r=t._closed,s=0,a=i.length;s<a;s++){var o=i[s].point;e&&e.equals(o)||n.push(e=o.clone())}r&&(n.unshift(n[n.length-1]),n.push(n[1])),this.closed=r},fit:function(t){var e=this.points,n=e.length,i=null;return n>0&&(i=[new A(e[0])],n>1&&(this.fitCubic(i,t,0,n-1,e[1].subtract(e[0]),e[n-2].subtract(e[n-1])),this.closed&&(i.shift(),i.pop()))),i},fitCubic:function(t,e,n,i,r,s){var a=this.points;if(i-n!=1){for(var o,l=this.chordLengthParameterize(n,i),h=Math.max(e,e*e),c=!0,u=0;u<=4;u++){var d=this.generateBezier(n,i,l,r,s),p=this.findMaxError(n,i,d,l);if(p.error<e&&c)return void this.addCurve(t,d);if(o=p.index,p.error>=h)break;c=this.reparameterize(n,i,l,d),h=p.error}var f=a[o-1].subtract(a[o+1]);this.fitCubic(t,e,n,o,r,f),this.fitCubic(t,e,o,i,f.negate(),s)}else{var g=a[n],m=a[i],v=g.getDistance(m)/3;this.addCurve(t,[g,g.add(r.normalize(v)),m.add(s.normalize(v)),m])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new A(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,n,i,r){for(var s=Math.abs,a=this.points,o=a[t],l=a[e],h=[[0,0],[0,0]],c=[0,0],u=0,d=e-t+1;u<d;u++){var p=n[u],f=1-p,g=3*p*f,m=f*f*f,v=g*f,_=g*p,y=p*p*p,x=i.normalize(v),b=r.normalize(_),w=a[t+u].subtract(o.multiply(m+v)).subtract(l.multiply(_+y));h[0][0]+=x.dot(x),h[0][1]+=x.dot(b),h[1][0]=h[0][1],h[1][1]+=b.dot(b),c[0]+=x.dot(w),c[1]+=b.dot(w)}var S,M,T=h[0][0]*h[1][1]-h[1][0]*h[0][1];if(s(T)>1e-12){var E=h[0][0]*c[1]-h[1][0]*c[0];S=(c[0]*h[1][1]-c[1]*h[0][1])/T,M=E/T}else{var C=h[0][0]+h[0][1],A=h[1][0]+h[1][1];S=M=s(C)>1e-12?c[0]/C:s(A)>1e-12?c[1]/A:0}var R,L,P=l.getDistance(o),k=1e-12*P;if(S<k||M<k)S=M=P/3;else{var D=l.subtract(o);R=i.normalize(S),L=r.normalize(M),R.dot(D)-L.dot(D)>P*P&&(S=M=P/3,R=L=null)}return[o,o.add(R||i.normalize(S)),l.add(L||r.normalize(M)),l]},reparameterize:function(t,e,n,i){for(var r=t;r<=e;r++)n[r-t]=this.findRoot(i,this.points[r],n[r-t]);r=1;for(var s=n.length;r<s;r++)if(n[r]<=n[r-1])return!1;return!0},findRoot:function(t,e,n){for(var i=[],r=[],s=0;s<=2;s++)i[s]=t[s+1].subtract(t[s]).multiply(3);for(s=0;s<=1;s++)r[s]=i[s+1].subtract(i[s]).multiply(2);var a=this.evaluate(3,t,n),o=this.evaluate(2,i,n),l=this.evaluate(1,r,n),c=a.subtract(e),u=o.dot(o)+c.dot(l);return h.isZero(u)?n:n-c.dot(o)/u},evaluate:function(t,e,n){for(var i=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)i[s]=i[s].multiply(1-n).add(i[s+1].multiply(n));return i[0]},chordLengthParameterize:function(t,e){for(var n=[0],i=t+1;i<=e;i++)n[i-t]=n[i-t-1]+this.points[i].getDistance(this.points[i-1]);i=1;for(var r=e-t;i<=r;i++)n[i]/=n[r];return n},findMaxError:function(t,e,n,i){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var o=this.evaluate(3,n,i[a-t]).subtract(this.points[a]),l=o.x*o.x+o.y*o.y;l>=s&&(s=l,r=a)}return{error:s,index:r}}}),F=x.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var n=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(n&&t,!n&&u.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),N=F.extend({_class:"PointText",initialize:function(){F.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new d(t.x,t.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,n){if(this._content){this._setStyles(t,e,n);var i=this._lines,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=r.getLeading(),l=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var h=0,c=i.length;h<c;h++){t.shadowColor=l;var u=i[h];s&&(t.fillText(u,0,0),t.shadowColor="rgba(0,0,0,0)"),a&&t.strokeText(u,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var n=this._style,i=this._lines,r=i.length,s=n.getJustification(),a=n.getLeading(),o=this.getView().getTextWidth(n.getFontStyle(),i),l=0;"left"!==s&&(l-=o/("center"===s?2:1));var h=new g(l,r?-.75*a:0,o,r*a);return t?t._transformBounds(h,h):h}}),U=r.extend(new function(){var t,e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},s={},a=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],o={"rgb-hsb":function(t,e,n){var i=Math.max(t,e,n),r=i-Math.min(t,e,n);return[0===r?0:60*(i==t?(e-n)/r+(e<n?6:0):i==e?(n-t)/r+2:(t-e)/r+4),0===i?0:r/i,i]},"hsb-rgb":function(t,e,n){var i,r=(t=(t/60%6+6)%6)-(i=Math.floor(t)),s=[n,n*(1-e),n*(1-e*r),n*(1-e*(1-r))];return[s[(i=a[i])[0]],s[i[1]],s[i[2]]]},"rgb-hsl":function(t,e,n){var i=Math.max(t,e,n),r=Math.min(t,e,n),s=i-r,a=0===s,o=(i+r)/2;return[a?0:60*(i==t?(e-n)/s+(e<n?6:0):i==e?(n-t)/s+2:(t-e)/s+4),a?0:o<.5?s/(i+r):s/(2-i-r),o]},"hsl-rgb":function(t,e,n){if(0===e)return[n,n,n];for(var i=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],r=n<.5?n*(1+e):n+e-n*e,s=2*n-r,a=[],o=0;o<3;o++){var l=i[o];l<0&&(l+=1),l>1&&(l-=1),a[o]=6*l<1?s+6*(r-s)*l:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}return a},"rgb-gray":function(t,e,n){return[.2989*t+.587*e+.114*n]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(e,function(t,n){i[n]=[],r.each(t,function(t,s){var a=r.capitalize(t),o=/^(hue|saturation)$/.test(t),l=i[n][s]="gradient"===t?function(t){var e=this._components[0];return e!==(t=z.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===n?function(){return u.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+a]=function(){return this._type===n||o&&/^hs[bl]$/.test(this._type)?this._components[s]:this._convert(n)[s]},this["set"+a]=function(t){this._type===n||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(n),this._properties=e[n],this._type=n),this._components[s]=l.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function a(o){var l,h,c,u,d=arguments,p=this.__read,f=0;Array.isArray(o)&&(o=(d=o)[0]);var g=null!=o&&typeof o;if("string"===g&&o in e&&(l=o,o=d[1],Array.isArray(o)?(h=o,c=d[2]):(p&&(f=1),d=r.slice(d,1),g=typeof o)),!h){if(u="number"===g?d:"object"===g&&null!=o.length?o:null){l||(l=u.length>=3?"rgb":"gray");var m=e[l].length;c=u[m],p&&(f+=u===arguments?m+(null!=c?1:0):1),u.length>m&&(u=r.slice(u,0,m))}else if("string"===g)l="rgb",4===(h=function(e){var i,r=e.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r){i=[0,0,0];for(var a=0;a<3;a++){var o=r[a+1];i[a]=parseInt(1==o.length?o+o:o,16)/255}}else if(r=e.match(/^rgba?\((.*)\)$/)){a=0;for(var l=(i=r[1].split(",")).length;a<l;a++)o=+i[a],i[a]=a<3?o/255:o}else if(n){var h=s[e];if(!h){t||((t=$.getContext(1,1)).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=e,t.fillRect(0,0,1,1);var c=t.getImageData(0,0,1,1).data;h=s[e]=[c[0]/255,c[1]/255,c[2]/255]}i=h.slice()}else i=[0,0,0];return i}(o)).length&&(c=h[3],h.length--);else if("object"===g)if(o.constructor===a){if(l=o._type,h=o._components.slice(),c=o._alpha,"gradient"===l)for(var v=1,_=h.length;v<_;v++){var y=h[v];y&&(h[v]=y.clone())}}else if(o.constructor===z)l="gradient",u=d;else{var x=e[l="hue"in o?"lightness"in o?"hsl":"hsb":"gradient"in o||"stops"in o||"radial"in o?"gradient":"gray"in o?"gray":"rgb"],b=i[l];for(this._components=h=[],v=0,_=x.length;v<_;v++)null==(w=o[x[v]])&&!v&&"gradient"===l&&"stops"in o&&(w={stops:o.stops,radial:o.radial}),null!=(w=b[v].call(this,w))&&(h[v]=w);c=o.alpha}p&&l&&(f=1)}if(this._type=l||"rgb",!h)for(this._components=h=[],v=0,_=(b=i[this._type]).length;v<_;v++){var w;null!=(w=b[v].call(this,u&&u[v]))&&(h[v]=w)}return this._components=h,this._properties=e[this._type],this._alpha=c,p&&(this.__read=f),this},set:"#initialize",_serialize:function(t,e){var n=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?n:[this._type].concat(n),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=o[this._type+"-"+t])?e.apply(this,this._components):o["rgb-"+t].apply(this,o[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new U(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=e[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?U.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],n="gradient"===this._type,i=l.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(n?a:i.number(a)))}return null!=this._alpha&&e.push("alpha: "+i.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){var e=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;function i(t){return Math.round(255*(t<0?0:t>1?1:t))}return e=[i(e[0]),i(e[1]),i(e[2])],n<1&&e.push(n<0?0:n),t?"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):(4==e.length?"rgba(":"rgb(")+e.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var n,i=this._components,r=i[0],s=r._stops,a=i[1],o=i[2],l=i[3],h=e&&e.inverted();if(h&&(a=h._transformPoint(a),o=h._transformPoint(o),l&&(l=h._transformPoint(l))),r._radial){var c=o.getDistance(a);if(l){var u=l.subtract(a);u.getLength()>c&&(l=a.add(u.normalize(c-.1)))}var d=l||a;n=t.createRadialGradient(d.x,d.y,0,a.x,a.y,c)}else n=t.createLinearGradient(a.x,a.y,o.x,o.y);for(var p=0,f=s.length;p<f;p++){var g=s[p],m=g._offset;n.addColorStop(null==m?p/(f-1):m,g._color.toCanvasStyle())}return this._canvasStyle=n},transform:function(t){if("gradient"===this._type){for(var e=this._components,n=1,i=e.length;n<i;n++){var r=e[n];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:e,random:function(){var t=Math.random;return new U(t(),t(),t())}}})},new function(){return r.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=U.read(arguments);for(var n=this._type,i=this._components,r=e._convert(n),s=0,a=i.length;s<a;s++)r[s]=t(i[s],r[s]);return new U(n,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),z=r.extend({_class:"Gradient",initialize:function(t,e){this._id=c.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var n=this._owners?this._owners.indexOf(t):-1;-1!=n&&(this._owners.splice(n,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,n=this._stops.length;e<n;e++)t[e]=this._stops[e].clone();return new z(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var n=this._stops;if(n)for(var i=0,r=n.length;i<r;i++)n[i]._owner=e;for(i=0,r=(n=this._stops=G.readList(t,0,{clone:!0})).length;i<r;i++)n[i]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,n=t._stops,i=e.length;if(i===n.length){for(var r=0;r<i;r++)if(!e[r].equals(n[r]))return!1;return!0}}return!1}}),G=r.extend({_class:"GradientStop",initialize:function(t,n){var i=t,r=n;"object"==typeof t&&n===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(i=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(i=t.color,r=t.offset||t.rampPoint||0)),this.setColor(i),this.setOffset(r)},clone:function(){return new G(this._color.clone(),this._offset)},_serialize:function(t,e){var n=this._color,i=this._offset;return r.serialize(null==i?[n]:[n,i],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=U.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),H=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new u,selectedColor:null},n=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontStretch:"normal",fontSize:12,leading:null,justification:"left"}),i=r.set({},n,{fillColor:new U}),s={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,fontStretch:9,font:9,leading:9,justification:9},a={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||paper.project,this._defaults=!r||r instanceof b?n:r instanceof F?i:t,e&&this.set(e)}};return r.each(n,function(t,n){var i=/Color$/.test(n),l="shadowOffset"===n,h=r.capitalize(n),c=s[n],d="set"+h,p="get"+h;o[d]=function(t){var r=this._owner,s=r&&r._children;if(s&&s.length>0&&!(r instanceof I))for(var a=0,o=s.length;a<o;a++)s[a]._style[d](t);else if(n in this._defaults){var l=this._values[n];l!==t&&(i&&(l&&l._owner!==e&&(l._owner=e),t&&t.constructor===U&&(t._owner&&(t=t.clone()),t._owner=r)),this._values[n]=t,r&&r._changed(c||65))}},o[p]=function(t){var s,a=this._owner,o=a&&a._children;if(n in this._defaults&&(!o||!o.length||t||a instanceof I))if((s=this._values[n])===e)(s=this._defaults[n])&&s.clone&&(s=s.clone());else{var h=i?U:l?u:null;!h||s&&s.constructor===h||(this._values[n]=s=h.read([s],0,{readNull:!0,clone:!0}),s&&i&&(s._owner=a))}else if(o)for(var c=0,d=o.length;c<d;c++){var f=o[c]._style[p]();if(c){if(!r.equals(s,f))return e}else s=f}return s},a[p]=function(t){return this._style[p](t)},a[d]=function(t){this._style[d](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var n="get"+e,i="set"+e;o[n]=a[n]="#get"+t,o[i]=a[i]="#set"+t}),x.inject(a),o},{set:function(t){var e=t instanceof H,n=e?t._values:t;if(n)for(var i in n)if(i in this._defaults){var r=n[i];this[i]=r&&e&&r.clone?r.clone():r}},equals:function(t){function n(t,n,i){var s=t._values,a=n._values,o=n._defaults;for(var l in s){var h=s[l],c=a[l];if(!(i&&l in a||r.equals(h,c===e?o[l]:c)))return!1}return!0}return t===this||t&&this._class===t._class&&n(this,t)&&n(t,this,!0)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize(),e=this.getFontStretch();return this.getFontWeight()+" "+e+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),n=this.getFontSize();return/pt|em|%|px/.test(n)&&(n=this.getView().getPixelSize(n)),null!=e?e:1.2*n}}),W=new function(){function t(t,e,n,i){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var o=r[a],l=o?o+s:e;if(l in t){if(!n)return t[l];t[l]=i;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,n=e&&e.defaultView;return n&&n.getComputedStyle(t,"")},getBounds:function(t,e){var n,i=t.ownerDocument,r=i.body,s=i.documentElement;try{n=t.getBoundingClientRect()}catch(t){n={left:0,top:0,width:0,height:0}}var a=n.left-(s.clientLeft||r.clientLeft||0),o=n.top-(s.clientTop||r.clientTop||0);if(!e){var l=i.defaultView;a+=l.pageXOffset||s.scrollLeft||r.scrollLeft,o+=l.pageYOffset||s.scrollTop||r.scrollTop}return new g(a,o,n.width,n.height)},getViewportBounds:function(t){var e=t.ownerDocument,n=e.defaultView,i=e.documentElement;return new g(0,0,n.innerWidth||i.clientWidth,n.innerHeight||i.clientHeight)},getOffset:function(t,e){return W.getBounds(t,e).getPoint()},getSize:function(t){return W.getBounds(t,!0).getSize()},isInvisible:function(t){return W.getSize(t).equals(new p(0,0))},isInView:function(t){return!W.isInvisible(t)&&W.getViewportBounds(t).intersects(W.getBounds(t,!0))},isInserted:function(t){return i.body.contains(t)},getPrefixed:function(e,n){return e&&t(e,n)},setPrefixed:function(e,n,i){if("object"==typeof n)for(var r in n)t(e,r,!0,n[r]);else t(e,n,!0,i)}}},V={add:function(t,e){if(t)for(var n in e)for(var i=e[n],r=n.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.addEventListener(r[s],i,!1)},remove:function(t,e){if(t)for(var n in e)for(var i=e[n],r=n.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],i,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new u(e.pageX||e.clientX+i.documentElement.scrollLeft,e.pageY||e.clientY+i.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return V.getPoint(t).subtract(W.getOffset(e||V.getTarget(t)))}};V.requestAnimationFrame=new function(){var t,e=W.getPrefixed(n,"requestAnimationFrame"),i=!1,r=[];function s(){var t=r;r=[];for(var n=0,a=t.length;n<a;n++)t[n]();(i=e&&r.length)&&e(s)}return function(n){r.push(n),e?i||(e(s),i=!0):t||(t=setInterval(s,1e3/60))}};var j=r.extend(s,{_class:"View",initialize:function t(e,r){function s(t){return r[t]||parseInt(r.getAttribute(t),10)}function o(){var t=W.getSize(r);return t.isNaN()||t.isZero()?new p(s("width"),s("height")):t}var l;if(n&&r){if(this._id=r.getAttribute("id"),null==this._id&&r.setAttribute("id",this._id="view-"+t._id++),V.add(r,this._viewEvents),W.setPrefixed(r.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),a.hasAttribute(r,"resize")){var h=this;V.add(n,this._windowEvents={resize:function(){h.setViewSize(o())}})}if(l=o(),a.hasAttribute(r,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var c=this._stats.domElement,u=c.style,d=W.getOffset(r);u.position="absolute",u.left=d.x+"px",u.top=d.y+"px",i.body.appendChild(c)}}else l=new p(r),r=null;this._project=e,this._scope=e._scope,this._element=r,this._pixelRatio||(this._pixelRatio=n&&n.devicePixelRatio||1),this._setElementSize(l.width,l.height),this._viewSize=l,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new v)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;j._focused===this&&(j._focused=null),j._views.splice(j._views.indexOf(this),1),delete j._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),V.remove(this._element,this._viewEvents),V.remove(n,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(x._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;V.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;W.getPrefixed(i,"hidden")&&"true"!==a.getAttribute(e,"keepalive")||!W.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var n=this._frameItems;e?(n[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete n[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var n=this._frameItems[e];n.item.emit("frame",new r(t,{time:n.time+=t.delta,count:n.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new f(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=p.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var n=this._element;n&&(n.width!==t&&(n.width=t),n.height!==e&&(n.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new g(new u,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return W.isInView(this._element)},isInserted:function(){return W.isInserted(this._element)},getPixelSize:function(t){var e,n=this._element;if(n){var r=n.parentNode,s=i.createElement("div");s.style.fontSize=t,r.appendChild(s),e=parseFloat(W.getStyles(s).fontSize),r.removeChild(s)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var n=(e?r:u).read(arguments),i=u.read(arguments,0,{readNull:!0});return this.transform((new v)[t](n,i||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new v;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=u.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose(),e=t&&t.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new v).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),n=t&&t.scaling;return n?new d(n.x,n.y,this,"setScaling"):e},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(u.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(u.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(u.read(arguments))},getEventPoint:function(t){return this.viewToProject(V.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return i&&"string"==typeof e&&(e=i.getElementById(e)),new(n?X:j)(t,e)}}},new function(){if(n){var t,e,r,s,a,o=!1,l=!1,h=n.navigator;h.pointerEnabled||h.msPointerEnabled?(r="pointerdown MSPointerDown",s="pointermove MSPointerMove",a="pointerup pointercancel MSPointerUp MSPointerCancel"):(r="touchstart",s="touchmove",a="touchend touchcancel","ontouchstart"in n&&h.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(r+=" mousedown",s+=" mousemove",a+=" mouseup"));var c={},u={mouseout:function(t){var e=j._focused,n=V.getRelatedTarget(t);if(e&&(!n||"HTML"===n.nodeName)){var i=V.getOffset(t,e._element),r=i.x,s=Math.abs,a=s(r),o=a-(1<<25);i.x=s(o)<a?o*(r<0?-1:1):r,C(e,t,e.viewToProject(i))}},scroll:E};c[r]=function(t){var e=j._focused=T(t);o||(o=!0,e._handleMouseEvent("mousedown",t))},u[s]=function(n){var i=j._focused;if(!l){var r=T(n);r?i!==r&&(i&&C(i,n),t||(t=i),i=j._focused=e=r):e&&e===i&&(t&&!t.isInserted()&&(t=null),i=j._focused=t,t=null,E())}i&&C(i,n)},u[r]=function(){l=!0},u[a]=function(t){var e=j._focused;e&&o&&e._handleMouseEvent("mouseup",t),l=o=!1},V.add(i,u),V.add(n,{load:E});var d,p,f,g,m,v,_,y,x=!1,b=!1,w={doubleclick:"click",mousedrag:"mousemove"},S=!1,M={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:c,_handleMouseEvent:function(t,e,n){var i=this._itemEvents,r=i.native[t],s="mousemove"===t,a=this._scope.tool,l=this;function h(t){return i.virtual[t]||l.responds(t)||a&&a.responds(t)}s&&o&&h("mousedrag")&&(t="mousedrag"),n||(n=this.getEventPoint(e));var c=this.getBounds().contains(n),u=r&&c&&l._project.hitTest(n,{tolerance:0,fill:!0,stroke:!0}),w=u&&u.item||null,M=!1,T={};if(T[t.substr(5)]=!0,r&&w!==g&&(g&&A(g,null,"mouseleave",e,n),w&&A(w,null,"mouseenter",e,n),g=w),S^c&&(A(this,null,c?"mouseenter":"mouseleave",e,n),M=!0),!c&&!T.drag||n.equals(p)||(R(this,w,s?t:"mousemove",e,n,p),M=!0),S=c,T.down&&c||T.up&&d){if(R(this,w,t,e,n,d),T.down){if(y=w===v&&Date.now()-_<300,f=v=w,!b&&w){for(var E=w;E&&!E.responds("mousedrag");)E=E._parent;E&&(m=w)}d=n}else T.up&&(b||w!==f||(_=Date.now(),R(this,w,y?"doubleclick":"click",e,n,d),y=!1),f=m=null);S=!1,M=!0}p=n,M&&a&&(x=a._handleMouseEvent(t,e,n,T)||x),(x&&!T.move||T.down&&h("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,n,i){var r,s=this._scope,a=s.tool;function o(a){a.responds(t)&&(paper=s,a.emit(t,r=r||new Z(t,e,n,i)))}this.isVisible()&&(o(this),a&&a.responds(t)&&o(a))},_countItemEvent:function(t,e){var n=this._itemEvents,i=n.native,r=n.virtual;for(var s in M)i[s]=(i[s]||0)+(M[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:E}}}function T(t){var e=V.getTarget(t);return e.getAttribute&&j._viewsById[e.getAttribute("id")]}function E(){var t=j._focused;if(!t||!t.isVisible())for(var n=0,i=j._views.length;n<i;n++)if((t=j._views[n]).isVisible()){j._focused=e=t;break}}function C(t,e,n){t._handleMouseEvent("mousemove",e,n)}function A(t,e,n,i,r,s,a){var o,l=!1;function h(t,n){if(t.responds(n)){if(o||(o=new J(n,i,r,e||t,s?r.subtract(s):null)),t.emit(n,o)&&(x=!0,o.prevented&&(b=!0),o.stopped))return l=!0}else{var a=w[n];if(a)return h(t,a)}}for(;t&&t!==a&&!h(t,n);)t=t._parent;return l}function R(t,e,n,i,r,s){return t._project.removeOn(n),b=x=!1,m&&A(m,null,n,i,r,s)||e&&e!==m&&!e.isDescendant(m)&&A(e,null,n,i,r,s,m)||A(t,m||e||t,n,i,r,s)}}),X=j.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof n.HTMLCanvasElement)){var i=p.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=$.getCanvas(i)}var s=this._context=e.getContext("2d");if(s.save(),this._pixelRatio=1,!/^off|false$/.test(a.getAttribute(e,"hidpi"))){var o=n.devicePixelRatio||1,l=W.getPrefixed(s,"backingStorePixelRatio")||1;this._pixelRatio=o/l}j.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,n){var i=this._pixelRatio;if(t.base.call(this,e*i,n*i),1!==i){var r=this._element,s=this._context;if(!a.hasAttribute(r,"resize")){var o=r.style;o.width=e+"px",o.height=n+"px"}s.restore(),s.save(),s.scale(i,i)}},getPixelSize:function t(e){var n,i=paper.agent;if(i&&i.firefox)n=t.base.call(this,e);else{var r=this._context,s=r.font;r.font=e+" serif",n=parseFloat(r.font),r.font=s}return n},getTextWidth:function(t,e){var n=this._context,i=n.font,r=0;n.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,n.measureText(e[s]).width);return n.font=i,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,n=this._viewSize;return e.clearRect(0,0,n.width+1,n.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),Y=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return q.modifiers}}),Z=Y.extend({_class:"KeyEvent",initialize:function(t,e,n,i){this.type=t,this.event=e,this.key=n,this.character=i},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),q=new function(){var t,s,a={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},o={tab:"\t",space:" ",enter:"\r"},l={},h={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});function u(t){var n=t.key||t.keyIdentifier;return n=/^U\+/.test(n)?String.fromCharCode(parseInt(n.substr(2),16)):/^Arrow[A-Z]/.test(n)?n.substr(5):"Unidentified"===n||n===e?String.fromCharCode(t.keyCode):n,a[n]||(n.length>1?r.hyphenate(n):n.toLowerCase())}function d(e,n,i,s){var a,o=j._focused;if(l[n]=e,e?h[n]=i:delete h[n],n.length>1&&(a=r.camelize(n))in c){c[a]=e;var u=paper&&paper.agent;if("meta"===a&&u&&u.mac)if(e)t={};else{for(var p in t)p in h&&d(!1,p,t[p],s);t=null}}else e&&t&&(t[n]=i);o&&o._handleKeyEvent(e?"keydown":"keyup",s,n,i)}return V.add(i,{keydown:function(t){var e=u(t),n=paper&&paper.agent;e.length>1||n&&n.chrome&&(t.altKey||n.mac&&t.metaKey||!n.mac&&t.ctrlKey)?d(!0,e,o[e]||(e.length>1?"":e),t):s=e},keypress:function(t){if(s){var e=u(t),n=t.charCode,i=n>=32?String.fromCharCode(n):e.length>1?"":e;e!==s&&(e=i.toLowerCase()),d(!0,e,i,t),s=null}},keyup:function(t){var e=u(t);e in h&&d(!1,e,h[e],t)}}),V.add(n,{blur:function(t){for(var e in h)d(!1,e,h[e],t)}}),{modifiers:c,isDown:function(t){return!!l[t]}}},J=Y.extend({_class:"MouseEvent",initialize:function(t,e,n,i,r){this.type=t,this.event=e,this.point=n,this.target=i,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),K=Y.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,n){this.tool=t,this.type=e,this.event=n},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,n=e._parent;/^(Group|CompoundPath)$/.test(n._class);)e=n,n=n._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Q=(o.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){o.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,n,i){paper=this._scope,i.drag&&!this.responds(t)&&(t="mousemove");var r=i.move||i.drag,s=this.responds(t),a=this.minDistance,o=this.maxDistance,l=!1,h=this;function c(t,e){var s=n,a=r?h._point:h._downPoint||s;if(r){if(h._moveCount&&s.equals(a))return!1;if(a&&(null!=t||null!=e)){var o=s.subtract(a),l=o.getLength();if(l<(t||0))return!1;e&&(s=a.add(o.normalize(Math.min(l,e))))}h._moveCount++}return h._point=s,h._lastPoint=a||s,i.down&&(h._moveCount=-1,h._downPoint=s,h._downCount++),!0}function u(){s&&(l=h.emit(t,new K(h,t,e))||l)}if(i.down)c(),u();else if(i.up)c(null,o),u();else if(s)for(;c(a,o);)u();return l}}),{request:function(e){var n=new t.XMLHttpRequest;return n.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&n.overrideMimeType(e.mimeType),n.onload=function(){var t=n.status;0===t||200===t?e.onLoad&&e.onLoad.call(n,n.responseText):n.onerror()},n.onerror=function(){var t=n.status,i='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(i);e.onError(i,t)},n.send(null)}}),$={canvases:[],getCanvas:function(t,e){if(!n)return null;var r,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=i.createElement("canvas"),s=!1);var a=r.getContext("2d");if(!a)throw new Error("Canvas "+r+" is unable to provide a 2D context.");return r.width===t&&r.height===e?s&&a.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),a.save(),r},getContext:function(t,e){var n=this.getCanvas(t,e);return n?n.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},tt=new function(){var t,e,n,i,s,a,o,l,h,c,u,d=Math.min,p=Math.max,f=Math.abs;function g(t,e,n){return.2989*t+.587*e+.114*n}function m(t,e,n,i){var r=i-g(t,e,n),s=(i=g(h=t+r,c=e+r,u=n+r),d(h,c,u)),a=p(h,c,u);if(s<0){var o=i-s;h=i+(h-i)*i/o,c=i+(c-i)*i/o,u=i+(u-i)*i/o}if(a>255){var l=255-i,f=a-i;h=i+(h-i)*l/f,c=i+(c-i)*l/f,u=i+(u-i)*l/f}}function v(t,e,n){return p(t,e,n)-d(t,e,n)}function _(t,e,n,i){var r,s=[t,e,n],a=p(t,e,n),o=d(t,e,n);r=0===d(o=o===t?0:o===e?1:2,a=a===t?0:a===e?1:2)?1===p(o,a)?2:1:0,s[a]>s[o]?(s[r]=(s[r]-s[o])*i/(s[a]-s[o]),s[a]=i):s[r]=s[a]=0,s[o]=0,h=s[0],c=s[1],u=s[2]}var y={multiply:function(){h=s*t/255,c=a*e/255,u=o*n/255},screen:function(){h=s+t-s*t/255,c=a+e-a*e/255,u=o+n-o*n/255},overlay:function(){h=s<128?2*s*t/255:255-2*(255-s)*(255-t)/255,c=a<128?2*a*e/255:255-2*(255-a)*(255-e)/255,u=o<128?2*o*n/255:255-2*(255-o)*(255-n)/255},"soft-light":function(){var i=t*s/255;h=i+s*(255-(255-s)*(255-t)/255-i)/255,c=(i=e*a/255)+a*(255-(255-a)*(255-e)/255-i)/255,u=(i=n*o/255)+o*(255-(255-o)*(255-n)/255-i)/255},"hard-light":function(){h=t<128?2*t*s/255:255-2*(255-t)*(255-s)/255,c=e<128?2*e*a/255:255-2*(255-e)*(255-a)/255,u=n<128?2*n*o/255:255-2*(255-n)*(255-o)/255},"color-dodge":function(){h=0===s?0:255===t?255:d(255,255*s/(255-t)),c=0===a?0:255===e?255:d(255,255*a/(255-e)),u=0===o?0:255===n?255:d(255,255*o/(255-n))},"color-burn":function(){h=255===s?255:0===t?0:p(0,255-255*(255-s)/t),c=255===a?255:0===e?0:p(0,255-255*(255-a)/e),u=255===o?255:0===n?0:p(0,255-255*(255-o)/n)},darken:function(){h=s<t?s:t,c=a<e?a:e,u=o<n?o:n},lighten:function(){h=s>t?s:t,c=a>e?a:e,u=o>n?o:n},difference:function(){(h=s-t)<0&&(h=-h),(c=a-e)<0&&(c=-c),(u=o-n)<0&&(u=-u)},exclusion:function(){h=s+t*(255-s-s)/255,c=a+e*(255-a-a)/255,u=o+n*(255-o-o)/255},hue:function(){_(t,e,n,v(s,a,o)),m(h,c,u,g(s,a,o))},saturation:function(){_(s,a,o,v(t,e,n)),m(h,c,u,g(s,a,o))},luminosity:function(){m(s,a,o,g(t,e,n))},color:function(){m(t,e,n,g(s,a,o))},add:function(){h=d(s+t,255),c=d(a+e,255),u=d(o+n,255)},subtract:function(){h=p(s-t,0),c=p(a-e,0),u=p(o-n,0)},average:function(){h=(s+t)/2,c=(a+e)/2,u=(o+n)/2},negation:function(){h=255-f(255-t-s),c=255-f(255-e-a),u=255-f(255-n-o)}},x=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),b=$.getContext(1,1);b&&(r.each(y,function(t,e){var n="darken"===e,i=!1;b.save();try{b.fillStyle=n?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=e,b.globalCompositeOperation===e&&(b.fillStyle=n?"#a00":"#300",b.fillRect(0,0,1,1),i=b.getImageData(0,0,1,1).data[0]!==n?170:51)}catch(t){}b.restore(),x[e]=i}),$.release(b)),this.process=function(r,d,p,f,g){var m=d.canvas,v="normal"===r;if(v||x[r])p.save(),p.setTransform(1,0,0,1,0,0),p.globalAlpha=f,v||(p.globalCompositeOperation=r),p.drawImage(m,g.x,g.y),p.restore();else{var _=y[r];if(!_)return;for(var b=p.getImageData(g.x,g.y,m.width,m.height),w=b.data,S=d.getImageData(0,0,m.width,m.height).data,M=0,T=w.length;M<T;M+=4){t=S[M],s=w[M],e=S[M+1],a=w[M+1],n=S[M+2],o=w[M+2],i=S[M+3],l=w[M+3],_();var E=i*f/255,C=1-E;w[M]=E*h+C*s,w[M+1]=E*c+C*a,w[M+2]=E*u+C*o,w[M+3]=i*f+C*l}p.putImageData(b,g.x,g.y)}}},et=new function(){var t="http://www.w3.org/2000/svg",e="http://www.w3.org/2000/xmlns",n="http://www.w3.org/1999/xlink",r={href:n,xlink:e,xmlns:e+"/","xmlns:xlink":e+"/"};function s(t,e,n){for(var i in e){var s=e[i],a=r[i];"number"==typeof s&&n&&(s=n.number(s)),a?t.setAttributeNS(a,i,s):t.setAttribute(i,s)}return t}return{svg:t,xmlns:e,xlink:n,create:function(e,n,r){return s(i.createElementNS(t,e),n,r)},get:function(t,e){var n=r[e],i=n?t.getAttributeNS(n,e):t.getAttribute(e);return"null"===i?null:i},set:s}},nt=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof k||t instanceof S||t instanceof F)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],fontStretch:["font-stretch","string"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var n=r.capitalize(e),i=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:i,fromSVG:i&&r.each(i,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+n,set:"set"+n}},{});return new function(){var e;function n(t,n,i){var s=new r,a=t.getTranslation();if(n){var o=(t=t._shiftless())._inverseTransform(a);s[i?"cx":"x"]=o.x,s[i?"cy":"y"]=o.y,a=null}if(!t.isIdentity()){var l=t.decompose();if(l){var c=[],u=l.rotation,d=l.scaling,p=l.skewing;a&&!a.isZero()&&c.push("translate("+e.point(a)+")"),u&&c.push("rotate("+e.number(u)+")"),h.isZero(d.x-1)&&h.isZero(d.y-1)||c.push("scale("+e.point(d)+")"),p.x&&c.push("skewX("+e.number(p.x)+")"),p.y&&c.push("skewY("+e.number(p.y)+")"),s.transform=c.join(" ")}else s.transform="matrix("+t.getValues().join(",")+")"}return s}function s(t,i){for(var r=n(t._matrix),s=t._children,a=et.create("g",r,e),o=0,l=s.length;o<l;o++){var h=s[o],c=_(h,i);if(c)if(h.isClipMask()){var u=et.create("clipPath");u.appendChild(c),f(h,u,"clip"),et.set(a,{"clip-path":"url(#"+u.id+")"})}else a.appendChild(c)}return a}function a(t){var i=t._type,r=t._radius,s=n(t._matrix,!0,"rectangle"!==i);if("rectangle"===i){i="rect";var a=t._size,o=a.width,l=a.height;s.x-=o/2,s.y-=l/2,s.width=o,s.height=l,r.isZero()&&(r=null)}return r&&("circle"===i?s.r=r:(s.rx=r.width,s.ry=r.height)),et.create(i,s,e)}var o,u={Group:s,Layer:s,Raster:function(t,i){var r=n(t._matrix,!0),s=t.getSize(),a=t.getImage();return r.x-=s.width/2,r.y-=s.height/2,r.width=s.width,r.height=s.height,r.href=0==i.embedImages&&a&&a.src||t.toDataURL(),et.create("image",r,e)},Path:function(t,i){var r=i.matchShapes;if(r){var s=t.toShape(!1);if(s)return a(s)}var o,l=t._segments,h=l.length,c=n(t._matrix);if(r&&h>=2&&!t.hasHandles())if(h>2){o=t._closed?"polygon":"polyline";for(var u=[],d=0;d<h;d++)u.push(e.point(l[d]._point));c.points=u.join(" ")}else{o="line";var p=l[0]._point,f=l[1]._point;c.set({x1:p.x,y1:p.y,x2:f.x,y2:f.y})}else o="path",c.d=t.getPathData(null,i.precision);return et.create(o,c,e)},Shape:a,CompoundPath:function(t,i){var r=n(t._matrix),s=t.getPathData(null,i.precision);return s&&(r.d=s),et.create("path",r,e)},SymbolItem:function(t,i){var r=n(t._matrix,!0),s=t._definition,a=p(s,"symbol"),o=s._item,l=o.getBounds();return a||((a=et.create("symbol",{viewBox:e.rectangle(l)})).appendChild(_(o,i)),f(s,a,"symbol")),r.href="#"+a.id,r.x+=l.x,r.y+=l.y,r.width=l.width,r.height=l.height,r.overflow="visible",et.create("use",r,e)},PointText:function(t){var r=et.create("text",n(t._matrix,!0),e);if(""==t.content||""==t.content)return null;/[\u0590-\u05ff\u0600-\u06ff]/.test(t.content)&&(r.style.direction="rtl",r.style.textAnchor="end");for(var s=t.leading,a=0;a<t._lines.length;a++){var o=i.createElementNS("http://www.w3.org/2000/svg","tspan");o.textContent=t._lines[a],0===a&&(s=0),o.setAttributeNS(null,"x",r.getAttribute("x")),o.setAttributeNS(null,"dy",s),""==o.textContent.trim()?s+=t.leading:s=t.leading,r.appendChild(o)}return r}};function d(t,n,i){var s={},a=!i&&t.getParent(),o=[];return null!=t._name&&(s.id=t._name),r.each(nt,function(n){var i=n.get,l=n.type,h=t[i]();if(n.exportFilter?n.exportFilter(t,h):!a||!r.equals(a[i](),h)){if("color"===l&&null!=h){var c=h.getAlpha();c<1&&(s[n.attribute+"-opacity"]=c)}"style"===l?o.push(n.attribute+": "+h):s[n.attribute]=null==h?"none":"color"===l?h.gradient?function(t){var n=p(t,"color");if(!n){var i,r=t.getGradient(),s=r._radial,a=t.getOrigin(),o=t.getDestination();if(s){i={cx:a.x,cy:a.y,r:a.getDistance(o)};var l=t.getHighlight();l&&(i.fx=l.x,i.fy=l.y)}else i={x1:a.x,y1:a.y,x2:o.x,y2:o.y};i.gradientUnits="userSpaceOnUse",n=et.create((s?"radial":"linear")+"Gradient",i,e);for(var h=r._stops,c=0,u=h.length;c<u;c++){var d=h[c],g=d._color,m=g.getAlpha(),v=d._offset;i={offset:null==v?c/(u-1):v},g&&(i["stop-color"]=g.toCSS(!0)),m<1&&(i["stop-opacity"]=m),n.appendChild(et.create("stop",i,e))}f(t,n,"color")}return"url(#"+n.id+")"}(h):h.toCSS(!0):"array"===l?h.join(","):"lookup"===l?n.toSVG[h]:h}}),o.length&&(s.style=o.join(";")),1===s.opacity&&delete s.opacity,t._visible||(s.visibility="hidden"),et.set(n,s,e)}function p(t,e){return o||(o={ids:{},svgs:{}}),t&&o.svgs[e+"-"+(t._id||t.__id||(t.__id=c.get("svg")))]}function f(t,e,n){o||p();var i=o.ids[n]=(o.ids[n]||0)+1;e.id=n+"-"+i,o.svgs[n+"-"+(t._id||t.__id)]=e}function m(e,n){var i=e,r=null;if(o){for(var s in i="svg"===e.nodeName.toLowerCase()&&e,o.svgs)r||(i||(i=et.create("svg")).appendChild(e),r=i.insertBefore(et.create("defs"),i.firstChild)),r.appendChild(o.svgs[s]);o=null}return n.asString?(new t.XMLSerializer).serializeToString(i):i}function _(t,e,n){var i=u[t._class],r=i&&i(t,e);if(r){var s=e.onExport;s&&(r=s(t,r,e)||r);var a=JSON.stringify(t._data);a&&"{}"!==a&&"null"!==a&&r.setAttribute("data-paper-data",a)}return r&&d(t,r,n)}function b(t){return t||(t={}),e=new l(t.precision),t}x.inject({exportSVG:function(t){return m(_(this,t=b(t),!0),t)}}),y.inject({exportSVG:function(t){t=b(t);var i=this._children,s=this.getView(),a=r.pick(t.bounds,"view"),o=t.matrix||"view"===a&&s._matrix,l=o&&v.read([o]),h="view"===a?new g([0,0],s.getViewSize()):"content"===a?x._getBounds(i,l,{stroke:!0}).rect:g.read([a],0,{readNull:!0}),c={version:"1.1",xmlns:et.svg,"xmlns:xlink":et.xlink};h&&(c.width=h.width,c.height=h.height,(h.x||h.y)&&(c.viewBox=e.rectangle(h)));var u=et.create("svg",c,e),d=u;l&&!l.isIdentity()&&(d=u.appendChild(et.create("g",n(l),e)));for(var p=0,f=i.length;p<f;p++)d.appendChild(_(i[p],t,!0));return m(u,t)}})},new function(){var s,a={};function o(t,e,n,i,r){var a=et.get(t,e),o=null==a?i?null:n?"":0:n?a:parseFloat(a);return/%\s*$/.test(a)?o/100*(r?1:s[/x|^width/.test(e)?"width":"height"]):o}function l(t,e,n,i,r){return e=o(t,e||"x",!1,i,r),n=o(t,n||"y",!1,i,r),!i||null!=e&&null!=n?new u(e,n):null}function h(t,e,n,i,r){return e=o(t,e||"width",!1,i,r),n=o(t,n||"height",!1,i,r),!i||null!=e&&null!=n?new p(e,n):null}function c(t,e,n){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?L(t)||t:"lookup"===e?n[t]:t}function d(t,e,n,i){var r=t.childNodes,s="clippath"===e,a="defs"===e,o=new b,l=o._project,h=l._currentStyle,c=[];if(s||a||(o=R(o,t,i),l._currentStyle=o._style.clone()),i)for(var u=t.querySelectorAll("defs"),d=0,p=u.length;d<p;d++)P(u[d],n,!1);for(d=0,p=r.length;d<p;d++){var f,g=r[d];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(f=P(g,n,!1))||f instanceof E||c.push(f)}return o.addChildren(c),s&&(o=R(o.reduce(),t,i)),l._currentStyle=h,(s||a)&&(o.remove(),o=null),o}function f(t,e){for(var n=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),i=[],r=0,s=n.length;r<s;r+=2)i.push(new u(parseFloat(n[r]),parseFloat(n[r+1])));var a=new D(i);return"polygon"===e&&a.closePath(),a}function m(t,e){var n,i=(o(t,"href",!0)||"").substring(1),r="radialgradient"===e;if(i)(n=a[i].getGradient())._radial^r&&((n=n.clone())._radial=r);else{for(var s=t.childNodes,h=[],c=0,u=s.length;c<u;c++){var d=s[c];1===d.nodeType&&h.push(R(new G,d))}n=new z(h,r)}var p,f,g,m="userSpaceOnUse"!==o(t,"gradientUnits",!0);return r?(f=(p=l(t,"cx","cy",!1,m)).add(o(t,"r",!1,!1,m),0),g=l(t,"fx","fy",!0,m)):(p=l(t,"x1","y1",!1,m),f=l(t,"x2","y2",!1,m)),R(new U(n,p,f,g),t)._scaleToBounds=m,null}var _={"#document":function(t,e,n,i){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType)return P(o,n,i)}},g:d,svg:d,clippath:d,polygon:f,polyline:f,path:function(t){return k.create(t.getAttribute("d"))},lineargradient:m,radialgradient:m,image:function(t){var e=new M(o(t,"href",!0));return e.on("load",function(){var e=h(t);this.setSize(e);var n=this._matrix._transformPoint(l(t).add(e.divide(2)));this.translate(n)}),e},symbol:function(t,e,n,i){return new E(d(t,e,n,i),!0)},defs:d,use:function(t){var e=(o(t,"href",!0)||"").substring(1),n=a[e],i=l(t);return n?n instanceof E?n.place(i):n.clone().translate(i):null},circle:function(t){return new S.Circle(l(t,"cx","cy"),o(t,"r"))},ellipse:function(t){return new S.Ellipse({center:l(t,"cx","cy"),radius:h(t,"rx","ry")})},rect:function(t){return new S.Rectangle(new g(l(t),h(t)),h(t,"rx","ry"))},line:function(t){return new D.Line(l(t,"x1","y1"),l(t,"x2","y2"))},text:function(t){var e=new N(l(t).add(l(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}};function w(t,e,n,i){if(t.transform){for(var r=(i.getAttribute(n)||"").split(/\)\s*/g),s=new v,a=0,o=r.length;a<o;a++){var l=r[a];if(!l)break;for(var h=l.split(/\(\s*/),c=h[0],u=h[1].split(/[\s,]+/g),d=0,p=u.length;d<p;d++)u[d]=parseFloat(u[d]);switch(c){case"matrix":s.append(new v(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":s.rotate(u[0],u[1],u[2]);break;case"translate":s.translate(u[0],u[1]);break;case"scale":s.scale(u);break;case"skewX":s.skew(u[0],0);break;case"skewY":s.skew(0,u[0])}}t.transform(s)}}function T(t,e,n){var i="fill-opacity"===n?"getFillColor":"getStrokeColor",r=t[i]&&t[i]();r&&r.setAlpha(parseFloat(e))}var C=r.set(r.each(nt,function(t){this[t.attribute]=function(e,n){if(e[t.set]&&(e[t.set](c(n,t.type,t.fromSVG)),"color"===t.type)){var i=e[t.get]();if(i&&i._scaleToBounds){var r=e.getBounds();i.transform((new v).translate(r.getPoint()).scale(r.getSize()))}}}},{}),{id:function(t,e){a[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var n=L(e);if(n){if((n=n.clone()).setClipMask(!0),!(t instanceof b))return new b(n,t);t.insertChild(0,n)}},gradientTransform:w,transform:w,"fill-opacity":T,"stroke-opacity":T,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var n=e.match(/(.*)%$/);t.setOffset(n?n[1]/100:parseFloat(e))}},viewBox:function(t,e,n,i,r){var s,a=new g(c(e,"array")),o=h(i,null,null,!0);if(t instanceof b){var l=o?o.divide(a.getSize()):1,u=(new v).scale(l).translate(a.getPoint().negate());s=t}else t instanceof E&&(o&&a.setSize(o),s=t._item);if(s){if("visible"!==A(i,"overflow",r)){var d=new S.Rectangle(a);d.setClipMask(!0),s.addChild(d)}u&&s.transform(u)}}});function A(t,n,i){var s=t.attributes[n],a=s&&s.value;if(!a){var o=r.camelize(n);(a=t.style[o])||i.node[o]===i.parent[o]||(a=i.node[o])}return a?"none"===a?null:a:e}function R(t,n,i){if(n.style){var s=n.parentNode,a={node:W.getStyles(n)||{},parent:!i&&!/^defs$/i.test(s.tagName)&&W.getStyles(s)||{}};r.each(C,function(i,r){var s=A(n,r,a);t=s!==e&&i(t,s,r,n,a)||t})}return t}function L(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),i=e&&e[1],r=i&&a[n?i.replace(n.location.href.split("#")[0]+"#",""):i];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function P(t,e,n){var o,l,c,u=t.nodeName.toLowerCase(),d="#document"!==u,p=i.body;n&&d&&(s=paper.getView().getSize(),s=h(t,null,null,!0)||s,o=et.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),l=t.parentNode,c=t.nextSibling,o.appendChild(t),p.appendChild(o));var f=paper.settings,g=f.applyMatrix,m=f.insertItems;f.applyMatrix=!1,f.insertItems=!1;var v=_[u],y=v&&v(t,u,e,n)||null;if(f.insertItems=m,f.applyMatrix=g,y){!d||y instanceof b||(y=R(y,t,n));var x=e.onImport,w=d&&t.getAttribute("data-paper-data");x&&(y=x(t,y,e)||y),e.expandShapes&&y instanceof S&&(y.remove(),y=y.toPath()),w&&(y._data=JSON.parse(w))}return o&&(p.removeChild(o),l&&(c?l.insertBefore(t,c):l.appendChild(t))),n&&(a={},y&&r.pick(e.applyMatrix,g)&&y.matrix.apply(!0,!0)),y}function I(n,r,s){if(!n)return null;r="function"==typeof r?{onLoad:r}:r||{};var a=paper,o=null;function l(i){try{var l="object"==typeof i?i:(new t.DOMParser).parseFromString(i,"image/svg+xml");if(!l.nodeName)throw l=null,new Error("Unsupported SVG source: "+n);paper=a,o=P(l,r,!0),r&&!1===r.insert||s._insertItem(e,o);var c=r.onLoad;c&&c(o,i)}catch(t){h(t)}}function h(t,e){var n=r.onError;if(!n)throw new Error(t);n(t,e)}if("string"!=typeof n||/^.*</.test(n)){if("undefined"!=typeof File&&n instanceof File){var c=new FileReader;return c.onload=function(){l(c.result)},c.onerror=function(){h(c.error)},c.readAsText(n)}l(n)}else{var u=i.getElementById(n);u?l(u):Q.request({url:n,async:!0,onLoad:l,onError:h})}return o}x.inject({importSVG:function(t,e){return I(t,e,this)}}),y.inject({importSVG:function(t,e){return this.activate(),I(t,e,this)}})},(paper=new(a.inject(r.exports,{Base:r,Numerical:h,Key:q,DomEvent:V,DomElement:W,document:i,window:n,Symbol:E,PlacedSymbol:T}))).agent.node&&require("./node/extend.js")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);(Zakeke=Zakeke||{}).isIPhoneX=function(){var t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,e=window.devicePixelRatio||1,n=window.screen.width*e,i=window.screen.height*e;return!(!t||1125!==n||2436!==i)},Zakeke.getViewport=function(){var t="CSS1Compat"===document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(t?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(t?document.documentElement.clientHeight:document.body.clientHeight)}},Zakeke.getContrastYIQ=function(t,e,n){return(299*t+587*e+114*n)/1e3>=128?"black":"white"},Zakeke.getContrastYIQHex=function(t){return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},Zakeke.arrayContains=function(t,e){return null!=e&&null!=e&&("[object Array]"===Object.prototype.toString.call(t)&&function(t){var e=t!=t;return(e||"function"!=typeof Array.prototype.indexOf?function(t){var n=-1,i=-1;for(n=0;n<this.length;n++){var r=this[n];if(e&&r!=r||r===t){i=n;break}}return i}:Array.prototype.indexOf).call(this,t)>-1}.call(t,e))},Zakeke.getColorBrightness=function(t){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),i=parseInt(t.substr(4,2),16);return Math.sqrt(e*e*.241+n*n*.691+i*i*.068)},Zakeke.isColorDark=function(t){return Zakeke.getColorBrightness(t)<130},Zakeke.changeColorLuminosity=function(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var n,i,r="#";for(i=0;i<3;i++)n=parseInt(t.substr(2*i,2),16),r+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*e),255)).toString(16))).substr(n.length);return r},Zakeke.cropImageTransparency=function(t,e,n,i){var r=new Image,s=$("<canvas>"),a=s[0],o=a.getContext("2d");r.crossOrigin="anonymous",r.onload=function(){s.attr({width:this.width,height:this.height}),(o=a.getContext("2d"))?(o.drawImage(this,0,0),function(t,r){var s=o.getImageData(0,0,a.width,a.height).data,l=function(e,n){return s[4*(t*n+e)+3]},h=function(t){return 0==t},c=function(e){for(var n=e?1:-1,i=e?0:r-1;e?i<r:i>-1;i+=n)for(var s=0;s<t;s++)if(!h(l(s,i)))return i;return null},u=function(e){for(var n=e?1:-1,i=e?0:t-1;e?i<t:i>-1;i+=n)for(var s=0;s<r;s++)if(!h(l(i,s)))return i;return null},d=c(!0),p=c(!1),f=u(!0),g=u(!1)-f,m=p-d,v=e,_=n,y=v/g,x=_/m,b=g*y,w=m*y;w>_&&(b=g*x,w=m*x);var S=$("<canvas>").attr({width:v,height:_});S[0].getContext("2d").drawImage(a,f,d,g,m,(v-b)/2,(_-w)/2,b,w);var M=S[0],T=(S[0].getContext("2d").getImageData(0,0,M.width,M.height),M.toDataURL());i&&i(T)}(this.width,this.height)):alert("Get a real browser!")},r.src=t},Zakeke.getColorImage=function(t,e,n){var i=$("<canvas>");i.attr({width:e,height:n});var r=i[0],s=r.getContext("2d");return s.fillStyle=t,s.fillRect(0,0,e,n),r.toDataURL()},Zakeke.chunkString=function(t,e){return t?t.match(new RegExp(".[^]{1,"+e+"}","g")):null},Zakeke.getStringHashCode=function(t){var e,n=0;if(0===t.length)return n;for(e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n},function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).msgpack=t()}(function(){return function t(e,n,i){function r(a,o){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){return r(e[a][1][t]||t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){n.encode=t("./encode").encode,n.decode=t("./decode").decode,n.Encoder=t("./encoder").Encoder,n.Decoder=t("./decoder").Decoder,n.createCodec=t("./ext").createCodec,n.codec=t("./codec").codec},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(t,e,n){(function(t){function n(t){return t&&t.isBuffer&&t}e.exports=n(void 0!==t&&t)||n(this.Buffer)||n("undefined"!=typeof window&&window.Buffer)||this.Buffer}).call(this,t("buffer").Buffer)},{buffer:29}],3:[function(t,e,n){n.copy=function(t,e,n,i){var r;n||(n=0),i||0===i||(i=this.length),e||(e=0);var s=i-n;if(t===this&&n<e&&e<i)for(r=s-1;r>=0;r--)t[r+e]=this[r+n];else for(r=0;r<s;r++)t[r+e]=this[r+n];return s},n.toString=function(t,e,n){var i=this,r=0|e;n||(n=i.length);for(var s="",a=0;r<n;)(a=i[r++])<128?s+=String.fromCharCode(a):(192==(224&a)?a=(31&a)<<6|63&i[r++]:224==(240&a)?a=(15&a)<<12|(63&i[r++])<<6|63&i[r++]:240==(248&a)&&(a=(7&a)<<18|(63&i[r++])<<12|(63&i[r++])<<6|63&i[r++]),a>=65536?(a-=65536,s+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):s+=String.fromCharCode(a));return s},n.write=function(t,e){for(var n=this,i=e||(e|=0),r=t.length,s=0,a=0;a<r;)(s=t.charCodeAt(a++))<128?n[i++]=s:s<2048?(n[i++]=192|s>>>6,n[i++]=128|63&s):s<55296||s>57343?(n[i++]=224|s>>>12,n[i++]=128|s>>>6&63,n[i++]=128|63&s):(s=65536+(s-55296<<10|t.charCodeAt(a++)-56320),n[i++]=240|s>>>18,n[i++]=128|s>>>12&63,n[i++]=128|s>>>6&63,n[i++]=128|63&s);return i-e}},{}],4:[function(t,e,n){function i(t){return new Array(t)}var r=t("./bufferish");(n=e.exports=i(0)).alloc=i,n.concat=r.concat,n.from=function(t){if(!r.isBuffer(t)&&r.isView(t))t=r.Uint8Array.from(t);else if(r.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return r.from.call(n,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(t)}},{"./bufferish":8}],5:[function(t,e,n){function i(t){return new s(t)}var r=t("./bufferish"),s=r.global;(n=e.exports=r.hasBuffer?i(0):[]).alloc=r.hasBuffer&&s.alloc||i,n.concat=r.concat,n.from=function(t){if(!r.isBuffer(t)&&r.isView(t))t=r.Uint8Array.from(t);else if(r.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return r.from.call(n,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return s.from&&1!==s.from.length?s.from(t):new s(t)}},{"./bufferish":8}],6:[function(t,e,n){function i(t,e,n,i){var o=a.isBuffer(this),l=a.isBuffer(t);if(o&&l)return this.copy(t,e,n,i);if(h||o||l||!a.isView(this)||!a.isView(t))return s.copy.call(this,t,e,n,i);var c=n||null!=i?r.call(this,n,i):this;return t.set(c,e),c.length}function r(t,e){var n=this.slice||!h&&this.subarray;if(n)return n.call(this,t,e);var r=a.alloc.call(this,e-t);return i.call(this,r,0,t,e),r}var s=t("./buffer-lite");n.copy=i,n.slice=r,n.toString=function(t,e,n){return(!l&&a.isBuffer(this)?this.toString:s.toString).apply(this,arguments)},n.write=function(t){return function(){return(this[t]||s[t]).apply(this,arguments)}}("write");var a=t("./bufferish"),o=a.global,l=a.hasBuffer&&"TYPED_ARRAY_SUPPORT"in o,h=l&&!o.TYPED_ARRAY_SUPPORT},{"./buffer-lite":3,"./bufferish":8}],7:[function(t,e,n){function i(t){return new Uint8Array(t)}var r=t("./bufferish");(n=e.exports=r.hasArrayBuffer?i(0):[]).alloc=i,n.concat=r.concat,n.from=function(t){if(r.isView(t)){var e=t.byteOffset,i=t.byteLength;(t=t.buffer).byteLength!==i&&(t.slice?t=t.slice(e,e+i):(t=new Uint8Array(t)).byteLength!==i&&(t=Array.prototype.slice.call(t,e,e+i)))}else{if("string"==typeof t)return r.from.call(n,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(t)}},{"./bufferish":8}],8:[function(t,e,n){function i(t){return r(this).alloc(t)}function r(t){return u(t)?f:d(t)?g:c(t)?p:l?f:h?g:p}function s(){return!1}function a(t,e){return t="[object "+t+"]",function(n){return null!=n&&{}.toString.call(e?n[e]:n)===t}}var o=n.global=t("./buffer-global"),l=n.hasBuffer=o&&!!o.isBuffer,h=n.hasArrayBuffer="undefined"!=typeof ArrayBuffer,c=n.isArray=t("isarray");n.isArrayBuffer=h?function(t){return t instanceof ArrayBuffer||v(t)}:s;var u=n.isBuffer=l?o.isBuffer:s,d=n.isView=h?ArrayBuffer.isView||a("ArrayBuffer","buffer"):s;n.alloc=i,n.concat=function(t,e){e||(e=0,Array.prototype.forEach.call(t,function(t){e+=t.length}));var r=this!==n&&this||t[0],s=i.call(r,e),a=0;return Array.prototype.forEach.call(t,function(t){a+=m.copy.call(t,s,a)}),s},n.from=function(t){return"string"==typeof t?function(t){var e=3*t.length,n=i.call(this,e),r=m.write.call(n,t);return e!==r&&(n=m.slice.call(n,0,r)),n}.call(this,t):r(this).from(t)};var p=n.Array=t("./bufferish-array"),f=n.Buffer=t("./bufferish-buffer"),g=n.Uint8Array=t("./bufferish-uint8array"),m=n.prototype=t("./bufferish-proto"),v=a("ArrayBuffer")},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(t,e,n){function i(t){return this instanceof i?(this.options=t,void this.init()):new i(t)}function r(t,e){return t&&e?function(){return t.apply(this,arguments),e.apply(this,arguments)}:t||e}function s(t){return new i(t)}var a=t("isarray");n.createCodec=s,n.install=function(t){for(var e in t)i.prototype[e]=r(i.prototype[e],t[e])},n.filter=function(t){return a(t)?function(t){function e(t,e){return e(t)}return t=t.slice(),function(n){return t.reduce(e,n)}}(t):t};var o=t("./bufferish");i.prototype.init=function(){var t=this.options;return t&&t.uint8array&&(this.bufferish=o.Uint8Array),this},n.preset=s({preset:!0})},{"./bufferish":8,isarray:34}],10:[function(t,e,n){t("./read-core"),t("./write-core"),n.codec={preset:t("./codec-base").preset}},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(t,e,n){function i(t){if(!(this instanceof i))return new i(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}n.DecodeBuffer=i;var r=t("./read-core").preset;t("./flex-buffer").FlexDecoder.mixin(i.prototype),i.prototype.codec=r,i.prototype.fetch=function(){return this.codec.decode(this)}},{"./flex-buffer":21,"./read-core":22}],12:[function(t,e,n){n.decode=function(t,e){var n=new i(e);return n.write(t),n.read()};var i=t("./decode-buffer").DecodeBuffer},{"./decode-buffer":11}],13:[function(t,e,n){function i(t){return this instanceof i?void s.call(this,t):new i(t)}n.Decoder=i;var r=t("event-lite"),s=t("./decode-buffer").DecodeBuffer;i.prototype=new s,r.mixin(i.prototype),i.prototype.decode=function(t){arguments.length&&this.write(t),this.flush()},i.prototype.push=function(t){this.emit("data",t)},i.prototype.end=function(t){this.decode(t),this.emit("end")}},{"./decode-buffer":11,"event-lite":31}],14:[function(t,e,n){function i(t){if(!(this instanceof i))return new i(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}n.EncodeBuffer=i;var r=t("./write-core").preset;t("./flex-buffer").FlexEncoder.mixin(i.prototype),i.prototype.codec=r,i.prototype.write=function(t){this.codec.encode(this,t)}},{"./flex-buffer":21,"./write-core":25}],15:[function(t,e,n){n.encode=function(t,e){var n=new i(e);return n.write(t),n.read()};var i=t("./encode-buffer").EncodeBuffer},{"./encode-buffer":14}],16:[function(t,e,n){function i(t){return this instanceof i?void s.call(this,t):new i(t)}n.Encoder=i;var r=t("event-lite"),s=t("./encode-buffer").EncodeBuffer;i.prototype=new s,r.mixin(i.prototype),i.prototype.encode=function(t){this.write(t),this.emit("data",this.read())},i.prototype.end=function(t){arguments.length&&this.encode(t),this.flush(),this.emit("end")}},{"./encode-buffer":14,"event-lite":31}],17:[function(t,e,n){n.ExtBuffer=function t(e,n){return this instanceof t?(this.buffer=i.from(e),void(this.type=n)):new t(e,n)};var i=t("./bufferish")},{"./bufferish":8}],18:[function(t,e,n){function i(e){return o||(o=t("./encode").encode),o(e)}function r(t){return t.valueOf()}function s(t){(t=RegExp.prototype.toString.call(t).split("/")).shift();var e=[t.pop()];return e.unshift(t.join("/")),e}function a(t){var e={};for(var n in u)e[n]=t[n];return e}n.setExtPackers=function(t){t.addExtPacker(14,Error,[a,i]),t.addExtPacker(1,EvalError,[a,i]),t.addExtPacker(2,RangeError,[a,i]),t.addExtPacker(3,ReferenceError,[a,i]),t.addExtPacker(4,SyntaxError,[a,i]),t.addExtPacker(5,TypeError,[a,i]),t.addExtPacker(6,URIError,[a,i]),t.addExtPacker(10,RegExp,[s,i]),t.addExtPacker(11,Boolean,[r,i]),t.addExtPacker(12,String,[r,i]),t.addExtPacker(13,Date,[Number,i]),t.addExtPacker(15,Number,[r,i]),"undefined"!=typeof Uint8Array&&(t.addExtPacker(17,Int8Array,c),t.addExtPacker(18,Uint8Array,c),t.addExtPacker(19,Int16Array,c),t.addExtPacker(20,Uint16Array,c),t.addExtPacker(21,Int32Array,c),t.addExtPacker(22,Uint32Array,c),t.addExtPacker(23,Float32Array,c),"undefined"!=typeof Float64Array&&t.addExtPacker(24,Float64Array,c),"undefined"!=typeof Uint8ClampedArray&&t.addExtPacker(25,Uint8ClampedArray,c),t.addExtPacker(26,ArrayBuffer,c),t.addExtPacker(29,DataView,c)),l.hasBuffer&&t.addExtPacker(27,h,l.from)};var o,l=t("./bufferish"),h=l.global,c=l.Uint8Array.from,u={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./encode":15}],19:[function(t,e,n){function i(e){return l||(l=t("./decode").decode),l(e)}function r(t){return RegExp.apply(null,t)}function s(t){return function(e){var n=new t;for(var i in u)n[i]=e[i];return n}}function a(t){return function(e){return new t(e)}}function o(t){return new Uint8Array(t).buffer}n.setExtUnpackers=function(t){t.addExtUnpacker(14,[i,s(Error)]),t.addExtUnpacker(1,[i,s(EvalError)]),t.addExtUnpacker(2,[i,s(RangeError)]),t.addExtUnpacker(3,[i,s(ReferenceError)]),t.addExtUnpacker(4,[i,s(SyntaxError)]),t.addExtUnpacker(5,[i,s(TypeError)]),t.addExtUnpacker(6,[i,s(URIError)]),t.addExtUnpacker(10,[i,r]),t.addExtUnpacker(11,[i,a(Boolean)]),t.addExtUnpacker(12,[i,a(String)]),t.addExtUnpacker(13,[i,a(Date)]),t.addExtUnpacker(15,[i,a(Number)]),"undefined"!=typeof Uint8Array&&(t.addExtUnpacker(17,a(Int8Array)),t.addExtUnpacker(18,a(Uint8Array)),t.addExtUnpacker(19,[o,a(Int16Array)]),t.addExtUnpacker(20,[o,a(Uint16Array)]),t.addExtUnpacker(21,[o,a(Int32Array)]),t.addExtUnpacker(22,[o,a(Uint32Array)]),t.addExtUnpacker(23,[o,a(Float32Array)]),"undefined"!=typeof Float64Array&&t.addExtUnpacker(24,[o,a(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&t.addExtUnpacker(25,a(Uint8ClampedArray)),t.addExtUnpacker(26,o),t.addExtUnpacker(29,[o,a(DataView)])),h.hasBuffer&&t.addExtUnpacker(27,a(c))};var l,h=t("./bufferish"),c=h.global,u={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./decode":12}],20:[function(t,e,n){t("./read-core"),t("./write-core"),n.createCodec=t("./codec-base").createCodec},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(t,e,n){function i(){if(!(this instanceof i))return new i}function r(){if(!(this instanceof r))return new r}function s(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function a(t){(this.buffers||(this.buffers=[])).push(t)}function o(t){return function(e){for(var n in t)e[n]=t[n];return e}}n.FlexDecoder=i,n.FlexEncoder=r;var l=t("./bufferish"),h="BUFFER_SHORTAGE";i.mixin=o({bufferish:l,write:function(t){var e=this.offset?l.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=e?t?this.bufferish.concat([e,t]):e:t,this.offset=0},fetch:function(){throw new Error("method not implemented: fetch()")},flush:function(){for(;this.offset<this.buffer.length;){var t,e=this.offset;try{t=this.fetch()}catch(t){if(t&&t.message!=h)throw t;this.offset=e;break}this.push(t)}},push:a,pull:function(){return(this.buffers||(this.buffers=[])).shift()},read:s,reserve:function(t){var e=this.offset,n=e+t;if(n>this.buffer.length)throw new Error(h);return this.offset=n,e},offset:0}),i.mixin(i.prototype),r.mixin=o({bufferish:l,write:function(){throw new Error("method not implemented: write()")},fetch:function(){var t=this.start;if(t<this.offset){var e=this.start=this.offset;return l.prototype.slice.call(this.buffer,t,e)}},flush:function(){for(;this.start<this.offset;){var t=this.fetch();t&&this.push(t)}},push:a,pull:function(){var t=this.buffers||(this.buffers=[]),e=t.length>1?this.bufferish.concat(t):t[0];return t.length=0,e},read:s,reserve:function(t){var e=0|t;if(this.buffer){var n=this.buffer.length,i=0|this.offset,r=i+e;if(r<n)return this.offset=r,i;this.flush(),t=Math.max(t,Math.min(2*n,this.maxBufferSize))}return t=Math.max(t,this.minBufferSize),this.buffer=this.bufferish.alloc(t),this.start=0,this.offset=e,0},send:function(t){var e=t.length;if(e>this.minBufferSize)this.flush(),this.push(t);else{var n=this.reserve(e);l.prototype.copy.call(t,this.buffer,n)}},maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}),r.mixin(r.prototype)},{"./bufferish":8}],22:[function(t,e,n){function i(){var t=this.options;return this.decode=function(t){var e=o.getReadToken(t);return function(t){var n=a(t),i=e[n];if(!i)throw new Error("Invalid type: "+(n?"0x"+n.toString(16):n));return i(t)}}(t),t&&t.preset&&s.setExtUnpackers(this),this}var r=t("./ext-buffer").ExtBuffer,s=t("./ext-unpacker"),a=t("./read-format").readUint8,o=t("./read-token"),l=t("./codec-base");l.install({addExtUnpacker:function(t,e){(this.extUnpackers||(this.extUnpackers=[]))[t]=l.filter(e)},getExtUnpacker:function(t){return(this.extUnpackers||(this.extUnpackers=[]))[t]||function(e){return new r(e,t)}},init:i}),n.preset=i.call(l.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(t,e,n){function i(t,e){var n,i={},r=new Array(e),s=new Array(e),a=t.codec.decode;for(n=0;n<e;n++)r[n]=a(t),s[n]=a(t);for(n=0;n<e;n++)i[r[n]]=s[n];return i}function r(t,e){var n,i=new Map,r=new Array(e),s=new Array(e),a=t.codec.decode;for(n=0;n<e;n++)r[n]=a(t),s[n]=a(t);for(n=0;n<e;n++)i.set(r[n],s[n]);return i}function s(t,e){for(var n=new Array(e),i=t.codec.decode,r=0;r<e;r++)n[r]=i(t);return n}function a(t,e){var n=t.reserve(e),i=n+e;return A.toString.call(t.buffer,"utf-8",n,i)}function o(t,e){var n=t.reserve(e),i=n+e,r=A.slice.call(t.buffer,n,i);return C.from(r)}function l(t,e){var n=t.reserve(e),i=n+e,r=A.slice.call(t.buffer,n,i);return C.Uint8Array.from(r).buffer}function h(t,e){var n=t.reserve(e+1),i=t.buffer[n++],r=n+e,s=t.codec.getExtUnpacker(i);if(!s)throw new Error("Invalid ext type: "+(i?"0x"+i.toString(16):i));return s(A.slice.call(t.buffer,n,r))}function c(t){var e=t.reserve(1);return t.buffer[e]}function u(t){var e=t.reserve(1),n=t.buffer[e];return 128&n?n-256:n}function d(t){var e=t.reserve(2),n=t.buffer;return n[e++]<<8|n[e]}function p(t){var e=t.reserve(2),n=t.buffer,i=n[e++]<<8|n[e];return 32768&i?i-65536:i}function f(t){var e=t.reserve(4),n=t.buffer;return 16777216*n[e++]+(n[e++]<<16)+(n[e++]<<8)+n[e]}function g(t){var e=t.reserve(4),n=t.buffer;return n[e++]<<24|n[e++]<<16|n[e++]<<8|n[e]}function m(t,e){return function(n){var i=n.reserve(t);return e.call(n.buffer,i,L)}}function v(t){return new T(this,t).toNumber()}function _(t){return new E(this,t).toNumber()}function y(t){return new T(this,t)}function x(t){return new E(this,t)}function b(t){return S.read(this,t,!1,23,4)}function w(t){return S.read(this,t,!1,52,8)}var S=t("ieee754"),M=t("int64-buffer"),T=M.Uint64BE,E=M.Int64BE;n.getReadFormat=function(t){var e=C.hasArrayBuffer&&t&&t.binarraybuffer,n=t&&t.int64;return{map:R&&t&&t.usemap?r:i,array:s,str:a,bin:e?l:o,ext:h,uint8:c,uint16:d,uint32:f,uint64:m(8,n?y:v),int8:u,int16:p,int32:g,int64:m(8,n?x:_),float32:m(4,b),float64:m(8,w)}},n.readUint8=c;var C=t("./bufferish"),A=t("./bufferish-proto"),R="undefined"!=typeof Map,L=!0},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(t,e,n){function i(t){var e,n=new Array(256);for(e=0;e<=127;e++)n[e]=r(e);for(e=128;e<=143;e++)n[e]=a(e-128,t.map);for(e=144;e<=159;e++)n[e]=a(e-144,t.array);for(e=160;e<=191;e++)n[e]=a(e-160,t.str);for(n[192]=r(null),n[193]=null,n[194]=r(!1),n[195]=r(!0),n[196]=s(t.uint8,t.bin),n[197]=s(t.uint16,t.bin),n[198]=s(t.uint32,t.bin),n[199]=s(t.uint8,t.ext),n[200]=s(t.uint16,t.ext),n[201]=s(t.uint32,t.ext),n[202]=t.float32,n[203]=t.float64,n[204]=t.uint8,n[205]=t.uint16,n[206]=t.uint32,n[207]=t.uint64,n[208]=t.int8,n[209]=t.int16,n[210]=t.int32,n[211]=t.int64,n[212]=a(1,t.ext),n[213]=a(2,t.ext),n[214]=a(4,t.ext),n[215]=a(8,t.ext),n[216]=a(16,t.ext),n[217]=s(t.uint8,t.str),n[218]=s(t.uint16,t.str),n[219]=s(t.uint32,t.str),n[220]=s(t.uint16,t.array),n[221]=s(t.uint32,t.array),n[222]=s(t.uint16,t.map),n[223]=s(t.uint32,t.map),e=224;e<=255;e++)n[e]=r(e-256);return n}function r(t){return function(){return t}}function s(t,e){return function(n){var i=t(n);return e(n,i)}}function a(t,e){return function(n){return e(n,t)}}var o=t("./read-format");n.getReadToken=function(t){var e=o.getReadFormat(t);return t&&t.useraw?function(t){var e,n=i(t).slice();for(n[217]=n[196],n[218]=n[197],n[219]=n[198],e=160;e<=191;e++)n[e]=a(e-160,t.bin);return n}(e):i(e)}},{"./read-format":23}],25:[function(t,e,n){function i(){var t=this.options;return this.encode=function(t){var e=a.getWriteType(t);return function(t,n){var i=e[typeof n];if(!i)throw new Error('Unsupported type "'+typeof n+'": '+n);i(t,n)}}(t),t&&t.preset&&s.setExtPackers(this),this}var r=t("./ext-buffer").ExtBuffer,s=t("./ext-packer"),a=t("./write-type"),o=t("./codec-base");o.install({addExtPacker:function(t,e,n){function i(e){return n&&(e=n(e)),new r(e,t)}n=o.filter(n);var s=e.name;s&&"Object"!==s?(this.extPackers||(this.extPackers={}))[s]=i:(this.extEncoderList||(this.extEncoderList=[])).unshift([e,i])},getExtPacker:function(t){var e=this.extPackers||(this.extPackers={}),n=t.constructor,i=n&&n.name&&e[n.name];if(i)return i;for(var r=this.extEncoderList||(this.extEncoderList=[]),s=r.length,a=0;a<s;a++){var o=r[a];if(n===o[0])return o[1]}},init:i}),n.preset=i.call(o.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(t,e,n){function i(){var t=m.slice();return t[196]=r(196),t[197]=s(197),t[198]=a(198),t[199]=r(199),t[200]=s(200),t[201]=a(201),t[202]=o(202,4,x.writeFloatBE||c,!0),t[203]=o(203,8,x.writeDoubleBE||u,!0),t[204]=r(204),t[205]=s(205),t[206]=a(206),t[207]=o(207,8,l),t[208]=r(208),t[209]=s(209),t[210]=a(210),t[211]=o(211,8,h),t[217]=r(217),t[218]=s(218),t[219]=a(219),t[220]=s(220),t[221]=a(221),t[222]=s(222),t[223]=a(223),t}function r(t){return function(e,n){var i=e.reserve(2),r=e.buffer;r[i++]=t,r[i]=n}}function s(t){return function(e,n){var i=e.reserve(3),r=e.buffer;r[i++]=t,r[i++]=n>>>8,r[i]=n}}function a(t){return function(e,n){var i=e.reserve(5),r=e.buffer;r[i++]=t,r[i++]=n>>>24,r[i++]=n>>>16,r[i++]=n>>>8,r[i]=n}}function o(t,e,n,i){return function(r,s){var a=r.reserve(e+1);r.buffer[a++]=t,n.call(r.buffer,s,a,i)}}function l(t,e){new f(this,e,t)}function h(t,e){new g(this,e,t)}function c(t,e){d.write(this,t,e,!1,23,4)}function u(t,e){d.write(this,t,e,!1,52,8)}var d=t("ieee754"),p=t("int64-buffer"),f=p.Uint64BE,g=p.Int64BE,m=t("./write-uint8").uint8,v=t("./bufferish"),_=v.global,y=v.hasBuffer&&"TYPED_ARRAY_SUPPORT"in _&&!_.TYPED_ARRAY_SUPPORT,x=v.hasBuffer&&_.prototype||{};n.getWriteToken=function(t){return t&&t.uint8array?function(){var t=i();return t[202]=o(202,4,c),t[203]=o(203,8,u),t}():y||v.hasBuffer&&t&&t.safe?function(){var t=m.slice();return t[196]=o(196,1,_.prototype.writeUInt8),t[197]=o(197,2,_.prototype.writeUInt16BE),t[198]=o(198,4,_.prototype.writeUInt32BE),t[199]=o(199,1,_.prototype.writeUInt8),t[200]=o(200,2,_.prototype.writeUInt16BE),t[201]=o(201,4,_.prototype.writeUInt32BE),t[202]=o(202,4,_.prototype.writeFloatBE),t[203]=o(203,8,_.prototype.writeDoubleBE),t[204]=o(204,1,_.prototype.writeUInt8),t[205]=o(205,2,_.prototype.writeUInt16BE),t[206]=o(206,4,_.prototype.writeUInt32BE),t[207]=o(207,8,l),t[208]=o(208,1,_.prototype.writeInt8),t[209]=o(209,2,_.prototype.writeInt16BE),t[210]=o(210,4,_.prototype.writeInt32BE),t[211]=o(211,8,h),t[217]=o(217,1,_.prototype.writeUInt8),t[218]=o(218,2,_.prototype.writeUInt16BE),t[219]=o(219,4,_.prototype.writeUInt32BE),t[220]=o(220,2,_.prototype.writeUInt16BE),t[221]=o(221,4,_.prototype.writeUInt32BE),t[222]=o(222,2,_.prototype.writeUInt16BE),t[223]=o(223,4,_.prototype.writeUInt32BE),t}():i()}},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(t,e,n){var i=t("isarray"),r=t("int64-buffer"),s=r.Uint64BE,a=r.Int64BE,o=t("./bufferish"),l=t("./bufferish-proto"),h=t("./write-token"),c=t("./write-uint8").uint8,u=t("./ext-buffer").ExtBuffer,d="undefined"!=typeof Uint8Array,p="undefined"!=typeof Map,f=[];f[1]=212,f[2]=213,f[4]=214,f[8]=215,f[16]=216,n.getWriteType=function(t){function e(t,e){if(null===e)return n(t,e);if(y(e))return x(t,e);if(i(e))return function(t,e){var n=e.length;m[n<16?144+n:n<=65535?220:221](t,n);for(var i=t.codec.encode,r=0;r<n;r++)i(t,e[r])}(t,e);if(s.isUint64BE(e))return function(t,e){m[207](t,e.toArray())}(t,e);if(a.isInt64BE(e))return function(t,e){m[211](t,e.toArray())}(t,e);var r=t.codec.getExtPacker(e);return r&&(e=r(e)),e instanceof u?function(t,e){var n=e.buffer,i=n.length,r=f[i]||(i<255?199:i<=65535?200:201);m[r](t,i),c[e.type](t),t.send(n)}(t,e):void b(t,e)}function n(t,e){m[192](t,e)}function r(t,e){var n=e.length;m[n<255?196:n<=65535?197:198](t,n),t.send(e)}function g(t,e){var n=Object.keys(e),i=n.length;m[i<16?128+i:i<=65535?222:223](t,i);var r=t.codec.encode;n.forEach(function(n){r(t,n),r(t,e[n])})}var m=h.getWriteToken(t),v=t&&t.useraw,_=d&&t&&t.binarraybuffer,y=_?o.isArrayBuffer:o.isBuffer,x=_?function(t,e){r(t,new Uint8Array(e))}:r,b=p&&t&&t.usemap?function(t,e){if(!(e instanceof Map))return g(t,e);var n=e.size;m[n<16?128+n:n<=65535?222:223](t,n);var i=t.codec.encode;e.forEach(function(e,n,r){i(t,n),i(t,e)})}:g;return{boolean:function(t,e){m[e?195:194](t,e)},function:n,number:function(t,e){var n=0|e;return e!==n?void m[203](t,e):void m[-32<=n&&n<=127?255&n:0<=n?n<=255?204:n<=65535?205:206:-128<=n?208:-32768<=n?209:210](t,n)},object:v?function(t,n){return y(n)?function(t,e){var n=e.length;m[n<32?160+n:n<=65535?218:219](t,n),t.send(e)}(t,n):void e(t,n)}:e,string:function(t){return function(e,n){var i=n.length,r=5+3*i;e.offset=e.reserve(r);var s=e.buffer,a=t(i),o=e.offset+a;i=l.write.call(s,n,o);var h=t(i);if(a!==h){var c=o+h-a,u=o+i;l.copy.call(s,s,c,o,u)}m[1===h?160+i:h<=3?215+h:219](e,i),e.offset+=i}}(v?function(t){return t<32?1:t<=65535?3:5}:function(t){return t<32?1:t<=255?2:t<=65535?3:5}),symbol:n,undefined:n}}},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(t,e,n){function i(t){return function(e){var n=e.reserve(1);e.buffer[n]=t}}for(var r=n.uint8=new Array(256),s=0;s<=255;s++)r[s]=i(s)},{}],29:[function(t,e,n){(function(e){"use strict";function i(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(t,e){if(i()<e)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=s.prototype:(null===t&&(t=new s(e)),t.length=e),t}function s(t,e,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return a(this,t,e,n)}function a(t,e,n,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,i){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i),s.TYPED_ARRAY_SUPPORT?(t=e).__proto__=s.prototype:t=h(t,e),t}(t,e,n,i):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|u(e,n),a=(t=r(t,i)).write(e,n);return a!==i&&(t=t.slice(0,a)),t}(t,e,n):function(t,e){if(s.isBuffer(e)){var n=0|c(e.length);return 0===(t=r(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?r(t,0):h(t,e);if("Buffer"===e.type&&z(e.data))return h(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e){if(o(e),t=r(t,e<0?0:0|c(e)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function h(t,e){var n=e.length<0?0:0|c(e.length);t=r(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function c(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function u(t,e){if(s.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return O(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(t).length;default:if(i)return O(t).length;e=(""+e).toLowerCase(),i=!0}}function d(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function p(t,e,n,i,r){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof e&&(e=s.from(e,i)),s.isBuffer(e))return 0===e.length?-1:f(t,e,n,i,r);if("number"==typeof e)return e&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):f(t,[e],n,i,r);throw new TypeError("val must be string, number or Buffer")}function f(t,e,n,i,r){function s(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var a,o=1,l=t.length,h=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,l/=2,h/=2,n/=2}if(r){var c=-1;for(a=n;a<l;a++)if(s(t,a)===s(e,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===h)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+h>l&&(n=l-h),a=n;a>=0;a--){for(var u=!0,d=0;d<h;d++)if(s(t,a+d)!==s(e,d)){u=!1;break}if(u)return a}return-1}function g(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o=parseInt(e.substr(2*a,2),16);if(isNaN(o))return a;t[n+a]=o}return a}function m(t,e,n,i){return F(O(e,t.length-n),t,n,i)}function v(t,e,n,i){return F(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function _(t,e,n,i){return v(t,e,n,i)}function y(t,e,n,i){return F(B(e),t,n,i)}function x(t,e,n,i){return F(function(t,e){for(var n,i,r,s=[],a=0;a<t.length&&!((e-=2)<0);++a)i=(n=t.charCodeAt(a))>>8,r=n%256,s.push(r),s.push(i);return s}(e,t.length-n),t,n,i)}function b(t,e,n){return 0===e&&n===t.length?N.fromByteArray(t):N.fromByteArray(t.slice(e,n))}function w(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var s,a,o,l,h=t[r],c=null,u=h>239?4:h>223?3:h>191?2:1;if(r+u<=n)switch(u){case 1:h<128&&(c=h);break;case 2:128==(192&(s=t[r+1]))&&(l=(31&h)<<6|63&s)>127&&(c=l);break;case 3:s=t[r+1],a=t[r+2],128==(192&s)&&128==(192&a)&&(l=(15&h)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=t[r+1],a=t[r+2],o=t[r+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(l=(15&h)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=u}return function(t){var e=t.length;if(e<=G)return String.fromCharCode.apply(String,t);for(var n="",i=0;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=G));return n}(i)}function S(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function M(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function T(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=e;s<n;++s)r+=I(t[s]);return r}function E(t,e,n){for(var i=t.slice(e,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function C(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function A(t,e,n,i,r,a){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function R(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,s=Math.min(t.length-n,2);r<s;++r)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function L(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,s=Math.min(t.length-n,4);r<s;++r)t[n+r]=e>>>8*(i?r:3-r)&255}function P(t,e,n,i,r,s){if(n+i>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(t,e,n,i,r){return r||P(t,0,n,4),U.write(t,e,n,i,23,4),n+4}function D(t,e,n,i,r){return r||P(t,0,n,8),U.write(t,e,n,i,52,8),n+8}function I(t){return t<16?"0"+t.toString(16):t.toString(16)}function O(t,e){e=e||1/0;for(var n,i=t.length,r=null,s=[],a=0;a<i;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(a+1===i){(e-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function B(t){return N.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(H,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function F(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}var N=t("base64-js"),U=t("ieee754"),z=t("isarray");n.Buffer=s,n.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},n.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),n.kMaxLength=i(),s.poolSize=8192,s._augment=function(t){return t.__proto__=s.prototype,t},s.from=function(t,e,n){return a(null,t,e,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(t,e,n){return function(t,e,n,i){return o(e),e<=0?r(t,e):void 0!==n?"string"==typeof i?r(t,e).fill(n,i):r(t,e).fill(n):r(t,e)}(null,t,e,n)},s.allocUnsafe=function(t){return l(null,t)},s.allocUnsafeSlow=function(t){return l(null,t)},s.isBuffer=function(t){return!(null==t||!t._isBuffer)},s.compare=function(t,e){if(!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,a=Math.min(n,i);r<a;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!z(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var i=s.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var a=t[n];if(!s.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},s.byteLength=u,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},s.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?w(this,0,t):function(t,e,n){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,n);case"utf8":case"utf-8":return w(this,e,n);case"ascii":return S(this,e,n);case"latin1":case"binary":return M(this,e,n);case"base64":return b(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},s.prototype.compare=function(t,e,n,i,r){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(this===t)return 0;for(var a=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(e>>>=0),l=Math.min(a,o),h=this.slice(i,r),c=t.slice(e,n),u=0;u<l;++u)if(h[u]!==c[u]){a=h[u],o=c[u];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},s.prototype.indexOf=function(t,e,n){return p(this,t,e,n,!0)},s.prototype.lastIndexOf=function(t,e,n){return p(this,t,e,n,!1)},s.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return g(this,t,e,n);case"utf8":case"utf-8":return m(this,t,e,n);case"ascii":return v(this,t,e,n);case"latin1":case"binary":return _(this,t,e,n);case"base64":return y(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var G=4096;s.prototype.slice=function(t,e){var n,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),s.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=s.prototype;else{var r=e-t;n=new s(r,void 0);for(var a=0;a<r;++a)n[a]=this[a+t]}return n},s.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||C(t,e,this.length);for(var i=this[t],r=1,s=0;++s<e&&(r*=256);)i+=this[t+s]*r;return i},s.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||C(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},s.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||C(t,e,this.length);for(var i=this[t],r=1,s=0;++s<e&&(r*=256);)i+=this[t+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},s.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||C(t,e,this.length);for(var i=e,r=1,s=this[t+--i];i>0&&(r*=256);)s+=this[t+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},s.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),U.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),U.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),U.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),U.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,n,i){t=+t,e|=0,n|=0,i||A(this,t,e,n,Math.pow(2,8*n)-1,0);var r=1,s=0;for(this[e]=255&t;++s<n&&(r*=256);)this[e+s]=t/r&255;return e+n},s.prototype.writeUIntBE=function(t,e,n,i){t=+t,e|=0,n|=0,i||A(this,t,e,n,Math.pow(2,8*n)-1,0);var r=n-1,s=1;for(this[e+r]=255&t;--r>=0&&(s*=256);)this[e+r]=t/s&255;return e+n},s.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,1,255,0),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):R(this,t,e,!0),e+2},s.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):R(this,t,e,!1),e+2},s.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):L(this,t,e,!0),e+4},s.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):L(this,t,e,!1),e+4},s.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);A(this,t,e,n,r-1,-r)}var s=0,a=1,o=0;for(this[e]=255&t;++s<n&&(a*=256);)t<0&&0===o&&0!==this[e+s-1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+n},s.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);A(this,t,e,n,r-1,-r)}var s=n-1,a=1,o=0;for(this[e+s]=255&t;--s>=0&&(a*=256);)t<0&&0===o&&0!==this[e+s+1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+n},s.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,1,127,-128),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):R(this,t,e,!0),e+2},s.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):R(this,t,e,!1),e+2},s.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):L(this,t,e,!0),e+4},s.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||A(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):L(this,t,e,!1),e+4},s.prototype.writeFloatLE=function(t,e,n){return k(this,t,e,!0,n)},s.prototype.writeFloatBE=function(t,e,n){return k(this,t,e,!1,n)},s.prototype.writeDoubleLE=function(t,e,n){return D(this,t,e,!0,n)},s.prototype.writeDoubleBE=function(t,e,n){return D(this,t,e,!1,n)},s.prototype.copy=function(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,a=i-n;if(this===t&&n<e&&e<i)for(r=a-1;r>=0;--r)t[r+e]=this[r+n];else if(a<1e3||!s.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+a),e);return a},s.prototype.fill=function(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var a;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(a=e;a<n;++a)this[a]=t;else{var o=s.isBuffer(t)?t:O(new s(t,i).toString()),l=o.length;for(a=0;a<n-e;++a)this[a+e]=o[a%l]}return this};var H=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":30,ieee754:32,isarray:34}],30:[function(t,e,n){"use strict";function i(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function r(t){return a[t>>18&63]+a[t>>12&63]+a[t>>6&63]+a[63&t]}function s(t,e,n){for(var i,s=[],a=e;a<n;a+=3)i=(t[a]<<16)+(t[a+1]<<8)+t[a+2],s.push(r(i));return s.join("")}n.byteLength=function(t){return 3*t.length/4-i(t)},n.toByteArray=function(t){var e,n,r,s,a,h,c=t.length;a=i(t),h=new l(3*c/4-a),r=a>0?c-4:c;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=o[t.charCodeAt(e)]<<18|o[t.charCodeAt(e+1)]<<12|o[t.charCodeAt(e+2)]<<6|o[t.charCodeAt(e+3)],h[u++]=s>>16&255,h[u++]=s>>8&255,h[u++]=255&s;return 2===a?(s=o[t.charCodeAt(e)]<<2|o[t.charCodeAt(e+1)]>>4,h[u++]=255&s):1===a&&(s=o[t.charCodeAt(e)]<<10|o[t.charCodeAt(e+1)]<<4|o[t.charCodeAt(e+2)]>>2,h[u++]=s>>8&255,h[u++]=255&s),h},n.fromByteArray=function(t){for(var e,n=t.length,i=n%3,r="",o=[],l=16383,h=0,c=n-i;h<c;h+=l)o.push(s(t,h,h+l>c?c:h+l));return 1===i?(e=t[n-1],r+=a[e>>2],r+=a[e<<4&63],r+="=="):2===i&&(e=(t[n-2]<<8)+t[n-1],r+=a[e>>10],r+=a[e>>4&63],r+=a[e<<2&63],r+="="),o.push(r),o.join("")};for(var a=[],o=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,u=h.length;c<u;++c)a[c]=h[c],o[h.charCodeAt(c)]=c;o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},{}],31:[function(t,e,n){!function(t){function n(t){for(var e in a)t[e]=a[e];return t}function i(t,e){var n,a=this;if(arguments.length){if(e){if(n=r(a,t,!0)){if(!(n=n.filter(function(t){return t!==e&&t.originalListener!==e})).length)return i.call(a,t);a[s][t]=n}}else if((n=a[s])&&(delete n[t],!Object.keys(n).length))return i.call(a)}else delete a[s];return a}function r(t,e,n){if(!n||t[s]){var i=t[s]||(t[s]={});return i[e]||(i[e]=[])}}void 0!==e&&(e.exports=t);var s="listeners",a={on:function(t,e){return r(this,t).push(e),this},once:function(t,e){function n(){i.call(s,t,n),e.apply(this,arguments)}var s=this;return n.originalListener=e,r(s,t).push(n),s},off:i,emit:function(t,e){var n=this,i=r(n,t,!0);if(!i)return!1;var s=arguments.length;if(1===s)i.forEach(function(t){t.call(n)});else if(2===s)i.forEach(function(t){t.call(n,e)});else{var a=Array.prototype.slice.call(arguments,1);i.forEach(function(t){t.apply(n,a)})}return!!i.length}};n(t.prototype),t.mixin=n}(function t(){if(!(this instanceof t))return new t})},{}],32:[function(t,e,n){n.read=function(t,e,n,i,r){var s,a,o=8*r-i-1,l=(1<<o)-1,h=l>>1,c=-7,u=n?r-1:0,d=n?-1:1,p=t[e+u];for(u+=d,s=p&(1<<-c)-1,p>>=-c,c+=o;c>0;s=256*s+t[e+u],u+=d,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=i;c>0;a=256*a+t[e+u],u+=d,c-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),s-=h}return(p?-1:1)*a*Math.pow(2,s-i)},n.write=function(t,e,n,i,r,s){var a,o,l,h=8*s-r-1,c=(1<<h)-1,u=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,f=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(a++,l/=2),a+u>=c?(o=0,a=c):a+u>=1?(o=(e*l-1)*Math.pow(2,r),a+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,r),a=0));r>=8;t[n+p]=255&o,p+=f,o/=256,r-=8);for(a=a<<r|o,h+=r;h>0;t[n+p]=255&a,p+=f,a/=256,h-=8);t[n+p-f]|=128*g}},{}],33:[function(t,e,n){(function(t){!function(e){function n(t,n,y){function w(t,e,n,i){return this instanceof w?function(t,e,n,i,r){if(m&&v&&(e instanceof v&&(e=new m(e)),i instanceof v&&(i=new m(i))),e||n||i||p){if(!a(e,n))r=n,i=e,n=0,e=new(p||Array)(8);t.buffer=e,t.offset=n|=0,f!==typeof i&&("string"==typeof i?function(t,e,n,i){var r=0,s=n.length,a=0,o=0;"-"===n[0]&&r++;for(var l=r;r<s;){var h=parseInt(n[r++],i);if(!(h>=0))break;o=o*i+h,a=a*i+Math.floor(o/x),o%=x}l&&(a=~a,o?o=x-o:a++),M(t,e+E,a),M(t,e+C,o)}(e,n,i,r||10):a(i,r)?o(e,n,i,r):"number"==typeof r?(M(e,n+E,i),M(e,n+C,r)):i>0?k(e,n,i):i<0?D(e,n,i):o(e,n,_,0))}else t.buffer=l(_,0)}(this,t,e,n,i):new w(t,e,n,i)}function S(){var t=this.buffer,e=this.offset,n=T(t,e+E),i=T(t,e+C);return y||(n|=0),n?n*x+i:i}function M(t,e,n){t[e+P]=255&n,n>>=8,t[e+L]=255&n,n>>=8,t[e+R]=255&n,n>>=8,t[e+A]=255&n}function T(t,e){return t[e+A]*b+(t[e+R]<<16)+(t[e+L]<<8)+t[e+P]}var E=n?0:4,C=n?4:0,A=n?0:3,R=n?1:2,L=n?2:1,P=n?3:0,k=n?h:u,D=n?c:d,I=w.prototype,O="is"+t,B="_"+O;return I.buffer=void 0,I.offset=0,I[B]=!0,I.toNumber=S,I.toString=function(t){var e=this.buffer,n=this.offset,i=T(e,n+E),r=T(e,n+C),s="",a=!y&&2147483648&i;for(a&&(i=~i,r=x-r),t=t||10;;){var o=i%t*x+r;if(i=Math.floor(i/t),r=Math.floor(o/t),s=(o%t).toString(t)+s,!i&&!r)break}return a&&(s="-"+s),s},I.toJSON=S,I.toArray=i,g&&(I.toBuffer=r),m&&(I.toArrayBuffer=s),w[O]=function(t){return!(!t||!t[B])},e[t]=w,w}function i(t){var e=this.buffer,n=this.offset;return p=null,!1!==t&&0===n&&8===e.length&&y(e)?e:l(e,n)}function r(e){var n=this.buffer,i=this.offset;if(p=g,!1!==e&&0===i&&8===n.length&&t.isBuffer(n))return n;var r=new g(8);return o(r,0,n,i),r}function s(t){var e=this.buffer,n=this.offset,i=e.buffer;if(p=m,!1!==t&&0===n&&i instanceof v&&8===i.byteLength)return i;var r=new m(8);return o(r,0,e,n),r.buffer}function a(t,e){var n=t&&t.length;return e|=0,n&&e+8<=n&&"string"!=typeof t[e]}function o(t,e,n,i){e|=0,i|=0;for(var r=0;r<8;r++)t[e++]=255&n[i++]}function l(t,e){return Array.prototype.slice.call(t,e,e+8)}function h(t,e,n){for(var i=e+8;i>e;)t[--i]=255&n,n/=256}function c(t,e,n){var i=e+8;for(n++;i>e;)t[--i]=255&-n^255,n/=256}function u(t,e,n){for(var i=e+8;e<i;)t[e++]=255&n,n/=256}function d(t,e,n){var i=e+8;for(n++;e<i;)t[e++]=255&-n^255,n/=256}var p,f="undefined",g=f!==typeof t&&t,m=f!==typeof Uint8Array&&Uint8Array,v=f!==typeof ArrayBuffer&&ArrayBuffer,_=[0,0,0,0,0,0,0,0],y=Array.isArray||function(t){return!!t&&"[object Array]"==Object.prototype.toString.call(t)},x=4294967296,b=16777216;n("Uint64BE",!0,!0),n("Int64BE",!0,!1),n("Uint64LE",!1,!0),n("Int64LE",!1,!1)}("object"==typeof n&&"string"!=typeof n.nodeName?n:this||{})}).call(this,t("buffer").Buffer)},{buffer:29}],34:[function(t,e,n){var i={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},{}]},{},[1])(1)}),Logger={info:function(){},error:function(){}},MakeIncremental=function(){},MakeIncremental.prototype={getSceneIncrementalFiles:function(t,e,n){var i=[],r={useDraco:n.useDraco||!1,dracoEncodingSpeed:n.dracoEncodingSpeed||5,dracoDecodingSpeed:n.dracoDecodingSpeed||5},s=n.excludedMeshes||[],a=this;t.autoClear=!0;var o=[];t.meshes.forEach(function(t){if(!s.some(function(e){return e.test(t.name)})){if(t.subMeshes&&t.subMeshes.length>1)return void(t.geometryId&&o.push(t.geometryId));if(t.checkCollisions)t.geometryId&&o.push(t.geometryId);else{var n=a.extractIncrementalFile(e,t,!0,r);n&&i.push(n)}}});var l=t.geometries;if(l&&l.vertexData.forEach(function(t){var n=t.id;if(!o.some(function(t){return t===n})){var s=a.extractIncrementalFile(e,t,!1,r);s&&i.push(s)}}),t.metadata&&t.metadata.delayedMaterials)for(var h=Object.keys(t.metadata.delayedMaterials),c=0;c<t.materials.length;c++){var u=t.materials[c];if(h.includes(u.id)){var d=t.metadata.delayedMaterials[u.id],p=a.extractIncrementalMaterialFile(e,u,d.file);p&&(i.push(p),t.materials.splice(c--,1))}}if(t.metadata&&t.metadata.offloadedMaterials)for(var f=Object.keys(t.metadata.offloadedMaterials),g=0;g<t.materials.length;g++){var m=t.materials[g];if(f.includes(m.id)){var v=t.metadata.offloadedMaterials[m.id];v&&v.data&&t.materials.splice(g--,1)}}var _=new Zakeke.IncrementalFileInfo;return _.name="scene_"+e+".incremental.babylon",_.isScene=!0,_.dracoEncoded=!1,_.data=JSON.stringify(t,null,0),i.push(_),i},extractIncrementalFile:function(t,e,n,i){var r=null;if(Logger.info(e.name),e.positions&&e.normals&&e.indices&&(r=this.createDelayLoadingFile(t,e,n,i))&&r.data){e.delayLoadingFile=r.name,Logger.info("Delay loading file: "+e.delayLoadingFile);for(var s=e.positions.map(function(t){return parseFloat(t)}),a=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],l=0;l<s.length;l+=3){var h=s[l],c=s[l+1],u=s[l+2];h<a[0]&&(a[0]=h),h>o[0]&&(o[0]=h),c<a[1]&&(a[1]=c),c>o[1]&&(o[1]=c),u<a[2]&&(a[2]=u),u>o[2]&&(o[2]=u)}e.boundingBoxMinimum=a,e.boundingBoxMaximum=o,e.positions=null,e.normals=null,e.indices=null,e.uvs&&(e.hasUVs=!0,e.uvs=null),e.uv2s&&(e.hasUVs2=!0,e.uv2s=null),e.colors&&(e.hasColors=!0,e.colors=null),e.tangents&&(e.hasTangents=!0,e.tangents=null),e.matricesIndices&&(e.hasMatricesIndices=!0,e.matricesIndices=null),e.matricesWeights&&(e.hasMatricesWeights=!0,e.matricesWeights=null),n&&e.subMeshes&&(e.subMeshes=null)}return r&&r.data?r:null},createDelayLoadingFile:function(t,e,n,i){var r=new Zakeke.IncrementalFileInfo;r.isScene=!1;var s=i.useDraco&&!n&&!(e.matricesIndices||e.matricesWeights)&&e.indices.length>0&&e.positions.length>0&&e.normals.length>0;r.dracoEncoded=s;var a=(n?e.name:e.id).replace("+","_").replace(" ","_"),o=s?"draco":"";return r.name="scene_"+t+"."+a+(n?".babylonmesh"+o+"data":".babylongeometry"+o+"data"),r.data=s?this.createDracoDelayLoadingFileData(e,i):this.createPlainDelayLoadingFileData(e,n),r},createPlainDelayLoadingFileData:function(t,e){var n={positions:t.positions,indices:t.indices,normals:t.normals};return t.uvs&&(n.uvs=t.uvs),t.uv2s&&(n.uv2s=t.uv2s),t.colors&&(n.colors=t.colors),t.tangents&&(n.tangents=t.tangents),t.matricesIndices&&(n.matricesIndices=t.matricesIndices),t.matricesWeights&&(n.matricesWeights=t.matricesWeights),e&&t.subMeshes&&(n.subMeshes=t.subMeshes),JSON.stringify(n,null,0)},createDracoDelayLoadingFileData:function(t,e){var n=(new Date).getTime(),i=this.getDracoEncodedGeometry(t,e),r=(new Date).getTime()-n;if(Logger.info("Draco Encoding - "+t.id+"\t"+r+" ms"),i){var s={type:"draco",data:i.data,attributes:i.attributes};return msgpack.encode(s)}return null},getDracoEncodedGeometry:function(t,e){if(!t)return null;var n=t.positions,i=t.normals,r=t.tangents,s=t.colors,a=t.uvs,o=t.uv2s,l=t.uv3s,h=t.uv4s,c=t.uv5s,u=t.uv6s,d=t.indices;const p={indices:new Uint32Array(d),positions:new Float32Array(n),normals:new Float32Array(i)};r&&(p.tangents=new Float32Array(r)),a&&(p.uvs=new Float32Array(a)),o&&(p.uv2s=new Float32Array(o)),l&&(p.uv3s=new Float32Array(l)),h&&(p.uv4s=new Float32Array(h)),c&&(p.uv5s=new Float32Array(c)),u&&(p.uv6s=new Float32Array(u)),s&&(p.colors=new Float32Array(s));const f=DracoEncoderModule(),g=new f.Encoder,m=new f.MeshBuilder,v=new f.Mesh,_=p.indices.length/3,y=p.positions.length/3,x={};m.AddFacesToMesh(v,_,p.indices),x.position=m.AddFloatAttributeToMesh(v,f.POSITION,y,3,p.positions),p.normals&&(x.normal=m.AddFloatAttributeToMesh(v,f.NORMAL,y,3,p.normals)),p.tangents&&(x.tangent=m.AddFloatAttributeToMesh(v,f.GENERIC,y,3,p.tangents)),p.colors&&(x.color=m.AddFloatAttributeToMesh(v,f.COLOR,y,4,p.colors)),p.uvs&&(x.uv=m.AddFloatAttributeToMesh(v,f.TEX_COORD,y,2,p.uvs)),p.uv2s&&(x.uv2=m.AddFloatAttributeToMesh(v,f.TEX_COORD,y,2,p.uv2s)),p.uv2s&&p.uv3s&&(x.uv3=m.AddFloatAttributeToMesh(v,f.TEX_COORD,y,2,p.uv3s)),p.uv2s&&p.uv3s&&p.uv4s&&(x.uv4=m.AddFloatAttributeToMesh(v,f.TEX_COORD,y,2,p.uv4s)),p.uv2s&&p.uv3s&&p.uv4s&&p.uv5s&&(x.uv5=m.AddFloatAttributeToMesh(v,f.TEX_COORD,y,2,p.uv5s)),p.uv2s&&p.uv3s&&p.uv4s&&p.uv5s&&p.uv6s&&(x.uv6=m.AddFloatAttributeToMesh(v,f.TEX_COORD,y,2,p.uv6s)),g.SetSpeedOptions(e.dracoEncodingSpeed,e.dracoDecodingSpeed),g.SetAttributeQuantization(f.POSITION,14),g.SetAttributeQuantization(f.TEX_COORD,12),g.SetAttributeQuantization(f.NORMAL,10),g.SetAttributeQuantization(f.COLOR,10),g.SetAttributeQuantization(f.GENERIC,10),g.SetEncodingMethod(f.MESH_EDGEBREAKER_ENCODING);const b=new f.DracoInt8Array,w=g.EncodeMeshToDracoBuffer(v,b);var S=new ArrayBuffer(w),M=new Int8Array(S);for(let t=0;t<w;++t)M[t]=b.GetValue(t);return f.destroy(v),f.destroy(b),f.destroy(g),f.destroy(m),{attributes:x,data:S}},extractIncrementalMaterialFile:function(t,e,n){Logger.info("Extracting material "+e.id);var i=this.createDelayLoadingMaterialFile(t,e,n);return Logger.info("Delay loading material file: "+i.name),i},createDelayLoadingMaterialFile:function(t,e,n){var i=new Zakeke.IncrementalFileInfo;return i.isScene=!1,i.dracoEncoded=!1,i.name=n,i.data=this.createMaterialFileData(e),i},createMaterialFileData:function(t){return JSON.stringify(t,null,0)}},function(t,e,n,i){"use strict";function r(t,e,n){return setTimeout(h(t,n),e)}function s(t,e,n){return!!Array.isArray(t)&&(a(t,n[e],n),!0)}function a(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==i)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function o(e,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=t.console&&(t.console.warn||t.Logger.info);return s&&s.call(t.console,r,i),e.apply(this,arguments)}}function l(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&$(i,n)}function h(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return typeof t==nt?t.apply(e&&e[0]||i,e):t}function u(t,e){return t===i?e:t}function d(t,e,n){a(m(e),function(e){t.addEventListener(e,n,!1)})}function p(t,e,n){a(m(e),function(e){t.removeEventListener(e,n,!1)})}function f(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function g(t,e){return t.indexOf(e)>-1}function m(t){return t.trim().split(/\s+/g)}function v(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function _(t){return Array.prototype.slice.call(t,0)}function y(t,e,n){for(var i=[],r=[],s=0;s<t.length;){var a=e?t[s][e]:t[s];v(r,a)<0&&i.push(t[s]),r[s]=a,s++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function x(t,e){for(var n,r,s=e[0].toUpperCase()+e.slice(1),a=0;a<tt.length;){if((r=(n=tt[a])?n+s:e)in t)return r;a++}return i}function b(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}function w(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){c(t.options.enable,[t])&&n.handler(e)},this.init()}function S(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,s=e&gt&&i-r==0,a=e&(mt|vt)&&i-r==0;n.isFirst=!!s,n.isFinal=!!a,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=T(e)),r>1&&!n.firstMultiple?n.firstMultiple=T(e):1===r&&(n.firstMultiple=!1);var s=n.firstInput,a=n.firstMultiple,o=a?a.center:s.center,l=e.center=E(i);e.timeStamp=st(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=L(o,l),e.distance=R(o,l),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==gt&&s.eventType!==mt||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=A(e.deltaX,e.deltaY);var h=C(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=rt(h.x)>rt(h.y)?h.x:h.y,e.scale=a?function(t,e){return R(e[0],e[1],Ct)/R(t[0],t[1],Ct)}(a.pointers,i):1,e.rotation=a?function(t,e){return L(e[1],e[0],Ct)+L(t[1],t[0],Ct)}(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,M(n,e);var c=t.element;f(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function M(t,e){var n,r,s,a,o=t.lastInterval||e,l=e.timeStamp-o.timeStamp;if(e.eventType!=vt&&(l>ft||o.velocity===i)){var h=e.deltaX-o.deltaX,c=e.deltaY-o.deltaY,u=C(l,h,c);r=u.x,s=u.y,n=rt(u.x)>rt(u.y)?u.x:u.y,a=A(h,c),t.lastInterval=e}else n=o.velocity,r=o.velocityX,s=o.velocityY,a=o.direction;e.velocity=n,e.velocityX=r,e.velocityY=s,e.direction=a}function T(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:it(t.pointers[n].clientX),clientY:it(t.pointers[n].clientY)},n++;return{timeStamp:st(),pointers:e,center:E(e),deltaX:t.deltaX,deltaY:t.deltaY}}function E(t){var e=t.length;if(1===e)return{x:it(t[0].clientX),y:it(t[0].clientY)};for(var n=0,i=0,r=0;e>r;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:it(n/e),y:it(i/e)}}function C(t,e,n){return{x:e/t||0,y:n/t||0}}function A(t,e){return t===e?_t:rt(t)>=rt(e)?0>t?yt:xt:0>e?bt:wt}function R(t,e,n){n||(n=Et);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function L(t,e,n){n||(n=Et);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function P(){this.evEl=Rt,this.evWin=Lt,this.pressed=!1,w.apply(this,arguments)}function k(){this.evEl=Dt,this.evWin=It,w.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function D(){this.evTarget=Bt,this.evWin=Ft,this.started=!1,w.apply(this,arguments)}function I(){this.evTarget=Ut,this.targetIds={},w.apply(this,arguments)}function O(){w.apply(this,arguments);var t=h(this.handler,this);this.touch=new I(this.manager,t),this.mouse=new P(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function B(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)},zt)}}function F(t,e){this.manager=t,this.set(e)}function N(t){this.options=$({},this.defaults,t||{}),this.id=lt++,this.manager=null,this.options.enable=u(this.options.enable,!0),this.state=qt,this.simultaneous={},this.requireFail=[]}function U(t){return t&te?"cancel":t&Qt?"end":t&Kt?"move":t&Jt?"start":""}function z(t){return t==wt?"down":t==bt?"up":t==yt?"left":t==xt?"right":""}function G(t,e){var n=e.manager;return n?n.get(t):t}function H(){N.apply(this,arguments)}function W(){H.apply(this,arguments),this.pX=null,this.pY=null}function V(){H.apply(this,arguments)}function j(){N.apply(this,arguments),this._timer=null,this._input=null}function X(){H.apply(this,arguments)}function Y(){H.apply(this,arguments)}function Z(){N.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function q(t,e){return(e=e||{}).recognizers=u(e.recognizers,q.defaults.preset),new J(t,e)}function J(t,e){this.options=$({},q.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){return new(t.options.inputClass||(ct?k:ut?I:ht?O:P))(t,S)}(this),this.touchAction=new F(this,this.options.touchAction),K(this,!0),a(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function K(t,e){var n,i=t.element;i.style&&(a(t.options.cssProps,function(r,s){n=x(i.style,s),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={}))}function Q(t,n){var i=e.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=n,n.target.dispatchEvent(i)}var $,tt=["","webkit","Moz","MS","ms","o"],et=e.createElement("div"),nt="function",it=Math.round,rt=Math.abs,st=Date.now;$="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])}return e}:Object.assign;var at=o(function(t,e,n){for(var r=Object.keys(e),s=0;s<r.length;)(!n||n&&t[r[s]]===i)&&(t[r[s]]=e[r[s]]),s++;return t},"extend","Use `assign`."),ot=o(function(t,e){return at(t,e,!0)},"merge","Use `assign`."),lt=1,ht="ontouchstart"in t,ct=x(t,"PointerEvent")!==i,ut=ht&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),dt="touch",pt="mouse",ft=25,gt=1,mt=4,vt=8,_t=1,yt=2,xt=4,bt=8,wt=16,St=yt|xt,Mt=bt|wt,Tt=St|Mt,Et=["x","y"],Ct=["clientX","clientY"];w.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(b(this.element),this.evWin,this.domHandler)}};var At={mousedown:gt,mousemove:2,mouseup:mt},Rt="mousedown",Lt="mousemove mouseup";l(P,w,{handler:function(t){var e=At[t.type];e&gt&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=mt),this.pressed&&(e&mt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:pt,srcEvent:t}))}});var Pt={pointerdown:gt,pointermove:2,pointerup:mt,pointercancel:vt,pointerout:vt},kt={2:dt,3:"pen",4:pt,5:"kinect"},Dt="pointerdown",It="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Dt="MSPointerDown",It="MSPointerMove MSPointerUp MSPointerCancel"),l(k,w,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=Pt[i],s=kt[t.pointerType]||t.pointerType,a=s==dt,o=v(e,t.pointerId,"pointerId");r&gt&&(0===t.button||a)?0>o&&(e.push(t),o=e.length-1):r&(mt|vt)&&(n=!0),0>o||(e[o]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(o,1))}});var Ot={touchstart:gt,touchmove:2,touchend:mt,touchcancel:vt},Bt="touchstart",Ft="touchstart touchmove touchend touchcancel";l(D,w,{handler:function(t){var e=Ot[t.type];if(e===gt&&(this.started=!0),this.started){var n=function(t,e){var n=_(t.touches),i=_(t.changedTouches);return e&(mt|vt)&&(n=y(n.concat(i),"identifier",!0)),[n,i]}.call(this,t,e);e&(mt|vt)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:dt,srcEvent:t})}}});var Nt={touchstart:gt,touchmove:2,touchend:mt,touchcancel:vt},Ut="touchstart touchmove touchend touchcancel";l(I,w,{handler:function(t){var e=Nt[t.type],n=function(t,e){var n=_(t.touches),i=this.targetIds;if(e&(2|gt)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,s,a=_(t.changedTouches),o=[],l=this.target;if(s=n.filter(function(t){return f(t.target,l)}),e===gt)for(r=0;r<s.length;)i[s[r].identifier]=!0,r++;for(r=0;r<a.length;)i[a[r].identifier]&&o.push(a[r]),e&(mt|vt)&&delete i[a[r].identifier],r++;return o.length?[y(s.concat(o),"identifier",!0),o]:void 0}.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:dt,srcEvent:t})}});var zt=2500;l(O,w,{handler:function(t,e,n){var i=n.pointerType==dt,r=n.pointerType==pt;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)(function(t,e){t&gt?(this.primaryTouch=e.changedPointers[0].identifier,B.call(this,e)):t&(mt|vt)&&B.call(this,e)}).call(this,e,n);else if(r&&function(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],s=Math.abs(e-r.x),a=Math.abs(n-r.y);if(25>=s&&25>=a)return!0}return!1}.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Gt=x(et.style,"touchAction"),Ht=Gt!==i,Wt="compute",Vt="manipulation",jt="none",Xt="pan-x",Yt="pan-y",Zt=function(){if(!Ht)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=!n||t.CSS.supports("touch-action",i)}),e}();F.prototype={set:function(t){t==Wt&&(t=this.compute()),Ht&&this.manager.element.style&&Zt[t]&&(this.manager.element.style[Gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return a(this.manager.recognizers,function(e){c(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(g(t,jt))return jt;var e=g(t,Xt),n=g(t,Yt);return e&&n?jt:e||n?e?Xt:Yt:g(t,Vt)?Vt:"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(!this.manager.session.prevented){var i=this.actions,r=g(i,jt)&&!Zt[jt],s=g(i,Yt)&&!Zt[Yt],a=g(i,Xt)&&!Zt[Xt];if(r){var o=1===t.pointers.length,l=t.distance<2,h=t.deltaTime<250;if(o&&l&&h)return}return a&&s?void 0:r||s&&n&St||a&&n&Mt?this.preventSrc(e):void 0}e.preventDefault()},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var qt=1,Jt=2,Kt=4,Qt=8,$t=Qt,te=16;N.prototype={defaults:{},set:function(t){return $(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=G(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)?this:(t=G(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return-1===v(e,t=G(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=G(t,this);var e=v(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){n.manager.emit(e,t)}var n=this,i=this.state;Qt>i&&e(n.options.event+U(i)),e(n.options.event),t.additionalEvent&&e(t.additionalEvent),i>=Qt&&e(n.options.event+U(i))},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|qt)))return!1;t++}return!0},recognize:function(t){var e=$({},t);return c(this.options.enable,[this,e])?(this.state&($t|te|32)&&(this.state=qt),this.state=this.process(e),void(this.state&(Jt|Kt|Qt|te)&&this.tryEmit(e))):(this.reset(),void(this.state=32))},process:function(t){},getTouchAction:function(){},reset:function(){}},l(H,N,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=e&(Jt|Kt),r=this.attrTest(t);return i&&(n&vt||!r)?e|te:i||r?n&mt?e|Qt:e&Jt?e|Kt:Jt:32}}),l(W,H,{defaults:{event:"pan",threshold:10,pointers:1,direction:Tt},getTouchAction:function(){var t=this.options.direction,e=[];return t&St&&e.push(Yt),t&Mt&&e.push(Xt),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,s=t.deltaX,a=t.deltaY;return r&e.direction||(e.direction&St?(r=0===s?_t:0>s?yt:xt,n=s!=this.pX,i=Math.abs(t.deltaX)):(r=0===a?_t:0>a?bt:wt,n=a!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return H.prototype.attrTest.call(this,t)&&(this.state&Jt||!(this.state&Jt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=z(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),l(V,H,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Jt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),l(j,N,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(mt|vt)&&!s)this.reset();else if(t.eventType&gt)this.reset(),this._timer=r(function(){this.state=$t,this.tryEmit()},e.time,this);else if(t.eventType&mt)return $t;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===$t&&(t&&t.eventType&mt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=st(),this.manager.emit(this.options.event,this._input)))}}),l(X,H,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Jt)}}),l(Y,H,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:St|Mt,pointers:1},getTouchAction:function(){return W.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(St|Mt)?e=t.overallVelocity:n&St?e=t.overallVelocityX:n&Mt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&rt(e)>this.options.velocity&&t.eventType&mt},emit:function(t){var e=z(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),l(Z,N,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Vt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&gt&&0===this.count)return this.failTimeout();if(i&&s&&n){if(t.eventType!=mt)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||R(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=$t,this.tryEmit()},e.interval,this),Jt):$t}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==$t&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),q.VERSION="2.0.8",q.defaults={domEvents:!1,touchAction:Wt,enable:!0,inputTarget:null,inputClass:null,preset:[[X,{enable:!1}],[V,{enable:!1},["rotate"]],[Y,{direction:St}],[W,{direction:St},["swipe"]],[Z],[Z,{event:"doubletap",taps:2},["tap"]],[j]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},J.prototype={set:function(t){return $(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n,i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&$t)&&(r=e.curRecognizer=null);for(var s=0;s<i.length;)n=i[s],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(Jt|Kt|Qt)&&(r=e.curRecognizer=n),s++}},get:function(t){if(t instanceof N)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=v(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==i&&e!==i){var n=this.handlers;return a(m(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==i){var n=this.handlers;return a(m(t),function(t){e?n[t]&&n[t].splice(v(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&Q(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&K(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},$(q,{INPUT_START:gt,INPUT_MOVE:2,INPUT_END:mt,INPUT_CANCEL:vt,STATE_POSSIBLE:qt,STATE_BEGAN:Jt,STATE_CHANGED:Kt,STATE_ENDED:Qt,STATE_RECOGNIZED:$t,STATE_CANCELLED:te,STATE_FAILED:32,DIRECTION_NONE:_t,DIRECTION_LEFT:yt,DIRECTION_RIGHT:xt,DIRECTION_UP:bt,DIRECTION_DOWN:wt,DIRECTION_HORIZONTAL:St,DIRECTION_VERTICAL:Mt,DIRECTION_ALL:Tt,Manager:J,Input:w,TouchAction:F,TouchInput:I,MouseInput:P,PointerEventInput:k,TouchMouseInput:O,SingleTouchInput:D,Recognizer:N,AttrRecognizer:H,Tap:Z,Pan:W,Swipe:Y,Pinch:V,Rotate:X,Press:j,on:d,off:p,each:a,merge:ot,extend:at,assign:$,inherit:l,bindFn:h,prefixed:x}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=q,"function"==typeof define&&define.amd?define(function(){return q}):"undefined"!=typeof module&&module.exports?module.exports=q:t.Hammer=q}(window,document),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).earcut=t()}(function(){return function t(e,n,i){function r(a,o){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){return r(e[a][1][t]||t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,s,o,l,h,c,d,p=e&&e.length,f=p?e[0]*n:t.length,g=r(t,0,f,n,!0),m=[];if(!g)return m;if(p&&(g=u(t,e,g,n)),t.length>80*n){i=o=t[0],s=l=t[1];for(var v=n;f>v;v+=n)i>(h=t[v])&&(i=h),s>(c=t[v+1])&&(s=c),h>o&&(o=h),c>l&&(l=c);d=Math.max(o-i,l-s)}return a(g,m,n,i,s,d),m}function r(t,e,n,i,r){var s,a;if(r===C(t,e,n,i)>0)for(s=e;n>s;s+=i)a=M(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=M(s,t[s],t[s+1],a);return a&&x(a,a.next)&&(T(a),a=a.next),a}function s(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!x(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(T(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function a(t,e,n,i,r,u,d){if(t){!d&&u&&f(t,i,r,u);for(var p,g,m=t;t.prev!==t.next;)if(p=t.prev,g=t.next,u?l(t,i,r,u):o(t))e.push(p.i/n),e.push(t.i/n),e.push(g.i/n),T(t),t=g.next,m=g.next;else if((t=g)===m){d?1===d?a(t=h(t,e,n),e,n,i,r,u,2):2===d&&c(t,e,n,i,r,u):a(s(t),e,n,i,r,u,1);break}}}function o(t){var e=t.prev,n=t,i=t.next;if(y(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(v(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,n,i){var r=t.prev,s=t,a=t.next;if(y(r,s,a)>=0)return!1;for(var o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,h=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,c=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=g(o,l,e,n,i),d=g(h,c,e,n,i),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&v(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&v(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function h(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!x(r,s)&&b(r,i,i.next,s)&&w(r,s)&&w(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),T(i),T(i.next),i=t=s),i=i.next}while(i!==t);return i}function c(t,e,n,i,r,o){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&_(l,h)){var c=S(l,h);return l=s(l,l.next),c=s(c,c.next),a(l,e,n,i,r,o),void a(c,e,n,i,r,o)}h=h.next}l=l.next}while(l!==t)}function u(t,e,n,i){var a,o,l,h=[];for(a=0,o=e.length;o>a;a++)(l=r(t,e[a]*i,o-1>a?e[a+1]*i:t.length,i,!1))===l.next&&(l.steiner=!0),h.push(m(l));for(h.sort(d),a=0;a<h.length;a++)p(h[a],n),n=s(n,n.next);return n}function d(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var n,i=e,r=t.x,s=t.y,a=-1/0;do{if(s<=i.y&&s>=i.next.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(r>=o&&o>a){if(a=o,o===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n.prev;var l,h=n,c=n.x,u=n.y,d=1/0;for(i=n.next;i!==h;)r>=i.x&&i.x>=c&&v(u>s?r:a,s,c,u,u>s?a:r,s,i.x,i.y)&&((d>(l=Math.abs(s-i.y)/(r-i.x))||l===d&&i.x>n.x)&&w(i,t)&&(n=i,d=l)),i=i.next;return n}(t,e)){var n=S(e,t);s(n,n.next)}}function f(t,e,n,i){var r=t;do{null===r.z&&(r.z=g(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,s,a,o,l,h=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;h>e&&(o++,i=i.nextZ);e++);for(l=h;o>0||l>0&&i;)0===o?(r=i,i=i.nextZ,l--):0!==l&&i?n.z<=i.z?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--):(r=n,n=n.nextZ,o--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,h*=2}while(a>1)}(r)}function g(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function v(t,e,n,i,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(i-o)-(n-a)*(e-o)>=0&&(n-a)*(s-o)-(r-a)*(i-o)>=0}function _(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&w(t,e)&&w(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function y(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,i){return!!(x(t,e)&&x(n,i)||x(t,i)&&x(n,e))||y(t,e,n)>0!=y(t,e,i)>0&&y(n,i,t)>0!=y(n,i,e)>0}function w(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function S(t,e){var n=new E(t.i,t.x,t.y),i=new E(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function M(t,e,n,i){var r=new E(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,n,i){for(var r=0,s=e,a=n-i;n>s;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}e.exports=i,i.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,a=Math.abs(C(t,0,s,n));if(r)for(var o=0,l=e.length;l>o;o++){var h=e[o]*n,c=l-1>o?e[o+1]*n:t.length;a-=Math.abs(C(t,h,c,n))}var u=0;for(o=0;o<i.length;o+=3){var d=i[o]*n,p=i[o+1]*n,f=i[o+2]*n;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var a=0;e>a;a++)n.vertices.push(t[r][s][a]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n}},{}]},{},[1])(1)}),function(){"use strict";var t=function(e){if(!(this instanceof t))return new t(e);if(this.version=1,this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),!this.support)return!1;var n=this;n.files=[],n.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",chunkNumberParameterName:"resumableChunkNumber",chunkSizeParameterName:"resumableChunkSize",currentChunkSizeParameterName:"resumableCurrentChunkSize",totalSizeParameterName:"resumableTotalSize",typeParameterName:"resumableType",identifierParameterName:"resumableIdentifier",fileNameParameterName:"resumableFilename",relativePathParameterName:"resumableRelativePath",totalChunksParameterName:"resumableTotalChunks",dragOverClass:"dragover",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,preprocessFile:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",testTarget:null,parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:100,chunkRetryInterval:void 0,permanentErrors:[400,401,403,404,409,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,clearInput:!0,chunkFormat:"blob",setChunkTypeFromFile:!1,maxFilesErrorCallback:function(t,e){var i=n.getOpt("maxFiles");alert("Please upload no more than "+i+" file"+(1===i?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(t,e){alert(t.fileName||t.name+"is too small, please upload files larger than "+i.formatSize(n.getOpt("minFileSize"))+".File size:"+t.size+" - File type:"+t.type+" - File object type:"+typeof t)},maxFileSize:void 0,maxFileSizeErrorCallback:function(t,e){alert(t.fileName||t.name+" is too large, please upload files less than "+i.formatSize(n.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(t,e){alert(t.fileName||t.name+" has type not allowed, please upload files of type "+n.getOpt("fileType")+".")}},n.opts=e||{},n.getOpt=function(e){var n=this;if(e instanceof Array){var r={};return i.each(e,function(t){r[t]=n.getOpt(t)}),r}if(n instanceof u){if(void 0!==n.opts[e])return n.opts[e];n=n.fileObj}if(n instanceof c){if(void 0!==n.opts[e])return n.opts[e];n=n.resumableObj}if(n instanceof t)return void 0!==n.opts[e]?n.opts[e]:n.defaults[e]},n.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},n.events=[],n.on=function(t,e){n.events.push(t.toLowerCase(),e)},n.fire=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var i=t[0].toLowerCase();for(e=0;e<=n.events.length;e+=2)n.events[e]==i&&n.events[e+1].apply(n,t.slice(1)),"catchall"==n.events[e]&&n.events[e+1].apply(null,t);"fileerror"==i&&n.fire("error",t[2],t[1]),"fileprogress"==i&&n.fire("progress")};var i={stopEvent:function(t){t.stopPropagation(),t.preventDefault()},each:function(t,e){if(void 0!==t.length){for(var n=0;n<t.length;n++)if(!1===e(t[n]))return}else for(n in t)if(!1===e(n,t[n]))return},generateUniqueIdentifier:function(t,e){var i=n.getOpt("generateUniqueIdentifier");if("function"==typeof i)return i(t,e);var r=t.webkitRelativePath||t.relativePath||t.fileName||t.name;return t.size+"-"+r.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(t,e){var n=!1;return i.each(t,function(t){return t!=e||(n=!0,!1)}),n},formatSize:function(t){return t<1024?t+" bytes":t<1048576?(t/1024).toFixed(0)+" KB":t<1073741824?(t/1024/1024).toFixed(1)+" MB":(t/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(t,e){var i=n.getOpt("target");if("test"===t&&n.getOpt("testTarget")&&(i="/"===n.getOpt("testTarget")?n.getOpt("target"):n.getOpt("testTarget")),"function"==typeof i)return i(e);var r=i.indexOf("?")<0?"?":"&",s=e.join("&");return s&&(i=i+r+s),i}},r=function(t){t.currentTarget.classList.remove(n.getOpt("dragOverClass")),i.stopEvent(t),t.dataTransfer&&t.dataTransfer.items?l(t.dataTransfer.items,t):t.dataTransfer&&t.dataTransfer.files&&l(t.dataTransfer.files,t)},s=function(t){t.currentTarget.classList.remove(n.getOpt("dragOverClass"))},a=function(t){t.preventDefault();var e=t.dataTransfer;n.indexOf(e.types,"Files")>=0?(t.stopPropagation(),e.dropEffect="copy",e.effectAllowed="copy",t.currentTarget.classList.add(n.getOpt("dragOverClass"))):(e.dropEffect="none",e.effectAllowed="none")};function o(t,e){if(!t||0===t.length)return e();t[0](function(){o(t.slice(1),e)})}function l(t,e){if(t.length){n.fire("beforeAdd");var i=[];o(Array.prototype.map.call(t,function(t){var e=t;return"function"==typeof t.webkitGetAsEntry&&(e=t.webkitGetAsEntry()),function t(e,n,i,r){var s;return e.isFile?e.file(function(t){t.relativePath=n+t.name,i.push(t),r()}):(e.isDirectory?s=e:e instanceof File&&i.push(e),"function"==typeof e.webkitGetAsEntry&&(s=e.webkitGetAsEntry()),s&&s.isDirectory?function(e,n,i,r){var s=e.createReader(),a=[];!function e(){s.readEntries(function(s){if(s.length)return a=a.concat(s),e();o(a.map(function(e){return t.bind(null,e,n,i)}),r)})}()}(s,n+s.name+"/",i,r):("function"==typeof e.getAsFile&&(e=e.getAsFile())instanceof File&&(e.relativePath=n+e.name,i.push(e)),void r()))}.bind(null,e,"",i)}),function(){i.length&&h(i,e)})}}var h=function(t,e){var r=0,s=n.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(void 0!==s.maxFiles&&s.maxFiles<t.length+n.files.length){if(1!==s.maxFiles||1!==n.files.length||1!==t.length)return s.maxFilesErrorCallback(t,r++),!1;n.removeFile(n.files[0])}var a=[],o=[],l=t.length,h=function(){if(!--l){if(!a.length&&!o.length)return;window.setTimeout(function(){n.fire("filesAdded",a,o)},0)}};i.each(t,function(t){var l=t.name,u=t.type;if(s.fileType.length>0){var d=!1;for(var p in s.fileType){s.fileType[p]=s.fileType[p].replace(/\s/g,"").toLowerCase();var f=(s.fileType[p].match(/^[^.][^/]+$/)?".":"")+s.fileType[p];if(l.substr(-1*f.length).toLowerCase()===f||-1!==f.indexOf("/")&&(-1!==f.indexOf("*")&&u.substr(0,f.indexOf("*"))===f.substr(0,f.indexOf("*"))||u===f)){d=!0;break}}if(!d)return s.fileTypeErrorCallback(t,r++),!0}if(void 0!==s.minFileSize&&t.size<s.minFileSize)return s.minFileSizeErrorCallback(t,r++),!0;if(void 0!==s.maxFileSize&&t.size>s.maxFileSize)return s.maxFileSizeErrorCallback(t,r++),!0;function g(i){n.getFromUniqueIdentifier(i)?o.push(t):function(){t.uniqueIdentifier=i;var r=new c(n,t,i);n.files.push(r),a.push(r),r.container=void 0!==e?e.srcElement:null,window.setTimeout(function(){n.fire("fileAdded",r,e)},0)}(),h()}var m=i.generateUniqueIdentifier(t,e);m&&"function"==typeof m.then?m.then(function(t){g(t)},function(){h()}):g(m)})};function c(t,e,n){var r=this;r.opts={},r.getOpt=t.getOpt,r._prevProgress=0,r.resumableObj=t,r.file=e,r.fileName=e.fileName||e.name,r.size=e.size,r.relativePath=e.relativePath||e.webkitRelativePath||r.fileName,r.uniqueIdentifier=n,r._pause=!1,r.container="",r.preprocessState=0;var s=void 0!==n,a=function(t,e){switch(t){case"progress":r.resumableObj.fire("fileProgress",r,e);break;case"error":r.abort(),s=!0,r.chunks=[],r.resumableObj.fire("fileError",r,e);break;case"success":if(s)return;r.resumableObj.fire("fileProgress",r,e),r.isComplete()&&r.resumableObj.fire("fileSuccess",r,e);break;case"retry":r.resumableObj.fire("fileRetry",r)}};return r.chunks=[],r.abort=function(){var t=0;i.each(r.chunks,function(e){"uploading"==e.status()&&(e.abort(),t++)}),t>0&&r.resumableObj.fire("fileProgress",r)},r.cancel=function(){var t=r.chunks;r.chunks=[],i.each(t,function(t){"uploading"==t.status()&&(t.abort(),r.resumableObj.uploadNextChunk())}),r.resumableObj.removeFile(r),r.resumableObj.fire("fileProgress",r)},r.retry=function(){r.bootstrap();var t=!1;r.resumableObj.on("chunkingComplete",function(){t||r.resumableObj.upload(),t=!0})},r.bootstrap=function(){r.abort(),s=!1,r.chunks=[],r._prevProgress=0;for(var t=r.getOpt("forceChunkSize")?Math.ceil:Math.floor,e=Math.max(t(r.file.size/r.getOpt("chunkSize")),1),n=0;n<e;n++)!function(t){window.setTimeout(function(){r.chunks.push(new u(r.resumableObj,r,t,a)),r.resumableObj.fire("chunkingProgress",r,t/e)},0)}(n);window.setTimeout(function(){r.resumableObj.fire("chunkingComplete",r)},0)},r.progress=function(){if(s)return 1;var t=0,e=!1;return i.each(r.chunks,function(n){"error"==n.status()&&(e=!0),t+=n.progress(!0)}),t=e?1:t>.99999?1:t,t=Math.max(r._prevProgress,t),r._prevProgress=t,t},r.isUploading=function(){var t=!1;return i.each(r.chunks,function(e){if("uploading"==e.status())return t=!0,!1}),t},r.isComplete=function(){var t=!1;return 1!==r.preprocessState&&(i.each(r.chunks,function(e){var n=e.status();if("pending"==n||"uploading"==n||1===e.preprocessState)return t=!0,!1}),!t)},r.pause=function(t){r._pause=void 0===t?!r._pause:t},r.isPaused=function(){return r._pause},r.preprocessFinished=function(){r.preprocessState=2,r.upload()},r.upload=function(){var t=!1;if(!1===r.isPaused()){var e=r.getOpt("preprocessFile");if("function"==typeof e)switch(r.preprocessState){case 0:return r.preprocessState=1,e(r),!0;case 1:return!0}i.each(r.chunks,function(e){if("pending"==e.status()&&1!==e.preprocessState)return e.send(),t=!0,!1})}return t},r.markChunksCompleted=function(t){if(r.chunks&&!(r.chunks.length<=t))for(var e=0;e<t;e++)r.chunks[e].markComplete=!0},r.resumableObj.fire("chunkingStart",r),r.bootstrap(),this}function u(t,e,n,r){var s=this;s.opts={},s.getOpt=t.getOpt,s.resumableObj=t,s.fileObj=e,s.fileObjSize=e.size,s.fileObjType=e.file.type,s.offset=n,s.callback=r,s.lastProgressCallback=new Date,s.tested=!1,s.retries=0,s.pendingRetry=!1,s.preprocessState=0,s.markComplete=!1;var a=s.getOpt("chunkSize");return s.loaded=0,s.startByte=s.offset*a,s.endByte=Math.min(s.fileObjSize,(s.offset+1)*a),s.fileObjSize-s.endByte<a&&!s.getOpt("forceChunkSize")&&(s.endByte=s.fileObjSize),s.xhr=null,s.test=function(){s.xhr=new XMLHttpRequest;var t=function(t){s.tested=!0;var e=s.status();"success"==e?(s.callback(e,s.message()),s.resumableObj.uploadNextChunk()):s.send()};s.xhr.addEventListener("load",t,!1),s.xhr.addEventListener("error",t,!1),s.xhr.addEventListener("timeout",t,!1);var e=[],n=s.getOpt("parameterNamespace"),r=s.getOpt("query");"function"==typeof r&&(r=r(s.fileObj,s)),i.each(r,function(t,i){e.push([encodeURIComponent(n+t),encodeURIComponent(i)].join("="))}),e=e.concat([["chunkNumberParameterName",s.offset+1],["chunkSizeParameterName",s.getOpt("chunkSize")],["currentChunkSizeParameterName",s.endByte-s.startByte],["totalSizeParameterName",s.fileObjSize],["typeParameterName",s.fileObjType],["identifierParameterName",s.fileObj.uniqueIdentifier],["fileNameParameterName",s.fileObj.fileName],["relativePathParameterName",s.fileObj.relativePath],["totalChunksParameterName",s.fileObj.chunks.length]].filter(function(t){return s.getOpt(t[0])}).map(function(t){return[n+s.getOpt(t[0]),encodeURIComponent(t[1])].join("=")})),s.xhr.open(s.getOpt("testMethod"),i.getTarget("test",e)),s.xhr.timeout=s.getOpt("xhrTimeout"),s.xhr.withCredentials=s.getOpt("withCredentials");var a=s.getOpt("headers");"function"==typeof a&&(a=a(s.fileObj,s)),i.each(a,function(t,e){s.xhr.setRequestHeader(t,e)}),s.xhr.send(null)},s.preprocessFinished=function(){s.preprocessState=2,s.send()},s.send=function(){var t=s.getOpt("preprocess");if("function"==typeof t)switch(s.preprocessState){case 0:return s.preprocessState=1,void t(s);case 1:return}if(!s.getOpt("testChunks")||s.tested){s.xhr=new XMLHttpRequest,s.xhr.upload.addEventListener("progress",function(t){new Date-s.lastProgressCallback>1e3*s.getOpt("throttleProgressCallbacks")&&(s.callback("progress"),s.lastProgressCallback=new Date),s.loaded=t.loaded||0},!1),s.loaded=0,s.pendingRetry=!1,s.callback("progress");var e=function(t){var e=s.status();if("success"==e||"error"==e)s.callback(e,s.message()),s.resumableObj.uploadNextChunk();else{s.callback("retry",s.message()),s.abort(),s.retries++;var n=s.getOpt("chunkRetryInterval");void 0!==n?(s.pendingRetry=!0,setTimeout(s.send,n)):s.send()}};s.xhr.addEventListener("load",e,!1),s.xhr.addEventListener("error",e,!1),s.xhr.addEventListener("timeout",e,!1);var n=[["chunkNumberParameterName",s.offset+1],["chunkSizeParameterName",s.getOpt("chunkSize")],["currentChunkSizeParameterName",s.endByte-s.startByte],["totalSizeParameterName",s.fileObjSize],["typeParameterName",s.fileObjType],["identifierParameterName",s.fileObj.uniqueIdentifier],["fileNameParameterName",s.fileObj.fileName],["relativePathParameterName",s.fileObj.relativePath],["totalChunksParameterName",s.fileObj.chunks.length]].filter(function(t){return s.getOpt(t[0])}).reduce(function(t,e){return t[s.getOpt(e[0])]=e[1],t},{}),r=s.getOpt("query");"function"==typeof r&&(r=r(s.fileObj,s)),i.each(r,function(t,e){n[t]=e});var a=s.fileObj.file.slice?"slice":s.fileObj.file.mozSlice?"mozSlice":s.fileObj.file.webkitSlice?"webkitSlice":"slice",o=s.fileObj.file[a](s.startByte,s.endByte,s.getOpt("setChunkTypeFromFile")?s.fileObj.file.type:""),l=null,h=[],c=s.getOpt("parameterNamespace");if("octet"===s.getOpt("method"))l=o,i.each(n,function(t,e){h.push([encodeURIComponent(c+t),encodeURIComponent(e)].join("="))});else if(l=new FormData,i.each(n,function(t,e){l.append(c+t,e),h.push([encodeURIComponent(c+t),encodeURIComponent(e)].join("="))}),"blob"==s.getOpt("chunkFormat"))l.append(c+s.getOpt("fileParameterName"),o,s.fileObj.fileName);else if("base64"==s.getOpt("chunkFormat")){var u=new FileReader;u.onload=function(t){l.append(c+s.getOpt("fileParameterName"),u.result),s.xhr.send(l)},u.readAsDataURL(o)}var d=i.getTarget("upload",h),p=s.getOpt("uploadMethod");s.xhr.open(p,d),"octet"===s.getOpt("method")&&s.xhr.setRequestHeader("Content-Type","application/octet-stream"),s.xhr.timeout=s.getOpt("xhrTimeout"),s.xhr.withCredentials=s.getOpt("withCredentials");var f=s.getOpt("headers");"function"==typeof f&&(f=f(s.fileObj,s)),i.each(f,function(t,e){s.xhr.setRequestHeader(t,e)}),"blob"==s.getOpt("chunkFormat")&&s.xhr.send(l)}else s.test()},s.abort=function(){s.xhr&&s.xhr.abort(),s.xhr=null},s.status=function(){return s.pendingRetry?"uploading":s.markComplete?"success":s.xhr?s.xhr.readyState<4?"uploading":200==s.xhr.status||201==s.xhr.status?"success":i.contains(s.getOpt("permanentErrors"),s.xhr.status)||s.retries>=s.getOpt("maxChunkRetries")?"error":(s.abort(),"pending"):"pending"},s.message=function(){return s.xhr?s.xhr.responseText:""},s.progress=function(t){void 0===t&&(t=!1);var e=t?(s.endByte-s.startByte)/s.fileObjSize:1;if(s.pendingRetry)return 0;switch(s.xhr&&s.xhr.status||s.markComplete||(e*=.95),s.status()){case"success":case"error":return 1*e;case"pending":return 0*e;default:return s.loaded/(s.endByte-s.startByte)*e}},this}return n.uploadNextChunk=function(){var t=!1;if(n.getOpt("prioritizeFirstAndLastChunk")&&(i.each(n.files,function(e){return e.chunks.length&&"pending"==e.chunks[0].status()&&0===e.chunks[0].preprocessState?(e.chunks[0].send(),t=!0,!1):e.chunks.length>1&&"pending"==e.chunks[e.chunks.length-1].status()&&0===e.chunks[e.chunks.length-1].preprocessState?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return!0;if(i.each(n.files,function(e){if(t=e.upload())return!1}),t)return!0;var e=!1;return i.each(n.files,function(t){if(!t.isComplete())return e=!0,!1}),e||n.fire("complete"),!1},n.assignBrowse=function(t,e){void 0===t.length&&(t=[t]),i.each(t,function(t){var i;"INPUT"===t.tagName&&"file"===t.type?i=t:((i=document.createElement("input")).setAttribute("type","file"),i.style.display="none",t.addEventListener("click",function(){i.style.opacity=0,i.style.display="block",i.focus(),i.click(),i.style.display="none"},!1),t.appendChild(i));var r=n.getOpt("maxFiles");void 0===r||1!=r?i.setAttribute("multiple","multiple"):i.removeAttribute("multiple"),e?i.setAttribute("webkitdirectory","webkitdirectory"):i.removeAttribute("webkitdirectory");var s=n.getOpt("fileType");void 0!==s&&s.length>=1?i.setAttribute("accept",s.map(function(t){return(t=t.replace(/\s/g,"").toLowerCase()).match(/^[^.][^/]+$/)&&(t="."+t),t}).join(",")):i.removeAttribute("accept"),i.addEventListener("change",function(t){h(t.target.files,t),n.getOpt("clearInput")&&(t.target.value="")},!1)})},n.assignDrop=function(t){void 0===t.length&&(t=[t]),i.each(t,function(t){t.addEventListener("dragover",a,!1),t.addEventListener("dragenter",a,!1),t.addEventListener("dragleave",s,!1),t.addEventListener("drop",r,!1)})},n.unAssignDrop=function(t){void 0===t.length&&(t=[t]),i.each(t,function(t){t.removeEventListener("dragover",a),t.removeEventListener("dragenter",a),t.removeEventListener("dragleave",s),t.removeEventListener("drop",r)})},n.isUploading=function(){var t=!1;return i.each(n.files,function(e){if(e.isUploading())return t=!0,!1}),t},n.upload=function(){if(!n.isUploading()){n.fire("uploadStart");for(var t=1;t<=n.getOpt("simultaneousUploads");t++)n.uploadNextChunk()}},n.pause=function(){i.each(n.files,function(t){t.abort()}),n.fire("pause")},n.cancel=function(){n.fire("beforeCancel");for(var t=n.files.length-1;t>=0;t--)n.files[t].cancel();n.fire("cancel")},n.progress=function(){var t=0,e=0;return i.each(n.files,function(n){t+=n.progress()*n.size,e+=n.size}),e>0?t/e:0},n.addFile=function(t,e){h([t],e)},n.addFiles=function(t,e){h(t,e)},n.removeFile=function(t){for(var e=n.files.length-1;e>=0;e--)n.files[e]===t&&n.files.splice(e,1)},n.getFromUniqueIdentifier=function(t){var e=!1;return i.each(n.files,function(n){n.uniqueIdentifier==t&&(e=n)}),e},n.getSize=function(){var t=0;return i.each(n.files,function(e){t+=e.size}),t},n.handleDropEvent=function(t){r(t)},n.handleChangeEvent=function(t){h(t.target.files,t),t.target.value=""},n.updateQuery=function(t){n.opts.query=t},this};"undefined"!=typeof module?(module.exports=t,module.exports.Resumable=t):"function"==typeof define&&define.amd?define(function(){return t}):window.Resumable=t}(),function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,i=this.data.length;e<i;e++){var r=[],s=this.data.charCodeAt(e);s>65536?(r[0]=240|(1835008&s)>>>18,r[1]=128|(258048&s)>>>12,r[2]=128|(4032&s)>>>6,r[3]=128|63&s):s>2048?(r[0]=224|(61440&s)>>>12,r[1]=128|(4032&s)>>>6,r[2]=128|63&s):s>128?(r[0]=192|(1984&s)>>>6,r[1]=128|63&s):r[0]=s,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;e<n;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[i][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(var i=-1;i<=7;i++)e+i<=-1||this.moduleCount<=e+i||(this.modules[t+n][e+i]=0<=n&&n<=6&&(0==i||6==i)||0<=i&&i<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=i&&i<=4)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;n<8;n++){this.makeImpl(!0,n);var i=r.getLostPoint(this);(0==n||t>i)&&(t=i,e=n)}return e},createMovieClip:function(t,e,n){var i=t.createEmptyMovieClip(e,n);this.make();for(var r=0;r<this.modules.length;r++)for(var s=1*r,a=0;a<this.modules[r].length;a++){var o=1*a;this.modules[r][a]&&(i.beginFill(0,100),i.moveTo(o,s),i.lineTo(o+1,s),i.lineTo(o+1,s+1),i.lineTo(o,s+1),i.endFill())}return i},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=r.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var i=t[e],s=t[n];if(null==this.modules[i][s])for(var a=-2;a<=2;a++)for(var o=-2;o<=2;o++)this.modules[i+a][s+o]=-2==a||2==a||-2==o||2==o||0==a&&0==o}},setupTypeNumber:function(t){for(var e=r.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var i=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=i}for(n=0;n<18;n++)i=!t&&1==(e>>n&1),this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=i},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,i=r.getBCHTypeInfo(n),s=0;s<15;s++){var a=!t&&1==(i>>s&1);s<6?this.modules[s][8]=a:s<8?this.modules[s+1][8]=a:this.modules[this.moduleCount-15+s][8]=a}for(s=0;s<15;s++)a=!t&&1==(i>>s&1),s<8?this.modules[8][this.moduleCount-s-1]=a:s<9?this.modules[8][15-s-1+1]=a:this.modules[8][15-s-1]=a;this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,i=this.moduleCount-1,s=7,a=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var l=0;l<2;l++)if(null==this.modules[i][o-l]){var h=!1;a<t.length&&(h=1==(t[a]>>>s&1)),r.getMask(e,i,o-l)&&(h=!h),this.modules[i][o-l]=h,-1==--s&&(a++,s=7)}if((i+=n)<0||this.moduleCount<=i){i-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,i){for(var s=l.getRSBlocks(t,n),a=new h,o=0;o<i.length;o++){var c=i[o];a.put(c.mode,4),a.put(c.getLength(),r.getLengthInBits(c.mode,t)),c.write(a)}var u=0;for(o=0;o<s.length;o++)u+=s[o].dataCount;if(a.getLengthInBits()>8*u)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*u+")");for(a.getLengthInBits()+4<=8*u&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*u||(a.put(e.PAD0,8),a.getLengthInBits()>=8*u));)a.put(e.PAD1,8);return e.createBytes(a,s)},e.createBytes=function(t,e){for(var n=0,i=0,s=0,a=new Array(e.length),l=new Array(e.length),h=0;h<e.length;h++){var c=e[h].dataCount,u=e[h].totalCount-c;i=Math.max(i,c),s=Math.max(s,u),a[h]=new Array(c);for(var d=0;d<a[h].length;d++)a[h][d]=255&t.buffer[d+n];n+=c;var p=r.getErrorCorrectPolynomial(u),f=new o(a[h],p.getLength()-1).mod(p);for(l[h]=new Array(p.getLength()-1),d=0;d<l[h].length;d++){var g=d+f.getLength()-l[h].length;l[h][d]=g>=0?f.get(g):0}}var m=0;for(d=0;d<e.length;d++)m+=e[d].totalCount;var v=new Array(m),_=0;for(d=0;d<i;d++)for(h=0;h<e.length;h++)d<a[h].length&&(v[_++]=a[h][d]);for(d=0;d<s;d++)for(h=0;h<e.length;h++)d<l[h].length&&(v[_++]=l[h][d]);return v};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},r={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;r.getBCHDigit(e)-r.getBCHDigit(r.G15)>=0;)e^=r.G15<<r.getBCHDigit(e)-r.getBCHDigit(r.G15);return(t<<10|e)^r.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;r.getBCHDigit(e)-r.getBCHDigit(r.G18)>=0;)e^=r.G18<<r.getBCHDigit(e)-r.getBCHDigit(r.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return r.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case 0:return(e+n)%2==0;case 1:return e%2==0;case 2:return n%3==0;case 3:return(e+n)%3==0;case 4:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case 5:return e*n%2+e*n%3==0;case 6:return(e*n%2+e*n%3)%2==0;case 7:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new o([1],0),n=0;n<t;n++)e=e.multiply(new o([1,s.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,i=0;i<e;i++)for(var r=0;r<e;r++){for(var s=0,a=t.isDark(i,r),o=-1;o<=1;o++)if(!(i+o<0||e<=i+o))for(var l=-1;l<=1;l++)r+l<0||e<=r+l||0==o&&0==l||a==t.isDark(i+o,r+l)&&s++;s>5&&(n+=3+s-5)}for(i=0;i<e-1;i++)for(r=0;r<e-1;r++){var h=0;t.isDark(i,r)&&h++,t.isDark(i+1,r)&&h++,t.isDark(i,r+1)&&h++,t.isDark(i+1,r+1)&&h++,0!=h&&4!=h||(n+=3)}for(i=0;i<e;i++)for(r=0;r<e-6;r++)t.isDark(i,r)&&!t.isDark(i,r+1)&&t.isDark(i,r+2)&&t.isDark(i,r+3)&&t.isDark(i,r+4)&&!t.isDark(i,r+5)&&t.isDark(i,r+6)&&(n+=40);for(r=0;r<e;r++)for(i=0;i<e-6;i++)t.isDark(i,r)&&!t.isDark(i+1,r)&&t.isDark(i+2,r)&&t.isDark(i+3,r)&&t.isDark(i+4,r)&&!t.isDark(i+5,r)&&t.isDark(i+6,r)&&(n+=40);var c=0;for(r=0;r<e;r++)for(i=0;i<e;i++)t.isDark(i,r)&&c++;return n+Math.abs(100*c/e/e-50)/5*10}},s={glog:function(t){if(t<1)throw new Error("glog("+t+")");return s.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return s.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},a=0;a<8;a++)s.EXP_TABLE[a]=1<<a;for(a=8;a<256;a++)s.EXP_TABLE[a]=s.EXP_TABLE[a-4]^s.EXP_TABLE[a-5]^s.EXP_TABLE[a-6]^s.EXP_TABLE[a-8];for(a=0;a<255;a++)s.LOG_TABLE[s.EXP_TABLE[a]]=a;function o(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var i=0;i<t.length-n;i++)this.num[i]=t[i+n]}function l(t,e){this.totalCount=t,this.dataCount=e}function h(){this.buffer=[],this.length=0}o.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var i=0;i<t.getLength();i++)e[n+i]^=s.gexp(s.glog(this.get(n))+s.glog(t.get(i)));return new o(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=s.glog(this.get(0))-s.glog(t.get(0)),n=new Array(this.getLength()),i=0;i<this.getLength();i++)n[i]=this.get(i);for(i=0;i<t.getLength();i++)n[i]^=s.gexp(s.glog(t.get(i))+e);return new o(n,0).mod(t)}},l.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],l.getRSBlocks=function(t,e){var n=l.getRsBlockTable(t,e);if(null==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var i=n.length/3,r=[],s=0;s<i;s++)for(var a=n[3*s+0],o=n[3*s+1],h=n[3*s+2],c=0;c<a;c++)r.push(new l(o,h));return r},l.getRsBlockTable=function(t,e){switch(e){case i.L:return l.RS_BLOCK_TABLE[4*(t-1)+0];case i.M:return l.RS_BLOCK_TABLE[4*(t-1)+1];case i.Q:return l.RS_BLOCK_TABLE[4*(t-1)+2];case i.H:return l.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},h.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var c=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function u(){var t=!1,e=navigator.userAgent;if(/android/i.test(e)){t=!0;var n=e.toString().match(/android ([0-9]\.[0-9])/i);n&&n[1]&&(t=parseFloat(n[1]))}return t}var d=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){var e=this._htOption,n=this._el,i=t.getModuleCount();function r(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var i in e)e.hasOwnProperty(i)&&n.setAttribute(i,e[i]);return n}Math.floor(e.width/i),Math.floor(e.height/i),this.clear();var s=r("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:e.colorLight});s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.appendChild(s),s.appendChild(r("rect",{fill:e.colorLight,width:"100%",height:"100%"})),s.appendChild(r("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;a<i;a++)for(var o=0;o<i;o++)if(t.isDark(a,o)){var l=r("use",{x:String(o),y:String(a)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),s.appendChild(l)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),p="svg"===document.documentElement.tagName.toLowerCase()?d:"undefined"==typeof CanvasRenderingContext2D?function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,n=this._el,i=t.getModuleCount(),r=Math.floor(e.width/i),s=Math.floor(e.height/i),a=['<table style="border:0;border-collapse:collapse;">'],o=0;o<i;o++){a.push("<tr>");for(var l=0;l<i;l++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+r+"px;height:"+s+"px;background-color:"+(t.isDark(o,l)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),n.innerHTML=a.join("");var h=n.childNodes[0],c=(e.width-h.offsetWidth)/2,u=(e.height-h.offsetHeight)/2;c>0&&u>0&&(h.style.margin=u+"px "+c+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,n=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,i,r,s,a,o,l,h,c){if("nodeName"in t&&/img/i.test(t.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*e;else void 0===h&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);n.apply(this,arguments)}}var i=function(t,e){this._bIsPainted=!1,this._android=u(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return i.prototype.draw=function(t){var e=this._elImage,n=this._oContext,i=this._htOption,r=t.getModuleCount(),s=i.width/r,a=i.height/r,o=Math.round(s),l=Math.round(a);e.style.display="none",this.clear();for(var h=0;h<r;h++)for(var c=0;c<r;c++){var u=t.isDark(h,c),d=c*s,p=h*a;n.strokeStyle=u?i.colorDark:i.colorLight,n.lineWidth=1,n.fillStyle=u?i.colorDark:i.colorLight,n.fillRect(d,p,s,a),n.strokeRect(Math.floor(d)+.5,Math.floor(p)+.5,o,l),n.strokeRect(Math.ceil(d)-.5,Math.ceil(p)-.5,o,l)}this._bIsPainted=!0},i.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var n=this;if(n._fFail=e,n._fSuccess=t,null===n._bSupportDataURI){var i=document.createElement("img"),r=function(){n._bSupportDataURI=!1,n._fFail&&n._fFail.call(n)};return i.onabort=r,i.onerror=r,i.onload=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)},void(i.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===n._bSupportDataURI&&n._fSuccess?n._fSuccess.call(n):!1===n._bSupportDataURI&&n._fFail&&n._fFail.call(n)}.call(this,t)},i.prototype.isPainted=function(){return this._bIsPainted},i.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},i.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},i}();(QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(p=d),this._android=u(),this._el=t,this._oQRCode=null,this._oDrawing=new p(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(function(t,e){for(var n=1,r=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),s=0,a=c.length;s<=a;s++){var o=0;switch(e){case i.L:o=c[s][0];break;case i.M:o=c[s][1];break;case i.Q:o=c[s][2];break;case i.H:o=c[s][3]}if(r<=o)break;n++}if(n>c.length)throw new Error("Too long data");return n}(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=i}(),"undefined"!=typeof module&&(module.exports=QRCode),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).opentype={})}(this,function(t){"use strict";var e,n;String.prototype.codePointAt||(e=function(){try{var t={},e=Object.defineProperty,n=e(t,t,t)&&e}catch(t){}return n}(),n=function(t){if(null==this)throw TypeError();var e=String(this),n=e.length,i=t?Number(t):0;if(i!=i&&(i=0),!(i<0||i>=n)){var r,s=e.charCodeAt(i);return s>=55296&&s<=56319&&n>i+1&&(r=e.charCodeAt(i+1))>=56320&&r<=57343?1024*(s-55296)+r-56320+65536:s}},e?e(String.prototype,"codePointAt",{value:n,configurable:!0,writable:!0}):String.prototype.codePointAt=n);var i=0,r=-3;function s(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function a(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new s,this.dtree=new s}var o=new s,l=new s,h=new Uint8Array(30),c=new Uint16Array(30),u=new Uint8Array(30),d=new Uint16Array(30),p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=new s,g=new Uint8Array(320);function m(t,e,n,i){var r,s;for(r=0;r<n;++r)t[r]=0;for(r=0;r<30-n;++r)t[r+n]=r/n|0;for(s=i,r=0;r<30;++r)e[r]=s,s+=1<<t[r]}var v=new Uint16Array(16);function _(t,e,n,i){var r,s;for(r=0;r<16;++r)t.table[r]=0;for(r=0;r<i;++r)t.table[e[n+r]]++;for(t.table[0]=0,s=0,r=0;r<16;++r)v[r]=s,s+=t.table[r];for(r=0;r<i;++r)e[n+r]&&(t.trans[v[e[n+r]]++]=r)}function y(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=1&t.tag;return t.tag>>>=1,e}function x(t,e,n){if(!e)return n;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var i=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,i+n}function b(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=0,i=0,r=0,s=t.tag;do{i=2*i+(1&s),s>>>=1,++r,n+=e.table[r],i-=e.table[r]}while(i>=0);return t.tag=s,t.bitcount-=r,e.trans[n+i]}function w(t,e,n){var i,r,s,a,o,l;for(i=x(t,5,257),r=x(t,5,1),s=x(t,4,4),a=0;a<19;++a)g[a]=0;for(a=0;a<s;++a){var h=x(t,3,0);g[p[a]]=h}for(_(f,g,0,19),o=0;o<i+r;){var c=b(t,f);switch(c){case 16:var u=g[o-1];for(l=x(t,2,3);l;--l)g[o++]=u;break;case 17:for(l=x(t,3,3);l;--l)g[o++]=0;break;case 18:for(l=x(t,7,11);l;--l)g[o++]=0;break;default:g[o++]=c}}_(e,g,0,i),_(n,g,i,r)}function S(t,e,n){for(;;){var r,s,a,o,l=b(t,e);if(256===l)return i;if(l<256)t.dest[t.destLen++]=l;else for(r=x(t,h[l-=257],c[l]),s=b(t,n),o=a=t.destLen-x(t,u[s],d[s]);o<a+r;++o)t.dest[t.destLen++]=t.dest[o]}}function M(t){for(var e,n;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if((e=256*(e=t.source[t.sourceIndex+1])+t.source[t.sourceIndex])!==(65535&~(256*t.source[t.sourceIndex+3]+t.source[t.sourceIndex+2])))return r;for(t.sourceIndex+=4,n=e;n;--n)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,i}!function(t,e){var n;for(n=0;n<7;++n)t.table[n]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,n=0;n<24;++n)t.trans[n]=256+n;for(n=0;n<144;++n)t.trans[24+n]=n;for(n=0;n<8;++n)t.trans[168+n]=280+n;for(n=0;n<112;++n)t.trans[176+n]=144+n;for(n=0;n<5;++n)e.table[n]=0;for(e.table[5]=32,n=0;n<32;++n)e.trans[n]=n}(o,l),m(h,c,4,3),m(u,d,2,1),h[28]=0,c[28]=258;var T=function(t,e){var n,s,h=new a(t,e);do{switch(n=y(h),x(h,2,0)){case 0:s=M(h);break;case 1:s=S(h,o,l);break;case 2:w(h,h.ltree,h.dtree),s=S(h,h.ltree,h.dtree);break;default:s=r}if(s!==i)throw new Error("Data error")}while(!n);return h.destLen<h.dest.length?"function"==typeof h.dest.slice?h.dest.slice(0,h.destLen):h.dest.subarray(0,h.destLen):h.dest};function E(t,e,n,i,r){return Math.pow(1-r,3)*t+3*Math.pow(1-r,2)*r*e+3*(1-r)*Math.pow(r,2)*n+Math.pow(r,3)*i}function C(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function A(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function R(t){throw new Error(t)}function L(t,e){t||R(e)}C.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},C.prototype.addPoint=function(t,e){"number"==typeof t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),"number"==typeof e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},C.prototype.addX=function(t){this.addPoint(t,null)},C.prototype.addY=function(t){this.addPoint(null,t)},C.prototype.addBezier=function(t,e,n,i,r,s,a,o){var l=[t,e],h=[n,i],c=[r,s],u=[a,o];this.addPoint(t,e),this.addPoint(a,o);for(var d=0;d<=1;d++){var p=6*l[d]-12*h[d]+6*c[d],f=-3*l[d]+9*h[d]-9*c[d]+3*u[d],g=3*h[d]-3*l[d];if(0!==f){var m=Math.pow(p,2)-4*g*f;if(!(m<0)){var v=(-p+Math.sqrt(m))/(2*f);0<v&&v<1&&(0===d&&this.addX(E(l[d],h[d],c[d],u[d],v)),1===d&&this.addY(E(l[d],h[d],c[d],u[d],v)));var _=(-p-Math.sqrt(m))/(2*f);0<_&&_<1&&(0===d&&this.addX(E(l[d],h[d],c[d],u[d],_)),1===d&&this.addY(E(l[d],h[d],c[d],u[d],_)))}}else{if(0===p)continue;var y=-g/p;0<y&&y<1&&(0===d&&this.addX(E(l[d],h[d],c[d],u[d],y)),1===d&&this.addY(E(l[d],h[d],c[d],u[d],y)))}}},C.prototype.addQuad=function(t,e,n,i,r,s){var a=t+2/3*(n-t),o=e+2/3*(i-e),l=a+1/3*(r-t),h=o+1/3*(s-e);this.addBezier(t,e,a,o,l,h,r,s)},A.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},A.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},A.prototype.curveTo=A.prototype.bezierCurveTo=function(t,e,n,i,r,s){this.commands.push({type:"C",x1:t,y1:e,x2:n,y2:i,x:r,y:s})},A.prototype.quadTo=A.prototype.quadraticCurveTo=function(t,e,n,i){this.commands.push({type:"Q",x1:t,y1:e,x:n,y:i})},A.prototype.close=A.prototype.closePath=function(){this.commands.push({type:"Z"})},A.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof C){var e=t;return this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),void this.close()}Array.prototype.push.apply(this.commands,t)},A.prototype.getBoundingBox=function(){for(var t=new C,e=0,n=0,i=0,r=0,s=0;s<this.commands.length;s++){var a=this.commands[s];switch(a.type){case"M":t.addPoint(a.x,a.y),e=i=a.x,n=r=a.y;break;case"L":t.addPoint(a.x,a.y),i=a.x,r=a.y;break;case"Q":t.addQuad(i,r,a.x1,a.y1,a.x,a.y),i=a.x,r=a.y;break;case"C":t.addBezier(i,r,a.x1,a.y1,a.x2,a.y2,a.x,a.y),i=a.x,r=a.y;break;case"Z":i=e,r=n;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t},A.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var n=this.commands[e];"M"===n.type?t.moveTo(n.x,n.y):"L"===n.type?t.lineTo(n.x,n.y):"C"===n.type?t.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):"Q"===n.type?t.quadraticCurveTo(n.x1,n.y1,n.x,n.y):"Z"===n.type&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},A.prototype.toPathData=function(t){function e(e){return Math.round(e)===e?""+Math.round(e):e.toFixed(t)}function n(){for(var t=arguments,n="",i=0;i<arguments.length;i+=1){var r=t[i];r>=0&&i>0&&(n+=" "),n+=e(r)}return n}t=void 0!==t?t:2;for(var i="",r=0;r<this.commands.length;r+=1){var s=this.commands[r];"M"===s.type?i+="M"+n(s.x,s.y):"L"===s.type?i+="L"+n(s.x,s.y):"C"===s.type?i+="C"+n(s.x1,s.y1,s.x2,s.y2,s.x,s.y):"Q"===s.type?i+="Q"+n(s.x1,s.y1,s.x,s.y):"Z"===s.type&&(i+="Z")}return i},A.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&"black"!==this.fill&&(null===this.fill?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+"/>"},A.prototype.toDOMElement=function(t){var e=this.toPathData(t),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n};var P={fail:R,argument:L,assert:L},k={},D={},I={};function O(t){return function(){return t}}D.BYTE=function(t){return P.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},I.BYTE=O(1),D.CHAR=function(t){return[t.charCodeAt(0)]},I.CHAR=O(1),D.CHARARRAY=function(t){for(var e=[],n=0;n<t.length;n+=1)e[n]=t.charCodeAt(n);return e},I.CHARARRAY=function(t){return t.length},D.USHORT=function(t){return[t>>8&255,255&t]},I.USHORT=O(2),D.SHORT=function(t){return t>=32768&&(t=-(65536-t)),[t>>8&255,255&t]},I.SHORT=O(2),D.UINT24=function(t){return[t>>16&255,t>>8&255,255&t]},I.UINT24=O(3),D.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},I.ULONG=O(4),D.LONG=function(t){return t>=2147483648&&(t=-(4294967296-t)),[t>>24&255,t>>16&255,t>>8&255,255&t]},I.LONG=O(4),D.FIXED=D.ULONG,I.FIXED=I.ULONG,D.FWORD=D.SHORT,I.FWORD=I.SHORT,D.UFWORD=D.USHORT,I.UFWORD=I.USHORT,D.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t]},I.LONGDATETIME=O(8),D.TAG=function(t){return P.argument(4===t.length,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},I.TAG=O(4),D.Card8=D.BYTE,I.Card8=I.BYTE,D.Card16=D.USHORT,I.Card16=I.USHORT,D.OffSize=D.BYTE,I.OffSize=I.BYTE,D.SID=D.USHORT,I.SID=I.USHORT,D.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?[247+((t-=108)>>8),255&t]:t>=-1131&&t<=-108?[251+((t=-t-108)>>8),255&t]:t>=-32768&&t<=32767?D.NUMBER16(t):D.NUMBER32(t)},I.NUMBER=function(t){return D.NUMBER(t).length},D.NUMBER16=function(t){return[28,t>>8&255,255&t]},I.NUMBER16=O(3),D.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,255&t]},I.NUMBER32=O(5),D.REAL=function(t){var e=t.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(n){var i=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));e=(Math.round(t*i)/i).toString()}for(var r="",s=0,a=e.length;s<a;s+=1){var o=e[s];r+="e"===o?"-"===e[++s]?"c":"b":"."===o?"a":"-"===o?"e":o}for(var l=[30],h=0,c=(r+=1&r.length?"f":"ff").length;h<c;h+=2)l.push(parseInt(r.substr(h,2),16));return l},I.REAL=function(t){return D.REAL(t).length},D.NAME=D.CHARARRAY,I.NAME=I.CHARARRAY,D.STRING=D.CHARARRAY,I.STRING=I.CHARARRAY,k.UTF8=function(t,e,n){for(var i=[],r=n,s=0;s<r;s++,e+=1)i[s]=t.getUint8(e);return String.fromCharCode.apply(null,i)},k.UTF16=function(t,e,n){for(var i=[],r=n/2,s=0;s<r;s++,e+=2)i[s]=t.getUint16(e);return String.fromCharCode.apply(null,i)},D.UTF16=function(t){for(var e=[],n=0;n<t.length;n+=1){var i=t.charCodeAt(n);e[e.length]=i>>8&255,e[e.length]=255&i}return e},I.UTF16=function(t){return 2*t.length};var B={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};k.MACSTRING=function(t,e,n,i){var r=B[i];if(void 0!==r){for(var s="",a=0;a<n;a++){var o=t.getUint8(e+a);s+=o<=127?String.fromCharCode(o):r[127&o]}return s}};var F,N="function"==typeof WeakMap&&new WeakMap;function U(t){return t>=-128&&t<=127}function z(t,e,n){for(var i=0,r=t.length;e<r&&i<64&&0===t[e];)++e,++i;return n.push(128|i-1),e}function G(t,e,n){for(var i=0,r=t.length,s=e;s<r&&i<64;){var a=t[s];if(!U(a))break;if(0===a&&s+1<r&&0===t[s+1])break;++s,++i}n.push(i-1);for(var o=e;o<s;++o)n.push(t[o]+256&255);return s}function H(t,e,n){for(var i=0,r=t.length,s=e;s<r&&i<64;){var a=t[s];if(0===a)break;if(U(a)&&s+1<r&&U(t[s+1]))break;++s,++i}n.push(64|i-1);for(var o=e;o<s;++o){var l=t[o];n.push(l+65536>>8&255,l+256&255)}return s}D.MACSTRING=function(t,e){var n=function(t){if(!F)for(var e in F={},B)F[e]=new String(e);var n=F[t];if(void 0!==n){if(N){var i=N.get(n);if(void 0!==i)return i}var r=B[t];if(void 0!==r){for(var s={},a=0;a<r.length;a++)s[r.charCodeAt(a)]=a+128;return N&&N.set(n,s),s}}}(e);if(void 0!==n){for(var i=[],r=0;r<t.length;r++){var s=t.charCodeAt(r);if(s>=128&&void 0===(s=n[s]))return;i[r]=s}return i}},I.MACSTRING=function(t,e){var n=D.MACSTRING(t,e);return void 0!==n?n.length:0},D.VARDELTAS=function(t){for(var e=0,n=[];e<t.length;){var i=t[e];e=0===i?z(t,e,n):i>=-128&&i<=127?G(t,e,n):H(t,e,n)}return n},D.INDEX=function(t){for(var e=1,n=[e],i=[],r=0;r<t.length;r+=1){var s=D.OBJECT(t[r]);Array.prototype.push.apply(i,s),e+=s.length,n.push(e)}if(0===i.length)return[0,0];for(var a=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,D.BYTE,D.USHORT,D.UINT24,D.ULONG][o],h=0;h<n.length;h+=1){var c=l(n[h]);Array.prototype.push.apply(a,c)}return Array.prototype.concat(D.Card16(t.length),D.OffSize(o),a,i)},I.INDEX=function(t){return D.INDEX(t).length},D.DICT=function(t){for(var e=[],n=Object.keys(t),i=n.length,r=0;r<i;r+=1){var s=parseInt(n[r],0),a=t[s];e=(e=e.concat(D.OPERAND(a.value,a.type))).concat(D.OPERATOR(s))}return e},I.DICT=function(t){return D.DICT(t).length},D.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},D.OPERAND=function(t,e){var n=[];if(Array.isArray(e))for(var i=0;i<e.length;i+=1)P.argument(t.length===e.length,"Not enough arguments given for type"+e),n=n.concat(D.OPERAND(t[i],e[i]));else if("SID"===e)n=n.concat(D.NUMBER(t));else if("offset"===e)n=n.concat(D.NUMBER32(t));else if("number"===e)n=n.concat(D.NUMBER(t));else{if("real"!==e)throw new Error("Unknown operand type "+e);n=n.concat(D.REAL(t))}return n},D.OP=D.BYTE,I.OP=I.BYTE;var W="function"==typeof WeakMap&&new WeakMap;function V(t,e,n){for(var i=0;i<e.length;i+=1){var r=e[i];this[r.name]=r.value}if(this.tableName=t,this.fields=e,n)for(var s=Object.keys(n),a=0;a<s.length;a+=1){var o=s[a],l=n[o];void 0!==this[o]&&(this[o]=l)}}function j(t,e,n){void 0===n&&(n=e.length);var i=new Array(e.length+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var r=0;r<e.length;r++)i[r+1]={name:t+r,type:"USHORT",value:e[r]};return i}function X(t,e,n){var i=e.length,r=new Array(i+1);r[0]={name:t+"Count",type:"USHORT",value:i};for(var s=0;s<i;s++)r[s+1]={name:t+s,type:"TABLE",value:n(e[s],s)};return r}function Y(t,e,n){var i=e.length,r=[];r[0]={name:t+"Count",type:"USHORT",value:i};for(var s=0;s<i;s++)r=r.concat(n(e[s],s));return r}function Z(t){1===t.format?V.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(j("glyph",t.glyphs))):P.assert(!1,"Can't create coverage table format 2 yet.")}function q(t){V.call(this,"scriptListTable",Y("scriptRecord",t,function(t,e){var n=t.script,i=n.defaultLangSys;return P.assert(!!i,"Unable to write GSUB: script "+t.tag+" has no default language system."),[{name:"scriptTag"+e,type:"TAG",value:t.tag},{name:"script"+e,type:"TABLE",value:new V("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new V("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(j("featureIndex",i.featureIndexes)))}].concat(Y("langSys",n.langSysRecords,function(t,e){var n=t.langSys;return[{name:"langSysTag"+e,type:"TAG",value:t.tag},{name:"langSys"+e,type:"TABLE",value:new V("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(j("featureIndex",n.featureIndexes)))}]})))}]}))}function J(t){V.call(this,"featureListTable",Y("featureRecord",t,function(t,e){var n=t.feature;return[{name:"featureTag"+e,type:"TAG",value:t.tag},{name:"feature"+e,type:"TABLE",value:new V("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(j("lookupListIndex",n.lookupListIndexes)))}]}))}function K(t,e){V.call(this,"lookupListTable",X("lookup",t,function(t){var n=e[t.lookupType];return P.assert(!!n,"Unable to write GSUB lookup type "+t.lookupType+" tables."),new V("lookupTable",[{name:"lookupType",type:"USHORT",value:t.lookupType},{name:"lookupFlag",type:"USHORT",value:t.lookupFlag}].concat(X("subtable",t.subtables,n)))}))}D.CHARSTRING=function(t){if(W){var e=W.get(t);if(void 0!==e)return e}for(var n=[],i=t.length,r=0;r<i;r+=1){var s=t[r];n=n.concat(D[s.type](s.value))}return W&&W.set(t,n),n},I.CHARSTRING=function(t){return D.CHARSTRING(t).length},D.OBJECT=function(t){var e=D[t.type];return P.argument(void 0!==e,"No encoding function for type "+t.type),e(t.value)},I.OBJECT=function(t){var e=I[t.type];return P.argument(void 0!==e,"No sizeOf function for type "+t.type),e(t.value)},D.TABLE=function(t){for(var e=[],n=t.fields.length,i=[],r=[],s=0;s<n;s+=1){var a=t.fields[s],o=D[a.type];P.argument(void 0!==o,"No encoding function for field type "+a.type+" ("+a.name+")");var l=t[a.name];void 0===l&&(l=a.value);var h=o(l);"TABLE"===a.type?(r.push(e.length),e=e.concat([0,0]),i.push(h)):e=e.concat(h)}for(var c=0;c<i.length;c+=1){var u=r[c],d=e.length;P.argument(d<65536,"Table "+t.tableName+" too big."),e[u]=d>>8,e[u+1]=255&d,e=e.concat(i[c])}return e},I.TABLE=function(t){for(var e=0,n=t.fields.length,i=0;i<n;i+=1){var r=t.fields[i],s=I[r.type];P.argument(void 0!==s,"No sizeOf function for field type "+r.type+" ("+r.name+")");var a=t[r.name];void 0===a&&(a=r.value),e+=s(a),"TABLE"===r.type&&(e+=2)}return e},D.RECORD=D.TABLE,I.RECORD=I.TABLE,D.LITERAL=function(t){return t},I.LITERAL=function(t){return t.length},V.prototype.encode=function(){return D.TABLE(this)},V.prototype.sizeOf=function(){return I.TABLE(this)},Z.prototype=Object.create(V.prototype),Z.prototype.constructor=Z,q.prototype=Object.create(V.prototype),q.prototype.constructor=q,J.prototype=Object.create(V.prototype),J.prototype.constructor=J,K.prototype=Object.create(V.prototype),K.prototype.constructor=K;var Q={Table:V,Record:V,Coverage:Z,ScriptList:q,FeatureList:J,LookupList:K,ushortList:j,tableList:X,recordList:Y};function $(t,e){return t.getUint8(e)}function tt(t,e){return t.getUint16(e,!1)}function et(t,e){return t.getUint32(e,!1)}function nt(t,e){return t.getInt16(e,!1)+t.getUint16(e+2,!1)/65535}var it={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function rt(t,e){this.data=t,this.offset=e,this.relativeOffset=0}rt.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},rt.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},rt.prototype.parseCard8=rt.prototype.parseByte,rt.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},rt.prototype.parseCard16=rt.prototype.parseUShort,rt.prototype.parseSID=rt.prototype.parseUShort,rt.prototype.parseOffset16=rt.prototype.parseUShort,rt.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},rt.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},rt.prototype.parseULong=function(){var t=et(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},rt.prototype.parseOffset32=rt.prototype.parseULong,rt.prototype.parseFixed=function(){var t=nt(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},rt.prototype.parseString=function(t){var e=this.data,n=this.offset+this.relativeOffset,i="";this.relativeOffset+=t;for(var r=0;r<t;r++)i+=String.fromCharCode(e.getUint8(n+r));return i},rt.prototype.parseTag=function(){return this.parseString(4)},rt.prototype.parseLongDateTime=function(){var t=et(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},rt.prototype.parseVersion=function(t){var e=tt(this.data,this.offset+this.relativeOffset),n=tt(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===t&&(t=4096),e+n/t/10},rt.prototype.skip=function(t,e){void 0===e&&(e=1),this.relativeOffset+=it[t]*e},rt.prototype.parseULongList=function(t){void 0===t&&(t=this.parseULong());for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getUint32(i),i+=4;return this.relativeOffset+=4*t,e},rt.prototype.parseOffset16List=rt.prototype.parseUShortList=function(t){void 0===t&&(t=this.parseUShort());for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getUint16(i),i+=2;return this.relativeOffset+=2*t,e},rt.prototype.parseShortList=function(t){for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getInt16(i),i+=2;return this.relativeOffset+=2*t,e},rt.prototype.parseByteList=function(t){for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getUint8(i++);return this.relativeOffset+=t,e},rt.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),i=0;i<t;i++)n[i]=e.call(this);return n},rt.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var n=new Array(t),i=0;i<t;i++)n[i]=e.call(this);return n},rt.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),i=Object.keys(e),r=0;r<t;r++){for(var s={},a=0;a<i.length;a++){var o=i[a],l=e[o];s[o]=l.call(this)}n[r]=s}return n},rt.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var n=new Array(t),i=Object.keys(e),r=0;r<t;r++){for(var s={},a=0;a<i.length;a++){var o=i[a],l=e[o];s[o]=l.call(this)}n[r]=s}return n},rt.prototype.parseStruct=function(t){if("function"==typeof t)return t.call(this);for(var e=Object.keys(t),n={},i=0;i<e.length;i++){var r=e[i],s=t[r];n[r]=s.call(this)}return n},rt.prototype.parseValueRecord=function(t){if(void 0===t&&(t=this.parseUShort()),0!==t){var e={};return 1&t&&(e.xPlacement=this.parseShort()),2&t&&(e.yPlacement=this.parseShort()),4&t&&(e.xAdvance=this.parseShort()),8&t&&(e.yAdvance=this.parseShort()),16&t&&(e.xPlaDevice=void 0,this.parseShort()),32&t&&(e.yPlaDevice=void 0,this.parseShort()),64&t&&(e.xAdvDevice=void 0,this.parseShort()),128&t&&(e.yAdvDevice=void 0,this.parseShort()),e}},rt.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),n=new Array(e),i=0;i<e;i++)n[i]=this.parseValueRecord(t);return n},rt.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new rt(this.data,this.offset+e).parseStruct(t)},rt.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new rt(this.data,this.offset+e).parseStruct(t)},rt.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),n=e.length,i=this.relativeOffset,r=new Array(n),s=0;s<n;s++){var a=e[s];if(0!==a)if(this.relativeOffset=a,t){for(var o=this.parseOffset16List(),l=new Array(o.length),h=0;h<o.length;h++)this.relativeOffset=a+o[h],l[h]=t.call(this);r[s]=l}else r[s]=this.parseUShortList();else r[s]=void 0}return this.relativeOffset=i,r},rt.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),n=this.parseUShort();if(1===e)return{format:1,glyphs:this.parseUShortList(n)};if(2===e){for(var i=new Array(n),r=0;r<n;r++)i[r]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},rt.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(1===e)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===e)return{format:2,ranges:this.parseRecordList({start:rt.uShort,end:rt.uShort,classId:rt.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},rt.list=function(t,e){return function(){return this.parseList(t,e)}},rt.list32=function(t,e){return function(){return this.parseList32(t,e)}},rt.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},rt.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},rt.pointer=function(t){return function(){return this.parsePointer(t)}},rt.pointer32=function(t){return function(){return this.parsePointer32(t)}},rt.tag=rt.prototype.parseTag,rt.byte=rt.prototype.parseByte,rt.uShort=rt.offset16=rt.prototype.parseUShort,rt.uShortList=rt.prototype.parseUShortList,rt.uLong=rt.offset32=rt.prototype.parseULong,rt.uLongList=rt.prototype.parseULongList,rt.struct=rt.prototype.parseStruct,rt.coverage=rt.prototype.parseCoverage,rt.classDef=rt.prototype.parseClassDef;var st={reserved:rt.uShort,reqFeatureIndex:rt.uShort,featureIndexes:rt.uShortList};rt.prototype.parseScriptList=function(){return this.parsePointer(rt.recordList({tag:rt.tag,script:rt.pointer({defaultLangSys:rt.pointer(st),langSysRecords:rt.recordList({tag:rt.tag,langSys:rt.pointer(st)})})}))||[]},rt.prototype.parseFeatureList=function(){return this.parsePointer(rt.recordList({tag:rt.tag,feature:rt.pointer({featureParams:rt.offset16,lookupListIndexes:rt.uShortList})}))||[]},rt.prototype.parseLookupList=function(t){return this.parsePointer(rt.list(rt.pointer(function(){var e=this.parseUShort();P.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var n=this.parseUShort(),i=16&n;return{lookupType:e,lookupFlag:n,subtables:this.parseList(rt.pointer(t[e])),markFilteringSet:i?this.parseUShort():void 0}})))||[]},rt.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();return P.argument(1===t&&e<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:rt.offset32,featureTableSubstitutionOffset:rt.offset32})})||[]};var at={getByte:$,getCard8:$,getUShort:tt,getCard16:tt,getShort:function(t,e){return t.getInt16(e,!1)},getULong:et,getFixed:nt,getTag:function(t,e){for(var n="",i=e;i<e+4;i+=1)n+=String.fromCharCode(t.getInt8(i));return n},getOffset:function(t,e,n){for(var i=0,r=0;r<n;r+=1)i<<=8,i+=t.getUint8(e+r);return i},getBytes:function(t,e,n){for(var i=[],r=e;r<n;r+=1)i.push(t.getUint8(r));return i},bytesToString:function(t){for(var e="",n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return e},Parser:rt};function ot(t,e,n){t.segments.push({end:e,start:e,delta:-(e-n),offset:0,glyphIndex:n})}var lt={parse:function(t,e){var n={};n.version=at.getUShort(t,e),P.argument(0===n.version,"cmap table version should be 0."),n.numTables=at.getUShort(t,e+2);for(var i=-1,r=n.numTables-1;r>=0;r-=1){var s=at.getUShort(t,e+4+8*r),a=at.getUShort(t,e+4+8*r+2);if(3===s&&(0===a||1===a||10===a)||0===s&&(0===a||1===a||2===a||3===a||4===a)){i=at.getULong(t,e+4+8*r+4);break}}if(-1===i)throw new Error("No valid cmap sub-tables found.");var o=new at.Parser(t,e+i);if(n.format=o.parseUShort(),12===n.format)!function(t,e){var n;e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong(),t.groupCount=n=e.parseULong(),t.glyphIndexMap={};for(var i=0;i<n;i+=1)for(var r=e.parseULong(),s=e.parseULong(),a=e.parseULong(),o=r;o<=s;o+=1)t.glyphIndexMap[o]=a,a++}(n,o);else{if(4!==n.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");!function(t,e,n,i,r){var s;t.length=e.parseUShort(),t.language=e.parseUShort(),t.segCount=s=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new at.Parser(n,i+r+14),o=new at.Parser(n,i+r+16+2*s),l=new at.Parser(n,i+r+16+4*s),h=new at.Parser(n,i+r+16+6*s),c=i+r+16+8*s,u=0;u<s-1;u+=1)for(var d=void 0,p=a.parseUShort(),f=o.parseUShort(),g=l.parseShort(),m=h.parseUShort(),v=f;v<=p;v+=1)0!==m?(c=h.offset+h.relativeOffset-2,c+=m,c+=2*(v-f),0!==(d=at.getUShort(n,c))&&(d=d+g&65535)):d=v+g&65535,t.glyphIndexMap[v]=d}(n,o,t,e,i)}return n},make:function(t){var e,n=!0;for(e=t.length-1;e>0;e-=1)if(t.get(e).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),n=!1;break}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:n?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:n?12:20}];n||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var r=new Q.Table("cmap",i);for(r.segments=[],e=0;e<t.length;e+=1){for(var s=t.get(e),a=0;a<s.unicodes.length;a+=1)ot(r,s.unicodes[a],e);r.segments=r.segments.sort(function(t,e){return t.start-e.start})}r.segments.push({end:65535,start:65535,delta:1,offset:0});var o=r.segments.length,l=0,h=[],c=[],u=[],d=[],p=[],f=[];for(e=0;e<o;e+=1){var g=r.segments[e];g.end<=65535&&g.start<=65535?(h=h.concat({name:"end_"+e,type:"USHORT",value:g.end}),c=c.concat({name:"start_"+e,type:"USHORT",value:g.start}),u=u.concat({name:"idDelta_"+e,type:"SHORT",value:g.delta}),d=d.concat({name:"idRangeOffset_"+e,type:"USHORT",value:g.offset}),void 0!==g.glyphId&&(p=p.concat({name:"glyph_"+e,type:"USHORT",value:g.glyphId}))):l+=1,n||void 0===g.glyphIndex||(f=(f=(f=f.concat({name:"cmap12Start_"+e,type:"ULONG",value:g.start})).concat({name:"cmap12End_"+e,type:"ULONG",value:g.end})).concat({name:"cmap12Glyph_"+e,type:"ULONG",value:g.glyphIndex}))}if(r.segCountX2=2*(o-l),r.searchRange=2*Math.pow(2,Math.floor(Math.log(o-l)/Math.log(2))),r.entrySelector=Math.log(r.searchRange/2)/Math.log(2),r.rangeShift=r.segCountX2-r.searchRange,r.fields=r.fields.concat(h),r.fields.push({name:"reservedPad",type:"USHORT",value:0}),r.fields=r.fields.concat(c),r.fields=r.fields.concat(u),r.fields=r.fields.concat(d),r.fields=r.fields.concat(p),r.cmap4Length=14+2*h.length+2+2*c.length+2*u.length+2*d.length+2*p.length,!n){var m=16+4*f.length;r.cmap12Offset=20+r.cmap4Length,r.fields=r.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:m},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),r.fields=r.fields.concat(f)}return r}},ht=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],ct=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],ut=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],dt=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function pt(t){this.font=t}function ft(t){this.cmap=t}function gt(t,e){this.encoding=t,this.charset=e}function mt(t){switch(t.version){case 1:this.names=dt.slice();break;case 2:this.names=new Array(t.numberOfGlyphs);for(var e=0;e<t.numberOfGlyphs;e++)t.glyphNameIndex[e]<dt.length?this.names[e]=dt[t.glyphNameIndex[e]]:this.names[e]=t.names[t.glyphNameIndex[e]-dt.length];break;case 2.5:this.names=new Array(t.numberOfGlyphs);for(var n=0;n<t.numberOfGlyphs;n++)this.names[n]=dt[n+t.glyphNameIndex[n]];break;case 3:default:this.names=[]}}pt.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),n=this.font.glyphs;if(n)for(var i=0;i<n.length;i+=1)for(var r=n.get(i),s=0;s<r.unicodes.length;s+=1)if(r.unicodes[s]===e)return i;return null},ft.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.codePointAt(0)]||0},gt.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),n=this.encoding[e];return this.charset.indexOf(n)},mt.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)},mt.prototype.glyphIndexToName=function(t){return this.names[t]};var vt=function(t,e,n,i,r){t.beginPath(),t.moveTo(e,n),t.lineTo(i,r),t.stroke()};function _t(t){this.bindConstructorValues(t)}function yt(t,e,n){Object.defineProperty(t,e,{get:function(){return t.path,t[n]},set:function(e){t[n]=e},enumerable:!0,configurable:!0})}function xt(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];i.path.unitsPerEm=t.unitsPerEm,this.glyphs[n]=i}this.length=e&&e.length||0}_t.prototype.bindConstructorValues=function(t){var e,n;this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||void 0!==t.unicode?[t.unicode]:[],t.xMin&&(this.xMin=t.xMin),t.yMin&&(this.yMin=t.yMin),t.xMax&&(this.xMax=t.xMax),t.yMax&&(this.yMax=t.yMax),t.advanceWidth&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",(e=t.path,n=e||new A,{configurable:!0,get:function(){return"function"==typeof n&&(n=n()),n},set:function(t){n=t}}))},_t.prototype.addUnicode=function(t){0===this.unicodes.length&&(this.unicode=t),this.unicodes.push(t)},_t.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},_t.prototype.getPath=function(t,e,n,i,r){var s,a;t=void 0!==t?t:0,e=void 0!==e?e:0,n=void 0!==n?n:72,i||(i={});var o=i.xScale,l=i.yScale;if(i.hinting&&r&&r.hinting&&(a=this.path&&r.hinting.exec(this,n)),a)s=r.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),o=l=1;else{s=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*n;void 0===o&&(o=h),void 0===l&&(l=h)}for(var c=new A,u=0;u<s.length;u+=1){var d=s[u];"M"===d.type?c.moveTo(t+d.x*o,e+-d.y*l):"L"===d.type?c.lineTo(t+d.x*o,e+-d.y*l):"Q"===d.type?c.quadraticCurveTo(t+d.x1*o,e+-d.y1*l,t+d.x*o,e+-d.y*l):"C"===d.type?c.curveTo(t+d.x1*o,e+-d.y1*l,t+d.x2*o,e+-d.y2*l,t+d.x*o,e+-d.y*l):"Z"===d.type&&c.closePath()}return c},_t.prototype.getContours=function(){if(void 0===this.points)return[];for(var t=[],e=[],n=0;n<this.points.length;n+=1){var i=this.points[n];e.push(i),i.lastPointOfContour&&(t.push(e),e=[])}return P.argument(0===e.length,"There are still points left in the current contour."),t},_t.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],n=[],i=0;i<t.length;i+=1){var r=t[i];"Z"!==r.type&&(e.push(r.x),n.push(r.y)),"Q"!==r.type&&"C"!==r.type||(e.push(r.x1),n.push(r.y1)),"C"===r.type&&(e.push(r.x2),n.push(r.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},_t.prototype.draw=function(t,e,n,i,r){this.getPath(e,n,i,r).draw(t)},_t.prototype.drawPoints=function(t,e,n,i){function r(e,n,i,r){var s=2*Math.PI;t.beginPath();for(var a=0;a<e.length;a+=1)t.moveTo(n+e[a].x*r,i+e[a].y*r),t.arc(n+e[a].x*r,i+e[a].y*r,2,0,s,!1);t.closePath(),t.fill()}e=void 0!==e?e:0,n=void 0!==n?n:0,i=void 0!==i?i:24;for(var s=1/this.path.unitsPerEm*i,a=[],o=[],l=this.path,h=0;h<l.commands.length;h+=1){var c=l.commands[h];void 0!==c.x&&a.push({x:c.x,y:-c.y}),void 0!==c.x1&&o.push({x:c.x1,y:-c.y1}),void 0!==c.x2&&o.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",r(a,e,n,s),t.fillStyle="red",r(o,e,n,s)},_t.prototype.drawMetrics=function(t,e,n,i){var r;e=void 0!==e?e:0,n=void 0!==n?n:0,i=void 0!==i?i:24,r=1/this.path.unitsPerEm*i,t.lineWidth=1,t.strokeStyle="black",vt(t,e,-1e4,e,1e4),vt(t,-1e4,n,1e4,n);var s=this.xMin||0,a=this.yMin||0,o=this.xMax||0,l=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",vt(t,e+s*r,-1e4,e+s*r,1e4),vt(t,e+o*r,-1e4,e+o*r,1e4),vt(t,-1e4,n+-a*r,1e4,n+-a*r),vt(t,-1e4,n+-l*r,1e4,n+-l*r),t.strokeStyle="green",vt(t,e+h*r,-1e4,e+h*r,1e4)},xt.prototype.get=function(t){if(void 0===this.glyphs[t]){this.font._push(t),"function"==typeof this.glyphs[t]&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],n=this.font._IndexToUnicodeMap[t];if(n)for(var i=0;i<n.unicodes.length;i++)e.addUnicode(n.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else"function"==typeof this.glyphs[t]&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},xt.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};var bt={GlyphSet:xt,glyphLoader:function(t,e){return new _t({index:e,font:t})},ttfGlyphLoader:function(t,e,n,i,r,s){return function(){var a=new _t({index:e,font:t});return a.path=function(){n(a,i,r);var e=s(t.glyphs,a);return e.unitsPerEm=t.unitsPerEm,e},yt(a,"xMin","_xMin"),yt(a,"xMax","_xMax"),yt(a,"yMin","_yMin"),yt(a,"yMax","_yMax"),a}},cffGlyphLoader:function(t,e,n,i){return function(){var r=new _t({index:e,font:t});return r.path=function(){var e=n(t,r,i);return e.unitsPerEm=t.unitsPerEm,e},r}}};function wt(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(!wt(t[n],e[n]))return!1;return!0}return!1}function St(t){return t.length<1240?107:t.length<33900?1131:32768}function Mt(t,e,n){var i,r,s=[],a=[],o=at.getCard16(t,e);if(0!==o){var l=at.getByte(t,e+2);i=e+(o+1)*l+2;for(var h=e+3,c=0;c<o+1;c+=1)s.push(at.getOffset(t,h,l)),h+=l;r=i+s[o]}else r=e+2;for(var u=0;u<s.length-1;u+=1){var d=at.getBytes(t,i+s[u],i+s[u+1]);n&&(d=n(d)),a.push(d)}return{objects:a,startOffset:e,endOffset:r}}function Tt(t,e){if(28===e)return t.parseByte()<<8|t.parseByte();if(29===e)return t.parseByte()<<24|t.parseByte()<<16|t.parseByte()<<8|t.parseByte();if(30===e)return function(t){for(var e="",n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),r=i>>4,s=15&i;if(15===r)break;if(e+=n[r],15===s)break;e+=n[s]}return parseFloat(e)}(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return 256*(e-247)+t.parseByte()+108;if(e>=251&&e<=254)return 256*-(e-251)-t.parseByte()-108;throw new Error("Invalid b0 "+e)}function Et(t,e,n){e=void 0!==e?e:0;var i=new at.Parser(t,e),r=[],s=[];for(n=void 0!==n?n:t.length;i.relativeOffset<n;){var a=i.parseByte();a<=21?(12===a&&(a=1200+i.parseByte()),r.push([a,s]),s=[]):s.push(Tt(i,a))}return function(t){for(var e={},n=0;n<t.length;n+=1){var i,r=t[n][0],s=t[n][1];if(i=1===s.length?s[0]:s,e.hasOwnProperty(r)&&!isNaN(e[r]))throw new Error("Object "+e+" already has key "+r);e[r]=i}return e}(r)}function Ct(t,e){return e<=390?ht[e]:t[e-391]}function At(t,e,n){for(var i,r={},s=0;s<e.length;s+=1){var a=e[s];if(Array.isArray(a.type)){var o=[];o.length=a.type.length;for(var l=0;l<a.type.length;l++)void 0===(i=void 0!==t[a.op]?t[a.op][l]:void 0)&&(i=void 0!==a.value&&void 0!==a.value[l]?a.value[l]:null),"SID"===a.type[l]&&(i=Ct(n,i)),o[l]=i;r[a.name]=o}else void 0===(i=t[a.op])&&(i=void 0!==a.value?a.value:null),"SID"===a.type&&(i=Ct(n,i)),r[a.name]=i}return r}var Rt=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Lt=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Pt(t,e){return At(Et(t,0,t.byteLength),Rt,e)}function kt(t,e,n,i){return At(Et(t,e,n),Lt,i)}function Dt(t,e,n,i){for(var r=[],s=0;s<n.length;s+=1){var a=Pt(new DataView(new Uint8Array(n[s]).buffer),i);a._subrs=[],a._subrsBias=0;var o=a.private[0],l=a.private[1];if(0!==o&&0!==l){var h=kt(t,l+e,o,i);if(a._defaultWidthX=h.defaultWidthX,a._nominalWidthX=h.nominalWidthX,0!==h.subrs){var c=Mt(t,l+h.subrs+e);a._subrs=c.objects,a._subrsBias=St(a._subrs)}a._privateDict=h}r.push(a)}return r}function It(t,e,n){var i,r,s,a,o,l,h,c,u=new A,d=[],p=0,f=!1,g=!1,m=0,v=0;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],y=t.tables.cff.topDict._fdArray[_];o=y._subrs,l=y._subrsBias,h=y._defaultWidthX,c=y._nominalWidthX}else o=t.tables.cff.topDict._subrs,l=t.tables.cff.topDict._subrsBias,h=t.tables.cff.topDict._defaultWidthX,c=t.tables.cff.topDict._nominalWidthX;var x=h;function b(t,e){g&&u.closePath(),u.moveTo(t,e),g=!0}function w(){d.length%2!=0&&!f&&(x=d.shift()+c),p+=d.length>>1,d.length=0,f=!0}return function n(h){for(var _,y,S,M,T,E,C,A,R,L,P,k,D=0;D<h.length;){var I=h[D];switch(D+=1,I){case 1:case 3:w();break;case 4:d.length>1&&!f&&(x=d.shift()+c,f=!0),v+=d.pop(),b(m,v);break;case 5:for(;d.length>0;)m+=d.shift(),v+=d.shift(),u.lineTo(m,v);break;case 6:for(;d.length>0&&(m+=d.shift(),u.lineTo(m,v),0!==d.length);)v+=d.shift(),u.lineTo(m,v);break;case 7:for(;d.length>0&&(v+=d.shift(),u.lineTo(m,v),0!==d.length);)m+=d.shift(),u.lineTo(m,v);break;case 8:for(;d.length>0;)i=m+d.shift(),r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),m=s+d.shift(),v=a+d.shift(),u.curveTo(i,r,s,a,m,v);break;case 10:T=d.pop()+l,(E=o[T])&&n(E);break;case 11:return;case 12:switch(I=h[D],D+=1,I){case 35:i=m+d.shift(),r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),C=s+d.shift(),A=a+d.shift(),R=C+d.shift(),L=A+d.shift(),P=R+d.shift(),k=L+d.shift(),m=P+d.shift(),v=k+d.shift(),d.shift(),u.curveTo(i,r,s,a,C,A),u.curveTo(R,L,P,k,m,v);break;case 34:i=m+d.shift(),r=v,s=i+d.shift(),a=r+d.shift(),C=s+d.shift(),A=a,R=C+d.shift(),L=a,P=R+d.shift(),k=v,m=P+d.shift(),u.curveTo(i,r,s,a,C,A),u.curveTo(R,L,P,k,m,v);break;case 36:i=m+d.shift(),r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),C=s+d.shift(),A=a,R=C+d.shift(),L=a,P=R+d.shift(),k=L+d.shift(),m=P+d.shift(),u.curveTo(i,r,s,a,C,A),u.curveTo(R,L,P,k,m,v);break;case 37:i=m+d.shift(),r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),C=s+d.shift(),A=a+d.shift(),R=C+d.shift(),L=A+d.shift(),P=R+d.shift(),k=L+d.shift(),Math.abs(P-m)>Math.abs(k-v)?m=P+d.shift():v=k+d.shift(),u.curveTo(i,r,s,a,C,A),u.curveTo(R,L,P,k,m,v);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+I),d.length=0}break;case 14:d.length>0&&!f&&(x=d.shift()+c,f=!0),g&&(u.closePath(),g=!1);break;case 18:w();break;case 19:case 20:w(),D+=p+7>>3;break;case 21:d.length>2&&!f&&(x=d.shift()+c,f=!0),v+=d.pop(),b(m+=d.pop(),v);break;case 22:d.length>1&&!f&&(x=d.shift()+c,f=!0),b(m+=d.pop(),v);break;case 23:w();break;case 24:for(;d.length>2;)i=m+d.shift(),r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),m=s+d.shift(),v=a+d.shift(),u.curveTo(i,r,s,a,m,v);m+=d.shift(),v+=d.shift(),u.lineTo(m,v);break;case 25:for(;d.length>6;)m+=d.shift(),v+=d.shift(),u.lineTo(m,v);i=m+d.shift(),r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),m=s+d.shift(),v=a+d.shift(),u.curveTo(i,r,s,a,m,v);break;case 26:for(d.length%2&&(m+=d.shift());d.length>0;)i=m,r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),m=s,v=a+d.shift(),u.curveTo(i,r,s,a,m,v);break;case 27:for(d.length%2&&(v+=d.shift());d.length>0;)i=m+d.shift(),r=v,s=i+d.shift(),a=r+d.shift(),m=s+d.shift(),v=a,u.curveTo(i,r,s,a,m,v);break;case 28:_=h[D],y=h[D+1],d.push((_<<24|y<<16)>>16),D+=2;break;case 29:T=d.pop()+t.gsubrsBias,(E=t.gsubrs[T])&&n(E);break;case 30:for(;d.length>0&&(i=m,r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),m=s+d.shift(),v=a+(1===d.length?d.shift():0),u.curveTo(i,r,s,a,m,v),0!==d.length);)i=m+d.shift(),r=v,s=i+d.shift(),a=r+d.shift(),v=a+d.shift(),m=s+(1===d.length?d.shift():0),u.curveTo(i,r,s,a,m,v);break;case 31:for(;d.length>0&&(i=m+d.shift(),r=v,s=i+d.shift(),a=r+d.shift(),v=a+d.shift(),m=s+(1===d.length?d.shift():0),u.curveTo(i,r,s,a,m,v),0!==d.length);)i=m,r=v+d.shift(),s=i+d.shift(),a=r+d.shift(),m=s+d.shift(),v=a+(1===d.length?d.shift():0),u.curveTo(i,r,s,a,m,v);break;default:I<32?console.log("Glyph "+e.index+": unknown operator "+I):I<247?d.push(I-139):I<251?(_=h[D],D+=1,d.push(256*(I-247)+_+108)):I<255?(_=h[D],D+=1,d.push(256*-(I-251)-_-108)):(_=h[D],y=h[D+1],S=h[D+2],M=h[D+3],D+=4,d.push((_<<24|y<<16|S<<8|M)/65536))}}}(n),e.advanceWidth=x,u}function Ot(t,e){var n,i=ht.indexOf(t);return i>=0&&(n=i),(i=e.indexOf(t))>=0?n=i+ht.length:(n=ht.length+e.length,e.push(t)),n}function Bt(t,e,n){for(var i={},r=0;r<t.length;r+=1){var s=t[r],a=e[s.name];void 0===a||wt(a,s.value)||("SID"===s.type&&(a=Ot(a,n)),i[s.op]={name:s.name,type:s.type,value:a})}return i}function Ft(t,e){var n=new Q.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Bt(Rt,t,e),n}function Nt(t){var e=new Q.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function Ut(t){var e=[],n=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var i=0,r=0,s=0;s<n.commands.length;s+=1){var a=void 0,o=void 0,l=n.commands[s];if("Q"===l.type&&(l={type:"C",x:l.x,y:l.y,x1:1/3*i+2/3*l.x1,y1:1/3*r+2/3*l.y1,x2:1/3*l.x+2/3*l.x1,y2:1/3*l.y+2/3*l.y1}),"M"===l.type)a=Math.round(l.x-i),o=Math.round(l.y-r),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(l.x),r=Math.round(l.y);else if("L"===l.type)a=Math.round(l.x-i),o=Math.round(l.y-r),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),i=Math.round(l.x),r=Math.round(l.y);else if("C"===l.type){var h=Math.round(l.x1-i),c=Math.round(l.y1-r),u=Math.round(l.x2-l.x1),d=Math.round(l.y2-l.y1);a=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:h}),e.push({name:"dy1",type:"NUMBER",value:c}),e.push({name:"dx2",type:"NUMBER",value:u}),e.push({name:"dy2",type:"NUMBER",value:d}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(l.x),r=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}var zt={parse:function(t,e,n,i){n.tables.cff={};var r=function(t,e){var n={};return n.formatMajor=at.getCard8(t,e),n.formatMinor=at.getCard8(t,e+1),n.size=at.getCard8(t,e+2),n.offsetSize=at.getCard8(t,e+3),n.startOffset=e,n.endOffset=e+4,n}(t,e),s=Mt(t,r.endOffset,at.bytesToString),a=Mt(t,s.endOffset),o=Mt(t,a.endOffset,at.bytesToString),l=Mt(t,o.endOffset);n.gsubrs=l.objects,n.gsubrsBias=St(n.gsubrs);var h=Dt(t,e,a.objects,o.objects);if(1!==h.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var c=h[0];if(n.tables.cff.topDict=c,c._privateDict&&(n.defaultWidthX=c._privateDict.defaultWidthX,n.nominalWidthX=c._privateDict.nominalWidthX),void 0!==c.ros[0]&&void 0!==c.ros[1]&&(n.isCIDFont=!0),n.isCIDFont){var u=c.fdArray,d=c.fdSelect;if(0===u||0===d)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var p=Mt(t,u+=e),f=Dt(t,e,p.objects,o.objects);c._fdArray=f,d+=e,c._fdSelect=function(t,e,n,i){var r,s=[],a=new at.Parser(t,e),o=a.parseCard8();if(0===o)for(var l=0;l<n;l++){if((r=a.parseCard8())>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+r+" (FD count "+i+")");s.push(r)}else{if(3!==o)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);var h,c=a.parseCard16(),u=a.parseCard16();if(0!==u)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+u);for(var d=0;d<c;d++){if(r=a.parseCard8(),h=a.parseCard16(),r>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+r+" (FD count "+i+")");if(h>n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+h);for(;u<h;u++)s.push(r);u=h}if(h!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+h)}return s}(t,d,n.numGlyphs,f.length)}var g,m=e+c.private[1],v=kt(t,m,c.private[0],o.objects);if(n.defaultWidthX=v.defaultWidthX,n.nominalWidthX=v.nominalWidthX,0!==v.subrs){var _=m+v.subrs,y=Mt(t,_);n.subrs=y.objects,n.subrsBias=St(n.subrs)}else n.subrs=[],n.subrsBias=0;i.lowMemory?(g=function(t,e){var n,i,r=[],s=at.getCard16(t,e);if(0!==s){var a=at.getByte(t,e+2);n=e+(s+1)*a+2;for(var o=e+3,l=0;l<s+1;l+=1)r.push(at.getOffset(t,o,a)),o+=a;i=n+r[s]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}(t,e+c.charStrings),n.nGlyphs=g.offsets.length):(g=Mt(t,e+c.charStrings),n.nGlyphs=g.objects.length);var x=function(t,e,n,i){var r,s,a=new at.Parser(t,e);n-=1;var o=[".notdef"],l=a.parseCard8();if(0===l)for(var h=0;h<n;h+=1)r=a.parseSID(),o.push(Ct(i,r));else if(1===l)for(;o.length<=n;){r=a.parseSID(),s=a.parseCard8();for(var c=0;c<=s;c+=1)o.push(Ct(i,r)),r+=1}else{if(2!==l)throw new Error("Unknown charset format "+l);for(;o.length<=n;){r=a.parseSID(),s=a.parseCard16();for(var u=0;u<=s;u+=1)o.push(Ct(i,r)),r+=1}}return o}(t,e+c.charset,n.nGlyphs,o.objects);if(0===c.encoding?n.cffEncoding=new gt(ct,x):1===c.encoding?n.cffEncoding=new gt(ut,x):n.cffEncoding=function(t,e,n){var i,r={},s=new at.Parser(t,e),a=s.parseCard8();if(0===a)for(var o=s.parseCard8(),l=0;l<o;l+=1)r[i=s.parseCard8()]=l;else{if(1!==a)throw new Error("Unknown encoding format "+a);var h=s.parseCard8();i=1;for(var c=0;c<h;c+=1)for(var u=s.parseCard8(),d=s.parseCard8(),p=u;p<=u+d;p+=1)r[p]=i,i+=1}return new gt(r,n)}(t,e+c.encoding,x),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new bt.GlyphSet(n),i.lowMemory)n._push=function(i){var r=function(t,e,n,i,r){var s=at.getCard16(n,i),a=0;0!==s&&(a=i+(s+1)*at.getByte(n,i+2)+2);var o=at.getBytes(n,a+e[t],a+e[t+1]);return o}(i,g.offsets,t,e+c.charStrings);n.glyphs.push(i,bt.cffGlyphLoader(n,i,It,r))};else for(var b=0;b<n.nGlyphs;b+=1){var w=g.objects[b];n.glyphs.push(b,bt.cffGlyphLoader(n,b,It,w))}},make:function(t,e){for(var n,i=new Q.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),r=1/e.unitsPerEm,s={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[r,0,0,r,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a=[],o=1;o<t.length;o+=1)n=t.get(o),a.push(n.name);var l=[];i.header=new Q.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),i.nameIndex=function(t){var e=new Q.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var n=0;n<t.length;n+=1)e.names.push({name:"name_"+n,type:"NAME",value:t[n]});return e}([e.postScriptName]);var h=Ft(s,l);i.topDictIndex=Nt(h),i.globalSubrIndex=new Q.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),i.charsets=function(t,e){for(var n=new Q.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<t.length;i+=1){var r=Ot(t[i],e);n.fields.push({name:"glyph_"+i,type:"SID",value:r})}return n}(a,l),i.charStringsIndex=function(t){for(var e=new Q.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<t.length;n+=1){var i=t.get(n),r=Ut(i);e.charStrings.push({name:i.name,type:"CHARSTRING",value:r})}return e}(t),i.privateDict=function(t,e){var n=new Q.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Bt(Lt,{},e),n}(0,l),i.stringIndex=function(t){var e=new Q.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var n=0;n<t.length;n+=1)e.strings.push({name:"string_"+n,type:"STRING",value:t[n]});return e}(l);var c=i.header.sizeOf()+i.nameIndex.sizeOf()+i.topDictIndex.sizeOf()+i.stringIndex.sizeOf()+i.globalSubrIndex.sizeOf();return s.charset=c,s.encoding=0,s.charStrings=s.charset+i.charsets.sizeOf(),s.private[1]=s.charStrings+i.charStringsIndex.sizeOf(),h=Ft(s,l),i.topDictIndex=Nt(h),i}},Gt={parse:function(t,e){var n={},i=new at.Parser(t,e);return n.version=i.parseVersion(),n.fontRevision=Math.round(1e3*i.parseFixed())/1e3,n.checkSumAdjustment=i.parseULong(),n.magicNumber=i.parseULong(),P.argument(1594834165===n.magicNumber,"Font header has wrong magic number."),n.flags=i.parseUShort(),n.unitsPerEm=i.parseUShort(),n.created=i.parseLongDateTime(),n.modified=i.parseLongDateTime(),n.xMin=i.parseShort(),n.yMin=i.parseShort(),n.xMax=i.parseShort(),n.yMax=i.parseShort(),n.macStyle=i.parseUShort(),n.lowestRecPPEM=i.parseUShort(),n.fontDirectionHint=i.parseShort(),n.indexToLocFormat=i.parseShort(),n.glyphDataFormat=i.parseShort(),n},make:function(t){var e=Math.round((new Date).getTime()/1e3)+2082844800,n=e;return t.createdTimestamp&&(n=t.createdTimestamp+2082844800),new Q.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}},Ht={parse:function(t,e){var n={},i=new at.Parser(t,e);return n.version=i.parseVersion(),n.ascender=i.parseShort(),n.descender=i.parseShort(),n.lineGap=i.parseShort(),n.advanceWidthMax=i.parseUShort(),n.minLeftSideBearing=i.parseShort(),n.minRightSideBearing=i.parseShort(),n.xMaxExtent=i.parseShort(),n.caretSlopeRise=i.parseShort(),n.caretSlopeRun=i.parseShort(),n.caretOffset=i.parseShort(),i.relativeOffset+=8,n.metricDataFormat=i.parseShort(),n.numberOfHMetrics=i.parseUShort(),n},make:function(t){return new Q.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}},Wt={parse:function(t,e,n,i,r,s,a){a.lowMemory?function(t,e,n,i,r){var s,a;t._hmtxTableData={};for(var o=new at.Parser(e,n),l=0;l<r;l+=1)l<i&&(s=o.parseUShort(),a=o.parseShort()),t._hmtxTableData[l]={advanceWidth:s,leftSideBearing:a}}(t,e,n,i,r):function(t,e,n,i,r){for(var s,a,o=new at.Parser(t,e),l=0;l<i;l+=1){l<n&&(s=o.parseUShort(),a=o.parseShort());var h=r.get(l);h.advanceWidth=s,h.leftSideBearing=a}}(e,n,i,r,s)},make:function(t){for(var e=new Q.Table("hmtx",[]),n=0;n<t.length;n+=1){var i=t.get(n),r=i.advanceWidth||0,s=i.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:r}),e.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:s})}return e}},Vt={make:function(t){for(var e=new Q.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),n="",i=12+4*t.length,r=0;r<t.length;++r){var s=n.indexOf(t[r]);s<0&&(s=n.length,n+=t[r]),e.fields.push({name:"offset "+r,type:"USHORT",value:i+s}),e.fields.push({name:"length "+r,type:"USHORT",value:t[r].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),e},parse:function(t,e){var n=new at.Parser(t,e),i=n.parseULong();P.argument(1===i,"Unsupported ltag table version."),n.skip("uLong",1);for(var r=n.parseULong(),s=[],a=0;a<r;a++){for(var o="",l=e+n.parseUShort(),h=n.parseUShort(),c=l;c<l+h;++c)o+=String.fromCharCode(t.getInt8(c));s.push(o)}return s}},jt={parse:function(t,e){var n={},i=new at.Parser(t,e);return n.version=i.parseVersion(),n.numGlyphs=i.parseUShort(),1===n.version&&(n.maxPoints=i.parseUShort(),n.maxContours=i.parseUShort(),n.maxCompositePoints=i.parseUShort(),n.maxCompositeContours=i.parseUShort(),n.maxZones=i.parseUShort(),n.maxTwilightPoints=i.parseUShort(),n.maxStorage=i.parseUShort(),n.maxFunctionDefs=i.parseUShort(),n.maxInstructionDefs=i.parseUShort(),n.maxStackElements=i.parseUShort(),n.maxSizeOfInstructions=i.parseUShort(),n.maxComponentElements=i.parseUShort(),n.maxComponentDepth=i.parseUShort()),n},make:function(t){return new Q.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}},Xt=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Yt={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Zt={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},qt={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Jt(t,e,n){switch(t){case 0:if(65535===e)return"und";if(n)return n[e];break;case 1:return Yt[e];case 3:return qt[e]}}var Kt="utf-16",Qt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},$t={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function te(t,e,n){switch(t){case 0:return Kt;case 1:return $t[n]||Qt[e];case 3:if(1===e||10===e)return Kt}}function ee(t){var e={};for(var n in t)e[t[n]]=parseInt(n);return e}function ne(t,e,n,i,r,s){return new Q.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:r},{name:"offset",type:"USHORT",value:s}])}function ie(t,e){var n=function(t,e){var n=t.length,i=e.length-n+1;t:for(var r=0;r<i;r++)for(;r<i;r++){for(var s=0;s<n;s++)if(e[r+s]!==t[s])continue t;return r}return-1}(t,e);if(n<0){n=e.length;for(var i=0,r=t.length;i<r;++i)e.push(t[i])}return n}var re={parse:function(t,e,n){for(var i={},r=new at.Parser(t,e),s=r.parseUShort(),a=r.parseUShort(),o=r.offset+r.parseUShort(),l=0;l<a;l++){var h=r.parseUShort(),c=r.parseUShort(),u=r.parseUShort(),d=r.parseUShort(),p=Xt[d]||d,f=r.parseUShort(),g=r.parseUShort(),m=Jt(h,u,n),v=te(h,c,u);if(void 0!==v&&void 0!==m){var _;if(_=v===Kt?k.UTF16(t,o+g,f):k.MACSTRING(t,o+g,f,v)){var y=i[p];void 0===y&&(y=i[p]={}),y[m]=_}}}return 1===s&&r.parseUShort(),i},make:function(t,e){var n,i=[],r={},s=ee(Xt);for(var a in t){var o=s[a];if(void 0===o&&(o=a),n=parseInt(o),isNaN(n))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');r[n]=t[a],i.push(n)}for(var l=ee(Yt),h=ee(qt),c=[],u=[],d=0;d<i.length;d++){var p=r[n=i[d]];for(var f in p){var g=p[f],m=1,v=l[f],_=Zt[v],y=te(m,_,v),x=D.MACSTRING(g,y);void 0===x&&(m=0,(v=e.indexOf(f))<0&&(v=e.length,e.push(f)),_=4,x=D.UTF16(g));var b=ie(x,u);c.push(ne(m,_,v,n,x.length,b));var w=h[f];if(void 0!==w){var S=D.UTF16(g),M=ie(S,u);c.push(ne(3,1,w,n,S.length,M))}}}c.sort(function(t,e){return t.platformID-e.platformID||t.encodingID-e.encodingID||t.languageID-e.languageID||t.nameID-e.nameID});for(var T=new Q.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+12*c.length}]),E=0;E<c.length;E++)T.fields.push({name:"record_"+E,type:"RECORD",value:c[E]});return T.fields.push({name:"strings",type:"LITERAL",value:u}),T}},se=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}],ae={parse:function(t,e){var n={},i=new at.Parser(t,e);n.version=i.parseUShort(),n.xAvgCharWidth=i.parseShort(),n.usWeightClass=i.parseUShort(),n.usWidthClass=i.parseUShort(),n.fsType=i.parseUShort(),n.ySubscriptXSize=i.parseShort(),n.ySubscriptYSize=i.parseShort(),n.ySubscriptXOffset=i.parseShort(),n.ySubscriptYOffset=i.parseShort(),n.ySuperscriptXSize=i.parseShort(),n.ySuperscriptYSize=i.parseShort(),n.ySuperscriptXOffset=i.parseShort(),n.ySuperscriptYOffset=i.parseShort(),n.yStrikeoutSize=i.parseShort(),n.yStrikeoutPosition=i.parseShort(),n.sFamilyClass=i.parseShort(),n.panose=[];for(var r=0;r<10;r++)n.panose[r]=i.parseByte();return n.ulUnicodeRange1=i.parseULong(),n.ulUnicodeRange2=i.parseULong(),n.ulUnicodeRange3=i.parseULong(),n.ulUnicodeRange4=i.parseULong(),n.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),n.fsSelection=i.parseUShort(),n.usFirstCharIndex=i.parseUShort(),n.usLastCharIndex=i.parseUShort(),n.sTypoAscender=i.parseShort(),n.sTypoDescender=i.parseShort(),n.sTypoLineGap=i.parseShort(),n.usWinAscent=i.parseUShort(),n.usWinDescent=i.parseUShort(),n.version>=1&&(n.ulCodePageRange1=i.parseULong(),n.ulCodePageRange2=i.parseULong()),n.version>=2&&(n.sxHeight=i.parseShort(),n.sCapHeight=i.parseShort(),n.usDefaultChar=i.parseUShort(),n.usBreakChar=i.parseUShort(),n.usMaxContent=i.parseUShort()),n},make:function(t){return new Q.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)},unicodeRanges:se,getUnicodeRange:function(t){for(var e=0;e<se.length;e+=1){var n=se[e];if(t>=n.begin&&t<n.end)return e}return-1}},oe={parse:function(t,e){var n={},i=new at.Parser(t,e);switch(n.version=i.parseVersion(),n.italicAngle=i.parseFixed(),n.underlinePosition=i.parseShort(),n.underlineThickness=i.parseShort(),n.isFixedPitch=i.parseULong(),n.minMemType42=i.parseULong(),n.maxMemType42=i.parseULong(),n.minMemType1=i.parseULong(),n.maxMemType1=i.parseULong(),n.version){case 1:n.names=dt.slice();break;case 2:n.numberOfGlyphs=i.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var r=0;r<n.numberOfGlyphs;r++)n.glyphNameIndex[r]=i.parseUShort();n.names=[];for(var s=0;s<n.numberOfGlyphs;s++)if(n.glyphNameIndex[s]>=dt.length){var a=i.parseChar();n.names.push(i.parseString(a))}break;case 2.5:n.numberOfGlyphs=i.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var o=0;o<n.numberOfGlyphs;o++)n.offset[o]=i.parseChar()}return n},make:function(){return new Q.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},le=new Array(9);le[1]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{substFormat:1,coverage:this.parsePointer(rt.coverage),deltaGlyphId:this.parseUShort()}:2===e?{substFormat:2,coverage:this.parsePointer(rt.coverage),substitute:this.parseOffset16List()}:void P.assert(!1,"0x"+t.toString(16)+": lookup type 1 format must be 1 or 2.")},le[2]=function(){var t=this.parseUShort();return P.argument(1===t,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),sequences:this.parseListOfLists()}},le[3]=function(){var t=this.parseUShort();return P.argument(1===t,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),alternateSets:this.parseListOfLists()}},le[4]=function(){var t=this.parseUShort();return P.argument(1===t,"GSUB ligature table identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var he={sequenceIndex:rt.uShort,lookupListIndex:rt.uShort};le[5]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(1===e)return{substFormat:e,coverage:this.parsePointer(rt.coverage),ruleSets:this.parseListOfLists(function(){var t=this.parseUShort(),e=this.parseUShort();return{input:this.parseUShortList(t-1),lookupRecords:this.parseRecordList(e,he)}})};if(2===e)return{substFormat:e,coverage:this.parsePointer(rt.coverage),classDef:this.parsePointer(rt.classDef),classSets:this.parseListOfLists(function(){var t=this.parseUShort(),e=this.parseUShort();return{classes:this.parseUShortList(t-1),lookupRecords:this.parseRecordList(e,he)}})};if(3===e){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:e,coverages:this.parseList(n,rt.pointer(rt.coverage)),lookupRecords:this.parseRecordList(i,he)}}P.assert(!1,"0x"+t.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},le[6]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{substFormat:1,coverage:this.parsePointer(rt.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(he)}})}:2===e?{substFormat:2,coverage:this.parsePointer(rt.coverage),backtrackClassDef:this.parsePointer(rt.classDef),inputClassDef:this.parsePointer(rt.classDef),lookaheadClassDef:this.parsePointer(rt.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(he)}})}:3===e?{substFormat:3,backtrackCoverage:this.parseList(rt.pointer(rt.coverage)),inputCoverage:this.parseList(rt.pointer(rt.coverage)),lookaheadCoverage:this.parseList(rt.pointer(rt.coverage)),lookupRecords:this.parseRecordList(he)}:void P.assert(!1,"0x"+t.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},le[7]=function(){var t=this.parseUShort();P.argument(1===t,"GSUB Extension Substitution subtable identifier-format must be 1");var e=this.parseUShort(),n=new rt(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:e,extension:le[e].call(n)}},le[8]=function(){var t=this.parseUShort();return P.argument(1===t,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),backtrackCoverage:this.parseList(rt.pointer(rt.coverage)),lookaheadCoverage:this.parseList(rt.pointer(rt.coverage)),substitutes:this.parseUShortList()}};var ce=new Array(9);ce[1]=function(t){return 1===t.substFormat?new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)},{name:"deltaGlyphID",type:"USHORT",value:t.deltaGlyphId}]):new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)}].concat(Q.ushortList("substitute",t.substitute)))},ce[3]=function(t){return P.assert(1===t.substFormat,"Lookup type 3 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)}].concat(Q.tableList("altSet",t.alternateSets,function(t){return new Q.Table("alternateSetTable",Q.ushortList("alternate",t))})))},ce[4]=function(t){return P.assert(1===t.substFormat,"Lookup type 4 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)}].concat(Q.tableList("ligSet",t.ligatureSets,function(t){return new Q.Table("ligatureSetTable",Q.tableList("ligature",t,function(t){return new Q.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:t.ligGlyph}].concat(Q.ushortList("component",t.components,t.components.length+1)))}))})))};var ue={parse:function(t,e){var n=new rt(t,e=e||0),i=n.parseVersion(1);return P.argument(1===i||1.1===i,"Unsupported GSUB table version."),1===i?{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(le)}:{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(le),variations:n.parseFeatureVariationsList()}},make:function(t){return new Q.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Q.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Q.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Q.LookupList(t.lookups,ce)}])}},de={parse:function(t,e){var n=new at.Parser(t,e),i=n.parseULong();P.argument(1===i,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var r=n.parseULong(),s={},a=0;a<r;a++){var o=n.parseTag(),l=n.parseULong(),h=n.parseULong(),c=k.UTF8(t,e+l,h);s[o]=c}return s},make:function(t){var e=Object.keys(t).length,n="",i=16+12*e,r=new Q.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:e}]);for(var s in t){var a=n.length;n+=t[s],r.fields.push({name:"tag "+s,type:"TAG",value:s}),r.fields.push({name:"offset "+s,type:"ULONG",value:i+a}),r.fields.push({name:"length "+s,type:"ULONG",value:t[s].length})}return r.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),r}};function pe(t){return Math.log(t)/Math.log(2)|0}function fe(t){for(;t.length%4!=0;)t.push(0);for(var e=0,n=0;n<t.length;n+=4)e+=(t[n]<<24)+(t[n+1]<<16)+(t[n+2]<<8)+t[n+3];return e%Math.pow(2,32)}function ge(t,e,n,i){return new Q.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==t?t:""},{name:"checkSum",type:"ULONG",value:void 0!==e?e:0},{name:"offset",type:"ULONG",value:void 0!==n?n:0},{name:"length",type:"ULONG",value:void 0!==i?i:0}])}function me(t){var e=new Q.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var n=Math.pow(2,pe(e.numTables));e.searchRange=16*n,e.entrySelector=pe(n),e.rangeShift=16*e.numTables-e.searchRange;for(var i=[],r=[],s=e.sizeOf()+ge().sizeOf()*e.numTables;s%4!=0;)s+=1,r.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var o=t[a];P.argument(4===o.tableName.length,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),h=ge(o.tableName,fe(o.encode()),s,l);for(i.push({name:h.tag+" Table Record",type:"RECORD",value:h}),r.push({name:o.tableName+" table",type:"RECORD",value:o}),s+=l,P.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!=0;)s+=1,r.push({name:"padding",type:"BYTE",value:0})}return i.sort(function(t,e){return t.value.tag>e.value.tag?1:-1}),e.fields=e.fields.concat(i),e.fields=e.fields.concat(r),e}function ve(t,e,n){for(var i=0;i<e.length;i+=1){var r=t.charToGlyphIndex(e[i]);if(r>0)return t.glyphs.get(r).getMetrics()}return n}function _e(t){for(var e=0,n=0;n<t.length;n+=1)e+=t[n];return e/t.length}var ye=function(t){for(var e,n=[],i=[],r=[],s=[],a=[],o=[],l=[],h=0,c=0,u=0,d=0,p=0,f=0;f<t.glyphs.length;f+=1){var g=t.glyphs.get(f),m=0|g.unicode;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+f+"): advanceWidth is not a number.");(e>m||void 0===e)&&m>0&&(e=m),h<m&&(h=m);var v=ae.getUnicodeRange(m);if(v<32)c|=1<<v;else if(v<64)u|=1<<v-32;else if(v<96)d|=1<<v-64;else{if(!(v<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");p|=1<<v-96}if(".notdef"!==g.name){var _=g.getMetrics();n.push(_.xMin),i.push(_.yMin),r.push(_.xMax),s.push(_.yMax),o.push(_.leftSideBearing),l.push(_.rightSideBearing),a.push(g.advanceWidth)}}var y={xMin:Math.min.apply(null,n),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,r),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:_e(a),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,l)};y.ascender=t.ascender,y.descender=t.descender;var x=Gt.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:y.xMin,yMin:y.yMin,xMax:y.xMax,yMax:y.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),b=Ht.make({ascender:y.ascender,descender:y.descender,advanceWidthMax:y.advanceWidthMax,minLeftSideBearing:y.minLeftSideBearing,minRightSideBearing:y.minRightSideBearing,xMaxExtent:y.maxLeftSideBearing+(y.xMax-y.xMin),numberOfHMetrics:t.glyphs.length}),w=jt.make(t.glyphs.length),S=ae.make({xAvgCharWidth:Math.round(y.advanceWidthAvg),usWeightClass:t.tables.os2.usWeightClass,usWidthClass:t.tables.os2.usWidthClass,usFirstCharIndex:e,usLastCharIndex:h,ulUnicodeRange1:c,ulUnicodeRange2:u,ulUnicodeRange3:d,ulUnicodeRange4:p,fsSelection:t.tables.os2.fsSelection,sTypoAscender:y.ascender,sTypoDescender:y.descender,sTypoLineGap:0,usWinAscent:y.yMax,usWinDescent:Math.abs(y.yMin),ulCodePageRange1:1,sxHeight:ve(t,"xyvw",{yMax:Math.round(y.ascender/2)}).yMax,sCapHeight:ve(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",y).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0}),M=Wt.make(t.glyphs),T=lt.make(t.glyphs),E=t.getEnglishName("fontFamily"),C=t.getEnglishName("fontSubfamily"),A=E+" "+C,R=t.getEnglishName("postScriptName");R||(R=E.replace(/\s/g,"")+"-"+C);var L={};for(var P in t.names)L[P]=t.names[P];L.uniqueID||(L.uniqueID={en:t.getEnglishName("manufacturer")+":"+A}),L.postScriptName||(L.postScriptName={en:R}),L.preferredFamily||(L.preferredFamily=t.names.fontFamily),L.preferredSubfamily||(L.preferredSubfamily=t.names.fontSubfamily);var k=[],D=re.make(L,k),I=k.length>0?Vt.make(k):void 0,O=oe.make(),B=zt.make(t.glyphs,{version:t.getEnglishName("version"),fullName:A,familyName:E,weightName:C,postScriptName:R,unitsPerEm:t.unitsPerEm,fontBBox:[0,y.yMin,y.ascender,y.advanceWidthMax]}),F=t.metas&&Object.keys(t.metas).length>0?de.make(t.metas):void 0,N=[x,b,w,S,D,T,O,B,M];I&&N.push(I),t.tables.gsub&&N.push(ue.make(t.tables.gsub)),F&&N.push(F);for(var U=me(N),z=fe(U.encode()),G=U.fields,H=!1,W=0;W<G.length;W+=1)if("head table"===G[W].name){G[W].value.checkSumAdjustment=2981146554-z,H=!0;break}if(!H)throw new Error("Could not find head table with checkSum to adjust.");return U};function xe(t,e){for(var n=0,i=t.length-1;n<=i;){var r=n+i>>>1,s=t[r].tag;if(s===e)return r;s<e?n=r+1:i=r-1}return-n-1}function be(t,e){for(var n=0,i=t.length-1;n<=i;){var r=n+i>>>1,s=t[r];if(s===e)return r;s<e?n=r+1:i=r-1}return-n-1}function we(t,e){for(var n,i=0,r=t.length-1;i<=r;){var s=i+r>>>1,a=(n=t[s]).start;if(a===e)return n;a<e?i=s+1:r=s-1}if(i>0)return e>(n=t[i-1]).end?0:n}function Se(t,e){this.font=t,this.tableName=e}function Me(t){Se.call(this,t,"gpos")}function Te(t){Se.call(this,t,"gsub")}function Ee(t,e){var n=t.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Ce(t,e,n){for(var i=t.subtables,r=0;r<i.length;r++){var s=i[r];if(s.substFormat===e)return s}if(n)return i.push(n),n}function Ae(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i<t.length;++i)n[i]=t[i];return e}function Re(t,e){if(!t)throw e}function Le(t,e,n,i,r){var s;return(e&i)>0?(s=t.parseByte(),0==(e&r)&&(s=-s),s=n+s):s=(e&r)>0?n:n+t.parseShort(),s}function Pe(t,e,n){var i,r,s=new at.Parser(e,n);if(t.numberOfContours=s.parseShort(),t._xMin=s.parseShort(),t._yMin=s.parseShort(),t._xMax=s.parseShort(),t._yMax=s.parseShort(),t.numberOfContours>0){for(var a=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)a.push(s.parseUShort());t.instructionLength=s.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(s.parseByte());var h=a[a.length-1]+1;i=[];for(var c=0;c<h;c+=1)if(r=s.parseByte(),i.push(r),(8&r)>0)for(var u=s.parseByte(),d=0;d<u;d+=1)i.push(r),c+=1;if(P.argument(i.length===h,"Bad flags."),a.length>0){var p,f=[];if(h>0){for(var g=0;g<h;g+=1)r=i[g],(p={}).onCurve=!!(1&r),p.lastPointOfContour=a.indexOf(g)>=0,f.push(p);for(var m=0,v=0;v<h;v+=1)r=i[v],(p=f[v]).x=Le(s,r,m,2,16),m=p.x;for(var _=0,y=0;y<h;y+=1)r=i[y],(p=f[y]).y=Le(s,r,_,4,32),_=p.y}t.points=f}else t.points=[]}else if(0===t.numberOfContours)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var x=!0;x;){i=s.parseUShort();var b={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&i)>0?(2&i)>0?(b.dx=s.parseShort(),b.dy=s.parseShort()):b.matchedPoints=[s.parseUShort(),s.parseUShort()]:(2&i)>0?(b.dx=s.parseChar(),b.dy=s.parseChar()):b.matchedPoints=[s.parseByte(),s.parseByte()],(8&i)>0?b.xScale=b.yScale=s.parseF2Dot14():(64&i)>0?(b.xScale=s.parseF2Dot14(),b.yScale=s.parseF2Dot14()):(128&i)>0&&(b.xScale=s.parseF2Dot14(),b.scale01=s.parseF2Dot14(),b.scale10=s.parseF2Dot14(),b.yScale=s.parseF2Dot14()),t.components.push(b),x=!!(32&i)}if(256&i){t.instructionLength=s.parseUShort(),t.instructions=[];for(var w=0;w<t.instructionLength;w+=1)t.instructions.push(s.parseByte())}}}function ke(t,e){for(var n=[],i=0;i<t.length;i+=1){var r=t[i],s={x:e.xScale*r.x+e.scale01*r.y+e.dx,y:e.scale10*r.x+e.yScale*r.y+e.dy,onCurve:r.onCurve,lastPointOfContour:r.lastPointOfContour};n.push(s)}return n}function De(t){var e=new A;if(!t)return e;for(var n=function(t){for(var e=[],n=[],i=0;i<t.length;i+=1){var r=t[i];n.push(r),r.lastPointOfContour&&(e.push(n),n=[])}return P.argument(0===n.length,"There are still points left in the current contour."),e}(t),i=0;i<n.length;++i){var r=n[i],s=null,a=r[r.length-1],o=r[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var l={x:.5*(a.x+o.x),y:.5*(a.y+o.y)};e.moveTo(l.x,l.y)}for(var h=0;h<r.length;++h)if(s=a,a=o,o=r[(h+1)%r.length],a.onCurve)e.lineTo(a.x,a.y);else{var c=o;s.onCurve||(a.x,s.x,a.y,s.y),o.onCurve||(c={x:.5*(a.x+o.x),y:.5*(a.y+o.y)}),e.quadraticCurveTo(a.x,a.y,c.x,c.y)}e.closePath()}return e}function Ie(t,e){if(e.isComposite)for(var n=0;n<e.components.length;n+=1){var i=e.components[n],r=t.get(i.glyphIndex);if(r.getPath(),r.points){var s=void 0;if(void 0===i.matchedPoints)s=ke(r.points,i);else{if(i.matchedPoints[0]>e.points.length-1||i.matchedPoints[1]>r.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[i.matchedPoints[0]],o=r.points[i.matchedPoints[1]],l={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};o=ke([o],l)[0],l.dx=a.x-o.x,l.dy=a.y-o.y,s=ke(r.points,l)}e.points=e.points.concat(s)}}return De(e.points)}Se.prototype={searchTag:xe,binSearch:be,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(t){return t.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,n=0;n<t.scripts.length;n++){var i=t.scripts[n].tag;if("DFLT"===i)return i;"latn"===i&&(e=!0)}return e?"latn":void 0}},getScriptTable:function(t,e){var n=this.getTable(e);if(n){t=t||"DFLT";var i=n.scripts,r=xe(n.scripts,t);if(r>=0)return i[r].script;if(e){var s={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-r,0,s),s.script}}},getLangSysTable:function(t,e,n){var i=this.getScriptTable(t,n);if(i){if(!e||"dflt"===e||"DFLT"===e)return i.defaultLangSys;var r=xe(i.langSysRecords,e);if(r>=0)return i.langSysRecords[r].langSys;if(n){var s={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-r,0,s),s.langSys}}},getFeatureTable:function(t,e,n,i){var r=this.getLangSysTable(t,e,i);if(r){for(var s,a=r.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<a.length;l++)if((s=o[a[l]]).tag===n)return s.feature;if(i){var h=o.length;return P.assert(0===h||n>=o[h-1].tag,"Features must be added in alphabetical order."),s={tag:n,feature:{params:0,lookupListIndexes:[]}},o.push(s),a.push(h),s.feature}}},getLookupTables:function(t,e,n,i,r){var s=this.getFeatureTable(t,e,n,r),a=[];if(s){for(var o,l=s.lookupListIndexes,h=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)(o=h[l[c]]).lookupType===i&&a.push(o);if(0===a.length&&r){o={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=h.length;return h.push(o),l.push(u),[o]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var n=we(t.ranges,e);return n?n.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var n=be(t.glyphs,e);return n>=0?n:-1;case 2:var i=we(t.ranges,e);return i?i.index+e-i.start:-1}},expandCoverage:function(t){if(1===t.format)return t.glyphs;for(var e=[],n=t.ranges,i=0;i<n.length;i++)for(var r=n[i],s=r.start,a=r.end,o=s;o<=a;o++)e.push(o);return e}},Me.prototype=Se.prototype,Me.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Me.prototype.getKerningValue=function(t,e,n){for(var i=0;i<t.length;i++)for(var r=t[i].subtables,s=0;s<r.length;s++){var a=r[s],o=this.getCoverageIndex(a.coverage,e);if(!(o<0))switch(a.posFormat){case 1:for(var l=a.pairSets[o],h=0;h<l.length;h++){var c=l[h];if(c.secondGlyph===n)return c.value1&&c.value1.xAdvance||0}break;case 2:var u=this.getGlyphClass(a.classDef1,e),d=this.getGlyphClass(a.classDef2,n),p=a.classRecords[u][d];return p.value1&&p.value1.xAdvance||0}}return 0},Me.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)},Te.prototype=Se.prototype,Te.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Te.prototype.getSingle=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,1),s=0;s<r.length;s++)for(var a=r[s].subtables,o=0;o<a.length;o++){var l=a[o],h=this.expandCoverage(l.coverage),c=void 0;if(1===l.substFormat){var u=l.deltaGlyphId;for(c=0;c<h.length;c++){var d=h[c];i.push({sub:d,by:d+u})}}else{var p=l.substitute;for(c=0;c<h.length;c++)i.push({sub:h[c],by:p[c]})}}return i},Te.prototype.getAlternates=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,3),s=0;s<r.length;s++)for(var a=r[s].subtables,o=0;o<a.length;o++)for(var l=a[o],h=this.expandCoverage(l.coverage),c=l.alternateSets,u=0;u<h.length;u++)i.push({sub:h[u],by:c[u]});return i},Te.prototype.getLigatures=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,4),s=0;s<r.length;s++)for(var a=r[s].subtables,o=0;o<a.length;o++)for(var l=a[o],h=this.expandCoverage(l.coverage),c=l.ligatureSets,u=0;u<h.length;u++)for(var d=h[u],p=c[u],f=0;f<p.length;f++){var g=p[f];i.push({sub:[d].concat(g.components),by:g.ligGlyph})}return i},Te.prototype.addSingle=function(t,e,n,i){var r=Ce(this.getLookupTables(n,i,t,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});P.assert(1===r.coverage.format,"Ligature: unable to modify coverage table format "+r.coverage.format);var s=e.sub,a=this.binSearch(r.coverage.glyphs,s);a<0&&(a=-1-a,r.coverage.glyphs.splice(a,0,s),r.substitute.splice(a,0,0)),r.substitute[a]=e.by},Te.prototype.addAlternate=function(t,e,n,i){var r=Ce(this.getLookupTables(n,i,t,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});P.assert(1===r.coverage.format,"Ligature: unable to modify coverage table format "+r.coverage.format);var s=e.sub,a=this.binSearch(r.coverage.glyphs,s);a<0&&(a=-1-a,r.coverage.glyphs.splice(a,0,s),r.alternateSets.splice(a,0,0)),r.alternateSets[a]=e.by},Te.prototype.addLigature=function(t,e,n,i){var r=this.getLookupTables(n,i,t,4,!0)[0],s=r.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},r.subtables[0]=s),P.assert(1===s.coverage.format,"Ligature: unable to modify coverage table format "+s.coverage.format);var a=e.sub[0],o=e.sub.slice(1),l={ligGlyph:e.by,components:o},h=this.binSearch(s.coverage.glyphs,a);if(h>=0){for(var c=s.ligatureSets[h],u=0;u<c.length;u++)if(Ee(c[u].components,o))return;c.push(l)}else h=-1-h,s.coverage.glyphs.splice(h,0,a),s.ligatureSets.splice(h,0,[l])},Te.prototype.getFeature=function(t,e,n){if(/ss\d\d/.test(t))return this.getSingle(t,e,n);switch(t){case"aalt":case"salt":return this.getSingle(t,e,n).concat(this.getAlternates(t,e,n));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,n)}},Te.prototype.add=function(t,e,n,i){if(/ss\d\d/.test(t))return this.addSingle(t,e,n,i);switch(t){case"aalt":case"salt":return"number"==typeof e.by?this.addSingle(t,e,n,i):this.addAlternate(t,e,n,i);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,n,i)}};var Oe,Be,Fe,Ne,Ue={getPath:De,parse:function(t,e,n,i,r){return r.lowMemory?function(t,e,n,i){var r=new bt.GlyphSet(i);return i._push=function(s){var a=n[s];a!==n[s+1]?r.push(s,bt.ttfGlyphLoader(i,s,Pe,t,e+a,Ie)):r.push(s,bt.glyphLoader(i,s))},r}(t,e,n,i):function(t,e,n,i){for(var r=new bt.GlyphSet(i),s=0;s<n.length-1;s+=1){var a=n[s];a!==n[s+1]?r.push(s,bt.ttfGlyphLoader(i,s,Pe,t,e+a,Ie)):r.push(s,bt.glyphLoader(i,s))}return r}(t,e,n,i)}};function ze(t){this.font=t,this.getCommands=function(t){return Ue.getPath(t).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Ge(t){return t}function He(t){return Math.sign(t)*Math.round(Math.abs(t))}function We(t){return Math.sign(t)*Math.round(Math.abs(2*t))/2}function Ve(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function je(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Xe(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Ye=function(t){var e=this.srPeriod,n=this.srPhase,i=1;return t<0&&(t=-t,i=-1),t+=this.srThreshold-n,t=Math.trunc(t/e)*e,(t+=n)<0?n*i:t*i},Ze={x:1,y:0,axis:"x",distance:function(t,e,n,i){return(n?t.xo:t.x)-(i?e.xo:e.x)},interpolate:function(t,e,n,i){var r,s,a,o,l,h,c;if(!i||i===this)return r=t.xo-e.xo,s=t.xo-n.xo,l=e.x-e.xo,h=n.x-n.xo,0===(c=(a=Math.abs(r))+(o=Math.abs(s)))?void(t.x=t.xo+(l+h)/2):void(t.x=t.xo+(l*o+h*a)/c);r=i.distance(t,e,!0,!0),s=i.distance(t,n,!0,!0),l=i.distance(e,e,!1,!0),h=i.distance(n,n,!1,!0),0!==(c=(a=Math.abs(r))+(o=Math.abs(s)))?Ze.setRelative(t,t,(l*o+h*a)/c,i,!0):Ze.setRelative(t,t,(l+h)/2,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,n,i,r){if(i&&i!==this){var s=r?e.xo:e.x,a=r?e.yo:e.y,o=s+n*i.x,l=a+n*i.y;t.x=o+(t.y-l)/i.normalSlope}else t.x=(r?e.xo:e.x)+n},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},qe={x:0,y:1,axis:"y",distance:function(t,e,n,i){return(n?t.yo:t.y)-(i?e.yo:e.y)},interpolate:function(t,e,n,i){var r,s,a,o,l,h,c;if(!i||i===this)return r=t.yo-e.yo,s=t.yo-n.yo,l=e.y-e.yo,h=n.y-n.yo,0===(c=(a=Math.abs(r))+(o=Math.abs(s)))?void(t.y=t.yo+(l+h)/2):void(t.y=t.yo+(l*o+h*a)/c);r=i.distance(t,e,!0,!0),s=i.distance(t,n,!0,!0),l=i.distance(e,e,!1,!0),h=i.distance(n,n,!1,!0),0!==(c=(a=Math.abs(r))+(o=Math.abs(s)))?qe.setRelative(t,t,(l*o+h*a)/c,i,!0):qe.setRelative(t,t,(l+h)/2,i,!0)},normalSlope:0,setRelative:function(t,e,n,i,r){if(i&&i!==this){var s=r?e.xo:e.x,a=r?e.yo:e.y,o=s+n*i.x,l=a+n*i.y;t.y=l+i.normalSlope*(t.x-o)}else t.y=(r?e.yo:e.y)+n},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};function Je(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}function Ke(t,e){var n=Math.sqrt(t*t+e*e);return e/=n,1==(t/=n)&&0===e?Ze:0===t&&1===e?qe:new Je(t,e)}function Qe(t,e,n,i){this.x=this.xo=Math.round(64*t)/64,this.y=this.yo=Math.round(64*e)/64,this.lastPointOfContour=n,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(Ze),Object.freeze(qe),Je.prototype.distance=function(t,e,n,i){return this.x*Ze.distance(t,e,n,i)+this.y*qe.distance(t,e,n,i)},Je.prototype.interpolate=function(t,e,n,i){var r,s,a,o,l,h,c;a=i.distance(t,e,!0,!0),o=i.distance(t,n,!0,!0),r=i.distance(e,e,!1,!0),s=i.distance(n,n,!1,!0),0!==(c=(l=Math.abs(a))+(h=Math.abs(o)))?this.setRelative(t,t,(r*h+s*l)/c,i,!0):this.setRelative(t,t,(r+s)/2,i,!0)},Je.prototype.setRelative=function(t,e,n,i,r){i=i||this;var s=r?e.xo:e.x,a=r?e.yo:e.y,o=s+n*i.x,l=a+n*i.y,h=i.normalSlope,c=this.slope,u=t.x,d=t.y;t.x=(c*u-h*o+l-d)/(c-h),t.y=c*(t.x-u)+d},Je.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0},Qe.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},Qe.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var $e=Object.freeze(new Qe(0,0)),tn={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function en(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Ze,this.round=He}}function nn(t){for(var e=t.tZone=new Array(t.gZone.length),n=0;n<e.length;n++)e[n]=new Qe(0,0)}function rn(t,e){var n,i=t.prog,r=t.ip,s=1;do{if(88===(n=i[++r]))s++;else if(89===n)s--;else if(64===n)r+=i[r+1]+1;else if(65===n)r+=2*i[r+1]+1;else if(n>=176&&n<=183)r+=n-176+1;else if(n>=184&&n<=191)r+=2*(n-184+1);else if(e&&1===s&&27===n)break}while(s>0);t.ip=r}function sn(e,n){t.DEBUG&&console.log(n.step,"SVTCA["+e.axis+"]"),n.fv=n.pv=n.dpv=e}function an(e,n){t.DEBUG&&console.log(n.step,"SPVTCA["+e.axis+"]"),n.pv=n.dpv=e}function on(e,n){t.DEBUG&&console.log(n.step,"SFVTCA["+e.axis+"]"),n.fv=e}function ln(e,n){var i,r,s=n.stack,a=s.pop(),o=s.pop(),l=n.z2[a],h=n.z1[o];t.DEBUG&&console.log("SPVTL["+e+"]",a,o),e?(i=l.y-h.y,r=h.x-l.x):(i=h.x-l.x,r=h.y-l.y),n.pv=n.dpv=Ke(i,r)}function hn(e,n){var i,r,s=n.stack,a=s.pop(),o=s.pop(),l=n.z2[a],h=n.z1[o];t.DEBUG&&console.log("SFVTL["+e+"]",a,o),e?(i=l.y-h.y,r=h.x-l.x):(i=h.x-l.x,r=h.y-l.y),n.fv=Ke(i,r)}function cn(e){t.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function un(e,n){var i=n.stack.pop(),r=n.z0[i],s=n.fv,a=n.pv;t.DEBUG&&console.log(n.step,"MDAP["+e+"]",i);var o=a.distance(r,$e);e&&(o=n.round(o)),s.setRelative(r,$e,o,a),s.touch(r),n.rp0=n.rp1=i}function dn(e,n){var i,r,s,a=n.z2,o=a.length-2;t.DEBUG&&console.log(n.step,"IUP["+e.axis+"]");for(var l=0;l<o;l++)i=a[l],e.touched(i)||(r=i.prevTouched(e))!==i&&(r===(s=i.nextTouched(e))&&e.setRelative(i,i,e.distance(r,r,!1,!0),e,!0),e.interpolate(i,r,s,e))}function pn(e,n){for(var i=n.stack,r=e?n.rp1:n.rp2,s=(e?n.z0:n.z1)[r],a=n.fv,o=n.pv,l=n.loop,h=n.z2;l--;){var c=i.pop(),u=h[c],d=o.distance(s,s,!1,!0);a.setRelative(u,u,d,o),a.touch(u),t.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",c)}n.loop=1}function fn(e,n){var i=n.stack,r=e?n.rp1:n.rp2,s=(e?n.z0:n.z1)[r],a=n.fv,o=n.pv,l=i.pop(),h=n.z2[n.contours[l]],c=h;t.DEBUG&&console.log(n.step,"SHC["+e+"]",l);var u=o.distance(s,s,!1,!0);do{c!==s&&a.setRelative(c,c,u,o),c=c.nextPointOnContour}while(c!==h)}function gn(e,n){var i,r,s=n.stack,a=e?n.rp1:n.rp2,o=(e?n.z0:n.z1)[a],l=n.fv,h=n.pv,c=s.pop();switch(t.DEBUG&&console.log(n.step,"SHZ["+e+"]",c),c){case 0:i=n.tZone;break;case 1:i=n.gZone;break;default:throw new Error("Invalid zone")}for(var u=h.distance(o,o,!1,!0),d=i.length-2,p=0;p<d;p++)r=i[p],l.setRelative(r,r,u,h)}function mn(e,n){var i=n.stack,r=i.pop()/64,s=i.pop(),a=n.z1[s],o=n.z0[n.rp0],l=n.fv,h=n.pv;l.setRelative(a,o,r,h),l.touch(a),t.DEBUG&&console.log(n.step,"MSIRP["+e+"]",r,s),n.rp1=n.rp0,n.rp2=s,e&&(n.rp0=s)}function vn(e,n){var i=n.stack,r=i.pop(),s=i.pop(),a=n.z0[s],o=n.fv,l=n.pv,h=n.cvt[r];t.DEBUG&&console.log(n.step,"MIAP["+e+"]",r,"(",h,")",s);var c=l.distance(a,$e);e&&(Math.abs(c-h)<n.cvCutIn&&(c=h),c=n.round(c)),o.setRelative(a,$e,c,l),0===n.zp0&&(a.xo=a.x,a.yo=a.y),o.touch(a),n.rp0=n.rp1=s}function _n(e,n){var i=n.stack,r=i.pop(),s=n.z2[r];t.DEBUG&&console.log(n.step,"GC["+e+"]",r),i.push(64*n.dpv.distance(s,$e,e,!1))}function yn(e,n){var i=n.stack,r=i.pop(),s=i.pop(),a=n.z1[r],o=n.z0[s],l=n.dpv.distance(o,a,e,e);t.DEBUG&&console.log(n.step,"MD["+e+"]",r,s,"->",l),n.stack.push(Math.round(64*l))}function xn(e,n){var i=n.stack,r=i.pop(),s=n.fv,a=n.pv,o=n.ppem,l=n.deltaBase+16*(e-1),h=n.deltaShift,c=n.z0;t.DEBUG&&console.log(n.step,"DELTAP["+e+"]",r,i);for(var u=0;u<r;u++){var d=i.pop(),p=i.pop();if(l+((240&p)>>4)===o){var f=(15&p)-8;f>=0&&f++,t.DEBUG&&console.log(n.step,"DELTAPFIX",d,"by",f*h);var g=c[d];s.setRelative(g,g,f*h,a)}}}function bn(e,n){var i=n.stack,r=i.pop();t.DEBUG&&console.log(n.step,"ROUND[]"),i.push(64*n.round(r/64))}function wn(e,n){var i=n.stack,r=i.pop(),s=n.ppem,a=n.deltaBase+16*(e-1),o=n.deltaShift;t.DEBUG&&console.log(n.step,"DELTAC["+e+"]",r,i);for(var l=0;l<r;l++){var h=i.pop(),c=i.pop();if(a+((240&c)>>4)===s){var u=(15&c)-8;u>=0&&u++;var d=u*o;t.DEBUG&&console.log(n.step,"DELTACFIX",h,"by",d),n.cvt[h]+=d}}}function Sn(e,n){var i,r,s=n.stack,a=s.pop(),o=s.pop(),l=n.z2[a],h=n.z1[o];t.DEBUG&&console.log(n.step,"SDPVTL["+e+"]",a,o),e?(i=l.y-h.y,r=h.x-l.x):(i=h.x-l.x,r=h.y-l.y),n.dpv=Ke(i,r)}function Mn(e,n){var i=n.stack,r=n.prog,s=n.ip;t.DEBUG&&console.log(n.step,"PUSHB["+e+"]");for(var a=0;a<e;a++)i.push(r[++s]);n.ip=s}function Tn(e,n){var i=n.ip,r=n.prog,s=n.stack;t.DEBUG&&console.log(n.ip,"PUSHW["+e+"]");for(var a=0;a<e;a++){var o=r[++i]<<8|r[++i];32768&o&&(o=-(1+(65535^o))),s.push(o)}n.ip=i}function En(e,n,i,r,s,a){var o,l,h,c,u=a.stack,d=e&&u.pop(),p=u.pop(),f=a.rp0,g=a.z0[f],m=a.z1[p],v=a.minDis,_=a.fv,y=a.dpv;h=(l=o=y.distance(m,g,!0,!0))>=0?1:-1,l=Math.abs(l),e&&(c=a.cvt[d],r&&Math.abs(l-c)<a.cvCutIn&&(l=c)),i&&l<v&&(l=v),r&&(l=a.round(l)),_.setRelative(m,g,h*l,y),_.touch(m),t.DEBUG&&console.log(a.step,(e?"MIRP[":"MDRP[")+(n?"M":"m")+(i?">":"_")+(r?"R":"_")+(0===s?"Gr":1===s?"Bl":2===s?"Wh":"")+"]",e?d+"("+a.cvt[d]+","+c+")":"",p,"(d =",o,"->",h*l,")"),a.rp1=a.rp0,a.rp2=p,n&&(a.rp0=p)}function Cn(t){this.char=t,this.state={},this.activeState=null}function An(t,e,n){this.contextName=n,this.startIndex=t,this.endOffset=e}function Rn(t,e,n){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=n}function Ln(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Pn(t){this.eventId=t,this.subscribers=[]}function kn(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],function(t){var e=this,n=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];n.forEach(function(t){Object.defineProperty(e.events,t,{value:new Pn(t)})}),t&&n.forEach(function(n){var i=t[n];"function"==typeof i&&e.events[n].subscribe(i)}),["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach(function(t){e.events[t].subscribe(e.updateContextsRanges)})}.call(this,t)}function Dn(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function In(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function On(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Bn(t){return/[A-z]/.test(t)}function Fn(t){this.font=t,this.features={}}function Nn(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Un(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var n=e.ranges,i=0;i<n.length;i++){var r=n[i];if(t>=r.start&&t<=r.end){var s=t-r.start;return r.index+s}}break;default:return-1}return-1}function zn(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i],s=e.current,a=Un(s=Array.isArray(s)?s[0]:s,r);-1!==a&&n.push(a)}return n.length!==t.length?-1:n}ze.prototype.exec=function(e,n){if("number"!=typeof n)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var i=this.font,r=this._prepState;if(!r||r.ppem!==n){var s=this._fpgmState;if(!s){en.prototype=tn,(s=this._fpgmState=new en("fpgm",i.tables.fpgm)).funcs=[],s.font=i,t.DEBUG&&(console.log("---EXEC FPGM---"),s.step=-1);try{Be(s)}catch(t){return console.log("Hinting error in FPGM:"+t),void(this._errorState=3)}}en.prototype=s,(r=this._prepState=new en("prep",i.tables.prep)).ppem=n;var a=i.tables.cvt;if(a)for(var o=r.cvt=new Array(a.length),l=n/i.unitsPerEm,h=0;h<a.length;h++)o[h]=a[h]*l;else r.cvt=[];t.DEBUG&&(console.log("---EXEC PREP---"),r.step=-1);try{Be(r)}catch(t){this._errorState<2&&console.log("Hinting error in PREP:"+t),this._errorState=2}}if(!(this._errorState>1))try{return Fe(e,r)}catch(t){return this._errorState<1&&(console.log("Hinting error:"+t),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},Fe=function(e,n){var i,r,s,a=n.ppem/n.font.unitsPerEm,o=a,l=e.components;if(en.prototype=n,l){var h=n.font;r=[],i=[];for(var c=0;c<l.length;c++){var u=l[c],d=h.glyphs.get(u.glyphIndex);s=new en("glyf",d.instructions),t.DEBUG&&(console.log("---EXEC COMP "+c+"---"),s.step=-1),Ne(d,s,a,o);for(var p=Math.round(u.dx*a),f=Math.round(u.dy*o),g=s.gZone,m=s.contours,v=0;v<g.length;v++){var _=g[v];_.xTouched=_.yTouched=!1,_.xo=_.x=_.x+p,_.yo=_.y=_.y+f}var y=r.length;r.push.apply(r,g);for(var x=0;x<m.length;x++)i.push(m[x]+y)}e.instructions&&!s.inhibitGridFit&&((s=new en("glyf",e.instructions)).gZone=s.z0=s.z1=s.z2=r,s.contours=i,r.push(new Qe(0,0),new Qe(Math.round(e.advanceWidth*a),0)),t.DEBUG&&(console.log("---EXEC COMPOSITE---"),s.step=-1),Be(s),r.length-=2)}else s=new en("glyf",e.instructions),t.DEBUG&&(console.log("---EXEC GLYPH---"),s.step=-1),Ne(e,s,a,o),r=s.gZone;return r},Ne=function(e,n,i,r){for(var s,a,o,l=e.points||[],h=l.length,c=n.gZone=n.z0=n.z1=n.z2=[],u=n.contours=[],d=0;d<h;d++)s=l[d],c[d]=new Qe(s.x*i,s.y*r,s.lastPointOfContour,s.onCurve);for(var p=0;p<h;p++)s=c[p],a||(a=s,u.push(p)),s.lastPointOfContour?(s.nextPointOnContour=a,a.prevPointOnContour=s,a=void 0):(o=c[p+1],s.nextPointOnContour=o,o.prevPointOnContour=s);if(!n.inhibitGridFit){if(t.DEBUG){console.log("PROCESSING GLYPH",n.stack);for(var f=0;f<h;f++)console.log(f,c[f].x,c[f].y)}if(c.push(new Qe(0,0),new Qe(Math.round(e.advanceWidth*i),0)),Be(n),c.length-=2,t.DEBUG){console.log("FINISHED GLYPH",n.stack);for(var g=0;g<h;g++)console.log(g,c[g].x,c[g].y)}}},Be=function(e){var n=e.prog;if(n){var i,r=n.length;for(e.ip=0;e.ip<r;e.ip++){if(t.DEBUG&&e.step++,!(i=Oe[n[e.ip]]))throw new Error("unknown instruction: 0x"+Number(n[e.ip]).toString(16));i(e)}}},Oe=[sn.bind(void 0,qe),sn.bind(void 0,Ze),an.bind(void 0,qe),an.bind(void 0,Ze),on.bind(void 0,qe),on.bind(void 0,Ze),ln.bind(void 0,0),ln.bind(void 0,1),hn.bind(void 0,0),hn.bind(void 0,1),function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"SPVFS[]",i,r),e.pv=e.dpv=Ke(r,i)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"SPVFS[]",i,r),e.fv=Ke(r,i)},function(e){var n=e.stack,i=e.pv;t.DEBUG&&console.log(e.step,"GPV[]"),n.push(16384*i.x),n.push(16384*i.y)},function(e){var n=e.stack,i=e.fv;t.DEBUG&&console.log(e.step,"GFV[]"),n.push(16384*i.x),n.push(16384*i.y)},function(e){e.fv=e.pv,t.DEBUG&&console.log(e.step,"SFVTPV[]")},function(e){var n=e.stack,i=n.pop(),r=n.pop(),s=n.pop(),a=n.pop(),o=n.pop(),l=e.z0,h=e.z1,c=l[i],u=l[r],d=h[s],p=h[a],f=e.z2[o];t.DEBUG&&console.log("ISECT[], ",i,r,s,a,o);var g=c.x,m=c.y,v=u.x,_=u.y,y=d.x,x=d.y,b=p.x,w=p.y,S=(g-v)*(x-w)-(m-_)*(y-b),M=g*_-m*v,T=y*w-x*b;f.x=(M*(y-b)-T*(g-v))/S,f.y=(M*(x-w)-T*(m-_))/S},function(e){e.rp0=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)},function(e){e.rp1=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)},function(e){e.rp2=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP0[]",n),e.zp0=n,n){case 0:e.tZone||nn(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP1[]",n),e.zp1=n,n){case 0:e.tZone||nn(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP2[]",n),e.zp2=n,n){case 0:e.tZone||nn(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZPS[]",n),e.zp0=e.zp1=e.zp2=n,n){case 0:e.tZone||nn(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),t.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)},function(e){t.DEBUG&&console.log(e.step,"RTG[]"),e.round=He},function(e){t.DEBUG&&console.log(e.step,"RTHG[]"),e.round=Ve},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SMD[]",n),e.minDis=n/64},function(e){t.DEBUG&&console.log(e.step,"ELSE[]"),rn(e,!1)},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"JMPR[]",n),e.ip+=n-1},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SCVTCI[]",n),e.cvCutIn=n/64},void 0,void 0,function(e){var n=e.stack;t.DEBUG&&console.log(e.step,"DUP[]"),n.push(n[n.length-1])},cn,function(e){t.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"SWAP[]"),n.push(i),n.push(r)},function(e){var n=e.stack;t.DEBUG&&console.log(e.step,"DEPTH[]"),n.push(n.length)},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"CINDEX[]",i),n.push(n[n.length-i])},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"MINDEX[]",i),n.push(n.splice(n.length-i,1)[0])},void 0,void 0,void 0,function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"LOOPCALL[]",i,r);var s=e.ip,a=e.prog;e.prog=e.funcs[i];for(var o=0;o<r;o++)Be(e),t.DEBUG&&console.log(++e.step,o+1<r?"next loopcall":"done loopcall",o);e.ip=s,e.prog=a},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"CALL[]",n);var i=e.ip,r=e.prog;e.prog=e.funcs[n],Be(e),e.ip=i,e.prog=r,t.DEBUG&&console.log(++e.step,"returning from",n)},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var n=e.stack,i=e.prog,r=e.ip,s=n.pop(),a=r;for(t.DEBUG&&console.log(e.step,"FDEF[]",s);45!==i[++r];);e.ip=r,e.funcs[s]=i.slice(a+1,r)},void 0,un.bind(void 0,0),un.bind(void 0,1),dn.bind(void 0,qe),dn.bind(void 0,Ze),pn.bind(void 0,0),pn.bind(void 0,1),fn.bind(void 0,0),fn.bind(void 0,1),gn.bind(void 0,0),gn.bind(void 0,1),function(e){for(var n=e.stack,i=e.loop,r=e.fv,s=n.pop()/64,a=e.z2;i--;){var o=n.pop(),l=a[o];t.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-i)+": ":"")+"SHPIX[]",o,s),r.setRelative(l,l,s),r.touch(l)}e.loop=1},function(e){for(var n=e.stack,i=e.rp1,r=e.rp2,s=e.loop,a=e.z0[i],o=e.z1[r],l=e.fv,h=e.dpv,c=e.z2;s--;){var u=n.pop(),d=c[u];t.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"IP[]",u,i,"<->",r),l.interpolate(d,a,o,h),l.touch(d)}e.loop=1},mn.bind(void 0,0),mn.bind(void 0,1),function(e){for(var n=e.stack,i=e.rp0,r=e.z0[i],s=e.loop,a=e.fv,o=e.pv,l=e.z1;s--;){var h=n.pop(),c=l[h];t.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"ALIGNRP[]",h),a.setRelative(c,r,0,o),a.touch(c)}e.loop=1},function(e){t.DEBUG&&console.log(e.step,"RTDG[]"),e.round=We},vn.bind(void 0,0),vn.bind(void 0,1),function(e){var n=e.prog,i=e.ip,r=e.stack,s=n[++i];t.DEBUG&&console.log(e.step,"NPUSHB[]",s);for(var a=0;a<s;a++)r.push(n[++i]);e.ip=i},function(e){var n=e.ip,i=e.prog,r=e.stack,s=i[++n];t.DEBUG&&console.log(e.step,"NPUSHW[]",s);for(var a=0;a<s;a++){var o=i[++n]<<8|i[++n];32768&o&&(o=-(1+(65535^o))),r.push(o)}e.ip=n},function(e){var n=e.stack,i=e.store;i||(i=e.store=[]);var r=n.pop(),s=n.pop();t.DEBUG&&console.log(e.step,"WS",r,s),i[s]=r},function(e){var n=e.stack,i=e.store,r=n.pop();t.DEBUG&&console.log(e.step,"RS",r);var s=i&&i[r]||0;n.push(s)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"WCVTP",i,r),e.cvt[r]=i/64},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"RCVT",i),n.push(64*e.cvt[i])},_n.bind(void 0,0),_n.bind(void 0,1),void 0,yn.bind(void 0,0),yn.bind(void 0,1),function(e){t.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)},void 0,function(e){t.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0},void 0,void 0,function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"LT[]",i,r),n.push(r<i?1:0)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"LTEQ[]",i,r),n.push(r<=i?1:0)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"GT[]",i,r),n.push(r>i?1:0)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"GTEQ[]",i,r),n.push(r>=i?1:0)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"EQ[]",i,r),n.push(i===r?1:0)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"NEQ[]",i,r),n.push(i!==r?1:0)},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"ODD[]",i),n.push(Math.trunc(i)%2?1:0)},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"EVEN[]",i),n.push(Math.trunc(i)%2?0:1)},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"IF[]",n),n||(rn(e,!0),t.DEBUG&&console.log(e.step,"EIF[]"))},function(e){t.DEBUG&&console.log(e.step,"EIF[]")},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"AND[]",i,r),n.push(i&&r?1:0)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"OR[]",i,r),n.push(i||r?1:0)},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"NOT[]",i),n.push(i?0:1)},xn.bind(void 0,1),function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SDB[]",n),e.deltaBase=n},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SDS[]",n),e.deltaShift=Math.pow(.5,n)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"ADD[]",i,r),n.push(r+i)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"SUB[]",i,r),n.push(r-i)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"DIV[]",i,r),n.push(64*r/i)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"MUL[]",i,r),n.push(r*i/64)},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"ABS[]",i),n.push(Math.abs(i))},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"NEG[]",i),n.push(-i)},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"FLOOR[]",i),n.push(64*Math.floor(i/64))},function(e){var n=e.stack,i=n.pop();t.DEBUG&&console.log(e.step,"CEILING[]",i),n.push(64*Math.ceil(i/64))},bn.bind(void 0,0),bn.bind(void 0,1),bn.bind(void 0,2),bn.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"WCVTF[]",i,r),e.cvt[r]=i*e.ppem/e.font.unitsPerEm},xn.bind(void 0,2),xn.bind(void 0,3),wn.bind(void 0,1),wn.bind(void 0,2),wn.bind(void 0,3),function(e){var n,i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SROUND[]",i),e.round=Ye,192&i){case 0:n=.5;break;case 64:n=1;break;case 128:n=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=n,48&i){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*n;break;case 32:e.srPhase=.5*n;break;case 48:e.srPhase=.75*n;break;default:throw new Error("invalid SROUND value")}i&=15,e.srThreshold=0===i?0:(i/8-.5)*n},function(e){var n,i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"S45ROUND[]",i),e.round=Ye,192&i){case 0:n=Math.sqrt(2)/2;break;case 64:n=Math.sqrt(2);break;case 128:n=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=n,48&i){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*n;break;case 32:e.srPhase=.5*n;break;case 48:e.srPhase=.75*n;break;default:throw new Error("invalid S45ROUND value")}i&=15,e.srThreshold=0===i?0:(i/8-.5)*n},void 0,void 0,function(e){t.DEBUG&&console.log(e.step,"ROFF[]"),e.round=Ge},void 0,function(e){t.DEBUG&&console.log(e.step,"RUTG[]"),e.round=je},function(e){t.DEBUG&&console.log(e.step,"RDTG[]"),e.round=Xe},cn,cn,void 0,void 0,void 0,void 0,void 0,function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SCANCTRL[]",n)},Sn.bind(void 0,0),Sn.bind(void 0,1),function(e){var n=e.stack,i=n.pop(),r=0;t.DEBUG&&console.log(e.step,"GETINFO[]",i),1&i&&(r=35),32&i&&(r|=4096),n.push(r)},void 0,function(e){var n=e.stack,i=n.pop(),r=n.pop(),s=n.pop();t.DEBUG&&console.log(e.step,"ROLL[]"),n.push(r),n.push(i),n.push(s)},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"MAX[]",i,r),n.push(Math.max(r,i))},function(e){var n=e.stack,i=n.pop(),r=n.pop();t.DEBUG&&console.log(e.step,"MIN[]",i,r),n.push(Math.min(r,i))},function(e){var n=e.stack.pop();t.DEBUG&&console.log(e.step,"SCANTYPE[]",n)},function(e){var n=e.stack.pop(),i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"INSTCTRL[]",n,i),n){case 1:return void(e.inhibitGridFit=!!i);case 2:return void(e.ignoreCvt=!!i);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Mn.bind(void 0,1),Mn.bind(void 0,2),Mn.bind(void 0,3),Mn.bind(void 0,4),Mn.bind(void 0,5),Mn.bind(void 0,6),Mn.bind(void 0,7),Mn.bind(void 0,8),Tn.bind(void 0,1),Tn.bind(void 0,2),Tn.bind(void 0,3),Tn.bind(void 0,4),Tn.bind(void 0,5),Tn.bind(void 0,6),Tn.bind(void 0,7),Tn.bind(void 0,8),En.bind(void 0,0,0,0,0,0),En.bind(void 0,0,0,0,0,1),En.bind(void 0,0,0,0,0,2),En.bind(void 0,0,0,0,0,3),En.bind(void 0,0,0,0,1,0),En.bind(void 0,0,0,0,1,1),En.bind(void 0,0,0,0,1,2),En.bind(void 0,0,0,0,1,3),En.bind(void 0,0,0,1,0,0),En.bind(void 0,0,0,1,0,1),En.bind(void 0,0,0,1,0,2),En.bind(void 0,0,0,1,0,3),En.bind(void 0,0,0,1,1,0),En.bind(void 0,0,0,1,1,1),En.bind(void 0,0,0,1,1,2),En.bind(void 0,0,0,1,1,3),En.bind(void 0,0,1,0,0,0),En.bind(void 0,0,1,0,0,1),En.bind(void 0,0,1,0,0,2),En.bind(void 0,0,1,0,0,3),En.bind(void 0,0,1,0,1,0),En.bind(void 0,0,1,0,1,1),En.bind(void 0,0,1,0,1,2),En.bind(void 0,0,1,0,1,3),En.bind(void 0,0,1,1,0,0),En.bind(void 0,0,1,1,0,1),En.bind(void 0,0,1,1,0,2),En.bind(void 0,0,1,1,0,3),En.bind(void 0,0,1,1,1,0),En.bind(void 0,0,1,1,1,1),En.bind(void 0,0,1,1,1,2),En.bind(void 0,0,1,1,1,3),En.bind(void 0,1,0,0,0,0),En.bind(void 0,1,0,0,0,1),En.bind(void 0,1,0,0,0,2),En.bind(void 0,1,0,0,0,3),En.bind(void 0,1,0,0,1,0),En.bind(void 0,1,0,0,1,1),En.bind(void 0,1,0,0,1,2),En.bind(void 0,1,0,0,1,3),En.bind(void 0,1,0,1,0,0),En.bind(void 0,1,0,1,0,1),En.bind(void 0,1,0,1,0,2),En.bind(void 0,1,0,1,0,3),En.bind(void 0,1,0,1,1,0),En.bind(void 0,1,0,1,1,1),En.bind(void 0,1,0,1,1,2),En.bind(void 0,1,0,1,1,3),En.bind(void 0,1,1,0,0,0),En.bind(void 0,1,1,0,0,1),En.bind(void 0,1,1,0,0,2),En.bind(void 0,1,1,0,0,3),En.bind(void 0,1,1,0,1,0),En.bind(void 0,1,1,0,1,1),En.bind(void 0,1,1,0,1,2),En.bind(void 0,1,1,0,1,3),En.bind(void 0,1,1,1,0,0),En.bind(void 0,1,1,1,0,1),En.bind(void 0,1,1,1,0,2),En.bind(void 0,1,1,1,0,3),En.bind(void 0,1,1,1,1,0),En.bind(void 0,1,1,1,1,1),En.bind(void 0,1,1,1,1,2),En.bind(void 0,1,1,1,1,3)],Cn.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},Cn.prototype.getState=function(t){return this.state[t]||null},kn.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},kn.prototype.composeRUD=function(t){var e=this,n=t.map(function(t){return e[t[0]].apply(e,t.slice(1).concat(!0))}),i=function(t){return"object"==typeof t&&t.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(t){return!i(t)})])},kn.prototype.replaceRange=function(t,e,n,i){e=null!==e?e:this.tokens.length;var r=n.every(function(t){return t instanceof Cn});if(!isNaN(t)&&this.inboundIndex(t)&&r){var s=this.tokens.splice.apply(this.tokens,[t,e].concat(n));return i||this.dispatch("replaceToken",[t,e,n]),[s,n]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},kn.prototype.replaceToken=function(t,e,n){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Cn){var i=this.tokens.splice(t,1,e);return n||this.dispatch("replaceToken",[t,e]),[i[0],e]}return{FAIL:"replaceToken: invalid token or index."}},kn.prototype.removeRange=function(t,e,n){e=isNaN(e)?this.tokens.length:e;var i=this.tokens.splice(t,e);return n||this.dispatch("removeRange",[i,t,e]),i},kn.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var n=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[n,t]),n}return{FAIL:"removeToken: invalid token index."}},kn.prototype.insertToken=function(t,e,n){return t.every(function(t){return t instanceof Cn})?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),n||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},kn.prototype.registerModifier=function(t,e,n){this.events.newToken.subscribe(function(i,r){var s=[i,r],a=[i,r];if(null===e||!0===e.apply(this,s)){var o=n.apply(this,a);i.setState(t,o)}}),this.registeredModifiers.push(t)},Pn.prototype.subscribe=function(t){return"function"==typeof t?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Pn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},Ln.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},Ln.prototype.get=function(t){switch(!0){case 0===t:return this.current;case t<0&&Math.abs(t)<=this.backtrack.length:return this.backtrack.slice(t)[0];case t>0&&t<=this.lookahead.length:return this.lookahead[t-1];default:return null}},kn.prototype.rangeToText=function(t){if(t instanceof An)return this.getRangeTokens(t).map(function(t){return t.char}).join("")},kn.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},kn.prototype.getContext=function(t){return this.registeredContexts[t]||null},kn.prototype.on=function(t,e){var n=this.events[t];return n?n.subscribe(e):null},kn.prototype.dispatch=function(t,e){var n=this,i=this.events[t];i instanceof Pn&&i.subscribers.forEach(function(t){t.apply(n,e||[])})},kn.prototype.registerContextChecker=function(t,e,n){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if("function"!=typeof e)return{FAIL:"missing context start check."};if("function"!=typeof n)return{FAIL:"missing context end check."};var i=new Rn(t,e,n);return this.registeredContexts[t]=i,this.contextCheckers.push(i),i},kn.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},kn.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},kn.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)t.hasOwnProperty(e)&&(t[e].ranges=[])},kn.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(t){return t.char}),e=0;e<t.length;e++){var n=new Ln(t,e);this.runContextCheck(n)}this.dispatch("updateContextsRanges",[this.registeredContexts])},kn.prototype.setEndOffset=function(t,e){var n=new An(this.getContext(e).openRange.startIndex,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n},kn.prototype.runContextCheck=function(t){var e=this,n=t.index;this.contextCheckers.forEach(function(i){var r=i.contextName,s=e.getContext(r).openRange;if(!s&&i.checkStart(t)&&(s=new An(n,null,r),e.getContext(r).openRange=s,e.dispatch("contextStart",[r,n])),s&&i.checkEnd(t)){var a=n-s.startIndex+1,o=e.setEndOffset(a,r);e.dispatch("contextEnd",[r,o])}})},kn.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var n=0;n<e.length;n++){var i=e[n],r=new Ln(e,n);this.dispatch("next",[r]),this.runContextCheck(r);var s=new Cn(i);this.tokens.push(s),this.dispatch("newToken",[s,r])}return this.dispatch("end",[this.tokens]),this.tokens},Fn.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var n=t[e];if("DFLT"===n.tag)return n.script.defaultLangSys.featureIndexes}return[]},Fn.prototype.getScriptFeaturesIndexes=function(t){if(!this.font.tables.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var e=this.font.tables.gsub.scripts,n=0;n<e.length;n++){var i=e[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var r=i.langSysRecords;if(r)for(var s=0;s<r.length;s++){var a=r[s];if(a.tag===t)return a.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},Fn.prototype.mapTagsToFeatures=function(t,e){for(var n={},i=0;i<t.length;i++){var r=t[i].tag,s=t[i].feature;n[r]=s}this.features[e].tags=n},Fn.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var n=this.getScriptFeaturesIndexes(t);if(!n)return null;var i=this.font.tables.gsub;return e=n.map(function(t){return i.features[t]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},Fn.prototype.getSubstitutionType=function(t,e){return t.lookupType.toString()+e.substFormat.toString()},Fn.prototype.getLookupMethod=function(t,e){var n=this;switch(this.getSubstitutionType(t,e)){case"11":return function(t){return function(t,e){return-1===Un(t,e.coverage)?null:t+e.deltaGlyphId}.apply(n,[t,e])};case"12":return function(t){return function(t,e){var n=Un(t,e.coverage);return-1===n?null:e.substitute[n]}.apply(n,[t,e])};case"63":return function(t){return function(t,e){var n=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<n)return[];var i=zn(e.inputCoverage,t);if(-1===i)return[];var r=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var s=t.lookahead.slice(r);s.length&&On(s[0].char);)s.shift();var a=new Ln(s,0),o=zn(e.lookaheadCoverage,a),l=[].concat(t.backtrack);for(l.reverse();l.length&&On(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var h=new Ln(l,0),c=zn(e.backtrackCoverage,h),u=[];if(i.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length)for(var d=0;d<e.lookupRecords.length;d++)for(var p=e.lookupRecords[d].lookupListIndex,f=this.getLookupByIndex(p),g=0;g<f.subtables.length;g++){var m=f.subtables[g],v=this.getLookupMethod(f,m);if("12"===this.getSubstitutionType(f,m))for(var _=0;_<i.length;_++){var y=v(t.get(_));y&&u.push(y)}}return u}.apply(n,[t,e])};case"41":return function(t){return function(t,e){var n,i=Un(t.current,e.coverage);if(-1===i)return null;for(var r=e.ligatureSets[i],s=0;s<r.length;s++){n=r[s];for(var a=0;a<n.components.length&&t.lookahead[a]===n.components[a];a++)if(a===n.components.length-1)return n}return null}.apply(n,[t,e])};case"21":return function(t){return function(t,e){var n=Un(t,e.coverage);return-1===n?null:e.sequences[n]}.apply(n,[t,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},Fn.prototype.lookupFeature=function(t){var e=t.contextParams,n=e.index,i=this.getFeature({tag:t.tag,script:t.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var r=this.getFeatureLookups(i),s=[].concat(e.context),a=0;a<r.length;a++)for(var o=r[a],l=this.getLookupSubtables(o),h=0;h<l.length;h++){var c=l[h],u=this.getSubstitutionType(o,c),d=this.getLookupMethod(o,c),p=void 0;switch(u){case"11":(p=d(e.current))&&s.splice(n,1,new Nn({id:11,tag:t.tag,substitution:p}));break;case"12":(p=d(e.current))&&s.splice(n,1,new Nn({id:12,tag:t.tag,substitution:p}));break;case"63":p=d(e),Array.isArray(p)&&p.length&&s.splice(n,1,new Nn({id:63,tag:t.tag,substitution:p}));break;case"41":(p=d(e))&&s.splice(n,1,new Nn({id:41,tag:t.tag,substitution:p}));break;case"21":(p=d(e.current))&&s.splice(n,1,new Nn({id:21,tag:t.tag,substitution:p}))}e=new Ln(s,n),Array.isArray(p)&&!p.length||(p=null)}return s.length?s:null},Fn.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var n=this.features[t.script].some(function(e){return e.tag===t.tag});return e&&n},Fn.prototype.getLookupSubtables=function(t){return t.subtables||null},Fn.prototype.getLookupByIndex=function(t){return this.font.tables.gsub.lookups[t]||null},Fn.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Fn.prototype.getFeature=function(t){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(t.script)||this.getScriptFeatures(t.script);var e=this.features[t.script];return e?e.tags[t.tag]?this.features[t.script].tags[t.tag]:null:{FAIL:"No feature for script "+t.script}};var Gn={startCheck:function(t){var e=t.current,n=t.get(-1);return null===n&&Dn(e)||!Dn(n)&&Dn(e)},endCheck:function(t){var e=t.get(1);return null===e||!Dn(e)}},Hn={startCheck:function(t){var e=t.current,n=t.get(-1);return(Dn(e)||On(e))&&!Dn(n)},endCheck:function(t){var e=t.get(1);switch(!0){case null===e:return!0;case!Dn(e)&&!On(e):var n=/\s/.test(e);if(!n)return!0;if(n&&!t.lookahead.some(function(t){return Dn(t)||On(t)}))return!0;break;default:return!1}}},Wn={11:function(t,e,n){e[n].setState(t.tag,t.substitution)},12:function(t,e,n){e[n].setState(t.tag,t.substitution)},63:function(t,e,n){t.substitution.forEach(function(i,r){e[n+r].setState(t.tag,i)})},41:function(t,e,n){var i=e[n];i.setState(t.tag,t.substitution.ligGlyph);for(var r=t.substitution.components.length,s=0;s<r;s++)(i=e[n+s+1]).setState("deleted",!0)}};function Vn(t,e,n){t instanceof Nn&&Wn[t.id](t,e,n)}function jn(t,e){return new Ln(t.map(function(t){return t.activeState.value}),e||0)}var Xn={startCheck:function(t){var e=t.current,n=t.get(-1);return null===n&&Bn(e)||!Bn(n)&&Bn(e)},endCheck:function(t){var e=t.get(1);return null===e||!Bn(e)}};function Yn(t,e){return new Ln(t.map(function(t){return t.activeState.value}),e||0)}function Zn(t){this.baseDir=t||"ltr",this.tokenizer=new kn,this.featuresTags={}}function qn(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function Jn(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Kn(t){(t=t||{}).empty||(Re(t.familyName,"When creating a new Font object, familyName is required."),Re(t.styleName,"When creating a new Font object, styleName is required."),Re(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Re(t.ascender,"When creating a new Font object, ascender is required."),Re(t.descender,"When creating a new Font object, descender is required."),Re(t.descender<0,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables={os2:{usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR}}),this.supported=!0,this.glyphs=new bt.GlyphSet(this,t.glyphs||[]),this.encoding=new pt(this),this.position=new Me(this),this.substitution=new Te(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new ze(this):void 0}})}function Qn(t,e){var n=JSON.stringify(t),i=256;for(var r in e){var s=parseInt(r);if(s&&!(s<256)){if(JSON.stringify(e[r])===n)return s;i<=s&&(i=s+1)}}return e[i]=t,i}function $n(t,e,n){var i=Qn(e.name,n);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:i}]}function ti(t,e,n){var i={},r=new at.Parser(t,e);return i.tag=r.parseTag(),i.minValue=r.parseFixed(),i.defaultValue=r.parseFixed(),i.maxValue=r.parseFixed(),r.skip("uShort",1),i.name=n[r.parseUShort()]||{},i}function ei(t,e,n,i){for(var r=[{name:"nameID_"+t,type:"USHORT",value:Qn(e.name,i)},{name:"flags_"+t,type:"USHORT",value:0}],s=0;s<n.length;++s){var a=n[s].tag;r.push({name:"axis_"+t+" "+a,type:"FIXED",value:e.coordinates[a]<<16})}return r}function ni(t,e,n,i){var r={},s=new at.Parser(t,e);r.name=i[s.parseUShort()]||{},s.skip("uShort",1),r.coordinates={};for(var a=0;a<n.length;++a)r.coordinates[n[a].tag]=s.parseFixed();return r}Zn.prototype.setText=function(t){this.text=t},Zn.prototype.contextChecks={latinWordCheck:Xn,arabicWordCheck:Gn,arabicSentenceCheck:Hn},Zn.prototype.registerFeatures=function(t,e){var n=this,i=e.filter(function(e){return n.query.supports({script:t,tag:e})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(i):this.featuresTags[t]=i},Zn.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Fn(t));for(var n=0;n<e.length;n++){var i=e[n];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}},Zn.prototype.registerModifier=function(t,e,n){this.tokenizer.registerModifier(t,e,n)},Zn.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},Zn.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(function(){var t=this;this.featuresTags.hasOwnProperty("arab")&&(Jn.call(this),this.tokenizer.getContextRanges("arabicWord").forEach(function(e){(function(t){var e=this,n=this.featuresTags.arab,i=this.tokenizer.getRangeTokens(t);if(1!==i.length){var r=new Ln(i.map(function(t){return t.getState("glyphIndex")}),0),s=new Ln(i.map(function(t){return t.char}),0);i.forEach(function(t,a){if(!On(t.char)){r.setCurrentIndex(a),s.setCurrentIndex(a);var o,l=0;switch(function(t){for(var e=[].concat(t.backtrack),n=e.length-1;n>=0;n--){var i=e[n],r=In(i),s=On(i);if(!r&&!s)return!0;if(r)return!1}return!1}(s)&&(l|=1),function(t){if(In(t.current))return!1;for(var e=0;e<t.lookahead.length;e++)if(!On(t.lookahead[e]))return!0;return!1}(s)&&(l|=2),l){case 1:o="fina";break;case 2:o="init";break;case 3:o="medi"}if(-1!==n.indexOf(o)){var h=e.query.lookupFeature({tag:o,script:"arab",contextParams:r});if(h instanceof Error)return console.info(h.message);h.forEach(function(t,e){t instanceof Nn&&(Vn(t,i,e),r.context[e]=t.substitution)})}}})}}).call(t,e)}))}.call(this),function(){var t=this;this.featuresTags.hasOwnProperty("arab")&&-1!==this.featuresTags.arab.indexOf("rlig")&&(Jn.call(this),this.tokenizer.getContextRanges("arabicWord").forEach(function(e){(function(t){var e=this,n=this.tokenizer.getRangeTokens(t),i=jn(n);i.context.forEach(function(t,r){i.setCurrentIndex(r);var s=e.query.lookupFeature({tag:"rlig",script:"arab",contextParams:i});s.length&&(s.forEach(function(t){return Vn(t,n,r)}),i=jn(n))})}).call(t,e)}))}.call(this)),this.checkContextReady("latinWord")&&function(){var t=this;this.featuresTags.hasOwnProperty("latn")&&-1!==this.featuresTags.latn.indexOf("liga")&&(Jn.call(this),this.tokenizer.getContextRanges("latinWord").forEach(function(e){(function(t){var e=this,n=this.tokenizer.getRangeTokens(t),i=Yn(n);i.context.forEach(function(t,r){i.setCurrentIndex(r);var s=e.query.lookupFeature({tag:"liga",script:"latn",contextParams:i});s.length&&(s.forEach(function(t){return Vn(t,n,r)}),i=Yn(n))})}).call(t,e)}))}.call(this),this.checkContextReady("arabicSentence")&&function(){var t=this;this.tokenizer.getContextRanges("arabicSentence").forEach(function(e){var n=t.tokenizer.getRangeTokens(e);t.tokenizer.replaceRange(e.startIndex,e.endOffset,n.reverse())})}.call(this)},Zn.prototype.processText=function(t){this.text&&this.text===t||(this.setText(t),function(){return qn.call(this,"latinWord"),qn.call(this,"arabicWord"),qn.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}.call(this),this.applyFeaturesToContexts())},Zn.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},Zn.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],n=0;n<this.tokenizer.tokens.length;n++){var i=this.tokenizer.tokens[n];if(!i.state.deleted){var r=i.activeState.value;e.push(Array.isArray(r)?r[0]:r)}}return e},Kn.prototype.hasChar=function(t){return null!==this.encoding.charToGlyphIndex(t)},Kn.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},Kn.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n},Kn.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return"latn"===e.script?{script:"latn",tags:e.tags.filter(function(e){return t[e]})}:e})},Kn.prototype.stringToGlyphs=function(t,e){var n=this,i=new Zn;i.registerModifier("glyphIndex",null,function(t){return n.charToGlyphIndex(t.char)});var r=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;i.applyFeatures(this,r);for(var s=i.getTextGlyphs(t),a=s.length,o=new Array(a),l=this.glyphs.get(0),h=0;h<a;h+=1)o[h]=n.glyphs.get(s[h])||l;return o},Kn.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},Kn.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n},Kn.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},Kn.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,t,e):this.kerningPairs[t+","+e]||0},Kn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Kn.prototype.forEachGlyph=function(t,e,n,i,r,s){e=void 0!==e?e:0,n=void 0!==n?n:0,i=void 0!==i?i:72,r=Object.assign({},this.defaultRenderOptions,r);var a,o=1/this.unitsPerEm*i,l=this.stringToGlyphs(t,r);if(r.kerning){var h=r.script||this.position.getDefaultScriptName();a=this.position.getKerningTables(h,r.language)}for(var c=0;c<l.length;c+=1){var u=l[c];const t=u.advanceWidth;s.call(this,u,e,n,i,r),t&&(u.advanceWidth=t,e+=u.advanceWidth*o),r.kerning&&c<l.length-1&&(e+=(a?this.position.getKerningValue(a,u.index,l[c+1].index):this.getKerningValue(u,l[c+1]))*o),r.letterSpacing?e+=r.letterSpacing*i:r.tracking&&(e+=r.tracking/1e3*i)}return e},Kn.prototype.getPath=function(t,e,n,i,r){var s=new A;return this.forEachGlyph(t,e,n,i,r,function(t,e,n,i){var a=t.getPath(e,n,i,r,this);s.extend(a)}),s},Kn.prototype.getPaths=function(t,e,n,i,r){var s=[];return this.forEachGlyph(t,e,n,i,r,function(t,e,n,i){var a=t.getPath(e,n,i,r,this);s.push(a)}),s},Kn.prototype.getAdvanceWidth=function(t,e,n){return this.forEachGlyph(t,0,0,e,n,function(){})},Kn.prototype.draw=function(t,e,n,i,r,s){this.getPath(e,n,i,r,s).draw(t)},Kn.prototype.drawPoints=function(t,e,n,i,r,s){this.forEachGlyph(e,n,i,r,s,function(e,n,i,r){e.drawPoints(t,n,i,r)})},Kn.prototype.drawMetrics=function(t,e,n,i,r,s){this.forEachGlyph(e,n,i,r,s,function(e,n,i,r){e.drawMetrics(t,n,i,r)})},Kn.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},Kn.prototype.validate=function(){var t=this;function e(e){var n=t.getEnglishName(e);n&&n.trim().length}e("fontFamily"),e("weightName"),e("manufacturer"),e("copyright"),e("version"),this.unitsPerEm},Kn.prototype.toTables=function(){return ye(this)},Kn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Kn.prototype.toArrayBuffer=function(){for(var t=this.toTables().encode(),e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i<t.length;i++)n[i]=t[i];return e},Kn.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+n+".otf";var i=this.toArrayBuffer();if("undefined"!=typeof window)if(window.URL=window.URL||window.webkitURL,window.URL){var r=new DataView(i),s=new Blob([r],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),a.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),h=function(t){for(var e=new Buffer(t.byteLength),n=new Uint8Array(t),i=0;i<e.length;++i)e[i]=n[i];return e}(i);l.writeFileSync(t,h)}},Kn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Kn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Kn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var ii={make:function(t,e){var n=new Q.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*t.axes.length}]);n.offsetToData=n.sizeOf();for(var i=0;i<t.axes.length;i++)n.fields=n.fields.concat($n(i,t.axes[i],e));for(var r=0;r<t.instances.length;r++)n.fields=n.fields.concat(ei(r,t.instances[r],t.axes,e));return n},parse:function(t,e,n){var i=new at.Parser(t,e),r=i.parseULong();P.argument(65536===r,"Unsupported fvar table version.");var s=i.parseOffset16();i.skip("uShort",1);for(var a=i.parseUShort(),o=i.parseUShort(),l=i.parseUShort(),h=i.parseUShort(),c=[],u=0;u<a;u++)c.push(ti(t,e+s+u*o,n));for(var d=[],p=e+s+a*o,f=0;f<l;f++)d.push(ni(t,p+f*h,c,n));return{axes:c,instances:d}}},ri=new Array(10);ri[1]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{posFormat:1,coverage:this.parsePointer(rt.coverage),value:this.parseValueRecord()}:2===e?{posFormat:2,coverage:this.parsePointer(rt.coverage),values:this.parseValueRecordList()}:void P.assert(!1,"0x"+t.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},ri[2]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();P.assert(1===e||2===e,"0x"+t.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(rt.coverage),i=this.parseUShort(),r=this.parseUShort();if(1===e)return{posFormat:e,coverage:n,valueFormat1:i,valueFormat2:r,pairSets:this.parseList(rt.pointer(rt.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(r)}})))};if(2===e){var s=this.parsePointer(rt.classDef),a=this.parsePointer(rt.classDef),o=this.parseUShort(),l=this.parseUShort();return{posFormat:e,coverage:n,valueFormat1:i,valueFormat2:r,classDef1:s,classDef2:a,class1Count:o,class2Count:l,classRecords:this.parseList(o,rt.list(l,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(r)}}))}}},ri[3]=function(){return{error:"GPOS Lookup 3 not supported"}},ri[4]=function(){return{error:"GPOS Lookup 4 not supported"}},ri[5]=function(){return{error:"GPOS Lookup 5 not supported"}},ri[6]=function(){return{error:"GPOS Lookup 6 not supported"}},ri[7]=function(){return{error:"GPOS Lookup 7 not supported"}},ri[8]=function(){return{error:"GPOS Lookup 8 not supported"}},ri[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var si=new Array(10),ai={parse:function(t,e){var n=new rt(t,e=e||0),i=n.parseVersion(1);return P.argument(1===i||1.1===i,"Unsupported GPOS table version "+i),1===i?{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(ri)}:{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(ri),variations:n.parseFeatureVariationsList()}},make:function(t){return new Q.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Q.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Q.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Q.LookupList(t.lookups,si)}])}},oi={parse:function(t,e){var n=new at.Parser(t,e),i=n.parseUShort();if(0===i)return function(t){var e={};t.skip("uShort");var n=t.parseUShort();P.argument(0===n,"Unsupported kern sub-table version."),t.skip("uShort",2);var i=t.parseUShort();t.skip("uShort",3);for(var r=0;r<i;r+=1){var s=t.parseUShort(),a=t.parseUShort(),o=t.parseShort();e[s+","+a]=o}return e}(n);if(1===i)return function(t){var e={};t.skip("uShort"),t.parseULong()>1&&console.warn("Only the first kern subtable is supported."),t.skip("uLong");var n=255&t.parseUShort();if(t.skip("uShort"),0===n){var i=t.parseUShort();t.skip("uShort",3);for(var r=0;r<i;r+=1){var s=t.parseUShort(),a=t.parseUShort(),o=t.parseShort();e[s+","+a]=o}}return e}(n);throw new Error("Unsupported kern table version ("+i+").")}},li={parse:function(t,e,n,i){for(var r=new at.Parser(t,e),s=i?r.parseUShort:r.parseULong,a=[],o=0;o<n+1;o+=1){var l=s.call(r);i&&(l*=2),a.push(l)}return a}};function hi(t,e){require("fs").readFile(t,function(t,n){if(t)return e(t.message);e(null,Ae(n))})}function ci(t,e){var n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",n.onload=function(){return n.response?e(null,n.response):e("Font could not be loaded: "+n.statusText)},n.onerror=function(){e("Font could not be loaded")},n.send()}function ui(t,e){for(var n=[],i=12,r=0;r<e;r+=1){var s=at.getTag(t,i),a=at.getULong(t,i+4),o=at.getULong(t,i+8),l=at.getULong(t,i+12);n.push({tag:s,checksum:a,offset:o,length:l,compression:!1}),i+=16}return n}function di(t,e){if("WOFF"===e.compression){var n=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),i=new Uint8Array(e.length);if(T(n,i),i.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");return{data:new DataView(i.buffer,0),offset:0}}return{data:t,offset:e.offset}}function pi(t,e){var n,i;e=null==e?{}:e;var r,s,a,o,l,h,c,u,d,p,f,g,m=new Kn({empty:!0}),v=new DataView(t,0),_=[],y=at.getTag(v,0);if(y===String.fromCharCode(0,1,0,0)||"true"===y||"typ1"===y)m.outlinesFormat="truetype",_=ui(v,r=at.getUShort(v,4));else if("OTTO"===y)m.outlinesFormat="cff",_=ui(v,r=at.getUShort(v,4));else{if("wOFF"!==y)throw new Error("Unsupported OpenType signature "+y);var x=at.getTag(v,4);if(x===String.fromCharCode(0,1,0,0))m.outlinesFormat="truetype";else{if("OTTO"!==x)throw new Error("Unsupported OpenType flavor "+y);m.outlinesFormat="cff"}_=function(t,e){for(var n=[],i=44,r=0;r<e;r+=1){var s,a=at.getTag(t,i),o=at.getULong(t,i+4),l=at.getULong(t,i+8),h=at.getULong(t,i+12);s=l<h&&"WOFF",n.push({tag:a,offset:o,compression:s,compressedLength:l,length:h}),i+=20}return n}(v,r=at.getUShort(v,12))}for(var b=0;b<r;b+=1){var w=_[b],S=void 0;switch(w.tag){case"cmap":S=di(v,w),m.tables.cmap=lt.parse(S.data,S.offset),m.encoding=new ft(m.tables.cmap);break;case"cvt ":S=di(v,w),g=new at.Parser(S.data,S.offset),m.tables.cvt=g.parseShortList(w.length/2);break;case"fvar":a=w;break;case"fpgm":S=di(v,w),g=new at.Parser(S.data,S.offset),m.tables.fpgm=g.parseByteList(w.length);break;case"head":S=di(v,w),m.tables.head=Gt.parse(S.data,S.offset),m.unitsPerEm=m.tables.head.unitsPerEm,n=m.tables.head.indexToLocFormat;break;case"hhea":S=di(v,w),m.tables.hhea=Ht.parse(S.data,S.offset),m.ascender=m.tables.hhea.ascender,m.descender=m.tables.hhea.descender,m.numberOfHMetrics=m.tables.hhea.numberOfHMetrics;break;case"hmtx":c=w;break;case"ltag":S=di(v,w),i=Vt.parse(S.data,S.offset);break;case"maxp":S=di(v,w),m.tables.maxp=jt.parse(S.data,S.offset),m.numGlyphs=m.tables.maxp.numGlyphs;break;case"name":p=w;break;case"OS/2":S=di(v,w),m.tables.os2=ae.parse(S.data,S.offset);break;case"post":S=di(v,w),m.tables.post=oe.parse(S.data,S.offset),m.glyphNames=new mt(m.tables.post);break;case"prep":S=di(v,w),g=new at.Parser(S.data,S.offset),m.tables.prep=g.parseByteList(w.length);break;case"glyf":o=w;break;case"loca":d=w;break;case"CFF ":s=w;break;case"kern":u=w;break;case"GPOS":l=w;break;case"GSUB":h=w;break;case"meta":f=w}}var M=di(v,p);if(m.tables.name=re.parse(M.data,M.offset,i),m.names=m.tables.name,o&&d){var T=0===n,E=di(v,d),C=li.parse(E.data,E.offset,m.numGlyphs,T),A=di(v,o);m.glyphs=Ue.parse(A.data,A.offset,C,m,e)}else{if(!s)throw new Error("Font doesn't contain TrueType or CFF outlines.");var R=di(v,s);zt.parse(R.data,R.offset,m,e)}var L=di(v,c);if(Wt.parse(m,L.data,L.offset,m.numberOfHMetrics,m.numGlyphs,m.glyphs,e),function(t,e){e.lowMemory?function(t){t._IndexToUnicodeMap={};for(var e=t.tables.cmap.glyphIndexMap,n=Object.keys(e),i=0;i<n.length;i+=1){var r=n[i],s=e[r];void 0===t._IndexToUnicodeMap[s]?t._IndexToUnicodeMap[s]={unicodes:[parseInt(r)]}:t._IndexToUnicodeMap[s].unicodes.push(parseInt(r))}}(t):function(t){for(var e,n=t.tables.cmap.glyphIndexMap,i=Object.keys(n),r=0;r<i.length;r+=1){var s=i[r],a=n[s];(e=t.glyphs.get(a)).addUnicode(parseInt(s))}for(var o=0;o<t.glyphs.length;o+=1)e=t.glyphs.get(o),t.cffEncoding?t.isCIDFont?e.name="gid"+o:e.name=t.cffEncoding.charset[o]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(o))}(t)}(m,e),u){var P=di(v,u);m.kerningPairs=oi.parse(P.data,P.offset)}else m.kerningPairs={};if(l){var k=di(v,l);m.tables.gpos=ai.parse(k.data,k.offset),m.position.init()}if(h){var D=di(v,h);m.tables.gsub=ue.parse(D.data,D.offset)}if(a){var I=di(v,a);m.tables.fvar=ii.parse(I.data,I.offset,m.names)}if(f){var O=di(v,f);m.tables.meta=de.parse(O.data,O.offset),m.metas=m.tables.meta}return m}t.BoundingBox=C,t.Font=Kn,t.Glyph=_t,t.Path=A,t._parse=at,t.load=function(t,e,n){var i="undefined"==typeof window?hi:ci;return new Promise(function(r){i(t,function(t,i){if(t)return e(t);var s;try{s=pi(i,n)}catch(t){return e(t,null)}if(e)return e(null,s);r(s)})})},t.loadSync=function(t,e){return pi(Ae(require("fs").readFileSync(t)),e)},t.parse=pi,Object.defineProperty(t,"__esModule",{value:!0})}),function(t){!function(t){var e=function(){function t(){this._topNode=void 0,this._count=0,this._changedEventListeners=[],this._enableChangedEvent=!0}return t.prototype.count=function(){return this._count},t.prototype.isEmpty=function(){return void 0===this._topNode},t.prototype.push=function(t){var e=new n(t,this._topNode);this._topNode=e,this._count++,this.fireChangedEventListener()},t.prototype.pop=function(){if(0!=this._count){var t=this._topNode;return this._topNode=t.previous,this._count--,this.fireChangedEventListener(),t.data}},t.prototype.peek=function(){return this._topNode.data},t.prototype.clear=function(){this._topNode&&this._count>0&&(this._topNode=void 0,this._count=0,this.fireChangedEventListener())},t.prototype.addChangedEventListener=function(t){this._changedEventListeners.push(t)},t.prototype.removeChangedEventListener=function(t){for(var e=0;e<this._changedEventListeners.length;e++)this._changedEventListeners[e]==t&&this._changedEventListeners.splice(e--,1)},t.prototype.fireChangedEventListener=function(){if(this._enableChangedEvent)for(var t=0;t<this._changedEventListeners.length;t++)(0,this._changedEventListeners[t])()},t.prototype.getAllData=function(){for(var t=new Array(this._count),e=this._count-1,n=this._topNode;n;)t[e]=n.data,n=n.previous,e--;return t},t.prototype.getLastData=function(t){for(var e=this._topNode;e;){if(!t||t(e.data))return e.data;e=e.previous}return null},t.prototype.getAllDataAfter=function(t){for(var e=[],n=this._topNode;n&&n.data!=t;)e.push(n.data),n=n.previous;return e.reverse()},t.prototype.removeDataArray=function(t){var e=this;this._enableChangedEvent=!1,t.forEach(function(t){e.removeData(t)}),this._enableChangedEvent=!0,this.fireChangedEventListener()},t.prototype.removeData=function(t){var e=this.getNodeHavingData(t);e&&(this.removeNode(e),this.fireChangedEventListener())},t.prototype.getNodeHavingData=function(t){for(var e=this._topNode;e;){if(e.data==t)return e;e=e.previous}return null},t.prototype.removeNode=function(t){if(t)if(this._topNode==t)this._topNode=t.previous,this._count--;else{var e=this.getFollowingNode(t);e&&(e.previous=t.previous,this._count--)}},t.prototype.getFollowingNode=function(t){for(var e=this._topNode;e;){if(e.previous==t)return e;e=e.previous}},t}();t.Stack=e;var n=function(t,e){this.previous=e,this.data=t}}(t.Customizer||(t.Customizer={}))}(Zakeke||(Zakeke={}));var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},s=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=s.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;r<t;r++)e[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<t;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;i<e;i+=4)n.push(4294967296*t.random()|0);return new a.init(n,e)}}),o=n.enc={},l=o.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++){var r=e[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new a.init(n,e/2)}},h=o.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++)n.push(String.fromCharCode(e[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new a.init(n,e)}},c=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(h.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return h.parse(unescape(encodeURIComponent(t)))}},u=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,o=r/(4*s);if(e=(o=e?t.ceil(o):t.max((0|o)-this._minBufferSize,0))*s,r=t.min(4*e,r),e){for(var l=0;l<e;l+=s)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=r}return new a.init(l,r)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=u.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}});var d=n.algo={};return n}(Math);!function(){var t=CryptoJS,e=(r=t.lib).WordArray,n=r.Hasher,i=[],r=t.algo.SHA1=n.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],s=n[1],a=n[2],o=n[3],l=n[4],h=0;80>h;h++){if(16>h)i[h]=0|t[e+h];else{var c=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=c<<1|c>>>31}c=(r<<5|r>>>27)+l+i[h],c=20>h?c+(1518500249+(s&a|~s&o)):40>h?c+(1859775393+(s^a^o)):60>h?c+((s&a|s&o|a&o)-1894007588):c+((s^a^o)-899497514),l=o,o=a,a=s<<30|s>>>2,s=r,r=c}n[0]=n[0]+r|0,n[1]=n[1]+s|0,n[2]=n[2]+a|0,n[3]=n[3]+o|0,n[4]=n[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(i+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=n._createHelper(r),t.HmacSHA1=n._createHmacHelper(r)}(),(Zakeke=Zakeke||{}).generateUUID=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:7&n|8).toString(16)})},Zakeke.getEmptyUUID=function(){return"00000000-0000-0000-0000-000000000000"},Zakeke.makeID=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<t;i++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},Zakeke.ShaderInputType={Float:1,Int:2,Texture:3,Array2:4,Array3:5,Color3:6,Color4:7,Matrix:8,Matrix2x2:9,Matrix3x3:10,Vector2:11,Vector3:12,Vector4:13},Zakeke.TryOnType={Glasses:1,Shoes:2},Zakeke.ShaderOptionType={Attribute:1,Uniform:2,Sampler:3},Zakeke.TextureCompressionFormat={None:"None",WebP:"Webp"},Zakeke.TextureCompressionType={Lossless:"Lossless",Lossy:"Lossy"},Zakeke.IncrementalFileInfo=function(){this.name="",this.data=null,this.isScene=!1,this.dracoEncoded=!1},Zakeke.TextureUsage={Any:0,Desktop:1,Mobile:2},Zakeke.SceneCameraConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGroundConfig=Backbone.AssociatedModel.extend({defaults:{createGround:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSkyboxConfig=Backbone.AssociatedModel.extend({defaults:{createSkybox:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneShadowsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneEnvironmentConfig=Backbone.AssociatedModel.extend({defaults:{skybox:null,ground:null,shadows:null},initialize:function(){this.get("skybox")&&(this.get("skybox").parentModel=this),this.get("ground")&&(this.get("ground").parentModel=this),this.get("shadows")&&(this.get("shadows").parentModel=this)},relations:[{type:Backbone.One,key:"skybox",relatedModel:Zakeke.SceneSkyboxConfig},{type:Backbone.One,key:"ground",relatedModel:Zakeke.SceneGroundConfig},{type:Backbone.One,key:"shadows",relatedModel:Zakeke.SceneShadowsConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.EnvironmentOptionsConfig=Backbone.AssociatedModel.extend({defaults:{mipMaps:null,generateHarmonics:null,gammaSpace:null,prefilterOnLoad:null,rotationY:null,intensity:null},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGeneralConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){this.get("environmentOptions")&&(this.get("environmentOptions").parentModel=this)},relations:[{type:Backbone.One,key:"environmentOptions",relatedModel:Zakeke.EnvironmentOptionsConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGlowConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneInfoPointsStyleConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneInfoPointsConfig=Backbone.AssociatedModel.extend({defaults:{pointsStyle:null},initialize:function(){this.get("pointsStyle")&&(this.get("pointsStyle").parentModel=this)},relations:[{type:Backbone.One,key:"pointsStyle",relatedModel:Zakeke.SceneInfoPointsStyleConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneLightsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneShadowsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneModelConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.WebPOptions=Backbone.AssociatedModel.extend({defaults:{type:Zakeke.TextureCompressionType.Lossy,quality:80},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneTexturesConfig=Backbone.AssociatedModel.extend({defaults:{format:Zakeke.TextureCompressionFormat.None,webpOptions:null},initialize:function(){this.get("webpOptions")&&(this.get("webpOptions").parentModel=this)},relations:[{type:Backbone.One,key:"webpOptions",relatedModel:Zakeke.WebPOptions}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.AnimationsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneUiConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneConfig=Backbone.AssociatedModel.extend({defaults:{general:null,environment:null,camera:null,model:null,glow:null,infoPoints:null,uiConfig:null,lights:null,textures:null,animations:null},initialize:function(){const t=this;this.get("general")&&(this.get("general").parentModel=this),this.get("environment")&&(this.get("environment").parentModel=this),this.get("camera")&&(this.get("camera").parentModel=this),this.get("glow")&&(this.get("glow").parentModel=this),this.get("infoPoints")&&(this.get("infoPoints").parentModel=this),this.get("uiConfig")&&(this.get("uiConfig").parentModel=this),this.get("lights")&&(this.get("lights").parentModel=this),this.get("model")&&(this.get("model").parentModel=this),this.get("textures")&&(this.get("textures").parentModel=this),this.get("animations")&&(this.get("animations").parentModel=this),this.get("general")&&this.get("general").on("change",function(){t.trigger("change")}),this.get("environment")&&this.get("environment").on("change",function(){t.trigger("change")}),this.get("camera")&&this.get("camera").on("change",function(){t.trigger("change")}),this.get("glow")&&this.get("glow").on("change",function(){t.trigger("change")}),this.get("infoPoints")&&this.get("infoPoints").on("change",function(){t.trigger("change")}),this.get("uiConfig")&&this.get("uiConfig").on("change",function(){t.trigger("change")}),this.get("lights")&&this.get("lights").on("change",function(){t.trigger("change")}),this.get("model")&&this.get("model").on("change",function(){t.trigger("change")}),this.get("textures")&&this.get("textures").on("change",function(){t.trigger("change")}),this.get("animations")&&this.get("animations").on("change",function(){t.trigger("change")})},relations:[{type:Backbone.One,key:"general",relatedModel:Zakeke.SceneGeneralConfig},{type:Backbone.One,key:"environment",relatedModel:Zakeke.SceneEnvironmentConfig},{type:Backbone.One,key:"camera",relatedModel:Zakeke.SceneCameraConfig},{type:Backbone.One,key:"glow",relatedModel:Zakeke.SceneGlowConfig},{type:Backbone.One,key:"infoPoints",relatedModel:Zakeke.SceneInfoPointsConfig},{type:Backbone.One,key:"uiConfig",relatedModel:Zakeke.SceneUiConfig},{type:Backbone.One,key:"lights",relatedModel:Zakeke.SceneLightsConfig},{type:Backbone.One,key:"model",relatedModel:Zakeke.SceneModelConfig},{type:Backbone.One,key:"textures",relatedModel:Zakeke.SceneTexturesConfig},{type:Backbone.One,key:"animations",relatedModel:Zakeke.AnimationsConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSourceTaskOptions=Backbone.AssociatedModel.extend({defaults:{textures:null},initialize:function(){this.get("textures")&&(this.get("textures").parentModel=this)},relations:[{type:Backbone.One,key:"textures",relatedModel:Zakeke.SceneTexturesConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSourceTexture=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,url:""},idAttribute:"textureID",initialize:function(){},relations:[],getTextureID:function(){return this.get("textureID")},getSourceID:function(){return this.collection&&this.collection.getSourceID?this.collection.getSourceID():null},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneSourceTextures=Backbone.Collection.extend({model:Zakeke.SceneSourceTexture,getSourceID:function(){return this.parentModel&&this.parentModel.getSourceID?this.parentModel.getSourceID():null},getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findTexture:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("textureID")==t)return n}return null}}),Zakeke.SceneSource=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,url:"",rootUrl:"",sceneFileName:"",textures:[]},idAttribute:"sourceID",initialize:function(){this.get("textures").parentModel=this},relations:[{type:Backbone.Many,key:"textures",collectionType:Zakeke.SceneSourceTextures}],getSourceID:function(){return this.get("sourceID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneSources=Backbone.Collection.extend({model:Zakeke.SceneSource,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findSource:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("sourceID")==t)return n}return null}}),Zakeke.SceneShaderMaterial=Backbone.AssociatedModel.extend({defaults:{materialID:"",name:"",vertex:"",fragment:""},idAttribute:"materialID",initialize:function(){},relations:[],getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneShaderMaterials=Backbone.Collection.extend({model:Zakeke.SceneShaderMaterial,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findShaderMaterial:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("materialID")==t)return n}return null}}),Zakeke.SceneTexture=Backbone.AssociatedModel.extend({defaults:{materialID:"",isDefaultEnvironment:!1,fileObjectID:-1,fileLength:-1,url:"",usage:Zakeke.TextureUsage.Any},idAttribute:"textureID",initialize:function(){},relations:[],getTextureID:function(){return this.get("textureID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneTextures=Backbone.Collection.extend({model:Zakeke.SceneTexture,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findTexture:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("textureID")==t)return n}return null}}),Zakeke.SceneMaterialPhoto=Backbone.AssociatedModel.extend({defaults:{materialID:"",displayOrder:0,fileObjectID:-1,fileLength:-1,url:""},idAttribute:"photoID",initialize:function(){},relations:[],getMaterialPhotoID:function(){return this.get("photoID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMaterialPhotos=Backbone.Collection.extend({model:Zakeke.SceneMaterialPhoto,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findMaterialPhoto:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("photoID")===t)return n}return null},getMaterialPhotoUrls:function(t){for(var e=[],n=0;n<this.length;n++)this.at(n).get("materialID")===t&&e.push(this.at(n).get("url"));return e}}),Zakeke.SceneCameraLocation=Backbone.AssociatedModel.extend({defaults:{name:"",px:0,py:0,pz:0,tx:0,ty:0,tz:0},idAttribute:"locationID",initialize:function(){this.get("locationID")||this.set("locationID",Zakeke.generateUUID())},relations:[],getLocationID:function(){return this.get("locationID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneCameraLocations=Backbone.Collection.extend({model:Zakeke.SceneCameraLocation,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findCameraLocation:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("locationID")==t)return n}return null}}),Zakeke.SceneMeshLocation=Backbone.AssociatedModel.extend({defaults:{name:"",tempImageFileKey:"",imageUrl:"",displayOrder:0,isCollapsed:!1,isExploded:!1,adjustCamera:!0,data:[]},idAttribute:"locationID",initialize:function(){this.get("locationID")||this.set("locationID",Zakeke.generateUUID())},relations:[],getLocationID:function(){return this.get("locationID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMeshLocations=Backbone.Collection.extend({model:Zakeke.SceneMeshLocation,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findMeshLocation:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("locationID")==t)return n}return null},getFirstExplodedMeshLocation:function(){for(var t=0;t<this.length;t++){var e=this.at(t);if(e.get("isExploded"))return e}return null},getFirstCollapsedMeshLocation:function(){for(var t=0;t<this.length;t++){var e=this.at(t);if(e.get("isCollapsed"))return e}return null},getOrCreateExplodedMeshLocation:function(){var t=this.getFirstExplodedMeshLocation();return t||((t=new Zakeke.SceneMeshLocation).set("name","exploded"),t.set("isExploded",!0),this.push(t)),t},getOrCreateCollapsedMeshLocation:function(){var t=this.getFirstCollapsedMeshLocation();return t||((t=new Zakeke.SceneMeshLocation).set("name","collapsed"),t.set("isCollapsed",!0),this.push(t)),t}}),Zakeke.SceneMaterialMapping=Backbone.AssociatedModel.extend({defaults:{libraryMaterialID:"",sceneMaterialID:""},initialize:function(){},relations:[],getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMaterialMappings=Backbone.Collection.extend({model:Zakeke.SceneMaterialMapping,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},getMappingForSceneMaterial:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("sceneMaterialID")==t)return n}},getMappingsForLibraryMaterial:function(t){for(var e=[],n=0;n<this.length;n++){var i=this.at(n);i.get("libraryMaterialID")==t&&e.push(i)}return e},getLibraryMaterialIDs:function(){for(var t=[],e={},n=0;n<this.length;n++)e[this.at(n).get("libraryMaterialID")]=!0;for(var i in e)t.push(i);return t}}),Zakeke.SceneARFile=Backbone.AssociatedModel.extend({defaults:{fileType:"",url:""},idAttribute:"fileID",initialize:function(){this.get("fileID")||this.set("fileID",Zakeke.generateUUID())},getFileID:function(){return this.get("fileID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneARFiles=Backbone.Collection.extend({model:Zakeke.SceneARFile,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findFile:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("fileID")===t)return n}return null}}),Zakeke.Scene=Backbone.AssociatedModel.extend({defaults:{name:"",fileObjectID:-1,fileLength:-1,url:"",rootUrl:"",sceneFileName:"",manifestFileObjectID:-1,manifestFileLength:-1,manifestFileUrl:"",sellerID:-1,imageData:null,imageUrl:"",useDefaultEnvironmentTexture:!1,cameraLimitLowerRadius:!0,version:0,config:null,usedTextureUrls:null,sources:[],cameraLocations:[],materialMappings:[],textures:[],materialPhotos:[],shaderMaterials:[],meshLocations:[],arFiles:[]},idAttribute:"sceneID",_eventListeners:{change:[]},_fireEvent:function(t,e){if(this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&_.isArray(this._eventListeners[t]))for(var n=this._eventListeners[t],i=0;i<n.length;++i)n[i](e)},trigger:function(t){this._fireEvent(t)},addEventListener:function(t,e){this._eventListeners&&_.isObject(this._eventListeners)&&(_.has(this._eventListeners,t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},removeEventListener:function(t){this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&delete this._eventListeners[t]},getSceneID:function(){return null!=this.id&&null!=this.id?this.id:this.get("tempSceneID")},initialize:function(){this.get("tempSceneID")||this.set("tempSceneID",Zakeke.generateUUID());var t=this;this.get("config")&&(this.get("config").parentModel=this),this.get("sources").parentModel=this,this.get("sources").url=function(){return t.url()+"/"+t.getSceneID()+"/sources"},this.get("cameraLocations").parentModel=this,this.get("cameraLocations").url=function(){return t.url()+"/"+t.getSceneID()+"/cameraLocations"},this.get("meshLocations").parentModel=this,this.get("meshLocations").url=function(){return t.url()+"/"+t.getSceneID()+"/meshLocations"},this.get("materialMappings").parentModel=this,this.get("textures").parentModel=this,this.get("materialPhotos").parentModel=this,this.get("shaderMaterials").parentModel=this,this.get("arFiles").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("config")&&this.get("config").on("change",function(){t._fireEvent("change")})},relations:[{type:Backbone.One,key:"config",relatedModel:Zakeke.SceneConfig},{type:Backbone.Many,key:"sources",collectionType:Zakeke.SceneSources},{type:Backbone.Many,key:"cameraLocations",collectionType:Zakeke.SceneCameraLocations},{type:Backbone.Many,key:"meshLocations",collectionType:Zakeke.SceneMeshLocations},{type:Backbone.Many,key:"materialMappings",collectionType:Zakeke.SceneMaterialMappings},{type:Backbone.Many,key:"textures",collectionType:Zakeke.SceneTextures},{type:Backbone.Many,key:"materialPhotos",collectionType:Zakeke.SceneMaterialPhotos},{type:Backbone.Many,key:"shaderMaterials",collectionType:Zakeke.SceneShaderMaterials},{type:Backbone.Many,key:"arFiles",collectionType:Zakeke.SceneARFiles}],url:function(){var t=this.getSceneBaseUrl()+"scenes";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},getSceneBaseUrl:function(){return Zakeke.config.baseScenesApiUrl||Zakeke.config.baseApiUrl},getSceneFileUploadUrl:function(){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/scenefile"},getSceneRootUrlApiUrl:function(){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/rooturl"},getSceneIncrementalFileUploadUrl:function(){return this.getSceneFileUploadUrl()+"?incremental=true"},getSourceUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/sources/"+t},getSourceTasksUrl:function(){return Zakeke.config.baseImagesUploadApiUrl+"scenes/"+this.getSceneID()+"/sourcetasks"},getSourceTaskResultUrl:function(t){return Zakeke.config.baseImagesUploadApiUrl+"scenes/"+this.getSceneID()+"/sourcetaskresult/"+t},getSourceTasksUrl:function(){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/sourcetasks"},getSourceTaskResultUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/sourcetaskresult/"+t},getTexturesUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/textures/"+t},getMaterialPhotosUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/materialphotos/"+t},getSourcesIDs:function(){for(var t=[],e=0;e<this.get("sources").length;e++){var n=this.get("sources").at(e);t.push(n.getSourceID())}return t},getMappingForSceneMaterial:function(t){return this.get("materialMappings").getMappingForSceneMaterial(t)},getMappingsForLibraryMaterial:function(t){return this.get("materialMappings").getMappingsForLibraryMaterial(t)},getLibraryMaterialIDs:function(){return this.get("materialMappings").getLibraryMaterialIDs()},mapLibraryMaterial:function(t,e){var n=new Zakeke.SceneMaterialMapping;n.set("libraryMaterialID",t),n.set("sceneMaterialID",e),this.get("materialMappings").push(n)},removeMappingForSceneMaterial:function(t){var e=this.get("materialMappings").getMappingForSceneMaterial(t);e&&this.get("materialMappings").remove(e)},registerShaderMaterial:function(t,e,n,i){var r=this.get("shaderMaterials").findWhere({materialID:t});r||((r=new Zakeke.SceneShaderMaterial).set("materialID",t),r.set("name",e),r.set("vertex",n),r.set("fragment",i),this.get("shaderMaterials").push(r))},getLibraryShaderMaterialIDForSceneMaterial:function(t){var e=this.getMappingForSceneMaterial(t);if(e)for(var n=e.get("libraryMaterialID"),i=0;i<this.get("shaderMaterials").length;i++)if(this.get("shaderMaterials").at(i).get("materialID")===n)return n;return null},unregisterShaderMaterial:function(t){var e=this.get("shaderMaterials").findWhere({materialID:t});e&&this.get("shaderMaterials").remove(e)},getCameraLocation:function(t){return this.get("cameraLocations").findCameraLocation(t)},getMeshLocation:function(t){return this.get("meshLocations").findMeshLocation(t)},getSceneConfig:function(){return this.get("config")},getOrCreateSceneConfig:function(){const t=this;let e=this.getSceneConfig();return e||((e=new Zakeke.SceneConfig).on("change",function(){t._fireEvent("change")}),this.set("config",e)),e},getGeneralConfig:function(){var t=this.getSceneConfig();return t&&t.get("general")&&t.get("general")instanceof Zakeke.SceneGeneralConfig?t.get("general"):null},getOrCreateGeneralConfig:function(){const t=this.getOrCreateSceneConfig();let e=t.get("general");return e||((e=new Zakeke.SceneGeneralConfig).on("change",function(){t.trigger("change")}),t.set("general",e)),e},getModelConfig:function(){var t=this.getSceneConfig();return t&&t.get("model")&&t.get("model")instanceof Zakeke.SceneModelConfig?t.get("model"):null},getOrCreateModelConfig:function(){const t=this.getOrCreateSceneConfig();let e=t.get("model");return e||((e=new Zakeke.SceneModelConfig).on("change",function(){t.trigger("change")}),t.set("model",e)),e},getMatchSameNameTextures:function(){var t=this.getGeneralConfig();if(t)return t.get("matchSameNameTextures")},setMatchSameNameTextures:function(t){this.getOrCreateGeneralConfig().set("matchSameNameTextures",t)},getAntialiasEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("antialiasEnabled")},setAntialiasEnabled:function(t){this.getOrCreateGeneralConfig().set("antialiasEnabled",t)},getTryOnEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnEnabled")},setTryOnEnabled:function(t){this.getOrCreateGeneralConfig().set("tryOnEnabled",t)},getTryOnSettings:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnSettings")},setTryOnSettings:function(t){this.getOrCreateGeneralConfig().set("tryOnSettings",t)},getFrameDAMSettings:function(){var t=this.getGeneralConfig();if(t)return t.get("frameDAMSettings")},setFrameDAMSettings:function(t){this.getOrCreateGeneralConfig().set("frameDAMSettings",t)},getAREnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("arEnabled")},setAREnabled:function(t){this.getOrCreateGeneralConfig().set("arEnabled",t)},getAROnTheFly:function(){return this.getOrCreateGeneralConfig().get("arOnTheFly")},setAROnTheFly:function(t){this.getOrCreateGeneralConfig().set("arOnTheFly",t)},getARAnchor:function(){return this.getOrCreateGeneralConfig().get("arAnchor")},setARAnchor:function(t){this.getOrCreateGeneralConfig().set("arAnchor",t)},getTryOnEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnEnabled")},setTryOnEnabled:function(t){this.getOrCreateGeneralConfig().set("tryOnEnabled",t)},getARScale:function(){var t=this.getGeneralConfig();if(t){var e=t.get("arScale");return null==e?null:e}return null},setARScale:function(t){this.getOrCreateGeneralConfig().set("arScale",t)},getARMeshSize:function(){var t=this.getGeneralConfig();if(t){var e=t.get("meshSize");return null==e?null:e}return null},setARMeshSize:function(t){this.getOrCreateGeneralConfig().set("meshSize",t)},setForceDracoCompression:function(t){this.getOrCreateGeneralConfig().set("forceDracoCompression",t)},getForceDracoCompression:function(){var t=this.getGeneralConfig();if(t)return t.get("forceDracoCompression")},setFitToScreenMargin:function(t){this.getOrCreateGeneralConfig().set("fitToScreenMargin",t)},getFitToScreenMargin:function(){var t=this.getGeneralConfig();return t?t.get("fitToScreenMargin"):1},getUseDelayedTextureLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedTextureLoading")},getDefaultDesignMaterialTransparencyMode:function(){var t=this.getGeneralConfig();return t?t.get("defaultDesignMaterialTransparencyMode"):2},setDefaultDesignMaterialTransparencyMode:function(t){this.getOrCreateGeneralConfig().set("defaultDesignMaterialTransparencyMode",t)},getUseDelayedTextureLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedTextureLoading")},setUseDelayedTextureLoading:function(t){this.getOrCreateGeneralConfig().set("useDelayedTextureLoading",t)},getUseDelayedMaterialLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedMaterialLoading")},setUseDelayedMaterialLoading:function(t){this.getOrCreateGeneralConfig().set("useDelayedMaterialLoading",t)},getUseMaterialOffloading:function(){var t=this.getGeneralConfig();if(t)return t.get("useMaterialOffloading")},setUseMaterialOffloading:function(t){this.getOrCreateGeneralConfig().set("useMaterialOffloading",t)},getPrefetchMeshes:function(){var t=this.getGeneralConfig();if(t)return t.get("prefetchMeshes")},setPrefetchMeshes:function(t){this.getOrCreateGeneralConfig().set("prefetchMeshes",t)},getPrefetchMaterials:function(){var t=this.getGeneralConfig();if(t)return t.get("prefetchMaterials")},setPrefetchMaterials:function(t){this.getOrCreateGeneralConfig().set("prefetchMaterials",t)},getEnvironmentConfig:function(){var t=this.getSceneConfig();return t&&t.get("environment")&&t.get("environment")instanceof Zakeke.SceneEnvironmentConfig?t.get("environment"):null},getOrCreateEnvironmentConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("environment");return e||(e=new Zakeke.SceneEnvironmentConfig,t.set("environment",e)),e},getSkyboxConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("skybox")&&t.get("skybox")instanceof Zakeke.SceneSkyboxConfig?t.get("skybox"):null},getOrCreateSkyboxConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("skybox");return e||(e=new Zakeke.SceneSkyboxConfig,t.set("skybox",e)),e},getGroundConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("ground")&&t.get("ground")instanceof Zakeke.SceneGroundConfig?t.get("ground"):null},getOrCreateGroundConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("ground");return e||(e=new Zakeke.SceneGroundConfig,t.set("ground",e)),e},getShadowsConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("shadows")?t.get("shadows"):null},getOrCreateShadowsConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("shadows");return e||(e=new Zakeke.SceneShadowsConfig,t.set("shadows",e)),e},getCameraConfig:function(){var t=this.getSceneConfig();return t&&t.get("camera")&&t.get("camera")instanceof Zakeke.SceneCameraConfig?t.get("camera"):null},getOrCreateCameraConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("camera");return e||(e=new Zakeke.SceneCameraConfig,t.set("camera",e)),e},getAnimationsConfig:function(){const t=this.getSceneConfig();return t&&t.get("animations")?t.get("animations"):null},getCameraPositionScale:function(){var t=this.getCameraConfig();if(t)return t.get("positionScale")},setCameraPositionScale:function(t){this.getOrCreateCameraConfig().set("positionScale",t)},getCameraLimitLowerRadius:function(){var t=this.getCameraConfig();if(t)return t.get("limitLowerRadius")},setCameraLimitLowerRadius:function(t){this.getOrCreateCameraConfig().set("limitLowerRadius",t)},getCameraZoomEnabled:function(){var t=this.getCameraConfig();if(t)return t.get("zoomEnabled")},setCameraZoomEnabled:function(t){this.getOrCreateCameraConfig().set("zoomEnabled",t)},getCameraUseMinZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("useMinZoomPerc")},setCameraUseMinZoomPerc:function(t){this.getOrCreateCameraConfig().set("useMinZoomPerc",t)},getCameraMinZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("minZoomPerc")},setCameraMinZoomPerc:function(t){this.getOrCreateCameraConfig().set("minZoomPerc",t)},getCameraUseMaxZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("useMaxZoomPerc")},setCameraUseMaxZoomPerc:function(t){this.getOrCreateCameraConfig().set("useMaxZoomPerc",t)},getCameraMaxZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("maxZoomPerc")},setCameraMaxZoomPerc:function(t){this.getOrCreateCameraConfig().set("maxZoomPerc",t)},getCameraLowerAlphaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("lowerAlphaLimit")},setCameraLowerAlphaLimit:function(t){this.getOrCreateCameraConfig().set("lowerAlphaLimit",t)},getCameraUpperAlphaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("upperAlphaLimit")},setCameraUpperAlphaLimit:function(t){this.getOrCreateCameraConfig().set("upperAlphaLimit",t)},getCameraLowerBetaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("lowerBetaLimit")},setCameraLowerBetaLimit:function(t){this.getOrCreateCameraConfig().set("lowerBetaLimit",t)},getCameraUpperBetaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("upperBetaLimit")},setCameraUpperBetaLimit:function(t){this.getOrCreateCameraConfig().set("upperBetaLimit",t)},getGlowConfig:function(){var t=this.getSceneConfig();return t&&t.get("glow")&&t.get("glow")instanceof Zakeke.SceneGlowConfig?t.get("glow"):null},getOrCreateGlowConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("glow");return e||(e=new Zakeke.SceneGlowConfig,t.set("glow",e)),e},getInfoPointsConfig:function(){var t=this.getSceneConfig();return t&&t.get("infoPoints")&&t.get("infoPoints")instanceof Zakeke.SceneInfoPointsConfig?t.get("infoPoints"):null},getOrCreateInfoPointsConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("infoPoints");return e||(e=new Zakeke.SceneInfoPointsConfig,t.set("infoPoints",e)),e},getInfoPointsEnabled:function(){var t=!1,e=this.getInfoPointsConfig();return e&&(t=e.get("enabled")),null==t&&(t=!1),t},setInfoPointsEnabled:function(t){this.getOrCreateInfoPointsConfig().set("enabled",t)},getInfoPointsStyleConfig:function(){var t=this.getInfoPointsConfig();return t&&t.get("pointsStyle")&&t.get("pointsStyle")instanceof Zakeke.SceneInfoPointsStyleConfig?t.get("pointsStyle"):null},getOrCreateInfoPointsStyleConfig:function(){var t=this.getOrCreateInfoPointsConfig(),e=t.get("pointsStyle");return e||(e=new Zakeke.SceneInfoPointsStyleConfig,t.set("pointsStyle",e)),e},getInfoPointsBorderColor:function(){var t="#ffffff",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("borderColor")),t||(t="#ffffff"),t},setInfoPointsBorderColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("borderColor",t)},getInfoPointsInnerPointColor:function(){var t="#ffffff",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("innerPointColor")),t||(t="#ffffff"),t},setInfoPointsInnerPointColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("innerPointColor",t)},getInfoPointsColor:function(){var t="#a01c20",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("color")),t||(t="#a01c20"),t},setInfoPointsColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("color",t)},getInfoPointsHighlightColor:function(){var t="#bb2025",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("highlightColor")),t||(t="#bb2025"),t},setInfoPointsHighlightColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("highlightColor",t)},getFirstExplodedMeshLocation:function(){return this.get("meshLocations").getFirstExplodedMeshLocation()},getFirstCollapsedMeshLocation:function(){return this.get("meshLocations").getFirstCollapsedMeshLocation()},getOrCreateExplodedMeshLocation:function(){return this.get("meshLocations").getOrCreateExplodedMeshLocation()},getOrCreateCollapsedMeshLocation:function(){return this.get("meshLocations").getOrCreateCollapsedMeshLocation()},getWebPEnabled:function(){var t=this.getTexturesConfig();return!!t&&"WebP"===t.get("format")},setWebPEnabled:function(t){var e=this.getOrCreateTexturesConfig(),n=t?"WebP":"None";"WebP"==n&&this.getOrCreateTextureWebPOptions(),e.set("format",n)},getWebPType:function(){var t=this.getTextureWepPOptions();return t?t.get("type"):"Lossy"},setWebPType:function(t){var e=this.getOrCreateTextureWebPOptions(),n="Lossy";t&&"lossless"===t.toLowerCase()&&(n="Lossless"),e.set("type",n)},getWebPQuality:function(){var t=this.getTextureWepPOptions();return t?t.get("quality"):80},setWebPQuality:function(t){var e=this.getOrCreateTextureWebPOptions(),n=Number(t);isNaN(n)&&(n=80),n=Math.max(1,Math.min(100,n)),e.set("quality",t)},getTexturesConfig:function(){var t=this.getSceneConfig();return t&&t.get("textures")&&t.get("textures")instanceof Zakeke.SceneTexturesConfig?t.get("textures"):null},getOrCreateTexturesConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("textures");return e||(e=new Zakeke.SceneTexturesConfig,t.set("textures",e)),e},getTextureCompressionFormat:function(){var t=this.getTexturesConfig();if(t)return t.get("format")},setTextureCompressionFormat:function(t){this.getOrCreateTexturesConfig().set("format",t)},getTextureWepPOptions:function(){var t=this.getTexturesConfig();if(t)return t.get("webpOptions")},getOrCreateTextureWebPOptions:function(){var t=this.getOrCreateTexturesConfig(),e=t.get("webpOptions");return e||(e=new Zakeke.WebPOptions,t.set("webpOptions",e)),e},setTextureWepPOptions:function(t){this.getOrCreateTexturesConfig().set("webpOptions",t)},setTextureWebPType:function(t){this.getOrCreateTextureWebPOptions().set("type",t)},setTextureWebPQuality:function(t){this.getOrCreateTextureWebPOptions().set("quality",t)}}),Zakeke.Scenes=Backbone.Collection.extend({model:Zakeke.Scene,url:function(){return Zakeke.config.baseApiUrl+"scenes"},getScene:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("sceneID")==t)return n}return null}}),Zakeke.MaterialSourceTextureImage=Backbone.AssociatedModel.extend({defaults:{sceneID:null,sourceID:null,materialID:null,fileObjectID:-1,fileLength:-1,url:""},initialize:function(){},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialSourceTextureImages=Backbone.Collection.extend({model:Zakeke.MaterialSourceTextureImage,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null}}),Zakeke.MaterialTextureImage=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,imageUrl:""},idAttribute:"textureImageID",initialize:function(){},relations:[],getTextureImageID:function(){return this.get("textureImageID")},getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialTextureImages=Backbone.Collection.extend({model:Zakeke.MaterialTextureImage,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findTextureImage:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("textureImageID")==t)return n}return null}}),Zakeke.MaterialShaderOption=Backbone.AssociatedModel.extend({defaults:{name:"",shaderOptionTypeID:Zakeke.ShaderOptionType.Attribute},idAttribute:"optionID",initialize:function(){this.get("optionID")||this.set("optionID",Zakeke.generateUUID())},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialShaderOptions=Backbone.Collection.extend({model:Zakeke.MaterialShaderOption,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findShaderOption:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("optionID")==t)return n}return null}}),Zakeke.MaterialShaderInput=Backbone.AssociatedModel.extend({defaults:{name:"",shaderInputTypeID:Zakeke.ShaderInputType.Float},idAttribute:"inputID",initialize:function(){this.get("inputID")||this.set("inputID",Zakeke.generateUUID())},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialShaderInputs=Backbone.Collection.extend({model:Zakeke.MaterialShaderInput,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findShaderInput:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("inputID")==t)return n}return null}}),Zakeke.MaterialShader=Backbone.AssociatedModel.extend({defaults:{name:"",vertex:"",fragment:""},idAttribute:"materialID",initialize:function(){},relations:[],getMaterialID:function(){return this.collection&&this.collection.getModelID?this.collection.getMaterialID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){}}),Zakeke.Material=Backbone.AssociatedModel.extend({defaults:{name:"",JSON:"",url:"",rootUrl:"",materialFileName:"",sellerID:-1,imageData:null,imageUrl:"",fileLength:-1,sourceTextureImages:[],textureImages:[],shaders:null,shaderInputs:[],shaderOptions:[]},idAttribute:"materialID",getMaterialID:function(){return null!=this.id&&null!=this.id?this.id:this.get("tempMaterialID")},initialize:function(){this.set("tempMaterialID",Zakeke.generateUUID());var t=this;this.get("textureImages").parentModel=this,this.get("textureImages").url=function(){return t.url()+"/"+t.getMaterialID()+"/textures"},this.get("sourceTextureImages").parentModel=this,this.get("shaders")&&(this.get("shaders").parentModel=this),this.get("shaderInputs").parentModel=this,this.get("shaderOptions").parentModel=this},relations:[{type:Backbone.Many,key:"sourceTextureImages",collectionType:Zakeke.MaterialSourceTextureImages},{type:Backbone.Many,key:"textureImages",collectionType:Zakeke.MaterialTextureImages},{type:Backbone.One,key:"shaders",relatedModel:Zakeke.MaterialShader},{type:Backbone.Many,key:"shaderInputs",collectionType:Zakeke.MaterialShaderInputs},{type:Backbone.Many,key:"shaderOptions",collectionType:Zakeke.MaterialShaderOptions}],url:function(){var t=Zakeke.config.baseApiUrl+"materials";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},getTexturesUrl:function(){return Zakeke.config.baseApiUrl+"materials/"+this.getMaterialID()+"/textures"},getClonedContentForSceneUrl:function(t){return Zakeke.config.baseApiUrl+"materials/"+this.getMaterialID()+"/clonedContentForScene/"+t},getShaderAttributeOptions:function(t){for(var e=[],n=0;n<this.get("shaderOptions").length;n++){var i=this.get("shaderOptions").at(n);i.get("shaderOptionTypeID")===t&&e.push(i.get("name"))}return e}}),Zakeke.Materials=Backbone.Collection.extend({model:Zakeke.Material,url:function(){return Zakeke.config.baseApiUrl+"materials"},getMaterial:function(t){for(var e=0;e<this.length;e++){var n=this.at(e);if(n.get("materialID")==t)return n}return null},comparator:function(t){return t.get("name")}}),(Zakeke=Zakeke||{}).cloudFlareApiUrl=function(){return"string"==typeof Zakeke.config.cloudFlareApiUrl&&null!==Zakeke.config.cloudFlareApiUrl&&""!==Zakeke.config.cloudFlareApiUrl.trim()?Zakeke.config.cloudFlareApiUrl:null},Zakeke.ComposerModels=Backbone.AssociatedModel.extend({defaults:{model:null,scene:null},idAttribute:"modelID",initialize:function(){},sceneIDSuccessfull:function(t,e,n,i){var r=i.sceneID,s=new MPlaza.Model;s.set("modelID",this.get("modelID")),this.set("model",s);var a=t.get("model").fetch({data:e.data}),o=new Zakeke.Scene;o.set("sceneID",r),t.set("scene",o);var l=t.get("scene").fetch({data:e.data});$.when(a,l).done(function(i){e.success&&e.success(t,i,e),t.trigger("sync",t,i,e),n.resolve()}).fail(function(){n.reject()})},getSceneID:function(t,e){var n=this,i=n.get("modelID"),r=!0,s=Zakeke.cloudFlareApiUrl(),a=Zakeke.config.baseApiUrl;null==e&&(e=$.Deferred()),null!==s&&r&&(a=s,r=!1);var o=a+"models/"+i+"/defaultSceneId";return null!=t&&(o+="?c="+t),$.get(o).then(function(t){e.resolve(t)},function(){!1===r?n.getSceneID(t,e):e.reject()}),e.promise()},fetch:function(t){t=t||{};var e=$.Deferred(),n=void 0!==t.data?t.data.c:void 0;return this.getSceneID(n).then(this.sceneIDSuccessfull.bind(this,this,t,e),function(){e.reject()}),e.promise()},relations:[{type:Backbone.One,key:"model",relatedModel:MPlaza.Model},{type:Backbone.One,key:"scene",relatedModel:Zakeke.Scene}]}),(Zakeke=Zakeke||{}).OptionSelection=Backbone.Model.extend({defaults:{optionID:-1,attributeID:-1,optionGuid:"",optionCode:"",name:"",selected:!1,enabled:!0},idAttribute:"optionID",initialize:function(){}}),Zakeke.OptionSelectionCollection=Backbone.Collection.extend({model:Zakeke.OptionSelection}),Zakeke.AttributeSelection=Backbone.Model.extend({idAttribute:"attributeID",initialize:function(){myDefaults={attributeID:-1,attributeGuid:"",attributeCode:"",attributeTypeID:MPlaza.AttributeType.Options,groupID:-1,name:"",enabled:!0,selectedValue:null,optionPreviewShapeID:MPlaza.AttributeOptionPreviewShape.Rectangle,options:new Zakeke.OptionSelectionCollection},this.set(myDefaults)},getOptionSelection:function(t){return this.get("options").findWhere({optionID:t})},getOptionSelectionByGuid:function(t){return this.get("options").findWhere({optionGuid:t})},getOptionSelectionsByName:function(t){for(var e=[],n=0;n<this.get("options").length;n++)this.get("options").at(n).get("name")==t&&e.push(this.get("options").at(n));return e},getOptionIDsByName:function(t){for(var e=[],n=0;n<this.get("options").length;n++)this.get("options").at(n).get("name")==t&&e.push(this.get("options").at(n).get("optionID"));return e},getSelectedOption:function(){return this.get("options").findWhere({selected:!0})},getUnselectedOptions:function(){return this.get("options").where({selected:!1})},getUnselectedEnabledOptions:function(){return this.get("options").where({selected:!1,enabled:!0})},getEnabledOptions:function(){return this.get("options").where({enabled:!0})}}),Zakeke.AttributeSelectionCollection=Backbone.Collection.extend({model:Zakeke.AttributeSelection}),Zakeke.TemplateCompositionSelection=Backbone.Model.extend({idAttribute:"compositionID",defaults:{compositionID:-1,name:"",previewImageUrl:""},initialize:function(){}}),Zakeke.TemplateCompositionSelectionCollection=Backbone.Collection.extend({model:Zakeke.TemplateCompositionSelection}),Zakeke.CategorySelection=Backbone.Model.extend({idAttribute:"categoryID",initialize:function(){myDefaults={categoryID:-1,name:"",composition:new Zakeke.TemplateCompositionSelectionCollection},this.set(myDefaults)}}),Zakeke.CategorySelectionCollection=Backbone.Collection.extend({model:Zakeke.CategorySelection}),Zakeke.MacroCategorySelection=Backbone.Model.extend({idAttribute:"macroCategoryID",initialize:function(){myDefaults={macroCategoryID:-1,name:"",category:new Zakeke.CategorySelectionCollection},this.set(myDefaults)}}),Zakeke.MacroCategorySelectionCollection=Backbone.Collection.extend({model:Zakeke.MacroCategorySelection}),Zakeke.TemplateGroupSelection=Backbone.Model.extend({idAttribute:"templateGroupID",initialize:function(){myDefaults={templateGroupID:-1,name:"",groupID:-1,stepID:-1,displayOrder:0,macrocategory:new Zakeke.MacroCategorySelectionCollection},this.set(myDefaults)}}),Zakeke.TemplateGroupSelectionCollection=Backbone.Collection.extend({model:Zakeke.TemplateGroupSelection}),Zakeke.AttributeGroupSelection=Backbone.Model.extend({idAttribute:"groupID",initialize:function(){myDefaults={groupID:-1,groupGuid:"",name:"",attributes:new Zakeke.AttributeSelectionCollection,templateGroups:new Zakeke.TemplateGroupSelectionCollection},this.set(myDefaults)},containsAttributeSelection:function(t){return!!this.get("attributes").findWhere({attributeID:t})},countEnabledAttributeSelections:function(){return this.get("attributes").where({enabled:!0}).length}}),Zakeke.AttributeGroupSelectionCollection=Backbone.Collection.extend({model:Zakeke.AttributeGroupSelection}),Zakeke.ComposerSelection=Backbone.Model.extend({initialize:function(){myDefaults={zkModel:null,groups:new Zakeke.AttributeGroupSelectionCollection,attributeDependencies:{},optionDependencies:{},suggestions:{},currentModelColorID:null},this.set(myDefaults)},buildDependencies:function(){var t=this.get("zkModel");if(t&&t instanceof MPlaza.Model)for(var e=0;e<t.get("attributes").length;e++){var n=t.get("attributes").at(e);if(h=n.get("constraintExpression"))for(var i=n.get("attributeGuid"),r=h.getAllAttributeGuids(),s=0;s<r.length;s++){var a=r[s];if(this.get("attributeDependencies").hasOwnProperty(a)){var o=this.get("attributeDependencies")[a];Zakeke.arrayContains(o,i)||o.push(i)}else this.get("attributeDependencies")[a]=[i]}for(var l=0;l<n.get("options").length;l++){var h,c=n.get("options").at(l);if(h=c.get("constraintExpression")){i=c.get("optionGuid"),r=h.getAllAttributeGuids();for(var u=0;u<r.length;u++)a=r[u],this.get("optionDependencies").hasOwnProperty(a)?(o=this.get("optionDependencies")[a],Zakeke.arrayContains(o,i)||o.push(i)):this.get("optionDependencies")[a]=[i]}}}},checkAllConstraintExpressions:function(){var t=this.get("zkModel");if(t&&t instanceof MPlaza.Model){for(var e=this.getDependenceAwareAttributeSelections(),n=[],i=0;i<e.length;i++){var r=e[i],s=t.getAttribute(r.get("attributeID"));this.checkConstraintExpression(r);for(var a=0;a<r.get("options").length;a++){var o=r.get("options").at(a);s.getOption(o.get("optionID")).get("constraintExpression")&&n.push(o)}}for(i=0;i<n.length;i++)o=n[i],this.checkOptionConstraintExpression(o)}},checkConstraintExpression:function(t){var e=this.get("zkModel");if(e&&e instanceof MPlaza.Model){var n=e.getAttribute(t.get("attributeID")).get("constraintExpression");if(n){var i=this.evaluateAttributeExpression(n);t.set("enabled",i)}}},checkDependentConstraintExpressions:function(t){var e=this.getAttributeSelection(t);if(e){var n=e.get("attributeGuid"),i=this.get("attributeDependencies");if(i.hasOwnProperty(n))for(var r=i[n],s=0;s<r.length;s++){var a=r[s],o=this.getAttributeSelectionByGuid(a);this.checkConstraintExpression(o)}var l=[],h=this.get("optionDependencies");if(h.hasOwnProperty(n))for(r=h[n],s=0;s<r.length;s++){a=r[s];var c=this.getOptionSelectionByGuid(a);this.checkOptionConstraintExpression(c);var u=c.get("attributeID");Zakeke.arrayContains(l,u)||l.push(u)}for(s=0;s<l.length;s++){var d=l[s];this.getAttributeSelection(d).getSelectedOption().get("enabled")||this.selectFirstEnabledOption(d)}}},checkOptionConstraintExpression:function(t){var e=this.get("zkModel");if(e&&e instanceof MPlaza.Model){var n=e.getOption(t.get("optionID")).get("constraintExpression");if(n){var i=this.evaluateAttributeExpression(n);t.set("enabled",i)}}},selectFirstEnabledOption:function(t){var e=this.getAttributeSelection(t);if(e){var n=e.getEnabledOptions(),i=null;n&&n.length>0&&(i=n[0]);var r=e.getSelectedOption();!i||null!=r&&r.get("optionID")==i.get("optionID")||(null!=r&&r.set("selected",!1),i.set("selected",!0))}},evaluateAttributeExpression:function(t){if(!(t&&t instanceof MPlaza.AttributeExpression))return!1;for(var e=t.get("op"),n=e==MPlaza.LogicalOperator.AND,i=0;i<t.get("propositions").length;i++){var r=t.get("propositions")[i],s=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(n=n&&s))return!1}else if(n=n||s)return!0}for(i=0;i<t.get("expressions").length;i++){var a=t.get("expressions")[i];if(s=this.evaluateChildAttributeExpression(a),e==MPlaza.LogicalOperator.AND){if(!(n=n&&s))return!1}else if(n=n||s)return!0}return n},evaluateChildAttributeExpression:function(t){for(var e=t.op,n=e==MPlaza.LogicalOperator.AND,i=0;i<t.propositions.length;i++){var r=t.propositions[i],s=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(n=n&&s))return!1}else if(n=n||s)return!0}for(i=0;i<t.expressions.length;i++){var a=t.expressions[i];if(s=this.evaluateChildAttributeExpression(a),e==MPlaza.LogicalOperator.AND){if(!(n=n&&s))return!1}else if(n=n||s)return!0}return n},evaluateAttributeProposition:function(t){if(t&&t.hasOwnProperty("attributeGuid")&&t.hasOwnProperty("op")&&t.hasOwnProperty("value")){var e=t.attributeGuid,n=this.getAttributeSelectionByGuid(e);if(n&&n.get("enabled")){var i=n.get("selectedValue");if(n.get("attributeTypeID")==MPlaza.AttributeType.Options){var r=n.getSelectedOption();r&&(i=r.get("optionGuid"))}var s=!1;if(t.op==MPlaza.ComparisonOperator.Equal)s=i==t.value;else if(t.op==MPlaza.ComparisonOperator.NotEqual)s=i!=t.value;else if(t.op==MPlaza.ComparisonOperator.In||t.op==MPlaza.ComparisonOperator.NotIn){var a=t.value.split(";");s=t.op==MPlaza.ComparisonOperator.In?Zakeke.arrayContains(a,i):!Zakeke.arrayContains(a,i)}return s}}return!1},getAttributeGroupSelection:function(t){var e=this.get("zkModel");if(e){var n=e.get("attributes").findWhere({attributeID:t});if(n){var i=n.get("groupID");return this.get("groups").findWhere({groupID:i})}}return null},getAttributeSelection:function(t){var e=this.get("zkModel");if(e){var n=e.get("attributes").findWhere({attributeID:t});if(n){var i=n.get("groupID"),r=this.get("groups").findWhere({groupID:i});if(r)return r.get("attributes").findWhere({attributeID:t})}}return null},getAttributeSelectionByGuid:function(t){var e=this.get("zkModel");if(e){var n=e.get("attributes").findWhere({attributeGuid:t});if(n){var i=n.get("groupID"),r=this.get("groups").findWhere({groupID:i});if(r)return r.get("attributes").findWhere({attributeGuid:t})}}return null},getAttributeSelectionByOptionID:function(t){var e=this.getOptionSelection(t);if(e){var n=e.get("attributeID");return this.getAttributeSelection(n)}return null},getAllAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++){var r=n.get("attributes").at(i);t.push(r)}return t},getDependenceAwareAttributeSelections:function(){for(var t={},e=this.getAllAttributeSelections(),n=0;n<e.length;n++){var i=e[n].get("attributeGuid");t.hasOwnProperty(i)||(t[i]=0);for(var r=this.getFullDependencyChain(i),s=0;s<r.length;s++){var a=r[s];t.hasOwnProperty(a)?t[a]+=1:t[a]=1}}return e.sort(function(e,n){var i=t[e.get("attributeGuid")],r=t[n.get("attributeGuid")];return i<r?-1:i>r?1:0}),e},getFullDependencyChain:function(t){var e=this.get("attributeDependencies"),n=function(i,r){if(i===t||Zakeke.arrayContains(r,i)||r.push(i),e.hasOwnProperty(i))for(var s=e[i],a=0;a<s.length;a++)n(s[a],r)},i=[];if(e.hasOwnProperty(t)){i=e[t].slice(0);for(var r=0;r<i.length;r++)n(i[r],i)}return i},getAllAttributeIDs:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++){var r=n.get("attributes").at(i);t.push(r.get("attributeID"))}return t},getEnabledAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++){var r=n.get("attributes").at(i);r.get("enabled")&&t.push(r)}return t},getEnabledAttributeIDs:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++){var r=n.get("attributes").at(i);r.get("enabled")&&t.push(r.get("attributeID"))}return t},getDisabledAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++){var r=n.get("attributes").at(i);r.get("enabled")||t.push(r)}return t},getAttributeOptionSelection:function(t,e){var n=this.getAttributeSelection(t);return n?n.getOptionSelection(e):null},getOptionSelection:function(t){for(var e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++)for(var r=n.get("attributes").at(i),s=0;s<r.get("options").length;s++){var a=r.get("options").at(s);if(a.get("optionID")==t)return a}return null},getOptionSelectionByGuid:function(t){for(var e=0;e<this.get("groups").length;e++)for(var n=this.get("groups").at(e),i=0;i<n.get("attributes").length;i++)for(var r=n.get("attributes").at(i),s=0;s<r.get("options").length;s++){var a=r.get("options").at(s);if(a.get("optionGuid")==t)return a}return null},getAllAttributeTransformationScript:function(){for(var t=[],e=this.getAllAttributeSelections(),n=0;n<e.length;n++){var i=e[n];if(i.get("enabled")){var r=this.getAttributeTransformationScript(i.get("attributeID"));r&&t.push(r)}}return t},getAttributeTransformationScript:function(t){var e=null,n=this.getAttributeSelection(t);if(n&&n.get("enabled"))if(e={attributeID:t,selectedValue:"",actions:this.getAttributeSceneActions(t)},n.get("attributeTypeID")==MPlaza.AttributeType.Options){var i=n.getSelectedOption();i&&i.get("enabled")?e.selectedValue=i.get("optionID").toString():e=null}else e.selectedValue=n.get("selectedValue");return e},getAttributeSceneActions:function(t){var e=[],n=this.get("zkModel");if(n&&n instanceof MPlaza.Model){var i=n.getAttribute(t),r=this.getAttributeSelection(t),s=i.get("preActions").sortBy(function(t){return t.get("execOrder")});if(Array.prototype.push.apply(e,s),r&&i)if(r.get("attributeTypeID")==MPlaza.AttributeType.Options){var a=r.getSelectedOption();if(a){var o=i.get("options").findWhere({optionID:a.get("optionID")});if(o){var l=o.get("actions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,l)}}}else{var h=i.get("valueActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,h)}var c=i.get("postActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,c)}return e},getAttributeUnselectedOptionsSceneActions:function(t){var e=[],n=this.get("zkModel");if(n&&n instanceof MPlaza.Model){var i=n.getAttribute(t),r=this.getAttributeSelection(t),s=i.get("preActions").sortBy(function(t){return t.get("execOrder")});if(Array.prototype.push.apply(e,s),r&&i&&r.get("attributeTypeID")==MPlaza.AttributeType.Options)for(var a=r.getUnselectedEnabledOptions(),o=0;o<a.length;o++){var l=a[o],h=i.get("options").findWhere({optionID:l.get("optionID")});if(h){var c=h.get("actions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,c)}}var u=i.get("postActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,u)}return e},getAllAttributesUnselectedOptionsSceneActions:function(){for(var t=[],e=this.getEnabledAttributeSelections(),n=0;n<e.length;n++){var i=e[n],r=this.getAttributeUnselectedOptionsSceneActions(i.get("attributeID"));Array.prototype.push.apply(t,r)}return t},detachEvents:function(){for(var t=this.getAllAttributeSelections(),e=0;e<t.length;e++){var n=t[e];n.get("attributeID"),n.off("change:selectedValue"),n.off("change:enabled");for(var i=0;i<n.get("options").length;i++){var r=n.get("options").at(i);r.get("optionID"),r.off("change:selected"),r.off("change:enabled")}}},attachEvents:function(){for(var t=this,e=this.getAllAttributeSelections(),n=0;n<e.length;n++){var i=e[n];i.get("attributeID"),i.on("change:selectedValue",function(){t.onAttributeSelectedValueChanged(this.get("attributeID"))}),i.on("change:enabled",function(){t.onAttributeEnablingChanged(this.get("attributeID"))});for(var r=0;r<i.get("options").length;r++){var s=i.get("options").at(r);s.get("optionID"),s.on("change:selected",function(){t.onAttributeSelectedOptionChanged(this.get("attributeID"),this.get("optionID"))}),s.on("change:enabled",function(){t.onAttributeOptionEnablingChanged(this.get("attributeID"),this.get("optionID"))})}}},onAttributeSelectedValueChanged:function(t){var e=this.getAttributeSelection(t),n=this.getAttributeSceneActions(t),i={attributeID:t,selectedValue:e.get("selectedValue"),actions:n};this.trigger("attributeSelectionChanged",i),this.checkCurrentModelColor(),this.checkDependentConstraintExpressions(t)},onAttributeSelectedOptionChanged:function(t,e){this.getAttributeSelection(t);var n=this.getAttributeOptionSelection(t,e);if(n&&n.get("selected")){var i=this.getAttributeSceneActions(t),r={attributeID:t,selectedValue:e.toString(),actions:i};this.trigger("attributeSelectionChanged",r),this.checkCurrentModelColor(),this.checkDependentConstraintExpressions(t)}},onAttributeEnablingChanged:function(t){var e={attributeID:t},n=this.getAttributeSelection(t);if(n.get("enabled")?this.trigger("attributeEnabled",e):this.trigger("attributeDisabled",e),n.get("enabled")&&(n.get("selectedValue"),n.get("attributeTypeID")==MPlaza.AttributeType.Options)){var i=!1,r=this.getSuggestions(t);if(r){this.removeSuggestions(t);for(var s=0;s<r.length;s++){var a=r[s],o=n.getOptionSelection(a);if(o&&o.get("enabled")){i=!0,this.selectAttributeValue(t,a);break}}}if(!i){var l=n.getSelectedOption();l?this.onAttributeSelectedOptionChanged(t,l.get("optionID")):this.onAttributeSelectedValueChanged(t)}}this.checkDependentConstraintExpressions(t)},onAttributeOptionEnablingChanged:function(t,e){var n=this.getAttributeOptionSelection(t,e),i={attributeID:t,optionID:e},r=!1,s=!1;n&&(r=n.get("enabled"),s=n.get("selected")),r?this.trigger("attributeOptionEnabled",i):this.trigger("attributeOptionDisabled",i),s&&r&&this.onAttributeSelectedOptionChanged(t,e),this.checkDependentConstraintExpressions(t)},selectAttributeOptionByGuid:function(t,e){var n=this.getAttributeSelectionByGuid(t);if(n&&n.get("attributeTypeID")==MPlaza.AttributeType.Options){var i=n.getOptionSelectionByGuid(e);i&&this._selectAttributeOption(n,i)}},selectAttributeValue:function(t,e){var n=this.getAttributeSelection(t);if(n)if(n.get("attributeTypeID")==MPlaza.AttributeType.Options){var i=-1;if(e&&!isNaN(e)){i=parseInt(e);var r=n.getOptionSelection(i);r&&this._selectAttributeOption(n,r)}}else n.set("selectedValue",e)},_selectAttributeOption:function(t,e){if(t&&e){-1!==t.get("attributeID")&&this.saveSuggestionsForSelectedOption(t.get("attributeID"),e.get("optionID"));var n=t.getSelectedOption();n&&n.set("selected",!1),e.set("selected",!0)}},checkCurrentModelColor:function(){var t=this.getModelColorIDForSelection(),e=null!=t&&null!=t,n=null!=this.currentModelColorID&&null!=this.currentModelColorID;if(e&&n&&t!=this.currentModelColorID||!e&&n||e&&!n){var i={colorID:t};this.trigger("modelColorChanged",i)}},saveSuggestionsForSelectedOption:function(t,e){this.get("suggestions")[t]=[e]},getSuggestions:function(t){return this.get("suggestions").hasOwnProperty(t)?this.get("suggestions")[t]:null},removeSuggestions:function(t){this.get("suggestions").hasOwnProperty(t)&&delete this.get("suggestions")[t]},setupOnComposition:function(t){var e=this.get("zkModel");if(e&&t&&e.get("modelID")==t.get("modelID")){this.detachEvents();for(var n=0;n<t.get("compositionItems").length;n++){var i=t.get("compositionItems").at(n),r=i.get("attributeID"),s=i.get("selectedValue");i.get("attributeTypeID")==MPlaza.AttributeType.Options&&null!=i.get("selectedOptionID")&&null!=i.get("selectedOptionID")&&(s=i.get("selectedOptionID")),this.selectAttributeValue(r,s)}this.buildDependencies(),this.checkAllConstraintExpressions(),this.attachEvents()}},buildComposition:function(){var t=new MPlaza.Composition;return this.updateComposition(t),t},updateComposition:function(t){var e=this.get("zkModel");t.set("modelID",e.get("modelID")),t.set("modelName",e.get("name")),t.set("modelPrice",e.get("price")),this.updateCompositionItems(t)},updateCompositionItems:function(t){for(var e=[],n=0;n<t.get("compositionItems").length;n++){var i=t.get("compositionItems").at(n);(s=this.getAttributeSelection(i.get("attributeID")))&&s.get("enabled")?this.updateCompositionItem(i,s):e.push(i)}var r=this.getEnabledAttributeSelections();for(n=0;n<r.length;n++){var s=r[n];(i=t.getCompositionItemByAttributeID(s.get("attributeID")))||(i=new MPlaza.CompositionItem,this.updateCompositionItem(i,s),t.get("compositionItems").push(i))}e.length>0&&t.get("compositionItems").remove(e)},updateCompositionItem:function(t,e){if(t.set("attributeID",e.get("attributeID")),t.set("attributeGuid",e.get("attributeGuid")),t.set("attributeTypeID",e.get("attributeTypeID")),t.set("attributeName",e.get("name")),t.set("attributeCode",e.get("attributeCode")),e.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=e.getSelectedOption();n&&(t.set("selectedOptionID",n.get("optionID")),t.set("selectedOptionGuid",n.get("optionGuid")),t.set("selectedOptionCode",n.get("optionCode")),t.set("selectedOptionName",n.get("name")),t.set("selectedValue",null))}else{var i=e.get("selectedValue");t.set("selectedOptionID",null),t.set("selectedOptionGuid",null),t.set("selectedOptionCode",null),t.set("selectedValue",i)}},getModelColorIDForSelection:function(){if(this.get("zkModel")){var t=this.get("zkModel").get("attributeSelectionColors");if(t)for(var e=0;e<t.length;e++){var n=t[e],i=n.get("selectionExpression"),r=n.get("colorID");if(i&&this.evaluateAttributeExpression(i))return r}}return null},getCompositionBaseJSON:function(){for(var t={items:[]},e=this.getAllAttributeSelections(),n=0;n<e.length;n++){var i=e[n],r={code:i.get("attributeID"),value:""};if(i.get("enabled"))if(i.get("attributeTypeID")===MPlaza.AttributeType.Options){var s=i.getSelectedOption();s&&(r.value=s.get("optionID").toString())}else r.value=i.get("selectedValue");else r.value="disabled";t.items.push(r)}return JSON.stringify(t)},getCompositionHashCode:function(){var t=this.getCompositionBaseJSON();return CryptoJS.SHA1(t).toString()},refresh:function(){this.detachEvents(),this._resetProperties();var t=this.get("zkModel"),e=this;if(t&&t instanceof MPlaza.Model){var n=function(t,e){var n=new Zakeke.AttributeSelection;n.set("attributeID",t.get("attributeID")),n.set("attributeGuid",t.get("attributeGuid")),n.set("attributeCode",t.get("attributeCode")),n.set("attributeTypeID",t.get("attributeTypeID")),n.set("groupID",e.get("groupID")),n.set("name",t.get("name")),n.set("optionPreviewShapeID",t.get("optionPreviewShapeID")),e.get("attributes").add(n);var i=t.get("defaultValue");if(t.get("attributeTypeID")==MPlaza.AttributeType.Options){for(var r=t.get("options").sortBy(function(t){return t.get("displayOrder")}),s=null,a=0;a<r.length;a++){var o=r[a],l=o.get("isDefault")&&null==s,h=new Zakeke.OptionSelection;h.set("optionID",o.get("optionID")),h.set("optionGuid",o.get("optionGuid")),h.set("optionCode",o.get("optionCode")),h.set("attributeID",t.get("attributeID")),h.set("name",o.get("name")),h.set("selected",l),h.set("enabled",!0),l&&(s=h),n.get("options").add(h)}null==s&&n.get("options").length>0&&n.get("options").at(0).set("selected",!0)}else t.get("attributeTypeID")==MPlaza.AttributeType.Color?i?n.set("selectedValue",i):n.selectedValue="#ffffff":t.get("attributeTypeID")==MPlaza.AttributeType.Number?i&&!isNaN(i)?n.set("selectedValue",i):n.selectedValue=0:t.get("attributeTypeID")==MPlaza.AttributeType.Number&&(i?n.set("selectedValue",i):n.selectedValue="")};t.get("attributeGroups").sortBy(function(t){return t.get("displayOrder")}).forEach(function(i){var r=i.get("groupID"),s=new Zakeke.AttributeGroupSelection;s.set("groupID",i.get("groupID")),s.set("groupGuid",i.get("groupGuid")),s.set("name",i.get("name")),e.get("groups").add(s);for(var a=t.get("attributes").where({groupID:r}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")}),o=0;o<a.length;o++){var l=a[o];n(l,s)}});var i=t.getAttributesWithoutGroup();if(i.length>0){var r=new Zakeke.AttributeGroupSelection;r.set("groupID",-1),r.set("groupGuid",""),r.set("name","default"),e.get("groups").add(r);for(var s=0;s<i.length;s++){var a=i[s];n(a,r)}}}this.buildDependencies(),this.checkAllConstraintExpressions(),this.attachEvents()},_resetProperties:function(){this.set("groups",new Zakeke.AttributeGroupSelectionCollection),this.set("attributeDependencies",{}),this.set("optionDependencies",{}),this.set("suggestions",{}),this.set("currentModelColorID",null)}},{CreateComposerSelection:function(t){var e=new Zakeke.ComposerSelection;if(e.set("zkModel",t),t&&t instanceof MPlaza.Model){var n=function(t,e){var n=new Zakeke.AttributeSelection;n.set("attributeID",t.get("attributeID")),n.set("attributeGuid",t.get("attributeGuid")),n.set("attributeCode",t.get("attributeCode")),n.set("attributeTypeID",t.get("attributeTypeID")),n.set("groupID",e.get("groupID")),n.set("name",t.get("name")),n.set("optionPreviewShapeID",t.get("optionPreviewShapeID")),e.get("attributes").add(n);var i=t.get("defaultValue");if(t.get("attributeTypeID")==MPlaza.AttributeType.Options){for(var r=t.get("options").sortBy(function(t){return t.get("displayOrder")}),s=null,a=0;a<r.length;a++){var o=r[a],l=o.get("isDefault")&&null==s,h=new Zakeke.OptionSelection;h.set("optionID",o.get("optionID")),h.set("optionGuid",o.get("optionGuid")),h.set("optionCode",o.get("optionCode")),h.set("attributeID",t.get("attributeID")),h.set("name",o.get("name")),h.set("selected",l),h.set("enabled",!0),l&&(s=h),n.get("options").add(h)}null==s&&n.get("options").length>0&&n.get("options").at(0).set("selected",!0)}else t.get("attributeTypeID")==MPlaza.AttributeType.Color?i?n.set("selectedValue",i):n.selectedValue="#ffffff":t.get("attributeTypeID")==MPlaza.AttributeType.Number?i&&!isNaN(i)?n.set("selectedValue",i):n.selectedValue=0:t.get("attributeTypeID")==MPlaza.AttributeType.Number&&(i?n.set("selectedValue",i):n.selectedValue="")},i=function(t,e){var n=new Zakeke.TemplateGroupSelection;n.set("templateGroupID",t.get("templateGroupID")),n.set("name",t.get("name")),n.set("groupID",t.get("groupID")),n.set("stepID",t.get("stepID")),n.set("displayOrder",t.get("displayOrder")),e.get("templateGroups").add(n);for(var i=t.get("macrocategory"),r=0;r<i.length;r++){var s=i.at(r),a=new Zakeke.MacroCategorySelection;a.set("macroCategoryID",s.get("macroCategoryID")),a.set("name",s.get("name"));for(var o=s.get("category"),l=0;l<o.length;l++){var h=o.at(l),c=new Zakeke.CategorySelection;c.set("categoryID",h.get("categoryID")),c.set("name",h.get("name"));for(var u=h.get("composition"),d=0;d<u.length;d++){var p=u.at(d),f=new Zakeke.TemplateCompositionSelection;f.set("compositionID",p.get("compositionID")),f.set("name",p.get("name")),f.set("previewImageUrl",p.get("previewImageUrl")),c.get("composition").add(f)}a.get("category").add(c)}n.get("macrocategory").add(a)}};t.get("attributeGroups").sortBy(function(t){return t.get("displayOrder")}).forEach(function(r){var s=r.get("groupID"),a=new Zakeke.AttributeGroupSelection;a.set("groupID",r.get("groupID")),a.set("groupGuid",r.get("groupGuid")),a.set("name",r.get("name")),e.get("groups").add(a);for(var o=t.get("attributes").where({groupID:s}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")}),l=0;l<o.length;l++){var h=o[l];n(h,a)}var c=t.get("templateGroups").where({groupID:s}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")});for(l=0;l<c.length;l++){var u=c[l];i(u,a)}});var r=t.getAttributesWithoutGroup(),s=t.getTemplateGroupsWithoutGroup(),a=new Zakeke.AttributeGroupSelection;if(a.set("groupID",-1),a.set("groupGuid",""),a.set("name","default"),e.get("groups").add(a),r.length>0)for(var o=0;o<r.length;o++){var l=r[o];n(l,a)}if(s.length>0)for(o=0;o<s.length;o++){var h=s[o];i(h,a)}}return e.buildDependencies(),e.checkAllConstraintExpressions(),e.attachEvents(),e}}),function(){var t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,g,m,v,_,y,x,b,w,S,M,T,E,C,A,R,L={}.hasOwnProperty,P=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},k=[].slice;S=Array.prototype.slice,t=function(t,e){return null==e&&(e=document),"object"==typeof t||"undefined"!=typeof exports&&null!==exports?t:e.querySelector(t)},b=function(){function t(){}var e;return t.uniqid=(e=0,{get:function(){return e++}}),t.extend=function(t){var e,n,i,r,s,a;for(n=t,s=0,a=(r=S.call(arguments,1)).length;s<a;s++)for(i in e=r[s])L.call(e,i)&&(n[i]=e[i]);return n},t.clampRGB=function(t){return t<0?0:t>255?255:t},t.copyAttributes=function(t,e,n){var i,r,s,a,o,l;for(null==n&&(n={}),l=[],r=0,s=(a=t.attributes).length;r<s;r++)i=a[r],null!=n.except&&(o=i.nodeName,P.call(n.except,o)>=0)||l.push(e.setAttribute(i.nodeName,i.nodeValue));return l},t.dataArray=function(t){return null==t&&(t=0),r.NodeJS||null!=window.Uint8Array?new Uint8Array(t):new Array(t)},t}(),"undefined"!=typeof exports&&null!==exports?(y=exports,a=require("canvas"),d=a.Image,h=require("fibers"),w=require("fs")):y=window,y.Caman=r=function(){function n(){var t,i,r,s=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof n?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),t=arguments[0],n.NodeJS||(r=parseInt(n.getAttrId(t[0]),10),i="function"==typeof t[1]?t[1]:"function"==typeof t[2]?t[2]:function(){},isNaN(r)||!x.has(r))?(this.id=b.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new e(this),this.renderer=new _(this),this.domIsLoaded(function(){return s.parseArguments(t),s.setup()}),this):x.execute(r,i)):new n(arguments)}return n.version={release:"4.1.1",date:"4/8/2013"},n.DEBUG=!1,n.NodeJS="undefined"!=typeof exports&&null!==exports,n.autoload=!n.NodeJS,n.allowRevert=!0,n.crossOrigin="anonymous",n.toString=function(){return"Version "+n.version.release+", Released "+n.version.date},n.remoteProxy="",n.proxyParam="camanProxyUrl",n.getAttrId=function(e){return!!n.NodeJS||("string"==typeof e&&(e=t(e)),null==e||null==e.getAttribute?null:e.getAttribute("data-caman-id"))},n.prototype.domIsLoaded=function(t){var e,i=this;return n.NodeJS?setTimeout(function(){return t.call(i)},0):"complete"===document.readyState?(f.debug("DOM initialized"),setTimeout(function(){return t.call(i)},0)):(e=function(){if("complete"===document.readyState)return f.debug("DOM initialized"),t.call(i)},document.addEventListener("readystatechange",e,!1))},n.prototype.parseArguments=function(t){var e,n,i,r;if(0===t.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(t[0]),1!==t.length){switch(typeof t[1]){case"string":this.imageUrl=t[1];break;case"function":this.callback=t[1]}if(2!==t.length&&(this.callback=t[2],4===t.length)){for(e in r=[],i=t[4])L.call(i,e)&&(n=i[e],r.push(this.options[e]=n));return r}}},n.prototype.setInitObject=function(e){if(n.NodeJS)return this.initObj=e,void(this.initType="node");if(this.initObj="object"==typeof e?e:t(e),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},n.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},n.prototype.initNode=function(){var t=this;return f.debug("Initializing for NodeJS"),this.image=new d,this.image.onload=function(){return f.debug("Image loaded. Width = "+t.imageWidth()+", Height = "+t.imageHeight()),t.canvas=new a(t.imageWidth(),t.imageHeight()),t.finishInit()},this.image.onerror=function(t){throw t},this.image.src=this.initObj},n.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),b.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},n.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},n.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(f.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),u.isRemote(this.image))return this.image.src=u.proxyUrl(this.image.src),f.debug("Remote image detected, using URL = "+this.image.src)},n.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},n.prototype.isImageLoaded=function(){return!!this.image.complete&&(null==this.image.naturalWidth||0!==this.image.naturalWidth)},n.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},n.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},n.prototype.imageLoaded=function(){return f.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},n.prototype.finishInit=function(){var t,e,i,r,s;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.reloadCanvasData(),n.allowRevert)for(this.initializedPixelData=b.dataArray(this.pixelData.length),this.originalPixelData=b.dataArray(this.pixelData.length),t=i=0,r=(s=this.pixelData).length;i<r;t=++i)e=s[t],this.initializedPixelData[t]=e,this.originalPixelData[t]=e;return this.dimensions={width:this.canvas.width,height:this.canvas.height},x.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},n.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},n.prototype.resetOriginalPixelData=function(){var t,e,i,r,s;if(!n.allowRevert)throw"Revert disabled";for(this.originalPixelData=b.dataArray(this.pixelData.length),s=[],e=0,i=(r=this.pixelData).length;e<i;e++)t=r[e],s.push(this.originalPixelData.push(t));return s},n.prototype.hasId=function(){return null!=n.getAttrId(this.canvas)},n.prototype.assignId=function(){if(!n.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},n.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},n.prototype.hiDPIAdjustments=function(){var t;if(!n.NodeJS&&!this.hiDPIDisabled())return 1!==(t=this.hiDPIRatio())?(f.debug("HiDPI ratio = "+t),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*t,this.canvas.height=this.preScaledHeight*t,this.canvas.style.width=this.preScaledWidth+"px",this.canvas.style.height=this.preScaledHeight+"px",this.context.scale(t,t),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},n.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)},n.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},n.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},n.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},n.prototype.replaceCanvas=function(t){var e;return e=this.canvas,this.canvas=t,this.context=this.canvas.getContext("2d"),e.parentNode.replaceChild(this.canvas,e),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},n.prototype.render=function(t){var e=this;return null==t&&(t=function(){}),l.trigger(this,"renderStart"),this.renderer.execute(function(){return e.context.putImageData(e.imageData,0,0),t.call(e)})},n.prototype.revert=function(){var t,e,i,r,s;if(!n.allowRevert)throw"Revert disabled";for(t=i=0,r=(s=this.originalVisiblePixels()).length;i<r;t=++i)e=s[t],this.pixelData[t]=e;return this.context.putImageData(this.imageData,0,0)},n.prototype.reset=function(){var t,e,n,i,r,s,a,o,l;for(t=document.createElement("canvas"),b.copyAttributes(this.canvas,t),t.width=this.originalWidth,t.height=this.originalHeight,s=(i=(e=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,n=a=0,o=(l=this.initializedPixelData).length;a<o;n=++a)r=l[n],s[n]=r;return e.putImageData(i,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(t)},n.prototype.originalVisiblePixels=function(){var t,e,i,r,s,a,o,l,h,c,u,d,p,f,g,v,_,y,x,b,w;if(!n.allowRevert)throw"Revert disabled";if(c=[],r=(d=this.cropCoordinates.x)+this.width,s=(p=this.cropCoordinates.y)+this.height,this.resized){for((t=document.createElement("canvas")).width=this.originalWidth,t.height=this.originalHeight,h=(o=(i=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,a=g=0,_=(y=this.originalPixelData).length;g<_;a=++g)l=y[a],h[a]=l;i.putImageData(o,0,0),(u=document.createElement("canvas")).width=this.width,u.height=this.height,(i=u.getContext("2d")).drawImage(t,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),h=i.getImageData(0,0,this.width,this.height).data,f=this.width}else h=this.originalPixelData,f=this.originalWidth;for(a=v=0,x=h.length;v<x;a=v+=4)d<=(b=(e=m.locationToCoordinates(a,f)).x)&&b<r&&p<=(w=e.y)&&w<s&&c.push(h[a],h[a+1],h[a+2],h[a+3]);return c},n.prototype.process=function(t,e){return this.renderer.add({type:c.Type.Single,name:t,processFn:e}),this},n.prototype.processKernel=function(t,e,n,i){var r,s,a;if(!n)for(n=0,r=s=0,a=e.length;0<=a?s<a:s>a;r=0<=a?++s:--s)n+=e[r];return this.renderer.add({type:c.Type.Kernel,name:t,adjust:e,divisor:n,bias:i||0}),this},n.prototype.processPlugin=function(t,e){return this.renderer.add({type:c.Type.Plugin,plugin:t,args:e}),this},n.prototype.newLayer=function(t){var e;return e=new p(this),this.canvasQueue.push(e),this.renderer.add({type:c.Type.LayerDequeue}),t.call(e),this.renderer.add({type:c.Type.LayerFinished}),this},n.prototype.executeLayer=function(t){return this.pushContext(t)},n.prototype.pushContext=function(t){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData},n.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},n.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},n}(),e=function(){function t(t){this.c=t}return t.prototype.calculateLevels=function(){var t,e,n,i,r,s,a;for(e={r:{},g:{},b:{}},t=i=0;i<=255;t=++i)e.r[t]=0,e.g[t]=0,e.b[t]=0;for(t=r=0,a=this.c.pixelData.length;r<a;t=r+=4)e.r[this.c.pixelData[t]]++,e.g[this.c.pixelData[t+1]]++,e.b[this.c.pixelData[t+2]]++;for(n=this.c.pixelData.length/4,t=s=0;s<=255;t=++s)e.r[t]/=n,e.g[t]/=n,e.b[t]/=n;return e},t}(),r.DOMUpdated=function(){var t,e,n,i,r;if((e=document.querySelectorAll("img[data-caman]")).length>0){for(r=[],n=0,i=e.length;n<i;n++)t=e[n],r.push(new s(t,function(){return this.parse(),this.execute()}));return r}},r.autoload&&("complete"===document.readyState?r.DOMUpdated():document.addEventListener("DOMContentLoaded",r.DOMUpdated,!1)),s=function(){function t(t,e){this.dataStr=t.getAttribute("data-caman"),this.caman=r(t,e.bind(this))}return t.prototype.parse=function(){var t,e,n,i,r,s,a,o,l,h;if(this.ele=this.caman.canvas,r=new RegExp("(\\w+)\\((.*?)\\)","g"),(s=this.dataStr.match(r)).length>0){for(r=new RegExp("(\\w+)\\((.*?)\\)"),h=[],a=0,o=s.length;a<o;a++){(l=s[a].match(r))[0],e=l[1],t=l[2],i=new Function("return function() {        this."+e+"("+t+");      };");try{n=i(),h.push(n.call(this.caman))}catch(t){h.push(f.debug(t))}}return h}},t.prototype.execute=function(){var t;return t=this.ele,this.caman.render(function(){return t.parentNode.replaceChild(this.toImage(),t)})},t}(),r.Blender=n=function(){function t(){}return t.blenders={},t.register=function(t,e){return this.blenders[t]=e},t.execute=function(t,e,n){return this.blenders[t](e,n)},t}(),r.Calculate=i=function(){function t(){}return t.distance=function(t,e,n,i){return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2))},t.randomRange=function(t,e,n){var i;return null==n&&(n=!1),i=t+Math.random()*(e-t),n?i.toFixed(n):Math.round(i)},t.luminance=function(t){return.299*t.r+.587*t.g+.114*t.b},t.bezier=function(t,e,n,i,r,s){var a,o,l,h,c,u,d,p,f,g,m,v,_,y,x,b,w,S,M,T,E,C,A,R,L,P,k;for(x=t[0],M=t[1],b=e[0],T=e[1],w=n[0],E=n[1],S=i[0],C=i[1],d={},a=S-x-(c=parseInt(3*(b-x),10))-(l=3*(w-b)-c),o=C-M-(u=3*(T-M))-(h=3*(E-T)-u),g=A=0;A<1e3;g=++A)y=g/1e3,p=Math.round(a*Math.pow(y,3)+l*Math.pow(y,2)+c*y+x),f=Math.round(o*Math.pow(y,3)+h*Math.pow(y,2)+u*y+M),r&&f<r?f=r:s&&f>s&&(f=s),d[p]=f;if(d.length<i[0]+1)for(g=R=0,P=i[0];0<=P?R<=P:R>=P;g=0<=P?++R:--R)if(null==d[g]){for(v=[g-1,d[g-1]],m=L=g,k=i[0];g<=k?L<=k:L>=k;m=g<=k?++L:--L)if(null!=d[m]){_=[m,d[m]];break}d[g]=v[1]+(_[1]-v[1])/(_[0]-v[0])*(g-v[0])}return null==d[i[0]]&&(d[i[0]]=d[i[0]-1]),d},t}(),o=function(){function t(){}return t.hexToRGB=function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}},t.rgbToHSL=function(t,e,n){var i,r,s,a,o,l;return"object"==typeof t&&(e=t.g,n=t.b,t=t.r),t/=255,e/=255,n/=255,a=Math.max(t,e,n),o=Math.min(t,e,n),s=(a+o)/2,a===o?r=l=0:(i=a-o,l=s>.5?i/(2-a-o):i/(a+o),r=function(){switch(a){case t:return(e-n)/i+(e<n?6:0);case e:return(n-t)/i+2;case n:return(t-e)/i+4}}(),r/=6),{h:r,s:l,l:s}},t.hslToRGB=function(t,e,n){var i,r,s,a,o;return"object"==typeof t&&(e=t.s,n=t.l,t=t.h),0===e?o=r=i=n:(s=2*n-(a=n<.5?n*(1+e):n+e-n*e),o=this.hueToRGB(s,a,t+1/3),r=this.hueToRGB(s,a,t),i=this.hueToRGB(s,a,t-1/3)),{r:255*o,g:255*r,b:255*i}},t.hueToRGB=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},t.rgbToHSV=function(t,e,n){var i,r,s,a,o,l;return t/=255,e/=255,n/=255,s=Math.max(t,e,n),a=Math.min(t,e,n),l=s,i=s-a,o=0===s?0:i/s,s===a?r=0:(r=function(){switch(s){case t:return(e-n)/i+(e<n?6:0);case e:return(n-t)/i+2;case n:return(t-e)/i+4}}(),r/=6),{h:r,s:o,v:l}},t.hsvToRGB=function(t,e,n){var i,r,s,a,o,l,h,c;switch(o=n*(1-e),l=n*(1-(r=6*t-(a=Math.floor(6*t)))*e),c=n*(1-(1-r)*e),a%6){case 0:h=n,s=c,i=o;break;case 1:h=l,s=n,i=o;break;case 2:h=o,s=n,i=c;break;case 3:h=o,s=l,i=n;break;case 4:h=c,s=o,i=n;break;case 5:h=n,s=o,i=l}return{r:255*h,g:255*s,b:255*i}},t.rgbToXYZ=function(t,e,n){return e/=255,n/=255,(t/=255)>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,{x:100*(.4124*t+.3576*e+.1805*n),y:100*(.2126*t+.7152*e+.0722*n),z:100*(.0193*t+.1192*e+.9505*n)}},t.xyzToRGB=function(t,e,n){var i,r,s;return r=-.9689*(t/=100)+1.8758*(e/=100)+.0415*(n/=100),i=.0557*t+-.204*e+1.057*n,(s=3.2406*t+-1.5372*e+-.4986*n)>.0031308?s=1.055*Math.pow(s,.4166666667)-.055:s*=12.92,r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,i>.0031308?i=1.055*Math.pow(i,.4166666667)-.055:i*=12.92,{r:255*s,g:255*r,b:255*i}},t.xyzToLab=function(t,e,n){return"object"==typeof t&&(e=t.y,n=t.z,t=t.x),e/=100,n/=108.883,t=(t/=95.047)>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345,{l:116*(e=e>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345)-16,a:500*(t-e),b:200*(e-(n=n>.008856451679?Math.pow(n,.3333333333):7.787037037*n+.1379310345))}},t.labToXYZ=function(t,e,n){var i,r,s;return"object"==typeof t&&(e=t.a,n=t.b,t=t.l),s=(r=(t+16)/116)-n/200,(i=r+e/500)>.2068965517?i*=i*i:i=.1284185493*(i-.1379310345),r>.2068965517?r*=r*r:r=.1284185493*(r-.1379310345),s>.2068965517?s*=s*s:s=.1284185493*(s-.1379310345),{x:95.047*i,y:100*r,z:108.883*s}},t.rgbToLab=function(t,e,n){var i;return"object"==typeof t&&(e=t.g,n=t.b,t=t.r),i=this.rgbToXYZ(t,e,n),this.xyzToLab(i)},t.labToRGB=function(t,e,n){},t}(),l=function(){function t(){}return t.events={},t.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],t.trigger=function(t,e,n){var i,r,s,a,o;if(this.events[e]&&this.events[e].length){for(o=[],r=0,s=(a=this.events[e]).length;r<s;r++)null===(i=a[r]).target||t.id===i.target.id?o.push(i.fn.call(t,n)):o.push(void 0);return o}},t.listen=function(t,e,n){var i,r;return"string"==typeof t&&(r=t,i=e,t=null,e=r,n=i),!(P.call(this.types,e)<0||(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:n}),0))},t}(),r.Event=l,r.Filter=c=function(){function t(){}return t.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},t.register=function(t,e){return r.prototype[t]=e},t}(),r.IO=u=function(){function t(){}return t.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,t.isRemote=function(t){return null!=t&&!this.corsEnabled(t)&&this.isURLRemote(t.src)},t.corsEnabled=function(t){var e;return null!=t.crossOrigin&&("anonymous"===(e=t.crossOrigin.toLowerCase())||"use-credentials"===e)},t.isURLRemote=function(t){var e;return!!(e=t.match(this.domainRegex))&&e[1]!==document.domain},t.remoteCheck=function(t){if(this.isURLRemote(t)){if(r.remoteProxy.length)return r.isURLRemote(r.remoteProxy)?void g.info("Cannot use a remote proxy for loading images."):r.remoteProxy+"?camanProxyUrl="+encodeURIComponent(t);g.info("Attempting to load a remote image without a configured proxy. URL: "+t)}},t.proxyUrl=function(t){return r.remoteProxy+"?"+r.proxyParam+"="+encodeURIComponent(t)},t.useProxy=function(t){var e;return null!=(e={ruby:"rb",python:"py",perl:"pl",javascript:"js"})[t=t.toLowerCase()]&&(t=e[t]),"proxies/caman_proxy."+t},t}(),r.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},r.prototype.browserSave=function(t){var e;return null==t&&(t="png"),t=t.toLowerCase(),e=this.toBase64(t).replace("image/"+t,"image/octet-stream"),document.location.href=e},r.prototype.nodeSave=function(t,e){null==e&&(e=!0);try{if(w.statSync(t).isFile()&&!e)return!1}catch(e){f.debug("Creating output file "+t)}return w.writeFile(t,this.canvas.toBuffer(),function(){return f.debug("Finished writing to "+t)})},r.prototype.toImage=function(t){var e;return(e=document.createElement("img")).src=this.toBase64(t),e.width=this.dimensions.width,e.height=this.dimensions.height,window.devicePixelRatio&&(e.width/=window.devicePixelRatio,e.height/=window.devicePixelRatio),e},r.prototype.toBase64=function(t){return null==t&&(t="png"),t=t.toLowerCase(),this.canvas.toDataURL("image/"+t)},p=function(){function e(t){this.c=t,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=b.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new a:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return e.prototype.newLayer=function(t){return this.c.newLayer.call(this.c,t)},e.prototype.setBlendingMode=function(t){return this.options.blendingMode=t,this},e.prototype.opacity=function(t){return this.options.opacity=t/100,this},e.prototype.copyParent=function(){var t,e,n,i;for(e=this.c.pixelData,t=n=0,i=this.c.pixelData.length;n<i;t=n+=4)this.pixelData[t]=e[t],this.pixelData[t+1]=e[t+1],this.pixelData[t+2]=e[t+2],this.pixelData[t+3]=e[t+3];return this},e.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},e.prototype.overlayImage=function(e){return"object"==typeof e?e=e.src:"string"==typeof e&&"#"===e[0]&&(e=t(e).src),e?(this.c.renderer.renderQueue.push({type:c.Type.LoadOverlay,src:e,layer:this}),this):this},e.prototype.applyToParent=function(){var t,e,i,r,s,a,o,l,h;for(i=this.c.pixelStack[this.c.pixelStack.length-1],h=[],t=o=0,l=(e=this.c.pixelData).length;o<l;t=o+=4)a={r:i[t],g:i[t+1],b:i[t+2],a:i[t+3]},s={r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]},(r=n.execute(this.options.blendingMode,s,a)).r=b.clampRGB(r.r),r.g=b.clampRGB(r.g),r.b=b.clampRGB(r.b),null==r.a&&(r.a=s.a),i[t]=a.r-(a.r-r.r)*(this.options.opacity*(r.a/255)),i[t+1]=a.g-(a.g-r.g)*(this.options.opacity*(r.a/255)),h.push(i[t+2]=a.b-(a.b-r.b)*(this.options.opacity*(r.a/255)));return h},e}(),f=new(g=function(){var t,e,n,i;for(e=0,n=(i=["log","info","warn","error"]).length;e<n;e++)this[t=i[e]]=function(t){return function(){var e;if(e=1<=arguments.length?k.call(arguments,0):[],r.DEBUG)try{return console[t].apply(console,e)}catch(n){return console[t](e)}}}(t);this.debug=this.log}),m=function(){function t(t){this.c=t,this.loc=0}return t.coordinatesToLocation=function(t,e,n){return 4*(e*n+t)},t.locationToCoordinates=function(t,e){return{x:t%(4*e)/4,y:Math.floor(t/(4*e))}},t.prototype.locationXY=function(){var t;return t=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),{x:this.loc%(4*this.c.dimensions.width)/4,y:t}},t.prototype.getPixelRelative=function(t,e){var n;return(n=this.loc+4*this.c.dimensions.width*(-1*e)+4*t)>this.c.pixelData.length||n<0?{r:0,g:0,b:0,a:0}:{r:this.c.pixelData[n],g:this.c.pixelData[n+1],b:this.c.pixelData[n+2],a:this.c.pixelData[n+3]}},t.prototype.putPixelRelative=function(t,e,n){if(this.loc,this.c.dimensions.width,!(newLoc>this.c.pixelData.length||newLoc<0))return this.c.pixelData[newLoc]=n.r,this.c.pixelData[newLoc+1]=n.g,this.c.pixelData[newLoc+2]=n.b,this.c.pixelData[newLoc+3]=n.a,!0},t.prototype.getPixel=function(t,e){var n;return n=this.coordinatesToLocation(t,e,this.width),{r:this.c.pixelData[n],g:this.c.pixelData[n+1],b:this.c.pixelData[n+2],a:this.c.pixelData[n+3]}},t.prototype.putPixel=function(t,e,n){var i;return i=this.coordinatesToLocation(t,e,this.width),this.c.pixelData[i]=n.r,this.c.pixelData[i+1]=n.g,this.c.pixelData[i+2]=n.b,this.c.pixelData[i+3]=n.a},t}(),v=function(){function t(){}return t.plugins={},t.register=function(t,e){return this.plugins[t]=e},t.execute=function(t,e,n){return this.plugins[e].apply(t,n)},t}(),r.Plugin=v,r.Renderer=_=function(){function t(e){var n=this;this.c=e,this.processNext=function(){return t.prototype.processNext.apply(n,arguments)},this.renderQueue=[],this.modPixelData=null}return t.Blocks=r.NodeJS?require("os").cpus().length:4,t.prototype.add=function(t){if(null!=t)return this.renderQueue.push(t)},t.prototype.processNext=function(){var t;if(0===this.renderQueue.length)return l.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case c.Type.LayerDequeue:return t=this.c.canvasQueue.shift(),this.c.executeLayer(t),this.processNext();case c.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case c.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case c.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},t.prototype.execute=function(t){return this.finishedFn=t,this.modPixelData=b.dataArray(this.c.pixelData.length),this.processNext()},t.prototype.eachBlock=function(e){var n,i,s,a,o,l,c,u,d,p,f=this;for(this.blocksDone=0,l=this.c.pixelData.length,o=(n=4*Math.floor(l/4/t.Blocks))+l/4%t.Blocks*4,p=[],a=u=0,d=t.Blocks;0<=d?u<d:u>d;a=0<=d?++u:--u)s=(c=a*n)+(a===t.Blocks-1?o:n),r.NodeJS?(i=h(function(){return e.call(f,a,c,s)}).run(),p.push(this.blockFinished(i))):p.push(setTimeout(function(t,n,i){return function(){return e.call(f,t,n,i)}}(a,c,s),0));return p},t.prototype.executeFilter=function(){return l.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===c.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},t.prototype.executePlugin=function(){return f.debug("Executing plugin "+this.currentJob.plugin),v.execute(this.c,this.currentJob.plugin,this.currentJob.args),f.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},t.prototype.renderBlock=function(e,n,i){var s,a,o,c,u;for(f.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+n+", End: "+i),l.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:t.Blocks,startPixel:n,endPixel:i}),s={r:0,g:0,b:0,a:0},o=new m(this.c),a=u=n;u<i;a=u+=4)o.loc=a,s.r=this.c.pixelData[a],s.g=this.c.pixelData[a+1],s.b=this.c.pixelData[a+2],s.a=this.c.pixelData[a+3],null==(c=this.currentJob.processFn.call(o,s)).a&&(c.a=s.a),this.c.pixelData[a]=b.clampRGB(c.r),this.c.pixelData[a+1]=b.clampRGB(c.g),this.c.pixelData[a+2]=b.clampRGB(c.b),this.c.pixelData[a+3]=b.clampRGB(c.a);return r.NodeJS?h.yield(e):this.blockFinished(e)},t.prototype.renderKernel=function(t,e,n){var i,s,a,o,l,c,u,d,p,g,v,_,y,x,w,S,M;for(this.currentJob.name,a=this.currentJob.bias,c=this.currentJob.divisor,v=this.c.pixelData.length,i=this.currentJob.adjust,s=Math.sqrt(i.length),g=[],f.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((s-1)/2)),n=Math.min(n,v-4*this.c.dimensions.width*((s-1)/2)),o=(s-1)/2,y=new m(this.c),u=w=e;w<n;u=w+=4){for(y.loc=u,l=0,d=S=-o;-o<=o?S<=o:S>=o;d=-o<=o?++S:--S)for(p=M=o;o<=-o?M<=-o:M>=-o;p=o<=-o?++M:--M)_=y.getPixelRelative(d,p),g[3*l]=_.r,g[3*l+1]=_.g,g[3*l+2]=_.b,l++;x=this.processKernel(i,g,c,a),this.modPixelData[u]=b.clampRGB(x.r),this.modPixelData[u+1]=b.clampRGB(x.g),this.modPixelData[u+2]=b.clampRGB(x.b),this.modPixelData[u+3]=this.c.pixelData[u+3]}return r.NodeJS?h.yield(t):this.blockFinished(t)},t.prototype.blockFinished=function(e){var n,i,r;if(e>=0&&f.debug("Block #"+e+" finished! Filter: "+this.currentJob.name),this.blocksDone++,l.trigger(this.c,"blockFinished",{blockNum:e,blocksFinished:this.blocksDone,totalBlocks:t.Blocks}),this.blocksDone===t.Blocks){if(this.currentJob.type===c.Type.Kernel)for(n=i=0,r=this.c.pixelData.length;0<=r?i<r:i>r;n=0<=r?++i:--i)this.c.pixelData[n]=this.modPixelData[n];return e>=0&&f.debug("Filter "+this.currentJob.name+" finished!"),l.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},t.prototype.processKernel=function(t,e,n,i){var r,s,a,o;for(s={r:0,g:0,b:0},r=a=0,o=t.length;0<=o?a<o:a>o;r=0<=o?++a:--a)s.r+=t[r]*e[3*r],s.g+=t[r]*e[3*r+1],s.b+=t[r]*e[3*r+2];return s.r=s.r/n+i,s.g=s.g/n+i,s.b=s.b/n+i,s},t.prototype.loadOverlay=function(t,e){var n,i,r=this;return(n=document.createElement("img")).onload=function(){return t.context.drawImage(n,0,0,r.c.dimensions.width,r.c.dimensions.height),t.imageData=t.context.getImageData(0,0,r.c.dimensions.width,r.c.dimensions.height),t.pixelData=t.imageData.data,r.c.pixelData=t.pixelData,r.processNext()},i=u.remoteCheck(e),n.src=null!=i?i:e},t}(),r.Store=x=function(){function t(){}return t.items={},t.has=function(t){return null!=this.items[t]},t.get=function(t){return this.items[t]},t.put=function(t,e){return this.items[t]=e},t.execute=function(t,e){var n=this;return setTimeout(function(){return e.call(n.get(t),n.get(t))},0),this.get(t)},t.flush=function(t){return null==t&&(t=!1),t?delete this.items[t]:this.items={}},t}(),n.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),n.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),n.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),n.register("overlay",function(t,e){var n;return(n={}).r=e.r>128?255-2*(255-t.r)*(255-e.r)/255:e.r*t.r*2/255,n.g=e.g>128?255-2*(255-t.g)*(255-e.g)/255:e.g*t.g*2/255,n.b=e.b>128?255-2*(255-t.b)*(255-e.b)/255:e.b*t.b*2/255,n}),n.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),n.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),n.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),n.register("softLight",function(t,e){var n;return(n={}).r=e.r>128?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,n.g=e.g>128?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,n.b=e.b>128?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,n}),n.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),n.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}}),c.register("fillColor",function(){var t;return t=1===arguments.length?o.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(e){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=255,e})}),c.register("brightness",function(t){return t=Math.floor(t/100*255),this.process("brightness",function(e){return e.r+=t,e.g+=t,e.b+=t,e})}),c.register("saturation",function(t){return t*=-.01,this.process("saturation",function(e){var n;return n=Math.max(e.r,e.g,e.b),e.r!==n&&(e.r+=(n-e.r)*t),e.g!==n&&(e.g+=(n-e.g)*t),e.b!==n&&(e.b+=(n-e.b)*t),e})}),c.register("vibrance",function(t){return t*=-1,this.process("vibrance",function(e){var n,i,r;return r=Math.max(e.r,e.g,e.b),i=(e.r+e.g+e.b)/3,n=2*Math.abs(r-i)/255*t/100,e.r!==r&&(e.r+=(r-e.r)*n),e.g!==r&&(e.g+=(r-e.g)*n),e.b!==r&&(e.b+=(r-e.b)*n),e})}),c.register("greyscale",function(t){return this.process("greyscale",function(t){var e;return e=i.luminance(t),t.r=e,t.g=e,t.b=e,t})}),c.register("contrast",function(t){return t=Math.pow((t+100)/100,2),this.process("contrast",function(e){return e.r/=255,e.r-=.5,e.r*=t,e.r+=.5,e.r*=255,e.g/=255,e.g-=.5,e.g*=t,e.g+=.5,e.g*=255,e.b/=255,e.b-=.5,e.b*=t,e.b+=.5,e.b*=255,e})}),c.register("hue",function(t){return this.process("hue",function(e){var n,i,r;return n=100*(i=o.rgbToHSV(e.r,e.g,e.b)).h,n+=Math.abs(t),n%=100,n/=100,i.h=n,(r=o.hsvToRGB(i.h,i.s,i.v)).a=e.a,r})}),c.register("colorize",function(){var t,e;return 2===arguments.length?(e=o.hexToRGB(arguments[0]),t=arguments[1]):4===arguments.length&&(e={r:arguments[0],g:arguments[1],b:arguments[2]},t=arguments[3]),this.process("colorize",function(n){return n.r-=(n.r-e.r)*(t/100),n.g-=(n.g-e.g)*(t/100),n.b-=(n.b-e.b)*(t/100),n})}),c.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),c.register("sepia",function(t){return null==t&&(t=100),t/=100,this.process("sepia",function(e){return e.r=Math.min(255,e.r*(1-.607*t)+e.g*(.769*t)+e.b*(.189*t)),e.g=Math.min(255,e.r*(.349*t)+e.g*(1-.314*t)+e.b*(.168*t)),e.b=Math.min(255,e.r*(.272*t)+e.g*(.534*t)+e.b*(1-.869*t)),e})}),c.register("gamma",function(t){return this.process("gamma",function(e){return e.r=255*Math.pow(e.r/255,t),e.g=255*Math.pow(e.g/255,t),e.b=255*Math.pow(e.b/255,t),e})}),c.register("noise",function(t){return t=2.55*Math.abs(t),this.process("noise",function(e){var n;return n=i.randomRange(-1*t,t),e.r+=n,e.g+=n,e.b+=n,e})}),c.register("clip",function(t){return t=2.55*Math.abs(t),this.process("clip",function(e){return e.r>255-t?e.r=255:e.r<t&&(e.r=0),e.g>255-t?e.g=255:e.g<t&&(e.g=0),e.b>255-t?e.b=255:e.b<t&&(e.b=0),e})}),c.register("channels",function(t){var e;if("object"!=typeof t)return this;for(e in t)L.call(t,e)&&(0!==t[e]?t[e]/=100:delete t[e]);return 0===t.length?this:this.process("channels",function(e){return null!=t.red&&(t.red>0?e.r+=(255-e.r)*t.red:e.r-=e.r*Math.abs(t.red)),null!=t.green&&(t.green>0?e.g+=(255-e.g)*t.green:e.g-=e.g*Math.abs(t.green)),null!=t.blue&&(t.blue>0?e.b+=(255-e.b)*t.blue:e.b-=e.b*Math.abs(t.blue)),e})}),c.register("curves",function(){var t,e,n,r,s,a,o,l,h,c,u,d;if(e=arguments[0],n=2<=arguments.length?k.call(arguments,1):[],"string"==typeof e&&(e=e.split("")),"v"===e[0]&&(e=["r","g","b"]),n.length<3||n.length>4)throw"Invalid number of arguments to curves filter";if(l=n[0],r=n[1],s=4===n.length?n[2]:n[1],a=n[n.length-1],t=i.bezier(l,r,s,a,0,255),l[0]>0)for(o=h=0,u=l[0];0<=u?h<u:h>u;o=0<=u?++h:--h)t[o]=l[1];if(a[0]<255)for(o=c=d=a[0];d<=255?c<=255:c>=255;o=d<=255?++c:--c)t[o]=a[1];return this.process("curves",function(n){var i,r;for(o=i=0,r=e.length;0<=r?i<r:i>r;o=0<=r?++i:--i)n[e[o]]=t[n[e[o]]];return n})}),c.register("exposure",function(t){var e,n,i;return e=[0,255*(i=Math.abs(t)/100)],n=[255-255*i,255],t<0&&(e=e.reverse(),n=n.reverse()),this.curves("rgb",[0,0],e,n,[255,255])}),r.Plugin.register("crop",function(t,e,n,i){var r;return null==n&&(n=0),null==i&&(i=0),"undefined"!=typeof exports&&null!==exports?r=new a(t,e):(r=document.createElement("canvas"),b.copyAttributes(this.canvas,r),r.width=t,r.height=e),r.getContext("2d").drawImage(this.canvas,n,i,t,e,0,0,t,e),this.cropCoordinates={x:n,y:i},this.cropped=!0,this.replaceCanvas(r)}),r.Plugin.register("resize",function(t){var e;if(null==t&&(t=null),null!==t&&(null!=t.width||null!=t.height))return null==t.width?t.width=this.canvas.width*t.height/this.canvas.height:null==t.height&&(t.height=this.canvas.height*t.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?e=new a(t.width,t.height):(e=document.createElement("canvas"),b.copyAttributes(this.canvas,e),e.width=t.width,e.height=t.height),e.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,t.width,t.height),this.resized=!0,this.replaceCanvas(e);f.error("Invalid or missing dimensions given for resize")}),r.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),r.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),r.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),r.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),r.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),r.Filter.register("motionBlur",function(t){var e;return e=0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:t>0&&t<90||t>180&&t<270?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",e)}),r.Filter.register("sharpen",function(t){return null==t&&(t=100),t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])}),M={brightness:function(t,e,n){return t.r=t.r-t.r*e*n.strength,t.g=t.g-t.g*e*n.strength,t.b=t.b-t.b*e*n.strength,t},gamma:function(t,e,n){return t.r=255*Math.pow(t.r/255,Math.max(10*e*n.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*n.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*n.strength,1)),t},colorize:function(t,e,n){return t.r-=(t.r-n.color.r)*e,t.g-=(t.g-n.color.g)*e,t.b-=(t.b-n.color.b)*e,t}},c.register("vignette",function(t,e){var n,r,s,a;return null==e&&(e=60),"string"==typeof t&&"%"===t.substr(-1)&&(t=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(t.substr(0,t.length-1),10)/100):this.dimensions.height*(parseInt(t.substr(0,t.length-1),10)/100)),e/=100,r=[this.dimensions.width/2,this.dimensions.height/2],a=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)),s=a-t,n=i.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(a){var o,l,h;return h=this.locationXY(),(o=i.distance(h.x,h.y,r[0],r[1]))>s&&(l=Math.max(1,n[Math.round((o-s)/t*100)]/10*e),a.r=255*Math.pow(a.r/255,l),a.g=255*Math.pow(a.g/255,l),a.b=255*Math.pow(a.b/255,l)),a})}),c.register("rectangularVignette",function(t){var e,n,s,a,l,h,c;if(e={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},!(t=b.extend(e,t)).size)return this;if("string"==typeof t.size)s=parseInt(t.size,10)/100,t.size={width:this.dimensions.width*s,height:this.dimensions.height*s};else if("object"==typeof t.size)for(l=0,h=(c=["width","height"]).length;l<h;l++)n=c[l],"string"==typeof t.size[n]&&(t.size[n]=this.dimensions[n]*(parseInt(t.size[n],10)/100));else"number"===t.size&&(a=t.size,t.size={width:a,height:a});return"string"==typeof t.cornerRadius&&(t.cornerRadius=t.size.width/2*(parseInt(t.cornerRadius,10)/100)),t.strength/=100,t.size.width=Math.floor(t.size.width),t.size.height=Math.floor(t.size.height),t.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===t.method&&"string"==typeof t.color&&(t.color=o.hexToRGB(t.color)),t.coords={left:(this.dimensions.width-t.size.width)/2,right:this.dimensions.width-t.coords.left,bottom:(this.dimensions.height-t.size.height)/2,top:this.dimensions.height-t.coords.bottom},t.corners=[{x:t.coords.left+t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.bottom+t.cornerRadius},{x:t.coords.left+t.cornerRadius,y:t.coords.bottom+t.cornerRadius}],t.maxDist=i.distance(0,0,t.corners[3].x,t.corners[3].y)-t.cornerRadius,this.process("rectangularVignette",function(e){var n,i;return(i=this.locationXY()).x>t.corners[0].x&&i.x<t.corners[1].x&&i.y>t.coords.bottom&&i.y<t.coords.top?e:i.x>t.coords.left&&i.x<t.coords.right&&i.y>t.corners[3].y&&i.y<t.corners[2].y?e:(i.x>t.corners[0].x&&i.x<t.corners[1].x&&i.y>t.coords.top?n=(i.y-t.coords.top)/t.maxDist:i.y>t.corners[2].y&&i.y<t.corners[1].y&&i.x>t.coords.right?n=(i.x-t.coords.right)/t.maxDist:i.x>t.corners[0].x&&i.x<t.corners[1].x&&i.y<t.coords.bottom?n=(t.coords.bottom-i.y)/t.maxDist:i.y>t.corners[2].y&&i.y<t.corners[1].y&&i.x<t.coords.left?n=(t.coords.left-i.x)/t.maxDist:i.x<=t.corners[0].x&&i.y>=t.corners[0].y?n=(r.distance(i.x,i.y,t.corners[0].x,t.corners[0].y)-t.cornerRadius)/t.maxDist:i.x>=t.corners[1].x&&i.y>=t.corners[1].y?n=(r.distance(i.x,i.y,t.corners[1].x,t.corners[1].y)-t.cornerRadius)/t.maxDist:i.x>=t.corners[2].x&&i.y<=t.corners[2].y?n=(r.distance(i.x,i.y,t.corners[2].x,t.corners[2].y)-t.cornerRadius)/t.maxDist:i.x<=t.corners[3].x&&i.y<=t.corners[3].y&&(n=(r.distance(i.x,i.y,t.corners[3].x,t.corners[3].y)-t.cornerRadius)/t.maxDist),n<0?e:M[t.method](e,n,t))})}),A=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],R=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],E=function(t,e,n,i,r,s,o){var l,h,c,u,d,p,f;return(l="undefined"!=typeof exports&&null!==exports?new a:document.createElement("canvas")).width=t,l.height=e,u=n+Math.cos(r)*s*.5,p=i+Math.sin(r)*s*.5,d=n-Math.cos(r)*s*.5,f=i-Math.sin(r)*s*.5,c=(h=l.getContext("2d")).createLinearGradient(u,p,d,f),o?(c.addColorStop(0,"white"),c.addColorStop(.5,"black"),c.addColorStop(1,"white")):(c.addColorStop(0,"white"),c.addColorStop(1,"black")),h.fillStyle=c,h.fillRect(0,0,t,e),h.getImageData(0,0,t,e)},C=function(t,e,n,i,r,s){var o,l,h;return(o="undefined"!=typeof exports&&null!==exports?new a:document.createElement("canvas")).width=t,o.height=e,(h=(l=o.getContext("2d")).createRadialGradient(n,i,r,n,i,s)).addColorStop(1,"white"),h.addColorStop(0,"black"),l.fillStyle=h,l.fillRect(0,0,t,e),l.getImageData(0,0,t,e)},T=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},r.Plugin.register("compoundBlur",function(t,e,n,i){var r,s,a,o,l,h,c,u,d,p,f,g,m,v,_,y,x,b,w,S,M,E,C,L,P,k,D,I,O,B,F,N,U,z,G,H,W,V,j,X,Y,Z,q,J,K,Q,$,tt,et,nt,it,rt,st,at,ot,lt,ht;for(Y=this.dimensions.width,p=this.dimensions.height,_=this.pixelData,I=t.data,X=(j=Y*p)<<2,C=[],g=tt=0;0<=X?tt<X:tt>X;g=0<=X?++tt:--tt)C[g]=_[g];for(l=0,W=i,i-=1;W-- >=0;)if(0!=(x=e+.5|0)){for(x>256&&(x=256),h=x+x+1,Z=Y-1,f=p-1,V=(O=x+1)*(O+1)/2,U=void 0,N=H=new T,g=et=1;1<=h?et<h:et>h;g=1<=h?++et:--et)N=N.next=new T,g===O&&(U=N);for(N.next=H,z=null,G=null,$=K=0,w=A[x],F=R[x],J=nt=0;0<=p?nt<p:nt>p;J=0<=p?++nt:--nt){for(P=c=r=D=d=a=0,k=O*(L=C[K]),u=O*(E=C[K+1]),s=O*(M=C[K+2]),D+=V*L,d+=V*E,a+=V*M,N=H,g=it=0;0<=O?it<O:it>O;g=0<=O?++it:--it)N.r=L,N.g=E,N.b=M,N=N.next;for(g=rt=1;1<=O?rt<O:rt>O;g=1<=O?++rt:--rt)S=K+((Z<g?Z:g)<<2),D+=(N.r=L=C[S])*(B=O-g),d+=(N.g=E=C[S+1])*B,a+=(N.b=M=C[S+2])*B,P+=L,c+=E,r+=M,N=N.next;for(z=H,G=U,q=st=0;0<=Y?st<Y:st>Y;q=0<=Y?++st:--st)C[K]=D*w>>F,C[K+1]=d*w>>F,C[K+2]=a*w>>F,D-=k,d-=u,a-=s,k-=z.r,u-=z.g,s-=z.b,S=$+((S=q+O)<Z?S:Z)<<2,D+=P+=z.r=C[S],d+=c+=z.g=C[S+1],a+=r+=z.b=C[S+2],z=z.next,k+=L=G.r,u+=E=G.g,s+=M=G.b,P-=L,c-=E,r-=M,G=G.next,K+=4;$+=Y}for(q=at=0;0<=Y?at<Y:at>Y;q=0<=Y?++at:--at){for(c=r=P=d=a=D=0,k=O*(L=C[K=q<<2]),u=O*(E=C[K+1]),s=O*(M=C[K+2]),D+=V*L,d+=V*E,a+=V*M,N=H,g=ot=0;0<=O?ot<O:ot>O;g=0<=O?++ot:--ot)N.r=L,N.g=E,N.b=M,N=N.next;for(Q=Y,g=lt=1;1<=O?lt<O:lt>O;g=1<=O?++lt:--lt)K=Q+q<<2,D+=(N.r=L=C[K])*(B=O-g),d+=(N.g=E=C[K+1])*B,a+=(N.b=M=C[K+2])*B,P+=L,c+=E,r+=M,N=N.next,g<f&&(Q+=Y);for(K=q,z=H,G=U,J=ht=0;0<=p?ht<p:ht>p;J=0<=p?++ht:--ht)C[S=K<<2]=D*w>>F,C[S+1]=d*w>>F,C[S+2]=a*w>>F,D-=k,d-=u,a-=s,k-=z.r,u-=z.g,s-=z.b,S=q+((S=J+O)<f?S:f)*Y<<2,D+=P+=z.r=C[S],d+=c+=z.g=C[S+1],a+=r+=z.b=C[S+2],z=z.next,k+=L=G.r,u+=E=G.g,s+=M=G.b,P-=L,c-=E,r-=M,G=G.next,K+=Y}for(e*=n,g=j;--g>-1;)(y=0|(b=(255&I[2+(v=g<<2)])/255*i))===l?(m=256-(o=256*(b-(0|b))),_[v]=_[v]*m+C[v]*o>>8,_[v+1]=_[v+1]*m+C[v+1]*o>>8,_[v+2]=_[v+2]*m+C[v+2]*o>>8):y===l+1&&(_[v]=C[v],_[v+1]=C[v+1],_[v+2]=C[v+2]);l++}return this}),r.Filter.register("tiltShift",function(t){var e,n;return e={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},(t=b.extend(e,t)).angle*=Math.PI/180,n=E(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.angle,t.focusWidth,!0),this.processPlugin("compoundBlur",[n,t.startRadius,t.radiusFactor,t.steps])}),r.Filter.register("radialBlur",function(t){var e,n,i,r;return e={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},(t=b.extend(e,t)).radius||(t.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),i=t.radius/2-t.size,r=t.radius/2,n=C(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,i,r),this.processPlugin("compoundBlur",[n,t.startRadius,t.radiusFactor,t.steps])}),r.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),r.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),r.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),r.Filter.register("posterize",function(t){var e,n;return e=256/t,n=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*n),t.g=Math.floor(Math.floor(t.g/e)*n),t.b=Math.floor(Math.floor(t.b/e)*n),t})}),r.Filter.register("vintage",function(t){if(null==t&&(t=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t)return this.vignette("40%",30)}),r.Filter.register("lomo",function(t){return null==t&&(t=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),r.Filter.register("clarity",function(t){return null==t&&(t=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),r.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),r.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),r.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),r.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),r.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),r.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),r.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),r.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),r.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),r.Filter.register("glowingSun",function(t){if(null==t&&(t=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t)return this.vignette("45%",20)}),r.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),r.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),r.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),r.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),r.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),function(){var t,e,n;e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],t=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},r.Plugin.register("stackBlur",function(i){var r,s,a,o,l,h,c,u,d,p,f,g,m,v,_,y,x,b,w,S,M,T,E,C,A,R,L,P,k,D,I,O,B,F,N,U,z,G,H,W,V,j,X,Y;if(!(isNaN(i)||i<1)){for(i|=0,_=this.pixelData,o=i+i+1,D=(k=this.dimensions.width)-1,d=(u=this.dimensions.height)-1,P=(S=i+1)*(S+1)/2,E=L=new t,p=U=1;1<=o?U<o:U>o;p=1<=o?++U:--U)E=E.next=new t,p===S&&(C=E);for(E.next=L,A=null,R=null,N=B=0,f=e[i],T=n[i],O=z=0;0<=u?z<u:z>u;O=0<=u?++z:--z){for(x=l=r=w=c=a=0,b=S*(y=_[B]),h=S*(v=_[B+1]),s=S*(m=_[B+2]),w+=P*y,c+=P*v,a+=P*m,E=L,p=G=0;0<=S?G<S:G>S;p=0<=S?++G:--G)E.r=y,E.g=v,E.b=m,E=E.next;for(p=H=1;1<=S?H<S:H>S;p=1<=S?++H:--H)g=B+((D<p?D:p)<<2),w+=(E.r=y=_[g])*(M=S-p),c+=(E.g=v=_[g+1])*M,a+=(E.b=m=_[g+2])*M,x+=y,l+=v,r+=m,E=E.next;for(A=L,R=C,I=W=0;0<=k?W<k:W>k;I=0<=k?++W:--W)_[B]=w*f>>T,_[B+1]=c*f>>T,_[B+2]=a*f>>T,w-=b,c-=h,a-=s,b-=A.r,h-=A.g,s-=A.b,g=N+((g=I+i+1)<D?g:D)<<2,w+=x+=A.r=_[g],c+=l+=A.g=_[g+1],a+=r+=A.b=_[g+2],A=A.next,b+=y=R.r,h+=v=R.g,s+=m=R.b,x-=y,l-=v,r-=m,R=R.next,B+=4;N+=k}for(I=V=0;0<=k?V<k:V>k;I=0<=k?++V:--V){for(l=r=x=c=a=w=0,b=S*(y=_[B=I<<2]),h=S*(v=_[B+1]),s=S*(m=_[B+2]),w+=P*y,c+=P*v,a+=P*m,E=L,p=j=0;0<=S?j<S:j>S;p=0<=S?++j:--j)E.r=y,E.g=v,E.b=m,E=E.next;for(F=k,p=X=1;1<=i?X<=i:X>=i;p=1<=i?++X:--X)B=F+I<<2,w+=(E.r=y=_[B])*(M=S-p),c+=(E.g=v=_[B+1])*M,a+=(E.b=m=_[B+2])*M,x+=y,l+=v,r+=m,E=E.next,p<d&&(F+=k);for(B=I,A=L,R=C,O=Y=0;0<=u?Y<u:Y>u;O=0<=u?++Y:--Y)_[g=B<<2]=w*f>>T,_[g+1]=c*f>>T,_[g+2]=a*f>>T,w-=b,c-=h,a-=s,b-=A.r,h-=A.g,s-=A.b,g=I+((g=O+S)<d?g:d)*k<<2,w+=x+=A.r=_[g],c+=l+=A.g=_[g+1],a+=r+=A.b=_[g+2],A=A.next,b+=y=R.r,h+=v=R.g,s+=m=R.b,x-=y,l-=v,r-=m,R=R.next,B+=k}return this}}),r.Filter.register("stackBlur",function(t){return this.processPlugin("stackBlur",[t])})}(),r.Filter.register("threshold",function(t){return this.process("threshold",function(e){return.2126*e.r+.7152*e.g+.0722*e.b<t?(e.r=0,e.g=0,e.b=0):(e.r=255,e.g=255,e.b=255),e})})}.call(this),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function t(e,n,i){function r(a,o){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){return r(e[a][1][t]||t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){"use strict";var i=t("./utils"),r=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,r,a,o,l,h,c=[],u=0,d=t.length,p=d,f="string"!==i.getTypeOf(t);u<t.length;)p=d-u,r=f?(e=t[u++],n=u<d?t[u++]:0,u<d?t[u++]:0):(e=t.charCodeAt(u++),n=u<d?t.charCodeAt(u++):0,u<d?t.charCodeAt(u++):0),a=e>>2,o=(3&e)<<4|n>>4,l=1<p?(15&n)<<2|r>>6:64,h=2<p?63&r:64,c.push(s.charAt(a)+s.charAt(o)+s.charAt(l)+s.charAt(h));return c.join("")},n.decode=function(t){var e,n,i,a,o,l,h=0,c=0,u="data:";if(t.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var d,p=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===s.charAt(64)&&p--,t.charAt(t.length-2)===s.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=r.uint8array?new Uint8Array(0|p):new Array(0|p);h<t.length;)e=s.indexOf(t.charAt(h++))<<2|(a=s.indexOf(t.charAt(h++)))>>4,n=(15&a)<<4|(o=s.indexOf(t.charAt(h++)))>>2,i=(3&o)<<6|(l=s.indexOf(t.charAt(h++))),d[c++]=e,64!==o&&(d[c++]=n),64!==l&&(d[c++]=i);return d}},{"./support":30,"./utils":32}],2:[function(t,e,n){"use strict";var i=t("./external"),r=t("./stream/DataWorker"),s=t("./stream/DataLengthProbe"),a=t("./stream/Crc32Probe");function o(t,e,n,i,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=i,this.compressedContent=r}s=t("./stream/DataLengthProbe"),o.prototype={getContentWorker:function(){var t=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,n){return t.pipe(new a).pipe(new s("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var i=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(t){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){"use strict";var i=t("./utils"),r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==i.getTypeOf(t)?function(t,e,n,i){var s=r,a=0+n;t^=-1;for(var o=0;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}(0|e,t,t.length):function(t,e,n,i){var s=r,a=0+n;t^=-1;for(var o=0;o<a;o++)t=t>>>8^s[255&(t^e.charCodeAt(o))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){"use strict";var i;i="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:i}},{lie:37}],7:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),s=t("./utils"),a=t("./stream/GenericWorker"),o=i?"uint8array":"array";function l(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}n.magic="\b\0",s.inherits(l,a),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,t.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(t){return new l("Deflate",t)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){"use strict";function i(t,e){var n,i="";for(n=0;n<e;n++)i+=String.fromCharCode(255&t),t>>>=8;return i}function r(t,e,n,r,a,c){var u,d,p=t.file,f=t.compression,g=c!==o.utf8encode,m=s.transformTo("string",c(p.name)),v=s.transformTo("string",o.utf8encode(p.name)),_=p.comment,y=s.transformTo("string",c(_)),x=s.transformTo("string",o.utf8encode(_)),b=v.length!==p.name.length,w=x.length!==_.length,S="",M="",T="",E=p.dir,C=p.date,A={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(A.crc32=t.crc32,A.compressedSize=t.compressedSize,A.uncompressedSize=t.uncompressedSize);var R=0;e&&(R|=8),g||!b&&!w||(R|=2048);var L=0,P=0;E&&(L|=16),"UNIX"===a?(P=798,L|=function(t,e){var n=t;return t||(n=E?16893:33204),(65535&n)<<16}(p.unixPermissions)):(P=20,L|=63&(p.dosPermissions||0)),u=C.getUTCHours(),u<<=6,u|=C.getUTCMinutes(),u<<=5,u|=C.getUTCSeconds()/2,d=C.getUTCFullYear()-1980,d<<=4,d|=C.getUTCMonth()+1,d<<=5,d|=C.getUTCDate(),b&&(M=i(1,1)+i(l(m),4)+v,S+="up"+i(M.length,2)+M),w&&(T=i(1,1)+i(l(y),4)+x,S+="uc"+i(T.length,2)+T);var k="";return k+="\n\0",k+=i(R,2),k+=f.magic,k+=i(u,2),k+=i(d,2),k+=i(A.crc32,4),k+=i(A.compressedSize,4),k+=i(A.uncompressedSize,4),k+=i(m.length,2),k+=i(S.length,2),{fileRecord:h.LOCAL_FILE_HEADER+k+m+S,dirRecord:h.CENTRAL_FILE_HEADER+i(P,2)+k+i(y.length,2)+"\0\0\0\0"+i(L,4)+i(r,4)+m+S+y}}var s=t("../utils"),a=t("../stream/GenericWorker"),o=t("../utf8"),l=t("../crc32"),h=t("../signature");function c(t,e,n,i){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(c,a),c.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,a.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-i-1))/n:100}}))},c.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=r(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=r(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:function(t){return h.DATA_DESCRIPTOR+i(t.crc32,4)+i(t.compressedSize,4)+i(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=this.bytesWritten-t,r=function(t,e,n,r,a){var o=s.transformTo("string",a(r));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(t,2)+i(t,2)+i(e,4)+i(n,4)+i(o.length,2)+o}(this.dirRecords.length,n,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},c.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(t){var e=this._sources;if(!a.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},c.prototype.lock=function(){a.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var i=t("../compressions"),r=t("./ZipFileWorker");n.generateWorker=function(t,e,n){var s=new r(e.streamFiles,n,e.platform,e.encodeFileName),a=0;try{t.forEach(function(t,n){a++;var r=function(t,e){var n=t||e,r=i[n];if(!r)throw new Error(n+" is not a valid compression method !");return r}(n.options.compression,e.compression),o=n.options.compressionOptions||e.compressionOptions||{},l=n.dir,h=n.date;n._compressWorker(r,o).withStreamInfo("file",{name:t,dir:l,date:h,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(s)}),s.entriesCount=a}catch(t){s.error(t)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new i;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.2.0",i.loadAsync=function(t,e){return(new i).loadAsync(t,e)},i.external=t("./external"),e.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){"use strict";var i=t("./utils"),r=t("./external"),s=t("./utf8"),a=(i=t("./utils"),t("./zipEntries")),o=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function h(t){return new r.Promise(function(e,n){var i=t.decompressed.getContentWorker().pipe(new o);i.on("error",function(t){n(t)}).on("end",function(){i.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var n=this;return e=i.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var n=new a(e);return n.load(t),n}).then(function(t){var n=[r.Promise.resolve(t)],i=t.files;if(e.checkCRC32)for(var s=0;s<i.length;s++)n.push(h(i[s]));return r.Promise.all(n)}).then(function(t){for(var i=t.shift(),r=i.files,s=0;s<r.length;s++){var a=r[s];n.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return i.zipComment.length&&(n.comment=i.zipComment),n})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){"use strict";var i=t("../utils"),r=t("../stream/GenericWorker");function s(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}i.inherits(s,r),s.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},s.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){"use strict";var i=t("readable-stream").Readable;function r(t,e,n){i.call(this,e),this._helper=t;var r=this;t.on("data",function(t,e){r.push(t)||r._helper.pause(),n&&n(e)}).on("error",function(t){r.emit("error",t)}).on("end",function(){r.push(null)})}t("../utils").inherits(r,i),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,n){"use strict";function i(t,e,n){var i,r=s.getTypeOf(e),o=s.extend(n||{},l);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(t=g(t)),o.createFolders&&(i=f(t))&&m.call(this,i,!0);var u,v="string"===r&&!1===o.binary&&!1===o.base64;n&&void 0!==n.binary||(o.binary=!v),(e instanceof h&&0===e.uncompressedSize||o.dir||!e||0===e.length)&&(o.base64=!1,o.binary=!0,e="",o.compression="STORE",r="string"),u=e instanceof h||e instanceof a?e:d.isNode&&d.isStream(e)?new p(t,e):s.prepareContent(t,e,o.binary,o.optimizedBinaryString,o.base64);var _=new c(t,u,o);this.files[t]=_}var r=t("./utf8"),s=t("./utils"),a=t("./stream/GenericWorker"),o=t("./stream/StreamHelper"),l=t("./defaults"),h=t("./compressedObject"),c=t("./zipObject"),u=t("./generate"),d=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},g=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:l.createFolders,t=g(t),this.files[t]||i.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function v(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,i;for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,i))},filter:function(t){var e=[];return this.forEach(function(n,i){t(n,i)&&e.push(i)}),e},file:function(t,e,n){if(1!==arguments.length)return t=this.root+t,i.call(this,t,e,n),this;if(v(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}var s=this.files[this.root+t];return s&&!s.dir?s:null},folder:function(t){if(!t)return this;if(v(t))return this.filter(function(e,n){return n.dir&&t.test(e)});var e=this.root+t,n=m.call(this,e),i=this.clone();return i.root=n.name,i},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter(function(e,n){return n.name.slice(0,t.length)===t}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=s.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");s.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var i=n.comment||this.comment||"";e=u.generateWorker(this,n,i)}catch(t){(e=new a("error")).error(t)}return new o(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){"use strict";var i=t("./DataReader");function r(t){i.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,i),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),r=t.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===e&&this.data[s+1]===n&&this.data[s+2]===i&&this.data[s+3]===r)return s-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),r=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&n===s[1]&&i===s[2]&&r===s[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){"use strict";var i=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,n){"use strict";var i=t("./Uint8ArrayReader");function r(t){i.call(this,t)}t("../utils").inherits(r,i),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){"use strict";var i=t("./DataReader");function r(t){i.call(this,t)}t("../utils").inherits(r,i),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){"use strict";var i=t("./ArrayReader");function r(t){i.call(this,t)}t("../utils").inherits(r,i),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){"use strict";var i=t("../utils"),r=t("../support"),s=t("./ArrayReader"),a=t("./StringReader"),o=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=i.getTypeOf(t);return i.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new o(t):r.uint8array?new l(i.transformTo("uint8array",t)):new s(i.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,n){"use strict";var i=t("./GenericWorker"),r=t("../utils");function s(t){i.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(s,i),s.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){"use strict";var i=t("./GenericWorker"),r=t("../crc32");function s(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(s,i),s.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){"use strict";var i=t("../utils"),r=t("./GenericWorker");function s(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}i.inherits(s,r),s.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){"use strict";var i=t("../utils"),r=t("./GenericWorker");function s(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=i.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}i.inherits(s,r),s.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){"use strict";function i(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=i},{}],29:[function(t,e,n){"use strict";var i=t("../utils"),r=t("./ConvertWorker"),s=t("./GenericWorker"),a=t("../base64"),o=t("../support"),l=t("../external"),h=null;if(o.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function c(t,e,n){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=e,this._mimeType=n,i.checkSupport(a),this._worker=t.pipe(new r(a)),t.lock()}catch(t){this._worker=new s("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return function(t,e){return new l.Promise(function(n,r){var s=[],o=t._internalType,l=t._outputType,h=t._mimeType;t.on("data",function(t,n){s.push(t),e&&e(n)}).on("error",function(t){s=[],r(t)}).on("end",function(){try{var t=function(t,e,n){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),n);case"base64":return a.encode(e);default:return i.transformTo(t,e)}}(l,function(t,e){var n,i=0,r=null,s=0;for(n=0;n<e.length;n++)s+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(s),n=0;n<e.length;n++)r.set(e[n],i),i+=e[n].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,s),h);n(t)}catch(t){r(t)}s=[]}).resume()})}(this,t)},on:function(t,e){var n=this;return"data"===t?this._worker.on(t,function(t){e.call(n,t.data,t.meta)}):this._worker.on(t,function(){i.delay(e,arguments,n)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),n.blob=0===r.getBlob("application/zip").size}catch(t){n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch(t){n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";for(var i=t("./utils"),r=t("./support"),s=t("./nodejsUtils"),a=t("./stream/GenericWorker"),o=new Array(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function h(){a.call(this,"utf-8 decode"),this.leftOver=null}function c(){a.call(this,"utf-8 encode")}o[254]=o[254]=1,n.utf8encode=function(t){return r.nodebuffer?s.newBufferFrom(t,"utf-8"):function(t){var e,n,i,s,a,o=t.length,l=0;for(s=0;s<o;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=r.uint8array?new Uint8Array(l):new Array(l),s=a=0;a<l;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?e[a++]=n:(n<2048?e[a++]=192|n>>>6:(n<65536?e[a++]=224|n>>>12:(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63),e[a++]=128|n>>>6&63),e[a++]=128|63&n);return e}(t)},n.utf8decode=function(t){return r.nodebuffer?i.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,n,r,s,a=t.length,l=new Array(2*a);for(e=n=0;e<a;)if((r=t[e++])<128)l[n++]=r;else if(4<(s=o[r]))l[n++]=65533,e+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&e<a;)r=r<<6|63&t[e++],s--;1<s?l[n++]=65533:r<65536?l[n++]=r:(r-=65536,l[n++]=55296|r>>10&1023,l[n++]=56320|1023&r)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)}(t=i.transformTo(r.uint8array?"uint8array":"array",t))},i.inherits(h,a),h.prototype.processChunk=function(t){var e=i.transformTo(r.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var s=e;(e=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),e.set(s,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+o[t[n]]>e?n:e}(e),l=e;a!==e.length&&(r.uint8array?(l=e.subarray(0,a),this.leftOver=e.subarray(a,e.length)):(l=e.slice(0,a),this.leftOver=e.slice(a,e.length))),this.push({data:n.utf8decode(l),meta:t.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=h,i.inherits(c,a),c.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";var i=t("./support"),r=t("./base64"),s=t("./nodejsUtils"),a=t("set-immediate-shim"),o=t("./external");function l(t){return t}function h(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}n.newBlob=function(t,e){n.checkSupport("blob");try{return new Blob([t],{type:e})}catch(n){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(t),i.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,n){var i=[],r=0,s=t.length;if(s<=n)return String.fromCharCode.apply(null,t);for(;r<s;)"array"===e||"nodebuffer"===e?i.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+n,s)))):i.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+n,s)))),r+=n;return i.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(t){return!1}}()}};function u(t){var e=65536,i=n.getTypeOf(t),r=!0;if("uint8array"===i?r=c.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=c.applyCanBeUsed.nodebuffer),r)for(;1<e;)try{return c.stringifyByChunk(t,i,e)}catch(t){e=Math.floor(e/2)}return c.stringifyByChar(t)}function d(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}n.applyFromCharCode=u;var p={};p.string={string:l,array:function(t){return h(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return h(t,new Uint8Array(t.length))},nodebuffer:function(t){return h(t,s.allocBuffer(t.length))}},p.array={string:u,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(t)}},p.arraybuffer={string:function(t){return u(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:u,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return s.newBufferFrom(t)}},p.nodebuffer={string:u,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:l},n.transformTo=function(t,e){if(e=e||"",!t)return e;n.checkSupport(t);var i=n.getTypeOf(e);return p[i][t](e)},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":i.nodebuffer&&s.isBuffer(t)?"nodebuffer":i.uint8array&&t instanceof Uint8Array?"uint8array":i.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!i[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,i="";for(n=0;n<(t||"").length;n++)i+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return i},n.delay=function(t,e,n){a(function(){t.apply(n||null,e||[])})},n.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},n.prepareContent=function(t,e,s,a,l){return o.Promise.resolve(e).then(function(t){return i.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new o.Promise(function(e,n){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(t){n(t.target.error)},i.readAsArrayBuffer(t)}):t}).then(function(e){var c=n.getTypeOf(e);return c?("arraybuffer"===c?e=n.transformTo("uint8array",e):"string"===c&&(l?e=r.decode(e):s&&!0!==a&&(e=function(t){return h(t,i.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):o.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,n){"use strict";var i=t("./reader/readerFor"),r=t("./utils"),s=t("./signature"),a=t("./zipEntry"),o=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var i=this.reader.readString(4)===e;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.uint8array?"uint8array":"array",n=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=e-n;if(0<i)this.isSignature(e,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(t){this.reader=i(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){"use strict";var i=t("./reader/readerFor"),r=t("./utils"),s=t("./compressedObject"),a=t("./crc32"),o=t("./utf8"),l=t("./compressions"),h=t("./support");function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,i,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<r;)e=t.readInt(2),n=t.readInt(2),i=t.readData(n),this.extraFields[e]={id:e,length:n,value:i}},handleUTF8:function(){var t=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=r.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var s=r.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=i(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=i(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){"use strict";function i(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var r=t("./stream/StreamHelper"),s=t("./stream/DataWorker"),a=t("./utf8"),o=t("./compressedObject"),l=t("./stream/GenericWorker");i.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(e=e.pipe(new a.Utf8EncodeWorker)),!s&&i&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new r(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof o&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)i.prototype[h[u]]=c;e.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,n){(function(t){"use strict";var n,i,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var s=0,a=new r(c),o=t.document.createTextNode("");a.observe(o,{characterData:!0}),n=function(){o.data=s=++s%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var l=new t.MessageChannel;l.port1.onmessage=c,n=function(){l.port2.postMessage(0)}}var h=[];function c(){var t,e;i=!0;for(var n=h.length;n;){for(e=h,h=[],t=-1;++t<n;)e[t]();n=h.length}i=!1}e.exports=function(t){1!==h.push(t)||i||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){"use strict";var i=t("immediate");function r(){}var s={},a=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==r&&p(this,t)}function c(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(t,e,n){i(function(){var i;try{i=e(n)}catch(i){return s.reject(t,i)}i===t?s.reject(t,new TypeError("Cannot resolve promise with itself")):s.resolve(t,i)})}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var n=!1;function i(e){n||(n=!0,s.reject(t,e))}function r(e){n||(n=!0,s.resolve(t,e))}var a=f(function(){e(r,i)});"error"===a.status&&i(a.value)}function f(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}(e.exports=h).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},h.prototype.catch=function(t){return this.then(null,t)},h.prototype.then=function(t,e){if("function"!=typeof t&&this.state===o||"function"!=typeof e&&this.state===a)return this;var n=new this.constructor(r);return this.state!==l?u(n,this.state===o?t:e,this.outcome):this.queue.push(new c(n,t,e)),n},c.prototype.callFulfilled=function(t){s.resolve(this.promise,t)},c.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},c.prototype.callRejected=function(t){s.reject(this.promise,t)},c.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},s.resolve=function(t,e){var n=f(d,e);if("error"===n.status)return s.reject(t,n.value);var i=n.value;if(i)p(t,i);else{t.state=o,t.outcome=e;for(var r=-1,a=t.queue.length;++r<a;)t.queue[r].callFulfilled(e)}return t},s.reject=function(t,e){t.state=a,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},h.resolve=function(t){return t instanceof this?t:s.resolve(new this(r),t)},h.reject=function(t){var e=new this(r);return s.reject(e,t)},h.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),o=0,l=-1,h=new this(r);++l<n;)c(t[l],l);return h;function c(t,r){e.resolve(t).then(function(t){a[r]=t,++o!==n||i||(i=!0,s.resolve(h,a))},function(t){i||(i=!0,s.reject(h,t))})}},h.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,n=!1;if(!e)return this.resolve([]);for(var i,a=-1,o=new this(r);++a<e;)i=t[a],this.resolve(i).then(function(t){n||(n=!0,s.resolve(o,t))},function(t){n||(n=!0,s.reject(o,t))});return o}},{immediate:36}],38:[function(t,e,n){"use strict";var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){"use strict";var i=t("./zlib/deflate"),r=t("./utils/common"),s=t("./utils/strings"),a=t("./zlib/messages"),o=t("./zlib/zstream"),l=Object.prototype.toString,h=0,c=-1,u=0,d=8;function p(t){if(!(this instanceof p))return new p(t);this.options=r.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==h)throw new Error(a[n]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=i.deflateSetDictionary(this.strm,f))!==h)throw new Error(a[n]);this._dict_set=!0}}function f(t,e){var n=new p(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}p.prototype.push=function(t,e){var n,a,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=s.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(c),o.next_out=0,o.avail_out=c),1!==(n=i.deflate(o,a))&&n!==h)return this.onEnd(n),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===h):2!==a||(this.onEnd(h),!(o.avail_out=0))},p.prototype.onData=function(t){this.chunks.push(t)},p.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=p,n.deflate=f,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,f(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){"use strict";var i=t("./zlib/inflate"),r=t("./utils/common"),s=t("./utils/strings"),a=t("./zlib/constants"),o=t("./zlib/messages"),l=t("./zlib/zstream"),h=t("./zlib/gzheader"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(o[n]);this.header=new h,i.inflateGetHeader(this.strm,this.header)}function d(t,e){var n=new u(e);if(n.push(t,!0),n.err)throw n.msg||o[n.err];return n.result}u.prototype.push=function(t,e){var n,o,l,h,u,d,p=this.strm,f=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?p.input=s.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?p.input=new Uint8Array(t):p.input=t,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(n=i.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&g&&(d="string"==typeof g?s.string2buf(g):"[object ArrayBuffer]"===c.call(g)?new Uint8Array(g):g,n=i.inflateSetDictionary(this.strm,d)),n===a.Z_BUF_ERROR&&!0===m&&(n=a.Z_OK,m=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(p.output,p.next_out),h=p.next_out-l,u=s.buf2string(p.output,l),p.next_out=h,p.avail_out=f-h,h&&r.arraySet(p.output,p.output,l,h,0),this.onData(u)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(m=!0)}while((0<p.avail_in||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(p.avail_out=0))},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=u,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,n,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+i),r);else for(var s=0;s<i;s++)t[r+s]=e[n+s]},flattenChunks:function(t){var e,n,i,r,s,a;for(e=i=0,n=t.length;e<n;e++)i+=t[e].length;for(a=new Uint8Array(i),e=r=0,n=t.length;e<n;e++)s=t[e],a.set(s,r),r+=s.length;return a}},s={arraySet:function(t,e,n,i,r){for(var s=0;s<i;s++)t[r+s]=e[n+s]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(i)},{}],42:[function(t,e,n){"use strict";var i=t("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var a=new i.Buf8(256),o=0;o<256;o++)a[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function l(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,n.string2buf=function(t){var e,n,r,s,a,o=t.length,l=0;for(s=0;s<o;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(r=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new i.Buf8(l),s=a=0;a<l;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(r=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?e[a++]=n:(n<2048?e[a++]=192|n>>>6:(n<65536?e[a++]=224|n>>>12:(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63),e[a++]=128|n>>>6&63),e[a++]=128|63&n);return e},n.buf2binstring=function(t){return l(t,t.length)},n.binstring2buf=function(t){for(var e=new i.Buf8(t.length),n=0,r=e.length;n<r;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,i,r,s,o=e||t.length,h=new Array(2*o);for(n=i=0;n<o;)if((r=t[n++])<128)h[i++]=r;else if(4<(s=a[r]))h[i++]=65533,n+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&n<o;)r=r<<6|63&t[n++],s--;1<s?h[i++]=65533:r<65536?h[i++]=r:(r-=65536,h[i++]=55296|r>>10&1023,h[i++]=56320|1023&r)}return l(h,i)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+a[t[n]]>e?n:e}},{"./common":41}],43:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){for(var r=65535&t|0,s=t>>>16&65535|0,a=0;0!==n;){for(n-=a=2e3<n?2e3:n;s=s+(r=r+e[i++]|0)|0,--a;);r%=65521,s%=65521}return r|s<<16|0}},{}],44:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){"use strict";var i=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,r){var s=i,a=r+n;t^=-1;for(var o=r;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}},{}],46:[function(t,e,n){"use strict";var i,r=t("../utils/common"),s=t("./trees"),a=t("./adler32"),o=t("./crc32"),l=t("./messages"),h=0,c=4,u=0,d=-2,p=-1,f=4,g=2,m=8,v=9,_=286,y=30,x=19,b=2*_+1,w=15,S=3,M=258,T=M+S+1,E=42,C=113,A=1,R=2,L=3,P=4;function k(t,e){return t.msg=l[e],e}function D(t){return(t<<1)-(4<t?9:0)}function I(t){for(var e=t.length;0<=--e;)t[e]=0}function O(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(r.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function B(t,e){s._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,O(t.strm)}function F(t,e){t.pending_buf[t.pending++]=e}function N(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function U(t,e){var n,i,r=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-T?t.strstart-(t.w_size-T):0,h=t.window,c=t.w_mask,u=t.prev,d=t.strstart+M,p=h[s+a-1],f=h[s+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(n=e)+a]===f&&h[n+a-1]===p&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do{}while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<d);if(i=M-(d-s),s=d-M,a<i){if(t.match_start=e,o<=(a=i))break;p=h[s+a-1],f=h[s+a]}}}while((e=u[e&c])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function z(t){var e,n,i,s,l,h,c,u,d,p,f=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-T)){for(r.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=n=t.hash_size;i=t.head[--e],t.head[e]=f<=i?i-f:0,--n;);for(e=n=f;i=t.prev[--e],t.prev[e]=f<=i?i-f:0,--n;);s+=f}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,u=t.strstart+t.lookahead,p=void 0,(d=s)<(p=h.avail_in)&&(p=d),n=0===p?0:(h.avail_in-=p,r.arraySet(c,h.input,h.next_in,p,u),1===h.state.wrap?h.adler=a(h.adler,c,p,u):2===h.state.wrap&&(h.adler=o(h.adler,c,p,u)),h.next_in+=p,h.total_in+=p,p),t.lookahead+=n,t.lookahead+t.insert>=S)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+S-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<T&&0!==t.strm.avail_in)}function G(t,e){for(var n,i;;){if(t.lookahead<T){if(z(t),t.lookahead<T&&e===h)return A;if(0===t.lookahead)break}if(n=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-T&&(t.match_length=U(t,n)),t.match_length>=S)if(i=s._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(B(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<S-1?t.strstart:S-1,e===c?(B(t,!0),0===t.strm.avail_out?L:P):t.last_lit&&(B(t,!1),0===t.strm.avail_out)?A:R}function H(t,e){for(var n,i,r;;){if(t.lookahead<T){if(z(t),t.lookahead<T&&e===h)return A;if(0===t.lookahead)break}if(n=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-T&&(t.match_length=U(t,n),t.match_length<=5&&(1===t.strategy||t.match_length===S&&4096<t.strstart-t.match_start)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-S,i=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=S-1,t.strstart++,i&&(B(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((i=s._tr_tally(t,0,t.window[t.strstart-1]))&&B(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===c?(B(t,!0),0===t.strm.avail_out?L:P):t.last_lit&&(B(t,!1),0===t.strm.avail_out)?A:R}function W(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}function V(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*b),this.dyn_dtree=new r.Buf16(2*(2*y+1)),this.bl_tree=new r.Buf16(2*(2*x+1)),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(w+1),this.heap=new r.Buf16(2*_+1),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*_+1),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function j(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=g,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?E:C,t.adler=2===e.wrap?0:1,e.last_flush=h,s._tr_init(e),u):k(t,d)}function X(t){var e=j(t);return e===u&&function(t){t.window_size=2*t.w_size,I(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0}(t.state),e}function Y(t,e,n,i,s,a){if(!t)return d;var o=1;if(e===p&&(e=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),s<1||v<s||n!==m||i<8||15<i||e<0||9<e||a<0||f<a)return k(t,d);8===i&&(i=9);var l=new V;return(t.state=l).strm=t,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+S-1)/S),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=n,X(t)}i=[new W(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(z(t),0===t.lookahead&&e===h)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,B(t,!1),0===t.strm.avail_out))return A;if(t.strstart-t.block_start>=t.w_size-T&&(B(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===c?(B(t,!0),0===t.strm.avail_out?L:P):(t.strstart>t.block_start&&(B(t,!1),t.strm.avail_out),A)}),new W(4,4,8,4,G),new W(4,5,16,8,G),new W(4,6,32,32,G),new W(4,4,16,16,H),new W(8,16,32,32,H),new W(8,16,128,128,H),new W(8,32,128,256,H),new W(32,128,258,1024,H),new W(32,258,258,4096,H)],n.deflateInit=function(t,e){return Y(t,e,m,15,8,0)},n.deflateInit2=Y,n.deflateReset=X,n.deflateResetKeep=j,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?d:(t.state.gzhead=e,u):d},n.deflate=function(t,e){var n,r,a,l;if(!t||!t.state||5<e||e<0)return t?k(t,d):d;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==c)return k(t,0===t.avail_out?-5:d);if(r.strm=t,n=r.last_flush,r.last_flush=e,r.status===E)if(2===r.wrap)t.adler=0,F(r,31),F(r,139),F(r,8),r.gzhead?(F(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),F(r,255&r.gzhead.time),F(r,r.gzhead.time>>8&255),F(r,r.gzhead.time>>16&255),F(r,r.gzhead.time>>24&255),F(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),F(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(F(r,255&r.gzhead.extra.length),F(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(F(r,0),F(r,0),F(r,0),F(r,0),F(r,0),F(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),F(r,3),r.status=C);else{var p=m+(r.w_bits-8<<4)<<8;p|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(p|=32),p+=31-p%31,r.status=C,N(r,p),0!==r.strstart&&(N(r,t.adler>>>16),N(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),O(t),a=r.pending,r.pending!==r.pending_buf_size));)F(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),O(t),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,F(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),O(t),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,F(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&O(t),r.pending+2<=r.pending_buf_size&&(F(r,255&t.adler),F(r,t.adler>>8&255),t.adler=0,r.status=C)):r.status=C),0!==r.pending){if(O(t),0===t.avail_out)return r.last_flush=-1,u}else if(0===t.avail_in&&D(e)<=D(n)&&e!==c)return k(t,-5);if(666===r.status&&0!==t.avail_in)return k(t,-5);if(0!==t.avail_in||0!==r.lookahead||e!==h&&666!==r.status){var f=2===r.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(z(t),0===t.lookahead)){if(e===h)return A;break}if(t.match_length=0,n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(B(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===c?(B(t,!0),0===t.strm.avail_out?L:P):t.last_lit&&(B(t,!1),0===t.strm.avail_out)?A:R}(r,e):3===r.strategy?function(t,e){for(var n,i,r,a,o=t.window;;){if(t.lookahead<=M){if(z(t),t.lookahead<=M&&e===h)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&0<t.strstart&&(i=o[r=t.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){a=t.strstart+M;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<a);t.match_length=M-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(n=s._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(B(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===c?(B(t,!0),0===t.strm.avail_out?L:P):t.last_lit&&(B(t,!1),0===t.strm.avail_out)?A:R}(r,e):i[r.level].func(r,e);if(f!==L&&f!==P||(r.status=666),f===A||f===L)return 0===t.avail_out&&(r.last_flush=-1),u;if(f===R&&(1===e?s._tr_align(r):5!==e&&(s._tr_stored_block(r,0,0,!1),3===e&&(I(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),O(t),0===t.avail_out))return r.last_flush=-1,u}return e!==c?u:r.wrap<=0?1:(2===r.wrap?(F(r,255&t.adler),F(r,t.adler>>8&255),F(r,t.adler>>16&255),F(r,t.adler>>24&255),F(r,255&t.total_in),F(r,t.total_in>>8&255),F(r,t.total_in>>16&255),F(r,t.total_in>>24&255)):(N(r,t.adler>>>16),N(r,65535&t.adler)),O(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?u:1)},n.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==E&&69!==e&&73!==e&&91!==e&&103!==e&&e!==C&&666!==e?k(t,d):(t.state=null,e===C?k(t,-3):u):d},n.deflateSetDictionary=function(t,e){var n,i,s,o,l,h,c,p,f=e.length;if(!t||!t.state)return d;if(2===(o=(n=t.state).wrap)||1===o&&n.status!==E||n.lookahead)return d;for(1===o&&(t.adler=a(t.adler,e,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(I(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new r.Buf8(n.w_size),r.arraySet(p,e,f-n.w_size,n.w_size,0),e=p,f=n.w_size),l=t.avail_in,h=t.next_in,c=t.input,t.avail_in=f,t.next_in=0,t.input=e,z(n);n.lookahead>=S;){for(i=n.strstart,s=n.lookahead-(S-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+S-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=S-1,z(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=S-1,n.match_available=0,t.next_in=h,t.input=c,t.avail_in=l,n.wrap=o,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){"use strict";e.exports=function(t,e){var n,i,r,s,a,o,l,h,c,u,d,p,f,g,m,v,_,y,x,b,w,S,M,T,E;n=t.state,i=t.next_in,T=t.input,r=i+(t.avail_in-5),s=t.next_out,E=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),l=n.dmax,h=n.wsize,c=n.whave,u=n.wnext,d=n.window,p=n.hold,f=n.bits,g=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;t:do{f<15&&(p+=T[i++]<<f,f+=8,p+=T[i++]<<f,f+=8),y=g[p&v];e:for(;;){if(p>>>=x=y>>>24,f-=x,0==(x=y>>>16&255))E[s++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=g[(65535&y)+(p&(1<<x)-1)];continue e}if(32&x){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}b=65535&y,(x&=15)&&(f<x&&(p+=T[i++]<<f,f+=8),b+=p&(1<<x)-1,p>>>=x,f-=x),f<15&&(p+=T[i++]<<f,f+=8,p+=T[i++]<<f,f+=8),y=m[p&_];n:for(;;){if(p>>>=x=y>>>24,f-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=m[(65535&y)+(p&(1<<x)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(w=65535&y,f<(x&=15)&&(p+=T[i++]<<f,(f+=8)<x&&(p+=T[i++]<<f,f+=8)),l<(w+=p&(1<<x)-1)){t.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=x,f-=x,(x=s-a)<w){if(c<(x=w-x)&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(M=d,(S=0)===u){if(S+=h-x,x<b){for(b-=x;E[s++]=d[S++],--x;);S=s-w,M=E}}else if(u<x){if(S+=h+u-x,(x-=u)<b){for(b-=x;E[s++]=d[S++],--x;);if(S=0,u<b){for(b-=x=u;E[s++]=d[S++],--x;);S=s-w,M=E}}}else if(S+=u-x,x<b){for(b-=x;E[s++]=d[S++],--x;);S=s-w,M=E}for(;2<b;)E[s++]=M[S++],E[s++]=M[S++],E[s++]=M[S++],b-=3;b&&(E[s++]=M[S++],1<b&&(E[s++]=M[S++]))}else{for(S=s-w;E[s++]=E[S++],E[s++]=E[S++],E[s++]=E[S++],2<(b-=3););b&&(E[s++]=E[S++],1<b&&(E[s++]=E[S++]))}break}}break}}while(i<r&&s<o);i-=b=f>>3,p&=(1<<(f-=b<<3))-1,t.next_in=i,t.next_out=s,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=s<o?o-s+257:257-(s-o),n.hold=p,n.bits=f}},{}],49:[function(t,e,n){"use strict";var i=t("../utils/common"),r=t("./adler32"),s=t("./crc32"),a=t("./inffast"),o=t("./inftrees"),l=1,h=2,c=0,u=-2,d=1,p=852,f=592;function g(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=d,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(p),e.distcode=e.distdyn=new i.Buf32(f),e.sane=1,e.back=-1,c):u}function _(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,v(t)):u}function y(t,e){var n,i;return t&&t.state?(i=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?u:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,_(t))):u}function x(t,e){var n,i;return t?(i=new m,(t.state=i).window=null,(n=y(t,e))!==c&&(t.state=null),n):u}var b,w,S=!0;function M(t){if(S){var e;for(b=new i.Buf32(512),w=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(l,t.lens,0,288,b,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(h,t.lens,0,32,w,0,t.work,{bits:5}),S=!1}t.lencode=b,t.lenbits=9,t.distcode=w,t.distbits=5}function T(t,e,n,r){var s,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(r<(s=a.wsize-a.wnext)&&(s=r),i.arraySet(a.window,e,n-r,s,a.wnext),(r-=s)?(i.arraySet(a.window,e,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}n.inflateReset=_,n.inflateReset2=y,n.inflateResetKeep=v,n.inflateInit=function(t){return x(t,15)},n.inflateInit2=x,n.inflate=function(t,e){var n,p,f,m,v,_,y,x,b,w,S,E,C,A,R,L,P,k,D,I,O,B,F,N,U=0,z=new i.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return u;12===(n=t.state).mode&&(n.mode=13),v=t.next_out,f=t.output,y=t.avail_out,m=t.next_in,p=t.input,_=t.avail_in,x=n.hold,b=n.bits,w=_,S=y,B=c;t:for(;;)switch(n.mode){case d:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(2&n.wrap&&35615===x){z[n.check=0]=255&x,z[1]=x>>>8&255,n.check=s(n.check,z,2,0),b=x=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&x)<<8)+(x>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&x)){t.msg="unknown compression method",n.mode=30;break}if(b-=4,O=8+(15&(x>>>=4)),0===n.wbits)n.wbits=O;else if(O>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<O,t.adler=n.check=1,n.mode=512&x?10:12,b=x=0;break;case 2:for(;b<16;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(n.flags=x,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=x>>8&1),512&n.flags&&(z[0]=255&x,z[1]=x>>>8&255,n.check=s(n.check,z,2,0)),b=x=0,n.mode=3;case 3:for(;b<32;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}n.head&&(n.head.time=x),512&n.flags&&(z[0]=255&x,z[1]=x>>>8&255,z[2]=x>>>16&255,z[3]=x>>>24&255,n.check=s(n.check,z,4,0)),b=x=0,n.mode=4;case 4:for(;b<16;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}n.head&&(n.head.xflags=255&x,n.head.os=x>>8),512&n.flags&&(z[0]=255&x,z[1]=x>>>8&255,n.check=s(n.check,z,2,0)),b=x=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}n.length=x,n.head&&(n.head.extra_len=x),512&n.flags&&(z[0]=255&x,z[1]=x>>>8&255,n.check=s(n.check,z,2,0)),b=x=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(_<(E=n.length)&&(E=_),E&&(n.head&&(O=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,p,m,E,O)),512&n.flags&&(n.check=s(n.check,p,E,m)),_-=E,m+=E,n.length-=E),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===_)break t;for(E=0;O=p[m+E++],n.head&&O&&n.length<65536&&(n.head.name+=String.fromCharCode(O)),O&&E<_;);if(512&n.flags&&(n.check=s(n.check,p,E,m)),_-=E,m+=E,O)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===_)break t;for(E=0;O=p[m+E++],n.head&&O&&n.length<65536&&(n.head.comment+=String.fromCharCode(O)),O&&E<_;);if(512&n.flags&&(n.check=s(n.check,p,E,m)),_-=E,m+=E,O)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(x!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}b=x=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;b<32;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}t.adler=n.check=g(x),b=x=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=v,t.avail_out=y,t.next_in=m,t.avail_in=_,n.hold=x,n.bits=b,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){x>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}switch(n.last=1&x,b-=1,3&(x>>>=1)){case 0:n.mode=14;break;case 1:if(M(n),n.mode=20,6!==e)break;x>>>=2,b-=2;break t;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}x>>>=2,b-=2;break;case 14:for(x>>>=7&b,b-=7&b;b<32;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if((65535&x)!=(x>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&x,b=x=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(E=n.length){if(_<E&&(E=_),y<E&&(E=y),0===E)break t;i.arraySet(f,p,m,E,v),_-=E,m+=E,y-=E,v+=E,n.length-=E;break}n.mode=12;break;case 17:for(;b<14;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(n.nlen=257+(31&x),x>>>=5,b-=5,n.ndist=1+(31&x),x>>>=5,b-=5,n.ncode=4+(15&x),x>>>=4,b-=4,286<n.nlen||30<n.ndist){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}n.lens[G[n.have++]]=7&x,x>>>=3,b-=3}for(;n.have<19;)n.lens[G[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,F={bits:n.lenbits},B=o(0,n.lens,0,19,n.lencode,0,n.work,F),n.lenbits=F.bits,B){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;L=(U=n.lencode[x&(1<<n.lenbits)-1])>>>16&255,P=65535&U,!((R=U>>>24)<=b);){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(P<16)x>>>=R,b-=R,n.lens[n.have++]=P;else{if(16===P){for(N=R+2;b<N;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(x>>>=R,b-=R,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}O=n.lens[n.have-1],E=3+(3&x),x>>>=2,b-=2}else if(17===P){for(N=R+3;b<N;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}b-=R,O=0,E=3+(7&(x>>>=R)),x>>>=3,b-=3}else{for(N=R+7;b<N;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}b-=R,O=0,E=11+(127&(x>>>=R)),x>>>=7,b-=7}if(n.have+E>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;E--;)n.lens[n.have++]=O}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,F={bits:n.lenbits},B=o(l,n.lens,0,n.nlen,n.lencode,0,n.work,F),n.lenbits=F.bits,B){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,F={bits:n.distbits},B=o(h,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,F),n.distbits=F.bits,B){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(6<=_&&258<=y){t.next_out=v,t.avail_out=y,t.next_in=m,t.avail_in=_,n.hold=x,n.bits=b,a(t,S),v=t.next_out,f=t.output,y=t.avail_out,m=t.next_in,p=t.input,_=t.avail_in,x=n.hold,b=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;L=(U=n.lencode[x&(1<<n.lenbits)-1])>>>16&255,P=65535&U,!((R=U>>>24)<=b);){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(L&&0==(240&L)){for(k=R,D=L,I=P;L=(U=n.lencode[I+((x&(1<<k+D)-1)>>k)])>>>16&255,P=65535&U,!(k+(R=U>>>24)<=b);){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}x>>>=k,b-=k,n.back+=k}if(x>>>=R,b-=R,n.back+=R,n.length=P,0===L){n.mode=26;break}if(32&L){n.back=-1,n.mode=12;break}if(64&L){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&L,n.mode=22;case 22:if(n.extra){for(N=n.extra;b<N;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}n.length+=x&(1<<n.extra)-1,x>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;L=(U=n.distcode[x&(1<<n.distbits)-1])>>>16&255,P=65535&U,!((R=U>>>24)<=b);){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(0==(240&L)){for(k=R,D=L,I=P;L=(U=n.distcode[I+((x&(1<<k+D)-1)>>k)])>>>16&255,P=65535&U,!(k+(R=U>>>24)<=b);){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}x>>>=k,b-=k,n.back+=k}if(x>>>=R,b-=R,n.back+=R,64&L){t.msg="invalid distance code",n.mode=30;break}n.offset=P,n.extra=15&L,n.mode=24;case 24:if(n.extra){for(N=n.extra;b<N;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}n.offset+=x&(1<<n.extra)-1,x>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===y)break t;if(E=S-y,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}C=E>n.wnext?(E-=n.wnext,n.wsize-E):n.wnext-E,E>n.length&&(E=n.length),A=n.window}else A=f,C=v-n.offset,E=n.length;for(y<E&&(E=y),y-=E,n.length-=E;f[v++]=A[C++],--E;);0===n.length&&(n.mode=21);break;case 26:if(0===y)break t;f[v++]=n.length,y--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===_)break t;_--,x|=p[m++]<<b,b+=8}if(S-=y,t.total_out+=S,n.total+=S,S&&(t.adler=n.check=n.flags?s(n.check,f,S,v-S):r(n.check,f,S,v-S)),S=y,(n.flags?x:g(x))!==n.check){t.msg="incorrect data check",n.mode=30;break}b=x=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===_)break t;_--,x+=p[m++]<<b,b+=8}if(x!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}b=x=0}n.mode=29;case 29:B=1;break t;case 30:B=-3;break t;case 31:return-4;case 32:default:return u}return t.next_out=v,t.avail_out=y,t.next_in=m,t.avail_in=_,n.hold=x,n.bits=b,(n.wsize||S!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&T(t,t.output,t.next_out,S-t.avail_out)?(n.mode=31,-4):(w-=t.avail_in,S-=t.avail_out,t.total_in+=w,t.total_out+=S,n.total+=S,n.wrap&&S&&(t.adler=n.check=n.flags?s(n.check,f,S,t.next_out-S):r(n.check,f,S,t.next_out-S)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==w&&0===S||4===e)&&B===c&&(B=-5),B)},n.inflateEnd=function(t){if(!t||!t.state)return u;var e=t.state;return e.window&&(e.window=null),t.state=null,c},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?u:((n.head=e).done=!1,c):u},n.inflateSetDictionary=function(t,e){var n,i=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?u:11===n.mode&&r(1,e,i,0)!==n.check?-3:T(t,e,i,i)?(n.mode=31,-4):(n.havedict=1,c):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){"use strict";var i=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,l,h,c,u,d){var p,f,g,m,v,_,y,x,b,w=d.bits,S=0,M=0,T=0,E=0,C=0,A=0,R=0,L=0,P=0,k=0,D=null,I=0,O=new i.Buf16(16),B=new i.Buf16(16),F=null,N=0;for(S=0;S<=15;S++)O[S]=0;for(M=0;M<l;M++)O[e[n+M]]++;for(C=w,E=15;1<=E&&0===O[E];E--);if(E<C&&(C=E),0===E)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(T=1;T<E&&0===O[T];T++);for(C<T&&(C=T),S=L=1;S<=15;S++)if(L<<=1,(L-=O[S])<0)return-1;if(0<L&&(0===t||1!==E))return-1;for(B[1]=0,S=1;S<15;S++)B[S+1]=B[S]+O[S];for(M=0;M<l;M++)0!==e[n+M]&&(u[B[e[n+M]]++]=M);if(_=0===t?(D=F=u,19):1===t?(D=r,I-=257,F=s,N-=257,256):(D=a,F=o,-1),S=T,v=c,R=M=k=0,g=-1,m=(P=1<<(A=C))-1,1===t&&852<P||2===t&&592<P)return 1;for(;;){for(y=S-R,b=u[M]<_?(x=0,u[M]):u[M]>_?(x=F[N+u[M]],D[I+u[M]]):(x=96,0),p=1<<S-R,T=f=1<<A;h[v+(k>>R)+(f-=p)]=y<<24|x<<16|b|0,0!==f;);for(p=1<<S-1;k&p;)p>>=1;if(0!==p?(k&=p-1,k+=p):k=0,M++,0==--O[S]){if(S===E)break;S=e[n+u[M]]}if(C<S&&(k&m)!==g){for(0===R&&(R=C),v+=T,L=1<<(A=S-R);A+R<E&&!((L-=O[A+R])<=0);)A++,L<<=1;if(P+=1<<A,1===t&&852<P||2===t&&592<P)return 1;h[g=k&m]=C<<24|A<<16|v-c|0}}return 0!==k&&(h[v+k]=S-R<<24|64<<16|0),d.bits=C,0}},{"../utils/common":41}],51:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){"use strict";var i=t("../utils/common");function r(t){for(var e=t.length;0<=--e;)t[e]=0}var s=0,a=256,o=a+1+29,l=30,h=19,c=2*o+1,u=15,d=16,p=256,f=16,g=17,m=18,v=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=new Array(2*(o+2));r(b);var w=new Array(2*l);r(w);var S=new Array(512);r(S);var M=new Array(256);r(M);var T=new Array(29);r(T);var E,C,A,R=new Array(l);function L(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function P(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function k(t){return t<256?S[t]:S[256+(t>>>7)]}function D(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function I(t,e,n){t.bi_valid>d-n?(t.bi_buf|=e<<t.bi_valid&65535,D(t,t.bi_buf),t.bi_buf=e>>d-t.bi_valid,t.bi_valid+=n-d):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function O(t,e,n){I(t,n[2*e],n[2*e+1])}function B(t,e){for(var n=0;n|=1&t,t>>>=1,n<<=1,0<--e;);return n>>>1}function F(t,e,n){var i,r,s=new Array(u+1),a=0;for(i=1;i<=u;i++)s[i]=a=a+n[i-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=B(s[o]++,o))}}function N(t){var e;for(e=0;e<o;e++)t.dyn_ltree[2*e]=0;for(e=0;e<l;e++)t.dyn_dtree[2*e]=0;for(e=0;e<h;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*p]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function U(t){8<t.bi_valid?D(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function z(t,e,n,i){var r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]}function G(t,e,n){for(var i=t.heap[n],r=n<<1;r<=t.heap_len&&(r<t.heap_len&&z(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!z(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i}function H(t,e,n){var i,r,s,o,l=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],r=t.pending_buf[t.l_buf+l],l++,0===i?O(t,r,e):(O(t,(s=M[r])+a+1,e),0!==(o=v[s])&&I(t,r-=T[s],o),O(t,s=k(--i),n),0!==(o=_[s])&&I(t,i-=R[s],o)),l<t.last_lit;);O(t,p,e)}function W(t,e){var n,i,r,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=c,n=0;n<l;n++)0!==s[2*n]?(t.heap[++t.heap_len]=h=n,t.depth[n]=0):s[2*n+1]=0;for(;t.heap_len<2;)s[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=a[2*r+1]);for(e.max_code=h,n=t.heap_len>>1;1<=n;n--)G(t,s,n);for(r=l;n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],G(t,s,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,s[2*r]=s[2*n]+s[2*i],t.depth[r]=(t.depth[n]>=t.depth[i]?t.depth[n]:t.depth[i])+1,s[2*n+1]=s[2*i+1]=r,t.heap[1]=r++,G(t,s,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,i,r,s,a,o,l=e.dyn_tree,h=e.max_code,d=e.stat_desc.static_tree,p=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,g=e.stat_desc.extra_base,m=e.stat_desc.max_length,v=0;for(s=0;s<=u;s++)t.bl_count[s]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<c;n++)m<(s=l[2*l[2*(i=t.heap[n])+1]+1]+1)&&(s=m,v++),l[2*i+1]=s,h<i||(t.bl_count[s]++,a=0,g<=i&&(a=f[i-g]),o=l[2*i],t.opt_len+=o*(s+a),p&&(t.static_len+=o*(d[2*i+1]+a)));if(0!==v){do{for(s=m-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[m]--,v-=2}while(0<v);for(s=m;0!==s;s--)for(i=t.bl_count[s];0!==i;)h<(r=t.heap[--n])||(l[2*r+1]!==s&&(t.opt_len+=(s-l[2*r+1])*l[2*r],l[2*r+1]=s),i--)}}(t,e),F(s,h,t.bl_count)}function V(t,e,n){var i,r,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=e[2*(i+1)+1],++o<l&&r===a||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[2*f]++):o<=10?t.bl_tree[2*g]++:t.bl_tree[2*m]++,s=r,h=(o=0)===a?(l=138,3):r===a?(l=6,3):(l=7,4))}function j(t,e,n){var i,r,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),i=0;i<=n;i++)if(r=a,a=e[2*(i+1)+1],!(++o<l&&r===a)){if(o<h)for(;O(t,r,t.bl_tree),0!=--o;);else 0!==r?(r!==s&&(O(t,r,t.bl_tree),o--),O(t,f,t.bl_tree),I(t,o-3,2)):o<=10?(O(t,g,t.bl_tree),I(t,o-3,3)):(O(t,m,t.bl_tree),I(t,o-11,7));s=r,h=(o=0)===a?(l=138,3):r===a?(l=6,3):(l=7,4)}}r(R);var X=!1;function Y(t,e,n,r){I(t,(s<<1)+(r?1:0),3),function(t,e,n,r){U(t),D(t,n),D(t,~n),i.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n)}n._tr_init=function(t){X||(function(){var t,e,n,i,r,s=new Array(u+1);for(i=n=0;i<28;i++)for(T[i]=n,t=0;t<1<<v[i];t++)M[n++]=i;for(M[n-1]=i,i=r=0;i<16;i++)for(R[i]=r,t=0;t<1<<_[i];t++)S[r++]=i;for(r>>=7;i<l;i++)for(R[i]=r<<7,t=0;t<1<<_[i]-7;t++)S[256+r++]=i;for(e=0;e<=u;e++)s[e]=0;for(t=0;t<=143;)b[2*t+1]=8,t++,s[8]++;for(;t<=255;)b[2*t+1]=9,t++,s[9]++;for(;t<=279;)b[2*t+1]=7,t++,s[7]++;for(;t<=287;)b[2*t+1]=8,t++,s[8]++;for(F(b,o+1,s),t=0;t<l;t++)w[2*t+1]=5,w[2*t]=B(t,5);E=new L(b,v,a+1,o,u),C=new L(w,_,0,l,u),A=new L(new Array(0),y,0,h,7)}(),X=!0),t.l_desc=new P(t.dyn_ltree,E),t.d_desc=new P(t.dyn_dtree,C),t.bl_desc=new P(t.bl_tree,A),t.bi_buf=0,t.bi_valid=0,N(t)},n._tr_stored_block=Y,n._tr_flush_block=function(t,e,n,i){var r,s,o=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<a;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),W(t,t.l_desc),W(t,t.d_desc),o=function(t){var e;for(V(t,t.dyn_ltree,t.l_desc.max_code),V(t,t.dyn_dtree,t.d_desc.max_code),W(t,t.bl_desc),e=h-1;3<=e&&0===t.bl_tree[2*x[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=r&&(r=s)):r=s=n+5,n+4<=r&&-1!==e?Y(t,e,n,i):4===t.strategy||s===r?(I(t,2+(i?1:0),3),H(t,b,w)):(I(t,4+(i?1:0),3),function(t,e,n,i){var r;for(I(t,e-257,5),I(t,n-1,5),I(t,i-4,4),r=0;r<i;r++)I(t,t.bl_tree[2*x[r]+1],3);j(t,t.dyn_ltree,e-1),j(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),H(t,t.dyn_ltree,t.dyn_dtree)),N(t),i&&U(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(M[n]+a+1)]++,t.dyn_dtree[2*k(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){I(t,2,3),O(t,p,b),function(t){16===t.bi_valid?(D(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)});var LZString=function(){function t(t,e){if(!r[t]){r[t]={};for(var n=0;n<t.length;n++)r[t][t.charAt(n)]=n}return r[t][e]}var e=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},s={compressToBase64:function(t){if(null==t)return"";var e=s._compress(t,6,function(t){return n.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:s._decompress(e.length,32,function(i){return t(n,e.charAt(i))})},compressToUTF16:function(t){return null==t?"":s._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:s._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=s.compress(t),n=new Uint8Array(2*e.length),i=0,r=e.length;r>i;i++){var a=e.charCodeAt(i);n[2*i]=a>>>8,n[2*i+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return s.decompress(t);for(var n=new Array(t.length/2),i=0,r=n.length;r>i;i++)n[i]=256*t[2*i]+t[2*i+1];var a=[];return n.forEach(function(t){a.push(e(t))}),s.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":s._compress(t,6,function(t){return i.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),s._decompress(e.length,32,function(n){return t(i,e.charAt(n))}))},compress:function(t){return s._compress(t,16,function(t){return e(t)})},_compress:function(t,e,n){if(null==t)return"";var i,r,s,a={},o={},l="",h="",c="",u=2,d=3,p=2,f=[],g=0,m=0;for(s=0;s<t.length;s+=1)if(l=t.charAt(s),Object.prototype.hasOwnProperty.call(a,l)||(a[l]=d++,o[l]=!0),h=c+l,Object.prototype.hasOwnProperty.call(a,h))c=h;else{if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(i=0;p>i;i++)g<<=1,m==e-1?(m=0,f.push(n(g)),g=0):m++;for(r=c.charCodeAt(0),i=0;8>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}else{for(r=1,i=0;p>i;i++)g=g<<1|r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r=0;for(r=c.charCodeAt(0),i=0;16>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}0==--u&&(u=Math.pow(2,p),p++),delete o[c]}else for(r=a[c],i=0;p>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;0==--u&&(u=Math.pow(2,p),p++),a[h]=d++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(i=0;p>i;i++)g<<=1,m==e-1?(m=0,f.push(n(g)),g=0):m++;for(r=c.charCodeAt(0),i=0;8>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}else{for(r=1,i=0;p>i;i++)g=g<<1|r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r=0;for(r=c.charCodeAt(0),i=0;16>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}0==--u&&(u=Math.pow(2,p),p++),delete o[c]}else for(r=a[c],i=0;p>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;0==--u&&(u=Math.pow(2,p),p++)}for(r=2,i=0;p>i;i++)g=g<<1|1&r,m==e-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;for(;;){if(g<<=1,m==e-1){f.push(n(g));break}m++}return f.join("")},decompress:function(t){return null==t?"":""==t?null:s._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,n,i){var r,s,a,o,l,h,c,u=[],d=4,p=4,f=3,g="",m=[],v={val:i(0),position:n,index:1};for(r=0;3>r;r+=1)u[r]=r;for(a=0,l=Math.pow(2,2),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(o>0?1:0)*h,h<<=1;switch(a){case 0:for(a=0,l=Math.pow(2,8),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(o>0?1:0)*h,h<<=1;c=e(a);break;case 1:for(a=0,l=Math.pow(2,16),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(o>0?1:0)*h,h<<=1;c=e(a);break;case 2:return""}for(u[3]=c,s=c,m.push(c);;){if(v.index>t)return"";for(a=0,l=Math.pow(2,f),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(o>0?1:0)*h,h<<=1;switch(c=a){case 0:for(a=0,l=Math.pow(2,8),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(o>0?1:0)*h,h<<=1;u[p++]=e(a),c=p-1,d--;break;case 1:for(a=0,l=Math.pow(2,16),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(o>0?1:0)*h,h<<=1;u[p++]=e(a),c=p-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,f),f++),u[c])g=u[c];else{if(c!==p)return null;g=s+s.charAt(0)}m.push(g),u[p++]=s+g.charAt(0),s=g,0==--d&&(d=Math.pow(2,f),f++)}}};return s}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString),function(){var t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v2.2.8",t.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},t.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},t._UID=0,"undefined"!=typeof Float32Array?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array,t.Uint32Array=Uint32Array,t.ArrayBuffer=ArrayBuffer):(t.Float32Array=Array,t.Uint16Array=Array),t.INTERACTION_FREQUENCY=30,t.AUTO_PREVENT_DEFAULT=!0,t.PI_2=2*Math.PI,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RETINA_PREFIX="@2x",t.dontSayHello=!1,t.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},t.sayHello=function(e){if(!t.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var n=["%c %c %c Pixi.js "+t.VERSION+" - "+e+"  %c  %c  http://www.pixijs.com/  %c %c %c%c ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,n)}else window.console&&console.log("Pixi.js "+t.VERSION+" - http://www.pixijs.com/");t.dontSayHello=!0}},t.Point=function(t,e){this.x=t||0,this.y=e||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},t.Point.prototype.constructor=t.Point,t.Rectangle=function(t,e,n,i){this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(t>=n&&t<=n+this.width){var i=this.y;if(e>=i&&e<=i+this.height)return!0}return!1},t.Rectangle.prototype.constructor=t.Rectangle,t.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),e[0]instanceof t.Point){for(var n=[],i=0,r=e.length;i<r;i++)n.push(e[i].x,e[i].y);e=n}this.closed=!0,this.points=e},t.Polygon.prototype.clone=function(){var e=this.points.slice();return new t.Polygon(e)},t.Polygon.prototype.contains=function(t,e){for(var n=!1,i=this.points.length/2,r=0,s=i-1;r<i;s=r++){var a=this.points[2*r],o=this.points[2*r+1],l=this.points[2*s],h=this.points[2*s+1];o>e!=h>e&&t<(l-a)*(e-o)/(h-o)+a&&(n=!n)}return n},t.Polygon.prototype.constructor=t.Polygon,t.Circle=function(t,e,n){this.x=t||0,this.y=e||0,this.radius=n||0},t.Circle.prototype.clone=function(){return new t.Circle(this.x,this.y,this.radius)},t.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var n=this.x-t,i=this.y-e;return(n*=n)+(i*=i)<=this.radius*this.radius},t.Circle.prototype.getBounds=function(){return new t.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t.Circle.prototype.constructor=t.Circle,t.Ellipse=function(t,e,n,i){this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0},t.Ellipse.prototype.clone=function(){return new t.Ellipse(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=(t-this.x)/this.width,i=(e-this.y)/this.height;return(n*=n)+(i*=i)<=1},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},t.Ellipse.prototype.constructor=t.Ellipse,t.RoundedRectangle=function(t,e,n,i,r){this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0,this.radius=r||20},t.RoundedRectangle.prototype.clone=function(){return new t.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},t.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(t>=n&&t<=n+this.width){var i=this.y;if(e>=i&&e<=i+this.height)return!0}return!1},t.RoundedRectangle.prototype.constructor=t.RoundedRectangle,t.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},t.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.Matrix.prototype.toArray=function(e){this.array||(this.array=new t.Float32Array(9));var n=this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},t.Matrix.prototype.apply=function(e,n){return(n=n||new t.Point).x=this.a*e.x+this.c*e.y+this.tx,n.y=this.b*e.x+this.d*e.y+this.ty,n},t.Matrix.prototype.applyInverse=function(e,n){n=n||new t.Point;var i=1/(this.a*this.d+this.c*-this.b);return n.x=this.d*i*e.x+-this.c*i*e.y+(this.ty*this.c-this.tx*this.d)*i,n.y=this.a*i*e.y+-this.b*i*e.x+(-this.ty*this.a+this.tx*this.b)*i,n},t.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.Matrix.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),i=this.a,r=this.c,s=this.tx;return this.a=i*e-this.b*n,this.b=i*n+this.b*e,this.c=r*e-this.d*n,this.d=r*n+this.d*e,this.tx=s*e-this.ty*n,this.ty=s*n+this.ty*e,this},t.Matrix.prototype.append=function(t){var e=this.a,n=this.b,i=this.c,r=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*n+t.b*r,this.c=t.c*e+t.d*i,this.d=t.c*n+t.d*r,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*n+t.ty*r+this.ty,this},t.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.identityMatrix=new t.Matrix,t.DisplayObject=function(){this.position=new t.Point,this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new t.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],n=0;n<t.length;n++)for(var i=t[n].passes,r=0;r<i.length;r++)e.push(i[r]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),t.DisplayObject.prototype.updateTransform=function(){var e,n,i,r,s,a,o=this.parent.worldTransform,l=this.worldTransform;this.rotation%t.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,n=this._sr*this.scale.x,i=-this._sr*this.scale.y,r=this._cr*this.scale.y,s=this.position.x,a=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*e+this.pivot.y*i,a-=this.pivot.x*n+this.pivot.y*r),l.a=e*o.a+n*o.c,l.b=e*o.b+n*o.d,l.c=i*o.a+r*o.c,l.d=i*o.b+r*o.d,l.tx=s*o.a+a*o.c+o.tx,l.ty=s*o.b+a*o.d+o.ty):(e=this.scale.x,r=this.scale.y,s=this.position.x-this.pivot.x*e,a=this.position.y-this.pivot.y*r,l.a=e*o.a,l.b=e*o.b,l.c=r*o.c,l.d=r*o.d,l.tx=s*o.a+a*o.c+o.tx,l.ty=s*o.b+a*o.d+o.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.DisplayObject.prototype.displayObjectUpdateTransform=t.DisplayObject.prototype.updateTransform,t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0)},t.DisplayObject.prototype.generateTexture=function(e,n,i){var r=this.getLocalBounds(),s=new t.RenderTexture(0|r.width,0|r.height,i,n,e);return t.DisplayObject._tempMatrix.tx=-r.x,t.DisplayObject._tempMatrix.ty=-r.y,s.render(this,t.DisplayObject._tempMatrix),s},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},t.DisplayObject.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|e.width,0|e.height);else{var n=new t.RenderTexture(0|e.width,0|e.height);this._cachedSprite=new t.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform}var i=this._filters;this._filters=null,this._cachedSprite.filters=i,t.DisplayObject._tempMatrix.tx=-e.x,t.DisplayObject._tempMatrix.ty=-e.y,this._cachedSprite.texture.render(this,t.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._filters=i,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},t.DisplayObject.prototype._renderWebGL=function(t){t=t},t.DisplayObject.prototype._renderCanvas=function(t){t=t},t.DisplayObject._tempMatrix=new t.Matrix,Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),t.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var n=this.getChildIndex(t),i=this.getChildIndex(e);if(n<0||i<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[n]=e,this.children[i]=t}},t.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},t.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var n=this.getChildIndex(t);this.children.splice(n,1),this.children.splice(e,0,t)},t.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},t.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},t.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},t.DisplayObjectContainer.prototype.removeChildren=function(t,e){var n=t||0,i="number"==typeof e?e:this.children.length,r=i-n;if(r>0&&r<=i){for(var s=this.children.splice(n,r),a=0;a<s.length;a++){var o=s[a];this.stage&&o.removeStageReference(),o.parent=void 0}return s}if(0===r&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},t.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=t.DisplayObjectContainer.prototype.updateTransform,t.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return t.EmptyRectangle;for(var e,n,i,r=1/0,s=1/0,a=-1/0,o=-1/0,l=!1,h=0,c=this.children.length;h<c;h++)this.children[h].visible&&(l=!0,r=r<(e=this.children[h].getBounds()).x?r:e.x,s=s<e.y?s:e.y,a=a>(n=e.width+e.x)?a:n,o=o>(i=e.height+e.y)?o:i);if(!l)return t.EmptyRectangle;var u=this._bounds;return u.x=r,u.y=s,u.width=a-r,u.height=o-s,u},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var n=0,i=this.children.length;n<i;n++)this.children[n].updateTransform();var r=this.getBounds();return this.worldTransform=e,r},t.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].setStageReference(t)},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;t<e;t++)this.children[t].removeStageReference();this._interactive&&(this.stage.dirty=!0),this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(t){var e,n;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,n=this.children.length;e<n;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,n=this.children.length;e<n;e++)this.children[e]._renderWebGL(t)},t.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,n=this.children.length;e<n;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e||t.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),t.Sprite.prototype.setTexture=function(t){this.texture=t,this.cachedTint=16777215},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,n=this.texture.frame.height,i=e*(1-this.anchor.x),r=e*-this.anchor.x,s=n*(1-this.anchor.y),a=n*-this.anchor.y,o=t||this.worldTransform,l=o.a,h=o.b,c=o.c,u=o.d,d=o.tx,p=o.ty,f=-1/0,g=-1/0,m=1/0,v=1/0;if(0===h&&0===c)l<0&&(l*=-1),u<0&&(u*=-1),m=l*r+d,f=l*i+d,v=u*a+p,g=u*s+p;else{var _=l*r+c*a+d,y=u*a+h*r+p,x=l*i+c*a+d,b=u*a+h*i+p,w=l*i+c*s+d,S=u*s+h*i+p,M=l*r+c*s+d,T=u*s+h*r+p;m=M<(m=w<(m=x<(m=_<m?_:m)?x:m)?w:m)?M:m,v=T<(v=S<(v=b<(v=y<v?y:v)?b:v)?S:v)?T:v,f=M>(f=w>(f=x>(f=_>f?_:f)?x:f)?w:f)?M:f,g=T>(g=S>(g=b>(g=y>g?y:g)?b:g)?S:g)?T:g}var E=this._bounds;return E.x=m,E.width=f-m,E.y=v,E.height=g-v,this._currentBounds=E,E},t.Sprite.prototype._renderWebGL=function(t){var e,n;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){var i=t.spriteBatch;for(this._filters&&(i.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),t.maskManager.pushMask(this.mask,t),i.start()),i.render(this),e=0,n=this.children.length;e<n;e++)this.children[e]._renderWebGL(t);i.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),i.start()}else for(t.spriteBatch.render(this),e=0,n=this.children.length;e<n;e++)this.children[e]._renderWebGL(t)},t.Sprite.prototype._renderCanvas=function(e){if(!(!1===this.visible||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e),this.texture.valid){var n=this.texture.baseTexture.resolution/e.resolution;e.context.globalAlpha=this.worldAlpha,e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var i=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;e.roundPixels?(e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution|0,this.worldTransform.ty*e.resolution|0),i|=0,r|=0):e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution,this.worldTransform.ty*e.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,i/n,r/n,this.texture.crop.width/n,this.texture.crop.height/n)):e.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,i/n,r/n,this.texture.crop.width/n,this.texture.crop.height/n)}for(var s=0,a=this.children.length;s<a;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Sprite.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(n)},t.Sprite.fromImage=function(e,n,i){var r=t.Texture.fromImage(e,n,i);return new t.Sprite(r)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},t.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},t.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var n=this.worldTransform,i=!0,r=0;r<this.children.length;r++){var s=this.children[r];if(s.visible){var a=s.texture,o=a.frame;if(e.globalAlpha=this.worldAlpha*s.alpha,s.rotation%(2*Math.PI)==0)i&&(e.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),i=!1),e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,s.anchor.x*(-o.width*s.scale.x)+s.position.x+.5|0,s.anchor.y*(-o.height*s.scale.y)+s.position.y+.5|0,o.width*s.scale.x,o.height*s.scale.y);else{i||(i=!0),s.displayObjectUpdateTransform();var l=s.worldTransform;t.roundPixels?e.setTransform(l.a,l.b,l.c,l.d,0|l.tx,0|l.ty):e.setTransform(l.a,l.b,l.c,l.d,l.tx,l.ty),e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,s.anchor.x*-o.width+.5|0,s.anchor.y*-o.height+.5|0,o.width,o.height)}}}}},t.MovieClip=function(e){t.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},t.MovieClip.prototype=Object.create(t.Sprite.prototype),t.MovieClip.prototype.constructor=t.MovieClip,Object.defineProperty(t.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),t.MovieClip.prototype.stop=function(){this.playing=!1},t.MovieClip.prototype.play=function(){this.playing=!0},t.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])},t.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},t.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},t.MovieClip.fromFrames=function(e){for(var n=[],i=0;i<e.length;i++)n.push(new t.Texture.fromFrame(e[i]));return new t.MovieClip(n)},t.MovieClip.fromImages=function(e){for(var n=[],i=0;i<e.length;i++)n.push(new t.Texture.fromImage(e[i]));return new t.MovieClip(n)},t.FilterBlock=function(){this.visible=!0,this.renderable=!0},t.FilterBlock.prototype.constructor=t.FilterBlock,t.Text=function(e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(n)},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),t.Text.prototype.setStyle=function(t){(t=t||{}).font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black",t.lineJoin=t.lineJoin||"miter",this.style=t,this.dirty=!0},t.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),n=[],i=0,r=this.determineFontProperties(this.style.font),s=0;s<e.length;s++){var a=this.context.measureText(e[s]).width;n[s]=a,i=Math.max(i,a)}var o=i+this.style.strokeThickness;this.style.dropShadow&&(o+=this.style.dropShadowDistance),this.canvas.width=(o+this.context.lineWidth)*this.resolution;var l,h,c=r.fontSize+this.style.strokeThickness,u=c*e.length;if(this.style.dropShadow&&(u+=this.style.dropShadowDistance),this.canvas.height=u*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin=this.style.lineJoin,this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(s=0;s<e.length;s++)l=this.style.strokeThickness/2,h=this.style.strokeThickness/2+s*c+r.ascent,"right"===this.style.align?l+=i-n[s]:"center"===this.style.align&&(l+=(i-n[s])/2),this.style.fill&&this.context.fillText(e[s],l+d,h+p)}for(this.context.fillStyle=this.style.fill,s=0;s<e.length;s++)l=this.style.strokeThickness/2,h=this.style.strokeThickness/2+s*c+r.ascent,"right"===this.style.align?l+=i-n[s]:"center"===this.style.align&&(l+=(i-n[s])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[s],l,h),this.style.fill&&this.context.fillText(e[s],l,h);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},t.Text.prototype._renderWebGL=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype._renderCanvas=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderCanvas.call(this,e)},t.Text.prototype.determineFontProperties=function(e){var n=t.Text.fontPropertiesCache[e];if(!n){n={};var i=t.Text.fontPropertiesCanvas,r=t.Text.fontPropertiesContext;r.font=e;var s=Math.ceil(r.measureText("|Mq").width),a=Math.ceil(r.measureText("M").width),o=2*a;a=1.4*a|0,i.width=s,i.height=o,r.fillStyle="#f00",r.fillRect(0,0,s,o),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|Mq",0,a);var l,h,c=r.getImageData(0,0,s,o).data,u=c.length,d=4*s,p=0,f=!1;for(l=0;l<a;l++){for(h=0;h<d;h+=4)if(255!==c[p+h]){f=!0;break}if(f)break;p+=d}for(n.ascent=a-l,p=u-d,f=!1,l=o;l>a;l--){for(h=0;h<d;h+=4)if(255!==c[p+h]){f=!0;break}if(f)break;p-=d}n.descent=l-a,n.descent+=6,n.fontSize=n.ascent+n.descent,t.Text.fontPropertiesCache[e]=n}return n},t.Text.prototype.wordWrap=function(t){for(var e="",n=t.split("\n"),i=0;i<n.length;i++){for(var r=this.style.wordWrapWidth,s=n[i].split(" "),a=0;a<s.length;a++){var o=this.context.measureText(s[a]).width,l=o+this.context.measureText(" ").width;0===a||l>r?(a>0&&(e+="\n"),e+=s[a],r=this.style.wordWrapWidth-o):(r-=l,e+=" "+s[a])}i<n.length-1&&(e+="\n")}return e},t.Text.prototype.getBounds=function(e){return this.dirty&&(this.updateText(),this.dirty=!1),t.Sprite.prototype.getBounds.call(this,e)},t.Text.prototype.destroy=function(t){this.context=null,this.canvas=null,this.texture.destroy(void 0===t||t)},t.Text.fontPropertiesCache={},t.Text.fontPropertiesCanvas=document.createElement("canvas"),t.Text.fontPropertiesContext=t.Text.fontPropertiesCanvas.getContext("2d"),t.BitmapText=function(e,n){t.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(e),this.setStyle(n),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){(e=e||{}).align=e.align||"left",this.style=e;var n=e.font.split(" ");this.fontName=n[n.length-1],this.fontSize=n.length>=2?parseInt(n[n.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){for(var e=t.BitmapText.fonts[this.fontName],n=new t.Point,i=null,r=[],s=0,a=[],o=0,l=this.fontSize/e.size,h=0;h<this.text.length;h++){var c=this.text.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(h)))a.push(n.x),s=Math.max(s,n.x),o++,n.x=0,n.y+=e.lineHeight,i=null;else{var u=e.chars[c];u&&(i&&u.kerning[i]&&(n.x+=u.kerning[i]),r.push({texture:u.texture,line:o,charCode:c,position:new t.Point(n.x+u.xOffset,n.y+u.yOffset)}),n.x+=u.xAdvance,i=c)}}a.push(n.x),s=Math.max(s,n.x);var d=[];for(h=0;h<=o;h++){var p=0;"right"===this.style.align?p=s-a[h]:"center"===this.style.align&&(p=(s-a[h])/2),d.push(p)}var f=this.children.length,g=r.length,m=this.tint||16777215;for(h=0;h<g;h++){var v=h<f?this.children[h]:this._pool.pop();v?v.setTexture(r[h].texture):v=new t.Sprite(r[h].texture),v.position.x=(r[h].position.x+d[r[h].line])*l,v.position.y=r[h].position.y*l,v.scale.x=v.scale.y=l,v.tint=m,v.parent||this.addChild(v)}for(;this.children.length>g;){var _=this.getChildAt(this.children.length-1);this._pool.push(_),this.removeChild(_)}this.textWidth=s*l,this.textHeight=(n.y+e.lineHeight)*l},t.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.InteractionData=function(){this.global=new t.Point,this.target=null,this.originalEvent=null},t.InteractionData.prototype.getLocalPosition=function(e,n,i){var r=e.worldTransform,s=i||this.global,a=r.a,o=r.c,l=r.tx,h=r.b,c=r.d,u=r.ty,d=1/(a*c+o*-h);return(n=n||new t.Point).x=c*d*s.x+-o*d*s.y+(u*o-l*c)*d,n.y=a*d*s.y+-h*d*s.x+(-u*a+l*h)*d,n},t.InteractionData.prototype.constructor=t.InteractionData,t.InteractionManager=function(e){this.stage=e,this.mouse=new t.InteractionData,this.touches={},this.tempPoint=new t.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new t.Point},t.InteractionManager.prototype.constructor=t.InteractionManager,t.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var n=t.children,i=n.length-1;i>=0;i--){var r=n[i];r._interactive?(e.interactiveChildren=!0,this.interactiveItems.push(r),r.children.length>0&&this.collectInteractiveSprite(r,r)):(r.__iParent=null,r.children.length>0&&this.collectInteractiveSprite(r,e))}},t.InteractionManager.prototype.setTarget=function(t){this.target=t,this.resolution=t.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(t.view)},t.InteractionManager.prototype.setTargetDomElement=function(t){this.removeEvents(),window.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none"),this.interactionDOMElement=t,t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseout",this.onMouseOut,!0),t.addEventListener("touchstart",this.onTouchStart,!0),t.addEventListener("touchend",this.onTouchEnd,!0),t.addEventListener("touchleave",this.onTouchCancel,!0),t.addEventListener("touchcancel",this.onTouchCancel,!0),t.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},t.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchleave",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},t.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),n=e-this.last;if(!((n=n*t.INTERACTION_FREQUENCY/1e3)<1)){this.last=e;var i=0;this.dirty&&this.rebuildInteractiveGraph();var r=this.interactiveItems.length,s="inherit",a=!1;for(i=0;i<r;i++){var o=this.interactiveItems[i];o.__hit=this.hitTest(o,this.mouse),this.mouse.target=o,o.__hit&&!a?(o.buttonMode&&(s=o.defaultCursor),o.interactiveChildren||(a=!0),o.__isOver||(o.mouseover&&o.mouseover(this.mouse),o.__isOver=!0)):o.__isOver&&(o.mouseout&&o.mouseout(this.mouse),o.__isOver=!1)}this.currentCursorStyle!==s&&(this.currentCursorStyle=s,this.interactionDOMElement.style.cursor=s)}}},t.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,e=0;e<t;e++)this.interactiveItems[e].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},t.InteractionManager.prototype.onMouseMove=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width)/this.resolution,this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height)/this.resolution;for(var n=this.interactiveItems.length,i=0;i<n;i++){var r=this.interactiveItems[i];r.mousemove&&r.mousemove(this.mouse)}},t.InteractionManager.prototype.onMouseDown=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e,t.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var n=this.interactiveItems.length,i=this.mouse.originalEvent,r=2===i.button||3===i.which,s=r?"rightdown":"mousedown",a=r?"rightclick":"click",o=r?"__rightIsDown":"__mouseIsDown",l=r?"__isRightDown":"__isDown",h=0;h<n;h++){var c=this.interactiveItems[h];if((c[s]||c[a])&&(c[o]=!0,c.__hit=this.hitTest(c,this.mouse),c.__hit&&(c[s]&&c[s](this.mouse),c[l]=!0,!c.interactiveChildren)))break}},t.InteractionManager.prototype.onMouseOut=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var n=0;n<e;n++){var i=this.interactiveItems[n];i.__isOver&&(this.mouse.target=i,i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},t.InteractionManager.prototype.onMouseUp=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;for(var e=this.interactiveItems.length,n=!1,i=this.mouse.originalEvent,r=2===i.button||3===i.which,s=r?"rightup":"mouseup",a=r?"rightclick":"click",o=r?"rightupoutside":"mouseupoutside",l=r?"__isRightDown":"__isDown",h=0;h<e;h++){var c=this.interactiveItems[h];(c[a]||c[s]||c[o])&&(c.__hit=this.hitTest(c,this.mouse),c.__hit&&!n?(c[s]&&c[s](this.mouse),c[l]&&c[a]&&c[a](this.mouse),c.interactiveChildren||(n=!0)):c[l]&&c[o]&&c[o](this.mouse),c[l]=!1)}},t.InteractionManager.prototype.hitTest=function(e,n){var i=n.global;if(!e.worldVisible)return!1;e.worldTransform.applyInverse(i,this._tempPoint);var r,s=this._tempPoint.x,a=this._tempPoint.y;if(n.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(s,a);if(e instanceof t.Sprite){var o,l=e.texture.frame.width,h=e.texture.frame.height,c=-l*e.anchor.x;if(s>c&&s<c+l&&a>(o=-h*e.anchor.y)&&a<o+h)return!0}else if(e instanceof t.Graphics){var u=e.graphicsData;for(r=0;r<u.length;r++){var d=u[r];if(d.fill&&d.shape&&d.shape.contains(s,a))return!0}}var p=e.children.length;for(r=0;r<p;r++){var f=e.children[r];if(this.hitTest(f,n))return n.target=e,!0}return!1},t.InteractionManager.prototype.onTouchMove=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,n,i=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,s=r.length,a=this.target.width/i.width,o=this.target.height/i.height,l=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,h=0;h<s;h++)n=r[h],l?(n.globalX=n.clientX,n.globalY=n.clientY):(n.globalX=(n.clientX-i.left)*a/this.resolution,n.globalY=(n.clientY-i.top)*o/this.resolution);for(var c=0;c<s;c++){n=r[c],(e=this.touches[n.identifier]).originalEvent=t,l?(e.global.x=n.clientX,e.global.y=n.clientY):(n.globalX=e.global.x=(n.clientX-i.left)*a/this.resolution,n.globalY=e.global.y=(n.clientY-i.top)*o/this.resolution);for(var u=0;u<this.interactiveItems.length;u++){var d=this.interactiveItems[u];d.touchmove&&d.__touchData&&d.__touchData[n.identifier]&&d.touchmove(e)}}},t.InteractionManager.prototype.onTouchStart=function(e){this.dirty&&this.rebuildInteractiveGraph();var n=this.interactionDOMElement.getBoundingClientRect();t.AUTO_PREVENT_DEFAULT&&e.preventDefault();for(var i,r=e.changedTouches,s=r.length,a=this.target.width/n.width,o=this.target.height/n.height,l=navigator.isCocoonJS&&!n.left&&!n.top&&!e.target.style.width&&!e.target.style.height,h=0;h<s;h++)i=r[h],l?(i.globalX=i.clientX,i.globalY=i.clientY):(i.globalX=(i.clientX-n.left)*a/this.resolution,i.globalY=(i.clientY-n.top)*o/this.resolution);for(var c=0;c<s;c++){i=r[c];var u=this.pool.pop();u||(u=new t.InteractionData),u.originalEvent=e,this.touches[i.identifier]=u,l?(u.global.x=i.clientX,u.global.y=i.clientY):(u.global.x=(i.clientX-n.left)*a/this.resolution,u.global.y=(i.clientY-n.top)*o/this.resolution);for(var d=this.interactiveItems.length,p=0;p<d;p++){var f=this.interactiveItems[p];if((f.touchstart||f.tap)&&(f.__hit=this.hitTest(f,u),f.__hit&&(f.touchstart&&f.touchstart(u),f.__isDown=!0,f.__touchData=f.__touchData||{},f.__touchData[i.identifier]=u,!f.interactiveChildren)))break}}},t.InteractionManager.prototype.onTouchEnd=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,n=this.interactionDOMElement.getBoundingClientRect(),i=t.changedTouches,r=i.length,s=this.target.width/n.width,a=this.target.height/n.height,o=navigator.isCocoonJS&&!n.left&&!n.top&&!t.target.style.width&&!t.target.style.height,l=0;l<r;l++)e=i[l],o?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-n.left)*s/this.resolution,e.globalY=(e.clientY-n.top)*a/this.resolution);for(var h=0;h<r;h++){e=i[h];var c=this.touches[e.identifier],u=!1;o?(c.global.x=e.clientX,c.global.y=e.clientY):(c.global.x=(e.clientX-n.left)*s/this.resolution,c.global.y=(e.clientY-n.top)*a/this.resolution);for(var d=this.interactiveItems.length,p=0;p<d;p++){var f=this.interactiveItems[p];f.__touchData&&f.__touchData[e.identifier]&&(f.__hit=this.hitTest(f,f.__touchData[e.identifier]),c.originalEvent=t,(f.touchend||f.tap)&&(f.__hit&&!u?(f.touchend&&f.touchend(c),f.__isDown&&f.tap&&f.tap(c),f.interactiveChildren||(u=!0)):f.__isDown&&f.touchendoutside&&f.touchendoutside(c),f.__isDown=!1),f.__touchData[e.identifier]=null)}this.pool.push(c),this.touches[e.identifier]=null}},t.InteractionManager.prototype.onTouchCancel=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,n=this.interactionDOMElement.getBoundingClientRect(),i=t.changedTouches,r=i.length,s=this.target.width/n.width,a=this.target.height/n.height,o=navigator.isCocoonJS&&!n.left&&!n.top&&!t.target.style.width&&!t.target.style.height,l=0;l<r;l++)e=i[l],o?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-n.left)*s/this.resolution,e.globalY=(e.clientY-n.top)*a/this.resolution);for(var h=0;h<r;h++){e=i[h];var c=this.touches[e.identifier],u=!1;o?(c.global.x=e.clientX,c.global.y=e.clientY):(c.global.x=(e.clientX-n.left)*s/this.resolution,c.global.y=(e.clientY-n.top)*a/this.resolution);for(var d=this.interactiveItems.length,p=0;p<d;p++){var f=this.interactiveItems[p];f.__touchData&&f.__touchData[e.identifier]&&(f.__hit=this.hitTest(f,f.__touchData[e.identifier]),c.originalEvent=t,f.touchcancel&&!u&&(f.touchcancel(c),f.interactiveChildren||(u=!0)),f.__isDown=!1,f.__touchData[e.identifier]=null)}this.pool.push(c),this.touches[e.identifier]=null}},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.interactive=!0,this.interactionManager=new t.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(t){for(var e=0,n=["ms","moz","webkit","o"],i=0;i<n.length&&!t.requestAnimationFrame;++i)t.requestAnimationFrame=t[n[i]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[i]+"CancelAnimationFrame"]||t[n[i]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(n){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),s=t.setTimeout(function(){n(i+r)},r);return e=i+r,s}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),t.requestAnimFrame=t.requestAnimationFrame}(this),t.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},t.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(t){var e=this,n=arguments.length-1,i=[];if(n>0)for(i.length=n;n--;)i[n]=arguments[n+1];if("function"!=typeof e)throw new TypeError;function r(){for(var n=arguments.length,s=new Array(n);n--;)s[n]=arguments[n];return s=i.concat(s),e.apply(this instanceof r?this:t,s)}return r.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(e.prototype),r}),t.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return!!window.XMLHttpRequest&&new window.XMLHttpRequest;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(t){}},t.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),0===e.getImageData(0,0,1,1).data[0]},t.getNextPowerOfTwo=function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},t.isPowerOfTwo=function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},t.EventTarget={call:function(e){e&&(e=e.prototype||e,t.EventTarget.mixin(e))},mixin:function(e){e.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},e.emit=e.dispatchEvent=function(e,n){if(this._listeners=this._listeners||{},"object"==typeof e&&(n=e,e=e.type),n&&!0===n.__isEventObject||(n=new t.Event(this,e,n)),this._listeners&&this._listeners[e]){var i,r=this._listeners[e].slice(0),s=r.length,a=r[0];for(i=0;i<s;a=r[++i])if(a.call(this,n),n.stoppedImmediate)return this;if(n.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,e,n),this},e.on=e.addEventListener=function(t,e){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(e),this},e.once=function(t,e){this._listeners=this._listeners||{};var n=this;function i(){e.apply(n.off(t,i),arguments)}return i._originalHandler=e,this.on(t,i)},e.off=e.removeEventListener=function(t,e){if(this._listeners=this._listeners||{},!this._listeners[t])return this;for(var n=this._listeners[t],i=e?n.length:0;i-- >0;)n[i]!==e&&n[i]._originalHandler!==e||n.splice(i,1);return 0===n.length&&delete this._listeners[t],this},e.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},t.Event=function(t,e,n){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=t,this.type=e,this.data=n,this.content=n,this.timeStamp=Date.now()},t.Event.prototype.stopPropagation=function(){this.stopped=!0},t.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},t.autoDetectRenderer=function(e,n,i){return e||(e=800),n||(n=600),function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}()?new t.WebGLRenderer(e,n,i):new t.CanvasRenderer(e,n,i)},t.autoDetectRecommendedRenderer=function(e,n,i){e||(e=800),n||(n=600);var r=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),s=/Android/i.test(navigator.userAgent);return r&&!s?new t.WebGLRenderer(e,n,i):new t.CanvasRenderer(e,n,i)},t.PolyK={},t.PolyK.Triangulate=function(e){var n=!0,i=e.length>>1;if(i<3)return[];for(var r=[],s=[],a=0;a<i;a++)s.push(a);a=0;for(var o=i;o>3;){var l=s[(a+0)%o],h=s[(a+1)%o],c=s[(a+2)%o],u=e[2*l],d=e[2*l+1],p=e[2*h],f=e[2*h+1],g=e[2*c],m=e[2*c+1],v=!1;if(t.PolyK._convex(u,d,p,f,g,m,n)){v=!0;for(var _=0;_<o;_++){var y=s[_];if(y!==l&&y!==h&&y!==c&&t.PolyK._PointInTriangle(e[2*y],e[2*y+1],u,d,p,f,g,m)){v=!1;break}}}if(v)r.push(l,h,c),s.splice((a+1)%o,1),o--,a=0;else if(a++>3*o){if(!n)return null;for(r=[],s=[],a=0;a<i;a++)s.push(a);a=0,o=i,n=!1}}return r.push(s[0],s[1],s[2]),r},t.PolyK._PointInTriangle=function(t,e,n,i,r,s,a,o){var l=a-n,h=o-i,c=r-n,u=s-i,d=t-n,p=e-i,f=l*l+h*h,g=l*c+h*u,m=l*d+h*p,v=c*c+u*u,_=c*d+u*p,y=1/(f*v-g*g),x=(v*m-g*_)*y,b=(f*_-g*m)*y;return x>=0&&b>=0&&x+b<1},t.PolyK._convex=function(t,e,n,i,r,s,a){return(e-i)*(r-n)+(n-t)*(s-i)>=0===a},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,n){return t._CompileShader(e,n,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,n){return t._CompileShader(e,n,e.FRAGMENT_SHADER)},t._CompileShader=function(t,e,n){var i=e.join("\n"),r=t.createShader(n);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(window.console.log(t.getShaderInfoLog(r)),null)},t.compileProgram=function(e,n,i){var r=t.CompileFragmentShader(e,i),s=t.CompileVertexShader(e,n),a=e.createProgram();return e.attachShader(a,s),e.attachShader(a,r),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),a},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},t.PixiShader.prototype.constructor=t.PixiShader,t.PixiShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);for(var i in e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[i].uniformLocation=e.getUniformLocation(n,i);this.initUniforms(),this.program=n},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var n in this.uniforms){var i=(t=this.uniforms[n]).type;"sampler2D"===i?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===i||"mat3"===i||"mat4"===i?(t.glMatrix=!0,t.glValueLength=1,"mat2"===i?t.glFunc=e.uniformMatrix2fv:"mat3"===i?t.glFunc=e.uniformMatrix3fv:"mat4"===i&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+i],t.glValueLength="2f"===i||"2i"===i?2:"3f"===i||"3i"===i?3:"4f"===i||"4i"===i?4:1)}},t.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var n=t.textureData,i=n.magFilter?n.magFilter:e.LINEAR,r=n.minFilter?n.minFilter:e.LINEAR,s=n.wrapS?n.wrapS:e.CLAMP_TO_EDGE,a=n.wrapT?n.wrapT:e.CLAMP_TO_EDGE,o=n.luminance?e.LUMINANCE:e.RGBA;if(n.repeat&&(s=e.REPEAT,a=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!n.flipY),n.width){var l=n.width?n.width:512,h=n.height?n.height:2,c=n.border?n.border:0;e.texImage2D(e.TEXTURE_2D,0,o,l,h,c,o,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){var e;this.textureCount=1;var n=this.gl;for(var i in this.uniforms)1===(e=this.uniforms[i]).glValueLength?!0===e.glMatrix?e.glFunc.call(n,e.uniformLocation,e.transpose,e.value):e.glFunc.call(n,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(n.activeTexture(n["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty.length<=n.id||e.value.baseTexture._dirty[n.id]?t.instances[n.id].updateTexture(e.value.baseTexture):n.bindTexture(n.TEXTURE_2D,e.value.baseTexture._glTextures[n.id]),n.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.constructor=t.PixiFastShader,t.PixiFastShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.uMatrix=e.getUniformLocation(n,"uMatrix"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(n,"aPositionCoord"),this.aScale=e.getAttribLocation(n,"aScale"),this.aRotation=e.getAttribLocation(n,"aRotation"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=n},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.constructor=t.StripShader,t.StripShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.constructor=t.PrimitiveShader,t.PrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.flipY=e.getUniformLocation(n,"flipY"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.constructor=t.ComplexPrimitiveShader,t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.color=e.getUniformLocation(n,"color"),this.flipY=e.getUniformLocation(n,"flipY"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,n){var i,r=n.gl,s=n.projection,a=n.offset,o=n.shaderManager.primitiveShader;e.dirty&&t.WebGLGraphics.updateGraphics(e,r);for(var l=e._webGL[r.id],h=0;h<l.data.length;h++)1===l.data[h].mode?(i=l.data[h],n.stencilManager.pushStencil(e,i,n),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(i.indices.length-4)),n.stencilManager.popStencil(e,i,n)):(i=l.data[h],n.shaderManager.setShader(o),o=n.shaderManager.primitiveShader,r.uniformMatrix3fv(o.translationMatrix,!1,e.worldTransform.toArray(!0)),r.uniform1f(o.flipY,1),r.uniform2f(o.projectionVector,s.x,-s.y),r.uniform2f(o.offsetVector,-a.x,-a.y),r.uniform3fv(o.tintColor,t.hex2rgb(e.tint)),r.uniform1f(o.alpha,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,i.buffer),r.vertexAttribPointer(o.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(o.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,i.indices.length,r.UNSIGNED_SHORT,0))},t.WebGLGraphics.updateGraphics=function(e,n){var i,r,s=e._webGL[n.id];if(s||(s=e._webGL[n.id]={lastIndex:0,data:[],gl:n}),e.dirty=!1,e.clearDirty){for(e.clearDirty=!1,i=0;i<s.data.length;i++){var a=s.data[i];a.reset(),t.WebGLGraphics.graphicsDataPool.push(a)}s.data=[],s.lastIndex=0}for(i=s.lastIndex;i<e.graphicsData.length;i++){var o=e.graphicsData[i];o.type===t.Graphics.POLY?(o.points=o.shape.points.slice(),o.shape.closed&&(o.points[0]===o.points[o.points.length-2]&&o.points[1]===o.points[o.points.length-1]||o.points.push(o.points[0],o.points[1])),o.fill&&o.points.length>=6&&(o.points.length<12?(r=t.WebGLGraphics.switchMode(s,0),t.WebGLGraphics.buildPoly(o,r)||(r=t.WebGLGraphics.switchMode(s,1),t.WebGLGraphics.buildComplexPoly(o,r))):(r=t.WebGLGraphics.switchMode(s,1),t.WebGLGraphics.buildComplexPoly(o,r))),o.lineWidth>0&&(r=t.WebGLGraphics.switchMode(s,0),t.WebGLGraphics.buildLine(o,r))):(r=t.WebGLGraphics.switchMode(s,0),o.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(o,r):o.type===t.Graphics.CIRC||o.type===t.Graphics.ELIP?t.WebGLGraphics.buildCircle(o,r):o.type===t.Graphics.RREC&&t.WebGLGraphics.buildRoundedRectangle(o,r)),s.lastIndex++}for(i=0;i<s.data.length;i++)(r=s.data[i]).dirty&&r.upload()},t.WebGLGraphics.switchMode=function(e,n){var i;return e.data.length&&(i=e.data[e.data.length-1]).mode===n&&1!==n||((i=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl)).mode=n,e.data.push(i)),i.dirty=!0,i},t.WebGLGraphics.buildRectangle=function(e,n){var i=e.shape,r=i.x,s=i.y,a=i.width,o=i.height;if(e.fill){var l=t.hex2rgb(e.fillColor),h=e.fillAlpha,c=l[0]*h,u=l[1]*h,d=l[2]*h,p=n.points,f=n.indices,g=p.length/6;p.push(r,s),p.push(c,u,d,h),p.push(r+a,s),p.push(c,u,d,h),p.push(r,s+o),p.push(c,u,d,h),p.push(r+a,s+o),p.push(c,u,d,h),f.push(g,g,g+1,g+2,g+3,g+3)}if(e.lineWidth){var m=e.points;e.points=[r,s,r+a,s,r+a,s+o,r,s+o,r,s],t.WebGLGraphics.buildLine(e,n),e.points=m}},t.WebGLGraphics.buildRoundedRectangle=function(e,n){var i=e.shape,r=i.x,s=i.y,a=i.width,o=i.height,l=i.radius,h=[];if(h.push(r,s+l),h=(h=(h=(h=h.concat(t.WebGLGraphics.quadraticBezierCurve(r,s+o-l,r,s+o,r+l,s+o))).concat(t.WebGLGraphics.quadraticBezierCurve(r+a-l,s+o,r+a,s+o,r+a,s+o-l))).concat(t.WebGLGraphics.quadraticBezierCurve(r+a,s+l,r+a,s,r+a-l,s))).concat(t.WebGLGraphics.quadraticBezierCurve(r+l,s,r,s,r,s+l)),e.fill){var c=t.hex2rgb(e.fillColor),u=e.fillAlpha,d=c[0]*u,p=c[1]*u,f=c[2]*u,g=n.points,m=n.indices,v=g.length/6,_=t.PolyK.Triangulate(h),y=0;for(y=0;y<_.length;y+=3)m.push(_[y]+v),m.push(_[y]+v),m.push(_[y+1]+v),m.push(_[y+2]+v),m.push(_[y+2]+v);for(y=0;y<h.length;y++)g.push(h[y],h[++y],d,p,f,u)}if(e.lineWidth){var x=e.points;e.points=h,t.WebGLGraphics.buildLine(e,n),e.points=x}},t.WebGLGraphics.quadraticBezierCurve=function(t,e,n,i,r,s){var a,o,l,h,c,u,d=[];function p(t,e,n){return t+(e-t)*n}for(var f=0,g=0;g<=20;g++)a=p(t,n,f=g/20),o=p(e,i,f),l=p(n,r,f),h=p(i,s,f),c=p(a,l,f),u=p(o,h,f),d.push(c,u);return d},t.WebGLGraphics.buildCircle=function(e,n){var i,r,s=e.shape,a=s.x,o=s.y;e.type===t.Graphics.CIRC?(i=s.radius,r=s.radius):(i=s.width,r=s.height);var l=2*Math.PI/40,h=0;if(e.fill){var c=t.hex2rgb(e.fillColor),u=e.fillAlpha,d=c[0]*u,p=c[1]*u,f=c[2]*u,g=n.points,m=n.indices,v=g.length/6;for(m.push(v),h=0;h<41;h++)g.push(a,o,d,p,f,u),g.push(a+Math.sin(l*h)*i,o+Math.cos(l*h)*r,d,p,f,u),m.push(v++,v++);m.push(v-1)}if(e.lineWidth){var _=e.points;for(e.points=[],h=0;h<41;h++)e.points.push(a+Math.sin(l*h)*i,o+Math.cos(l*h)*r);t.WebGLGraphics.buildLine(e,n),e.points=_}},t.WebGLGraphics.buildLine=function(e,n){var i=0,r=e.points;if(0!==r.length){if(e.lineWidth%2)for(i=0;i<r.length;i++)r[i]+=.5;var s=new t.Point(r[0],r[1]),a=new t.Point(r[r.length-2],r[r.length-1]);if(s.x===a.x&&s.y===a.y){(r=r.slice()).pop(),r.pop();var o=(a=new t.Point(r[r.length-2],r[r.length-1])).x+.5*(s.x-a.x),l=a.y+.5*(s.y-a.y);r.unshift(o,l),r.push(o,l)}var h,c,u,d,p,f,g,m,v,_,y,x,b,w,S,M,T,E,C,A,R,L,P=n.points,k=n.indices,D=r.length/2,I=r.length,O=P.length/6,B=e.lineWidth/2,F=t.hex2rgb(e.lineColor),N=e.lineAlpha,U=F[0]*N,z=F[1]*N,G=F[2]*N;for(u=r[0],d=r[1],p=r[2],v=-(d-(f=r[3])),_=u-p,v/=L=Math.sqrt(v*v+_*_),_/=L,v*=B,_*=B,P.push(u-v,d-_,U,z,G,N),P.push(u+v,d+_,U,z,G,N),i=1;i<D-1;i++)u=r[2*(i-1)],d=r[2*(i-1)+1],p=r[2*i],f=r[2*i+1],g=r[2*(i+1)],m=r[2*(i+1)+1],v=-(d-f),_=u-p,v/=L=Math.sqrt(v*v+_*_),_/=L,v*=B,_*=B,y=-(f-m),x=p-g,y/=L=Math.sqrt(y*y+x*x),x/=L,T=(-v+u)*(-_+f)-(-v+p)*(-_+d),A=(-(y*=B)+g)*(-(x*=B)+f)-(-y+p)*(-x+m),R=(S=-_+d-(-_+f))*(C=-y+p-(-y+g))-(E=-x+m-(-x+f))*(M=-v+p-(-v+u)),Math.abs(R)<.1?(R+=10.1,P.push(p-v,f-_,U,z,G,N),P.push(p+v,f+_,U,z,G,N)):((h=(M*A-C*T)/R)-p)*(h-p)+((c=(E*T-S*A)/R)-f)+(c-f)>19600?(b=v-y,w=_-x,b/=L=Math.sqrt(b*b+w*w),w/=L,b*=B,w*=B,P.push(p-b,f-w),P.push(U,z,G,N),P.push(p+b,f+w),P.push(U,z,G,N),P.push(p-b,f-w),P.push(U,z,G,N),I++):(P.push(h,c),P.push(U,z,G,N),P.push(p-(h-p),f-(c-f)),P.push(U,z,G,N));for(u=r[2*(D-2)],d=r[2*(D-2)+1],p=r[2*(D-1)],v=-(d-(f=r[2*(D-1)+1])),_=u-p,v/=L=Math.sqrt(v*v+_*_),_/=L,v*=B,_*=B,P.push(p-v,f-_),P.push(U,z,G,N),P.push(p+v,f+_),P.push(U,z,G,N),k.push(O),i=0;i<I;i++)k.push(O++);k.push(O-1)}},t.WebGLGraphics.buildComplexPoly=function(e,n){var i=e.points.slice();if(!(i.length<6)){var r=n.indices;n.points=i,n.alpha=e.fillAlpha,n.color=t.hex2rgb(e.fillColor);for(var s,a,o=1/0,l=-1/0,h=1/0,c=-1/0,u=0;u<i.length;u+=2)o=(s=i[u])<o?s:o,l=s>l?s:l,h=(a=i[u+1])<h?a:h,c=a>c?a:c;i.push(o,h,l,h,l,c,o,c);var d=i.length/2;for(u=0;u<d;u++)r.push(u)}},t.WebGLGraphics.buildPoly=function(e,n){var i=e.points;if(!(i.length<6)){var r=n.points,s=n.indices,a=i.length/2,o=t.hex2rgb(e.fillColor),l=e.fillAlpha,h=o[0]*l,c=o[1]*l,u=o[2]*l,d=t.PolyK.Triangulate(i);if(!d)return!1;var p=r.length/6,f=0;for(f=0;f<d.length;f+=3)s.push(d[f]+p),s.push(d[f]+p),s.push(d[f+1]+p),s.push(d[f+2]+p),s.push(d[f+2]+p);for(f=0;f<a;f++)r.push(i[2*f],i[2*f+1],h,c,u,l);return!0}},t.WebGLGraphics.graphicsDataPool=[],t.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},t.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},t.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new t.Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new t.Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},t.glContexts=[],t.instances=[],t.WebGLRenderer=function(e,n,i){if(i)for(var r in t.defaultRenderOptions)void 0===i[r]&&(i[r]=t.defaultRenderOptions[r]);else i=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("webGL"),t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.resolution=i.resolution,this.transparent=i.transparent,this.autoResize=i.autoResize||!1,this.preserveDrawingBuffer=i.preserveDrawingBuffer,this.clearBeforeRender=i.clearBeforeRender,this.width=e||800,this.height=n||600,this.view=i.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.projection=new t.Point,this.offset=new t.Point(0,0),this.shaderManager=new t.WebGLShaderManager,this.spriteBatch=new t.WebGLSpriteBatch,this.maskManager=new t.WebGLMaskManager,this.filterManager=new t.WebGLFilterManager,this.stencilManager=new t.WebGLStencilManager,this.blendModeManager=new t.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.initContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=e,!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=e.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=e,t.instances[this.glContextId]=this,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.shaderManager.setContext(e),this.spriteBatch.setContext(e),this.maskManager.setContext(e),this.filterManager.setContext(e),this.blendModeManager.setContext(e),this.stencilManager.setContext(e),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},t.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},t.WebGLRenderer.prototype.renderDisplayObject=function(e,n,i){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=i?-1:1,this.renderSession.projection=n,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,i),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},t.WebGLRenderer.prototype.updateTexture=function(e){if(e.hasLoaded){var n=this.gl;return e._glTextures[n.id]||(e._glTextures[n.id]=n.createTexture()),n.bindTexture(n.TEXTURE_2D,e._glTextures[n.id]),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e.source),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e.mipmap&&t.isPowerOfTwo(e.width,e.height)?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST),n.generateMipmap(n.TEXTURE_2D)):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e._powerOf2?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),e._dirty[n.id]=!1,e._glTextures[n.id]}},t.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){for(var e in this.initContext(),t.TextureCache)t.TextureCache[e].baseTexture._glTextures=[];this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null,this.renderSession=null},t.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[e.SRC_ALPHA,e.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA])},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(){this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.constructor=t.WebGLBlendModeManager,t.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var n=t.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(n[0],n[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(){},t.WebGLMaskManager.prototype.constructor=t.WebGLMaskManager,t.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},t.WebGLMaskManager.prototype.pushMask=function(e,n){var i=n.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,i),e._webGL[i.id].data.length&&n.stencilManager.pushStencil(e,e._webGL[i.id].data[0],n)},t.WebGLMaskManager.prototype.popMask=function(t,e){var n=this.gl;e.stencilManager.popStencil(t,t._webGL[n.id].data[0],e)},t.WebGLMaskManager.prototype.destroy=function(){this.gl=null},t.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},t.WebGLStencilManager.prototype.pushStencil=function(t,e,n){var i=this.gl;this.bindGraphics(t,e,n),0===this.stencilStack.length&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var r=this.count;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),1===e.mode?(i.drawElements(i.TRIANGLE_FAN,e.indices.length-4,i.UNSIGNED_SHORT,0),this.reverse?(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?i.stencilFunc(i.EQUAL,255-(r+1),255):i.stencilFunc(i.EQUAL,r+1,255),this.reverse=!this.reverse):(this.reverse?(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),i.drawElements(i.TRIANGLE_STRIP,e.indices.length,i.UNSIGNED_SHORT,0),this.reverse?i.stencilFunc(i.EQUAL,r+1,255):i.stencilFunc(i.EQUAL,255-(r+1),255)),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,n,i){this._currentGraphics=e;var r,s=this.gl,a=i.projection,o=i.offset;1===n.mode?(r=i.shaderManager.complexPrimitiveShader,i.shaderManager.setShader(r),s.uniform1f(r.flipY,i.flipY),s.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform2f(r.projectionVector,a.x,-a.y),s.uniform2f(r.offsetVector,-o.x,-o.y),s.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),s.uniform3fv(r.color,n.color),s.uniform1f(r.alpha,e.worldAlpha*n.alpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer)):(r=i.shaderManager.primitiveShader,i.shaderManager.setShader(r),s.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform1f(r.flipY,i.flipY),s.uniform2f(r.projectionVector,a.x,-a.y),s.uniform2f(r.offsetVector,-o.x,-o.y),s.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),s.uniform1f(r.alpha,e.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(r.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(t,e,n){var i=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)i.disable(i.STENCIL_TEST);else{var r=this.count;this.bindGraphics(t,e,n),i.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(e.indices.length-4)),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),i.drawElements(i.TRIANGLE_FAN,e.indices.length-4,i.UNSIGNED_SHORT,0),this.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255)):(this.reverse?(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),i.drawElements(i.TRIANGLE_STRIP,e.indices.length,i.UNSIGNED_SHORT,0),this.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255)),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},t.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},t.WebGLShaderManager.prototype.constructor=t.WebGLShaderManager,t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimitiveShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var n=t[e];this.tempAttribState[n]=!0}var i=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?i.enableVertexAttribArray(e):i.disableVertexAttribArray(e))},t.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var e=4*this.size*4*this.vertSize,n=6*this.size;this.vertices=new t.ArrayBuffer(e),this.positions=new t.Float32Array(this.vertices),this.colors=new t.Uint32Array(this.vertices),this.indices=new t.Uint16Array(n),this.lastIndexCount=0;for(var i=0,r=0;i<n;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new t.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var n=new t.PixiShader(e);n.fragmentSrc=this.defaultShader.fragmentSrc,n.uniforms={},n.init(),this.defaultShader.shaders[e.id]=n},t.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var n=e._uvs;if(n){var i,r,s,a,o=t.anchor.x,l=t.anchor.y;if(e.trim){var h=e.trim;i=(r=h.x-o*h.width)+e.crop.width,s=(a=h.y-l*h.height)+e.crop.height}else i=e.frame.width*(1-o),r=e.frame.width*-o,s=e.frame.height*(1-l),a=e.frame.height*-l;var c=4*this.currentBatchSize*this.vertSize,u=e.baseTexture.resolution,d=t.worldTransform,p=d.a/u,f=d.b/u,g=d.c/u,m=d.d/u,v=d.tx,_=d.ty,y=this.colors,x=this.positions;this.renderSession.roundPixels?(x[c]=p*r+g*a+v|0,x[c+1]=m*a+f*r+_|0,x[c+5]=p*i+g*a+v|0,x[c+6]=m*a+f*i+_|0,x[c+10]=p*i+g*s+v|0,x[c+11]=m*s+f*i+_|0,x[c+15]=p*r+g*s+v|0,x[c+16]=m*s+f*r+_|0):(x[c]=p*r+g*a+v,x[c+1]=m*a+f*r+_,x[c+5]=p*i+g*a+v,x[c+6]=m*a+f*i+_,x[c+10]=p*i+g*s+v,x[c+11]=m*s+f*i+_,x[c+15]=p*r+g*s+v,x[c+16]=m*s+f*r+_),x[c+2]=n.x0,x[c+3]=n.y0,x[c+7]=n.x1,x[c+8]=n.y1,x[c+12]=n.x2,x[c+13]=n.y2,x[c+17]=n.x3,x[c+18]=n.y3;var b=t.tint;y[c+4]=y[c+9]=y[c+14]=y[c+19]=(b>>16)+(65280&b)+((255&b)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var n=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=n.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var i=e._uvs;e.tilePosition.x%=n.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=n.baseTexture.height*e.tileScaleOffset.y;var r=e.tilePosition.x/(n.baseTexture.width*e.tileScaleOffset.x),s=e.tilePosition.y/(n.baseTexture.height*e.tileScaleOffset.y),a=e.width/n.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),o=e.height/n.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);i.x0=0-r,i.y0=0-s,i.x1=1*a-r,i.y1=0-s,i.x2=1*a-r,i.y2=1*o-s,i.x3=0-r,i.y3=1*o-s;var l=e.tint,h=(l>>16)+(65280&l)+((255&l)<<16)+(255*e.alpha<<24),c=this.positions,u=this.colors,d=e.width,p=e.height,f=e.anchor.x,g=e.anchor.y,m=d*(1-f),v=d*-f,_=p*(1-g),y=p*-g,x=4*this.currentBatchSize*this.vertSize,b=n.baseTexture.resolution,w=e.worldTransform,S=w.a/b,M=w.b/b,T=w.c/b,E=w.d/b,C=w.tx,A=w.ty;c[x++]=S*v+T*y+C,c[x++]=E*y+M*v+A,c[x++]=i.x0,c[x++]=i.y0,u[x++]=h,c[x++]=S*m+T*y+C,c[x++]=E*y+M*m+A,c[x++]=i.x1,c[x++]=i.y1,u[x++]=h,c[x++]=S*m+T*_+C,c[x++]=E*_+M*m+A,c[x++]=i.x2,c[x++]=i.y2,u[x++]=h,c[x++]=S*v+T*_+C,c[x++]=E*_+M*v+A,c[x++]=i.x3,c[x++]=i.y3,u[x++]=h,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e,n,i,r,s=this.gl;if(this.dirty){this.dirty=!1,s.activeTexture(s.TEXTURE0),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e=this.defaultShader.shaders[s.id];var a=4*this.vertSize;s.vertexAttribPointer(e.aVertexPosition,2,s.FLOAT,!1,a,0),s.vertexAttribPointer(e.aTextureCoord,2,s.FLOAT,!1,a,8),s.vertexAttribPointer(e.colorAttribute,4,s.UNSIGNED_BYTE,!0,a,16)}if(this.currentBatchSize>.5*this.size)s.bufferSubData(s.ARRAY_BUFFER,0,this.vertices);else{var o=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);s.bufferSubData(s.ARRAY_BUFFER,0,o)}for(var l,h=0,c=0,u=null,d=this.renderSession.blendModeManager.currentBlendMode,p=null,f=!1,g=!1,m=0,v=this.currentBatchSize;m<v;m++){if(n=(l=this.sprites[m]).texture.baseTexture,f=d!==(i=l.blendMode),g=p!==(r=l.shader||this.defaultShader),(u!==n||f||g)&&(this.renderBatch(u,h,c),c=m,h=0,u=n,f&&(d=i,this.renderSession.blendModeManager.setBlendMode(d)),g)){(e=(p=r).shaders[s.id])||((e=new t.PixiShader(s)).fragmentSrc=p.fragmentSrc,e.uniforms=p.uniforms,e.init(),p.shaders[s.id]=e),this.renderSession.shaderManager.setShader(e),e.dirty&&e.syncUniforms();var _=this.renderSession.projection;s.uniform2f(e.projectionVector,_.x,_.y);var y=this.renderSession.offset;s.uniform2f(e.offsetVector,y.x,y.y)}h++}this.renderBatch(u,h,c),this.currentBatchSize=0}},t.WebGLSpriteBatch.prototype.renderBatch=function(t,e,n){if(0!==e){var i=this.gl;i.id>=t._dirty.length||t._dirty[i.id]?this.renderSession.renderer.updateTexture(t):i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.drawElements(i.TRIANGLES,6*e,i.UNSIGNED_SHORT,6*n*2),this.renderSession.drawCount++}},t.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var n=4*this.size*this.vertSize,i=6*this.maxSize;this.vertices=new t.Float32Array(n),this.indices=new t.Uint16Array(i),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,s=0;r<i;r+=6,s+=4)this.indices[r+0]=s+0,this.indices[r+1]=s+1,this.indices[r+2]=s+2,this.indices[r+3]=s+0,this.indices[r+4]=s+2,this.indices[r+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.constructor=t.WebGLFastSpriteBatch,t.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,n=e[0];if(n.texture._uvs){this.currentBaseTexture=n.texture.baseTexture,n.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(n.blendMode));for(var i=0,r=e.length;i<r;i++)this.renderSprite(e[i]);this.flush()}},t.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,n,i,r,s,a,o=this.vertices;if(e=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim){var l=t.texture.trim;n=(i=l.x-t.anchor.x*l.width)+t.texture.crop.width,r=(s=l.y-t.anchor.y*l.height)+t.texture.crop.height}else n=t.texture.frame.width*(1-t.anchor.x),i=t.texture.frame.width*-t.anchor.x,r=t.texture.frame.height*(1-t.anchor.y),s=t.texture.frame.height*-t.anchor.y;a=4*this.currentBatchSize*this.vertSize,o[a++]=i,o[a++]=s,o[a++]=t.position.x,o[a++]=t.position.y,o[a++]=t.scale.x,o[a++]=t.scale.y,o[a++]=t.rotation,o[a++]=e.x0,o[a++]=e.y1,o[a++]=t.alpha,o[a++]=n,o[a++]=s,o[a++]=t.position.x,o[a++]=t.position.y,o[a++]=t.scale.x,o[a++]=t.scale.y,o[a++]=t.rotation,o[a++]=e.x1,o[a++]=e.y1,o[a++]=t.alpha,o[a++]=n,o[a++]=r,o[a++]=t.position.x,o[a++]=t.position.y,o[a++]=t.scale.x,o[a++]=t.scale.y,o[a++]=t.rotation,o[a++]=e.x2,o[a++]=e.y2,o[a++]=t.alpha,o[a++]=i,o[a++]=r,o[a++]=t.position.x,o[a++]=t.position.y,o[a++]=t.scale.x,o[a++]=t.scale.y,o[a++]=t.rotation,o[a++]=e.x3,o[a++]=e.y3,o[a++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},t.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var n=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,n,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,n,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,n,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,n,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,n,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,n,36)},t.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},t.WebGLFilterManager.prototype.constructor=t.WebGLFilterManager,t.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var n=this.renderSession.projection;this.width=2*n.x,this.height=2*-n.y,this.buffer=e},t.WebGLFilterManager.prototype.pushFilter=function(e){var n=this.gl,i=this.renderSession.projection,r=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var s=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var a=this.texturePool.pop();a?a.resize(this.width,this.height):a=new t.FilterTexture(this.gl,this.width,this.height),n.bindTexture(n.TEXTURE_2D,a.texture);var o=e._filterArea,l=s.padding;o.x-=l,o.y-=l,o.width+=2*l,o.height+=2*l,o.x<0&&(o.x=0),o.width>this.width&&(o.width=this.width),o.y<0&&(o.y=0),o.height>this.height&&(o.height=this.height),n.bindFramebuffer(n.FRAMEBUFFER,a.frameBuffer),n.viewport(0,0,o.width,o.height),i.x=o.width/2,i.y=-o.height/2,r.x=-o.x,r.y=-o.y,n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),e._glFilterTexture=a},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,n=this.filterStack.pop(),i=n._filterArea,r=n._glFilterTexture,s=this.renderSession.projection,a=this.renderSession.offset;if(n.filterPasses.length>1){e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var o=r,l=this.texturePool.pop();l||(l=new t.FilterTexture(this.gl,this.width,this.height)),l.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,l.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var h=0;h<n.filterPasses.length-1;h++){var c=n.filterPasses[h];e.bindFramebuffer(e.FRAMEBUFFER,l.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o.texture),this.applyFilterPass(c,i,i.width,i.height);var u=o;o=l,l=u}e.enable(e.BLEND),r=o,this.texturePool.push(l)}var d=n.filterPasses[n.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var p=this.width,f=this.height,g=0,m=0,v=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,!0);else{var _=this.filterStack[this.filterStack.length-1];p=(i=_._filterArea).width,f=i.height,g=i.x,m=i.y,v=_._glFilterTexture.frameBuffer}s.x=p/2,s.y=-f/2,a.x=g,a.y=m;var y=(i=n._filterArea).x-g,x=i.y-m;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=y,this.vertexArray[1]=x+i.height,this.vertexArray[2]=y+i.width,this.vertexArray[3]=x+i.height,this.vertexArray[4]=y,this.vertexArray[5]=x,this.vertexArray[6]=y+i.width,this.vertexArray[7]=x,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,p*this.renderSession.resolution,f*this.renderSession.resolution),e.bindFramebuffer(e.FRAMEBUFFER,v),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r.texture),this.applyFilterPass(d,i,p,f),this.texturePool.push(r),n._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,n,i,r){var s=this.gl,a=e.shaders[s.id];a||((a=new t.PixiShader(s)).fragmentSrc=e.fragmentSrc,a.uniforms=e.uniforms,a.init(),e.shaders[s.id]=a),this.renderSession.shaderManager.setShader(a),s.uniform2f(a.projectionVector,i/2,-r/2),s.uniform2f(a.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),a.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(a.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(a.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(a.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new t.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,n,i,r){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),r=r||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(n,i)},t.FilterTexture.prototype.constructor=t.FilterTexture,t.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t,e)}},t.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},t.CanvasBuffer.prototype.constructor=t.CanvasBuffer,t.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.constructor=t.CanvasMaskManager,t.CanvasMaskManager.prototype.pushMask=function(e,n){var i=n.context;i.save();var r=e.alpha,s=e.worldTransform,a=n.resolution;i.setTransform(s.a*a,s.b*a,s.c*a,s.d*a,s.tx*a,s.ty*a),t.CanvasGraphics.renderGraphicsMask(e,i),i.clip(),e.worldAlpha=r},t.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,n){var i=e.texture,r="#"+("00000"+(0|(n=t.CanvasTinter.roundColor(n))).toString(16)).substr(-6);if(i.tintCache=i.tintCache||{},i.tintCache[r])return i.tintCache[r];var s=t.CanvasTinter.canvas||document.createElement("canvas");if(t.CanvasTinter.tintMethod(i,n,s),t.CanvasTinter.convertTintToImage){var a=new Image;a.src=s.toDataURL(),i.tintCache[r]=a}else i.tintCache[r]=s,t.CanvasTinter.canvas=null;return s},t.CanvasTinter.tintWithMultiply=function(t,e,n){var i=n.getContext("2d"),r=t.crop;n.width=r.width,n.height=r.height,i.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),i.fillRect(0,0,r.width,r.height),i.globalCompositeOperation="multiply",i.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),i.globalCompositeOperation="destination-atop",i.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},t.CanvasTinter.tintWithOverlay=function(t,e,n){var i=n.getContext("2d"),r=t.crop;n.width=r.width,n.height=r.height,i.globalCompositeOperation="copy",i.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),i.fillRect(0,0,r.width,r.height),i.globalCompositeOperation="destination-atop",i.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},t.CanvasTinter.tintWithPerPixel=function(e,n,i){var r=i.getContext("2d"),s=e.crop;i.width=s.width,i.height=s.height,r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var a=t.hex2rgb(n),o=a[0],l=a[1],h=a[2],c=r.getImageData(0,0,s.width,s.height),u=c.data,d=0;d<u.length;d+=4)u[d+0]*=o,u[d+1]*=l,u[d+2]*=h;r.putImageData(c,0,0)},t.CanvasTinter.roundColor=function(e){var n=t.CanvasTinter.cacheStepsPerColorChannel,i=t.hex2rgb(e);return i[0]=Math.min(255,i[0]/n*n),i[1]=Math.min(255,i[1]/n*n),i[2]=Math.min(255,i[2]/n*n),t.rgb2hex(i)},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,n,i){if(i)for(var r in t.defaultRenderOptions)void 0===i[r]&&(i[r]=t.defaultRenderOptions[r]);else i=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("Canvas"),t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.resolution=i.resolution,this.clearBeforeRender=i.clearBeforeRender,this.transparent=i.transparent,this.autoResize=i.autoResize||!1,this.width=e||800,this.height=n||600,this.width*=this.resolution,this.height*=this.resolution,this.view=i.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(e,n),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=t.blendModes.NORMAL,this.context.globalCompositeOperation=t.blendModesCanvas[t.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)))},t.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},t.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},t.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.mapBlendModes=function(){t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over"))},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,n){var i=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var r=0;r<e.graphicsData.length;r++){var s=e.graphicsData[r],a=s.shape,o=s._fillTint,l=s._lineTint;if(n.lineWidth=s.lineWidth,s.type===t.Graphics.POLY){n.beginPath();var h=a.points;n.moveTo(h[0],h[1]);for(var c=1;c<h.length/2;c++)n.lineTo(h[2*c],h[2*c+1]);a.closed&&n.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&n.closePath(),s.fill&&(n.globalAlpha=s.fillAlpha*i,n.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*i,n.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.stroke())}else if(s.type===t.Graphics.RECT)(s.fillColor||0===s.fillColor)&&(n.globalAlpha=s.fillAlpha*i,n.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),n.fillRect(a.x,a.y,a.width,a.height)),s.lineWidth&&(n.globalAlpha=s.lineAlpha*i,n.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.strokeRect(a.x,a.y,a.width,a.height));else if(s.type===t.Graphics.CIRC)n.beginPath(),n.arc(a.x,a.y,a.radius,0,2*Math.PI),n.closePath(),s.fill&&(n.globalAlpha=s.fillAlpha*i,n.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*i,n.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.stroke());else if(s.type===t.Graphics.ELIP){var u=2*a.width,d=2*a.height,p=a.x-u/2,f=a.y-d/2;n.beginPath();var g=u/2*.5522848,m=d/2*.5522848,v=p+u,_=f+d,y=p+u/2,x=f+d/2;n.moveTo(p,x),n.bezierCurveTo(p,x-m,y-g,f,y,f),n.bezierCurveTo(y+g,f,v,x-m,v,x),n.bezierCurveTo(v,x+m,y+g,_,y,_),n.bezierCurveTo(y-g,_,p,x+m,p,x),n.closePath(),s.fill&&(n.globalAlpha=s.fillAlpha*i,n.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*i,n.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.stroke())}else if(s.type===t.Graphics.RREC){var b=a.x,w=a.y,S=a.width,M=a.height,T=a.radius,E=Math.min(S,M)/2|0;T=T>E?E:T,n.beginPath(),n.moveTo(b,w+T),n.lineTo(b,w+M-T),n.quadraticCurveTo(b,w+M,b+T,w+M),n.lineTo(b+S-T,w+M),n.quadraticCurveTo(b+S,w+M,b+S,w+M-T),n.lineTo(b+S,w+T),n.quadraticCurveTo(b+S,w,b+S-T,w),n.lineTo(b+T,w),n.quadraticCurveTo(b,w,b,w+T),n.closePath(),(s.fillColor||0===s.fillColor)&&(n.globalAlpha=s.fillAlpha*i,n.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*i,n.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,n){var i=e.graphicsData.length;if(0!==i){i>1&&(i=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;r<1;r++){var s=e.graphicsData[r],a=s.shape;if(s.type===t.Graphics.POLY){n.beginPath();var o=a.points;n.moveTo(o[0],o[1]);for(var l=1;l<o.length/2;l++)n.lineTo(o[2*l],o[2*l+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&n.closePath()}else if(s.type===t.Graphics.RECT)n.beginPath(),n.rect(a.x,a.y,a.width,a.height),n.closePath();else if(s.type===t.Graphics.CIRC)n.beginPath(),n.arc(a.x,a.y,a.radius,0,2*Math.PI),n.closePath();else if(s.type===t.Graphics.ELIP){var h=2*a.width,c=2*a.height,u=a.x-h/2,d=a.y-c/2;n.beginPath();var p=h/2*.5522848,f=c/2*.5522848,g=u+h,m=d+c,v=u+h/2,_=d+c/2;n.moveTo(u,_),n.bezierCurveTo(u,_-f,v-p,d,v,d),n.bezierCurveTo(v+p,d,g,_-f,g,_),n.bezierCurveTo(g,_+f,v+p,m,v,m),n.bezierCurveTo(v-p,m,u,_+f,u,_),n.closePath()}else if(s.type===t.Graphics.RREC){var y=a.points,x=y[0],b=y[1],w=y[2],S=y[3],M=y[4],T=Math.min(w,S)/2|0;M=M>T?T:M,n.beginPath(),n.moveTo(x,b+M),n.lineTo(x,b+S-M),n.quadraticCurveTo(x,b+S,x+M,b+S),n.lineTo(x+w-M,b+S),n.quadraticCurveTo(x+w,b+S,x+w,b+S-M),n.lineTo(x+w,b+M),n.quadraticCurveTo(x+w,b,x+w-M,b),n.lineTo(x+M,b),n.quadraticCurveTo(x,b,x,b+M),n.closePath()}}}},t.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,n=(t.tint>>8&255)/255,i=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],a=0|s.fillColor,o=0|s.lineColor;s._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*n*255<<8)+(255&a)/255*i*255,s._lineTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*n*255<<8)+(255&o)/255*i*255}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new t.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.Graphics.prototype.lineStyle=function(e,n,i){if(this.lineWidth=e||0,this.lineColor=n||0,this.lineAlpha=arguments.length<3?1:i,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new t.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},t.Graphics.prototype.moveTo=function(e,n){return this.drawShape(new t.Polygon([e,n])),this},t.Graphics.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},t.Graphics.prototype.quadraticCurveTo=function(t,e,n,i){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,s,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var o=a[a.length-2],l=a[a.length-1],h=0,c=1;c<=20;c++)r=o+(t-o)*(h=c/20),s=l+(e-l)*h,a.push(r+(t+(n-t)*h-r)*h,s+(e+(i-e)*h-s)*h);return this.dirty=!0,this},t.Graphics.prototype.bezierCurveTo=function(t,e,n,i,r,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var a,o,l,h,c,u=this.currentPath.shape.points,d=u[u.length-2],p=u[u.length-1],f=0,g=1;g<=20;g++)l=(o=(a=1-(f=g/20))*a)*a,c=(h=f*f)*f,u.push(l*d+3*o*f*t+3*a*h*n+c*r,l*p+3*o*f*e+3*a*h*i+c*s);return this.dirty=!0,this},t.Graphics.prototype.arcTo=function(t,e,n,i,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s=this.currentPath.shape.points,a=s[s.length-2],o=s[s.length-1]-e,l=a-t,h=i-e,c=n-t,u=Math.abs(o*c-l*h);if(u<1e-8||0===r)s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e);else{var d=o*o+l*l,p=h*h+c*c,f=o*h+l*c,g=r*Math.sqrt(d)/u,m=r*Math.sqrt(p)/u,v=g*f/d,_=m*f/p,y=g*c+m*l,x=g*h+m*o,b=l*(m+v),w=o*(m+v),S=c*(g+_),M=h*(g+_),T=Math.atan2(w-x,b-y),E=Math.atan2(M-x,S-y);this.arc(y+t,x+e,r,T,E,l*h>c*o)}return this.dirty=!0,this},t.Graphics.prototype.arc=function(t,e,n,i,r,s){var a,o=t+Math.cos(i)*n,l=e+Math.sin(i)*n;if(this.currentPath?0===(a=this.currentPath.shape.points).length?a.push(o,l):a[a.length-2]===o&&a[a.length-1]===l||a.push(o,l):(this.moveTo(o,l),a=this.currentPath.shape.points),i===r)return this;!s&&r<=i?r+=2*Math.PI:s&&i<=r&&(i+=2*Math.PI);var h=s?-1*(i-r):r-i,c=Math.abs(h)/(2*Math.PI)*40;if(0===h)return this;for(var u=h/(2*c),d=2*u,p=Math.cos(u),f=Math.sin(u),g=c-1,m=g%1/g,v=0;v<=g;v++){var _=u+i+d*(v+m*v),y=Math.cos(_),x=-Math.sin(_);a.push((p*y+f*x)*n+t,(p*-x+f*y)*n+e)}return this.dirty=!0,this},t.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,n,i,r){return this.drawShape(new t.Rectangle(e,n,i,r)),this},t.Graphics.prototype.drawRoundedRect=function(e,n,i,r,s){return this.drawShape(new t.RoundedRectangle(e,n,i,r,s)),this},t.Graphics.prototype.drawCircle=function(e,n,i){return this.drawShape(new t.Circle(e,n,i)),this},t.Graphics.prototype.drawEllipse=function(e,n,i,r){return this.drawShape(new t.Ellipse(e,n,i,r)),this},t.Graphics.prototype.drawPolygon=function(e){return e instanceof Array||(e=Array.prototype.slice.call(arguments)),this.drawShape(new t.Polygon(e)),this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},t.Graphics.prototype.generateTexture=function(e,n){e=e||1;var i=this.getBounds(),r=new t.CanvasBuffer(i.width*e,i.height*e),s=t.Texture.fromCanvas(r.canvas,n);return s.baseTexture.resolution=e,r.context.scale(e,e),r.context.translate(-i.x,-i.y),t.CanvasGraphics.renderGraphics(this,r.context),s},t.Graphics.prototype._renderWebGL=function(e){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var n=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(n[0],n[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),t.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var i=0,r=this.children.length;i<r;i++)this.children[i]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()}},t.Graphics.prototype._renderCanvas=function(e){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e);var n=e.context,i=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);var r=e.resolution;n.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r),t.CanvasGraphics.renderGraphics(this,n);for(var s=0,a=this.children.length;s<a;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Graphics.prototype.getBounds=function(e){if(this.isMask)return t.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var n=this._localBounds,i=n.x,r=n.width+n.x,s=n.y,a=n.height+n.y,o=e||this.worldTransform,l=o.a,h=o.b,c=o.c,u=o.d,d=o.tx,p=o.ty,f=l*r+c*a+d,g=u*a+h*r+p,m=l*i+c*a+d,v=u*a+h*i+p,_=l*i+c*s+d,y=u*s+h*i+p,x=l*r+c*s+d,b=u*s+h*r+p,w=f,S=g,M=f,T=g;return M=x<(M=_<(M=m<M?m:M)?_:M)?x:M,T=b<(T=y<(T=v<T?v:T)?y:T)?b:T,w=x>(w=_>(w=m>w?m:w)?_:w)?x:w,S=b>(S=y>(S=v>S?v:S)?y:S)?b:S,this._bounds.x=M,this._bounds.width=w-M,this._bounds.y=T,this._bounds.height=S-T,this._bounds},t.Graphics.prototype.updateLocalBounds=function(){var e=1/0,n=-1/0,i=1/0,r=-1/0;if(this.graphicsData.length)for(var s,a,o,l,h,c,u=0;u<this.graphicsData.length;u++){var d=this.graphicsData[u],p=d.type,f=d.lineWidth;if(s=d.shape,p===t.Graphics.RECT||p===t.Graphics.RREC)o=s.x-f/2,l=s.y-f/2,e=o<e?o:e,n=o+(h=s.width+f)>n?o+h:n,i=l<i?l:i,r=l+(c=s.height+f)>r?l+c:r;else if(p===t.Graphics.CIRC)o=s.x,l=s.y,e=o-(h=s.radius+f/2)<e?o-h:e,n=o+h>n?o+h:n,i=l-(c=s.radius+f/2)<i?l-c:i,r=l+c>r?l+c:r;else if(p===t.Graphics.ELIP)o=s.x,l=s.y,e=o-(h=s.width+f/2)<e?o-h:e,n=o+h>n?o+h:n,i=l-(c=s.height+f/2)<i?l-c:i,r=l+c>r?l+c:r;else{a=s.points;for(var g=0;g<a.length;g+=2)e=(o=a[g])-f<e?o-f:e,n=o+f>n?o+f:n,i=(l=a[g+1])-f<i?l-f:i,r=l+f>r?l+f:r}}else e=0,n=0,i=0,r=0;var m=this.boundsPadding;this._localBounds.x=e-m,this._localBounds.width=n-e+2*m,this._localBounds.y=i-m,this._localBounds.height=r-i+2*m},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var n=new t.CanvasBuffer(e.width,e.height),i=t.Texture.fromCanvas(n.canvas);this._cachedSprite=new t.Sprite(i),this._cachedSprite.buffer=n,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,n=t.buffer.canvas;e.baseTexture.width=n.width,e.baseTexture.height=n.height,e.crop.width=e.frame.width=n.width,e.crop.height=e.frame.height=n.height,t._width=n.width,t._height=n.height,e.baseTexture.dirty()},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var n=new t.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(n),n.type===t.Graphics.POLY&&(n.shape.closed=this.filling,this.currentPath=n),this.dirty=!0,n},t.GraphicsData=function(t,e,n,i,r,s,a){this.lineWidth=t,this.lineColor=e,this.lineAlpha=n,this._lineTint=e,this.fillColor=i,this.fillAlpha=r,this._fillTint=i,this.fill=s,this.shape=a,this.type=a.type},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.Graphics.RREC=4,t.Polygon.prototype.type=t.Graphics.POLY,t.Rectangle.prototype.type=t.Graphics.RECT,t.Circle.prototype.type=t.Graphics.CIRC,t.Ellipse.prototype.type=t.Graphics.ELIP,t.RoundedRectangle.prototype.type=t.Graphics.RREC,t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=t.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=t.Strip.DrawModes.TRIANGLE_STRIP},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},t.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var n=e.gl,i=e.projection,r=e.offset,s=e.shaderManager.stripShader,a=this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?n.TRIANGLE_STRIP:n.TRIANGLES;e.blendModeManager.setBlendMode(this.blendMode),n.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),n.uniform2f(s.projectionVector,i.x,-i.y),n.uniform2f(s.offsetVector,-r.x,-r.y),n.uniform1f(s.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertices,n.STATIC_DRAW),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.bufferData(n.ARRAY_BUFFER,this.uvs,n.STATIC_DRAW),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),this.texture.baseTexture._dirty[n.id]?e.renderer.updateTexture(this.texture.baseTexture):n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),this.texture.baseTexture._dirty[n.id]?e.renderer.updateTexture(this.texture.baseTexture):n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),n.drawElements(a,this.indices.length,n.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var n=e.context,i=this.worldTransform;e.roundPixels?n.setTransform(i.a,i.b,i.c,i.d,0|i.tx,0|i.ty):n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(n):this._renderCanvasTriangles(n)},t.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,n=this.uvs,i=e.length/2;this.count++;for(var r=0;r<i-2;r++){var s=2*r;this._renderCanvasDrawTriangle(t,e,n,s,s+2,s+4)}},t.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,n=this.uvs,i=this.indices,r=i.length;this.count++;for(var s=0;s<r;s+=3){var a=2*i[s],o=2*i[s+1],l=2*i[s+2];this._renderCanvasDrawTriangle(t,e,n,a,o,l)}},t.Strip.prototype._renderCanvasDrawTriangle=function(t,e,n,i,r,s){var a=this.texture.baseTexture.source,o=this.texture.width,l=this.texture.height,h=e[i],c=e[r],u=e[s],d=e[i+1],p=e[r+1],f=e[s+1],g=n[i]*o,m=n[r]*o,v=n[s]*o,_=n[i+1]*l,y=n[r+1]*l,x=n[s+1]*l;if(this.canvasPadding>0){var b=this.canvasPadding/this.worldTransform.a,w=this.canvasPadding/this.worldTransform.d,S=(h+c+u)/3,M=(d+p+f)/3,T=h-S,E=d-M,C=Math.sqrt(T*T+E*E);h=S+T/C*(C+b),d=M+E/C*(C+w),E=p-M,c=S+(T=c-S)/(C=Math.sqrt(T*T+E*E))*(C+b),p=M+E/C*(C+w),E=f-M,u=S+(T=u-S)/(C=Math.sqrt(T*T+E*E))*(C+b),f=M+E/C*(C+w)}t.save(),t.beginPath(),t.moveTo(h,d),t.lineTo(c,p),t.lineTo(u,f),t.closePath(),t.clip();var A=g*y+_*v+m*x-y*v-_*m-g*x,R=h*y+_*u+c*x-y*u-_*c-h*x,L=g*c+h*v+m*u-c*v-h*m-g*u,P=g*y*u+_*c*v+h*m*x-h*y*v-_*m*u-g*c*x,k=d*y+_*f+p*x-y*f-_*p-d*x,D=g*p+d*v+m*f-p*v-d*m-g*f,I=g*y*f+_*p*v+d*m*x-d*y*v-_*m*f-g*p*x;t.transform(R/A,k/A,L/A,D/A,P/A,I/A),t.drawImage(a,0,0),t.restore()},t.Strip.prototype.renderStripFlat=function(t){var e=this.context,n=t.vertices,i=n.length/2;this.count++,e.beginPath();for(var r=1;r<i-2;r++){var s=2*r,a=n[s],o=n[s+2],l=n[s+4],h=n[s+1],c=n[s+3],u=n[s+5];e.moveTo(a,h),e.lineTo(o,c),e.lineTo(l,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Strip.prototype.getBounds=function(e){for(var n=e||this.worldTransform,i=n.a,r=n.b,s=n.c,a=n.d,o=n.tx,l=n.ty,h=-1/0,c=-1/0,u=1/0,d=1/0,p=this.vertices,f=0,g=p.length;f<g;f+=2){var m=p[f],v=p[f+1],_=i*m+s*v+o,y=a*v+r*m+l;u=_<u?_:u,d=y<d?y:d,h=_>h?_:h,c=y>c?y:c}if(u===-1/0||c===1/0)return t.EmptyRectangle;var x=this._bounds;return x.x=u,x.width=h-u,x.y=d,x.height=c-d,this._currentBounds=x,x},t.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},t.Rope=function(e,n){t.Strip.call(this,e),this.points=n,this.vertices=new t.Float32Array(4*n.length),this.uvs=new t.Float32Array(4*n.length),this.colors=new t.Float32Array(2*n.length),this.indices=new t.Uint16Array(2*n.length),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,n=(t[0],this.indices),i=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,i[0]=1,i[1]=1,n[0]=0,n[1]=1;for(var r,s,a=t.length,o=1;o<a;o++)t[o],s=o/(a-1),e[r=4*o]=s,e[r+1]=0,e[r+2]=s,e[r+3]=1,i[r=2*o]=1,i[r+1]=1,n[r=2*o]=r,n[r+1]=r+1}},t.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var n,i=e[0],r={x:0,y:0};this.count-=.2;for(var s,a,o,l,h=this.vertices,c=e.length,u=0;u<c;u++)s=e[u],a=4*u,n=u<e.length-1?e[u+1]:s,r.y=-(n.x-i.x),r.x=n.y-i.y,o=Math.sqrt(r.x*r.x+r.y*r.y),l=this.texture.height/2,r.x/=o,r.y/=o,r.x*=l,r.y*=l,h[a]=s.x+r.x,h[a+1]=s.y+r.y,h[a+2]=s.x-r.x,h[a+3]=s.y-r.y,i=s;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(t){this.texture=t},t.TilingSprite=function(e,n,i){t.Sprite.call(this,e),this._width=n||100,this._height=i||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),t.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha){var e,n;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),e=0,n=this.children.length;e<n;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},t.TilingSprite.prototype._renderCanvas=function(e){if(!1!==this.visible&&0!==this.alpha){var n=e.context;this._mask&&e.maskManager.pushMask(this._mask,e),n.globalAlpha=this.worldAlpha;var i,r,s=this.worldTransform,a=e.resolution;if(n.setTransform(s.a*a,s.b*a,s.c*a,s.d*a,s.tx*a,s.ty*a),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=n.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var o=this.tilePosition,l=this.tileScale;for(o.x%=this.tilingTexture.baseTexture.width,o.y%=this.tilingTexture.baseTexture.height,n.scale(l.x,l.y),n.translate(o.x+this.anchor.x*-this._width,o.y+this.anchor.y*-this._height),n.fillStyle=this.__tilePattern,n.fillRect(-o.x,-o.y,this._width/l.x,this._height/l.y),n.scale(1/l.x,1/l.y),n.translate(-o.x+this.anchor.x*this._width,-o.y+this.anchor.y*this._height),this._mask&&e.maskManager.popMask(e),i=0,r=this.children.length;i<r;i++)this.children[i]._renderCanvas(e)}},t.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,n=t*(1-this.anchor.x),i=t*-this.anchor.x,r=e*(1-this.anchor.y),s=e*-this.anchor.y,a=this.worldTransform,o=a.a,l=a.b,h=a.c,c=a.d,u=a.tx,d=a.ty,p=o*i+h*s+u,f=c*s+l*i+d,g=o*n+h*s+u,m=c*s+l*n+d,v=o*n+h*r+u,_=c*r+l*n+d,y=o*i+h*r+u,x=c*r+l*i+d,b=-1/0,w=-1/0,S=1/0,M=1/0;S=y<(S=v<(S=g<(S=p<S?p:S)?g:S)?v:S)?y:S,M=x<(M=_<(M=m<(M=f<M?f:M)?m:M)?_:M)?x:M,b=y>(b=v>(b=g>(b=p>b?p:b)?g:b)?v:b)?y:b,w=x>(w=_>(w=m>(w=f>w?f:w)?m:w)?_:w)?x:w;var T=this._bounds;return T.x=S,T.width=b-S,T.y=M,T.height=w-M,this._currentBounds=T,T},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e){if(this.texture.baseTexture.hasLoaded){var n,i,r,s=this.originalTexture||this.texture,a=s.frame,o=a.width!==s.baseTexture.width||a.height!==s.baseTexture.height,l=!1;e?(n=t.getNextPowerOfTwo(a.width),i=t.getNextPowerOfTwo(a.height),(a.width!==n||a.height!==i||s.baseTexture.width!==n||s.baseTexture.height||i)&&(l=!0)):o&&(s.trim?(n=s.trim.width,i=s.trim.height):(n=a.width,i=a.height),l=!0),l?(this.tilingTexture&&this.tilingTexture.isTiling?((r=this.tilingTexture.canvasBuffer).resize(n,i),this.tilingTexture.baseTexture.width=n,this.tilingTexture.baseTexture.height=i,this.tilingTexture.needsUpdate=!0):(r=new t.CanvasBuffer(n,i),this.tilingTexture=t.Texture.fromCanvas(r.canvas),this.tilingTexture.canvasBuffer=r,this.tilingTexture.isTiling=!0),r.context.drawImage(s.baseTexture.source,s.crop.x,s.crop.y,s.crop.width,s.crop.height,0,0,n,i),this.tileScaleOffset.x=a.width/n,this.tileScaleOffset.y=a.height/i):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=s),this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},t.TilingSprite.prototype.destroy=function(){t.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};var e={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array,BoneData:function(t,e){this.name=t,this.parent=e}};e.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},e.SlotData=function(t,e){this.name=t,this.boneData=e},e.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},e.IkConstraintData=function(t){this.name=t,this.bones=[]},e.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},e.Bone=function(t,e,n){this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()},e.Bone.yDown=!1,e.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var n=this.skeleton.flipX,i=this.skeleton.flipY;this.worldX=n?-this.x:this.x,this.worldY=i!=e.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=n!=this.flipX,this.worldFlipY=i!=this.flipY}var r=this.worldRotation*e.degRad,s=Math.cos(r),a=Math.sin(r);this.worldFlipX?(this.m00=-s*this.worldScaleX,this.m01=a*this.worldScaleY):(this.m00=s*this.worldScaleX,this.m01=-a*this.worldScaleY),this.worldFlipY!=e.Bone.yDown?(this.m10=-a*this.worldScaleX,this.m11=-s*this.worldScaleY):(this.m10=a*this.worldScaleX,this.m11=s*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var n=t[0]-this.worldX,i=t[1]-this.worldY,r=this.m00,s=this.m10,a=this.m01,o=this.m11;this.worldFlipX!=(this.worldFlipY!=e.Bone.yDown)&&(r=-r,o=-o);var l=1/(r*o-a*s);t[0]=n*r*l-i*a*l,t[1]=i*o*l-n*s*l},localToWorld:function(t){var e=t[0],n=t[1];t[0]=e*this.m00+n*this.m01+this.worldX,t[1]=e*this.m10+n*this.m11+this.worldY}},e.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},e.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,n=0,i=e.length;n<i;n++)if(e[n]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(n,t.attachmentName):null);break}}},e.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var n=0,i=t.bones.length;n<i;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)},e.IkConstraint.prototype={apply:function(){var t=this.target,n=this.bones;switch(n.length){case 1:e.IkConstraint.apply1(n[0],t.worldX,t.worldY,this.mix);break;case 2:e.IkConstraint.apply2(n[0],n[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},e.IkConstraint.apply1=function(t,n,i,r){var s=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,a=t.rotation,o=Math.atan2(i-t.worldY,n-t.worldX)*e.radDeg-s;t.rotationIK=a+(o-a)*r},e.IkConstraint.apply2=function(t,n,i,r,s,a){var o=n.rotation,l=t.rotation;if(!a)return n.rotationIK=o,void(t.rotationIK=l);var h,c,u=e.temp,d=t.parent;d?(u[0]=i,u[1]=r,d.worldToLocal(u),i=(u[0]-t.x)*d.worldScaleX,r=(u[1]-t.y)*d.worldScaleY):(i-=t.x,r-=t.y),n.parent==t?(h=n.x,c=n.y):(u[0]=n.x,u[1]=n.y,n.parent.localToWorld(u),t.worldToLocal(u),h=u[0],c=u[1]);var p=h*t.worldScaleX,f=c*t.worldScaleY,g=Math.atan2(f,p),m=Math.sqrt(p*p+f*f),v=n.data.length*n.worldScaleX,_=2*m*v;if(_<1e-4)n.rotationIK=o+(Math.atan2(r,i)*e.radDeg-l-o)*a;else{var y=(i*i+r*r-m*m-v*v)/_;y<-1?y=-1:y>1&&(y=1);var x=Math.acos(y)*s,b=m+v*y,w=v*Math.sin(x),S=(Math.atan2(r*b-i*w,i*b+r*w)-g)*e.radDeg-l;S>180?S-=360:S<-180&&(S+=360),t.rotationIK=l+S*a,(S=(x+g)*e.radDeg-o)>180?S-=360:S<-180&&(S+=360),n.rotationIK=o+(S+t.worldRotation-n.parent.worldRotation)*a}},e.Skin=function(t){this.name=t,this.attachments={}},e.Skin.prototype={addAttachment:function(t,e,n){this.attachments[t+":"+e]=n},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var n in e.attachments){var i=n.indexOf(":"),r=parseInt(n.substring(0,i)),s=n.substring(i+1),a=t.slots[r];if(a.attachment&&a.attachment.name==s){var o=this.getAttachment(r,s);o&&a.setAttachment(o)}}}},e.Animation=function(t,e,n){this.name=t,this.timelines=e,this.duration=n},e.Animation.prototype={apply:function(t,e,n,i,r){i&&0!=this.duration&&(n%=this.duration,e%=this.duration);for(var s=this.timelines,a=0,o=s.length;a<o;a++)s[a].apply(t,e,n,r,1)},mix:function(t,e,n,i,r,s){i&&0!=this.duration&&(n%=this.duration,e%=this.duration);for(var a=this.timelines,o=0,l=a.length;o<l;o++)a[o].apply(t,e,n,r,s)}},e.Animation.binarySearch=function(t,e,n){var i=0,r=Math.floor(t.length/n)-2;if(!r)return n;for(var s=r>>>1;;){if(t[(s+1)*n]<=e?i=s+1:r=s,i==r)return(i+1)*n;s=i+r>>>1}},e.Animation.binarySearch1=function(t,e){var n=0,i=t.length-2;if(!i)return 1;for(var r=i>>>1;;){if(t[r+1]<=e?n=r+1:i=r,n==i)return n+1;r=n+i>>>1}},e.Animation.linearSearch=function(t,e,n){for(var i=0,r=t.length-n;i<=r;i+=n)if(t[i]>e)return i;return-1},e.Curves=function(t){this.curves=[]},e.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,n,i,r){var s=.1*.1*.1*6,a=2*-e+i,o=2*-n+r,l=3*(e-i)+1,h=3*(n-r)+1,c=e*(3*.1)+a*(.1*.1*3)+l*(.1*.1*.1),u=n*(3*.1)+o*(.1*.1*3)+h*(.1*.1*.1),d=a*(.1*.1*6)+l*s,p=o*(.1*.1*6)+h*s,f=l*s,g=h*s,m=19*t,v=this.curves;v[m++]=2;for(var _=c,y=u,x=m+19-1;m<x;m+=2)v[m]=_,v[m+1]=y,c+=d,u+=p,d+=f,p+=g,_+=c,y+=u},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var n=this.curves,i=19*t,r=n[i];if(0===r)return e;if(1==r)return 0;for(var s=0,a=++i,o=i+19-1;i<o;i+=2){var l,h;if((s=n[i])>=e)return i==a?(l=0,h=0):(l=n[i-2],h=n[i-1]),h+(n[i+1]-h)*(e-l)/(s-l)}var c=n[i-1];return c+(1-c)*(e-s)/(1-s)}},e.RotateTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,n){t*=2,this.frames[t]=e,this.frames[t+1]=n},apply:function(t,n,i,r,s){var a=this.frames;if(!(i<a[0])){var o=t.bones[this.boneIndex];if(i>=a[a.length-2]){for(var l=o.data.rotation+a[a.length-1]-o.rotation;l>180;)l-=360;for(;l<-180;)l+=360;o.rotation+=l*s}else{var h=e.Animation.binarySearch(a,i,2),c=a[h-1],u=a[h],d=1-(i-u)/(a[h-2]-u);for(d=this.curves.getCurvePercent(h/2-1,d),l=a[h+1]-c;l>180;)l-=360;for(;l<-180;)l+=360;for(l=o.data.rotation+(c+l*d)-o.rotation;l>180;)l-=360;for(;l<-180;)l+=360;o.rotation+=l*s}}}},e.TranslateTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,n,i){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i},apply:function(t,n,i,r,s){var a=this.frames;if(!(i<a[0])){var o=t.bones[this.boneIndex];if(i>=a[a.length-3])return o.x+=(o.data.x+a[a.length-2]-o.x)*s,void(o.y+=(o.data.y+a[a.length-1]-o.y)*s);var l=e.Animation.binarySearch(a,i,3),h=a[l-2],c=a[l-1],u=a[l],d=1-(i-u)/(a[l+-3]-u);d=this.curves.getCurvePercent(l/3-1,d),o.x+=(o.data.x+h+(a[l+1]-h)*d-o.x)*s,o.y+=(o.data.y+c+(a[l+2]-c)*d-o.y)*s}}},e.ScaleTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,n,i){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i},apply:function(t,n,i,r,s){var a=this.frames;if(!(i<a[0])){var o=t.bones[this.boneIndex];if(i>=a[a.length-3])return o.scaleX+=(o.data.scaleX*a[a.length-2]-o.scaleX)*s,void(o.scaleY+=(o.data.scaleY*a[a.length-1]-o.scaleY)*s);var l=e.Animation.binarySearch(a,i,3),h=a[l-2],c=a[l-1],u=a[l],d=1-(i-u)/(a[l+-3]-u);d=this.curves.getCurvePercent(l/3-1,d),o.scaleX+=(o.data.scaleX*(h+(a[l+1]-h)*d)-o.scaleX)*s,o.scaleY+=(o.data.scaleY*(c+(a[l+2]-c)*d)-o.scaleY)*s}}},e.ColorTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=5*t},e.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,n,i,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=s},apply:function(t,n,i,r,s){var a=this.frames;if(!(i<a[0])){var o,l,h,c;if(i>=a[a.length-5]){var u=a.length-1;o=a[u-3],l=a[u-2],h=a[u-1],c=a[u]}else{var d=e.Animation.binarySearch(a,i,5),p=a[d-4],f=a[d-3],g=a[d-2],m=a[d-1],v=a[d],_=1-(i-v)/(a[d-5]-v);_=this.curves.getCurvePercent(d/5-1,_),o=p+(a[d+1]-p)*_,l=f+(a[d+2]-f)*_,h=g+(a[d+3]-g)*_,c=m+(a[d+4]-m)*_}var y=t.slots[this.slotIndex];s<1?(y.r+=(o-y.r)*s,y.g+=(l-y.g)*s,y.b+=(h-y.b)*s,y.a+=(c-y.a)*s):(y.r=o,y.g=l,y.b=h,y.a=c)}}},e.AttachmentTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},e.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},apply:function(t,n,i,r,s){var a=this.frames;if(i<a[0])n>i&&this.apply(t,n,Number.MAX_VALUE,null,0);else{n>i&&(n=-1);var o=i>=a[a.length-1]?a.length-1:e.Animation.binarySearch1(a,i)-1;if(!(a[o]<n)){var l=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(l?t.getAttachmentBySlotIndex(this.slotIndex,l):null)}}}},e.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},e.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,n){this.frames[t]=e,this.events[t]=n},apply:function(t,n,i,r,s){if(r){var a=this.frames,o=a.length;if(n>i)this.apply(t,n,Number.MAX_VALUE,r,s),n=-1;else if(n>=a[o-1])return;if(!(i<a[0])){var l;if(n<a[0])l=0;else for(var h=a[l=e.Animation.binarySearch1(a,n)];l>0&&a[l-1]==h;)l--;for(var c=this.events;l<o&&i>=a[l];l++)r.push(c[l])}}}},e.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},e.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},apply:function(t,n,i,r,s){var a=this.frames;if(!(i<a[0])){var o;o=i>=a[a.length-1]?a.length-1:e.Animation.binarySearch1(a,i)-1;var l=t.drawOrder,h=(t.slots,this.drawOrders[o]);if(h)for(var c=0,u=h.length;c<u;c++)l[c]=h[c]}}},e.FfdTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},e.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},apply:function(t,n,i,r,s){var a=t.slots[this.slotIndex];if(a.attachment==this.attachment){var o=this.frames;if(!(i<o[0])){var l=this.frameVertices,h=l[0].length,c=a.attachmentVertices;if(c.length!=h&&(s=1),c.length=h,i>=o[o.length-1]){var u=l[o.length-1];if(s<1)for(var d=0;d<h;d++)c[d]+=(u[d]-c[d])*s;else for(d=0;d<h;d++)c[d]=u[d]}else{var p=e.Animation.binarySearch1(o,i),f=o[p],g=1-(i-f)/(o[p-1]-f);g=this.curves.getCurvePercent(p-1,g<0?0:g>1?1:g);var m=l[p-1],v=l[p];if(s<1)for(d=0;d<h;d++){var _=m[d];c[d]+=(_+(v[d]-_)*g-c[d])*s}else for(d=0;d<h;d++)_=m[d],c[d]=_+(v[d]-_)*g}}}}},e.IkConstraintTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,n,i){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i},apply:function(t,n,i,r,s){var a=this.frames;if(!(i<a[0])){var o=t.ikConstraints[this.ikConstraintIndex];if(i>=a[a.length-3])return o.mix+=(a[a.length-2]-o.mix)*s,void(o.bendDirection=a[a.length-1]);var l=e.Animation.binarySearch(a,i,3),h=a[l+-2],c=a[l],u=1-(i-c)/(a[l+-3]-c);u=this.curves.getCurvePercent(l/3-1,u);var d=h+(a[l+1]-h)*u;o.mix+=(d-o.mix)*s,o.bendDirection=a[l+-1]}}},e.FlipXTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,n){t*=2,this.frames[t]=e,this.frames[t+1]=n?1:0},apply:function(t,n,i,r,s){var a=this.frames;if(i<a[0])n>i&&this.apply(t,n,Number.MAX_VALUE,null,0);else{n>i&&(n=-1);var o=(i>=a[a.length-2]?a.length:e.Animation.binarySearch(a,i,2))-2;a[o]<n||(t.bones[boneIndex].flipX=0!=a[o+1])}}},e.FlipYTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,n){t*=2,this.frames[t]=e,this.frames[t+1]=n?1:0},apply:function(t,n,i,r,s){var a=this.frames;if(i<a[0])n>i&&this.apply(t,n,Number.MAX_VALUE,null,0);else{n>i&&(n=-1);var o=(i>=a[a.length-2]?a.length:e.Animation.binarySearch(a,i,2))-2;a[o]<n||(t.bones[boneIndex].flipY=0!=a[o+1])}}},e.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},e.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].name==t)return e[n];return null},findBoneIndex:function(t){for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},findSlot:function(t){for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].name==t)return slot[n];return null},findSlotIndex:function(t){for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},findSkin:function(t){for(var e=this.skins,n=0,i=e.length;n<i;n++)if(e[n].name==t)return e[n];return null},findEvent:function(t){for(var e=this.events,n=0,i=e.length;n<i;n++)if(e[n].name==t)return e[n];return null},findAnimation:function(t){for(var e=this.animations,n=0,i=e.length;n<i;n++)if(e[n].name==t)return e[n];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++)if(e[n].name==t)return e[n];return null}},e.Skeleton=function(t){this.data=t,this.bones=[];for(var n=0,i=t.bones.length;n<i;n++){var r=t.bones[n],s=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new e.Bone(r,this,s))}for(this.slots=[],this.drawOrder=[],n=0,i=t.slots.length;n<i;n++){var a=t.slots[n],o=this.bones[t.bones.indexOf(a.boneData)],l=new e.Slot(a,o);this.slots.push(l),this.drawOrder.push(n)}for(this.ikConstraints=[],n=0,i=t.ikConstraints.length;n<i;n++)this.ikConstraints.push(new e.IkConstraint(t.ikConstraints[n],this));this.boneCache=[],this.updateCache()},e.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,n=e+1,i=this.boneCache;i.length>n&&(i.length=n);for(var r=0,s=i.length;r<s;r++)i[r].length=0;for(;i.length<n;)i[i.length]=[];var a=i[0],o=this.bones;t:for(r=0,s=o.length;r<s;r++){var l=o[r],h=l;do{for(var c=0;c<e;c++)for(var u=t[c],d=u.bones[0],p=u.bones[u.bones.length-1];;){if(h==p){i[c].push(l),i[c+1].push(l);continue t}if(p==d)break;p=p.parent}h=h.parent}while(h);a[a.length]=l}},updateWorldTransform:function(){for(var t=this.bones,e=0,n=t.length;e<n;e++){var i=t[e];i.rotationIK=i.rotation}e=0;for(var r=this.boneCache.length-1;;){for(var s=this.boneCache[e],a=0,o=s.length;a<o;a++)s[a].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var i=this.ikConstraints;for(e=0,n=i.length;e<n;e++){var r=i[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,n=t.length;e<n;e++)t[e].setToSetupPose(e);this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return e[n];return null},findBoneIndex:function(t){for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},findSlot:function(t){for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return e[n];return null},findSlotIndex:function(t){for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n],s=r.data.attachmentName;if(s){var a=t.getAttachment(n,s);a&&r.setAttachment(a)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var n=this.skin.getAttachment(t,e);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var n=this.slots,i=0,r=n.length;i<r;i++){var s=n[i];if(s.data.name==t){var a=null;if(e&&!(a=this.getAttachmentBySlotIndex(i,e)))throw"Attachment not found: "+e+", for slot: "+t;return void s.setAttachment(a)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return e[n];return null},update:function(t){this.time+=t},resetDrawOrder:function(){for(var t=0,e=this.drawOrder.length;t<e;t++)this.drawOrder[t]=t}},e.EventData=function(t){this.name=t},e.EventData.prototype={intValue:0,floatValue:0,stringValue:null},e.Event=function(t){this.data=t},e.Event.prototype={intValue:0,floatValue:0,stringValue:null},e.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},e.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},e.RegionAttachment.prototype={type:e.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,n,i,r){var s=this.uvs;r?(s[2]=t,s[3]=i,s[4]=t,s[5]=e,s[6]=n,s[7]=e,s[0]=n,s[1]=i):(s[0]=t,s[1]=i,s[2]=t,s[3]=e,s[4]=n,s[5]=e,s[6]=n,s[7]=i)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,n=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*n,s=i+this.regionWidth*t,a=r+this.regionHeight*n,o=this.rotation*e.degRad,l=Math.cos(o),h=Math.sin(o),c=i*l+this.x,u=i*h,d=r*l+this.y,p=r*h,f=s*l+this.x,g=s*h,m=a*l+this.y,v=a*h,_=this.offset;_[0]=c-p,_[1]=d+u,_[2]=c-v,_[3]=m+u,_[4]=f-v,_[5]=m+g,_[6]=f-p,_[7]=d+g},computeVertices:function(t,e,n,i){t+=n.worldX,e+=n.worldY;var r=n.m00,s=n.m01,a=n.m10,o=n.m11,l=this.offset;i[0]=l[0]*r+l[1]*s+t,i[1]=l[0]*a+l[1]*o+e,i[2]=l[2]*r+l[3]*s+t,i[3]=l[2]*a+l[3]*o+e,i[4]=l[4]*r+l[5]*s+t,i[5]=l[4]*a+l[5]*o+e,i[6]=l[6]*r+l[7]*s+t,i[7]=l[6]*a+l[7]*o+e}},e.MeshAttachment=function(t){this.name=t},e.MeshAttachment.prototype={type:e.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,n=this.regionV2-this.regionV,i=this.regionUVs.length;if(this.uvs&&this.uvs.length==i||(this.uvs=new e.Float32Array(i)),this.regionRotate)for(var r=0;r<i;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r+1]*t,this.uvs[r+1]=this.regionV+n-this.regionUVs[r]*n;else for(r=0;r<i;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r]*t,this.uvs[r+1]=this.regionV+this.regionUVs[r+1]*n},computeWorldVertices:function(t,e,n,i){var r=n.bone;t+=r.worldX,e+=r.worldY;var s=r.m00,a=r.m01,o=r.m10,l=r.m11,h=this.vertices,c=h.length;n.attachmentVertices.length==c&&(h=n.attachmentVertices);for(var u=0;u<c;u+=2){var d=h[u],p=h[u+1];i[u]=d*s+p*a+t,i[u+1]=d*o+p*l+e}}},e.SkinnedMeshAttachment=function(t){this.name=t},e.SkinnedMeshAttachment.prototype={type:e.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,n,i,r,s){var a=this.regionU2-this.regionU,o=this.regionV2-this.regionV,l=this.regionUVs.length;if(this.uvs&&this.uvs.length==l||(this.uvs=new e.Float32Array(l)),this.regionRotate)for(var h=0;h<l;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h+1]*a,this.uvs[h+1]=this.regionV+o-this.regionUVs[h]*o;else for(h=0;h<l;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h]*a,this.uvs[h+1]=this.regionV+this.regionUVs[h+1]*o},computeWorldVertices:function(t,e,n,i){var r,s,a,o,l,h,c,u=n.bone.skeleton.bones,d=this.weights,p=this.bones,f=0,g=0,m=0,v=0,_=p.length;if(n.attachmentVertices.length)for(var y=n.attachmentVertices;g<_;f+=2){for(s=0,a=0,r=p[g++]+g;g<r;g++,m+=3,v+=2)o=u[p[g]],l=d[m]+y[v],h=d[m+1]+y[v+1],c=d[m+2],s+=(l*o.m00+h*o.m01+o.worldX)*c,a+=(l*o.m10+h*o.m11+o.worldY)*c;i[f]=s+t,i[f+1]=a+e}else for(;g<_;f+=2){for(s=0,a=0,r=p[g++]+g;g<r;g++,m+=3)o=u[p[g]],l=d[m],h=d[m+1],c=d[m+2],s+=(l*o.m00+h*o.m01+o.worldX)*c,a+=(l*o.m10+h*o.m11+o.worldY)*c;i[f]=s+t,i[f+1]=a+e}}},e.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},e.BoundingBoxAttachment.prototype={type:e.AttachmentType.boundingbox,computeWorldVertices:function(t,e,n,i){t+=n.worldX,e+=n.worldY;for(var r=n.m00,s=n.m01,a=n.m10,o=n.m11,l=this.vertices,h=0,c=l.length;h<c;h+=2){var u=l[h],d=l[h+1];i[h]=u*r+d*s+t,i[h+1]=u*a+d*o+e}}},e.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},e.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,n){var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(i,r,n)},setMix:function(t,e,n){this.animationToMixTime[t.name+":"+e.name]=n},getMix:function(t,e){var n=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(n)?this.animationToMixTime[n]:this.defaultMix}},e.TrackEntry=function(){},e.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},e.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},e.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var n=this.tracks[e];if(n){if(n.time+=t*n.timeScale,n.previous){var i=t*n.previous.timeScale;n.previous.time+=i,n.mixTime+=i}var r=n.next;r?(r.time=n.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!n.loop&&n.lastTime>=n.endTime&&this.clearTrack(e)}}},apply:function(t){t.resetDrawOrder();for(var e=0;e<this.tracks.length;e++){var n=this.tracks[e];if(n){this.events.length=0;var i=n.time,r=n.lastTime,s=n.endTime,a=n.loop;!a&&i>s&&(i=s);var o=n.previous;if(o){var l=o.time;!o.loop&&l>o.endTime&&(l=o.endTime),o.animation.apply(t,l,l,o.loop,null);var h=n.mixTime/n.mixDuration*n.mix;h>=1&&(h=1,n.previous=null),n.animation.mix(t,n.lastTime,i,a,this.events,h)}else 1==n.mix?n.animation.apply(t,n.lastTime,i,a,this.events):n.animation.mix(t,n.lastTime,i,a,this.events,n.mix);for(var c=0,u=this.events.length;c<u;c++){var d=this.events[c];n.onEvent&&n.onEvent(e,d),this.onEvent&&this.onEvent(e,d)}if(a?r%s>i%s:r<s&&i>=s){var p=Math.floor(i/s);n.onComplete&&n.onComplete(e,p),this.onComplete&&this.onComplete(e,p)}n.lastTime=n.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var n=this._expandToIndex(t);if(n){var i=n.previous;n.previous=null,n.onEnd&&n.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(n.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,i&&n.mixTime/n.mixDuration<.5?e.previous=i:e.previous=n)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,n){var i=this.data.skeletonData.findAnimation(e);if(!i)throw"Animation not found: "+e;return this.setAnimation(t,i,n)},setAnimation:function(t,n,i){var r=new e.TrackEntry;return r.animation=n,r.loop=i,r.endTime=n.duration,this.setCurrent(t,r),r},addAnimationByName:function(t,e,n,i){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,n,i)},addAnimation:function(t,n,i,r){var s=new e.TrackEntry;s.animation=n,s.loop=i,s.endTime=n.duration;var a=this._expandToIndex(t);if(a){for(;a.next;)a=a.next;a.next=s}else this.tracks[t]=s;return r<=0&&(a?r+=a.endTime-this.data.getMix(a.animation,n):r=0),s.delay=r,s},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},e.SkeletonJson=function(t){this.attachmentLoader=t},e.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,n){var i=new e.SkeletonData;i.name=n;var r=t.skeleton;r&&(i.hash=r.hash,i.version=r.spine,i.width=r.width||0,i.height=r.height||0);for(var s=0,a=(c=t.bones).length;s<a;s++){var o=c[s],l=null;if(o.parent&&!(l=i.findBone(o.parent)))throw"Parent bone not found: "+o.parent;(v=new e.BoneData(o.name,l)).length=(o.length||0)*this.scale,v.x=(o.x||0)*this.scale,v.y=(o.y||0)*this.scale,v.rotation=o.rotation||0,v.scaleX=o.hasOwnProperty("scaleX")?o.scaleX:1,v.scaleY=o.hasOwnProperty("scaleY")?o.scaleY:1,v.inheritScale=!o.hasOwnProperty("inheritScale")||o.inheritScale,v.inheritRotation=!o.hasOwnProperty("inheritRotation")||o.inheritRotation,i.bones.push(v)}var h=t.ik;if(h)for(s=0,a=h.length;s<a;s++){for(var c,u=h[s],d=new e.IkConstraintData(u.name),p=0,f=(c=u.bones).length;p<f;p++){var g=i.findBone(c[p]);if(!g)throw"IK bone not found: "+c[p];d.bones.push(g)}if(d.target=i.findBone(u.target),!d.target)throw"Target bone not found: "+u.target;d.bendDirection=!u.hasOwnProperty("bendPositive")||u.bendPositive?1:-1,d.mix=u.hasOwnProperty("mix")?u.mix:1,i.ikConstraints.push(d)}var m=t.slots;for(s=0,a=m.length;s<a;s++){var v,_=m[s];if(!(v=i.findBone(_.bone)))throw"Slot bone not found: "+_.bone;var y=new e.SlotData(_.name,v),x=_.color;x&&(y.r=this.toColor(x,0),y.g=this.toColor(x,1),y.b=this.toColor(x,2),y.a=this.toColor(x,3)),y.attachmentName=_.attachment,y.additiveBlending=_.additive&&"true"==_.additive,i.slots.push(y)}var b=t.skins;for(var w in b)if(b.hasOwnProperty(w)){var S=b[w],M=new e.Skin(w);for(var T in S)if(S.hasOwnProperty(T)){var E=i.findSlotIndex(T),C=S[T];for(var A in C)if(C.hasOwnProperty(A)){var R=this.readAttachment(M,A,C[A]);R&&M.addAttachment(E,A,R)}}i.skins.push(M),"default"==M.name&&(i.defaultSkin=M)}var L=t.events;for(var P in L)if(L.hasOwnProperty(P)){var k=L[P],D=new e.EventData(P);D.intValue=k.int||0,D.floatValue=k.float||0,D.stringValue=k.string||null,i.events.push(D)}var I=t.animations;for(var O in I)I.hasOwnProperty(O)&&this.readAnimation(O,I[O],i);return i},readAttachment:function(t,n,i){n=i.name||n;var r=e.AttachmentType[i.type||"region"],s=i.path||n,a=this.scale;if(r==e.AttachmentType.region){var o=this.attachmentLoader.newRegionAttachment(t,n,s);if(!o)return null;o.path=s,o.x=(i.x||0)*a,o.y=(i.y||0)*a,o.scaleX=i.hasOwnProperty("scaleX")?i.scaleX:1,o.scaleY=i.hasOwnProperty("scaleY")?i.scaleY:1,o.rotation=i.rotation||0,o.width=(i.width||0)*a,o.height=(i.height||0)*a;var l=i.color;return l&&(o.r=this.toColor(l,0),o.g=this.toColor(l,1),o.b=this.toColor(l,2),o.a=this.toColor(l,3)),o.updateOffset(),o}if(r==e.AttachmentType.mesh)return(h=this.attachmentLoader.newMeshAttachment(t,n,s))?(h.path=s,h.vertices=this.getFloatArray(i,"vertices",a),h.triangles=this.getIntArray(i,"triangles"),h.regionUVs=this.getFloatArray(i,"uvs",1),h.updateUVs(),(l=i.color)&&(h.r=this.toColor(l,0),h.g=this.toColor(l,1),h.b=this.toColor(l,2),h.a=this.toColor(l,3)),h.hullLength=2*(i.hull||0),i.edges&&(h.edges=this.getIntArray(i,"edges")),h.width=(i.width||0)*a,h.height=(i.height||0)*a,h):null;if(r==e.AttachmentType.skinnedmesh){var h;if(!(h=this.attachmentLoader.newSkinnedMeshAttachment(t,n,s)))return null;h.path=s;for(var c=this.getFloatArray(i,"uvs",1),u=[],d=[],p=0,f=(v=this.getFloatArray(i,"vertices",1)).length;p<f;){var g=0|v[p++];d[d.length]=g;for(var m=p+4*g;p<m;)d[d.length]=v[p],u[u.length]=v[p+1]*a,u[u.length]=v[p+2]*a,u[u.length]=v[p+3],p+=4}return h.bones=d,h.weights=u,h.triangles=this.getIntArray(i,"triangles"),h.regionUVs=c,h.updateUVs(),(l=i.color)&&(h.r=this.toColor(l,0),h.g=this.toColor(l,1),h.b=this.toColor(l,2),h.a=this.toColor(l,3)),h.hullLength=2*(i.hull||0),i.edges&&(h.edges=this.getIntArray(i,"edges")),h.width=(i.width||0)*a,h.height=(i.height||0)*a,h}if(r==e.AttachmentType.boundingbox){var v,_=this.attachmentLoader.newBoundingBoxAttachment(t,n);for(p=0,f=(v=i.vertices).length;p<f;p++)_.vertices.push(v[p]*a);return _}throw"Unknown attachment type: "+r},readAnimation:function(t,n,i){var r=[],s=0,a=n.slots;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o],h=i.findSlotIndex(o);for(var c in l)if(l.hasOwnProperty(c)){var u=l[c];if("color"==c){(U=new e.ColorTimeline(u.length)).slotIndex=h;for(var d=0,p=0,f=u.length;p<f;p++){var g=(x=u[p]).color,m=this.toColor(g,0),v=this.toColor(g,1),_=this.toColor(g,2),y=this.toColor(g,3);U.setFrame(d,x.time,m,v,_,y),this.readCurve(U,d,x),d++}r.push(U),s=Math.max(s,U.frames[5*U.getFrameCount()-5])}else{if("attachment"!=c)throw"Invalid timeline type for a slot: "+c+" ("+o+")";for((U=new e.AttachmentTimeline(u.length)).slotIndex=h,d=0,p=0,f=u.length;p<f;p++){var x=u[p];U.setFrame(d++,x.time,x.name)}r.push(U),s=Math.max(s,U.frames[U.getFrameCount()-1])}}}var b=n.bones;for(var w in b)if(b.hasOwnProperty(w)){var S=i.findBoneIndex(w);if(-1==S)throw"Bone not found: "+w;var M=b[w];for(var c in M)if(M.hasOwnProperty(c))if(u=M[c],"rotate"==c){for((U=new e.RotateTimeline(u.length)).boneIndex=S,d=0,p=0,f=u.length;p<f;p++)x=u[p],U.setFrame(d,x.time,x.angle),this.readCurve(U,d,x),d++;r.push(U),s=Math.max(s,U.frames[2*U.getFrameCount()-2])}else if("translate"==c||"scale"==c){var T=1;for("scale"==c?U=new e.ScaleTimeline(u.length):(U=new e.TranslateTimeline(u.length),T=this.scale),U.boneIndex=S,d=0,p=0,f=u.length;p<f;p++){var E=((x=u[p]).x||0)*T,C=(x.y||0)*T;U.setFrame(d,x.time,E,C),this.readCurve(U,d,x),d++}r.push(U),s=Math.max(s,U.frames[3*U.getFrameCount()-3])}else{if("flipX"!=c&&"flipY"!=c)throw"Invalid timeline type for a bone: "+c+" ("+w+")";(U=(E="flipX"==c)?new e.FlipXTimeline(u.length):new e.FlipYTimeline(u.length)).boneIndex=S;var A=E?"x":"y";for(d=0,p=0,f=u.length;p<f;p++)x=u[p],U.setFrame(d,x.time,x[A]||!1),d++;r.push(U),s=Math.max(s,U.frames[2*U.getFrameCount()-2])}}var R=n.ik;for(var L in R)if(R.hasOwnProperty(L)){var P=i.findIkConstraint(L);for(u=R[L],(U=new e.IkConstraintTimeline(u.length)).ikConstraintIndex=i.ikConstraints.indexOf(P),d=0,p=0,f=u.length;p<f;p++){var k=(x=u[p]).hasOwnProperty("mix")?x.mix:1,D=!x.hasOwnProperty("bendPositive")||x.bendPositive?1:-1;U.setFrame(d,x.time,k,D),this.readCurve(U,d,x),d++}r.push(U),s=Math.max(s,U.frames[3*U.frameCount-3])}var I=n.ffd;for(var O in I){var B=i.findSkin(O);for(o in l=I[O]){h=i.findSlotIndex(o);var F=l[o];for(var N in F){u=F[N];var U=new e.FfdTimeline(u.length),z=B.getAttachment(h,N);if(!z)throw"FFD attachment not found: "+N;U.slotIndex=h,U.attachment=z;var G,H=z.type==e.AttachmentType.mesh;for(G=H?z.vertices.length:z.weights.length/3*2,d=0,p=0,f=u.length;p<f;p++){if((x=u[p]).vertices){var W,V=x.vertices;(W=[]).length=G;var j=x.offset||0,X=V.length;if(1==this.scale)for(var Y=0;Y<X;Y++)W[Y+j]=V[Y];else for(Y=0;Y<X;Y++)W[Y+j]=V[Y]*this.scale;if(H){var Z=z.vertices;for(Y=0,X=W.length;Y<X;Y++)W[Y]+=Z[Y]}}else H?W=z.vertices:(W=[]).length=G;U.setFrame(d,x.time,W),this.readCurve(U,d,x),d++}r[r.length]=U,s=Math.max(s,U.frames[U.frameCount-1])}}}var q=n.drawOrder;if(q||(q=n.draworder),q){U=new e.DrawOrderTimeline(q.length);var J=i.slots.length;for(d=0,p=0,f=q.length;p<f;p++){var K=q[p],Q=null;if(K.offsets){for((Q=[]).length=J,Y=J-1;Y>=0;Y--)Q[Y]=-1;var $=K.offsets,tt=[];tt.length=J-$.length;var et=0,nt=0;for(Y=0,X=$.length;Y<X;Y++){var it=$[Y];if(-1==(h=i.findSlotIndex(it.slot)))throw"Slot not found: "+it.slot;for(;et!=h;)tt[nt++]=et++;Q[et+it.offset]=et++}for(;et<J;)tt[nt++]=et++;for(Y=J-1;Y>=0;Y--)-1==Q[Y]&&(Q[Y]=tt[--nt])}U.setFrame(d++,K.time,Q)}r.push(U),s=Math.max(s,U.frames[U.getFrameCount()-1])}var rt=n.events;if(rt){for(U=new e.EventTimeline(rt.length),d=0,p=0,f=rt.length;p<f;p++){var st=rt[p],at=i.findEvent(st.name);if(!at)throw"Event not found: "+st.name;var ot=new e.Event(at);ot.intValue=st.hasOwnProperty("int")?st.int:at.intValue,ot.floatValue=st.hasOwnProperty("float")?st.float:at.floatValue,ot.stringValue=st.hasOwnProperty("string")?st.string:at.stringValue,U.setFrame(d++,st.time,ot)}r.push(U),s=Math.max(s,U.frames[U.getFrameCount()-1])}i.animations.push(new e.Animation(t,r,s))},readCurve:function(t,e,n){var i=n.curve;i?"stepped"==i?t.curves.setStepped(e):i instanceof Array&&t.curves.setCurve(e,i[0],i[1],i[2],i[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,n,i){var r=t[n],s=new e.Float32Array(r.length),a=0,o=r.length;if(1==i)for(;a<o;a++)s[a]=r[a];else for(;a<o;a++)s[a]=r[a]*i;return s},getIntArray:function(t,n){for(var i=t[n],r=new e.Uint16Array(i.length),s=0,a=i.length;s<a;s++)r[s]=0|i[s];return r}},e.Atlas=function(t,n){this.textureLoader=n,this.pages=[],this.regions=[];var i=new e.AtlasReader(t),r=[];r.length=4;for(var s=null;;){var a=i.readLine();if(null===a)break;if((a=i.trim(a)).length)if(s){var o=new e.AtlasRegion;o.name=a,o.page=s,o.rotate="true"==i.readValue(),i.readTuple(r);var l=parseInt(r[0]),h=parseInt(r[1]);i.readTuple(r);var c=parseInt(r[0]),u=parseInt(r[1]);o.u=l/s.width,o.v=h/s.height,o.rotate?(o.u2=(l+u)/s.width,o.v2=(h+c)/s.height):(o.u2=(l+c)/s.width,o.v2=(h+u)/s.height),o.x=l,o.y=h,o.width=Math.abs(c),o.height=Math.abs(u),4==i.readTuple(r)&&(o.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==i.readTuple(r)&&(o.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],i.readTuple(r))),o.originalWidth=parseInt(r[0]),o.originalHeight=parseInt(r[1]),i.readTuple(r),o.offsetX=parseInt(r[0]),o.offsetY=parseInt(r[1]),o.index=parseInt(i.readValue()),this.regions.push(o)}else{(s=new e.AtlasPage).name=a,2==i.readTuple(r)&&(s.width=parseInt(r[0]),s.height=parseInt(r[1]),i.readTuple(r)),s.format=e.Atlas.Format[r[0]],i.readTuple(r),s.minFilter=e.Atlas.TextureFilter[r[0]],s.magFilter=e.Atlas.TextureFilter[r[1]];var d=i.readValue();s.uWrap=e.Atlas.TextureWrap.clampToEdge,s.vWrap=e.Atlas.TextureWrap.clampToEdge,"x"==d?s.uWrap=e.Atlas.TextureWrap.repeat:"y"==d?s.vWrap=e.Atlas.TextureWrap.repeat:"xy"==d&&(s.uWrap=s.vWrap=e.Atlas.TextureWrap.repeat),n.load(s,a,this),this.pages.push(s)}else s=null}},e.Atlas.prototype={findRegion:function(t){for(var e=this.regions,n=0,i=e.length;n<i;n++)if(e[n].name==t)return e[n];return null},dispose:function(){for(var t=this.pages,e=0,n=t.length;e<n;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,n=0,i=e.length;n<i;n++){var r=e[n];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},e.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},e.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},e.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},e.AtlasPage=function(){},e.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},e.AtlasRegion=function(){},e.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},e.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},e.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),n=e.indexOf(":");if(-1==n)throw"Invalid line: "+e;for(var i=0,r=n+1;i<3;i++){var s=e.indexOf(",",r);if(-1==s)break;t[i]=this.trim(e.substr(r,s-r)),r=s+1}return t[i]=this.trim(e.substring(r)),i+1}},e.AtlasAttachmentLoader=function(t){this.atlas=t},e.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,n,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (region attachment: "+n+")";var s=new e.RegionAttachment(n);return s.rendererObject=r,s.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newMeshAttachment:function(t,n,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (mesh attachment: "+n+")";var s=new e.MeshAttachment(n);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newSkinnedMeshAttachment:function(t,n,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (skinned mesh attachment: "+n+")";var s=new e.SkinnedMeshAttachment(n);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newBoundingBoxAttachment:function(t,n){return new e.BoundingBoxAttachment(n)}},e.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},e.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,n){var i=t.slots,r=i.length,s=t.x,a=t.y,o=this.boundingBoxes,l=this.polygonPool,h=this.polygons;o.length=0;for(var c=0,u=h.length;c<u;c++)l.push(h[c]);for(h.length=0,c=0;c<r;c++){var d=i[c],p=d.attachment;if(p.type==e.AttachmentType.boundingbox){o.push(p);var f,g=l.length;g>0?(f=l[g-1],l.splice(g-1,1)):f=[],h.push(f),f.length=p.vertices.length,p.computeWorldVertices(s,a,d.bone,f)}}n&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,n=Number.MAX_VALUE,i=Number.MIN_VALUE,r=Number.MIN_VALUE,s=0,a=t.length;s<a;s++)for(var o=t[s],l=0,h=o.length;l<h;l+=2){var c=o[l],u=o[l+1];e=Math.min(e,c),n=Math.min(n,u),i=Math.max(i,c),r=Math.max(r,u)}this.minX=e,this.minY=n,this.maxX=i,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,n,i){var r=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=r&&n<=r||e<=s&&i<=s||t>=a&&n>=a||e>=o&&i>=o)return!1;var l=(i-e)/(n-t),h=l*(r-t)+e;if(h>s&&h<o)return!0;if((h=l*(a-t)+e)>s&&h<o)return!0;var c=(s-e)/l+t;return c>r&&c<a||(c=(o-e)/l+t)>r&&c<a},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var n=this.polygons,i=0,r=n.length;i<r;i++)if(this.polygonContainsPoint(n[i],t,e))return this.boundingBoxes[i];return null},intersectsSegment:function(t,e,n,i){for(var r=this.polygons,s=0,a=r.length;s<a;s++)if(r[s].intersectsSegment(t,e,n,i))return this.boundingBoxes[s];return null},polygonContainsPoint:function(t,e,n){for(var i=t.length,r=i-2,s=!1,a=0;a<i;a+=2){var o=t[a+1],l=t[r+1];if(o<n&&l>=n||l<n&&o>=n){var h=t[a];h+(n-o)/(l-o)*(t[r]-h)<e&&(s=!s)}r=a}return s},polygonIntersectsSegment:function(t,e,n,i,r){for(var s=t.length,a=e-i,o=n-r,l=e*r-n*i,h=t[s-2],c=t[s-1],u=0;u<s;u+=2){var d=t[u],p=t[u+1],f=h*p-c*d,g=h-d,m=c-p,v=a*m-o*g,_=(l*g-a*f)/v;if((_>=h&&_<=d||_>=d&&_<=h)&&(_>=e&&_<=i||_>=i&&_<=e)){var y=(l*m-o*f)/v;if((y>=c&&y<=p||y>=p&&y<=c)&&(y>=n&&y<=r||y>=r&&y<=n))return!0}h=d,c=p}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},e.Bone.yDown=!0,t.AnimCache={},t.SpineTextureLoader=function(e,n){t.EventTarget.call(this),this.basePath=e,this.crossorigin=n,this.loadingCount=0},t.SpineTextureLoader.prototype=t.SpineTextureLoader,t.SpineTextureLoader.prototype.load=function(e,n){if(e.rendererObject=t.BaseTexture.fromImage(this.basePath+"/"+n,this.crossorigin),!e.rendererObject.hasLoaded){var i=this;++i.loadingCount,e.rendererObject.addEventListener("loaded",function(){--i.loadingCount,i.dispatchEvent({type:"loadedBaseTexture",content:i})})}},t.SpineTextureLoader.prototype.unload=function(t){t.destroy(!0)},t.Spine=function(n){if(t.DisplayObjectContainer.call(this),this.spineData=t.AnimCache[n],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+n);this.skeleton=new e.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new e.AnimationStateData(this.spineData),this.state=new e.AnimationState(this.stateData),this.slotContainers=[];for(var i=0,r=this.skeleton.slots.length;i<r;i++){var s=this.skeleton.slots[i],a=s.attachment,o=new t.DisplayObjectContainer;if(this.slotContainers.push(o),this.addChild(o),a instanceof e.RegionAttachment){var l=a.rendererObject.name,h=this.createSprite(s,a);s.currentSprite=h,s.currentSpriteName=l,o.addChild(h)}else{if(!(a instanceof e.MeshAttachment))continue;var c=this.createMesh(s,a);s.currentMesh=c,s.currentMeshName=a.name,o.addChild(c)}}this.autoUpdate=!0},t.Spine.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Spine.prototype.constructor=t.Spine,Object.defineProperty(t.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===t.Spine.prototype.autoUpdateTransform},set:function(e){this.updateTransform=e?t.Spine.prototype.autoUpdateTransform:t.DisplayObjectContainer.prototype.updateTransform}}),t.Spine.prototype.update=function(n){this.state.update(n),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var i=this.skeleton.drawOrder,r=this.skeleton.slots,s=0,a=i.length;s<a;s++)this.children[s]=this.slotContainers[i[s]];for(s=0,a=r.length;s<a;s++){var o=r[s],l=o.attachment,h=this.slotContainers[s];if(l){var c=l.type;if(c===e.AttachmentType.region){if(l.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!==l.name)){var u=l.rendererObject.name;if(void 0!==o.currentSprite&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{},void 0!==o.sprites[u])o.sprites[u].visible=!0;else{var d=this.createSprite(o,l);h.addChild(d)}o.currentSprite=o.sprites[u],o.currentSpriteName=u}var p=o.bone;h.position.x=p.worldX+l.x*p.m00+l.y*p.m01,h.position.y=p.worldY+l.x*p.m10+l.y*p.m11,h.scale.x=p.worldScaleX,h.scale.y=p.worldScaleY,h.rotation=-o.bone.worldRotation*e.degRad,o.currentSprite.tint=t.rgb2hex([o.r,o.g,o.b])}else{if(c!==e.AttachmentType.skinnedmesh){h.visible=!1;continue}if(!o.currentMeshName||o.currentMeshName!==l.name){var f=l.name;if(void 0!==o.currentMesh&&(o.currentMesh.visible=!1),o.meshes=o.meshes||{},void 0!==o.meshes[f])o.meshes[f].visible=!0;else{var g=this.createMesh(o,l);h.addChild(g)}o.currentMesh=o.meshes[f],o.currentMeshName=f}l.computeWorldVertices(o.bone.skeleton.x,o.bone.skeleton.y,o,o.currentMesh.vertices)}h.visible=!0,h.alpha=o.a}else h.visible=!1}},t.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(e),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Spine.prototype.createSprite=function(n,i){var r=i.rendererObject,s=r.page.rendererObject,a=new t.Rectangle(r.x,r.y,r.rotate?r.height:r.width,r.rotate?r.width:r.height),o=new t.Texture(s,a),l=new t.Sprite(o),h=r.rotate?.5*Math.PI:0;return l.scale.set(r.width/r.originalWidth,r.height/r.originalHeight),l.rotation=h-i.rotation*e.degRad,l.anchor.x=l.anchor.y=.5,n.sprites=n.sprites||{},n.sprites[r.name]=l,l},t.Spine.prototype.createMesh=function(e,n){var i=n.rendererObject.page.rendererObject,r=new t.Texture(i),s=new t.Strip(r);return s.drawMode=t.Strip.DrawModes.TRIANGLES,s.canvasPadding=1.5,s.vertices=new t.Float32Array(n.uvs.length),s.uvs=n.uvs,s.indices=n.triangles,e.meshes=e.meshes||{},e.meshes[n.name]=s,s},t.BaseTextureCache={},t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,n){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=n||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this._UID=t._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],e){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var i=this;this.source.onload=function(){i.hasLoaded=!0,i.width=i.source.naturalWidth||i.source.width,i.height=i.source.naturalHeight||i.source.height,i.dirty(),i.dispatchEvent({type:"loaded",content:i})},this.source.onerror=function(){i.dispatchEvent({type:"error",content:i})}}this.imageUrl=null,this._powerOf2=!1}},t.BaseTexture.prototype.constructor=t.BaseTexture,t.EventTarget.mixin(t.BaseTexture.prototype),t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},t.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1,this.source.src=null,this.source.src=t},t.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},t.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var e=this._glTextures.length-1;e>=0;e--){var n=this._glTextures[e],i=t.glContexts[e];i&&n&&i.deleteTexture(n)}this._glTextures.length=0,this.dirty()},t.BaseTexture.fromImage=function(e,n,i){var r=t.BaseTextureCache[e];if(void 0===n&&-1===e.indexOf("data:")&&(n=!0),!r){var s=new Image;n&&(s.crossOrigin=""),s.src=e,(r=new t.BaseTexture(s,i)).imageUrl=e,t.BaseTextureCache[e]=r,-1!==e.indexOf(t.RETINA_PREFIX+".")&&(r.resolution=2)}return r},t.BaseTexture.fromCanvas=function(e,n){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var i=t.BaseTextureCache[e._pixiId];return i||(i=new t.BaseTexture(e,n),t.BaseTextureCache[e._pixiId]=i),i},t.TextureCache={},t.FrameCache={},t.TextureCacheIdGenerator=0,t.Texture=function(e,n,i,r){this.noFrame=!1,n||(this.noFrame=!0,n=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=n,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||new t.Rectangle(0,0,1,1),e.hasLoaded?(this.noFrame&&(n=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(n)):e.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},t.Texture.prototype.constructor=t.Texture,t.EventTarget.mixin(t.Texture.prototype),t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},t.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,n=this.baseTexture.width,i=this.baseTexture.height;this._uvs.x0=e.x/n,this._uvs.y0=e.y/i,this._uvs.x1=(e.x+e.width)/n,this._uvs.y1=e.y/i,this._uvs.x2=(e.x+e.width)/n,this._uvs.y2=(e.y+e.height)/i,this._uvs.x3=e.x/n,this._uvs.y3=(e.y+e.height)/i},t.Texture.fromImage=function(e,n,i){var r=t.TextureCache[e];return r||(r=new t.Texture(t.BaseTexture.fromImage(e,n,i)),t.TextureCache[e]=r),r},t.Texture.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return n},t.Texture.fromCanvas=function(e,n){var i=t.BaseTexture.fromCanvas(e,n);return new t.Texture(i)},t.Texture.addTextureToCache=function(e,n){t.TextureCache[n]=e},t.Texture.removeTextureFromCache=function(e){var n=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],n},t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.Texture.emptyTexture=new t.Texture(new t.BaseTexture),t.RenderTexture=function(e,n,i,r,s){if(this.width=e||100,this.height=n||100,this.resolution=s||1,this.frame=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=r||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,t.Texture.call(this,this.baseTexture,new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=i||t.defaultRenderer,this.renderer.type===t.WEBGL_RENDERER){var a=this.renderer.gl;this.baseTexture._dirty[a.id]=!1,this.textureBuffer=new t.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,n,i){e===this.width&&n===this.height||(this.valid=e>0&&n>0,this.width=e,this.height=n,this.frame.width=this.crop.width=e*this.resolution,this.frame.height=this.crop.height=n*this.resolution,i&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},t.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},t.RenderTexture.prototype.renderWebGL=function(t,e,n){if(this.valid){var i=t.worldTransform;i.identity(),i.translate(0,2*this.projection.y),e&&i.append(e),i.scale(1,-1),t.worldAlpha=1;for(var r=t.children,s=0,a=r.length;s<a;s++)r[s].updateTransform();var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer),n&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},t.RenderTexture.prototype.renderCanvas=function(t,e,n){if(this.valid){var i=t.worldTransform;i.identity(),e&&i.append(e),t.worldAlpha=1;for(var r=t.children,s=0,a=r.length;s<a;s++)r[s].updateTransform();n&&this.textureBuffer.clear();var o=this.textureBuffer.context,l=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,o),this.renderer.resolution=l}},t.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},t.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},t.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===t.WEBGL_RENDERER){var e=this.renderer.gl,n=this.textureBuffer.width,i=this.textureBuffer.height,r=new Uint8Array(4*n*i);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,n,i,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var s=new t.CanvasBuffer(n,i),a=s.context.getImageData(0,0,n,i);return a.data.set(r),s.context.putImageData(a,0,0),s.canvas}return this.textureBuffer.canvas},t.RenderTexture.tempMatrix=new t.Matrix,t.VideoTexture=function(e,n){if(!e)throw new Error("No video source element specified.");(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),t.BaseTexture.call(this,e,n),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),e.complete||(this._onCanPlay=this.onCanPlay.bind(this),e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("play",this.onPlayStart.bind(this)),e.addEventListener("pause",this.onPlayStop.bind(this)))},t.VideoTexture.prototype=Object.create(t.BaseTexture.prototype),t.VideoTexture.constructor=t.VideoTexture,t.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},t.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},t.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},t.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))},t.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(t.BaseTextureCache[this.source._pixiId]=null,delete t.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),t.BaseTexture.prototype.destroy.call(this)},t.VideoTexture.baseTextureFromVideo=function(e,n){e._pixiId||(e._pixiId="video_"+t.TextureCacheIdGenerator++);var i=t.BaseTextureCache[e._pixiId];return i||(i=new t.VideoTexture(e,n),t.BaseTextureCache[e._pixiId]=i),i},t.VideoTexture.textureFromVideo=function(e,n){var i=t.VideoTexture.baseTextureFromVideo(e,n);return new t.Texture(i)},t.VideoTexture.fromUrl=function(e,n){var i=document.createElement("video");return i.src=e,i.autoPlay=!0,i.play(),t.VideoTexture.textureFromVideo(i,n)},t.AssetLoader=function(e,n){this.assetURLs=e,this.crossorigin=n,this.loadersByType={jpg:t.ImageLoader,jpeg:t.ImageLoader,png:t.ImageLoader,gif:t.ImageLoader,webp:t.ImageLoader,json:t.JsonLoader,atlas:t.AtlasLoader,anim:t.SpineLoader,xml:t.BitmapFontLoader,fnt:t.BitmapFontLoader}},t.EventTarget.mixin(t.AssetLoader.prototype),t.AssetLoader.prototype.constructor=t.AssetLoader,t.AssetLoader.prototype._getDataType=function(t){if("data:"===t.slice(0,"data:".length).toLowerCase()){var e=t.slice("data:".length),n=e.indexOf(",");if(-1===n)return null;var i=e.slice(0,n).split(";")[0];return i&&"text/plain"!==i.toLowerCase()?i.split("/").pop().toLowerCase():"txt"}return null},t.AssetLoader.prototype.load=function(){var t=this;function e(e){t.onAssetLoaded(e.data.content)}this.loadCount=this.assetURLs.length;for(var n=0;n<this.assetURLs.length;n++){var i=this.assetURLs[n],r=this._getDataType(i);r||(r=i.split("?").shift().split(".").pop().toLowerCase());var s=this.loadersByType[r];if(!s)throw new Error(r+" is an unsupported file type");var a=new s(i,this.crossorigin);a.on("loaded",e),a.load()}},t.AssetLoader.prototype.onAssetLoaded=function(t){this.loadCount--,this.emit("onProgress",{content:this,loader:t,loaded:this.assetURLs.length-this.loadCount,total:this.assetURLs.length}),this.onProgress&&this.onProgress(t),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},t.JsonLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},t.JsonLoader.prototype.constructor=t.JsonLoader,t.EventTarget.mixin(t.JsonLoader.prototype),t.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},t.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},t.JsonLoader.prototype.onJSONLoaded=function(){if(this.ajaxRequest.responseText)if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames&&this.json.meta&&this.json.meta.image){var n=this.json.meta.image;-1===n.indexOf("data:")&&(n=this.baseUrl+n);var i=new t.ImageLoader(n,this.crossorigin),r=this.json.frames;for(var s in this.texture=i.texture.baseTexture,i.addEventListener("loaded",this.onLoaded.bind(this)),r){var a=r[s].frame;if(a){var o=new t.Rectangle(a.x,a.y,a.w,a.h),l=o.clone(),h=null;if(r[s].trimmed){var c=r[s].sourceSize,u=r[s].spriteSourceSize;h=new t.Rectangle(u.x,u.y,c.w,c.h)}t.TextureCache[s]=new t.Texture(this.texture,o,l,h)}}i.load()}else if(this.json.bones)if(t.AnimCache[this.url])this.onLoaded();else{var d=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",p=new t.JsonLoader(d,this.crossorigin),f=this;p.onJSONLoaded=function(){if(this.ajaxRequest.responseText){var n=new t.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),i=new e.Atlas(this.ajaxRequest.responseText,n),r=new e.AtlasAttachmentLoader(i),s=new e.SkeletonJson(r).readSkeletonData(f.json);t.AnimCache[f.url]=s,f.spine=s,f.spineAtlas=i,f.spineAtlasLoader=p,n.loadingCount>0?n.addEventListener("loadedBaseTexture",function(t){t.content.content.loadingCount<=0&&f.onLoaded()}):f.onLoaded()}else this.onError()},p.load()}else this.onLoaded();else this.onError()},t.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},t.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},t.AtlasLoader=function(t,e){this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},t.AtlasLoader.constructor=t.AtlasLoader,t.EventTarget.mixin(t.AtlasLoader.prototype),t.AtlasLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},t.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var e=this.ajaxRequest.responseText.split(/\r?\n/),n=-3,i=0,r=null,s=!1,a=0,o=0,l=this.onLoaded.bind(this);for(a=0;a<e.length;a++)if(e[a]=e[a].replace(/^\s+|\s+$/g,""),""===e[a]&&(s=a+1),e[a].length>0){if(s===a)this.atlas.meta.image.push(e[a]),i=this.atlas.meta.image.length-1,this.atlas.frames.push({}),n=-3;else if(n>0)if(n%7==1)null!=r&&(this.atlas.frames[i][r.name]=r),r={name:e[a],frame:{}};else{var h=e[a].split(" ");if(n%7==3)r.frame.x=Number(h[1].replace(",","")),r.frame.y=Number(h[2]);else if(n%7==4)r.frame.w=Number(h[1].replace(",","")),r.frame.h=Number(h[2]);else if(n%7==5){var c={x:0,y:0,w:Number(h[1].replace(",","")),h:Number(h[2])};c.w>r.frame.w||c.h>r.frame.h?(r.trimmed=!0,r.realSize=c):r.trimmed=!1}}n++}if(null!=r&&(this.atlas.frames[i][r.name]=r),this.atlas.meta.image.length>0){for(this.images=[],o=0;o<this.atlas.meta.image.length;o++){var u=this.baseUrl+this.atlas.meta.image[o],d=this.atlas.frames[o];for(a in this.images.push(new t.ImageLoader(u,this.crossorigin)),d){var p=d[a].frame;p&&(t.TextureCache[a]=new t.Texture(this.images[o].texture.baseTexture,{x:p.x,y:p.y,width:p.w,height:p.h}),d[a].trimmed&&(t.TextureCache[a].realSize=d[a].realSize,t.TextureCache[a].trim.x=0,t.TextureCache[a].trim.y=0))}}for(this.currentImageId=0,o=0;o<this.images.length;o++)this.images[o].on("loaded",l);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},t.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},t.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},t.SpriteSheetLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},t.SpriteSheetLoader.prototype.constructor=t.SpriteSheetLoader,t.EventTarget.mixin(t.SpriteSheetLoader.prototype),t.SpriteSheetLoader.prototype.load=function(){var e=this,n=new t.JsonLoader(this.url,this.crossorigin);n.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),n.load()},t.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader=function(e,n){this.texture=t.Texture.fromImage(e,n),this.frames=[]},t.ImageLoader.prototype.constructor=t.ImageLoader,t.EventTarget.mixin(t.ImageLoader.prototype),t.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},t.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader.prototype.loadFramedSpriteSheet=function(e,n,i){this.frames=[];for(var r=Math.floor(this.texture.width/e),s=Math.floor(this.texture.height/n),a=0,o=0;o<s;o++)for(var l=0;l<r;l++,a++){var h=new t.Texture(this.texture.baseTexture,{x:l*e,y:o*n,width:e,height:n});this.frames.push(h),i&&(t.TextureCache[i+"-"+a]=h)}this.load()},t.BitmapFontLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},t.BitmapFontLoader.prototype.constructor=t.BitmapFontLoader,t.EventTarget.mixin(t.BitmapFontLoader.prototype),t.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},t.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var e=this.ajaxRequest.responseXML;if(!e||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser)e=(new DOMParser).parseFromString(this.ajaxRequest.responseText,"text/xml");else{var n=document.createElement("div");n.innerHTML=this.ajaxRequest.responseText,e=n}var i=this.baseUrl+e.getElementsByTagName("page")[0].getAttribute("file"),r=new t.ImageLoader(i,this.crossorigin);this.texture=r.texture.baseTexture;var s={},a=e.getElementsByTagName("info")[0],o=e.getElementsByTagName("common")[0];s.font=a.getAttribute("face"),s.size=parseInt(a.getAttribute("size"),10),s.lineHeight=parseInt(o.getAttribute("lineHeight"),10),s.chars={};for(var l=e.getElementsByTagName("char"),h=0;h<l.length;h++){var c=parseInt(l[h].getAttribute("id"),10),u=new t.Rectangle(parseInt(l[h].getAttribute("x"),10),parseInt(l[h].getAttribute("y"),10),parseInt(l[h].getAttribute("width"),10),parseInt(l[h].getAttribute("height"),10));s.chars[c]={xOffset:parseInt(l[h].getAttribute("xoffset"),10),yOffset:parseInt(l[h].getAttribute("yoffset"),10),xAdvance:parseInt(l[h].getAttribute("xadvance"),10),kerning:{},texture:t.TextureCache[c]=new t.Texture(this.texture,u)}}var d=e.getElementsByTagName("kerning");for(h=0;h<d.length;h++){var p=parseInt(d[h].getAttribute("first"),10),f=parseInt(d[h].getAttribute("second"),10),g=parseInt(d[h].getAttribute("amount"),10);s.chars[f].kerning[p]=g}t.BitmapText.fonts[s.font]=s,r.addEventListener("loaded",this.onLoaded.bind(this)),r.load()}},t.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.SpineLoader=function(t,e){this.url=t,this.crossorigin=e,this.loaded=!1},t.SpineLoader.prototype.constructor=t.SpineLoader,t.EventTarget.mixin(t.SpineLoader.prototype),t.SpineLoader.prototype.load=function(){var e=this,n=new t.JsonLoader(this.url,this.crossorigin);n.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),n.load()},t.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},t.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},t.AbstractFilter.prototype.constructor=t.AbstractFilter,t.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},t.AlphaMaskFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:e},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mask.value.x=e.width,this.uniforms.mask.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},t.AlphaMaskFilter.prototype=Object.create(t.AbstractFilter.prototype),t.AlphaMaskFilter.prototype.constructor=t.AlphaMaskFilter,t.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}}),t.ColorMatrixFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},t.ColorMatrixFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorMatrixFilter.prototype.constructor=t.ColorMatrixFilter,Object.defineProperty(t.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}}),t.GrayFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},t.GrayFilter.prototype=Object.create(t.AbstractFilter.prototype),t.GrayFilter.prototype.constructor=t.GrayFilter,Object.defineProperty(t.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}),t.DisplacementFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:e},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=e.width,this.uniforms.mapDimensions.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},t.DisplacementFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DisplacementFilter.prototype.constructor=t.DisplacementFilter,t.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(t.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(t.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),t.PixelateFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new t.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},t.PixelateFilter.prototype=Object.create(t.AbstractFilter.prototype),t.PixelateFilter.prototype.constructor=t.PixelateFilter,Object.defineProperty(t.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.dirty=!0,this.uniforms.pixelSize.value=t}}),t.BlurXFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurXFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurXFilter.prototype.constructor=t.BlurXFilter,Object.defineProperty(t.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),t.BlurYFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurYFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurYFilter.prototype.constructor=t.BlurYFilter,Object.defineProperty(t.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),t.BlurFilter=function(){this.blurXFilter=new t.BlurXFilter,this.blurYFilter=new t.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},t.BlurFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurFilter.prototype.constructor=t.BlurFilter,Object.defineProperty(t.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}}),Object.defineProperty(t.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}}),Object.defineProperty(t.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}),t.InvertFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},t.InvertFilter.prototype=Object.create(t.AbstractFilter.prototype),t.InvertFilter.prototype.constructor=t.InvertFilter,Object.defineProperty(t.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}),t.SepiaFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},t.SepiaFilter.prototype=Object.create(t.AbstractFilter.prototype),t.SepiaFilter.prototype.constructor=t.SepiaFilter,Object.defineProperty(t.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}),t.TwistFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},t.TwistFilter.prototype=Object.create(t.AbstractFilter.prototype),t.TwistFilter.prototype.constructor=t.TwistFilter,Object.defineProperty(t.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.dirty=!0,this.uniforms.offset.value=t}}),Object.defineProperty(t.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(t){this.dirty=!0,this.uniforms.radius.value=t}}),Object.defineProperty(t.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),t.ColorStepFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},t.ColorStepFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorStepFilter.prototype.constructor=t.ColorStepFilter,Object.defineProperty(t.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}}),t.DotScreenFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},t.DotScreenFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DotScreenFilter.prototype.constructor=t.DotScreenFilter,Object.defineProperty(t.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.dirty=!0,this.uniforms.scale.value=t}}),Object.defineProperty(t.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),t.CrossHatchFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},t.CrossHatchFilter.prototype=Object.create(t.AbstractFilter.prototype),t.CrossHatchFilter.prototype.constructor=t.CrossHatchFilter,Object.defineProperty(t.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),t.RGBSplitFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},t.RGBSplitFilter.prototype=Object.create(t.AbstractFilter.prototype),t.RGBSplitFilter.prototype.constructor=t.RGBSplitFilter,Object.defineProperty(t.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}}),Object.defineProperty(t.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}}),Object.defineProperty(t.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.PIXI=t):"undefined"!=typeof define&&define.amd?define(t):this.PIXI=t}.call(this),function(){function t(t){if(t=t||{},this.method=t.method||2,this.colors=t.colors||256,this.initColors=t.initColors||4096,this.initDist=t.initDist||.01,this.distIncr=t.distIncr||.005,this.hueGroups=t.hueGroups||10,this.satGroups=t.satGroups||10,this.lumGroups=t.lumGroups||10,this.minHueCols=t.minHueCols||0,this.hueStats=this.minHueCols?new e(this.hueGroups,this.minHueCols):null,this.boxSize=t.boxSize||[64,64],this.boxPxls=t.boxPxls||2,this.palLocked=!1,this.dithKern=t.dithKern||null,this.dithSerp=t.dithSerp||!1,this.dithDelta=t.dithDelta||0,this.histogram={},this.idxrgb=t.palette?t.palette.slice(0):[],this.idxi32=[],this.i32idx={},this.i32rgb={},this.idxrgbRep=t.palette&&t.paletteRep&&t.palette.length==t.paletteRep.length?t.paletteRep.slice(0):[],this.idxi32Rep=[],this.i32idxRep={},this.i32rgbRep={},this.useCache=!1!==t.useCache,this.cacheFreq=t.cacheFreq||10,this.reIndex=t.reIndex||0==this.idxrgb.length,this.colorDist="manhattan"==t.colorDist?h:o,this.idxrgb.length>0){var n=this;this.idxrgb.forEach(function(t,e){var i=(255<<24|t[2]<<16|t[1]<<8|t[0])>>>0;n.idxi32[e]=i,n.i32idx[i]=e,n.i32rgb[i]=t}),this.idxrgbRep.forEach(function(t,e){var i=null!=t?(255<<24|t[2]<<16|t[1]<<8|t[0])>>>0:0;n.idxi32Rep[e]=i,n.i32idxRep[i]=e,n.i32rgbRep[i]=t})}}function e(t,e){this.numGroups=t,this.minCols=e,this.stats={};for(var n=-1;n<t;n++)this.stats[n]={num:0,cols:[]};this.groupsFull=0}t.prototype.sample=function(t,e){if(this.palLocked)throw"Cannot sample additional images, palette already assembled.";var n=v(t,e);switch(this.method){case 1:this.colorStats1D(n.buf32);break;case 2:this.colorStats2D(n.buf32,n.width)}},t.prototype.reduce=function(t,e,n,i){if(this.palLocked||this.buildPal(),n=n||this.dithKern,i=void 0!==i?i:this.dithSerp,e=e||1,n)var r=this.dither(t,n,i);else for(var s=(w=(x=v(t)).buf32).length,a=(r=new Uint32Array(s),0);a<s;a++){var o=w[a],l=this.nearestColor(o),h=(4278190080&o)>>24,c=255&l,u=(65280&l)>>8,d=(16711680&l)>>16;a2=(4278190080&l)>>24;var p=null!=this.i32rgbRep&&0==a2?a2:h;r[a]=p<<24|d<<16|u<<8|c}if(1==e)return new Uint8Array(r.buffer);if(2==e){var g=[];for(s=r.length,a=0;a<s;a++)o=r[a],g[a]=this.i32idx[o];return g}if(3==e){var m=document.createElement("canvas");m.width=x.width,m.height=x.height;var _=m.getContext("2d"),y=_.createImageData(m.width,m.height);if("CanvasPixelArray"==f(y.data)){var x,b=new Uint8Array(r.buffer);for(a=0,s=(x=y.data).length;a<s;++a)x[a]=b[a]}else{var w,S=new Uint32Array(r.buffer);(w=new Uint32Array(y.data.buffer)).set(S)}_.putImageData(y,0,0);var M=m.toDataURL("image/png");return this.dataURItoBlob(M)}},t.prototype.dataURItoBlob=function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return new Blob([i],{type:n})},t.prototype.dither=function(t,e,n){var i={FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]],Jarvis:[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]],Burkes:[[.25,1,0],[.125,2,0],[2/32,-2,1],[.125,-1,1],[.25,0,1],[.125,1,1],[2/32,2,1]],Sierra:[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[.125,-1,1],[5/32,0,1],[.125,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]],TwoSierra:[[.25,1,0],[3/16,2,0],[1/16,-2,1],[.125,-1,1],[3/16,0,1],[.125,1,1],[1/16,2,1]],SierraLite:[[.5,1,0],[.25,-1,1],[.25,0,1]]};if(!e||!i[e])throw"Unknown dithering kernel: "+e;for(var r=i[e],s=v(t),a=s.buf32,o=s.width,l=s.height,h=(a.length,n?-1:1),c=0;c<l;c++){n&&(h*=-1);for(var u=c*o,d=1==h?0:o-1,p=1==h?o:0;d!==p;d+=h){var f=u+d,g=a[f],m=255&g,_=(65280&g)>>8,y=(16711680&g)>>16,x=(4278190080&g)>>24,b=this.nearestColor(g),w=255&b,S=(65280&b)>>8,M=(16711680&b)>>16;if(a[f]=x<<24|M<<16|S<<8|w,!(this.dithDelta&&this.colorDist([m,_,y],[w,S,M])<this.dithDelta))for(var T=m-w,E=_-S,C=y-M,A=1==h?0:r.length-1,R=1==h?r.length:0;A!==R;A+=h){var L=r[A][1]*h,P=r[A][2],k=P*o;if(L+d>=0&&L+d<o&&P+c>=0&&P+c<l){var D=r[A][0],I=f+(k+L),O=255&a[I],B=(65280&a[I])>>8,F=(16711680&a[I])>>16,N=Math.max(0,Math.min(255,O+T*D)),U=Math.max(0,Math.min(255,B+E*D)),z=Math.max(0,Math.min(255,F+C*D));a[I]=255<<24|z<<16|U<<8|N}}}}return a},t.prototype.buildPal=function(t){if(!(this.palLocked||this.idxrgb.length>0&&this.idxrgb.length<=this.colors)){var e=this.histogram,n=function(t,e){var n=[];for(var i in t)n.push(i);return m.call(n,function(e,n){return t[n]-t[e]})}(e);if(0==n.length)throw"Nothing has been sampled, palette cannot be built.";switch(this.method){case 1:for(var i=this.initColors,r=e[n[i-1]],s=n.slice(0,i),a=i,o=n.length;a<o&&e[n[a]]==r;)s.push(n[a++]);this.hueStats&&this.hueStats.inject(s);break;case 2:s=n}s=s.map(function(t){return+t}),this.reducePal(s),!t&&this.reIndex&&this.sortPal(),this.useCache&&this.cacheHistogram(s),this.palLocked=!0}},t.prototype.palette=function(t,e){return this.buildPal(e),t?this.idxrgb:new Uint8Array(new Uint32Array(this.idxi32).buffer)},t.prototype.prunePal=function(t){for(var e,n=0;n<this.idxrgb.length;n++)t[n]||(e=this.idxi32[n],this.idxrgb[n]=null,this.idxi32[n]=null,delete this.i32idx[e]);if(this.reIndex){for(var i=[],r=[],s={},a=(n=0,0);n<this.idxrgb.length;n++)this.idxrgb[n]&&(e=this.idxi32[n],i[a]=this.idxrgb[n],s[e]=a,r[a]=e,a++);this.idxrgb=i,this.idxi32=r,this.i32idx=s}},t.prototype.reducePal=function(t){if(this.idxrgb.length>this.colors){for(var e,n=t.length,i={},r=0,s=!1,a=0;a<n;a++)r!=this.colors||s||(this.prunePal(i),s=!0),e=this.nearestIndex(t[a]),r<this.colors&&!i[e]&&(i[e]=!0,r++);s||(this.prunePal(i),s=!0)}else{var o=t.map(function(t){return[255&t,(65280&t)>>8,(16711680&t)>>16]}),l=n=o.length,h=this.initDist;if(l>this.colors){for(;l>this.colors;){var c=[];for(a=0;a<n;a++){var u=o[a];if(t[a],u)for(var d=a+1;d<n;d++){var p=o[d],f=t[d];if(p){var g=this.colorDist(u,p);g<h&&(c.push([d,p,f,g]),delete o[d],l--)}}}h+=l>3*this.colors?this.initDist:this.distIncr}if(l<this.colors){m.call(c,function(t,e){return e[3]-t[3]});for(var v=0;l<this.colors;)o[c[v][0]]=c[v][1],l++,v++}}for(n=o.length,a=0;a<n;a++)o[a]&&(this.idxrgb.push(o[a]),this.idxi32.push(t[a]),this.i32idx[t[a]]=this.idxi32.length-1,this.i32rgb[t[a]]=o[a])}},t.prototype.colorStats1D=function(t){for(var e,n=this.histogram,i=t.length,r=0;r<i;r++)(4278190080&(e=t[r]))>>24!=0&&(this.hueStats&&this.hueStats.check(e),e in n?n[e]++:n[e]=1)},t.prototype.colorStats2D=function(t,e){var n=this.boxSize[0],i=this.boxSize[1],r=n*i,s=function(t,e,n,i){for(var r=t%n,s=e%i,a=t-r,o=e-s,l=[],h=0;h<e;h+=i)for(var c=0;c<t;c+=n)l.push({x:c,y:h,w:c==a?r:n,h:h==o?s:i});return l}(e,t.length/e,n,i),a=this.histogram,o=this;s.forEach(function(n){var i,s=Math.max(Math.round(n.w*n.h/r)*o.boxPxls,2),l={};!function(t,e,n){var i=t,r=i.y*e+i.x,s=(i.y+i.h-1)*e+(i.x+i.w-1),a=0,o=e-i.w+1,l=r;do{n.call(this,l),l+=++a%i.w==0?o:1}while(l<=s)}(n,e,function(e){(4278190080&(i=t[e]))>>24!=0&&(o.hueStats&&o.hueStats.check(i),i in a?a[i]++:i in l?++l[i]>=s&&(a[i]=l[i]):l[i]=1)})}),this.hueStats&&this.hueStats.inject(a)},t.prototype.sortPal=function(){var t=this;this.idxi32.sort(function(e,n){var i=t.i32idx[e],r=t.i32idx[n],s=t.idxrgb[i],a=t.idxrgb[r],o=c(s[0],s[1],s[2]),l=c(a[0],a[1],a[2]),h=s[0]==s[1]&&s[1]==s[2]?-1:u(o.h,t.hueGroups),f=(a[0]==a[1]&&a[1]==a[2]?-1:u(l.h,t.hueGroups))-h;if(f)return-f;var g=p(+l.l.toFixed(2))-p(+o.l.toFixed(2));if(g)return-g;var m=d(+l.s.toFixed(2))-d(+o.s.toFixed(2));return m?-m:void 0}),this.idxi32.forEach(function(e,n){t.idxrgb[n]=t.i32rgb[e],t.i32idx[e]=n})},t.prototype.nearestColor=function(t){var e=this.nearestIndex(t);return this.idxrgbRep&&this.idxrgbRep.length>0?null==e?0:this.idxi32Rep[e]:null===e?0:this.idxi32[e]},t.prototype.nearestIndex=function(t){if((4278190080&t)>>24==0)return null;if(this.useCache&&""+t in this.i32idx)return this.i32idx[t];for(var e,n=1e3,i=[255&t,(65280&t)>>8,(16711680&t)>>16],r=this.idxrgb.length,s=0;s<r;s++)if(this.idxrgb[s]){var a=this.colorDist(i,this.idxrgb[s]);a<n&&(n=a,e=s)}return e},t.prototype.cacheHistogram=function(t){for(var e=0,n=t[e];e<t.length&&this.histogram[n]>=this.cacheFreq;n=t[e++])this.i32idx[n]=this.nearestIndex(n)},e.prototype.check=function(t){this.groupsFull==this.numGroups+1&&(this.check=function(){});var e=255&t,n=(65280&t)>>8,i=(16711680&t)>>16,r=e==n&&n==i?-1:u(c(e,n,i).h,this.numGroups),s=this.stats[r],a=this.minCols;s.num++,s.num>a||(s.num==a&&this.groupsFull++,s.num<=a&&this.stats[r].cols.push(t))},e.prototype.inject=function(t){for(var e=-1;e<this.numGroups;e++)if(this.stats[e].num<=this.minCols)switch(f(t)){case"Array":this.stats[e].cols.forEach(function(e){-1==t.indexOf(e)&&t.push(e)});break;case"Object":this.stats[e].cols.forEach(function(e){t[e]?t[e]++:t[e]=1})}};var n=.2126,i=.7152,r=.0722;function s(t,e,s){return Math.sqrt(n*t*t+i*e*e+r*s*s)}var a=Math.sqrt(255*n*255+255*i*255+255*r*255);function o(t,e){var s=e[0]-t[0],o=e[1]-t[1],l=e[2]-t[2];return Math.sqrt(n*s*s+i*o*o+r*l*l)/a}var l=255*n+255*i+255*r;function h(t,e){var s=Math.abs(e[0]-t[0]),a=Math.abs(e[1]-t[1]),o=Math.abs(e[2]-t[2]);return(n*s+i*a+r*o)/l}function c(t,e,n){var i,r,a,o,l;if(t/=255,e/=255,n/=255,(i=Math.max(t,e,n))==(r=Math.min(t,e,n)))a=o=0;else{switch(l=i-r,o=(i+r)/2>.5?l/(2-i-r):l/(i+r),i){case t:a=(e-n)/l+(e<n?6:0);break;case e:a=(n-t)/l+2;break;case n:a=(t-e)/l+4}a/=6}return{h:a,s:o,l:s(t,e,n)}}function u(t,e){var n=1/e,i=n/2;if(t>=1-i||t<=i)return 0;for(var r=1;r<e;r++){var s=r*n;if(t>=s-i&&t<=s+i)return r}}function d(t){return t}function p(t){return t}function f(t){return Object.prototype.toString.call(t).slice(8,-1)}var g,m="xyzvwtursopqmnklhijfgdeabc"==(g="abcdefghijklmnopqrstuvwxyz").split("").sort(function(t,e){return~~(g.indexOf(e)/2.3)-~~(g.indexOf(t)/2.3)}).join("")?Array.prototype.sort:function(t){var e=f(this[0]);if("Number"==e||"String"==e){for(var n,i={},r=this.length,s=0;s<r;s++)n=this[s],i[n]||0===i[n]||(i[n]=s);return this.sort(function(e,n){return t(e,n)||i[e]-i[n]})}i=this.map(function(t){return t});return this.sort(function(e,n){return t(e,n)||i.indexOf(e)-i.indexOf(n)})};function v(t,e){var n,i,r,s,a,o,l=typeof t;switch("object"===l&&(l=t.constructor.name),l){case"HTMLImageElement":(n=document.createElement("canvas")).width=t.naturalWidth,n.height=t.naturalHeight,(i=n.getContext("2d")).drawImage(t,0,0);case"Canvas":case"HTMLCanvasElement":n=n||t,i=i||n.getContext("2d");case"CanvasRenderingContext2D":i=i||t,n=n||i.canvas,r=i.getImageData(0,0,n.width,n.height);case"ImageData":e=(r=r||t).width,s="CanvasPixelArray"==f(r.data)?new Uint8Array(r.data):r.data;case"Array":case"CanvasPixelArray":s=s||new Uint8Array(t);case"Uint8Array":case"Uint8ClampedArray":s=s||t,a=new Uint32Array(s.buffer);case"Uint32Array":a=a||t,s=s||new Uint8Array(a.buffer),e=e||a.length,o=a.length/e}return{can:n,ctx:i,imgd:r,buf8:s,buf32:a,width:e,height:o}}this.RgbQuant=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}.call(this),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rgbAsterLib=e():t.rgbAsterLib=e()}(self,()=>(()=>{var t={"./node_modules/rgbaster/dist/rgbaster.umd.js":function(t){var e;t.exports=(e={ignore:[],scale:1},function(t,n){void 0===n&&(n=e);try{var i=(n=Object.assign({},e,n)).ignore,r=n.scale;return(r>1||r<=0)&&console.warn("You set scale to "+r+", which isn't between 0-1. This is either pointless (> 1) or a no-op ( 0)"),Promise.resolve(function(t,e){void 0===e&&(e=1);var n=new Image;return t.startsWith("data")||(n.crossOrigin="Anonymous"),new Promise(function(i,r){n.onload=function(){var t=n.width*e,r=n.height*e,s=function(t,e){var n=document.createElement("canvas");return n.setAttribute("width",t),n.setAttribute("height",e),n.getContext("2d")}(t,r);s.drawImage(n,0,0,t,r);var a=s.getImageData(0,0,t,r);i(a.data)};var s=function(){return r(new Error("An error occurred attempting to load image"))};n.onerror=s,n.onabort=s,n.src=t})}(t,r)).then(function(t){return function(t,e){for(var n={},i=0;i<t.length;i+=4){var r=t[i+3];if(0!==r){var s=Array.from(t.subarray(i,i+3));if(-1===s.indexOf(void 0)){var a=r&&255!==r?"rgba("+s.concat([r]).join(",")+")":"rgb("+s.join(",")+")";-1===e.indexOf(a)&&(n[a]?n[a].count++:n[a]={color:a,count:1})}}}return Object.values(n).sort(function(t,e){return e.count-t.count})}(t,i)})}catch(t){return Promise.reject(t)}})}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,n),s.exports}n.n=(t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e}),n.d=((t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}),n.o=((t,e)=>Object.prototype.hasOwnProperty.call(t,e)),n.r=(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})});var i={};return(()=>{"use strict";n.r(i),n.d(i,{rgbAster:()=>e});var t=n("./node_modules/rgbaster/dist/rgbaster.umd.js"),e=n.n(t)()})(),i})()),BABYLON.Tmp=BABYLON.TmpColors;var Zakeke,org,_0xc101=["setPrototypeOf","__proto__","hasOwnProperty","constructor","prototype","create","length","getOwnPropertyDescriptor","object","decorate","function","defineProperty","Tools","Init","SetupCustomShaders","IncludesShadersStore","Effect","ShadersStore","DefinePBRMaterial","call","p7H5BeNo","Gs62Hcg4","a9ERn52W","Ex48Hyb7","Zn2m8STd","Xy5f3FMb","Nz52Qcg9","Ta63Acf7","Hp4m2BWf","Qs3b9W2T","o6GAc9s7","o6PJw98D","a2SBj8y3","Pn4m8W9E","n7D3EjXm","Gf4i3Y8S","o3JZj2y8","Yj98FwZn","w9C3Yen4","t7PWe2w6","j2WBy59Z","r6YWy23J","d5Q8Nsw9","Pa6s3WGq","j5AHb8g6","Qt36CfDy","Ec42CdYz","INSTANCES","b8W4Fyq9","Da9i4ZXt","Bs27JiWq","NUM_BONE_INFLUENCERS","BonesPerMesh","rebuild","_albedoColor","_reflectionColor","_specularColor","_glossiness","_ambientLight","_reflectivity","_microsurface","_aoPower","_rimColor","_rimPower","_rimBias","_aoExposure","_cameraContrast","_cameraExposure","_enableEnvCap","_useAOTextureAsLightmap","_useAlphaFromAlbedoTexture","_disableLighting","_maxSimultaneousLights","_renderTargets","_grayWeights","_lumCoeff","_renderMatrix","enableMatCap","apply","_markAllSubMeshesAsTexturesDirty","_markAllSubMeshesAsLightsDirty","enableEnvCap","_shouldUseAlphaFromAlbedoTexture","_albedoTexture","hasAlpha","_buildLightUniformLayout","_pbrUniformBuffer","getEngine","Qn65Tbq4","addUniform","Yp32BjTy","f3JFn69D","_prepareDefinesForLights","_lightSources","d2EKz65X","getTypeID","Go89WqCn","Tx62Nto7","Gf78Toj6","Xf36Cge2","Qr8j3M7B","Wn9y8EQr","Po32Jtb9","Hj6m7P5D","LINEARDEPTH","receiveShadows","shadowsEnabled","shadowEnabled","getShadowGenerator","DirectionalLight","getCaps","textureFloatRender","textureFloatLinearFiltering","textureHalfFloatRender","textureHalfFloatLinearFiltering","_prepareUniformsAndSamplersList","Gw84QdRo","t6M8KsPq","g2ASa4p9","z2J8Dek4","f6T5RbLa","Ja84RmPc","x9R4Dcn7","d8A9QxLe","Kd6a5DEk","push","i5PBq6d4","d3T8Meb7","Ez2g9L3K","q6E4ZmWa","_bindLightShadow","getTransformMatrix","setMatrix","getShadowMap","setTexture","","info","_bindLightProperties","PointLight","computeTransformedInformation","x","transformedPosition","y","z","updateFloat3","position","transformedDirection","direction","PBRMaterial: Attempt to bind light properties for an unhandled light type. PBR only supports Pointlight and DirectionalLight.","_bindLights","bindToEffect","intensity","Color3","Tmp","scaleToRef","diffuse","updateColor3","specular","update","_doNothing","getClassName","Zakeke.PBRMaterial","getRenderTargetTextures","reset","_reflectionTexture","isRenderTarget","needAlphaBlending","alpha","_opacityTexture","_opacityFresnelParameters","isEnabled","needAlphaTesting","getAlphaTestTexture","isReadyForSubMesh","isFrozen","_wasPreviouslyReady","effect","_materialDefines","getScene","checkReadyOnEveryCall","_renderId","getRenderId","_areLightsDirty","lightsEnabled","_needNormals","_areTexturesDirty","_needUVs","texturesEnabled","textureLOD","isReadyOrNotBlocking","standardDerivatives","_bumpTexture","_reflectivityTexture","_microsurfaceTexture","_parallaxReflectionCenter","_parallaxReflectionBBoxMin","_parallaxReflectionBBoxMax","getAlphaFromRGB","_aoTexture","_ambientTexture","_matCapReflectionTexture","_backFaceCulling","_areFresnelDirty","_areMiscDirty","_areAttributesDirty","_normals","_uvs","VertexBuffer","isVerticesDataPresent","useBones","computeBonesUsingShaders","numBoneInfluencers","bones","skeleton","markAsUnprocessed","isDirty","markAsProcessed","resetCachedMaterial","EffectFallbacks","MaterialHelper","PositionKind","zk_pbr","_cachedDefines","name","world","view","viewProjection","vEyePositionW","Lk8x5T3G","Ji23KzMd","Xo8q4A2R","Wr5i8R3S","Lj7q8H2K","Gr2p3S4T","q4A5Diy8","f8E2Wxc3","i5LEp3e8","Ez4g6PHc","t3GQn4m8","r8TLa3t5","f2THw8s5","n5J8Afy2","Lr45JbEi","c9F4XmDi","x4S6Ljt2","Dy84Brw6","Xm86Bye7","He9c4X2M","Em94Zxs7","j2N4DfKp","z9E8Dre3","o9EDt87H","Ew46Kes3","b4M3HcSi","Gk97Wqd5","Bt52Znx8","z9LGq35P","Ji6x8KYz","b6B9Wjf2","Ge69Pir7","mBones","Wq6t4DBe","g8G2Wfc4","z9C8Bsn3","g3BZx5e9","q6KWt97C","Hw43Jya6","Ei5b7ADy","Nz2n3DZs","Nd7m3WXn","Dg68CpMb","Fw64Rni2","m7MHk3b4","Material","Scene","onCompiled","onError","createEffect","setEffect","buildUniformLayout","isReady","_uniformBuffer","unbind","_activeEffect","bindForSubMesh","bindOnlyWorldMatrix","visibility","bindViewProjection","useUbo","isSync","toLuminance","leftColor","rightColor","bias","power","updateColor4","coordinatesIndex","level","updateFloat2","getTextureMatrix","updateMatrix","updateFloat","width","getSize","log","LOG2E","round","updateVector3","activeCamera","setVector3","bindView","dispose","getActiveTextures","hasTexture","clone","SerializationHelper","id","createPBRBlendMaterial","serialize","customType","Parse","albedoColor","serializeAsColor3","expandToProperty","reflectionColor","specularColor","glossiness","ambientLight","indirectLightPower","rimColor","rimBias","albedoTexture","serializeAsTexture","bumpTexture","reflectivityTexture","reflectivity","microsurfaceTexture","microsurface","reflectionTexture","parallaxReflectionCenter","serializeAsVector3","parallaxReflectionBBoxMin","parallaxReflectionBBoxMax","opacityTexture","aoTexture","AOTexture","aoPower","AOPower","aoExposure","AOExposure","matCapAmbientTexture","ambientTexture","matCapReflectionTexture","useAOTextureAsLightmap","useAlphaFromAlbedoTexture","opacityFresnelParameters","serializeAsFresnelParameters","_markAllSubMeshesAsFresnelDirty","rimPower","_markAllSubMeshesAsMiscDirty","cameraContrast","cameraExposure","disableLighting","maxSimultaneousLights","PBRMaterial","PBRMaterialDefines","DefineCustomMaterials","#ifdef Hp4m2BWf\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef Nz52Qcg9\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__zk_pbrFragment>\n\nconst float PI=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale = 0.1;\nconst float kRougnhessToAlphaOffset = 0.29248125;\nconst float kMinimumVariance = 0.0005;\nconst float fact_1=1.0;\nconst float fact_2=0.0;\n\n#ifdef p7H5BeNo\n#include<__decl__zk_pbrLightFragment>[0..maxSimultaneousLights]\n#endif\n\n#ifdef Ta63Acf7\nuniform sampler2D g3BZx5e9;\n#endif\n#ifdef Hp4m2BWf\nuniform sampler2D q6KWt97C;\n#endif\n#ifdef Qs3b9W2T\nuniform sampler2D Hw43Jya6;\n#endif\n#ifdef o6GAc9s7\nuniform sampler2D Ei5b7ADy;\n#endif\n#ifdef o6PJw98D\nuniform samplerCube Nd7m3WXn;\n#endif\n#ifdef Pn4m8W9E\nuniform sampler2D Fw64Rni2;\n#endif\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\nuniform sampler2D m7MHk3b4;\n#endif\n#ifdef t7PWe2w6\nuniform sampler2D Dg68CpMb;\n#endif\n#ifdef j2WBy59Z\nuniform sampler2D Nz2n3DZs;\n#endif\n\nconst float lf_1 = 1.0;\nconst float lf_2 = 0.0;\n\nuniform vec3 vEyePositionW;\nvarying vec3 vPositionW;\n\n#ifdef b8W4Fyq9\nvarying vec3 vNormalW;\n#endif\n#ifdef Ta63Acf7\nvarying vec2 j9F5Mmw7;\n#endif\n#ifdef Hp4m2BWf\nvarying vec2 Hg32Nkz6;\n#else\n#ifdef w9C3Yen4\nvarying vec2 a3X4SpHq;\n#endif\n#endif\n#ifdef Qs3b9W2T\nvarying vec2 Ho7e5M6N;\n#endif\n#ifdef o6GAc9s7\nvarying vec2 Bp4q3S8E;\n#endif\n#ifdef Pn4m8W9E\nvarying vec2 Zj26Aby4;\n#endif\n#ifdef Gf4i3Y8S\nvarying vec2 Za9r4XMn;\n#endif\n#ifdef Yj98FwZn\nvarying vec3 n9RMw7b2;\n#endif\n\n#include<zk_w8NZg34MyJx59GeB>\n#include<zk_g9X4Qdz2LJb67MyT>\n#include<zk_Ar2w4FRs58Jpc3W6>\n#include<zk_n8Q2Bzi9LXc5p6RG>\n\nvoid main(void)\n{\nvec3 finalColor=vec3(1.0,1.0,1.0);\nvec3 V=normalize(vEyePositionW-vPositionW);\nfloat alpha=Lk8x5T3G.a;\nvec3 albedoBlend=Lk8x5T3G.rgb;\n#ifdef Ta63Acf7\nvec4 albedoTextureColor=texture2D(g3BZx5e9,j9F5Mmw7);\n#ifdef Ec42CdYz\nif (albedoTextureColor.a<z9C8Bsn3[3][1]){discard;}\n#endif\n\n#ifdef r6YWy23J\nalpha*=albedoTextureColor.a;\n#endif\nalbedoBlend*=albedoTextureColor.rgb*Ji23KzMd.y;\n#endif\n\n#ifdef Pn4m8W9E\n#ifdef n7D3EjXm\nvec3 opColor = texture2D(Fw64Rni2,Zj26Aby4).rgb;\nfloat luminance=dot(Wq6t4DBe,opColor);\nalpha*=luminance*x4S6Ljt2.y;\n#else\nfloat opacity=texture2D(Fw64Rni2,Zj26Aby4).a;\nalpha*=opacity*x4S6Ljt2.y;\n#endif\n#endif\n\n#ifdef b8W4Fyq9\nvec3 N=normalize(vNormalW);\nfloat NdotV=dot(N,V);\n#ifdef Hp4m2BWf\nvec2 vv_1 = vec2(fact_1, fact_1);\nvec2 vv_2 = vec2(fact_2, fact_2);\nN=perturbNormal(V,vNormalW, vv_1, vv_2);\n#endif\n#else\n\nvec3 N=normalize(vec3(1.0));\n#endif\n\n#ifdef d5Q8Nsw9\nN=gl_FrontFacing ? N : -N;\n#endif\n\n#ifdef Pa6s3WGq\nfloat opacityFresnelTerm=clamp(pow(Ji6x8KYz.z+abs(NdotV),Ji6x8KYz.w),0.0,1.0);\nalpha+=Ji6x8KYz.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*Ji6x8KYz.y;\n#endif\n\nfloat reflectivityBlend=Gr2p3S4T;\n#ifdef Qs3b9W2T\nfloat reflectivityValue=texture2D(Hw43Jya6,Ho7e5M6N).r*q4A5Diy8.y;\nreflectivityBlend*=reflectivityValue;\n#endif\n\nvec3 specularBlend=b6B9Wjf2;\n#ifdef Qs3b9W2T\nspecularBlend*=reflectivityValue;\n#endif\n\nfloat microsurfaceBlend=i5LEp3e8;\n#ifdef o6GAc9s7\nmicrosurfaceBlend*=texture2D(Ei5b7ADy,Bp4q3S8E).r*Ez4g6PHc.y;\n#endif\n\n#if defined(j2WBy59Z) || defined(o6PJw98D)\n// Go mat -> ...\n#ifdef Nz52Qcg9\n// Adapt ...\nmicrosurfaceBlend=clamp(microsurfaceBlend,0.,1.)*0.98;\n// Compute ...\nfloat roughness=clamp(1.-microsurfaceBlend, 0.000001, 1.0);\nfloat alphaG=microsurfaceBlend*microsurfaceBlend+kMinimumVariance;\n//Beckamm roughness to Blinn exponent\nfloat maxMipLevel=Ge69Pir7;\nfloat lodReflection=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alphaG));\nlodReflection = clamp(lodReflection, 0., maxMipLevel);\n#else\nfloat biasReflection=(Ge69Pir7+2.0)*microsurfaceBlend;\n#endif\n#endif\n\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\nfloat AOShadowTexel=1.0;\n#ifdef Gf4i3Y8S\nvec3 AOValue=texture2D(m7MHk3b4,Za9r4XMn).rgb*He9c4X2M.y;\n#ifdef o3JZj2y8\nfloat aoGrayLevel=dot(g8G2Wfc4,AOValue);\nif (aoGrayLevel<Xm86Bye7){AOValue/=Xm86Bye7;}else{AOValue-=Xm86Bye7;AOValue/=1.0-Xm86Bye7;}\n#endif\nvec3 AOLightTexel=mix(vec3(1.0),AOValue,He9c4X2M.z);\n#endif\n#ifdef Yj98FwZn\nvec2 screenCoordinates=vec2(0.0);\nscreenCoordinates=n9RMw7b2.xy/n9RMw7b2.z/2.0+vec2(0.5);\nAOShadowTexel=mix(1.0,texture2D(m7MHk3b4,screenCoordinates).r,j2N4DfKp);\nfloat AOLightTexel=mix(1.0,texture2D(m7MHk3b4,screenCoordinates).g,j2N4DfKp);\n#endif\n#endif\n#ifdef w9C3Yen4\n#ifdef Hp4m2BWf\nvec2 a3X4SpHq=vec2(view*vec4(N,0.0))*0.5+vec2(0.5,0.5);\n#endif\nfinalColor=albedoBlend;\n#ifdef j2WBy59Z\n// For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n// For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\nfloat reflectance0=reflectivityBlend; // normal\nfloat reflectance90=clamp(reflectivityBlend*25.0,0.0,1.0); // grazing\nfloat schlick=reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-NdotV,0.,1.), 5.0);\n#ifdef Nz52Qcg9\nvec3 reflection=texture2DLodEXT(Nz2n3DZs,a3X4SpHq,lodReflection).rgb*r8TLa3t5*o9EDt87H;\n#else\nvec3 reflection=texture2D(Nz2n3DZs,a3X4SpHq,biasReflection).rgb*r8TLa3t5*o9EDt87H;\n#endif\nfinalColor*=1.0-schlick;\nfinalColor+=reflection*schlick;\n#endif\n#ifdef t7PWe2w6\nvec3 ambient=texture2D(Dg68CpMb,a3X4SpHq).rgb*z9E8Dre3;\nfloat albedoLevel=g8G2Wfc4.r*Lk8x5T3G.r+g8G2Wfc4.g*Lk8x5T3G.g+g8G2Wfc4.b*Lk8x5T3G.b;\nfloat lightExposure=mix(0.85,0.99,pow(albedoLevel,2.0));\nfloat ambientGreyLevel=g8G2Wfc4.r*ambient.r+g8G2Wfc4.g*ambient.g+g8G2Wfc4.b*ambient.b;\nif (ambientGreyLevel<lightExposure){finalColor*=ambient/lightExposure;}\nelse{\nambient-=lightExposure;ambient/=1.0-lightExposure;ambientGreyLevel-=lightExposure;ambientGreyLevel/=1.0-lightExposure;\nvec3 desatAmbient=mix(vec3(ambientGreyLevel),ambient,1.1-lightExposure);\nfinalColor+=desatAmbient*clamp(3.0*(1.0-lightExposure),0.0,1.0);\n}\n#endif\n#ifdef Gf4i3Y8S\nfinalColor*=AOLightTexel;\n#endif\n#ifdef Yj98FwZn\nfinalColor*=AOShadowTexel;\n#endif\n#else\n\n#ifdef o6PJw98D\nvec3 vReflectionUVW=2.0*NdotV*N-V; \n#ifdef a2SBj8y3\nvec3 firstPlaneIntersect=(c9F4XmDi-vPositionW)/vReflectionUVW;\nvec3 secondPlaneIntersect=(Lr45JbEi-vPositionW)/vReflectionUVW;\nvec3 furthestPlane=max(firstPlaneIntersect,secondPlaneIntersect);\nfloat distance=min(min(furthestPlane.x,furthestPlane.y),furthestPlane.z);\nvec3 intersectPositionW=vPositionW+vReflectionUVW*distance;\nvReflectionUVW=intersectPositionW-n5J8Afy2;\nvReflectionUVW.y=-vReflectionUVW.y;\n#endif\n#ifdef Nz52Qcg9\nvec3 environmentRadiance=textureCubeLodEXT(Nd7m3WXn,vReflectionUVW,lodReflection).rgb*r8TLa3t5*f2THw8s5;\n#else\nvec3 environmentRadiance=textureCube(Nd7m3WXn,vReflectionUVW,biasReflection).rgb*r8TLa3t5*f2THw8s5;\n#endif\n#endif\n\nvec3 directSpecularFactor=vec3(0.0);\nvec3 directDiffuseFactor=vec3(0.0);\n#ifdef p7H5BeNo\n#ifdef Gs62Hcg4\nfloat shadowTotal=1.0;\n#endif\n#include<zk_Dp84Pxj2MTr7q6FW>[0..maxSimultaneousLights]\n#endif\nvec3 finalDiffuse=albedoBlend;\nvec3 energy=vec3(0.0);\n#ifdef o6PJw98D\nfloat reflectionPower=clamp(reflectivityBlend*2.0-NdotV,0.0,1.0);\nenergy=vec3(reflectionPower);\n#endif\nenergy+=(directSpecularFactor*specularBlend).r;\nenergy=clamp(energy,0.0,1.0);\nfinalDiffuse*=vec3(1.0)-energy;\nfinalColor=finalDiffuse;\nvec3 finalSpecular=directSpecularFactor*specularBlend;\n#ifdef o6PJw98D\nfinalSpecular+=environmentRadiance*reflectionPower;\n#endif\nfinalColor+=finalSpecular;\nvec3 finalLighting=directDiffuseFactor;\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\n#ifdef Gs62Hcg4\nfinalLighting+=z9LGq35P*mix(1.0,AOShadowTexel,1.0-shadowTotal);\n#else\nfinalLighting+=z9LGq35P;\n#endif\nfinalLighting*=AOLightTexel;\n#else\nfinalLighting+=z9LGq35P;\n#endif\n#ifdef Qt36CfDy\nfinalLighting=pow(finalLighting,vec3(Gk97Wqd5.x));\nfinalLighting+=Gk97Wqd5.y-1.0;\nfinalLighting=clamp(finalLighting,0.0,2.0);\n#endif\n#ifdef o3JZj2y8\nif (aoGrayLevel<Xm86Bye7){finalColor*=finalLighting;}\nelse {finalColor+=finalLighting*clamp(3.0*(1.0-Xm86Bye7),0.0,1.0);}\n#else\nfinalColor*=finalLighting;\n#endif\n#endif\n\n#ifdef j5AHb8g6\nfloat rimPower=b4M3HcSi.x;\nfloat rimBias=b4M3HcSi.y;\nfloat rimFactor=clamp(rimBias*2.0-NdotV,0.0,1.0);\n#ifdef Qs3b9W2T\nrimFactor*=reflectivityValue;\n#endif\nfinalColor+=Ew46Kes3*rimFactor*rimPower;\n#endif\n\ngl_FragColor=vec4(vec3(finalColor),alpha);\n}","precision highp float;\n#include<__decl__zk_pbrVertex>\n\nattribute vec3 position;\n#ifdef b8W4Fyq9\nattribute vec3 normal;\n#endif\n#ifdef Da9i4ZXt\nattribute vec2 uv;\n#endif\n#ifdef Bs27JiWq\nattribute vec2 uv2;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n\n#ifdef p7H5BeNo\n#include<__decl__zk_pbrLightFragment>[0..maxSimultaneousLights]\n#endif\n\nvarying vec3 vPositionW;\n#ifdef b8W4Fyq9\nvarying vec3 vNormalW;\n#endif\n#ifdef Ta63Acf7\nvarying vec2 j9F5Mmw7;\n#endif\n#ifdef Hp4m2BWf\nvarying vec2 Hg32Nkz6;\n#else\n#ifdef w9C3Yen4\nvarying vec2 a3X4SpHq;\n#endif\n#endif\n#ifdef Qs3b9W2T\nvarying vec2 Ho7e5M6N;\n#endif\n#ifdef o6GAc9s7\nvarying vec2 Bp4q3S8E;\n#endif\n#ifdef Pn4m8W9E\nvarying vec2 Zj26Aby4;\n#endif\n#ifdef Gf4i3Y8S\nvarying vec2 Za9r4XMn;\n#endif\n#ifdef Yj98FwZn\nvarying vec3 n9RMw7b2;\n#endif\n\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef b8W4Fyq9\nvec3 normalUpdated=normal;\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPosition=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=worldPosition.xyz;\nvec4 finalPosition=viewProjection*worldPosition;\n#ifdef Yj98FwZn\nn9RMw7b2=finalPosition.xyw;\n#endif\ngl_Position=finalPosition;\n#ifdef b8W4Fyq9\nvec4 worldNormal=finalWorld*vec4(normalUpdated,0.0);\nvNormalW=normalize(worldNormal.xyz);\n#endif\n\n#ifndef Da9i4ZXt\nvec2 uv=vec2(0.0,0.0);\n#endif\n#ifndef Bs27JiWq\nvec2 uv2=vec2(0.0,0.0);\n#endif\n#ifdef Ta63Acf7\nif (Ji23KzMd.x == 0.0)\n{\nj9F5Mmw7=vec2(Xo8q4A2R*vec4(uv,1.0,0.0));\n}\nelse\n{\nj9F5Mmw7=vec2(Xo8q4A2R*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Hp4m2BWf\nif (Wr5i8R3S.x == 0.0)\n{\nHg32Nkz6=vec2(Lj7q8H2K*vec4(uv,1.0,0.0));\n}\nelse\n{\nHg32Nkz6=vec2(Lj7q8H2K*vec4(uv2,1.0,0.0));\n}\n#else\n#ifdef w9C3Yen4\na3X4SpHq=vec2(view*vec4(vNormalW,0.0))*0.5+vec2(0.5,0.5);\n#endif\n#endif\n#ifdef Qs3b9W2T\nif (q4A5Diy8.x == 0.0)\n{\nHo7e5M6N=vec2(f8E2Wxc3*vec4(uv,1.0,0.0));\n}\nelse\n{\nHo7e5M6N=vec2(f8E2Wxc3*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef o6GAc9s7\nif (Ez4g6PHc.x == 0.0)\n{\nBp4q3S8E=vec2(t3GQn4m8*vec4(uv,1.0,0.0));\n}\nelse\n{\nBp4q3S8E=vec2(t3GQn4m8*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Pn4m8W9E\nif (x4S6Ljt2.x == 0.0)\n{\nZj26Aby4=vec2(Dy84Brw6*vec4(uv,1.0,0.0));\n}\nelse\n{\nZj26Aby4=vec2(Dy84Brw6*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Gf4i3Y8S\nif (He9c4X2M.x == 0.0)\n{\nZa9r4XMn=vec2(Em94Zxs7*vec4(uv,1.0,0.0));\n}\nelse\n{\nZa9r4XMn=vec2(Em94Zxs7*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#ifdef Gs62Hcg4\n#include<zk_Gi39AdTg7y5B2JfL>[0..maxSimultaneousLights]\n#endif\n}","#ifdef Hp4m2BWf\nmat3 cotangent_frame(vec3 norm,vec3 poss,vec2 uvmapping, float coeff_1, float coeff_2)\n{\nvec3 dp1=coeff_1*dFdx(poss);\nvec3 dp2=coeff_1*dFdy(poss);\nvec2 duv1=dFdx(uvmapping)+vec2(coeff_2, coeff_2);\nvec2 duv2=dFdy(uvmapping)+vec2(coeff_2, coeff_2);\nvec3 dp2perp=cross(dp2,norm);\nvec3 dp1perp=cross(norm,dp1);\nvec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\nfloat invmax=inversesqrt(max(dot(T,T),dot(B,B)));\nreturn mat3(T * invmax, B * invmax, norm);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 vNormalW, vec2 vv1, vec2 vv2)\n{\nvec3 map=texture2D(q6KWt97C,Hg32Nkz6).xyz*Wr5i8R3S.y;\nmap = (map*(255.0/127.0))-(128.0/127.0);\nmat3 TBN=cotangent_frame(vNormalW,viewDir,Hg32Nkz6, vv1.x, vv2.y);\nreturn normalize(TBN*map);\n}\n#endif","#if defined(w9C3Yen4) && defined(Hp4m2BWf)\nuniform mat4 view;\n#endif\nuniform vec4 Lk8x5T3G;\nuniform vec3 r8TLa3t5;\nuniform vec3 b6B9Wjf2;\nuniform float Gr2p3S4T;\nuniform float i5LEp3e8;\nuniform float Bt52Znx8;\nuniform float z9LGq35P;\n\n#ifdef Ta63Acf7\nuniform vec2 Ji23KzMd;\n#endif\n#ifdef Hp4m2BWf\nuniform vec2 Wr5i8R3S;\n#endif\n#ifdef o6GAc9s7\nuniform vec2 Ez4g6PHc;\n#endif\n#ifdef o6PJw98D\nuniform float f2THw8s5;\nuniform float Ge69Pir7;\n#ifdef a2SBj8y3\nuniform vec3 n5J8Afy2;\nuniform vec3 Lr45JbEi;\nuniform vec3 c9F4XmDi;\n#endif\n#endif\n#ifdef Qs3b9W2T\nuniform vec2 q4A5Diy8;\n#endif\n#ifdef Gf4i3Y8S\nuniform vec3 He9c4X2M;\n#ifdef o3JZj2y8\nuniform float Xm86Bye7;\n#endif\n#endif\n#ifdef Yj98FwZn\nuniform float j2N4DfKp;\n#endif\n#ifdef t7PWe2w6\nuniform float z9E8Dre3;\n#endif\n#ifdef j2WBy59Z\nuniform float o9EDt87H;\nuniform float Ge69Pir7;\n#endif\n#ifdef Pn4m8W9E\nuniform vec2 x4S6Ljt2;\n#endif\n\n#ifdef Pa6s3WGq\nuniform vec4 Ji6x8KYz;\n#endif\n\nuniform vec3 Wq6t4DBe;\nuniform vec3 g8G2Wfc4;\nuniform mat4 z9C8Bsn3;\n\n#ifdef j5AHb8g6\nuniform vec3 Ew46Kes3;\nuniform vec2 b4M3HcSi;\n#endif\n#ifdef Qt36CfDy\nuniform vec2 Gk97Wqd5;\n#endif\n","#ifdef d2EKz65X{X}\nuniform vec3 Qn65Tbq4{X};\nuniform vec3 Yp32BjTy{X};\nuniform vec3 f3JFn69D{X};\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\nuniform float z2J8Dek4{X};\n#ifdef Wn9y8EQr{X}\nuniform mat4 t6M8KsPq{X};\nuniform samplerCube q6E4ZmWa{X};\nuniform vec2 g2ASa4p9{X};\nvarying vec3 q2ENg8n9{X};\n#else\nuniform mat4 Gw84QdRo{X};\nuniform sampler2D q6E4ZmWa{X};\nvarying vec4 a3WFm87R{X};\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n\n#else\nuniform sampler2D d3T8Meb7{X};\nuniform sampler2D q6E4ZmWa{X};\n#ifndef Po32Jtb9{X}\nuniform sampler2D Ez2g9L3K{X};\n#endif\n#endif\nuniform mat4 Gw84QdRo{X};\nuniform mat4 t6M8KsPq{X};\nuniform vec2 g2ASa4p9{X};\nuniform vec2 x9R4Dcn7{X};\nuniform vec2 d8A9QxLe{X};\nuniform float Ja84RmPc{X};\nuniform float f6T5RbLa{X};\nuniform float z2J8Dek4{X};\nvarying vec4 a3WFm87R{X};\nvarying vec3 q2ENg8n9{X};\n#else\n#ifdef Tx62Nto7{X}\nuniform sampler2D d3T8Meb7{X};\nuniform mat4 Kd6a5DEk{X};\nvarying vec4 a3WFm87R{X};\nvarying float q8NLm2b4{X};\n#endif\n#endif\n#endif\n#endif\n#endif\n","#ifdef p7H5BeNo\nstruct lightingInfo {\nvec3 diffuse;\nvec3 specular;\n};\nlightingInfo getPointLighting(vec3 worldPosition,vec3 lightPosition,vec3 N,vec3 V,vec3 lightDiffuse,vec3 lightSpecular,float Bt52Znx8, float plight1, float plight2)\n{\nlightingInfo result;\nvec3 lightDir=lightPosition-worldPosition;\nvec3 L=normalize(lightDir);\nfloat distance=length(lightDir);\nfloat lightAttenuation=sqrt(1.0/distance + (plight1*plight2));\nvec3 diffuse=vec3(0.0);\nfloat NdotL = dot(N,L);\nfloat lightPower=clamp(NdotL, 0.0, 1.0);\ndiffuse=lightPower*lightPower*lightAttenuation*lightDiffuse;\nresult.diffuse=diffuse;\nvec3 specular=vec3(0.0);\nvec3 H=normalize(V+L);\nfloat NdotH=max(dot(N,H),0.0);\nspecular=(pow(NdotH,max(1.0 ,Bt52Znx8))*2.0)*lightAttenuation*lightSpecular;\nresult.specular=specular;\nreturn result;\n}\nlightingInfo getDirectionalLighting(vec3 lightDir,vec3 N,vec3 V,vec3 lightDiffuse,vec3 lightSpecular,float Bt52Znx8, float dlight1, float dlight2)\n{\nlightingInfo result;\nvec3 L=normalize(lightDir);\nvec3 diffuse=vec3(0.0);\nfloat NdotL = dot(N,L);\nfloat lightPower=clamp(NdotL, 0.0, 1.0);\ndiffuse=(lightPower*lightDiffuse)+(dlight1*dlight2);\nresult.diffuse=diffuse;\nvec3 specular=vec3(0.0);\nvec3 H=normalize(V+L);\nfloat NdotH=max(dot(N,H),0.0);\nspecular=(pow(NdotH,max(1.0 ,Bt52Znx8))*2.0)*lightSpecular;\nresult.specular=specular;\nreturn result;\n}\n#endif\n","#ifdef d2EKz65X{X}\nfloat coef_dynb_3{X}=1.0;\n#ifdef Tx62Nto7{X}\nvec3 L{X}=normalize(-light{X}.Qn65Tbq4);\n#else\nvec3 L{X}=normalize(light{X}.Qn65Tbq4-vPositionW);\n#endif\nvec3 H{X}=normalize(V+L{X});\n#ifdef Go89WqCn{X}\nlightingInfo Qb46TxBo{X}=getPointLighting(vPositionW,light{X}.Qn65Tbq4,N,V,light{X}.Yp32BjTy,light{X}.f3JFn69D,Bt52Znx8,lf_1,lf_2);\n#else\n#ifdef Tx62Nto7{X}\nlightingInfo Qb46TxBo{X}=getDirectionalLighting(L{X},N,V,light{X}.Yp32BjTy,light{X}.f3JFn69D,Bt52Znx8,lf_1,lf_2);\n#else\nlightingInfo Qb46TxBo{X};\nQb46TxBo{X}.diffuse=vec3(0.0);\nQb46TxBo{X}.specular=vec3(0.0);\n#endif\n#endif\n#ifdef Gf78Toj6{X}\nfloat shadow{X}=1.0;\nfloat coef_dynb_2{X}=0.0;\nfloat dynamicBias{X}=computeDynamicBias(z2J8Dek4{X},shadow{X},coef_dynb_2{X},coef_dynb_3{X},N,L{X});\n#ifdef Hj6m7P5D{X}\nfloat outsideLuminance{X}=0.0;\n#else\nfloat outsideLuminance{X}=1.0;\n#endif\nfloat depth{X};\n#ifdef LINEARDEPTH{X}\n\ndepth{X}=length(vPositionW-light{X}.Qn65Tbq4);\ndepth{X}=(depth{X}-g2ASa4p9{X}.x)/(g2ASa4p9{X}.y-g2ASa4p9{X}.x);\n#else\ndepth{X}=0.5*(a3WFm87R{X}.z/a3WFm87R{X}.w)+0.5;\n#endif\n#ifdef Xf36Cge2{X}\n#ifdef Wn9y8EQr{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadowFromPrecomputedPCSS_FFCube(light{X}.Qn65Tbq4,q6E4ZmWa{X},-L{X},g2ASa4p9{X},dynamicBias{X});\n\n#else\nshadow{X}=0.0;\n\n#endif\n#else\nvec2 uv{X}=a3WFm87R{X}.xy/a3WFm87R{X}.w;\nuv{X}=0.5*uv{X}+vec2(0.5);\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadowFromPrecomputedPCSS(depth{X},uv{X},\nq6E4ZmWa{X},\ndynamicBias{X},\noutsideLuminance{X},\ntrue);\n#else\nshadow{X}=getShadowFromPrecomputedPCSS(depth{X},uv{X},\nq6E4ZmWa{X},\ndynamicBias{X},\noutsideLuminance{X},\nfalse);\n#endif\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=0.0;\n\n#else\nshadow{X}=0.0;\n\n#endif\n#else\nvec2 uv{X}=a3WFm87R{X}.xy/a3WFm87R{X}.w;\nuv{X}=0.5*uv{X}+vec2(0.5);\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadow(f6T5RbLa{X},\ndepth{X},uv{X},q2ENg8n9{X},\nx9R4Dcn7{X},d8A9QxLe{X},g2ASa4p9{X},Ja84RmPc{X},\nd3T8Meb7{X},d3T8Meb7{X},q6E4ZmWa{X},\ndynamicBias{X},outsideLuminance{X},\ntrue);\n#else\nshadow{X}=getShadow(f6T5RbLa{X},\ndepth{X},uv{X},q2ENg8n9{X},\nx9R4Dcn7{X},d8A9QxLe{X},g2ASa4p9{X},Ja84RmPc{X},\nd3T8Meb7{X},Ez2g9L3K{X},q6E4ZmWa{X},\ndynamicBias{X},outsideLuminance{X},\nfalse);\n#endif\n#endif\n#else\n#ifdef Tx62Nto7{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=computeShadow(a3WFm87R{X},\nq8NLm2b4{X},\nd3T8Meb7{X},dynamicBias{X},true);\n#else\nshadow{X}=computeShadow(a3WFm87R{X},\nq8NLm2b4{X},\nd3T8Meb7{X},dynamicBias{X},false);\n#endif\n#endif\n#endif\n#endif\nQb46TxBo{X}.diffuse*=shadow{X};\nQb46TxBo{X}.specular*=shadow{X};\nshadowTotal*=shadow{X};\n#endif\ndirectDiffuseFactor+=Qb46TxBo{X}.diffuse;\ndirectSpecularFactor+=Qb46TxBo{X}.specular;\n#endif\n","#ifdef d2EKz65X{X}\nuniform i5PBq6d4{X}\n{\nvec3 Qn65Tbq4;\nvec3 Yp32BjTy;\nvec3 f3JFn69D;\n} light{X};\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\nuniform float z2J8Dek4{X};\n#ifdef Wn9y8EQr{X}\nuniform mat4 t6M8KsPq{X};\nuniform samplerCube q6E4ZmWa{X};\nuniform vec2 g2ASa4p9{X};\nvarying vec3 q2ENg8n9{X};\n#else\nuniform sampler2D q6E4ZmWa{X};\nuniform mat4 Gw84QdRo{X};\nvarying vec4 a3WFm87R{X};\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n\n\n\n\n\n\n#else\nuniform sampler2D d3T8Meb7{X};\nuniform sampler2D q6E4ZmWa{X};\n#ifndef Po32Jtb9{X}\nuniform sampler2D Ez2g9L3K{X};\n#endif\n#endif\nuniform mat4 Gw84QdRo{X};\nuniform mat4 t6M8KsPq{X};\nuniform vec2 g2ASa4p9{X};\nuniform vec2 x9R4Dcn7{X};\nuniform vec2 d8A9QxLe{X};\nuniform float Ja84RmPc{X};\nuniform float f6T5RbLa{X};\nuniform float z2J8Dek4{X};\nvarying vec4 a3WFm87R{X};\nvarying vec3 q2ENg8n9{X};\n#else\n#ifdef Tx62Nto7{X}\nuniform sampler2D d3T8Meb7{X};\nuniform mat4 Kd6a5DEk{X};\nvarying vec4 a3WFm87R{X};\nvarying float q8NLm2b4{X};\n#endif\n#endif\n#endif\n#endif\n#endif\n","#ifdef Gs62Hcg4\n\n#if defined(a9ERn52W)\nconst int poissonDiskSize=4;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.94201624,-0.39906216 );\npoissonDisk[1]=vec2(0.94558609,-0.76890725 );\npoissonDisk[2]=vec2(-0.094184101,-0.92938870 );\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#elif defined(Ex48Hyb7)\nconst int poissonDiskSize=16;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.94201624,-0.39906216 );\npoissonDisk[1]=vec2(0.94558609,-0.76890725 );\npoissonDisk[2]=vec2(-0.094184101,-0.92938870 );\npoissonDisk[3]=vec2(0.34495938,0.29387760 );\npoissonDisk[4]=vec2(-0.91588581,0.45771432 );\npoissonDisk[5]=vec2(-0.81544232,-0.87912464 );\npoissonDisk[6]=vec2(-0.38277543,0.27676845 );\npoissonDisk[7]=vec2(0.97484398,0.75648379 );\npoissonDisk[8]=vec2(0.44323325,-0.97511554 );\npoissonDisk[9]=vec2(0.53742981,-0.47373420 );\npoissonDisk[10]=vec2(-0.26496911,-0.41893023 );\npoissonDisk[11]=vec2(0.79197514,0.19090188 );\npoissonDisk[12]=vec2(-0.24188840,0.99706507 );\npoissonDisk[13]=vec2(-0.81409955,0.91437590 );\npoissonDisk[14]=vec2(0.19984126,0.78641367 );\npoissonDisk[15]=vec2(0.14383161,-0.14100790 );\n\n#elif defined(Zn2m8STd) \nconst int poissonDiskSize=25;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.978698,-0.0884121);\npoissonDisk[1]=vec2(-0.841121,0.521165);\npoissonDisk[2]=vec2(-0.71746,-0.50322);\npoissonDisk[3]=vec2(-0.702933,0.903134);\npoissonDisk[4]=vec2(-0.663198,0.15482);\npoissonDisk[5]=vec2(-0.495102,-0.232887);\npoissonDisk[6]=vec2(-0.364238,-0.961791);\npoissonDisk[7]=vec2(-0.345866,-0.564379);\npoissonDisk[8]=vec2(-0.325663,0.64037);\npoissonDisk[9]=vec2(-0.182714,0.321329);\npoissonDisk[10]=vec2(-0.142613,-0.0227363);\npoissonDisk[11]=vec2(-0.0564287,-0.36729);\npoissonDisk[12]=vec2(-0.0185858,0.918882);\npoissonDisk[13]=vec2(0.0381787,-0.728996);\npoissonDisk[14]=vec2(0.16599,0.093112);\npoissonDisk[15]=vec2(0.253639,0.719535);\npoissonDisk[16]=vec2(0.369549,-0.655019);\npoissonDisk[17]=vec2(0.423627,0.429975);\npoissonDisk[18]=vec2(0.530747,-0.364971);\npoissonDisk[19]=vec2(0.566027,-0.940489);\npoissonDisk[20]=vec2(0.639332,0.0284127);\npoissonDisk[21]=vec2(0.652089,0.669668);\npoissonDisk[22]=vec2(0.773797,0.345012);\npoissonDisk[23]=vec2(0.968871,0.840449);\npoissonDisk[24]=vec2(0.991882,-0.657338);\n\n#elif defined(Xy5f3FMb)\nconst int poissonDiskSize=64;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0] = vec2(-0.613392, 0.617481);\npoissonDisk[1] = vec2(0.170019, -0.040254);\npoissonDisk[2] = vec2(-0.299417, 0.791925);\npoissonDisk[3] = vec2(0.645680, 0.493210);\npoissonDisk[4] = vec2(-0.651784, 0.717887);\npoissonDisk[5] = vec2(0.421003, 0.027070);\npoissonDisk[6] = vec2(-0.817194, -0.271096);\npoissonDisk[7] = vec2(-0.705374, -0.668203);\npoissonDisk[8] = vec2(0.977050, -0.108615);\npoissonDisk[9] = vec2(0.063326, 0.142369);\npoissonDisk[10] = vec2(0.203528, 0.214331);\npoissonDisk[11] = vec2(-0.667531, 0.326090);\npoissonDisk[12] = vec2(-0.098422, -0.295755);\npoissonDisk[13] = vec2(-0.885922, 0.215369);\npoissonDisk[14] = vec2(0.566637, 0.605213);\npoissonDisk[15] = vec2(0.039766, -0.396100);\npoissonDisk[16] = vec2(0.751946, 0.453352);\npoissonDisk[17] = vec2(0.078707, -0.715323);\npoissonDisk[18] = vec2(-0.075838, -0.529344);\npoissonDisk[19] = vec2(0.724479, -0.580798);\npoissonDisk[20] = vec2(0.222999, -0.215125);\npoissonDisk[21] = vec2(-0.467574, -0.405438);\npoissonDisk[22] = vec2(-0.248268, -0.814753);\npoissonDisk[23] = vec2(0.354411, -0.887570);\npoissonDisk[24] = vec2(0.175817, 0.382366);\npoissonDisk[25] = vec2(0.487472, -0.063082);\npoissonDisk[26] = vec2(-0.084078, 0.898312);\npoissonDisk[27] = vec2(0.488876, -0.783441);\npoissonDisk[28] = vec2(0.470016, 0.217933);\npoissonDisk[29] = vec2(-0.696890, -0.549791);\npoissonDisk[30] = vec2(-0.149693, 0.605762);\npoissonDisk[31] = vec2(0.034211, 0.979980);\npoissonDisk[32] = vec2(0.503098, -0.308878);\npoissonDisk[33] = vec2(-0.016205, -0.872921);\npoissonDisk[34] = vec2(0.385784, -0.393902);\npoissonDisk[35] = vec2(-0.146886, -0.859249);\npoissonDisk[36] = vec2(0.643361, 0.164098);\npoissonDisk[37] = vec2(0.634388, -0.049471);\npoissonDisk[38] = vec2(-0.688894, 0.007843);\npoissonDisk[39] = vec2(0.464034, -0.188818);\npoissonDisk[40] = vec2(-0.440840, 0.137486);\npoissonDisk[41] = vec2(0.364483, 0.511704);\npoissonDisk[42] = vec2(0.034028, 0.325968);\npoissonDisk[43] = vec2(0.099094, -0.308023);\npoissonDisk[44] = vec2(0.693960, -0.366253);\npoissonDisk[45] = vec2(0.678884, -0.204688);\npoissonDisk[46] = vec2(0.001801, 0.780328);\npoissonDisk[47] = vec2(0.145177, -0.898984);\npoissonDisk[48] = vec2(0.062655, -0.611866);\npoissonDisk[49] = vec2(0.315226, -0.604297);\npoissonDisk[50] = vec2(-0.780145, 0.486251);\npoissonDisk[51] = vec2(-0.371868, 0.882138);\npoissonDisk[52] = vec2(0.200476, 0.494430);\npoissonDisk[53] = vec2(-0.494552, -0.711051);\npoissonDisk[54] = vec2(0.612476, 0.705252);\npoissonDisk[55] = vec2(-0.578845, -0.768792);\npoissonDisk[56] = vec2(-0.772454, -0.090976);\npoissonDisk[57] = vec2(0.504440, 0.372295);\npoissonDisk[58] = vec2(0.155736, 0.065157);\npoissonDisk[59] = vec2(0.391522, 0.849605);\npoissonDisk[60] = vec2(-0.620106, -0.328104);\npoissonDisk[61] = vec2(0.789239, -0.419965);\npoissonDisk[62] = vec2(-0.545396, 0.538133);\npoissonDisk[63] = vec2(-0.178564, -0.596057);\n#else\n\nconst int poissonDiskSize=25;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.978698,-0.0884121);\npoissonDisk[1]=vec2(-0.841121,0.521165);\npoissonDisk[2]=vec2(-0.71746,-0.50322);\npoissonDisk[3]=vec2(-0.702933,0.903134);\npoissonDisk[4]=vec2(-0.663198,0.15482);\npoissonDisk[5]=vec2(-0.495102,-0.232887);\npoissonDisk[6]=vec2(-0.364238,-0.961791);\npoissonDisk[7]=vec2(-0.345866,-0.564379);\npoissonDisk[8]=vec2(-0.325663,0.64037);\npoissonDisk[9]=vec2(-0.182714,0.321329);\npoissonDisk[10]=vec2(-0.142613,-0.0227363);\npoissonDisk[11]=vec2(-0.0564287,-0.36729);\npoissonDisk[12]=vec2(-0.0185858,0.918882);\npoissonDisk[13]=vec2(0.0381787,-0.728996);\npoissonDisk[14]=vec2(0.16599,0.093112);\npoissonDisk[15]=vec2(0.253639,0.719535);\npoissonDisk[16]=vec2(0.369549,-0.655019);\npoissonDisk[17]=vec2(0.423627,0.429975);\npoissonDisk[18]=vec2(0.530747,-0.364971);\npoissonDisk[19]=vec2(0.566027,-0.940489);\npoissonDisk[20]=vec2(0.639332,0.0284127);\npoissonDisk[21]=vec2(0.652089,0.669668);\npoissonDisk[22]=vec2(0.773797,0.345012);\npoissonDisk[23]=vec2(0.968871,0.840449);\npoissonDisk[24]=vec2(0.991882,-0.657338);\n#endif\n\n#endif","#ifdef Gs62Hcg4\nfloat getRandomNumber(vec3 seed, int inputI){\nvec4 seed4 = vec4(seed,inputI);\nfloat dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\nreturn fract(sin(dot_product) * 43758.5453);\n}\nbool isOutLimits(vec2 uv, float receiverDepth) {return (uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0 || receiverDepth<0.0);}\nbool isUVOutLimits(vec2 uv) {return (uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0);}\nfloat computeDynamicBias(float bias,float dynb_1,float dynb_2,float dynb_3,vec3 N,vec3 L) \n{\nvec3 N_1 = dynb_1*N;\nfloat cosTheta=clamp(dot(N,L)+dynb_2,0.0,1.0);\nfloat dynamicBias=bias*tan(acos(cosTheta));\nreturn dynamicBias*dynb_3;\n}\nfloat convertFromScreenToViewSpace(float depthS,vec2 g2ASa4p9)\n{\nfloat depthNDC=depthS*2.0-1.0;\nreturn -2.0*g2ASa4p9.x*g2ASa4p9.y/(depthNDC*(g2ASa4p9.y-g2ASa4p9.x)-(g2ASa4p9.y+g2ASa4p9.x));\n}\nfloat unpack24Bits(vec3 color)\n{\nconst vec3 bit_shift=vec3(1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nfloat linstep(float low,float high,float v) {return clamp((v-low)/(high-low),0.0,1.0);}\nfloat texture2DCompare(sampler2D depths, vec2 uv, float compare)\n{\nfloat depth = texture2D(depths, uv).r;\nreturn step(compare, depth);\n}\nfloat texture2DShadowLerp(sampler2D depths, vec2 size, vec2 uv, float compare)\n{\nvec2 texelSize = vec2(1.0)/size;\nvec2 f = fract(uv*size+0.5);\nvec2 centroidUV = floor(uv*size+0.5)/size;\nfloat lb = texture2DCompare(depths, centroidUV+texelSize*vec2(0.0, 0.0), compare);\nfloat lt = texture2DCompare(depths, centroidUV+texelSize*vec2(0.0, 1.0), compare);\nfloat rb = texture2DCompare(depths, centroidUV+texelSize*vec2(1.0, 0.0), compare);\nfloat rt = texture2DCompare(depths, centroidUV+texelSize*vec2(1.0, 1.0), compare);\nfloat a = mix(lb, lt, f.y);\nfloat b = mix(rb, rt, f.y);\nfloat c = mix(a, b, f.x);\nreturn c;\n}\nfloat PercentageCloserFiltering(sampler2D depths, vec2 size, vec2 uv, float compare){\nfloat result = 0.0;\nfor(int x=-2; x<=2; x++){\nfor(int y=-2; y<=2; y++){\nvec2 off = vec2(x,y)/size;\nresult += texture2DCompare(depths, uv+off, compare);\n}\n}\nreturn result/25.0;\n}\nfloat InterpolatedPercentageCloserFiltering(sampler2D depths, vec2 size, vec2 uv, float compare){\nfloat result = 0.0;\nfor(int x=-1; x<=1; x++){\nfor(int y=-1; y<=1; y++){\nvec2 off = vec2(x,y)/size;\nresult += texture2DShadowLerp(depths, size, uv+off, compare);\n}\n}\nreturn result/9.0;\n}\nfloat VSM(sampler2D depths, vec2 uv, float compare){\nvec2 moments = texture2D(depths, uv).xy;\nfloat p = smoothstep(compare-0.02, compare, moments.x);\nfloat variance = max(moments.y - moments.x*moments.x, -0.001);\nfloat d = compare - moments.x;\nfloat p_max = linstep(0.2, 1.0, variance / (variance + d*d));\nreturn clamp(max(p, p_max), 0.0, 1.0);\n}\nfloat chebyshev(vec2 moments,float depth)\n{\nfloat d=depth; float p=0.0;\np=smoothstep(d-0.02,d,moments.x);\nfloat variance=max(moments.y-(moments.x*moments.x), 0.000001);\nfloat diff=(d-moments.x);\nfloat p_max=variance/(variance+diff*diff);\np_max=linstep(0.1,1.0,p_max);\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat exponential(float Ja84RmPc,float moment,float depth) {return clamp(exp(Ja84RmPc*(moment-depth)),0.0,1.0);}\nvec4 getTexel(vec2 uv,sampler2D sampler) {return texture2D(sampler,uv);}\nvec2 getMoments(vec2 uv,sampler2D sampler,sampler2D secondSampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler);if(isFullFloat) {return texel.xy;} else {vec4 secondTexel=getTexel(uv,secondSampler); return vec2(unpack(texel),unpack(secondTexel));}\n}\nfloat getPCSSVisibility(vec2 uv,sampler2D sampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler); if(isFullFloat) {return texel.g;} else {return texel.a;}\n}\nfloat getBlockerDepth(vec2 uv,sampler2D sampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler); if(isFullFloat) {return texel.r;} else {return unpack24Bits(texel.rgb);}\n}\nfloat getShadowFromPrecomputedPCSS(float receiverDepth,vec2 uv,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif(isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat visibility=getPCSSVisibility(uv,shadowSampler,isFullFloat);\nfloat blockerDepth=getBlockerDepth(uv,shadowSampler,isFullFloat);\nif (blockerDepth+dynamicBias>receiverDepth) {return 1.0;}\nreturn visibility;\n}\nfloat getShadowFromPCSS(float receiverDepth,vec2 uv,vec3 positionFromLightV,vec2 x9R4Dcn7,vec2 d8A9QxLe,vec2 g2ASa4p9,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif(isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat blockerDepth=getBlockerDepth(uv,shadowSampler,isFullFloat);\nfloat avgBlockerDepthV=0.0;\nfloat numBlockers=0.0;\nfloat blockerSum=0.0;\nvec2 lightSizeUV=x9R4Dcn7/d8A9QxLe;\nvec2 searchRegionRadiusUV=lightSizeUV*(positionFromLightV.z-g2ASa4p9.x)/positionFromLightV.z;\nfor (int i=0; i<poissonDiskSize; i++) {\nfloat otherBlockerDepth=getBlockerDepth(uv+poissonDisk[i]*searchRegionRadiusUV,shadowSampler,isFullFloat);\nfloat otherBlockerDepthV=convertFromScreenToViewSpace(otherBlockerDepth,g2ASa4p9);\nif (otherBlockerDepthV<positionFromLightV.z) {\nblockerSum+=otherBlockerDepthV;\nnumBlockers++;\n}\n}\navgBlockerDepthV=blockerSum/numBlockers;\nif (numBlockers<1.0) {return 1.0;}\nelse\n{\nfloat penumbraRatio=(positionFromLightV.z-avgBlockerDepthV)/avgBlockerDepthV;\nvec2 filterRadiusUV=penumbraRatio*lightSizeUV*g2ASa4p9.x/positionFromLightV.z;\nfloat sum=0.0;\nfor (int i=0; i<poissonDiskSize; i++) {\nvec2 offset=poissonDisk[i]*filterRadiusUV;\nfloat otherBlockerDepth=getBlockerDepth(uv+offset,shadowSampler,isFullFloat);\nif (otherBlockerDepth<receiverDepth) {\nsum+=1.0;\n}\n}\nfloat darkness=sum/float(poissonDiskSize);\nfloat visibility=1.0-darkness;\nreturn visibility;\n}\n}\nfloat getShadowFromExponential(float receiverDepth,vec2 uv,float Ja84RmPc,sampler2D shadowSampler,sampler2D secondShadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat moment=getMoments(uv,shadowSampler,secondShadowSampler,isFullFloat).x;\nreturn exponential(Ja84RmPc,moment,receiverDepth);\n}\nfloat getShadowFromVSM(float receiverDepth,vec2 uv,sampler2D shadowSampler,sampler2D secondShadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)){return outsideLuminance;}\nvec2 moments=getMoments(uv,shadowSampler,secondShadowSampler,isFullFloat);\nreturn chebyshev(moments,receiverDepth);\n}\nfloat getHardShadow(float receiverDepth,vec2 uv,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat blockerDepth=getMoments(uv,shadowSampler,shadowSampler,isFullFloat).x;\nif(blockerDepth+dynamicBias>receiverDepth) return 1.0; else return 0.0;\n}\nfloat getShadow(float f6T5RbLa,float receiverDepth,vec2 uv,vec3 positionFromLightV,vec2 x9R4Dcn7,vec2 d8A9QxLe,vec2 g2ASa4p9,float Ja84RmPc,\nsampler2D d3T8Meb7,sampler2D Ez2g9L3K,sampler2D q6E4ZmWa,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nfloat visibility=1.0;\nif(f6T5RbLa<1.0) {visibility=getHardShadow(receiverDepth,uv,d3T8Meb7,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<2.0) {visibility=getShadowFromExponential(receiverDepth,uv,Ja84RmPc,d3T8Meb7,Ez2g9L3K,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<3.0) {visibility=getShadowFromVSM(receiverDepth,uv,d3T8Meb7,Ez2g9L3K,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<4.0) {visibility=getShadowFromPrecomputedPCSS(receiverDepth,uv,q6E4ZmWa,dynamicBias,outsideLuminance,isFullFloat);}\nelse {visibility=getShadowFromPCSS(receiverDepth,uv,positionFromLightV,x9R4Dcn7,d8A9QxLe,g2ASa4p9,d3T8Meb7,dynamicBias,outsideLuminance,isFullFloat);}\nreturn visibility;\n}\nfloat computeShadow(vec4 positionFromLight,float depthMetric,sampler2D shadowSampler,float dynamicBias,bool isFullFloat) \n{\nvec3 depth=positionFromLight.xyz/positionFromLight.w;\nvec2 uv=0.5*depth.xy+vec2(0.5);\nif (isUVOutLimits(uv)) {return 1.0;}\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nfloat shadow=0;\nif (isFullFloat) {shadow=texture2D(shadowSampler,uv).r;} else {shadow=unpack(texture2D(shadowSampler,uv));}\nif (shadowPixelDepth>shadow+dynamicBias){return 0.0;} \nreturn 1.0;\n}\n#endif\n","#ifdef d2EKz65X{X}\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\n#ifdef Wn9y8EQr{X}\nq2ENg8n9{X}=vec3(t6M8KsPq{X}*worldPosition);\n#else\na3WFm87R{X}=Gw84QdRo{X}*worldPosition;\n#endif\n#else\n#ifdef Qr8j3M7B{X}\na3WFm87R{X}=Gw84QdRo{X}*worldPosition;\nq2ENg8n9{X}=vec3(t6M8KsPq{X}*worldPosition);\n#else\n#ifdef Tx62Nto7{X}\na3WFm87R{X}=Kd6a5DEk{X}*worldPosition;\nq8NLm2b4{X}=a3WFm87R{X}.z*0.5+0.5;\n#endif\n#endif\n#endif\n#endif\n#endif\n","uniform mat4 viewProjection;\n#ifdef w9C3Yen4\n#ifndef Hp4m2BWf\nuniform mat4 view;\n#endif\n#endif\n#ifdef Ta63Acf7\nuniform mat4 Xo8q4A2R;\nuniform vec2 Ji23KzMd;\n#endif\n#ifdef Hp4m2BWf\nuniform mat4 Lj7q8H2K;\nuniform vec2 Wr5i8R3S;\n#endif\n#ifdef Qs3b9W2T\nuniform mat4 f8E2Wxc3;\nuniform vec2 q4A5Diy8;\n#endif\n#ifdef o6GAc9s7\nuniform mat4 t3GQn4m8;\nuniform vec2 Ez4g6PHc;\n#endif\n#ifdef Pn4m8W9E\nuniform mat4 Dy84Brw6;\nuniform vec2 x4S6Ljt2;\n#endif\n#ifdef Gf4i3Y8S\nuniform mat4 Em94Zxs7;\nuniform vec3 He9c4X2M;\n#endif\n","layout(std140,column_major) uniform;\nuniform Material {\nvec2 Ji23KzMd;\nvec2 Wr5i8R3S;\nvec2 q4A5Diy8;\nvec2 Ez4g6PHc;\nfloat f2THw8s5;\nvec2 x4S6Ljt2;\nvec3 He9c4X2M;\nfloat j2N4DfKp;\nfloat z9E8Dre3;\nfloat o9EDt87H;\nmat4 Xo8q4A2R;\nmat4 Lj7q8H2K;\nmat4 f8E2Wxc3;\nmat4 t3GQn4m8;\nmat4 Dy84Brw6;\nmat4 Em94Zxs7;\nvec4 Lk8x5T3G;\nvec3 r8TLa3t5;\nvec3 b6B9Wjf2;\nfloat Gr2p3S4T;\nfloat i5LEp3e8;\nfloat Bt52Znx8;\nfloat z9LGq35P;\nfloat Xm86Bye7;\nfloat Ge69Pir7;\nvec3 Ew46Kes3;\nvec2 b4M3HcSi;\nvec2 Gk97Wqd5;\nvec3 n5J8Afy2;\nvec3 Lr45JbEi;\nvec3 c9F4XmDi;\nvec4 Ji6x8KYz;\nvec3 Wq6t4DBe;\nvec3 g8G2Wfc4;\nmat4 z9C8Bsn3;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};"],extendStatics=function(t,e){return(extendStatics=Object[_0xc101[0]]||{__proto__:[]}instanceof Array&&function(t,e){t[_0xc101[1]]=e}||function(t,e){for(var n in e)e[_0xc101[2]](n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this[_0xc101[3]]=t}extendStatics(t,e),t[_0xc101[4]]=null===e?Object[_0xc101[5]](e):(n[_0xc101[4]]=e[_0xc101[4]],new n)}function __decorate(t,e,n,i){var r,s=arguments[_0xc101[6]],a=s<3?e:null===i?i=Object[_0xc101[7]](e,n):i;if(typeof Reflect===_0xc101[8]&&typeof Reflect[_0xc101[9]]===_0xc101[10])a=Reflect[_0xc101[9]](t,e,n,i);else for(var o=t[_0xc101[6]]-1;o>=0;o--)(r=t[o])&&(a=(s<3?r(a):s>3?r(e,n,a):r(e,n))||a);return s>3&&a&&Object[_0xc101[11]](e,n,a),a}(Zakeke=Zakeke||{})[_0xc101[12]]={},Zakeke[_0xc101[12]][_0xc101[13]]=function(){Zakeke[_0xc101[12]].SetupCustomShaders(),Zakeke[_0xc101[12]].DefineCustomMaterials()},Zakeke[_0xc101[12]][_0xc101[14]]=function(){if(Zakeke[_0xc101[15]])for(var t in Zakeke[_0xc101[15]])BABYLON[_0xc101[16]][_0xc101[15]][t]=Zakeke[_0xc101[15]][t];if(Zakeke[_0xc101[17]])for(var t in Zakeke[_0xc101[17]])BABYLON[_0xc101[16]][_0xc101[17]][t]=Zakeke[_0xc101[17]][t]},function(t){t[_0xc101[12]][_0xc101[18]]=function(){var e=function(t){function e(){var e=t[_0xc101[19]](this)||this;return e[_0xc101[20]]=!1,e[_0xc101[21]]=!1,e[_0xc101[22]]=!1,e[_0xc101[23]]=!1,e[_0xc101[24]]=!0,e[_0xc101[25]]=!1,e[_0xc101[26]]=!1,e[_0xc101[27]]=!1,e[_0xc101[28]]=!1,e[_0xc101[29]]=!1,e[_0xc101[30]]=!1,e[_0xc101[31]]=!1,e[_0xc101[32]]=!1,e[_0xc101[33]]=!1,e[_0xc101[34]]=!1,e[_0xc101[35]]=!1,e[_0xc101[36]]=!1,e[_0xc101[37]]=!1,e[_0xc101[38]]=!1,e[_0xc101[39]]=!1,e[_0xc101[40]]=!1,e[_0xc101[41]]=!1,e[_0xc101[42]]=!1,e[_0xc101[43]]=!1,e[_0xc101[44]]=!1,e[_0xc101[45]]=!1,e[_0xc101[46]]=!1,e[_0xc101[47]]=!1,e[_0xc101[48]]=!1,e[_0xc101[49]]=!1,e[_0xc101[50]]=!1,e[_0xc101[51]]=0,e[_0xc101[52]]=0,e[_0xc101[53]](),e}return __extends(e,t),e}(BABYLON.MaterialDefines),n=function(n){function i(t,e){var i=n[_0xc101[19]](this,t,e)||this;return i[_0xc101[54]]=new BABYLON.Color3(1,1,1),i[_0xc101[55]]=new BABYLON.Color3(1,1,1),i[_0xc101[56]]=new BABYLON.Color3(0,0,0),i[_0xc101[57]]=50,i[_0xc101[58]]=.6,i[_0xc101[59]]=.5,i[_0xc101[60]]=0,i[_0xc101[61]]=1,i[_0xc101[62]]=new BABYLON.Color3(1,1,1),i[_0xc101[63]]=0,i[_0xc101[64]]=.5,i[_0xc101[65]]=0,i[_0xc101[66]]=1,i[_0xc101[67]]=1,i[_0xc101[68]]=!1,i[_0xc101[69]]=!1,i[_0xc101[70]]=!1,i[_0xc101[71]]=!1,i[_0xc101[72]]=4,i[_0xc101[73]]=new BABYLON.SmartArray(16),i[_0xc101[74]]=new BABYLON.Vector3(.3,.59,.11),i[_0xc101[75]]=new BABYLON.Vector3(.2125,.7154,.0721),i[_0xc101[76]]=new BABYLON.Matrix(.3,.59,.11,.4,.2125,.7154,.0721,0,0,0,0,0,0,0,0,0),i}return __extends(i,n),Object[_0xc101[11]](i[_0xc101[4]],_0xc101[77],{get:function(){return this[_0xc101[68]]},set:function(t){this[_0xc101[68]]!==t&&(this[_0xc101[68]]=t,this[_0xc101[79]][_0xc101[78]](this),this[_0xc101[80]][_0xc101[78]](this))},enumerable:!0,configurable:!0}),Object[_0xc101[11]](i[_0xc101[4]],_0xc101[81],{get:function(){return this[_0xc101[68]]},set:function(t){this[_0xc101[68]]!==t&&(this[_0xc101[68]]=t,this[_0xc101[79]][_0xc101[78]](this),this[_0xc101[80]][_0xc101[78]](this))},enumerable:!0,configurable:!0}),i[_0xc101[4]][_0xc101[82]]=function(){return this[_0xc101[83]]&&this[_0xc101[83]][_0xc101[84]]&&this[_0xc101[70]]},i[_0xc101[4]][_0xc101[85]]=function(t,e){t[_0xc101[86]]||(t[_0xc101[86]]=new BABYLON.UniformBuffer(e[_0xc101[87]]())),t[_0xc101[86]][_0xc101[89]](_0xc101[88],3),t[_0xc101[86]][_0xc101[89]](_0xc101[90],3),t[_0xc101[86]][_0xc101[89]](_0xc101[91],3),t[_0xc101[86]][_0xc101[5]]()},i[_0xc101[4]][_0xc101[92]]=function(t,e,n,i){void 0===i&&(i=4);for(var r=0,s=!1,a=!1,o=!1,l=0,h=e[_0xc101[93]];l<h[_0xc101[6]];l++){var c=h[l];if(void 0===n[_0xc101[94]+r]&&(s=!0),!(c[_0xc101[95]]()>1)){switch(a=!0,n[_0xc101[94]+r]=!0,n[_0xc101[96]+r]=!1,n[_0xc101[97]+r]=!1,c[_0xc101[95]]()){case 0:n[_0xc101[96]+r]=!0;break;case 1:n[_0xc101[97]+r]=!0}if(n[_0xc101[98]+r]=!1,n[_0xc101[99]+r]=!1,n[_0xc101[100]+r]=!1,n[_0xc101[101]+r]=!1,n[_0xc101[102]+r]=!1,n[_0xc101[103]+r]=!1,n[_0xc101[104]+r]=!1,e&&e[_0xc101[105]]&&t[_0xc101[106]]&&c[_0xc101[107]]&&c[_0xc101[108]]()&&c instanceof BABYLON[_0xc101[109]]){var u=t[_0xc101[87]]()[_0xc101[110]]();n[_0xc101[98]+r]=!0,n[_0xc101[102]+r]=!(!u[_0xc101[111]]||!u[_0xc101[112]])||!(!u[_0xc101[113]]||!u[_0xc101[114]]),o=!0}if(this._buildLightUniformLayout(c,t),++r===i)break}}n[_0xc101[20]]=a,n[_0xc101[21]]=o;for(var d=r;i>d;d++)void 0!==n[_0xc101[94]+d]&&(n[_0xc101[94]+d]=!1);s&&n[_0xc101[53]]()},i[_0xc101[4]][_0xc101[115]]=function(t,e,n,i,r){void 0===r&&(r=4);for(var s=0;r>s&&i[_0xc101[94]+s];s++)t[_0xc101[125]](_0xc101[88]+s,_0xc101[90]+s,_0xc101[91]+s,_0xc101[116]+s,_0xc101[117]+s,_0xc101[118]+s,_0xc101[119]+s,_0xc101[120]+s,_0xc101[121]+s,_0xc101[122]+s,_0xc101[123]+s,_0xc101[124]+s),e&&e[_0xc101[125]](_0xc101[126]+s),n[_0xc101[125]](_0xc101[127]+s),n[_0xc101[125]](_0xc101[128]+s),n[_0xc101[125]](_0xc101[129]+s)},i[_0xc101[4]][_0xc101[130]]=function(t,e,n,i,r){if(n[_0xc101[105]]&&t[_0xc101[107]]){var s=t[_0xc101[108]]();s&&(t instanceof BABYLON[_0xc101[109]]?(r[_0xc101[132]](_0xc101[124]+i,s[_0xc101[131]]()),r[_0xc101[134]](_0xc101[127]+i,s[_0xc101[133]]())):Logger[_0xc101[136]](_0xc101[135]))}},i[_0xc101[4]][_0xc101[137]]=function(t,e,n){t instanceof BABYLON[_0xc101[138]]?t[_0xc101[139]]()?t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[141]][_0xc101[140]],t[_0xc101[141]][_0xc101[142]],t[_0xc101[141]][_0xc101[143]],n):t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[145]][_0xc101[140]],t[_0xc101[145]][_0xc101[142]],t[_0xc101[145]][_0xc101[143]],n):t instanceof BABYLON[_0xc101[109]]?t[_0xc101[139]]()?t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[146]][_0xc101[140]],t[_0xc101[146]][_0xc101[142]],t[_0xc101[146]][_0xc101[143]],n):t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[147]][_0xc101[140]],t[_0xc101[147]][_0xc101[142]],t[_0xc101[147]][_0xc101[143]],n):Logger[_0xc101[136]](_0xc101[148])},i[_0xc101[4]][_0xc101[149]]=function(t,e,n,i,r){void 0===i&&(i=4);for(var s=0,a=0,o=e[_0xc101[93]];a<o[_0xc101[6]];a++){var l=o[a];if(!(l[_0xc101[95]]()>1)&&(l[_0xc101[86]][_0xc101[150]](n,_0xc101[126]+s),this._bindLightProperties(l,n,s),l[_0xc101[155]][_0xc101[154]](l[_0xc101[151]],BABYLON[_0xc101[153]][_0xc101[152]][0]),l[_0xc101[86]][_0xc101[156]](_0xc101[90],BABYLON[_0xc101[153]][_0xc101[152]][0],s+_0xc101[135]),l[_0xc101[157]][_0xc101[154]](l[_0xc101[151]],BABYLON[_0xc101[153]][_0xc101[152]][1]),l[_0xc101[86]][_0xc101[156]](_0xc101[91],BABYLON[_0xc101[153]][_0xc101[152]][1],s+_0xc101[135]),r[_0xc101[21]]&&r[_0xc101[98]+s]&&this._bindLightShadow(l,t,e,s+_0xc101[135],n),l[_0xc101[86]][_0xc101[158]](),++s===i))break}},i[_0xc101[4]][_0xc101[159]]=function(){},i[_0xc101[4]][_0xc101[160]]=function(){return _0xc101[161]},i[_0xc101[4]][_0xc101[162]]=function(){return this[_0xc101[73]][_0xc101[163]](),this[_0xc101[164]]&&this[_0xc101[164]][_0xc101[165]]&&this[_0xc101[73]][_0xc101[125]](this._reflectionTexture),this[_0xc101[73]]},i[_0xc101[4]][_0xc101[166]]=function(){return this[_0xc101[167]]<1||this[_0xc101[168]]||this._shouldUseAlphaFromAlbedoTexture()||this[_0xc101[169]]&&this[_0xc101[169]][_0xc101[170]]},i[_0xc101[4]][_0xc101[171]]=function(){return this[_0xc101[83]]&&this[_0xc101[83]][_0xc101[84]]},i[_0xc101[4]][_0xc101[172]]=function(){return this[_0xc101[83]]},i[_0xc101[4]][_0xc101[173]]=function(t,n,i){if(this[_0xc101[174]]&&this[_0xc101[175]]&&n[_0xc101[176]])return!0;n[_0xc101[177]]?n[_0xc101[177]]instanceof e||(Logger[_0xc101[136]](_0xc101[135]),n[_0xc101[177]]=new e):n[_0xc101[177]]=new e;var r=this[_0xc101[178]](),s=n[_0xc101[177]],a=r[_0xc101[87]]();if(!this[_0xc101[179]]&&n[_0xc101[176]]&&s[_0xc101[180]]===r[_0xc101[181]]())return!0;if(s[_0xc101[182]])if(!r[_0xc101[183]]||this[_0xc101[71]]||this[_0xc101[68]]){s[_0xc101[20]]=!1,s[_0xc101[21]]=!1;for(var o=0;o<this[_0xc101[72]];o++)void 0!==s[_0xc101[94]+o]&&(s[_0xc101[94]+o]=!1)}else s[_0xc101[184]]=!0,this._prepareDefinesForLights(r,t,s,this._maxSimultaneousLights);if(s[_0xc101[185]])if(s[_0xc101[186]]=!1,r[_0xc101[187]]){if(s[_0xc101[26]]=!!a[_0xc101[110]]()[_0xc101[188]],this[_0xc101[83]]){if(!this[_0xc101[83]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[27]]=!0}else s[_0xc101[27]]=!1;if(a[_0xc101[110]]()[_0xc101[190]]&&this[_0xc101[191]]){if(!this[_0xc101[191]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[184]]=!0,s[_0xc101[28]]=!0}else s[_0xc101[28]]=!1;if(this[_0xc101[192]]&&this[_0xc101[59]]){if(!this[_0xc101[192]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[29]]=!0}else s[_0xc101[29]]=!1;if(this[_0xc101[193]]&&this[_0xc101[60]]){if(!this[_0xc101[193]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[30]]=!0}else s[_0xc101[30]]=!1;if(this[_0xc101[164]]&&!this[_0xc101[68]]&&this[_0xc101[59]]){if(!this[_0xc101[164]][_0xc101[189]]())return!1;s[_0xc101[184]]=!0,s[_0xc101[31]]=!0,s[_0xc101[32]]=this[_0xc101[194]]&&this[_0xc101[195]]&&this[_0xc101[196]]}else s[_0xc101[31]]=!1,s[_0xc101[32]]=!1;if(this[_0xc101[168]]){if(!this[_0xc101[168]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[33]]=!0,s[_0xc101[34]]=this[_0xc101[168]][_0xc101[197]]}else s[_0xc101[33]]=!1,s[_0xc101[34]]=!1;if(this[_0xc101[198]]&&this[_0xc101[61]]){if(!this[_0xc101[198]][_0xc101[189]]())return!1;this[_0xc101[69]]?(s[_0xc101[186]]=!0,s[_0xc101[35]]=!0,s[_0xc101[37]]=!1,s[_0xc101[36]]=!!(this[_0xc101[65]]&&this[_0xc101[65]]-1)):(s[_0xc101[37]]=!0,s[_0xc101[35]]=!1,s[_0xc101[36]]=!1)}else s[_0xc101[35]]=!1,s[_0xc101[37]]=!1,s[_0xc101[36]]=!1;if(this[_0xc101[68]]){if(s[_0xc101[38]]=!0,s[_0xc101[184]]=!0,this[_0xc101[199]]){if(!this[_0xc101[199]][_0xc101[189]]())return!1;s[_0xc101[39]]=!0}else s[_0xc101[39]]=!1;if(this[_0xc101[200]]){if(!this[_0xc101[200]][_0xc101[189]]())return!1;s[_0xc101[40]]=!0}else s[_0xc101[40]]=!1}else s[_0xc101[38]]=!1,s[_0xc101[39]]=!1,s[_0xc101[40]]=!1;s[_0xc101[41]]=this._shouldUseAlphaFromAlbedoTexture(),s[_0xc101[42]]=!this[_0xc101[201]]}else s[_0xc101[26]]=!1,s[_0xc101[27]]=!1,s[_0xc101[28]]=!1,s[_0xc101[29]]=!1,s[_0xc101[30]]=!1,s[_0xc101[31]]=!1,s[_0xc101[32]]=!1,s[_0xc101[33]]=!1,s[_0xc101[34]]=!1,s[_0xc101[35]]=!1,s[_0xc101[37]]=!1,s[_0xc101[36]]=!1,s[_0xc101[38]]=!1,s[_0xc101[39]]=!1,s[_0xc101[40]]=!1,s[_0xc101[41]]=!1,s[_0xc101[42]]=!1;if(s[_0xc101[202]]&&(this[_0xc101[169]]&&this[_0xc101[169]][_0xc101[170]]?(s[_0xc101[184]]=!0,s[_0xc101[43]]=!0):s[_0xc101[43]]=!1),s[_0xc101[203]]&&(this[_0xc101[63]]?(s[_0xc101[44]]=!0,s[_0xc101[184]]=!0):s[_0xc101[44]]=!1,s[_0xc101[45]]=1!==this[_0xc101[66]]||1!==this[_0xc101[67]]),(s[_0xc101[204]]||s[_0xc101[184]]===s[_0xc101[205]]||s[_0xc101[186]]===s[_0xc101[206]])&&(s[_0xc101[205]]=s[_0xc101[184]],s[_0xc101[206]]=s[_0xc101[186]],s[_0xc101[184]]?(s[_0xc101[48]]=t[_0xc101[208]](BABYLON[_0xc101[207]].NormalKind))||(Logger[_0xc101[136]](_0xc101[135]),s[_0xc101[28]]=!1,s[_0xc101[31]]=!1,s[_0xc101[32]]=!1,s[_0xc101[38]]=!1,s[_0xc101[39]]=!1,s[_0xc101[43]]=!1,s[_0xc101[44]]=!1,s[_0xc101[20]]=!1,s[_0xc101[21]]=!1):s[_0xc101[48]]=!1,s[_0xc101[186]]?(s[_0xc101[49]]=t[_0xc101[208]](BABYLON[_0xc101[207]].UVKind),s[_0xc101[50]]=t[_0xc101[208]](BABYLON[_0xc101[207]].UV2Kind)):(s[_0xc101[49]]=!1,s[_0xc101[50]]=!1),t[_0xc101[209]]&&t[_0xc101[210]]?(s[_0xc101[51]]=t[_0xc101[211]],s[_0xc101[52]]=t[_0xc101[213]][_0xc101[212]][_0xc101[6]]+1):(s[_0xc101[51]]=0,s[_0xc101[52]]=0)),!1!==s[_0xc101[46]]&&(s[_0xc101[46]]=!s[_0xc101[46]],s[_0xc101[214]]()),s[_0xc101[47]]!==i&&(s[_0xc101[47]]=i,s[_0xc101[214]]()),s[_0xc101[215]]){s[_0xc101[216]](),r[_0xc101[217]]();var l=new BABYLON[_0xc101[218]];BABYLON[_0xc101[219]].HandleFallbacksForShadows(s,l,this._maxSimultaneousLights);var h=[BABYLON[_0xc101[207]][_0xc101[220]]];s[_0xc101[48]]&&h[_0xc101[125]](BABYLON[_0xc101[207]].NormalKind),s[_0xc101[49]]&&h[_0xc101[125]](BABYLON[_0xc101[207]].UVKind),s[_0xc101[50]]&&h[_0xc101[125]](BABYLON[_0xc101[207]].UV2Kind),BABYLON[_0xc101[219]].PrepareAttributesForBones(h,t,s,l),BABYLON[_0xc101[219]].PrepareAttributesForInstances(h,s);var c=_0xc101[221],u=s.toString();if(n[_0xc101[222]]!==u+this[_0xc101[223]]||!n[_0xc101[176]]){n[_0xc101[222]]=u+this[_0xc101[223]];var d=[_0xc101[224],_0xc101[225],_0xc101[226],_0xc101[227],_0xc101[228],_0xc101[229],_0xc101[230],_0xc101[231],_0xc101[232],_0xc101[233],_0xc101[234],_0xc101[235],_0xc101[236],_0xc101[237],_0xc101[238],_0xc101[239],_0xc101[240],_0xc101[241],_0xc101[242],_0xc101[243],_0xc101[244],_0xc101[245],_0xc101[246],_0xc101[247],_0xc101[248],_0xc101[249],_0xc101[250],_0xc101[251],_0xc101[252],_0xc101[253],_0xc101[254],_0xc101[255],_0xc101[256],_0xc101[257],_0xc101[258],_0xc101[259],_0xc101[260],_0xc101[261],_0xc101[262],_0xc101[263]],p=[_0xc101[264],_0xc101[265],_0xc101[266],_0xc101[267],_0xc101[268],_0xc101[269],_0xc101[270],_0xc101[271],_0xc101[272]],f=[_0xc101[273],_0xc101[274]];this._prepareUniformsAndSamplersList(d,f,p,s,this._maxSimultaneousLights),n[_0xc101[278]](r[_0xc101[87]]()[_0xc101[277]](c,{attributes:h,uniformsNames:d,uniformBuffersNames:f,samplers:p,defines:u,fallbacks:l,onCompiled:this[_0xc101[275]],onError:this[_0xc101[276]],indexParameters:{maxSimultaneousLights:this[_0xc101[72]]}},a),s),this[_0xc101[279]]()}}return!!n[_0xc101[176]][_0xc101[280]]()&&(s[_0xc101[180]]=r[_0xc101[181]](),this[_0xc101[175]]=!0,!0)},i[_0xc101[4]][_0xc101[279]]=function(){this[_0xc101[281]][_0xc101[89]](_0xc101[229],2),this[_0xc101[281]][_0xc101[89]](_0xc101[231],2),this[_0xc101[281]][_0xc101[89]](_0xc101[234],2),this[_0xc101[281]][_0xc101[89]](_0xc101[237],2),this[_0xc101[281]][_0xc101[89]](_0xc101[240],1),this[_0xc101[281]][_0xc101[89]](_0xc101[244],2),this[_0xc101[281]][_0xc101[89]](_0xc101[247],3),this[_0xc101[281]][_0xc101[89]](_0xc101[249],1),this[_0xc101[281]][_0xc101[89]](_0xc101[250],1),this[_0xc101[281]][_0xc101[89]](_0xc101[251],1),this[_0xc101[281]][_0xc101[89]](_0xc101[230],16),this[_0xc101[281]][_0xc101[89]](_0xc101[232],16),this[_0xc101[281]][_0xc101[89]](_0xc101[235],16),this[_0xc101[281]][_0xc101[89]](_0xc101[238],16),this[_0xc101[281]][_0xc101[89]](_0xc101[245],16),this[_0xc101[281]][_0xc101[89]](_0xc101[248],16),this[_0xc101[281]][_0xc101[89]](_0xc101[228],4),this[_0xc101[281]][_0xc101[89]](_0xc101[239],3),this[_0xc101[281]][_0xc101[89]](_0xc101[258],3),this[_0xc101[281]][_0xc101[89]](_0xc101[233],1),this[_0xc101[281]][_0xc101[89]](_0xc101[236],1),this[_0xc101[281]][_0xc101[89]](_0xc101[255],1),this[_0xc101[281]][_0xc101[89]](_0xc101[256],1),this[_0xc101[281]][_0xc101[89]](_0xc101[246],1),this[_0xc101[281]][_0xc101[89]](_0xc101[259],1),this[_0xc101[281]][_0xc101[89]](_0xc101[252],3),this[_0xc101[281]][_0xc101[89]](_0xc101[253],2),this[_0xc101[281]][_0xc101[89]](_0xc101[254],2),this[_0xc101[281]][_0xc101[89]](_0xc101[241],3),this[_0xc101[281]][_0xc101[89]](_0xc101[242],3),this[_0xc101[281]][_0xc101[89]](_0xc101[243],3),this[_0xc101[281]][_0xc101[89]](_0xc101[257],4),this[_0xc101[281]][_0xc101[89]](_0xc101[261],3),this[_0xc101[281]][_0xc101[89]](_0xc101[262],3),this[_0xc101[281]][_0xc101[89]](_0xc101[263],16),this[_0xc101[281]][_0xc101[5]]()},i[_0xc101[4]][_0xc101[282]]=function(){this[_0xc101[283]]&&this[_0xc101[164]]&&this[_0xc101[164]][_0xc101[165]]&&this[_0xc101[283]][_0xc101[134]](_0xc101[269],null),n[_0xc101[4]][_0xc101[282]][_0xc101[19]](this)},i[_0xc101[4]][_0xc101[284]]=function(t,e,n){var i=this[_0xc101[178]](),r=n[_0xc101[176]],s=n[_0xc101[177]];s&&(this[_0xc101[283]]=r,this[_0xc101[285]](t),BABYLON[_0xc101[219]].BindBonesParameters(e,r),this._mustRebind(i,r,e[_0xc101[286]])&&(this[_0xc101[281]][_0xc101[150]](r,_0xc101[273]),this[_0xc101[287]](r),this[_0xc101[281]][_0xc101[288]]&&this[_0xc101[174]]&&this[_0xc101[281]][_0xc101[289]]||(s[_0xc101[43]]&&this[_0xc101[281]][_0xc101[295]](_0xc101[257],new BABYLON.Color3(this[_0xc101[169]][_0xc101[291]][_0xc101[290]](),this[_0xc101[169]][_0xc101[292]][_0xc101[290]](),this[_0xc101[169]][_0xc101[293]]),this[_0xc101[169]][_0xc101[294]]),i[_0xc101[187]]&&(s[_0xc101[27]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[229],this[_0xc101[83]][_0xc101[296]],this[_0xc101[83]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[230],this[_0xc101[83]][_0xc101[299]]())),s[_0xc101[28]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[231],this[_0xc101[191]][_0xc101[296]],1/this[_0xc101[191]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[232],this[_0xc101[191]][_0xc101[299]]())),s[_0xc101[29]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[234],this[_0xc101[192]][_0xc101[296]],this[_0xc101[192]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[235],this[_0xc101[192]][_0xc101[299]]())),s[_0xc101[30]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[237],this[_0xc101[193]][_0xc101[296]],this[_0xc101[193]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[238],this[_0xc101[193]][_0xc101[299]]())),s[_0xc101[31]]&&(this[_0xc101[281]][_0xc101[301]](_0xc101[240],this[_0xc101[164]][_0xc101[297]]),this[_0xc101[281]][_0xc101[301]](_0xc101[259],Math[_0xc101[306]](Math[_0xc101[304]](this[_0xc101[164]][_0xc101[303]]()[_0xc101[302]])*Math[_0xc101[305]])),s[_0xc101[32]]&&(this[_0xc101[281]][_0xc101[307]](_0xc101[241],this._parallaxReflectionCenter),this[_0xc101[281]][_0xc101[307]](_0xc101[242],this._parallaxReflectionBBoxMin),this[_0xc101[281]][_0xc101[307]](_0xc101[243],this._parallaxReflectionBBoxMax))),s[_0xc101[33]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[244],this[_0xc101[168]][_0xc101[296]],this[_0xc101[168]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[245],this[_0xc101[168]][_0xc101[299]]())),s[_0xc101[35]]?(this[_0xc101[281]][_0xc101[144]](_0xc101[247],this[_0xc101[198]][_0xc101[296]],this[_0xc101[198]][_0xc101[297]],this._aoPower),this[_0xc101[281]][_0xc101[300]](_0xc101[248],this[_0xc101[198]][_0xc101[299]]()),s[_0xc101[36]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[246],1-this[_0xc101[65]])):s[_0xc101[37]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[249],this._aoPower),s[_0xc101[39]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[250],this[_0xc101[199]][_0xc101[297]]),s[_0xc101[40]]&&(this[_0xc101[281]][_0xc101[301]](_0xc101[251],this[_0xc101[200]][_0xc101[297]]),this[_0xc101[281]][_0xc101[301]](_0xc101[259],Math[_0xc101[306]](Math[_0xc101[304]](this[_0xc101[200]][_0xc101[303]]()[_0xc101[302]])*Math[_0xc101[305]])))),s[_0xc101[44]]&&(this[_0xc101[281]][_0xc101[156]](_0xc101[252],this._rimColor),this[_0xc101[281]][_0xc101[298]](_0xc101[253],this._rimPower,this[_0xc101[64]]||0)),s[_0xc101[45]]&&this[_0xc101[281]][_0xc101[298]](_0xc101[254],this[_0xc101[66]]||1,this[_0xc101[67]]||1),this[_0xc101[281]][_0xc101[295]](_0xc101[228],this._albedoColor,this[_0xc101[167]]*e[_0xc101[286]]),this[_0xc101[281]][_0xc101[156]](_0xc101[239],this._reflectionColor),this[_0xc101[281]][_0xc101[156]](_0xc101[258],this._specularColor),this[_0xc101[281]][_0xc101[301]](_0xc101[233],this._reflectivity),this[_0xc101[281]][_0xc101[301]](_0xc101[236],this._microsurface),this[_0xc101[281]][_0xc101[301]](_0xc101[255],this._glossiness),this[_0xc101[281]][_0xc101[301]](_0xc101[256],this._ambientLight)),this[_0xc101[281]][_0xc101[307]](_0xc101[261],this._grayWeights),this[_0xc101[281]][_0xc101[307]](_0xc101[262],this._lumCoeff),this[_0xc101[281]][_0xc101[300]](_0xc101[263],this._renderMatrix),i[_0xc101[187]]&&(s[_0xc101[27]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[264],this._albedoTexture),s[_0xc101[28]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[265],this._bumpTexture),s[_0xc101[29]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[266],this._reflectivityTexture),s[_0xc101[30]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[267],this._microsurfaceTexture),s[_0xc101[31]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[269],this._reflectionTexture),s[_0xc101[33]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[271],this._opacityTexture),(s[_0xc101[35]]||s[_0xc101[37]])&&this[_0xc101[281]][_0xc101[134]](_0xc101[272],this._aoTexture),s[_0xc101[38]]&&(s[_0xc101[39]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[270],this._ambientTexture),s[_0xc101[40]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[268],this._matCapReflectionTexture))),r[_0xc101[309]](_0xc101[227],i[_0xc101[308]][_0xc101[145]])),(this._mustRebind(i,r)||!this[_0xc101[174]])&&(s[_0xc101[20]]&&this._bindLights(i,e,r,this._maxSimultaneousLights,s),s[_0xc101[38]]&&this[_0xc101[310]](r)),this[_0xc101[281]][_0xc101[158]](),this._afterBind(e,this._activeEffect))},i[_0xc101[4]][_0xc101[311]]=function(t,e){e&&(this[_0xc101[83]]&&(this[_0xc101[83]][_0xc101[311]](),this[_0xc101[83]]=null),this[_0xc101[191]]&&(this[_0xc101[191]][_0xc101[311]](),this[_0xc101[191]]=null),this[_0xc101[192]]&&(this[_0xc101[192]][_0xc101[311]](),this[_0xc101[192]]=null),this[_0xc101[193]]&&(this[_0xc101[193]][_0xc101[311]](),this[_0xc101[193]]=null),this[_0xc101[164]]&&(this[_0xc101[164]][_0xc101[311]](),this[_0xc101[164]]=null),this[_0xc101[168]]&&(this[_0xc101[168]][_0xc101[311]](),this[_0xc101[168]]=null),this[_0xc101[198]]&&(this[_0xc101[198]][_0xc101[311]](),this[_0xc101[198]]=null),this[_0xc101[199]]&&(this[_0xc101[199]][_0xc101[311]](),this[_0xc101[199]]=null),this[_0xc101[200]]&&(this[_0xc101[200]][_0xc101[311]](),this[_0xc101[200]]=null)),n[_0xc101[4]][_0xc101[311]][_0xc101[19]](this,t,e)},i[_0xc101[4]][_0xc101[312]]=function(){var t=n[_0xc101[4]][_0xc101[312]][_0xc101[19]](this);return this[_0xc101[83]]&&t[_0xc101[125]](this._albedoTexture),this[_0xc101[191]]&&t[_0xc101[125]](this._bumpTexture),this[_0xc101[192]]&&t[_0xc101[125]](this._reflectivityTexture),this[_0xc101[193]]&&t[_0xc101[125]](this._microsurfaceTexture),this[_0xc101[164]]&&t[_0xc101[125]](this._reflectionTexture),this[_0xc101[168]]&&t[_0xc101[125]](this._opacityTexture),this[_0xc101[198]]&&t[_0xc101[125]](this._aoTexture),this[_0xc101[199]]&&t[_0xc101[125]](this._ambientTexture),this[_0xc101[200]]&&t[_0xc101[125]](this._matCapReflectionTexture),t},i[_0xc101[4]][_0xc101[313]]=function(t){return!!n[_0xc101[4]][_0xc101[313]][_0xc101[19]](this,t)||this[_0xc101[83]]===t||this[_0xc101[191]]===t||this[_0xc101[192]]===t||this[_0xc101[193]]===t||this[_0xc101[164]]===t||this[_0xc101[168]]===t||this[_0xc101[198]]===t||this[_0xc101[199]]===t||this[_0xc101[200]]===t},i[_0xc101[4]][_0xc101[314]]=function(t){var e=this,n=BABYLON[_0xc101[315]].Clone(function(){return new Zakeke.PBRMaterial(t,e[_0xc101[178]]())},this);return n[_0xc101[316]]=t,n[_0xc101[223]]=t,n},i[_0xc101[4]][_0xc101[317]]=function(e){var n=this,i=BABYLON[_0xc101[315]].Clone(function(){return new t.PBRBlendMaterial(e,n[_0xc101[178]]())},this);return i[_0xc101[223]]=e,i[_0xc101[316]]=e,i},i[_0xc101[4]][_0xc101[318]]=function(){var t=BABYLON[_0xc101[315]].Serialize(this);return t[_0xc101[319]]=_0xc101[161],t},i[_0xc101[320]]=function(t,e,n){return BABYLON[_0xc101[315]].Parse(function(){return new Zakeke.PBRMaterial(t[_0xc101[223]],e)},t,e,n)},i}(BABYLON.PushMaterial);__decorate([BABYLON[_0xc101[322]](_0xc101[321])],n[_0xc101[4]],_0xc101[54],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[54])],n[_0xc101[4]],_0xc101[321],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[324])],n[_0xc101[4]],_0xc101[55],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[55])],n[_0xc101[4]],_0xc101[324],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[325])],n[_0xc101[4]],_0xc101[56],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[56])],n[_0xc101[4]],_0xc101[325],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[326])],n[_0xc101[4]],_0xc101[57],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[57])],n[_0xc101[4]],_0xc101[326],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[327])],n[_0xc101[4]],_0xc101[58],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[58])],n[_0xc101[4]],_0xc101[327],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[58])],n[_0xc101[4]],_0xc101[328],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[329])],n[_0xc101[4]],_0xc101[62],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[62])],n[_0xc101[4]],_0xc101[329],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[330])],n[_0xc101[4]],_0xc101[64],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[64])],n[_0xc101[4]],_0xc101[330],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[81])],n[_0xc101[4]],_0xc101[68],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[331])],n[_0xc101[4]],_0xc101[83],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[83])],n[_0xc101[4]],_0xc101[331],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[333])],n[_0xc101[4]],_0xc101[191],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[191])],n[_0xc101[4]],_0xc101[333],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[334])],n[_0xc101[4]],_0xc101[192],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[192])],n[_0xc101[4]],_0xc101[334],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[335])],n[_0xc101[4]],_0xc101[59],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[59])],n[_0xc101[4]],_0xc101[335],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[336])],n[_0xc101[4]],_0xc101[193],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[193])],n[_0xc101[4]],_0xc101[336],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[337])],n[_0xc101[4]],_0xc101[60],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[60])],n[_0xc101[4]],_0xc101[337],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[338])],n[_0xc101[4]],_0xc101[164],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[164])],n[_0xc101[4]],_0xc101[338],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[339])],n[_0xc101[4]],_0xc101[194],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[194])],n[_0xc101[4]],_0xc101[339],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[341])],n[_0xc101[4]],_0xc101[195],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[195])],n[_0xc101[4]],_0xc101[341],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[342])],n[_0xc101[4]],_0xc101[196],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[196])],n[_0xc101[4]],_0xc101[342],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[343])],n[_0xc101[4]],_0xc101[168],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[168])],n[_0xc101[4]],_0xc101[343],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[344])],n[_0xc101[4]],_0xc101[198],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[198])],n[_0xc101[4]],_0xc101[344],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[198])],n[_0xc101[4]],_0xc101[345],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[346])],n[_0xc101[4]],_0xc101[61],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[61])],n[_0xc101[4]],_0xc101[346],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[61])],n[_0xc101[4]],_0xc101[347],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[348])],n[_0xc101[4]],_0xc101[65],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[65])],n[_0xc101[4]],_0xc101[348],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[65])],n[_0xc101[4]],_0xc101[349],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[350])],n[_0xc101[4]],_0xc101[199],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[199])],n[_0xc101[4]],_0xc101[351],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[199])],n[_0xc101[4]],_0xc101[350],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[352])],n[_0xc101[4]],_0xc101[200],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[200])],n[_0xc101[4]],_0xc101[352],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[353])],n[_0xc101[4]],_0xc101[69],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[69])],n[_0xc101[4]],_0xc101[353],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[354])],n[_0xc101[4]],_0xc101[70],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[70])],n[_0xc101[4]],_0xc101[354],void 0),__decorate([BABYLON[_0xc101[356]](_0xc101[355])],n[_0xc101[4]],_0xc101[169],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[357],_0xc101[169])],n[_0xc101[4]],_0xc101[355],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[358])],n[_0xc101[4]],_0xc101[63],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[63])],n[_0xc101[4]],_0xc101[358],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[360])],n[_0xc101[4]],_0xc101[66],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[66])],n[_0xc101[4]],_0xc101[360],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[361])],n[_0xc101[4]],_0xc101[67],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[67])],n[_0xc101[4]],_0xc101[361],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[362])],n[_0xc101[4]],_0xc101[71],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[80],_0xc101[71])],n[_0xc101[4]],_0xc101[362],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[363])],n[_0xc101[4]],_0xc101[72],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[80],_0xc101[72])],n[_0xc101[4]],_0xc101[363],void 0),t[_0xc101[364]]=n,t[_0xc101[365]]=e}}(Zakeke||(Zakeke={})),function(t){t[_0xc101[12]][_0xc101[366]]=function(){t[_0xc101[12]].DefinePBRMaterial()}}(Zakeke||(Zakeke={})),Zakeke[_0xc101[17]]={zk_pbrPixelShader:_0xc101[367],zk_pbrVertexShader:_0xc101[368]},Zakeke[_0xc101[15]]={zk_n8Q2Bzi9LXc5p6RG:_0xc101[369],zk_pbrFragmentDeclaration:_0xc101[370],zk_pbrLightFragmentDeclaration:_0xc101[371],zk_w8NZg34MyJx59GeB:_0xc101[372],zk_Dp84Pxj2MTr7q6FW:_0xc101[373],zk_pbrLightUboDeclaration:_0xc101[374],zk_g9X4Qdz2LJb67MyT:_0xc101[375],zk_Ar2w4FRs58Jpc3W6:_0xc101[376],zk_Gi39AdTg7y5B2JfL:_0xc101[377],zk_pbrVertexDeclaration:_0xc101[378],zk_pbrUboDeclaration:_0xc101[379]},function(t){!function(t){!function(t){!function(t){var e,n=BABYLON.Axis,i=BABYLON.Color3,r=BABYLON.Matrix,s=BABYLON.Mesh,a=BABYLON.MeshBuilder,o=BABYLON.Path2,l=BABYLON.Quaternion,h=BABYLON.Space,c=BABYLON.StandardMaterial,u=BABYLON.Vector3;!function(t){t[t.TRANS=0]="TRANS",t[t.ROT=1]="ROT",t[t.SCALE=2]="SCALE"}(e||(e={}));var d=function(){function t(t,e,n,i,a,o){var h=this;this._local=!0,this._snapT=!1,this._snapR=!1,this._transSnap=1,this._rotSnap=Math.PI/18,this._axesLen=.4,this._axesScale=1,this._pickWidth=.02,this._visibility=.75,this._ecMatrix=new r,this._ecTOcamera=new u(0,0,0),this._distFromCamera=2,this._cameraTOec=new u(0,0,0),this._cameraNormal=new u(0,0,0),this._prevState="",this._hidden=!1,this._actionListener=null,this._actionStartListener=null,this._actionEndListener=null,this._pDown=!1,this._pointerIsOver=!1,this._editing=!1,this._rotate2=!1,this._transBy=new u(0,0,0),this._snapTV=new u(0,0,0),this._snapS=!1,this._snapSV=new u(0,0,0),this._scaleSnap=.25,this._scale=new u(0,0,0),this._localX=new u(0,0,0),this._localY=new u(0,0,0),this._localZ=new u(0,0,0),this._eulerian=!1,this._snapRA=0,this._transEnabled=!1,this._rotEnabled=!1,this._scaleEnabled=!1,this._guideSize=180,this._tSnap=new u(this._transSnap,this._transSnap,this._transSnap),this._tv1=new u(0,0,0),this._tv2=new u(0,0,0),this._tv3=new u(0,0,0),this._tm=new r,this._mesh=t,this._mainCamera=e,this._canvas=n,null!=i&&(this._axesScale=i),this._eulerian=null!==a&&a,this._checkQuaternion(),null!=o&&(this._pickWidth=o),this._scene=t.getScene(),this._actHist=new p(t,10),t.computeWorldMatrix(!0),this._boundingDimesion=this._getBoundingDimension(t),this._setLocalAxes(t),this._ecRoot=new s("EditControl",this._scene),this._ecRoot.metadata={isEditControl:!0,isRealMesh:!1},this._ecRoot.rotationQuaternion=l.Identity(),this._ecRoot.visibility=0,this._ecRoot.isPickable=!1,this._createMaterials(this._scene);var c=this._createCommonAxes();c.parent=this._ecRoot,c.metadata={isEditControl:!0,isRealMesh:!1};var d=this._createPickPlanes();d.parent=this._ecRoot,d.metadata={isEditControl:!0,isRealMesh:!1},this._pointerdown=function(t){return h._onPointerDown(t)},this._pointerup=function(t){return h._onPointerUp(t)},this._pointermove=function(t){return h._onPointerMove(t)},n.addEventListener("pointerdown",this._pointerdown,!1),n.addEventListener("pointerup",this._pointerup,!1),n.addEventListener("pointermove",this._pointermove,!1),this._renderer=function(){return h._renderLoopProcess()},this._scene.registerBeforeRender(this._renderer)}return t.prototype._centerMeshPivot=function(t){var e=this._getMeshHierarchyCenter(t);if(e){var n=e.clone(),i=t.position.subtract(n);t.setPivotMatrix(BABYLON.Matrix.Translation(i.x,i.y,i.z))}},t.prototype._getMeshHierarchyCenter=function(t){if(t){var e=t.getHierarchyBoundingVectors(!0),n=e.max.subtract(e.min);return e.min.add(n.scale(.5))}return null},t.prototype._checkQuaternion=function(){if(!this._eulerian&&(null==this._mesh.rotationQuaternion||null==this._mesh.rotationQuaternion))throw"Error: Eulerian is set to false but the mesh's rotationQuaternion is not set."},t.prototype._renderLoopProcess=function(){this._ecRoot.position=this._mesh.getAbsolutePivotPoint(),this._setECRotation(),this._setECScale(),this._local?(this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera),this._pALL.lookAt(this._ecTOcamera,0,0,0,h.LOCAL)):(this._mainCamera.position.subtractToRef(this._ecRoot.position,this._ecTOcamera),this._pALL.lookAt(this._mainCamera.position,0,0,0,h.WORLD)),this._rotEnabled?this._rotRotGuides():this._transEnabled?this._rotPlanarGuides(this._tXZ,this._tZY,this._tYX):this._scaleEnabled&&this._rotPlanarGuides(this._sXZ,this._sZY,this._sYX)},t.prototype._setECRotation=function(){if(this._local)if(null==this._mesh.parent)if(this._eulerian){var t=this._mesh.rotation;l.RotationYawPitchRollToRef(t.y,t.x,t.z,this._ecRoot.rotationQuaternion)}else this._ecRoot.rotationQuaternion.copyFrom(this._mesh.rotationQuaternion);else{if(this._isScaleUnEqual(this._mesh))return;this._mesh.getWorldMatrix().getRotationMatrixToRef(this._tm),l.FromRotationMatrixToRef(this._tm,this._ecRoot.rotationQuaternion)}},t.prototype._isScaleUnEqual=function(t){if(null==t.parent)return!1;for(;null!=t.parent;){if(t.parent.scaling.x!=t.parent.scaling.y||t.parent.scaling.y!=t.parent.scaling.z)return!0;t=t.parent}return!1},t.prototype._setECScale=function(){this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),u.FromFloatArrayToRef(this._mainCamera.getWorldMatrix().asArray(),8,this._cameraNormal);var t=u.Dot(this._cameraTOec,this._cameraNormal)/this._cameraNormal.length(),e=Math.abs(t/this._distFromCamera);u.FromFloatsToRef(e,e,e,this._ecRoot.scaling)},t.prototype._rotRotGuides=function(){var t=Math.atan(this._ecTOcamera.y/this._ecTOcamera.z);this._ecTOcamera.z>=0?this._rX.rotation.x=-t:this._rX.rotation.x=-t-Math.PI;var e=Math.atan(this._ecTOcamera.x/this._ecTOcamera.z);this._ecTOcamera.z>=0?this._rY.rotation.y=e:this._rY.rotation.y=e+Math.PI;var n=Math.atan(this._ecTOcamera.x/this._ecTOcamera.y);this._ecTOcamera.y>=0?this._rZ.rotation.z=-n:this._rZ.rotation.z=-n-Math.PI},t.prototype._rotPlanarGuides=function(t,e,n){var i=this._ecTOcamera;t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,e.rotation.x=0,e.rotation.y=0,e.rotation.z=0,n.rotation.x=0,n.rotation.y=0,n.rotation.z=0,i.x<=0&&i.y>=0&&i.z>=0?(t.rotation.z=3.14,n.rotation.y=3.14):i.x<=0&&i.y>=0&&i.z<=0?(t.rotation.y=3.14,e.rotation.y=3.14,n.rotation.y=3.14):i.x>=0&&i.y>=0&&i.z<=0?(t.rotation.x=3.14,e.rotation.y=3.14):i.x>=0&&i.y<=0&&i.z>=0?(e.rotation.z=3.14,n.rotation.x=3.14):i.x<=0&&i.y<=0&&i.z>=0?(t.rotation.z=3.14,e.rotation.z=3.14,n.rotation.z=3.14):i.x<=0&&i.y<=0&&i.z<=0?(t.rotation.y=3.14,e.rotation.x=3.14,n.rotation.z=3.14):i.x>=0&&i.y<=0&&i.z<=0&&(t.rotation.x=3.14,e.rotation.x=3.14,n.rotation.x=3.14)},t.prototype.switchTo=function(t,e){t.computeWorldMatrix(!0),this._mesh=t,null!=e&&(this._eulerian=e),this._checkQuaternion(),this._setLocalAxes(t),this._actHist=new p(t,10),this.refreshBoundingInfo()},t.prototype.setUndoCount=function(t){this._actHist.setCapacity(t)},t.prototype.undo=function(){var t=this._actHist.undo();this._mesh.computeWorldMatrix(!0),this._setLocalAxes(this._mesh),this._callActionStartListener(t),this._callActionListener(t),this._callActionEndListener(t)},t.prototype.redo=function(){var t=this._actHist.redo();this._mesh.computeWorldMatrix(!0),this._setLocalAxes(this._mesh),this._callActionStartListener(t),this._callActionListener(t),this._callActionEndListener(t)},t.prototype.detach=function(){this._canvas.removeEventListener("pointerdown",this._pointerdown,!1),this._canvas.removeEventListener("pointerup",this._pointerup,!1),this._canvas.removeEventListener("pointermove",this._pointermove,!1),this._scene.unregisterBeforeRender(this._renderer),this.removeAllActionListeners(),this._disposeAll()},t.prototype.hide=function(){this._hidden=!0,this._transEnabled?(this._prevState="T",this.disableTranslation()):this._rotEnabled?(this._prevState="R",this.disableRotation()):this._scaleEnabled&&(this._prevState="S",this.disableScaling()),this._hideCommonAxes()},t.prototype._hideCommonAxes=function(){this._xaxis.visibility=0,this._yaxis.visibility=0,this._zaxis.visibility=0},t.prototype._showCommonAxes=function(){this._xaxis.visibility=this._visibility,this._yaxis.visibility=this._visibility,this._zaxis.visibility=this._visibility},t.prototype.show=function(){this._hidden=!1,this._showCommonAxes(),"T"==this._prevState?this.enableTranslation():"R"==this._prevState?this.enableRotation():"S"==this._prevState&&this.enableScaling()},t.prototype.isHidden=function(){return this._hidden},t.prototype._disposeAll=function(){this._ecRoot.dispose(),this._disposeMaterials(),this._actHist=null},t.prototype.addActionListener=function(t){this._actionListener=t},t.prototype.removeActionListener=function(){this._actionListener=null},t.prototype.addActionStartListener=function(t){this._actionStartListener=t},t.prototype.removeActionStartListener=function(){this._actionStartListener=null},t.prototype.addActionEndListener=function(t){this._actionEndListener=t},t.prototype.removeActionEndListener=function(){this._actionEndListener=null},t.prototype.removeAllActionListeners=function(){this._actionListener=null,this._actionStartListener=null,this._actionEndListener=null},t.prototype._onPointerDown=function(t){var e=this;if(t.preventDefault(),this._pDown=!0,0==t.button){var n=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(t){if(e._transEnabled){if(t==e._tX||t==e._tY||t==e._tZ||t==e._tXZ||t==e._tZY||t==e._tYX||t==e._tAll)return!0}else if(e._rotEnabled){if(t==e._rX||t==e._rY||t==e._rZ||t==e._rAll)return!0}else if(e._scaleEnabled&&(t==e._sX||t==e._sY||t==e._sZ||t==e._sXZ||t==e._sZY||t==e._sYX||t==e._sAll))return!0;return!1},null,this._mainCamera);if(n.hit){this._axisPicked=n.pickedMesh;var i=this._axisPicked.getChildren();i.length>0?i[0].visibility=this._visibility:this._axisPicked.visibility=this._visibility;var r=this._axisPicked.name;"X"==r?this._bXaxis.visibility=1:"Y"==r?this._bYaxis.visibility=1:"Z"==r?this._bZaxis.visibility=1:"XZ"==r?(this._bXaxis.visibility=1,this._bZaxis.visibility=1):"ZY"==r?(this._bZaxis.visibility=1,this._bYaxis.visibility=1):"YX"==r?(this._bYaxis.visibility=1,this._bXaxis.visibility=1):"ALL"==r&&(this._bXaxis.visibility=1,this._bYaxis.visibility=1,this._bZaxis.visibility=1),this._setEditing(!0),this._pickedPlane=this._getPickPlane(this._axisPicked),null!=this._pickedPlane?this._prevPos=this._getPosOnPickPlane():this._prevPos=null,window.setTimeout(function(t,n){return e._detachCamera(t,n)},0,this._mainCamera,this._canvas)}}},t.prototype._setEditing=function(t){this._editing=t,t?(this._setActionType(),this._actionType==e.ROT&&(this._snapRA=0),this._callActionStartListener(this._actionType)):this._callActionEndListener(this._actionType)},t.prototype.isEditing=function(){return this._editing},t.prototype._detachCamera=function(t,e){var n=e;t.detachControl(n)},t.prototype.isPointerOver=function(){return this._pointerIsOver},t.prototype._onPointerOver=function(){var t=this,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(e){if(t._transEnabled){if(e==t._tX||e==t._tY||e==t._tZ||e==t._tXZ||e==t._tZY||e==t._tYX||e==t._tAll)return!0}else if(t._rotEnabled){if(e==t._rX||e==t._rY||e==t._rZ||e==t._rAll)return!0}else if(t._scaleEnabled&&(e==t._sX||e==t._sY||e==t._sZ||e==t._sXZ||e==t._sZY||e==t._sYX||e==t._sAll))return!0;return!1},null,this._mainCamera);if(e.hit){if(e.pickedMesh!=this._prevOverMesh){if(this._pointerIsOver=!0,this._clearPrevOverMesh(),this._prevOverMesh=e.pickedMesh,this._rotEnabled)this._savedCol=this._prevOverMesh.getChildren()[0].color,this._prevOverMesh.getChildren()[0].color=i.White();else{var n=this._prevOverMesh.getChildren();n.length>0?(this._savedMat=n[0].material,n[0].material=this._whiteMat):(this._savedMat=this._prevOverMesh.material,this._prevOverMesh.material=this._whiteMat)}"X"==this._prevOverMesh.name?this._xaxis.color=i.White():"Y"==this._prevOverMesh.name?this._yaxis.color=i.White():"Z"==this._prevOverMesh.name&&(this._zaxis.color=i.White())}}else this._pointerIsOver=!1,null!=this._prevOverMesh&&(this._restoreColor(this._prevOverMesh),this._prevOverMesh=null)},t.prototype._clearPrevOverMesh=function(){null!=this._prevOverMesh&&(this._prevOverMesh.visibility=0,this._restoreColor(this._prevOverMesh))},t.prototype._restoreColor=function(t){switch(t.name){case"X":this._xaxis.color=i.Red();break;case"Y":this._yaxis.color=i.Green();break;case"Z":this._zaxis.color=i.Blue()}if(this._rotEnabled)t.getChildren()[0].color=this._savedCol;else{var e=t.getChildren();e.length>0?e[0].material=this._savedMat:t.material=this._savedMat}},t.prototype._onPointerUp=function(t){this._pDown=!1,this._editing&&(this._mainCamera.attachControl(this._canvas),this._setEditing(!1),this._hideBaxis(),null!=this._prevOverMesh&&(this._restoreColor(this._prevOverMesh),this._prevOverMesh=null),this._actHist.add(this._actionType))},t.prototype._setActionType=function(){this._transEnabled?this._actionType=e.TRANS:this._rotEnabled?this._actionType=e.ROT:this._scaleEnabled&&(this._actionType=e.SCALE)},t.prototype._callActionListener=function(t){null!=this._actionListener&&this._actionListener(t)},t.prototype._callActionStartListener=function(t){null!=this._actionStartListener&&this._actionStartListener(t)},t.prototype._callActionEndListener=function(t){null!=this._actionEndListener&&this._actionEndListener(t)},t.prototype._onPointerMove=function(t){if(this._pDown){if(this._editing&&null!=this._prevPos){var e=this._getPosOnPickPlane();if(null!=e){if(this._rotEnabled)this._doRotation(this._mesh,this._axisPicked,e,this._prevPos);else{var n=e.subtract(this._prevPos);if(0==n.x&&0==n.y&&0==n.z)return;this._transEnabled?this._doTranslation(n):this._scaleEnabled&&this._local&&this._doScaling(n)}this._prevPos=e,this._callActionListener(this._actionType)}}}else this._onPointerOver()},t.prototype._getPickPlane=function(t){var e=t.name;if(this._transEnabled||this._scaleEnabled){if("XZ"==e)return this._pXZ;if("ZY"==e)return this._pZY;if("YX"==e)return this._pYX;if("ALL"==e)return this._pALL;this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera);var n=this._ecTOcamera;if("X"===e)return Math.abs(n.y)>Math.abs(n.z)?this._pXZ:this._pYX;if("Z"===e)return Math.abs(n.y)>Math.abs(n.x)?this._pXZ:this._pZY;if("Y"===e)return Math.abs(n.z)>Math.abs(n.x)?this._pYX:this._pZY}else{if(!this._rotEnabled)return null;switch(this._rotate2=!1,this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera),n=this._ecTOcamera,e){case"X":return Math.abs(n.x)<.2?(this._rotate2=!0,this._pALL):this._pZY;case"Y":return Math.abs(n.y)<.2?(this._rotate2=!0,this._pALL):this._pXZ;case"Z":return Math.abs(n.z)<.2?(this._rotate2=!0,this._pALL):this._pYX;default:return this._pALL}}},t.prototype._doTranslation=function(t){null!=this._mesh.parent&&this._isScaleUnEqual(this._mesh)?this._setLocalAxes(this._ecRoot):this._setLocalAxes(this._mesh);var e=this._axisPicked.name;"ALL"==e?this._transBy=t:(this._transBy.x=0,this._transBy.y=0,this._transBy.z=0,"X"!=e&&"XZ"!=e&&"YX"!=e||(this._local?this._transBy.x=u.Dot(t,this._localX)/this._localX.length():this._transBy.x=t.x),"Y"!=e&&"ZY"!=e&&"YX"!=e||(this._local?this._transBy.y=u.Dot(t,this._localY)/this._localY.length():this._transBy.y=t.y),"Z"!=e&&"XZ"!=e&&"ZY"!=e||(this._local?this._transBy.z=u.Dot(t,this._localZ)/this._localZ.length():this._transBy.z=t.z)),this._transWithSnap(this._mesh,this._transBy,this._local),this._transBoundsMin&&(this._mesh.position.x=Math.max(this._mesh.position.x,this._transBoundsMin.x),this._mesh.position.y=Math.max(this._mesh.position.y,this._transBoundsMin.y),this._mesh.position.z=Math.max(this._mesh.position.z,this._transBoundsMin.z)),this._transBoundsMax&&(this._mesh.position.x=Math.min(this._mesh.position.x,this._transBoundsMax.x),this._mesh.position.y=Math.min(this._mesh.position.y,this._transBoundsMax.y),this._mesh.position.z=Math.min(this._mesh.position.z,this._transBoundsMax.z)),this._mesh.computeWorldMatrix(!0)},t.prototype._transWithSnap=function(t,e,n){if(this._snapT){var i=!1;if(this._snapTV.addInPlace(e),Math.abs(this._snapTV.x)>this._tSnap.x&&(this._snapTV.x>0?e.x=this._tSnap.x:e.x=-this._tSnap.x,i=!0),Math.abs(this._snapTV.y)>this._tSnap.y&&(this._snapTV.y>0?e.y=this._tSnap.y:e.y=-this._tSnap.y,i=!0),Math.abs(this._snapTV.z)>this._tSnap.z&&(this._snapTV.z>0?e.z=this._tSnap.z:e.z=-this._tSnap.z,i=!0),!i)return;Math.abs(e.x)!==this._tSnap.x&&(e.x=0),Math.abs(e.y)!==this._tSnap.y&&(e.y=0),Math.abs(e.z)!==this._tSnap.z&&(e.z=0),u.FromFloatsToRef(0,0,0,this._snapTV),i=!1}n?(this._localX.normalizeToRef(this._tv1),this._localY.normalizeToRef(this._tv2),this._localZ.normalizeToRef(this._tv3),this._mesh.translate(this._tv1,e.x,h.WORLD),this._mesh.translate(this._tv2,e.y,h.WORLD),this._mesh.translate(this._tv3,e.z,h.WORLD)):null==this._mesh.parent?this._mesh.position.addInPlace(e):this._mesh.setAbsolutePosition(e.addInPlace(this._mesh.absolutePosition))},t.prototype._doScaling=function(t){this._setLocalAxes(this._mesh),this._scale.x=0,this._scale.y=0,this._scale.z=0;var e=this._axisPicked.name;"X"!=e&&"XZ"!=e&&"YX"!=e||(this._scale.x=u.Dot(t,this._localX)/this._localX.length(),this._mesh.scaling.x<0&&(this._scale.x=-this._scale.x)),"Y"!=e&&"ZY"!=e&&"YX"!=e||(this._scale.y=u.Dot(t,this._localY)/this._localY.length(),this._mesh.scaling.y<0&&(this._scale.y=-this._scale.y)),"Z"!=e&&"XZ"!=e&&"ZY"!=e||(this._scale.z=u.Dot(t,this._localZ)/this._localZ.length(),this._mesh.scaling.z<0&&(this._scale.z=-this._scale.z));var n=this._boundingDimesion;if(this._scale.x=this._scale.x/n.x,this._scale.y=this._scale.y/n.y,this._scale.z=this._scale.z/n.z,"ALL"==e){var i=u.Dot(t,this._mainCamera.upVector);i/=Math.max(n.x,n.y,n.z),this._scale.copyFromFloats(i,i,i)}else{var r=!1;"XZ"==e?(r=!0,Math.abs(this._scale.x)>Math.abs(this._scale.z)?this._scale.z=this._scale.x:this._scale.x=this._scale.z):"ZY"==e?(r=!0,Math.abs(this._scale.z)>Math.abs(this._scale.y)?this._scale.y=this._scale.z:this._scale.z=this._scale.y):"YX"==e&&(r=!0,Math.abs(this._scale.y)>Math.abs(this._scale.x)?this._scale.x=this._scale.y:this._scale.y=this._scale.x),r&&(this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),i=u.Dot(t,this._cameraTOec),this._scale.x=Math.abs(this._scale.x),this._scale.y=Math.abs(this._scale.y),this._scale.z=Math.abs(this._scale.z),i>0?(this._mesh.scaling.x>0&&(this._scale.x=-this._scale.x),this._mesh.scaling.y>0&&(this._scale.y=-this._scale.y),this._mesh.scaling.z>0&&(this._scale.z=-this._scale.z)):(this._mesh.scaling.x<0&&(this._scale.x=-this._scale.x),this._mesh.scaling.y<0&&(this._scale.y=-this._scale.y),this._mesh.scaling.z<0&&(this._scale.z=-this._scale.z)))}this._scaleWithSnap(this._mesh,this._scale),this._scaleBoundsMin&&(this._mesh.scaling.x=Math.max(this._mesh.scaling.x,this._scaleBoundsMin.x),this._mesh.scaling.y=Math.max(this._mesh.scaling.y,this._scaleBoundsMin.y),this._mesh.scaling.z=Math.max(this._mesh.scaling.z,this._scaleBoundsMin.z)),this._scaleBoundsMax&&(this._mesh.scaling.x=Math.min(this._mesh.scaling.x,this._scaleBoundsMax.x),this._mesh.scaling.y=Math.min(this._mesh.scaling.y,this._scaleBoundsMax.y),this._mesh.scaling.z=Math.min(this._mesh.scaling.z,this._scaleBoundsMax.z))},t.prototype._scaleWithSnap=function(t,e){if(this._snapS){var n=!1;if(this._snapSV.addInPlace(e),Math.abs(this._snapSV.x)>this._scaleSnap&&(e.x>0?e.x=this._scaleSnap:e.x=-this._scaleSnap,n=!0),Math.abs(this._snapSV.y)>this._scaleSnap&&(e.y>0?e.y=this._scaleSnap:e.y=-this._scaleSnap,n=!0),Math.abs(this._snapSV.z)>this._scaleSnap&&(e.z>0?e.z=this._scaleSnap:e.z=-this._scaleSnap,n=!0),!n)return;Math.abs(e.x)!==this._scaleSnap&&0!==e.x&&(e.x=0),Math.abs(e.y)!==this._scaleSnap&&0!==e.y&&(e.y=0),Math.abs(e.z)!==this._scaleSnap&&0!==e.z&&(e.z=0),u.FromFloatsToRef(0,0,0,this._snapSV),n=!1}t.scaling.addInPlace(e)},t.prototype._setLocalAxes=function(t){var e=t.getWorldMatrix();u.FromFloatArrayToRef(e.m,0,this._localX),u.FromFloatArrayToRef(e.m,4,this._localY),u.FromFloatArrayToRef(e.m,8,this._localZ)},t.prototype._getBoundingDimension=function(t){var e=t.getBoundingInfo().boundingBox,n=e.maximum.subtract(e.minimum);return 0==n.x&&(n.x=1),0==n.y&&(n.y=1),0==n.z&&(n.z=1),n},t.prototype.refreshBoundingInfo=function(){this._boundingDimesion=this._getBoundingDimension(this._mesh)},t.prototype._doRotation=function(t,e,i,r){this._local&&null!=this._mesh.parent&&this._isScaleUnEqual(t)?this._setLocalAxes(this._ecRoot):this._setLocalAxes(t);var s,a=0;e==this._rX?s=this._local?this._localX:n.X:e==this._rY?s=this._local?this._localY:n.Y:e==this._rZ&&(s=this._local?this._localZ:n.Z),this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),this._rotate2?(a=this._getAngle2(r,i,this._mainCamera.position,this._cameraTOec,s),this._scene.useRightHandedSystem&&(a=-a)):a=this._getAngle(r,i,t.getAbsolutePivotPoint(),this._cameraTOec),this._snapR&&(this._snapRA+=a,a=0,Math.abs(this._snapRA)>=this._rotSnap&&(a=this._snapRA>0?this._rotSnap:-this._rotSnap,this._snapRA=0)),0!==a&&(this._cameraTOec.normalize(),e==this._rAll?t.rotate(this._cameraTOec,-a,h.WORLD):(u.Dot(s,this._cameraTOec)>=0&&(a=-a),t.rotate(s,a,h.WORLD)),this._eulerian&&(t.rotation=t.rotationQuaternion.toEulerAngles(),t.rotationQuaternion=null),this._local&&null!=this._mesh.parent&&this._isScaleUnEqual(t)&&(e==this._rAll?this._ecRoot.rotate(this._cameraTOec,-a,h.WORLD):this._ecRoot.rotate(s,a,h.WORLD)))},t.prototype._getPosOnPickPlane=function(){var t=this,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(e){return e==t._pickedPlane},null,this._mainCamera);return e.hit?e.pickedPoint:null},t.prototype._hideBaxis=function(){this._bXaxis.visibility=0,this._bYaxis.visibility=0,this._bZaxis.visibility=0},t.prototype._setAxesVisiblity=function(t){this._transEnabled&&(this._tEndX.visibility=t,this._tEndY.visibility=t,this._tEndZ.visibility=t,this._tEndXZ.visibility=t,this._tEndZY.visibility=t,this._tEndYX.visibility=t,this._tEndAll.visibility=t),this._rotEnabled&&(this._rEndX.visibility=t,this._rEndY.visibility=t,this._rEndZ.visibility=t,this._rEndAll.visibility=t),this._scaleEnabled&&(this._sEndX.visibility=t,this._sEndY.visibility=t,this._sEndZ.visibility=t,this._sEndXZ.visibility=t,this._sEndZY.visibility=t,this._sEndYX.visibility=t,this._sEndAll.visibility=t)},t.prototype.getRotationQuaternion=function(){return this._ecRoot.rotationQuaternion},t.prototype.getPosition=function(){return this._ecRoot.position},t.prototype.isTranslationEnabled=function(){return this._transEnabled},t.prototype.enableTranslation=function(){null==this._tX&&(this._createTransAxes(),this._tCtl.parent=this._ecRoot,this._tCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._transEnabled||(this._tEndX.visibility=this._visibility,this._tEndY.visibility=this._visibility,this._tEndZ.visibility=this._visibility,this._tEndXZ.visibility=this._visibility,this._tEndZY.visibility=this._visibility,this._tEndYX.visibility=this._visibility,this._tEndAll.visibility=this._visibility,this._transEnabled=!0,this.disableRotation(),this.disableScaling())},t.prototype.disableTranslation=function(){this._transEnabled&&(this._tEndX.visibility=0,this._tEndY.visibility=0,this._tEndZ.visibility=0,this._tEndXZ.visibility=0,this._tEndZY.visibility=0,this._tEndYX.visibility=0,this._tEndAll.visibility=0,this._transEnabled=!1)},t.prototype.isRotationEnabled=function(){return this._rotEnabled},t.prototype.returnEuler=function(t){this._eulerian=t},t.prototype.enableRotation=function(){null==this._rCtl&&(this._createRotAxes(),this._rCtl.parent=this._ecRoot,this._rCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._rotEnabled||(this._rEndX.visibility=this._visibility,this._rEndY.visibility=this._visibility,this._rEndZ.visibility=this._visibility,this._rEndAll.visibility=this._visibility,this._rEndAll2.visibility=this._visibility,this._rotEnabled=!0,this.disableTranslation(),this.disableScaling())},t.prototype.disableRotation=function(){this._rotEnabled&&(this._rEndX.visibility=0,this._rEndY.visibility=0,this._rEndZ.visibility=0,this._rEndAll.visibility=0,this._rEndAll2.visibility=0,this._rotEnabled=!1)},t.prototype.isScalingEnabled=function(){return this._scaleEnabled},t.prototype.enableScaling=function(){null==this._sX&&(this._createScaleAxes(),this._sCtl.parent=this._ecRoot,this._sCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._scaleEnabled||(this._sEndX.visibility=this._visibility,this._sEndY.visibility=this._visibility,this._sEndZ.visibility=this._visibility,this._sEndXZ.visibility=this._visibility,this._sEndZY.visibility=this._visibility,this._sEndYX.visibility=this._visibility,this._sEndAll.visibility=this._visibility,this._scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},t.prototype.disableScaling=function(){this._scaleEnabled&&(this._sEndX.visibility=0,this._sEndY.visibility=0,this._sEndZ.visibility=0,this._sEndXZ.visibility=0,this._sEndZY.visibility=0,this._sEndYX.visibility=0,this._sEndAll.visibility=0,this._scaleEnabled=!1)},t.prototype.setScaleBounds=function(t,e){this._scaleBoundsMin=t||null,this._scaleBoundsMax=e||null,null!=this._scaleBoundsMin&&(0==this._scaleBoundsMin.x&&(this._scaleBoundsMin.x=1e-8),0==this._scaleBoundsMin.y&&(this._scaleBoundsMin.y=1e-8),0==this._scaleBoundsMin.z&&(this._scaleBoundsMin.z=1e-8))},t.prototype.removeScaleBounds=function(){this._scaleBoundsMin=null,this._scaleBoundsMax=null},t.prototype.setTransBounds=function(t,e){this._transBoundsMin=t||null,this._transBoundsMax=e||null},t.prototype.removeTransBounds=function(){this._transBoundsMin=null,this._transBoundsMax=null},t.prototype.setRotBounds=function(t,e){this._rotBoundsMin=t||null,this._rotBoundsMax=e||null},t.prototype.removeRotBounds=function(){this._rotBoundsMin=null,this._rotBoundsMax=null},t.prototype._createCommonAxes=function(){var t=new s("guideCtl",this._scene);this._bXaxis=s.CreateLines("bxAxis",[new u(-100,0,0),new u(100,0,0)],this._scene),this._bYaxis=s.CreateLines("byAxis",[new u(0,-100,0),new u(0,100,0)],this._scene),this._bZaxis=s.CreateLines("bzAxis",[new u(0,0,-100),new u(0,0,100)],this._scene),this._bXaxis.isPickable=!1,this._bYaxis.isPickable=!1,this._bZaxis.isPickable=!1,this._bXaxis.parent=t,this._bYaxis.parent=t,this._bZaxis.parent=t,this._bXaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bYaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bZaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bXaxis.color=i.Red(),this._bYaxis.color=i.Green(),this._bZaxis.color=i.Blue(),this._hideBaxis();var e=this._axesLen*this._axesScale*.75;return this._xaxis=s.CreateLines("xAxis",[new u(0,0,0),new u(e,0,0)],this._scene),this._yaxis=s.CreateLines("yAxis",[new u(0,0,0),new u(0,e,0)],this._scene),this._zaxis=s.CreateLines("zAxis",[new u(0,0,0),new u(0,0,e)],this._scene),this._xaxis.isPickable=!1,this._yaxis.isPickable=!1,this._zaxis.isPickable=!1,this._xaxis.parent=t,this._yaxis.parent=t,this._zaxis.parent=t,this._xaxis.metadata={isEditControl:!0,isRealMesh:!1},this._yaxis.metadata={isEditControl:!0,isRealMesh:!1},this._zaxis.metadata={isEditControl:!0,isRealMesh:!1},this._xaxis.color=i.Red(),this._yaxis.color=i.Green(),this._zaxis.color=i.Blue(),this._xaxis.renderingGroupId=1,this._yaxis.renderingGroupId=1,this._zaxis.renderingGroupId=1,t},t.prototype._createPickPlanes=function(){this._pALL=s.CreatePlane("pALL",5,this._scene),this._pXZ=s.CreatePlane("pXZ",5,this._scene),this._pZY=s.CreatePlane("pZY",5,this._scene),this._pYX=s.CreatePlane("pYX",5,this._scene),this._pALL.isPickable=!1,this._pXZ.isPickable=!1,this._pZY.isPickable=!1,this._pYX.isPickable=!1,this._pALL.visibility=0,this._pXZ.visibility=0,this._pZY.visibility=0,this._pYX.visibility=0,this._pALL.renderingGroupId=1,this._pXZ.renderingGroupId=1,this._pZY.renderingGroupId=1,this._pYX.renderingGroupId=1,this._pALL.lookAt(this._mainCamera.position),this._pXZ.rotate(n.X,1.57),this._pZY.rotate(n.Y,1.57);var t=new s("pickPlanes",this._scene);return this._pALL.parent=t,this._pALL.metadata={isEditControl:!0,isRealMesh:!1},this._pXZ.parent=t,this._pXZ.metadata={isEditControl:!0,isRealMesh:!1},this._pZY.parent=t,this._pZY.metadata={isEditControl:!0,isRealMesh:!1},this._pYX.parent=t,this._pYX.metadata={isEditControl:!0,isRealMesh:!1},t},t.prototype._createTransAxes=function(){var t=2*this._pickWidth*this._axesScale,e=this._axesLen*this._axesScale;this._tCtl=new s("tarnsCtl",this._scene),this._tX=this._extrudeBox(t/2,e),this._tX.name="X",this._tY=this._tX.clone("Y"),this._tZ=this._tX.clone("Z"),this._tXZ=a.CreatePlane("XZ",{size:2*t},this._scene),this._tZY=a.CreatePlane("ZY",{size:2*t},this._scene),this._tYX=a.CreatePlane("YX",{size:2*t},this._scene),this._tXZ.rotation.x=1.57,this._tZY.rotation.y=-1.57,this._tXZ.position.x=t,this._tXZ.position.z=t,this._tZY.position.z=t,this._tZY.position.y=t,this._tYX.position.y=t,this._tYX.position.x=t,this._tXZ.bakeCurrentTransformIntoVertices(),this._tZY.bakeCurrentTransformIntoVertices(),this._tYX.bakeCurrentTransformIntoVertices(),this._tAll=s.CreateBox("ALL",2*t,this._scene),this._tX.parent=this._tCtl,this._tX.metadata={isEditControl:!0,isRealMesh:!1},this._tY.parent=this._tCtl,this._tY.metadata={isEditControl:!0,isRealMesh:!1},this._tZ.parent=this._tCtl,this._tZ.metadata={isEditControl:!0,isRealMesh:!1},this._tXZ.parent=this._tCtl,this._tXZ.metadata={isEditControl:!0,isRealMesh:!1},this._tZY.parent=this._tCtl,this._tZY.metadata={isEditControl:!0,isRealMesh:!1},this._tYX.parent=this._tCtl,this._tYX.metadata={isEditControl:!0,isRealMesh:!1},this._tAll.parent=this._tCtl,this._tAll.metadata={isEditControl:!0,isRealMesh:!1},this._tX.rotation.y=1.57,this._tY.rotation.x-=1.57,this._tX.visibility=0,this._tY.visibility=0,this._tZ.visibility=0,this._tXZ.visibility=0,this._tZY.visibility=0,this._tYX.visibility=0,this._tAll.visibility=0,this._tX.isPickable=!1,this._tY.isPickable=!1,this._tZ.isPickable=!1,this._tXZ.isPickable=!1,this._tZY.isPickable=!1,this._tYX.isPickable=!1,this._tAll.isPickable=!1;var n=e/5,i=t;this._tEndX=s.CreateCylinder("tEndX",n,0,i,6,1,this._scene),this._tEndY=this._tEndX.clone("tEndY"),this._tEndZ=this._tEndX.clone("tEndZ"),this._tEndXZ=this._createTriangle("XZ",1.75*i,this._scene),this._tEndZY=this._tEndXZ.clone("ZY"),this._tEndYX=this._tEndXZ.clone("YX"),this._tEndAll=a.CreatePolyhedron("tEndAll",{type:1,size:i/2},this._scene),this._tEndX.rotation.x=1.57,this._tEndY.rotation.x=1.57,this._tEndZ.rotation.x=1.57,this._tEndZY.rotation.z=1.57,this._tEndYX.rotation.x=-1.57,this._tEndXZ.position.x=t,this._tEndXZ.position.z=t,this._tEndZY.position.z=t,this._tEndZY.position.y=t,this._tEndYX.position.y=t,this._tEndYX.position.x=t,this._tEndX.parent=this._tX,this._tEndX.metadata={isEditControl:!0,isRealMesh:!1},this._tEndY.parent=this._tY,this._tEndY.metadata={isEditControl:!0,isRealMesh:!1},this._tEndZ.parent=this._tZ,this._tEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._tEndXZ.parent=this._tXZ,this._tEndXZ.metadata={isEditControl:!0,isRealMesh:!1},this._tEndZY.parent=this._tZY,this._tEndZY.metadata={isEditControl:!0,isRealMesh:!1},this._tEndYX.parent=this._tYX,this._tEndYX.metadata={isEditControl:!0,isRealMesh:!1},this._tEndAll.parent=this._tAll,this._tEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._tEndX.position.z=e-n/2,this._tEndY.position.z=e-n/2,this._tEndZ.position.z=e-n/2,this._tEndX.material=this._redMat,this._tEndY.material=this._greenMat,this._tEndZ.material=this._blueMat,this._tEndXZ.material=this._greenMat,this._tEndZY.material=this._redMat,this._tEndYX.material=this._blueMat,this._tEndAll.material=this._yellowMat,this._tEndX.renderingGroupId=2,this._tEndY.renderingGroupId=2,this._tEndZ.renderingGroupId=2,this._tEndXZ.renderingGroupId=2,this._tEndZY.renderingGroupId=2,this._tEndYX.renderingGroupId=2,this._tEndAll.renderingGroupId=2,this._tEndX.isPickable=!1,this._tEndY.isPickable=!1,this._tEndZ.isPickable=!1,this._tEndXZ.isPickable=!1,this._tEndZY.isPickable=!1,this._tEndYX.isPickable=!1,this._tEndAll.isPickable=!1},t.prototype._createTriangle=function(t,e,n){console.log("_createTriangle "+e);var i=new o(e/2,-e/2).addLineTo(e/2,e/2).addLineTo(-e/2,e/2).addLineTo(e/2,-e/2);return new BABYLON.PolygonMeshBuilder(t,i,n).build()},t.prototype.setRotGuideFull=function(t){this._guideSize=t?360:180,null!=this._rCtl&&(this._rCtl.dispose(),this._rAll.dispose(),this._rCtl=null,this.enableRotation())},t.prototype._createRotAxes=function(){var t=this._axesLen*this._axesScale*2;this._rCtl=new s("rotCtl",this._scene),this._rX=this._createTube(t/2,this._guideSize),this._rX.name="X",this._rY=this._createTube(t/2,this._guideSize),this._rY.name="Y",this._rZ=this._createTube(t/2,this._guideSize),this._rZ.name="Z",this._rAll=this._createTube(t/1.75,360),this._rAll.name="ALL",this._rX.rotation.z=1.57,this._rZ.rotation.x=-1.57,this._rX.bakeCurrentTransformIntoVertices(),this._rZ.bakeCurrentTransformIntoVertices(),this._rAll.rotation.x=1.57,this._rX.parent=this._rCtl,this._rX.metadata={isEditControl:!0,isRealMesh:!1},this._rY.parent=this._rCtl,this._rY.metadata={isEditControl:!0,isRealMesh:!1},this._rZ.parent=this._rCtl,this._rZ.metadata={isEditControl:!0,isRealMesh:!1},this._rAll.parent=this._pALL,this._rAll.metadata={isEditControl:!0,isRealMesh:!1},this._rX.visibility=0,this._rY.visibility=0,this._rZ.visibility=0,this._rAll.visibility=0,this._rX.isPickable=!1,this._rY.isPickable=!1,this._rZ.isPickable=!1,this._rAll.isPickable=!1;var e=t;this._rEndX=this._createCircle(e/2,this._guideSize,!1),this._rEndY=this._rEndX.clone(""),this._rEndZ=this._rEndX.clone(""),this._rEndAll=this._createCircle(e/1.75,360,!1),this._rEndAll2=this._createCircle(e/2,360,!1),this._rEndX.parent=this._rX,this._rEndX.metadata={isEditControl:!0,isRealMesh:!1},this._rEndY.parent=this._rY,this._rEndY.metadata={isEditControl:!0,isRealMesh:!1},this._rEndZ.parent=this._rZ,this._rEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._rEndX.rotation.z=1.57,this._rEndZ.rotation.x=-1.57,this._rEndAll.parent=this._rAll,this._rEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._rEndAll2.parent=this._rAll,this._rEndAll2.metadata={isEditControl:!0,isRealMesh:!1},this._rEndX.color=i.Red(),this._rEndY.color=i.Green(),this._rEndZ.color=i.Blue(),this._rEndAll.color=i.Yellow(),this._rEndAll2.color=i.Gray(),this._rEndX.renderingGroupId=2,this._rEndY.renderingGroupId=2,this._rEndZ.renderingGroupId=2,this._rEndAll.renderingGroupId=2,this._rEndAll2.renderingGroupId=2,this._rEndX.isPickable=!1,this._rEndY.isPickable=!1,this._rEndZ.isPickable=!1,this._rEndAll.isPickable=!1,this._rEndAll2.isPickable=!1},t.prototype._extrudeBox=function(t,e){var n=[new u(t,t,0),new u(-t,t,0),new u(-t,-t,0),new u(t,-t,0),new u(t,t,0)],i=[new u(0,0,0),new u(0,0,e)];return s.ExtrudeShape("",n,i,1,0,2,this._scene)},t.prototype._createCircle=function(t,e,n){null===e&&(e=360);for(var i,r,a=[],o=3.14/180,l=0,h=0;h<=e;h+=5)i=t*Math.cos(h*o),r=90==h?t:270==h?-t:t*Math.sin(h*o),a[l]=new u(i,0,r),l++;if(n)for(t-=.04,h=0;h<=e;h+=5)i=t*Math.cos(h*o),r=90==h?t:270==h?-t:t*Math.sin(h*o),a[l]=new u(i,0,r),l++;return s.CreateLines("",a,this._scene)},t.prototype._createTube=function(t,e){null===e&&(e=360);for(var n,i,r=[],a=3.14/180,o=0,l=0;l<=e;l+=30)n=t*Math.cos(l*a),i=90==l?t:270==l?-t:t*Math.sin(l*a),r[o]=new u(n,0,i),o++;return s.CreateTube("",r,this._pickWidth*this._axesScale*2,3,null,BABYLON.Mesh.NO_CAP,this._scene)},t.prototype._createScaleAxes=function(){var t=2*this._pickWidth*this._axesScale,e=this._axesLen*this._axesScale;this._sCtl=new s("sCtl",this._scene),this._sX=this._extrudeBox(t/2,e),this._sX.name="X",this._sY=this._sX.clone("Y"),this._sZ=this._sX.clone("Z"),this._sXZ=a.CreatePlane("XZ",{size:2*t},this._scene),this._sZY=a.CreatePlane("ZY",{size:2*t},this._scene),this._sYX=a.CreatePlane("YX",{size:2*t},this._scene),this._sXZ.rotation.x=1.57,this._sZY.rotation.y=-1.57,this._sXZ.position.x=t,this._sXZ.position.z=t,this._sZY.position.z=t,this._sZY.position.y=t,this._sYX.position.y=t,this._sYX.position.x=t,this._sXZ.bakeCurrentTransformIntoVertices(),this._sZY.bakeCurrentTransformIntoVertices(),this._sYX.bakeCurrentTransformIntoVertices(),this._sAll=s.CreateBox("ALL",2*t,this._scene),this._sX.parent=this._sCtl,this._sX.metadata={isEditControl:!0,isRealMesh:!1},this._sY.parent=this._sCtl,this._sY.metadata={isEditControl:!0,isRealMesh:!1},this._sZ.parent=this._sCtl,this._sZ.metadata={isEditControl:!0,isRealMesh:!1},this._sAll.parent=this._sCtl,this._sAll.metadata={isEditControl:!0,isRealMesh:!1},this._sXZ.parent=this._sCtl,this._sXZ.metadata={isEditControl:!0,isRealMesh:!1},this._sZY.parent=this._sCtl,this._sZY.metadata={isEditControl:!0,isRealMesh:!1},this._sYX.parent=this._sCtl,this._sYX.metadata={isEditControl:!0,isRealMesh:!1},this._sX.rotation.y=1.57,this._sY.rotation.x-=1.57,this._sX.visibility=0,this._sY.visibility=0,this._sZ.visibility=0,this._sXZ.visibility=0,this._sZY.visibility=0,this._sYX.visibility=0,this._sAll.visibility=0,this._sX.isPickable=!1,this._sY.isPickable=!1,this._sZ.isPickable=!1,this._sXZ.isPickable=!1,this._sZY.isPickable=!1,this._sYX.isPickable=!1,this._sAll.isPickable=!1;var n=t;this._sEndX=s.CreateBox("",n,this._scene),this._sEndY=this._sEndX.clone(""),this._sEndZ=this._sEndX.clone(""),this._sEndXZ=this._createTriangle("XZ",1.75*n,this._scene),this._sEndZY=this._sEndXZ.clone("ZY"),this._sEndYX=this._sEndXZ.clone("YX"),this._sEndAll=a.CreatePolyhedron("sEndAll",{type:1,size:n/2},this._scene),this._sEndZY.rotation.z=1.57,this._sEndYX.rotation.x=-1.57,this._sEndXZ.position.x=t,this._sEndXZ.position.z=t,this._sEndZY.position.z=t,this._sEndZY.position.y=t,this._sEndYX.position.y=t,this._sEndYX.position.x=t,this._sEndX.parent=this._sX,this._sEndX.metadata={isEditControl:!0,isRealMesh:!1},this._sEndY.parent=this._sY,this._sEndY.metadata={isEditControl:!0,isRealMesh:!1},this._sEndZ.parent=this._sZ,this._sEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._sEndXZ.parent=this._sXZ,this._sEndXZ.metadata={isEditControl:!0,isRealMesh:!1},this._sEndZY.parent=this._sZY,this._sEndZY.metadata={isEditControl:!0,isRealMesh:!1},this._sEndYX.parent=this._sYX,this._sEndYX.metadata={isEditControl:!0,isRealMesh:!1},this._sEndAll.parent=this._sAll,this._sEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._sEndX.position.z=e-n/2,this._sEndY.position.z=e-n/2,this._sEndZ.position.z=e-n/2,this._sEndX.material=this._redMat,this._sEndY.material=this._greenMat,this._sEndZ.material=this._blueMat,this._sEndXZ.material=this._greenMat,this._sEndZY.material=this._redMat,this._sEndYX.material=this._blueMat,this._sEndAll.material=this._yellowMat,this._sEndX.renderingGroupId=2,this._sEndY.renderingGroupId=2,this._sEndZ.renderingGroupId=2,this._sEndXZ.renderingGroupId=2,this._sEndZY.renderingGroupId=2,this._sEndYX.renderingGroupId=2,this._sEndAll.renderingGroupId=2,this._sEndX.isPickable=!1,this._sEndY.isPickable=!1,this._sEndZ.isPickable=!1,this._sEndXZ.isPickable=!1,this._sEndZY.isPickable=!1,this._sEndYX.isPickable=!1,this._sEndAll.isPickable=!1},t.prototype._check_LHS_RHS=function(t){var e=u.Cross(this._localX,this._localY);return u.Dot(e,this._localZ)<0},t.prototype.setVisibility=function(t){this._visibility=t},t.prototype.setLocal=function(t){this._local!=t&&(this._local=t,t||(this._ecRoot.rotationQuaternion=l.Identity()))},t.prototype.isLocal=function(){return this._local},t.prototype.setTransSnap=function(t){this._snapT=t},t.prototype.setRotSnap=function(t){this._snapR=t},t.prototype.setScaleSnap=function(t){this._snapS=t},t.prototype.setTransSnapValue=function(t){this._tSnap.copyFromFloats(t,t,t),this._transSnap=t},t.prototype.setRotSnapValue=function(t){this._rotSnap=t},t.prototype.setScaleSnapValue=function(t){this._scaleSnap=t},t.prototype._getAngle2=function(t,e,n,i,r){var s=u.Dot(i,r);r.scaleToRef(s,this._tv1),n.addToRef(this._tv1,this._tv2);var a=this._tv2;this._mainCamera.getWorldMatrix().invertToRef(this._tm),u.TransformCoordinatesToRef(this._tv2,this._tm,this._tv2);var o=0;a.x>=0&&a.y>=0?o=1:a.x<=0&&a.y>=0?o=2:a.x<=0&&a.y<=0?o=3:a.x>=0&&a.y<=0&&(o=4),u.TransformCoordinatesToRef(t,this._tm,this._tv1),u.TransformCoordinatesToRef(e,this._tm,this._tv2),this._tv2.subtractInPlace(this._tv1);var l=this._tv2,h=l.length(),c="";l.x>=0&&l.y>=0?c=l.x>=l.y?"r":"u":l.x<=0&&l.y>=0?c=-l.x>=l.y?"l":"u":l.x<=0&&l.y<=0?c=-l.x>=-l.y?"l":"d":l.x>=0&&l.y<=0&&(c=l.x>=-l.y?"r":"d");var d=0;return"d"==c?d=1==o||4==o?1:-1:"u"==c?d=1==o||4==o?-1:1:"r"==c?d=2==o||1==o?1:-1:"l"==c&&(d=2==o||1==o?-1:1),d*h},t.prototype._getAngle=function(t,e,n,i){t.subtractToRef(n,this._tv1),e.subtractToRef(n,this._tv2),u.CrossToRef(this._tv1,this._tv2,this._tv3);var r=Math.asin(this._tv3.length()/(this._tv1.length()*this._tv2.length()));return u.Dot(this._tv3,i)>0&&(r*=-1),r},t.prototype._createMaterials=function(e){this._redMat=t._getStandardMaterial("redMat",i.Red(),e),this._greenMat=t._getStandardMaterial("greenMat",i.Green(),e),this._blueMat=t._getStandardMaterial("blueMat",i.Blue(),e),this._whiteMat=t._getStandardMaterial("whiteMat",i.White(),e),this._yellowMat=t._getStandardMaterial("whiteMat",i.Yellow(),e)},t.prototype._disposeMaterials=function(){this._redMat.dispose(),this._greenMat.dispose(),this._blueMat.dispose(),this._whiteMat.dispose(),this._yellowMat.dispose()},t._getStandardMaterial=function(t,e,n){var r=new c(t,n);return r.emissiveColor=e,r.diffuseColor=i.Black(),r.specularColor=i.Black(),r.backFaceCulling=!1,r},t}();t.EditControl=d;var p=function(){function t(t,e){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=e-1,this.add()}return t.prototype.setCapacity=function(t){0!=t?(this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()):console.error("capacity should be more than zero")},t.prototype.add=function(t){void 0===t&&(t=null);var e=new f(this.mesh,t);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(e)):(this.acts.push(e),this.last++,this.current++)},t.prototype.undo=function(){if(this.current>0){var t=this.acts[this.current].getActionType();return this.current--,this.acts[this.current].perform(this.mesh),t}},t.prototype.redo=function(){if(this.current<this.last)return this.current++,this.acts[this.current].perform(this.mesh),this.acts[this.current].getActionType()},t}();t.ActHist=p;var f=function(){function t(t,e){this._p=t.position.clone(),null==t.rotationQuaternion?(this._rQ=null,this._rE=t.rotation.clone()):(this._rQ=t.rotationQuaternion.clone(),this._rE=null),this._s=t.scaling.clone(),this._at=e}return t.prototype.getActionType=function(){return this._at},t.prototype.perform=function(t){t.position.copyFrom(this._p),null==t.rotationQuaternion?null!=this._rE?t.rotation.copyFrom(this._rE):t.rotation.copyFrom(this._rQ.toEulerAngles()):null!=this._rQ?t.rotationQuaternion.copyFrom(this._rQ):t.rotationQuaternion.copyFrom(l.RotationYawPitchRoll(this._rE.y,this._rE.x,this._rE.z)),t.scaling.copyFrom(this._s)},t}();t.Act=f}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),function(t){var e=BABYLON.Color3,n=BABYLON.StandardMaterial,i=BABYLON.Matrix,r=BABYLON.Mesh,s=BABYLON.Vector3,a=BABYLON.Quaternion,o=BABYLON.VertexData,l=BABYLON.LinesMesh,h=function(){function t(i,s,a,o,l,h){void 0===s&&(s=1911),this._scene=i,this._arrowLength=a||1,this._coneLength=o||.2,this._coneRadius=l||.1,this._planeSelectionLength=h||this._arrowLength/5,this._wireSelectionThreshold=.05,this._light1=new BABYLON.PointLight("ManipulatorLight",new BABYLON.Vector3(50,50,70),this._scene),this._light1.id="***SceneManipulatorLight***",this._light2=new BABYLON.PointLight("ManipulatorLight",new BABYLON.Vector3(-50,-50,-70),this._scene),this._light2.id="***SceneManipulatorLight***",this._xArrowColor=new e(t.pc,t.sc/2,t.sc),this._yArrowColor=new e(t.sc,t.pc,t.sc/2),this._zArrowColor=new e(t.sc/2,t.sc,t.pc),this._xyPlaneSelectionColor=new e(t.pc/1.1,t.pc/1.3,t.sc),this._xzPlaneSelectionColor=new e(t.pc/1.1,t.sc,t.pc/1.3),this._yzPlaneSelectionColor=new e(t.sc,t.pc/1.3,t.pc/1.1);var c=[];c.push({name:"arrowX",color:this.xArrowColor}),c.push({name:"arrowY",color:this.yArrowColor}),c.push({name:"arrowZ",color:this.zArrowColor}),c.push({name:"planeXY",color:this.xyPlaneSelectionColor}),c.push({name:"planeXZ",color:this.xzPlaneSelectionColor}),c.push({name:"planeYZ",color:this.yzPlaneSelectionColor}),c.push({name:"rotationX",color:this.xArrowColor.clone()}),c.push({name:"rotationY",color:this.yArrowColor.clone()}),c.push({name:"rotationZ",color:this.zArrowColor.clone()}),this._materials=[];for(var u=0,d=c;u<d.length;u++){var p=d[u],f=new n(p.name+"RadixMaterial",this._scene);f.diffuseColor=p.color,this._materials[p.name]=f}this._features=s,this._rootMesh=new r("radixRoot",this._scene),this._rootMesh.renderingGroupId=1,this.constructGraphicalObjects()}return Object.defineProperty(t.prototype,"wireSelectionThreshold",{get:function(){return this._wireSelectionThreshold},set:function(t){this._wireSelectionThreshold=t;for(var e=0,n=this._rootMesh.getChildMeshes(!0,function(t){return t instanceof l});e<n.length;e++){var i=n[e];i&&(i.intersectionThreshold=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xArrowColor",{get:function(){return this._xArrowColor},set:function(t){this._xArrowColor=t,this.updateMaterial("arrowX",t),this.updateMaterial("rotationX",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yArrowColor",{get:function(){return this._yArrowColor},set:function(t){this._yArrowColor=t,this.updateMaterial("arrowY",t),this.updateMaterial("rotationY",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zArrowColor",{get:function(){return this._zArrowColor},set:function(t){this._zArrowColor=t,this.updateMaterial("arrowZ",t),this.updateMaterial("rotationZ",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyPlaneSelectionColor",{get:function(){return this._xyPlaneSelectionColor},set:function(t){this._xyPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xzPlaneSelectionColor",{get:function(){return this._xzPlaneSelectionColor},set:function(t){this._xzPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yzPlaneSelectionColor",{get:function(){return this._yzPlaneSelectionColor},set:function(t){this._yzPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlighted",{get:function(){return this._highlighted},set:function(t){this.updateMaterialFromHighlighted(1,t,"arrowX"),this.updateMaterialFromHighlighted(2,t,"arrowY"),this.updateMaterialFromHighlighted(4,t,"arrowZ"),this.updateMaterialFromHighlighted(16,t,"planeXY"),this.updateMaterialFromHighlighted(32,t,"planeXZ"),this.updateMaterialFromHighlighted(64,t,"planeYZ"),this.updateMaterialFromHighlighted(256,t,"rotationX"),this.updateMaterialFromHighlighted(512,t,"rotationY"),this.updateMaterialFromHighlighted(1024,t,"rotationZ"),this._highlighted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),t.prototype.intersect=function(t){var e,n=0,i=Number.MAX_VALUE;return this.hasFeature(1)&&(e=this.intersectMeshes(t,"arrowX",i))<i&&(i=e,n=1),this.hasFeature(2)&&(e=this.intersectMeshes(t,"arrowY",i))<i&&(i=e,n=2),this.hasFeature(4)&&(e=this.intersectMeshes(t,"arrowZ",i))<i&&(i=e,n=4),this.hasFeature(16)&&(e=this.intersectMeshes(t,"planeXY",i))<i&&(i=e,n=16),this.hasFeature(32)&&(e=this.intersectMeshes(t,"planeXZ",i))<i&&(i=e,n=32),this.hasFeature(64)&&(e=this.intersectMeshes(t,"planeYZ",i))<i&&(i=e,n=64),this.hasFeature(256)&&(e=this.intersectMeshes(t,"rotationX",i))<i&&(i=e,n=256),this.hasFeature(512)&&(e=this.intersectMeshes(t,"rotationY",i))<i&&(i=e,n=512),this.hasFeature(1024)&&(e=this.intersectMeshes(t,"rotationZ",i))<i&&(i=e,n=1024),n},t.prototype.setWorld=function(t,e,n){this._rootMesh.position=t,this._rootMesh.rotationQuaternion=e,this._rootMesh.scaling=n},t.prototype.show=function(){this.setVisibleState(this._rootMesh,!0)},t.prototype.hide=function(){this.setVisibleState(this._rootMesh,!1)},t.prototype.setVisibleState=function(t,e){var n=this;t.isVisible=e,t.getChildMeshes(!0).forEach(function(t){return n.setVisibleState(t,e)})},t.prototype.intersectMeshes=function(t,e,n){for(var i=0,r=this._rootMesh.getChildMeshes(!0,function(t){return 0===t.name.indexOf(e)});i<r.length;i++){var s=r[i],a=this._scene.createPickingRay(t.x,t.y,s.getWorldMatrix(),this._scene.activeCamera),o=s.intersects(a,!1);o.hit&&o.distance<n&&(n=o.distance)}return n},t.prototype.constructGraphicalObjects=function(){var t=Math.PI/2;this.hasFeature(1)&&this.constructArrow(1,"arrowX",i.RotationZ(-t)),this.hasFeature(2)&&this.constructArrow(2,"arrowY",i.Identity()),this.hasFeature(4)&&this.constructArrow(4,"arrowZ",i.RotationX(t)),this.hasFeature(16)&&this.constructPlaneSelection(16,"planeXY",i.Identity()),this.hasFeature(32)&&this.constructPlaneSelection(32,"planeXZ",i.RotationX(t)),this.hasFeature(64)&&this.constructPlaneSelection(64,"planeYZ",i.RotationY(-t)),this.hasFeature(256)&&this.constructRotation(256,"rotationX",i.RotationZ(-t)),this.hasFeature(512)&&this.constructRotation(512,"rotationY",i.Identity()),this.hasFeature(1024)&&this.constructRotation(1024,"rotationZ",i.RotationX(t))},t.prototype.constructArrow=function(t,e,n){var i,h=this.getMaterial(e);switch(t){case 1:i=this.hasFeature(256);break;case 2:i=this.hasFeature(512);break;case 4:i=this.hasFeature(1024)}var c=a.FromRotationMatrix(n),u=new Array;u.push(0,i?this._coneLength:0,0),u.push(0,this._arrowLength-this._coneLength,0);var d=new l(e+"Wire",this._scene);d.rotationQuaternion=c,d.parent=this._rootMesh,d.color=h.diffuseColor,d.renderingGroupId=1,d.intersectionThreshold=this.wireSelectionThreshold,d.isPickable=!1;var p=new o;p.positions=u,p.indices=[0,1],p.applyToMesh(d);var f=r.CreateCylinder(e+"Cone",this._coneLength,0,this._coneRadius,18,1,this._scene,!1);f.position=s.TransformCoordinates(new s(0,this._arrowLength-this._coneLength/2,0),n),f.rotationQuaternion=c,f.material=h,f.parent=this._rootMesh,f.renderingGroupId=1,f.isPickable=!1,this.addSymbolicMeshToLit(f)},t.prototype.constructPlaneSelection=function(t,e,n){var i=this.getMaterial(e),o=new Array;o.push(new s(this._arrowLength-this._planeSelectionLength,this._arrowLength,0)),o.push(new s(this._arrowLength,this._arrowLength,0)),o.push(new s(this._arrowLength,this._arrowLength-this._planeSelectionLength,0));var l=r.CreateLines(e+"Plane",o,this._scene);l.parent=this._rootMesh,l.color=i.diffuseColor,l.rotationQuaternion=a.FromRotationMatrix(n),l.renderingGroupId=1,l.intersectionThreshold=this.wireSelectionThreshold,l.isPickable=!1},t.prototype.constructRotation=function(t,e,n){var i=this.getMaterial(e),o=r.CreateCylinder(e+"Cylinder",this._coneLength,this._coneRadius,this._coneRadius,18,1,this._scene,!1);o.material=i,o.position=s.TransformCoordinates(new s(0,this._coneLength/2,0),n),o.rotationQuaternion=a.FromRotationMatrix(n),o.parent=this._rootMesh,o.renderingGroupId=1,o.isPickable=!1,this.addSymbolicMeshToLit(o)},t.prototype.addSymbolicMeshToLit=function(t){var e=this;this._light1.includedOnlyMeshes.push(t),this._light2.includedOnlyMeshes.push(t),this._scene.lights.map(function(n){n!==e._light1&&n!==e._light2&&n.excludedMeshes.push(t)})},t.prototype.hasFeature=function(t){return 0!=(this._features&t)},t.prototype.hasHighlightedFeature=function(t){return 0!=(this._highlighted&t)},t.prototype.updateMaterial=function(t,e){var n=this.getMaterial(t);n&&(n.diffuseColor=e)},t.prototype.updateMaterialFromHighlighted=function(t,e,n){if(this.hasFeature(t)&&(this._highlighted&t)!=(e&t)){var i=this.getMaterial(n);0!=(e&t)?(i.diffuseColor.r*=1.8,i.diffuseColor.g*=1.8,i.diffuseColor.b*=1.8):(i.diffuseColor.r/=1.8,i.diffuseColor.g/=1.8,i.diffuseColor.b/=1.8)}},t.prototype.getMaterial=function(t){return this._materials[t]},t.pc=.6,t.sc=.2,t}();t.Radix=h}(ManipulationHelpers||(ManipulationHelpers={}));var ManipulationHelpers,Vector4=BABYLON.Vector2;!function(t){var e=BABYLON.Vector2,n=BABYLON.Vector3,i=BABYLON.Matrix,r=BABYLON.Plane,s=BABYLON.AbstractMesh,a=BABYLON.Quaternion,o=BABYLON.PointerEventTypes,l=function(){function l(e){var n=this;this.noPreventContextMenu=!1,this._flags=0,this._rotationFactor=1,this._scene=e,this._radix=new t.Radix(e),this._shiftKeyState=!1,this._scene.onBeforeRenderObservable.add(function(t,e){return n.onBeforeRender(t,e)}),this._scene.onPointerObservable.add(function(t,e){return n.onPointer(t,e)},-1,!0),window.oncontextmenu=function(t){n.noPreventContextMenu||t.preventDefault()}}return l.prototype.attachManipulatedNode=function(t){this._manipulatedNode=t,this._radix.show()},l.prototype.detachManipulatedNode=function(t){this._manipulatedNode=null,this._radix.hide()},l.prototype.onBeforeRender=function(t,e){this.renderManipulator()},l.prototype.onPointer=function(t,e){if(this._manipulatedNode){var n=this.getRayPosition(t.event),i=t.event.shiftKey;this.hasManFlags(1)&&i!==this._shiftKeyState&&this.beginDrag(n,t.event),t.type===o.POINTERMOVE?this.noPreventContextMenu||2!==t.event.button||1!==t.event.buttons?this.hasManFlags(1)&&!this.hasManFlags(8)?(e.skipNextObservers=!0,i||this.hasManipulatedMode(1792)?this.doRot(n):this.doPos(n)):this._radix.highlighted=this._radix.intersect(n):(this.setManipulatedNodeWorldMatrix(this._firstTransform),this.setManFlags(8)):t.type===o.POINTERDOWN&&0===t.event.button?(this._manipulatedMode=this._radix.intersect(n),0!==this._manipulatedMode&&(e.skipNextObservers=!0,this.beginDrag(n,t.event),this.hasManipulatedMode(1792)?this.doRot(n):this.doPos(n))):t.type===o.POINTERUP&&(this.hasManFlags(1)&&(e.skipNextObservers=!0),this._radix.highlighted=this._radix.intersect(n),0===t.event.button&&this.endDragMode())}},l.prototype.beginDrag=function(t,e){this._firstMousePos=t,this._prevMousePos=this._firstMousePos.clone(),this._shiftKeyState=e.shiftKey;var n=this.getManipulatedNodeWorldMatrix();this._pos=n.getTranslation(),this._right=n.getRow(0).toVector3(),this._up=n.getRow(1).toVector3(),this._view=n.getRow(2).toVector3(),this._oldPos=this._pos.clone(),this._firstTransform=n.clone(),this._flags|=3},l.prototype.endDragMode=function(){this.clearManFlags(9)},l.prototype.doRot=function(t){if(this.hasManFlags(2))this.clearManFlags(2);else{var e=t.x-this._prevMousePos.x,n=t.y-this._prevMousePos.y,r=this._scene.getEngine().getRenderingCanvasClientRect(),s=e/r.width*Math.PI*2*this._rotationFactor,a=n/r.height*Math.PI*2*this._rotationFactor;if(this.rotationStep){var o=s%this.rotationStep;s-=o,a-=o=a%this.rotationStep}var l=i.Identity();this.hasManipulatedMode(257)?l=i.RotationX(a):this.hasManipulatedMode(514)?l=i.RotationY(a):this.hasManipulatedMode(1028)?l=i.RotationZ(a):(this.hasManipulatedMode(48)&&(l=l.multiply(i.RotationX(a))),this.hasManipulatedMode(80)&&(l=l.multiply(i.RotationY(s))),this.hasManipulatedMode(32)&&(l=l.multiply(i.RotationZ(a))),this.hasManipulatedMode(32)&&(l=l.multiply(i.RotationZ(s))));var h=l.multiply(this._firstTransform);this.setManipulatedNodeWorldMatrix(h)}},l.prototype.doPos=function(t){var e=n.Zero(),s=this._scene.createPickingRay(t.x,t.y,i.Identity(),this._scene.activeCamera);if(this.hasManipulatedMode(112)){if(this.hasManipulatedMode(16)?o=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._up)):this.hasManipulatedMode(32)?o=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._view)):this.hasManipulatedMode(64)&&(o=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._view))),Math.abs(n.Dot(o.normal,s.direction))<.06)return;var a=s.intersectsPlane(o);if(c=l.ComputeRayHit(s,a),this.hasManFlags(2))return this._flags&=-3,void(this._prevHit=c);e=c.subtract(this._prevHit)}else if(0!=(7&this._manipulatedMode)){var o,h,c,u,d,p;if(this.hasManFlags(2))return o=(p=this.setupIntersectionPlanes(this._manipulatedMode)).p0,h=p.p1,Math.abs(n.Dot(o.normal,s.direction))>Math.abs(n.Dot(h.normal,s.direction))?(a=s.intersectsPlane(o),c=l.ComputeRayHit(s,a),this._flags&=-5):(a=s.intersectsPlane(h),c=l.ComputeRayHit(s,a),this._flags|=4),this._flags&=-3,void(this._prevHit=c);o=(p=this.setupIntersectionPlane(this._manipulatedMode,this.hasManFlags(4))).plane,d=p.axis,a=s.intersectsPlane(o),e=(c=l.ComputeRayHit(s,a)).subtract(this._prevHit),u=n.Dot(d,e),e=d.multiplyByFloats(u,u,u)}this.translationStep&&(e.x-=e.x%this.translationStep,e.y-=e.y%this.translationStep,e.z-=e.z%this.translationStep);var f=this._firstTransform.clone();f.setTranslation(f.getTranslation().add(e)),this._pos=f.getTranslation(),this.setManipulatedNodeWorldMatrix(f)},l.prototype.hasManipulatedMode=function(t){return 0!=(this._manipulatedMode&t)},l.prototype.hasManFlags=function(t){return 0!=(this._flags&t)},l.prototype.clearManFlags=function(t){return this._flags&=~t,this._flags},l.prototype.setManFlags=function(t){return this._flags|=t,this._flags},l.ComputeRayHit=function(t,e){return t.origin.add(t.direction.multiplyByFloats(e,e,e))},l.prototype.setManipulatedNodeWorldMatrix=function(t){if(this._manipulatedNode&&this._manipulatedNode instanceof s){var e=this._manipulatedNode;e.parent&&(t=t.multiply(e.parent.getWorldMatrix().clone().invert()));var i=n.Zero(),r=n.Zero(),o=new a;t.decompose(r,o,i),e.position=i,e.rotationQuaternion=o,e.scaling=r}},l.prototype.getManipulatedNodeWorldMatrix=function(){return this._manipulatedNode?this._manipulatedNode instanceof s?this._manipulatedNode.getWorldMatrix():void 0:null},l.prototype.setupIntersectionPlane=function(t,e){var i,r=this.setupIntersectionPlanes(t),s=e?r.p1:r.p0;switch(t){case 1:i=this._right;break;case 2:i=this._up;break;case 4:i=this._view;break;default:i=n.Zero()}return{plane:s,axis:i}},l.prototype.setupIntersectionPlanes=function(t){var e,n;switch(t){case 1:e=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._right)),n=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._up));break;case 2:e=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._right)),n=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._view));break;case 4:e=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._right)),n=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._up))}return{p0:e,p1:n}},l.prototype.getRayPosition=function(t){var n=this._scene.getEngine().getRenderingCanvasClientRect(),i=t.clientX-n.left,r=t.clientY-n.top;return new e(i,r)},l.prototype.renderManipulator=function(){if(this._manipulatedNode&&this._manipulatedNode instanceof s){var t=this._manipulatedNode.getWorldMatrix(),e=n.Distance(this._scene.activeCamera.position,t.getTranslation()),r=this._scene.getEngine().getRenderWidth(),o=20*this.fromScreenToWorld(r/100,e),l=n.Zero(),h=n.Zero(),c=a.Identity();i.Scaling(o,o,o).multiply(t).decompose(l,c,h),this._radix.setWorld(h,c,l)}},l.prototype.fromScreenToWorld=function(t,e){var n=this._scene.activeCamera,r=this._scene.createPickingRay(0,0,i.Identity(),n,!0),s=this._scene.createPickingRay(t,0,i.Identity(),n,!0),a=l.evalPosition(r,e);return l.evalPosition(s,e).x-a.x},l.evalPosition=function(t,e){return t.origin.add(t.direction.multiplyByFloats(e,e,e))},l}();t.ManipulatorInteractionHelper=l}(ManipulationHelpers||(ManipulationHelpers={})),function(t){var e=BABYLON.PointerEventTypes,n=BABYLON.AbstractMesh,i=function(){function i(t){var e=this;this._actionStack=new Array,this._scene=t,this._pointerObserver=this._scene.onPointerObservable.add(function(t,n){return e.pointerCallback(t,n)},-1,!0)}return Object.defineProperty(i.prototype,"currentAction",{get:function(){return 0===this._actionStack.length?1:this._actionStack[this._actionStack.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"manipulator",{get:function(){return this._manipulator||(this._manipulator=new t.ManipulatorInteractionHelper(this._scene)),this._manipulator},enumerable:!0,configurable:!0}),i.prototype.pointerCallback=function(t,n){switch(this.detectActionChanged(t,n),this.currentAction){case 1:this.doSelectorInteraction(t,n);break;case 2:t.type&(e.POINTERUP|e.POINTERWHEEL)&&this._actionStack.pop()}},i.prototype.doSelectorInteraction=function(t,i){if(i.skipNextObservers=!0,t.type===e.POINTERUP&&0===t.event.button){var r;if(t.pickInfo.hit&&(r=t.pickInfo.pickedMesh),this._pickedNode===r)return r.showBoundingBox=!r.showBoundingBox,void(!1===r.showBoundingBox&&(this.manipulator.detachManipulatedNode(this._pickedNode),this._pickedNode=null));this._pickedNode&&(this._pickedNode instanceof n&&(this._pickedNode.showBoundingBox=!1),this.manipulator.detachManipulatedNode(this._pickedNode),this._pickedNode=null),r&&(this._pickedNode=r,r.showBoundingBox=!0,this.manipulator.attachManipulatedNode(this._pickedNode))}},i.prototype.detectActionChanged=function(t,n){if(1===this.currentAction){if(t.type===e.POINTERDOWN&&!t.pickInfo.hit)return void this._actionStack.push(2);if(t.type===e.POINTERWHEEL)return void this._actionStack.push(2)}},i.CameratorSwitchThreshold=4,i}();t.SimpleInteractionHelper=i}(ManipulationHelpers||(ManipulationHelpers={})),function(t){var e=function(){function t(){}return t.prototype.render=function(){this.renderLight,this.renderManipulator},t}();t.SymbolicVisualHelper=e}(ManipulationHelpers||(ManipulationHelpers={})),function(t){"undefined"!=typeof module&&"object"==typeof exports?module.exports=t():"undefined"!=typeof define&&define.amd?define(["fflate",t]):("undefined"!=typeof self?self:this).fflate=t()}(function(){var t={},e=("undefined"!=typeof module&&"object"==typeof exports?function(t){"use strict";var e;try{e=require("worker_threads").Worker}catch(e){}return exports.default=e?function(t,n,i,r,s){var a=!1,o=new e(t+";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global",{eval:!0}).on("error",function(t){return s(t,null)}).on("message",function(t){return s(null,t)}).on("exit",function(t){t&&!a&&s(Error("exited with code "+t),null)});return o.postMessage(i,r),o.terminate=function(){return a=!0,e.prototype.terminate.call(o)},o}:function(t,e,n,i,r){setImmediate(function(){return r(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var s=function(){};return{terminate:s,postMessage:s}},t}:function(t){"use strict";var e={},n=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},i=function(t){return new Worker(t)};try{URL.revokeObjectURL(n(""))}catch(e){n=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},i=function(t){return new Worker(t,{type:"module"})}}return t.default=function(t,r,s,a,o){var l=i(e[r]||(e[r]=n(t)));return l.onerror=function(t){return o(t.error,null)},l.onmessage=function(t){return o(null,t.data)},l.postMessage(s,a),l},t})({}),n=Uint8Array,i=Uint16Array,r=Uint32Array,s=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(t,e){for(var n=new i(31),s=0;s<31;++s)n[s]=e+=1<<t[s-1];var a=new r(n[30]);for(s=1;s<30;++s)for(var o=n[s];o<n[s+1];++o)a[o]=o-n[s]<<5|s;return[n,a]},h=l(s,2),c=h[0],u=h[1];c[28]=258,u[258]=28;for(var d=l(a,0),p=d[0],f=d[1],g=new i(32768),m=0;m<32768;++m){var v=(43690&m)>>>1|(21845&m)<<1;g[m]=((65280&(v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4))>>>8|(255&v)<<8)>>>1}var _=function(t,e,n){for(var r=t.length,s=0,a=new i(e);s<r;++s)++a[t[s]-1];var o,l=new i(e);for(s=0;s<e;++s)l[s]=l[s-1]+a[s-1]<<1;if(n){o=new i(1<<e);var h=15-e;for(s=0;s<r;++s)if(t[s])for(var c=s<<4|t[s],u=e-t[s],d=l[t[s]-1]++<<u,p=d|(1<<u)-1;d<=p;++d)o[g[d]>>>h]=c}else for(o=new i(r),s=0;s<r;++s)t[s]&&(o[s]=g[l[t[s]-1]++]>>>15-t[s]);return o},y=new n(288);for(m=0;m<144;++m)y[m]=8;for(m=144;m<256;++m)y[m]=9;for(m=256;m<280;++m)y[m]=7;for(m=280;m<288;++m)y[m]=8;var x=new n(32);for(m=0;m<32;++m)x[m]=5;var b=_(y,9,0),w=_(y,9,1),S=_(x,5,0),M=_(x,5,1),T=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},E=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},C=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},A=function(t){return(t/8|0)+(7&t&&1)},R=function(t,e,s){(null==e||e<0)&&(e=0),(null==s||s>t.length)&&(s=t.length);var a=new(t instanceof i?i:t instanceof r?r:n)(s-e);return a.set(t.subarray(e,s)),a},L=function(t,e,i){var r=t.length;if(!r||i&&!i.l&&r<5)return e||new n(0);var l=!e||i,h=!i||i.i;i||(i={}),e||(e=new n(3*r));var u=function(t){var i=e.length;if(t>i){var r=new n(Math.max(2*i,t));r.set(e),e=r}},d=i.f||0,f=i.p||0,g=i.b||0,m=i.l,v=i.d,y=i.m,x=i.n,b=8*r;do{if(!m){i.f=d=E(t,f,1);var S=E(t,f+1,3);if(f+=3,!S){var L=t[(G=A(f)+4)-4]|t[G-3]<<8,P=G+L;if(P>r){if(h)throw"unexpected EOF";break}l&&u(g+L),e.set(t.subarray(G,P),g),i.b=g+=L,i.p=f=8*P;continue}if(1==S)m=w,v=M,y=9,x=5;else{if(2!=S)throw"invalid block type";var k=E(t,f,31)+257,D=E(t,f+10,15)+4,I=k+E(t,f+5,31)+1;f+=14;for(var O=new n(I),B=new n(19),F=0;F<D;++F)B[o[F]]=E(t,f+3*F,7);f+=3*D;var N=T(B),U=(1<<N)-1,z=_(B,N,1);for(F=0;F<I;){var G,H=z[E(t,f,U)];if(f+=15&H,(G=H>>>4)<16)O[F++]=G;else{var W=0,V=0;for(16==G?(V=3+E(t,f,3),f+=2,W=O[F-1]):17==G?(V=3+E(t,f,7),f+=3):18==G&&(V=11+E(t,f,127),f+=7);V--;)O[F++]=W}}var j=O.subarray(0,k),X=O.subarray(k);y=T(j),x=T(X),m=_(j,y,1),v=_(X,x,1)}if(f>b){if(h)throw"unexpected EOF";break}}l&&u(g+131072);for(var Y=(1<<y)-1,Z=(1<<x)-1,q=f;;q=f){var J=(W=m[C(t,f)&Y])>>>4;if((f+=15&W)>b){if(h)throw"unexpected EOF";break}if(!W)throw"invalid length/literal";if(J<256)e[g++]=J;else{if(256==J){q=f,m=null;break}var K=J-254;J>264&&(K=E(t,f,(1<<(tt=s[F=J-257]))-1)+c[F],f+=tt);var Q=v[C(t,f)&Z],$=Q>>>4;if(!Q)throw"invalid distance";if(f+=15&Q,X=p[$],$>3){var tt=a[$];X+=C(t,f)&(1<<tt)-1,f+=tt}if(f>b){if(h)throw"unexpected EOF";break}l&&u(g+131072);for(var et=g+K;g<et;g+=4)e[g]=e[g-X],e[g+1]=e[g+1-X],e[g+2]=e[g+2-X],e[g+3]=e[g+3-X];g=et}}i.l=m,i.p=q,i.b=g,m&&(d=1,i.m=y,i.d=v,i.n=x)}while(!d);return g==e.length?e:R(e,0,g)},P=function(t,e,n){var i=e/8|0;t[i]|=n<<=7&e,t[i+1]|=n>>>8},k=function(t,e,n){var i=e/8|0;t[i]|=n<<=7&e,t[i+1]|=n>>>8,t[i+2]|=n>>>16},D=function(t,e){for(var r=[],s=0;s<t.length;++s)t[s]&&r.push({s:s,f:t[s]});var a=r.length,o=r.slice();if(!a)return[z,0];if(1==a){var l=new n(r[0].s+1);return l[r[0].s]=1,[l,1]}r.sort(function(t,e){return t.f-e.f}),r.push({s:-1,f:25001});var h=r[0],c=r[1],u=0,d=1,p=2;for(r[0]={s:-1,f:h.f+c.f,l:h,r:c};d!=a-1;)h=r[r[u].f<r[p].f?u++:p++],c=r[u!=d&&r[u].f<r[p].f?u++:p++],r[d++]={s:-1,f:h.f+c.f,l:h,r:c};var f=o[0].s;for(s=1;s<a;++s)o[s].s>f&&(f=o[s].s);var g=new i(f+1),m=I(r[d-1],g,0);if(m>e){s=0;var v=0,_=m-e,y=1<<_;for(o.sort(function(t,e){return g[e.s]-g[t.s]||t.f-e.f});s<a;++s){var x=o[s].s;if(!(g[x]>e))break;v+=y-(1<<m-g[x]),g[x]=e}for(v>>>=_;v>0;){var b=o[s].s;g[b]<e?v-=1<<e-g[b]++-1:++s}for(;s>=0&&v;--s){var w=o[s].s;g[w]==e&&(--g[w],++v)}m=e}return[new n(g),m]},I=function(t,e,n){return-1==t.s?Math.max(I(t.l,e,n+1),I(t.r,e,n+1)):e[t.s]=n},O=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new i(++e),r=0,s=t[0],a=1,o=function(t){n[r++]=t},l=1;l<=e;++l)if(t[l]==s&&l!=e)++a;else{if(!s&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(s),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(s);a=1,s=t[l]}return[n.subarray(0,r),e]},B=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},F=function(t,e,n){var i=n.length,r=A(e+2);t[r]=255&i,t[r+1]=i>>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var s=0;s<i;++s)t[r+s+4]=n[s];return 8*(r+4+i)},N=function(t,e,n,r,l,h,c,u,d,p,f){P(e,f++,n),++l[256];for(var g=D(l,15),m=g[0],v=g[1],w=D(h,15),M=w[0],T=w[1],E=O(m),C=E[0],A=E[1],R=O(M),L=R[0],I=R[1],N=new i(19),U=0;U<C.length;++U)N[31&C[U]]++;for(U=0;U<L.length;++U)N[31&L[U]]++;for(var z=D(N,7),G=z[0],H=z[1],W=19;W>4&&!G[o[W-1]];--W);var V,j,X,Y,Z=p+5<<3,q=B(l,y)+B(h,x)+c,J=B(l,m)+B(h,M)+c+14+3*W+B(N,G)+(2*N[16]+3*N[17]+7*N[18]);if(Z<=q&&Z<=J)return F(e,f,t.subarray(d,d+p));if(P(e,f,1+(J<q)),f+=2,J<q){V=_(m,v,0),j=m,X=_(M,T,0),Y=M;var K=_(G,H,0);for(P(e,f,A-257),P(e,f+5,I-1),P(e,f+10,W-4),f+=14,U=0;U<W;++U)P(e,f+3*U,G[o[U]]);f+=3*W;for(var Q=[C,L],$=0;$<2;++$){var tt=Q[$];for(U=0;U<tt.length;++U)P(e,f,K[et=31&tt[U]]),f+=G[et],et>15&&(P(e,f,tt[U]>>>5&127),f+=tt[U]>>>12)}}else V=b,j=y,X=S,Y=x;for(U=0;U<u;++U)if(r[U]>255){var et;k(e,f,V[257+(et=r[U]>>>18&31)]),f+=j[et+257],et>7&&(P(e,f,r[U]>>>23&31),f+=s[et]);var nt=31&r[U];k(e,f,X[nt]),f+=Y[nt],nt>3&&(k(e,f,r[U]>>>5&8191),f+=a[nt])}else k(e,f,V[r[U]]),f+=j[r[U]];return k(e,f,V[256]),f+j[256]},U=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),z=new n(0),G=function(t,e,o,l,h,c){var d=t.length,p=new n(l+d+5*(1+Math.ceil(d/7e3))+h),g=p.subarray(l,p.length-h),m=0;if(!e||d<8)for(var v=0;v<=d;v+=65535){var _=v+65535;_<d?m=F(g,m,t.subarray(v,_)):(g[v]=c,m=F(g,m,t.subarray(v,d)))}else{for(var y=U[e-1],x=y>>>13,b=8191&y,w=(1<<o)-1,S=new i(32768),M=new i(w+1),T=Math.ceil(o/3),E=2*T,C=function(e){return(t[e]^t[e+1]<<T^t[e+2]<<E)&w},L=new r(25e3),P=new i(288),k=new i(32),D=0,I=0,O=(v=0,0),B=0,G=0;v<d;++v){var H=C(v),W=32767&v,V=M[H];if(S[W]=V,M[H]=W,B<=v){var j=d-v;if((D>7e3||O>24576)&&j>423){m=N(t,g,0,L,P,k,I,O,G,v-G,m),O=D=I=0,G=v;for(var X=0;X<286;++X)P[X]=0;for(X=0;X<30;++X)k[X]=0}var Y=2,Z=0,q=b,J=W-V&32767;if(j>2&&H==C(v-J))for(var K=Math.min(x,j)-1,Q=Math.min(32767,v),$=Math.min(258,j);J<=Q&&--q&&W!=V;){if(t[v+Y]==t[v+Y-J]){for(var tt=0;tt<$&&t[v+tt]==t[v+tt-J];++tt);if(tt>Y){if(Y=tt,Z=J,tt>K)break;var et=Math.min(J,tt-2),nt=0;for(X=0;X<et;++X){var it=v-J+X+32768&32767,rt=it-S[it]+32768&32767;rt>nt&&(nt=rt,V=it)}}}J+=(W=V)-(V=S[W])+32768&32767}if(Z){L[O++]=268435456|u[Y]<<18|f[Z];var st=31&u[Y],at=31&f[Z];I+=s[st]+a[at],++P[257+st],++k[at],B=v+Y,++D}else L[O++]=t[v],++P[t[v]]}}m=N(t,g,c,L,P,k,I,O,G,v-G,m),!c&&7&m&&(m=F(g,m+1,z))}return R(p,0,l+A(m)+h)},H=function(){for(var t=new r(256),e=0;e<256;++e){for(var n=e,i=9;--i;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),W=function(){var t=-1;return{p:function(e){for(var n=t,i=0;i<e.length;++i)n=H[255&n^e[i]]^n>>>8;t=n},d:function(){return~t}}},V=function(){var t=1,e=0;return{p:function(n){for(var i=t,r=e,s=n.length,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)r+=i+=n[a];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}t=i,e=r},d:function(){return(255&(t%=65521))<<24|t>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},j=function(t,e,n,i,r){return G(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,i,!r)},X=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},Y=function(t,e,n){for(var i=t(),r=""+t,s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<i.length;++a){var o=i[a],l=s[a];if("function"==typeof o){e+=";"+l+"=";var h=""+o;if(o.prototype)if(-1!=h.indexOf("[native code]")){var c=h.indexOf(" ",8)+1;e+=h.slice(c,h.indexOf("(",c))}else for(var u in e+=h,o.prototype)e+=";"+l+".prototype."+u+"="+o.prototype[u];else e+=h}else n[l]=o}return[e,n]},Z=[],q=function(t){var e=[];for(var s in t)(t[s]instanceof n||t[s]instanceof i||t[s]instanceof r)&&e.push((t[s]=new t[s].constructor(t[s])).buffer);return e},J=function(t,n,i,r){var s;if(!Z[i]){for(var a="",o={},l=t.length-1,h=0;h<l;++h)a=(s=Y(t[h],a,o))[0],o=s[1];Z[i]=Y(t[l],a,o)}var c=X({},Z[i][1]);return e.default(Z[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+n+"}",i,c,q(c),r)},K=function(){return[n,i,r,s,a,o,c,p,w,M,g,_,T,E,C,A,R,L,Et,it,rt]},Q=function(){return[n,i,r,s,a,o,u,f,b,y,S,x,g,U,z,_,P,k,D,I,O,B,F,N,A,R,G,j,wt,it]},$=function(){return[dt,gt,ut,W,H]},tt=function(){return[pt,ft]},et=function(){return[mt,ut,V]},nt=function(){return[vt]},it=function(t){return postMessage(t,[t.buffer])},rt=function(t){return t&&t.size&&new n(t.size)},st=function(t,e,n,i,r,s){var a=J(n,i,r,function(t,e){a.terminate(),s(t,e)});return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}},at=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},ot=function(t,e,n,i,r){var s,a=J(t,i,r,function(t,n){t?(a.terminate(),e.ondata.call(e,t)):(n[1]&&a.terminate(),e.ondata.call(e,t,n[0],n[1]))});a.postMessage(n),e.push=function(t,n){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([t,s=n],[t.buffer])},e.terminate=function(){a.terminate()}},lt=function(t,e){return t[e]|t[e+1]<<8},ht=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},ct=function(t,e){return ht(t,e)+4294967296*ht(t,e+4)},ut=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},dt=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&ut(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var i=0;i<=n.length;++i)t[i+10]=n.charCodeAt(i)}},pt=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],n=10;4&e&&(n+=t[10]|2+(t[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[n++]);return n+(2&e)},ft=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},gt=function(t){return 10+(t.filename&&t.filename.length+1||0)},mt=function(t,e){var n=e.level,i=0==n?0:n<6?1:9==n?3:2;t[0]=120,t[1]=i<<6|(i?32-2*i:1)},vt=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function _t(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var yt=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(j(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}();t.Deflate=yt;var xt=function(t,e){ot([Q,function(){return[at,yt]}],this,_t.call(this,t,e),function(t){var e=new yt(t.data);onmessage=at(e)},6)};function bt(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return st(t,e,[Q],function(t){return it(wt(t.data[0],t.data[1]))},0,n)}function wt(t,e){return j(t,e||{},0,0)}t.AsyncDeflate=xt,t.deflate=bt,t.deflateSync=wt;var St=function(){function t(t){this.s={},this.p=new n(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,i=new n(e+t.length);i.set(this.p),i.set(t,e),this.p=i},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,n=L(this.p,this.o,this.s);this.ondata(R(n,e,this.s.b),this.d),this.o=R(n,this.s.b-32768),this.s.b=this.o.length,this.p=R(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}();t.Inflate=St;var Mt=function(t){this.ondata=t,ot([K,function(){return[at,St]}],this,0,function(){var t=new St;onmessage=at(t)},7)};function Tt(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return st(t,e,[K],function(t){return it(Et(t.data[0],rt(t.data[1])))},1,n)}function Et(t,e){return L(t,e)}t.AsyncInflate=Mt,t.inflate=Tt,t.inflateSync=Et;var Ct=function(){function t(t,e){this.c=W(),this.l=0,this.v=1,yt.call(this,t,e)}return t.prototype.push=function(t,e){yt.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var n=j(t,this.o,this.v&&gt(this.o),e&&8,!e);this.v&&(dt(n,this.o),this.v=0),e&&(ut(n,n.length-8,this.c.d()),ut(n,n.length-4,this.l)),this.ondata(n,e)},t}();t.Gzip=Ct,t.Compress=Ct;var At=function(t,e){ot([Q,$,function(){return[at,yt,Ct]}],this,_t.call(this,t,e),function(t){var e=new Ct(t.data);onmessage=at(e)},8)};function Rt(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return st(t,e,[Q,$,function(){return[Lt]}],function(t){return it(Lt(t.data[0],t.data[1]))},2,n)}function Lt(t,e){e||(e={});var n=W(),i=t.length;n.p(t);var r=j(t,e,gt(e),8),s=r.length;return dt(r,e),ut(r,s-8,n.d()),ut(r,s-4,i),r}t.AsyncGzip=At,t.AsyncCompress=At,t.gzip=Rt,t.compress=Rt,t.gzipSync=Lt,t.compressSync=Lt;var Pt=function(){function t(t){this.v=1,St.call(this,t)}return t.prototype.push=function(t,e){if(St.prototype.e.call(this,t),this.v){var n=this.p.length>3?pt(this.p):4;if(n>=this.p.length&&!e)return;this.p=this.p.subarray(n),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}St.prototype.c.call(this,e)},t}();t.Gunzip=Pt;var kt=function(t){this.ondata=t,ot([K,tt,function(){return[at,St,Pt]}],this,0,function(){var t=new Pt;onmessage=at(t)},9)};function Dt(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return st(t,e,[K,tt,function(){return[It]}],function(t){return it(It(t.data[0]))},3,n)}function It(t,e){return L(t.subarray(pt(t),-8),e||new n(ft(t)))}t.AsyncGunzip=kt,t.gunzip=Dt,t.gunzipSync=It;var Ot=function(){function t(t,e){this.c=V(),this.v=1,yt.call(this,t,e)}return t.prototype.push=function(t,e){yt.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var n=j(t,this.o,this.v&&2,e&&4,!e);this.v&&(mt(n,this.o),this.v=0),e&&ut(n,n.length-4,this.c.d()),this.ondata(n,e)},t}();t.Zlib=Ot;function Bt(t,e){e||(e={});var n=V();n.p(t);var i=j(t,e,2,4);return mt(i,e),ut(i,i.length-4,n.d()),i}t.AsyncZlib=function(t,e){ot([Q,et,function(){return[at,yt,Ot]}],this,_t.call(this,t,e),function(t){var e=new Ot(t.data);onmessage=at(e)},10)},t.zlib=function(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return st(t,e,[Q,et,function(){return[Bt]}],function(t){return it(Bt(t.data[0],t.data[1]))},4,n)},t.zlibSync=Bt;var Ft=function(){function t(t){this.v=1,St.call(this,t)}return t.prototype.push=function(t,e){if(St.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}St.prototype.c.call(this,e)},t}();t.Unzlib=Ft;var Nt=function(t){this.ondata=t,ot([K,nt,function(){return[at,St,Ft]}],this,0,function(){var t=new Ft;onmessage=at(t)},11)};function Ut(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return st(t,e,[K,nt,function(){return[zt]}],function(t){return it(zt(t.data[0],rt(t.data[1])))},5,n)}function zt(t,e){return L((vt(t),t.subarray(2,-4)),e)}t.AsyncUnzlib=Nt,t.unzlib=Ut,t.unzlibSync=zt;var Gt=function(){function t(t){this.G=Pt,this.I=St,this.Z=Ft,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var i=new n(this.p.length+t.length);i.set(this.p),i.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var r=this,s=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(s):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,e),this.p=null}}},t}();t.Decompress=Gt;var Ht=function(){function t(t){this.G=kt,this.I=Mt,this.Z=Nt,this.ondata=t}return t.prototype.push=function(t,e){Gt.prototype.push.call(this,t,e)},t}();t.AsyncDecompress=Ht,t.decompress=function(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?Dt(t,e,n):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Tt(t,e,n):Ut(t,e,n)},t.decompressSync=function(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?It(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Et(t,e):zt(t,e)};var Wt=function(t,e,i,r){for(var s in t){var a=t[s],o=e+s;a instanceof n?i[o]=[a,r]:Array.isArray(a)?i[o]=[a[0],X(r,a[1])]:Wt(a,o+"/",i,r)}},Vt="undefined"!=typeof TextEncoder&&new TextEncoder,jt="undefined"!=typeof TextDecoder&&new TextDecoder,Xt=0;try{jt.decode(z,{stream:!0}),Xt=1}catch(e){}var Yt=function(t){for(var e="",n=0;;){var i=t[n++],r=(i>127)+(i>223)+(i>239);if(n+r>t.length)return[e,R(t,n-1)];r?3==r?(i=((15&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=String.fromCharCode(1&r?(31&i)<<6|63&t[n++]:(15&i)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(i)}},Zt=function(){function t(t){this.ondata=t,Xt?this.t=new TextDecoder:this.p=z}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var i=new n(this.p.length+t.length);i.set(this.p),i.set(t,this.p.length);var r=Yt(i),s=r[0],a=r[1];if(e){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(s,e)}},t}();t.DecodeUTF8=Zt;var qt=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Jt(t),this.d=e||!1)},t}();function Jt(t,e){if(e){for(var i=new n(t.length),r=0;r<t.length;++r)i[r]=t.charCodeAt(r);return i}if(Vt)return Vt.encode(t);var s=t.length,a=new n(t.length+(t.length>>1)),o=0,l=function(t){a[o++]=t};for(r=0;r<s;++r){if(o+5>a.length){var h=new n(o+8+(s-r<<1));h.set(a),a=h}var c=t.charCodeAt(r);c<128||e?l(c):c<2048?(l(192|c>>6),l(128|63&c)):c>55295&&c<57344?(l(240|(c=65536+(1047552&c)|1023&t.charCodeAt(++r))>>18),l(128|c>>12&63),l(128|c>>6&63),l(128|63&c)):(l(224|c>>12),l(128|c>>6&63),l(128|63&c))}return R(a,0,o)}function Kt(t,e){if(e){for(var n="",i=0;i<t.length;i+=16384)n+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return n}if(jt)return jt.decode(t);var r=Yt(t);if(r[1].length)throw"invalid utf-8 data";return r[0]}t.EncodeUTF8=qt,t.strToU8=Jt,t.strFromU8=Kt;var Qt=function(t){return 1==t?3:t<6?2:9==t?1:0},$t=function(t,e){return e+30+lt(t,e+26)+lt(t,e+28)},te=function(t,e,n){var i=lt(t,e+28),r=Kt(t.subarray(e+46,e+46+i),!(2048&lt(t,e+8))),s=e+46+i,a=ht(t,e+20),o=n&&4294967295==a?ee(t,s):[a,ht(t,e+24),ht(t,e+42)],l=o[0],h=o[1],c=o[2];return[lt(t,e+10),l,h,r,s+lt(t,e+30)+lt(t,e+32),c]},ee=function(t,e){for(;1!=lt(t,e);e+=4+lt(t,e+2));return[ct(t,e+12),ct(t,e+4),ct(t,e+20)]},ne=function(t){var e=0;if(t)for(var n in t){var i=t[n].length;if(i>65535)throw"extra field too long";e+=i+4}return e},ie=function(t,e,n,i,r,s,a,o){var l=i.length,h=n.extra,c=o&&o.length,u=ne(h);ut(t,e,null!=a?33639248:67324752),e+=4,null!=a&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(null==s&&8),t[e++]=r&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(ut(t,e,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),e+=4,null!=s&&(ut(t,e,n.crc),ut(t,e+4,s),ut(t,e+8,n.size)),ut(t,e+12,l),ut(t,e+14,u),e+=16,null!=a&&(ut(t,e,c),ut(t,e+6,n.attrs),ut(t,e+10,a),e+=14),t.set(i,e),e+=l,u)for(var f in h){var g=h[f],m=g.length;ut(t,e,+f),ut(t,e+2,m),t.set(g,e+4),e+=4+m}return c&&(t.set(o,e),e+=c),e},re=function(t,e,n,i,r){ut(t,e,101010256),ut(t,e+8,n),ut(t,e+10,n),ut(t,e+12,i),ut(t,e+16,r)},se=function(){function t(t){this.filename=t,this.c=W(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}();t.ZipPassThrough=se;var ae=function(){function t(t,e){var n=this;e||(e={}),se.call(this,t),this.d=new yt(e,function(t,e){n.ondata(null,t,e)}),this.compression=8,this.flag=Qt(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(t){this.ondata(t,null,e)}},t.prototype.push=function(t,e){se.prototype.push.call(this,t,e)},t}();t.ZipDeflate=ae;var oe=function(){function t(t,e){var n=this;e||(e={}),se.call(this,t),this.d=new xt(e,function(t,e,i){n.ondata(t,e,i)}),this.compression=8,this.flag=Qt(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){se.prototype.push.call(this,t,e)},t}();t.AsyncZipDeflate=oe;var le=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var i=Jt(t.filename),r=i.length,s=t.comment,a=s&&Jt(s),o=r!=t.filename.length||a&&s.length!=a.length,l=r+ne(t.extra)+30;if(r>65535)throw"filename too long";var h=new n(l);ie(h,0,t,i,o);var c=[h],u=function(){for(var t=0,n=c;t<n.length;t++)e.ondata(null,n[t],!1);c=[]},d=this.d;this.d=0;var p=this.u.length,f=X(t,{f:i,u:o,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(u(),d){var t=e.u[p+1];t?t.r():e.d=1}d=1}}),g=0;t.ondata=function(i,r,s){if(i)e.ondata(i,r,s),e.terminate();else if(g+=r.length,c.push(r),s){var a=new n(16);ut(a,0,134695760),ut(a,4,t.crc),ut(a,8,g),ut(a,12,t.size),c.push(a),f.c=g,f.b=l+g+16,f.crc=t.crc,f.size=t.size,d&&f.r(),d=1}else d&&u()},this.u.push(f)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,i=0,r=0,s=this.u;r<s.length;r++)i+=46+(h=s[r]).f.length+ne(h.extra)+(h.o?h.o.length:0);for(var a=new n(i+22),o=0,l=this.u;o<l.length;o++){var h;ie(a,t,h=l[o],h.f,h.u,h.c,e,h.o),t+=46+h.f.length+ne(h.extra)+(h.o?h.o.length:0),e+=h.b}re(a,t,this.u.length,i,e),this.ondata(null,a,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++)e[t].t();this.d=2},t}();t.Zip=le,t.zip=function(t,e,i){if(i||(i=e,e={}),"function"!=typeof i)throw"no callback";var r={};Wt(t,"",r,e);var s=Object.keys(r),a=s.length,o=0,l=0,h=a,c=Array(a),u=[],d=function(){for(var t=0;t<u.length;++t)u[t]()},p=function(){var t=new n(l+22),e=o,r=l-o;l=0;for(var s=0;s<h;++s){var a=c[s];try{var u=a.c.length;ie(t,l,a,a.f,a.u,u);var d=30+a.f.length+ne(a.extra),p=l+d;t.set(a.c,p),ie(t,o,a,a.f,a.u,u,l,a.m),o+=16+d+(a.m?a.m.length:0),l=p+u}catch(t){return i(t,null)}}re(t,o,c.length,r,e),i(null,t)};a||p();for(var f=function(t){var e=s[t],n=r[e],h=n[0],f=n[1],g=W(),m=h.length;g.p(h);var v=Jt(e),_=v.length,y=f.comment,x=y&&Jt(y),b=x&&x.length,w=ne(f.extra),S=0==f.level?0:8,M=function(n,r){if(n)d(),i(n,null);else{var s=r.length;c[t]=X(f,{size:m,crc:g.d(),c:r,f:v,m:x,u:_!=e.length||x&&y.length!=b,compression:S}),o+=30+_+w+s,l+=76+2*(_+w)+(b||0)+s,--a||p()}};if(_>65535&&M("filename too long",null),S)if(m<16e4)try{M(null,wt(h,f))}catch(t){M(t,null)}else u.push(bt(h,f,M));else M(null,h)},g=0;g<h;++g)f(g);return d},t.zipSync=function(t,e){e||(e={});var i={},r=[];Wt(t,"",i,e);var s=0,a=0;for(var o in i){var l=i[o],h=l[0],c=l[1],u=0==c.level?0:8,d=(M=Jt(o)).length,p=c.comment,f=p&&Jt(p),g=f&&f.length,m=ne(c.extra);if(d>65535)throw"filename too long";var v=u?wt(h,c):h,_=v.length,y=W();y.p(h),r.push(X(c,{size:h.length,crc:y.d(),c:v,f:M,m:f,u:d!=o.length||f&&p.length!=g,o:s,compression:u})),s+=30+d+m+_,a+=76+2*(d+m)+(g||0)+_}for(var x=new n(a+22),b=s,w=a-s,S=0;S<r.length;++S){var M;ie(x,(M=r[S]).o,M,M.f,M.u,M.c.length);var T=30+M.f.length+ne(M.extra);x.set(M.c,M.o+T),ie(x,s,M,M.f,M.u,M.c.length,M.o,M.m),s+=16+T+(M.m?M.m.length:0)}return re(x,s,r.length,w,b),x};var he=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}();t.UnzipPassThrough=he;var ce=function(){function t(){var t=this;this.i=new St(function(e,n){t.ondata(null,e,n)})}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(n){this.ondata(n,t,e)}},t.compression=8,t}();t.UnzipInflate=ce;var ue=function(){function t(t,e){var n=this;e<32e4?this.i=new St(function(t,e){n.ondata(null,t,e)}):(this.i=new Mt(function(t,e,i){n.ondata(t,e,i)}),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=R(t,0)),this.i.push(t,e)},t.compression=8,t}();t.AsyncUnzipInflate=ue;var de=function(){function t(t){this.onfile=t,this.k=[],this.o={0:he},this.p=z}return t.prototype.push=function(t,e){var i=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,t.length),s=t.subarray(0,r);if(this.c-=r,this.d?this.d.push(s,!this.c):this.k[0].push(s),(t=t.subarray(r)).length)return this.push(t,e)}else{var a=0,o=0,l=void 0,h=void 0;this.p.length?t.length?((h=new n(this.p.length+t.length)).set(this.p),h.set(t,this.p.length)):h=this.p:h=t;for(var c=h.length,u=this.c,d=u&&this.d,p=function(){var t,e=ht(h,o);if(67324752==e){a=1,l=o,f.d=null,f.c=0;var n=lt(h,o+6),r=lt(h,o+8),s=2048&n,d=8&n,p=lt(h,o+26),g=lt(h,o+28);if(c>o+30+p+g){var m=[];f.k.unshift(m),a=2;var v,_=ht(h,o+18),y=ht(h,o+22),x=Kt(h.subarray(o+30,o+=30+p),!s);4294967295==_?(t=d?[-2]:ee(h,o),_=t[0],y=t[1]):d&&(_=-1),o+=g,f.c=_;var b={name:x,compression:r,start:function(){if(!b.ondata)throw"no callback";if(_){var t=i.o[r];if(!t)throw"unknown compression type "+r;(v=_<0?new t(x):new t(x,_,y)).ondata=function(t,e,n){b.ondata(t,e,n)};for(var e=0,n=m;e<n.length;e++)v.push(n[e],!1);i.k[0]==m&&i.c?i.d=v:v.push(z,!0)}else b.ondata(null,z,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};_>=0&&(b.size=_,b.originalSize=y),f.onfile(b)}return"break"}if(u){if(134695760==e)return l=o+=12+(-2==u&&8),a=3,f.c=0,"break";if(33639248==e)return l=o-=4,a=3,f.c=0,"break"}},f=this;o<c-4&&"break"!==p();++o);if(this.p=z,u<0){var g=h.subarray(0,a?l-12-(-2==u&&8)-(134695760==ht(h,l-16)&&4):o);d?d.push(g,!!a):this.k[+(2==a)].push(g)}if(2&a)return this.push(h.subarray(o),e);this.p=h.subarray(o)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();return t.Unzip=de,t.unzip=function(t,e){if("function"!=typeof e)throw"no callback";for(var i=[],r=function(){for(var t=0;t<i.length;++t)i[t]()},s={},a=t.length-22;101010256!=ht(t,a);--a)if(!a||t.length-a>65558)return void e("invalid zip file",null);var o=lt(t,a+8);o||e(null,{});var l=o,h=ht(t,a+16),c=4294967295==h;if(c){if(a=ht(t,a-12),101075792!=ht(t,a))return void e("invalid zip file",null);l=o=ht(t,a+32),h=ht(t,a+48)}for(var u=function(a){var l=te(t,h,c),u=l[0],d=l[1],p=l[2],f=l[3],g=l[4],m=$t(t,l[5]);h=g;var v=function(t,n){t?(r(),e(t,null)):(s[f]=n,--o||e(null,s))};if(u)if(8==u){var _=t.subarray(m,m+d);if(d<32e4)try{v(null,Et(_,new n(p)))}catch(t){v(t,null)}else i.push(Tt(_,{size:p},v))}else v("unknown compression type "+u,null);else v(null,R(t,m,m+d))},d=0;d<l;++d)u();return r},t.unzipSync=function(t){for(var e={},i=t.length-22;101010256!=ht(t,i);--i)if(!i||t.length-i>65558)throw"invalid zip file";var r=lt(t,i+8);if(!r)return{};var s=ht(t,i+16),a=4294967295==s;if(a){if(i=ht(t,i-12),101075792!=ht(t,i))throw"invalid zip file";r=ht(t,i+32),s=ht(t,i+48)}for(var o=0;o<r;++o){var l=te(t,s,a),h=l[0],c=l[1],u=l[2],d=l[3],p=l[4],f=$t(t,l[5]);if(s=p,h){if(8!=h)throw"unknown compression type "+h;e[d]=Et(t.subarray(f,f+c),new n(u))}else e[d]=R(t,f,f+c)}return e},t}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={})}(this,function(t){"use strict";const e="135",n=100,i=300,r=301,s=302,a=303,o=304,l=306,h=307,c=1e3,u=1001,d=1002,p=1003,f=1004,g=1005,m=1006,v=1007,_=1008,y=1009,x=1012,b=1014,w=1015,S=1016,M=1020,T=1022,E=1023,C=1026,A=1027,R=33776,L=33777,P=33778,k=33779,D=35840,I=35841,O=35842,B=35843,F=37492,N=37496,U=2300,z=2301,G=2302,H=2400,W=2401,V=2402,j=2500,X=2501,Y=3e3,Z=3001,q=3007,J=3002,K=3004,Q=3005,$=3006,tt=7680,et=35044,nt=35048,it="300 es";class rt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const st=[];for(let t=0;t<256;t++)st[t]=(t<16?"0":"")+t.toString(16);let at=1234567;const ot=Math.PI/180,lt=180/Math.PI;function ht(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(st[255&t]+st[t>>8&255]+st[t>>16&255]+st[t>>24&255]+"-"+st[255&e]+st[e>>8&255]+"-"+st[e>>16&15|64]+st[e>>24&255]+"-"+st[63&n|128]+st[n>>8&255]+"-"+st[n>>16&255]+st[n>>24&255]+st[255&i]+st[i>>8&255]+st[i>>16&255]+st[i>>24&255]).toUpperCase()}function ct(t,e,n){return Math.max(e,Math.min(n,t))}function ut(t,e){return(t%e+e)%e}function dt(t,e,n){return(1-n)*t+n*e}function pt(t){return 0==(t&t-1)&&0!==t}function ft(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function gt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var mt=Object.freeze({__proto__:null,DEG2RAD:ot,RAD2DEG:lt,generateUUID:ht,clamp:ct,euclideanModulo:ut,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:dt,damp:function(t,e,n,i){return dt(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(ut(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(at=t%2147483647),((at=16807*at%2147483647)-1)/2147483646},degToRad:function(t){return t*ot},radToDeg:function(t){return t*lt},isPowerOfTwo:pt,ceilPowerOfTwo:ft,floorPowerOfTwo:gt,setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),h=s((e+i)/2),c=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),f=a((i-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class vt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}vt.prototype.isVector2=!0;class _t{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,a,o,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=n,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],h=n[4],c=n[7],u=n[2],d=n[5],p=n[8],f=i[0],g=i[3],m=i[6],v=i[1],_=i[4],y=i[7],x=i[2],b=i[5],w=i[8];return r[0]=s*f+a*v+o*x,r[3]=s*g+a*_+o*b,r[6]=s*m+a*y+o*w,r[1]=l*f+h*v+c*x,r[4]=l*g+h*_+c*b,r[7]=l*m+h*y+c*w,r[2]=u*f+d*v+p*x,r[5]=u*g+d*_+p*b,r[8]=u*m+d*y+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-n*r*h+n*a*o+i*r*l-i*s*o}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,u=a*o-h*r,d=l*r-s*o,p=e*c+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(i*l-h*n)*f,t[2]=(a*n-i*s)*f,t[3]=u*f,t[4]=(h*e-i*o)*f,t[5]=(i*r-a*e)*f,t[6]=d*f,t[7]=(n*o-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+t,-i*l,i*o,-i*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],s=i[3],a=i[6],o=i[1],l=i[4],h=i[7];return i[0]=e*r+n*o,i[3]=e*s+n*l,i[6]=e*a+n*h,i[1]=-n*r+e*o,i[4]=-n*s+e*l,i[7]=-n*a+e*h,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function yt(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}_t.prototype.isMatrix3=!0;const xt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function bt(t,e){return new xt[t](e)}function wt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function St(t,e=0){let n=3735928559^e,i=1103547991^e;for(let e,r=0;r<t.length;r++)e=t.charCodeAt(r),n=Math.imul(n^e,2654435761),i=Math.imul(i^e,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&(i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909)))+(n>>>0)}let Mt;class Tt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Mt&&(Mt=wt("canvas")),Mt.width=t.width,Mt.height=t.height;const n=Mt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Mt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let Et=0;class Ct extends rt{constructor(t=Ct.DEFAULT_IMAGE,e=Ct.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,l=1,h=3e3){super(),Object.defineProperty(this,"id",{value:Et++}),this.uuid=ht(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new vt(0,0),this.repeat=new vt(1,1),this.center=new vt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new _t,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=ht()),!e&&void 0===t.images[i.uuid]){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(At(i[t].image)):e.push(At(i[t]))}else e=At(i);t.images[i.uuid]={uuid:i.uuid,url:e}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==i)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case c:t.x=t.x-Math.floor(t.x);break;case u:t.x=t.x<0?0:1;break;case d:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case c:t.y=t.y-Math.floor(t.y);break;case u:t.y=t.y<0?0:1;break;case d:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function At(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Tt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Ct.DEFAULT_IMAGE=void 0,Ct.DEFAULT_MAPPING=i,Ct.prototype.isTexture=!0;class Rt{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,a=t.elements,o=a[0],l=a[4],h=a[8],c=a[1],u=a[5],d=a[9],p=a[2],f=a[6],g=a[10];if(Math.abs(l-c)<s&&Math.abs(h-p)<s&&Math.abs(d-f)<s){if(Math.abs(l+c)<.1&&Math.abs(h+p)<.1&&Math.abs(d+f)<.1&&Math.abs(o+u+g-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(o+1)/2,a=(u+1)/2,m=(g+1)/2,v=(l+c)/4,_=(h+p)/4,y=(d+f)/4;return t>a&&t>m?t<s?(n=0,i=.707106781,r=.707106781):(i=v/(n=Math.sqrt(t)),r=_/n):a>m?a<s?(n=.707106781,i=0,r=.707106781):(n=v/(i=Math.sqrt(a)),r=y/i):m<s?(n=.707106781,i=.707106781,r=0):(n=_/(r=Math.sqrt(m)),i=y/r),this.set(n,i,r,e),this}let m=Math.sqrt((f-d)*(f-d)+(h-p)*(h-p)+(c-l)*(c-l));return Math.abs(m)<.001&&(m=1),this.x=(f-d)/m,this.y=(h-p)/m,this.z=(c-l)/m,this.w=Math.acos((o+u+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Rt.prototype.isVector4=!0;class Lt extends rt{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Rt(0,0,t,e),this.scissorTest=!1,this.viewport=new Rt(0,0,t,e),this.texture=new Ct(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:m,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=_objectSpread({},this.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Lt.prototype.isWebGLRenderTarget=!0;class Pt extends Lt{constructor(t,e,n){super(t,e);const i=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=i.clone()}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}Pt.prototype.isWebGLMultipleRenderTargets=!0;class kt extends Lt{constructor(t,e,n={}){super(t,e,n),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===n.ignoreDepth||n.ignoreDepth,this.useRenderToTexture=void 0!==n.useRenderToTexture&&n.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(t){return super.copy.call(this,t),this.samples=t.samples,this.useRenderToTexture=t.useRenderToTexture,this.useRenderbuffer=t.useRenderbuffer,this}}kt.prototype.isWebGLMultisampleRenderTarget=!0;class Dt{constructor(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,i)}static slerpFlat(t,e,n,i,r,s,a){let o=n[i+0],l=n[i+1],h=n[i+2],c=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],h=n[i+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(n/2),h=a(i/2),c=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=n+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>a&&n>c){const t=2*Math.sqrt(1+n-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-n-c);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-n-a);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ct(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=n*h+s*a+i*l-r*o,this._y=i*h+s*o+r*a-n*l,this._z=r*h+s*l+n*o-i*a,this._w=s*h-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=n*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Dt.prototype.isQuaternion=!0;class It{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Bt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Bt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*i-a*n,h=o*n+a*e-r*i,c=o*i+r*n-s*e,u=-r*e-s*n-a*i;return this.x=l*o+u*-r+h*-a-c*-s,this.y=h*o+u*-s+c*-r-l*-a,this.z=c*o+u*-a+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Ot.copy(this).projectOnVector(t),this.sub(Ot)}reflect(t){return this.sub(Ot.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ct(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(t,2));return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}It.prototype.isVector3=!0;const Ot=new It,Bt=new Dt;class Ft{constructor(t=new It(1/0,1/0,1/0),e=new It(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<n&&(n=h),c<i&&(i=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,n,i),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<n&&(n=h),c<i&&(i=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,n,i),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Ut.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),zt.copy(e.boundingBox),zt.applyMatrix4(t.matrixWorld),this.union(zt));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ut),Ut.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Yt),Zt.subVectors(this.max,Yt),Gt.subVectors(t.a,Yt),Ht.subVectors(t.b,Yt),Wt.subVectors(t.c,Yt),Vt.subVectors(Ht,Gt),jt.subVectors(Wt,Ht),Xt.subVectors(Gt,Wt);let e=[0,-Vt.z,Vt.y,0,-jt.z,jt.y,0,-Xt.z,Xt.y,Vt.z,0,-Vt.x,jt.z,0,-jt.x,Xt.z,0,-Xt.x,-Vt.y,Vt.x,0,-jt.y,jt.x,0,-Xt.y,Xt.x,0];return!!Kt(e,Gt,Ht,Wt,Zt)&&!!Kt(e=[1,0,0,0,1,0,0,0,1],Gt,Ht,Wt,Zt)&&(qt.crossVectors(Vt,jt),Kt(e=[qt.x,qt.y,qt.z],Gt,Ht,Wt,Zt))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ut.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Ut).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Nt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Nt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Nt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Nt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Nt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Nt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Nt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Nt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Nt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Ft.prototype.isBox3=!0;const Nt=[new It,new It,new It,new It,new It,new It,new It,new It],Ut=new It,zt=new Ft,Gt=new It,Ht=new It,Wt=new It,Vt=new It,jt=new It,Xt=new It,Yt=new It,Zt=new It,qt=new It,Jt=new It;function Kt(t,e,n,i,r){for(let s=0,a=t.length-3;s<=a;s+=3){Jt.fromArray(t,s);const a=r.x*Math.abs(Jt.x)+r.y*Math.abs(Jt.y)+r.z*Math.abs(Jt.z),o=e.dot(Jt),l=n.dot(Jt),h=i.dot(Jt);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const Qt=new Ft,$t=new It,te=new It,ee=new It;class ne{constructor(t=new It,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Qt.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){ee.subVectors(t,this.center);const e=ee.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(ee.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return te.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint($t.copy(t.center).add(te)),this.expandByPoint($t.copy(t.center).sub(te)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ie=new It,re=new It,se=new It,ae=new It,oe=new It,le=new It,he=new It;class ce{constructor(t=new It,e=new It(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ie)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ie.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ie.copy(this.direction).multiplyScalar(e).add(this.origin),ie.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){re.copy(t).add(e).multiplyScalar(.5),se.copy(e).sub(t).normalize(),ae.copy(this.origin).sub(re);const r=.5*t.distanceTo(e),s=-this.direction.dot(se),a=ae.dot(this.direction),o=-ae.dot(se),l=ae.lengthSq(),h=Math.abs(1-s*s);let c,u,d,p;if(h>0)if(u=s*a-o,p=r*h,(c=s*o-a)>=0)if(u>=-p)if(u<=p){const t=1/h;d=(c*=t)*(c+s*(u*=t)+2*a)+u*(s*c+u+2*o)+l}else u=r,d=-(c=Math.max(0,-(s*u+a)))*c+u*(u+2*o)+l;else u=-r,d=-(c=Math.max(0,-(s*u+a)))*c+u*(u+2*o)+l;else u<=-p?d=-(c=Math.max(0,-(-s*r+a)))*c+(u=c>0?-r:Math.min(Math.max(-r,-o),r))*(u+2*o)+l:u<=p?(c=0,d=(u=Math.min(Math.max(-r,-o),r))*(u+2*o)+l):d=-(c=Math.max(0,-(s*r+a)))*c+(u=c>0?r:Math.min(Math.max(-r,-o),r))*(u+2*o)+l;else u=s>0?-r:r,d=-(c=Math.max(0,-(s*u+a)))*c+u*(u+2*o)+l;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),i&&i.copy(se).multiplyScalar(u).add(re),d}intersectSphere(t,e){ie.subVectors(t.center,this.origin);const n=ie.dot(this.direction),i=ie.dot(ie)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,ie)}intersectTriangle(t,e,n,i,r){oe.subVectors(e,t),le.subVectors(n,t),he.crossVectors(oe,le);let s,a=this.direction.dot(he);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}ae.subVectors(this.origin,t);const o=s*this.direction.dot(le.crossVectors(ae,le));if(o<0)return null;const l=s*this.direction.dot(oe.cross(ae));if(l<0)return null;if(o+l>a)return null;const h=-s*ae.dot(he);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ue{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,g){const m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=i,m[1]=r,m[5]=s,m[9]=a,m[13]=o,m[2]=l,m[6]=h,m[10]=c,m[14]=u,m[3]=d,m[7]=p,m[11]=f,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ue).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/de.setFromMatrixColumn(t,0).length(),r=1/de.setFromMatrixColumn(t,1).length(),s=1/de.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,n=s*c,i=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,n=o*c,i=l*h,r=l*c;e[0]=t+r*a,e[4]=i*a-n,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,n=o*c,i=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=i+n*a,e[1]=n+i*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,n=s*c,i=a*h,r=a*c;e[0]=o*h,e[4]=i*l-n,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=i*c+n,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=n*c+i,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=n*c-i,e[2]=i*c-n,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(fe,t,ge)}lookAt(t,e,n){const i=this.elements;return _e.subVectors(t,e),0===_e.lengthSq()&&(_e.z=1),_e.normalize(),me.crossVectors(n,_e),0===me.lengthSq()&&(1===Math.abs(n.z)?_e.x+=1e-4:_e.z+=1e-4,_e.normalize(),me.crossVectors(n,_e)),me.normalize(),ve.crossVectors(_e,me),i[0]=me.x,i[4]=ve.x,i[8]=_e.x,i[1]=me.y,i[5]=ve.y,i[9]=_e.y,i[2]=me.z,i[6]=ve.z,i[10]=_e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],h=n[1],c=n[5],u=n[9],d=n[13],p=n[2],f=n[6],g=n[10],m=n[14],v=n[3],_=n[7],y=n[11],x=n[15],b=i[0],w=i[4],S=i[8],M=i[12],T=i[1],E=i[5],C=i[9],A=i[13],R=i[2],L=i[6],P=i[10],k=i[14],D=i[3],I=i[7],O=i[11],B=i[15];return r[0]=s*b+a*T+o*R+l*D,r[4]=s*w+a*E+o*L+l*I,r[8]=s*S+a*C+o*P+l*O,r[12]=s*M+a*A+o*k+l*B,r[1]=h*b+c*T+u*R+d*D,r[5]=h*w+c*E+u*L+d*I,r[9]=h*S+c*C+u*P+d*O,r[13]=h*M+c*A+u*k+d*B,r[2]=p*b+f*T+g*R+m*D,r[6]=p*w+f*E+g*L+m*I,r[10]=p*S+f*C+g*P+m*O,r[14]=p*M+f*A+g*k+m*B,r[3]=v*b+_*T+y*R+x*D,r[7]=v*w+_*E+y*L+x*I,r[11]=v*S+_*C+y*P+x*O,r[15]=v*M+_*A+y*k+x*B,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-i*l*c-r*a*u+n*l*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-i*s*d+i*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+n*s*d+r*a*h-n*l*h)+t[15]*(-i*a*h-e*o*c+e*a*u+i*s*c-n*s*u+n*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],g=t[14],m=t[15],v=c*g*l-f*u*l+f*o*d-a*g*d-c*o*m+a*u*m,_=p*u*l-h*g*l-p*o*d+s*g*d+h*o*m-s*u*m,y=h*f*l-p*c*l+p*a*d-s*f*d-h*a*m+s*c*m,x=p*c*o-h*f*o-p*a*u+s*f*u+h*a*g-s*c*g,b=e*v+n*_+i*y+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=v*w,t[1]=(f*u*r-c*g*r-f*i*d+n*g*d+c*i*m-n*u*m)*w,t[2]=(a*g*r-f*o*r+f*i*l-n*g*l-a*i*m+n*o*m)*w,t[3]=(c*o*r-a*u*r-c*i*l+n*u*l+a*i*d-n*o*d)*w,t[4]=_*w,t[5]=(h*g*r-p*u*r+p*i*d-e*g*d-h*i*m+e*u*m)*w,t[6]=(p*o*r-s*g*r-p*i*l+e*g*l+s*i*m-e*o*m)*w,t[7]=(s*u*r-h*o*r+h*i*l-e*u*l-s*i*d+e*o*d)*w,t[8]=y*w,t[9]=(p*c*r-h*f*r-p*n*d+e*f*d+h*n*m-e*c*m)*w,t[10]=(s*f*r-p*a*r+p*n*l-e*f*l-s*n*m+e*a*m)*w,t[11]=(h*a*r-s*c*r-h*n*l+e*c*l+s*n*d-e*a*d)*w,t[12]=x*w,t[13]=(h*f*i-p*c*i+p*n*u-e*f*u-h*n*g+e*c*g)*w,t[14]=(p*a*i-s*f*i-p*n*o+e*f*o+s*n*g-e*a*g)*w,t[15]=(s*c*i-h*a*i+h*n*o-e*c*o-s*n*u+e*a*u)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,h*a+n,h*o-i*s,0,l*o-i*a,h*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,g=s*c,m=a*c,v=o*l,_=o*h,y=o*c,x=n.x,b=n.y,w=n.z;return i[0]=(1-(f+m))*x,i[1]=(d+y)*x,i[2]=(p-_)*x,i[3]=0,i[4]=(d-y)*b,i[5]=(1-(u+m))*b,i[6]=(g+v)*b,i[7]=0,i[8]=(p+_)*w,i[9]=(g-v)*w,i[10]=(1-(u+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=de.set(i[0],i[1],i[2]).length();const s=de.set(i[4],i[5],i[6]).length(),a=de.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],pe.copy(this);const o=1/r,l=1/s,h=1/a;return pe.elements[0]*=o,pe.elements[1]*=o,pe.elements[2]*=o,pe.elements[4]*=l,pe.elements[5]*=l,pe.elements[6]*=l,pe.elements[8]*=h,pe.elements[9]*=h,pe.elements[10]*=h,e.setFromRotationMatrix(pe),n.x=r,n.y=s,n.z=a,this}makePerspective(t,e,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),l=2*r/(n-i),h=(e+t)/(e-t),c=(n+i)/(n-i),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,i,r,s){const a=this.elements,o=1/(e-t),l=1/(n-i),h=1/(s-r),c=(e+t)*o,u=(n+i)*l,d=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}ue.prototype.isMatrix4=!0;const de=new It,pe=new ue,fe=new It(0,0,0),ge=new It(1,1,1),me=new It,ve=new It,_e=new It,ye=new ue,xe=new Dt;class be{constructor(t=0,e=0,n=0,i=be.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],h=i[9],c=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(ct(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ct(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(ct(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-ct(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ct(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ct(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return ye.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ye,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return xe.setFromEuler(this),this.setFromQuaternion(xe,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new It(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}be.prototype.isEuler=!0,be.DefaultOrder="XYZ",be.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class we{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Se=0;const Me=new It,Te=new Dt,Ee=new ue,Ce=new It,Ae=new It,Re=new It,Le=new Dt,Pe=new It(1,0,0),ke=new It(0,1,0),De=new It(0,0,1),Ie={type:"added"},Oe={type:"removed"};class Be extends rt{constructor(){super(),Object.defineProperty(this,"id",{value:Se++}),this.uuid=ht(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Be.DefaultUp.clone();const t=new It,e=new be,n=new Dt,i=new It(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ue},normalMatrix:{value:new _t}}),this.matrix=new ue,this.matrixWorld=new ue,this.matrixAutoUpdate=Be.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new we,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Te.setFromAxisAngle(t,e),this.quaternion.multiply(Te),this}rotateOnWorldAxis(t,e){return Te.setFromAxisAngle(t,e),this.quaternion.premultiply(Te),this}rotateX(t){return this.rotateOnAxis(Pe,t)}rotateY(t){return this.rotateOnAxis(ke,t)}rotateZ(t){return this.rotateOnAxis(De,t)}translateOnAxis(t,e){return Me.copy(t).applyQuaternion(this.quaternion),this.position.add(Me.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Pe,t)}translateY(t){return this.translateOnAxis(ke,t)}translateZ(t){return this.translateOnAxis(De,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Ee.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Ce.copy(t):Ce.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ae.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ee.lookAt(Ae,Ce,this.up):Ee.lookAt(Ce,Ae,this.up),this.quaternion.setFromRotationMatrix(Ee),i&&(Ee.extractRotation(i.matrixWorld),Te.setFromRotationMatrix(Ee),this.quaternion.premultiply(Te.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ie)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Oe)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Oe)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ee.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ee.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ee),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ae,t,Re),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ae,Le,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),h=s(t.animations);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),h.length>0&&(n.animations=h)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}Be.DefaultUp=new It(0,1,0),Be.DefaultMatrixAutoUpdate=!0,Be.prototype.isObject3D=!0;const Fe=new It,Ne=new It,Ue=new It,ze=new It,Ge=new It,He=new It,We=new It,Ve=new It,je=new It,Xe=new It;class Ye{constructor(t=new It,e=new It,n=new It){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Fe.subVectors(t,e),i.cross(Fe);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Fe.subVectors(i,e),Ne.subVectors(n,e),Ue.subVectors(t,e);const s=Fe.dot(Fe),a=Fe.dot(Ne),o=Fe.dot(Ue),l=Ne.dot(Ne),h=Ne.dot(Ue),c=s*l-a*a;if(0===c)return r.set(-2,-1,-1);const u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,ze),ze.x>=0&&ze.y>=0&&ze.x+ze.y<=1}static getUV(t,e,n,i,r,s,a,o){return this.getBarycoord(t,e,n,i,ze),o.set(0,0),o.addScaledVector(r,ze.x),o.addScaledVector(s,ze.y),o.addScaledVector(a,ze.z),o}static isFrontFacing(t,e,n,i){return Fe.subVectors(n,e),Ne.subVectors(t,e),Fe.cross(Ne).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Fe.subVectors(this.c,this.b),Ne.subVectors(this.a,this.b),.5*Fe.cross(Ne).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ye.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Ye.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return Ye.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return Ye.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ye.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,a;Ge.subVectors(i,n),He.subVectors(r,n),Ve.subVectors(t,n);const o=Ge.dot(Ve),l=He.dot(Ve);if(o<=0&&l<=0)return e.copy(n);je.subVectors(t,i);const h=Ge.dot(je),c=He.dot(je);if(h>=0&&c<=h)return e.copy(i);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return s=o/(o-h),e.copy(n).addScaledVector(Ge,s);Xe.subVectors(t,r);const d=Ge.dot(Xe),p=He.dot(Xe);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(n).addScaledVector(He,a);const g=h*p-d*c;if(g<=0&&c-h>=0&&d-p>=0)return We.subVectors(r,i),a=(c-h)/(c-h+(d-p)),e.copy(i).addScaledVector(We,a);const m=1/(g+f+u);return s=f*m,a=u*m,e.copy(n).addScaledVector(Ge,s).addScaledVector(He,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Ze=0;class qe extends rt{constructor(){super(),Object.defineProperty(this,"id",{value:Ze++}),this.uuid=ht(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=E,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tt,this.stencilZFail=tt,this.stencilZPass=tt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==E&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}qe.prototype.isMaterial=!0;const Je={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ke={h:0,s:0,l:0},Qe={h:0,s:0,l:0};function $e(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function tn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function en(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class nn{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=ut(t,1),e=ct(e,0,1),n=ct(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=$e(r,i,t+1/3),this.g=$e(r,i,t),this.b=$e(r,i,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Je[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=tn(t.r),this.g=tn(t.g),this.b=tn(t.b),this}copyLinearToSRGB(t){return this.r=en(t.r),this.g=en(t.g),this.b=en(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),s=Math.min(e,n,i);let a,o;const l=(s+r)/2;if(s===r)a=0,o=0;else{const t=r-s;switch(o=l<=.5?t/(r+s):t/(2-r-s),r){case e:a=(n-i)/t+(n<i?6:0);break;case n:a=(i-e)/t+2;break;case i:a=(e-n)/t+4}a/=6}return t.h=a,t.s=o,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(Ke),Ke.h+=t,Ke.s+=e,Ke.l+=n,this.setHSL(Ke.h,Ke.s,Ke.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Ke),t.getHSL(Qe);const n=dt(Ke.h,Qe.h,e),i=dt(Ke.s,Qe.s,e),r=dt(Ke.l,Qe.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}nn.NAMES=Je,nn.prototype.isColor=!0,nn.prototype.r=1,nn.prototype.g=1,nn.prototype.b=1;class rn extends qe{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new nn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}rn.prototype.isMeshBasicMaterial=!0;const sn=new It,an=new vt;class on{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=et,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new nn),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new vt),e[n++]=r.x,e[n++]=r.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new It),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Rt),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)an.fromBufferAttribute(this,e),an.applyMatrix3(t),this.setXY(e,an.x,an.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)sn.fromBufferAttribute(this,e),sn.applyMatrix3(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)sn.x=this.getX(e),sn.y=this.getY(e),sn.z=this.getZ(e),sn.applyMatrix4(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)sn.x=this.getX(e),sn.y=this.getY(e),sn.z=this.getZ(e),sn.applyNormalMatrix(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)sn.x=this.getX(e),sn.y=this.getY(e),sn.z=this.getZ(e),sn.transformDirection(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==et&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}on.prototype.isBufferAttribute=!0;class ln extends on{constructor(t,e,n){super(new Int8Array(t),e,n)}}class hn extends on{constructor(t,e,n){super(new Uint8Array(t),e,n)}}class cn extends on{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}}class un extends on{constructor(t,e,n){super(new Int16Array(t),e,n)}}class dn extends on{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class pn extends on{constructor(t,e,n){super(new Int32Array(t),e,n)}}class fn extends on{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class gn extends on{constructor(t,e,n){super(new Uint16Array(t),e,n)}}gn.prototype.isFloat16BufferAttribute=!0;class mn extends on{constructor(t,e,n){super(new Float32Array(t),e,n)}}class vn extends on{constructor(t,e,n){super(new Float64Array(t),e,n)}}let _n=0;const yn=new ue,xn=new Be,bn=new It,wn=new Ft,Sn=new Ft,Mn=new It;class Tn extends rt{constructor(){super(),Object.defineProperty(this,"id",{value:_n++}),this.uuid=ht(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(yt(t)>65535?fn:dn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new _t).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return yn.makeRotationFromQuaternion(t),this.applyMatrix4(yn),this}rotateX(t){return yn.makeRotationX(t),this.applyMatrix4(yn),this}rotateY(t){return yn.makeRotationY(t),this.applyMatrix4(yn),this}rotateZ(t){return yn.makeRotationZ(t),this.applyMatrix4(yn),this}translate(t,e,n){return yn.makeTranslation(t,e,n),this.applyMatrix4(yn),this}scale(t,e,n){return yn.makeScale(t,e,n),this.applyMatrix4(yn),this}lookAt(t){return xn.lookAt(t),xn.updateMatrix(),this.applyMatrix4(xn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bn).negate(),this.translate(bn.x,bn.y,bn.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new mn(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ft);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new It(-1/0,-1/0,-1/0),new It(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];wn.setFromBufferAttribute(n),this.morphTargetsRelative?(Mn.addVectors(this.boundingBox.min,wn.min),this.boundingBox.expandByPoint(Mn),Mn.addVectors(this.boundingBox.max,wn.max),this.boundingBox.expandByPoint(Mn)):(this.boundingBox.expandByPoint(wn.min),this.boundingBox.expandByPoint(wn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ne);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new It,1/0);if(t){const n=this.boundingSphere.center;if(wn.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Sn.setFromBufferAttribute(n),this.morphTargetsRelative?(Mn.addVectors(wn.min,Sn.min),wn.expandByPoint(Mn),Mn.addVectors(wn.max,Sn.max),wn.expandByPoint(Mn)):(wn.expandByPoint(Sn.min),wn.expandByPoint(Sn.max))}wn.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Mn.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Mn));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Mn.fromBufferAttribute(s,e),a&&(bn.fromBufferAttribute(t,e),Mn.add(bn)),i=Math.max(i,n.distanceToSquared(Mn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,a=i.length/3;void 0===e.tangent&&this.setAttribute("tangent",new on(new Float32Array(4*a),4));const o=e.tangent.array,l=[],h=[];for(let t=0;t<a;t++)l[t]=new It,h[t]=new It;const c=new It,u=new It,d=new It,p=new vt,f=new vt,g=new vt,m=new It,v=new It;function _(t,e,n){c.fromArray(i,3*t),u.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),g.fromArray(s,2*n),u.sub(c),d.sub(c),f.sub(p),g.sub(p);const r=1/(f.x*g.y-g.x*f.y);isFinite(r)&&(m.copy(u).multiplyScalar(g.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-g.x).multiplyScalar(r),l[t].add(m),l[e].add(m),l[n].add(m),h[t].add(v),h[e].add(v),h[n].add(v))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)_(n[t+0],n[t+1],n[t+2])}const x=new It,b=new It,w=new It,S=new It;function M(t){w.fromArray(r,3*t),S.copy(w);const e=l[t];x.copy(e),x.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(S,e);const n=b.dot(h[t])<0?-1:1;o[4*t]=x.x,o[4*t+1]=x.y,o[4*t+2]=x.z,o[4*t+3]=n}for(let t=0,e=y.length;t<e;++t){const e=y[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)M(n[t+0]),M(n[t+1]),M(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new on(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new It,r=new It,s=new It,a=new It,o=new It,l=new It,h=new It,c=new It;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),h.subVectors(s,r),c.subVectors(i,r),h.cross(c),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(h),o.add(h),l.add(h),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(i,r),h.cross(c),n.setXYZ(t+0,h.x,h.y,h.z),n.setXYZ(t+1,h.x,h.y,h.z),n.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,s=t.attributes[i],a=s.array,o=s.itemSize*e,l=Math.min(a.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Mn.fromBufferAttribute(t,e),Mn.normalize(),t.setXYZ(e,Mn.x,Mn.y,Mn.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[o++]=n[a++]}return new on(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Tn,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let e=0,i=a.length;e<i;e++){const i=t(a[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Tn.prototype.isBufferGeometry=!0;const En=new ue,Cn=new ce,An=new ne,Rn=new It,Ln=new It,Pn=new It,kn=new It,Dn=new It,In=new It,On=new It,Bn=new It,Fn=new It,Nn=new vt,Un=new vt,zn=new vt,Gn=new It,Hn=new It;class Wn extends Be{constructor(t=new Tn,e=new rn){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),An.copy(n.boundingSphere),An.applyMatrix4(r),!1===t.ray.intersectsSphere(An))return;if(En.copy(r).invert(),Cn.copy(t.ray).applyMatrix4(En),null!==n.boundingBox&&!1===Cn.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative,h=n.attributes.uv,c=n.attributes.uv2,u=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=u.length;n<p;n++){const p=u[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));n<i;n+=3){const i=r.getX(n),u=r.getX(n+1),d=r.getX(n+2);(s=Vn(this,f,t,Cn,a,o,l,h,c,i,u,d))&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else for(let n=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);n<u;n+=3){const u=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);(s=Vn(this,i,t,Cn,a,o,l,h,c,u,d,p))&&(s.faceIndex=Math.floor(n/3),e.push(s))}else if(void 0!==a)if(Array.isArray(i))for(let n=0,r=u.length;n<r;n++){const r=u[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));n<i;n+=3)(s=Vn(this,p,t,Cn,a,o,l,h,c,n,n+1,n+2))&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,e.push(s))}else for(let n=Math.max(0,d.start),r=Math.min(a.count,d.start+d.count);n<r;n+=3)(s=Vn(this,i,t,Cn,a,o,l,h,c,n,n+1,n+2))&&(s.faceIndex=Math.floor(n/3),e.push(s))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Vn(t,e,n,i,r,s,a,o,l,h,c,u){Rn.fromBufferAttribute(r,h),Ln.fromBufferAttribute(r,c),Pn.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){On.set(0,0,0),Bn.set(0,0,0),Fn.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],n=s[t];0!==e&&(kn.fromBufferAttribute(n,h),Dn.fromBufferAttribute(n,c),In.fromBufferAttribute(n,u),a?(On.addScaledVector(kn,e),Bn.addScaledVector(Dn,e),Fn.addScaledVector(In,e)):(On.addScaledVector(kn.sub(Rn),e),Bn.addScaledVector(Dn.sub(Ln),e),Fn.addScaledVector(In.sub(Pn),e)))}Rn.add(On),Ln.add(Bn),Pn.add(Fn)}t.isSkinnedMesh&&(t.boneTransform(h,Rn),t.boneTransform(c,Ln),t.boneTransform(u,Pn));const p=function(t,e,n,i,r,s,a,o){let l;if(null===(l=1===e.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,2!==e.side,o)))return null;Hn.copy(o),Hn.applyMatrix4(t.matrixWorld);const h=n.ray.origin.distanceTo(Hn);return h<n.near||h>n.far?null:{distance:h,point:Hn.clone(),object:t}}(t,e,n,i,Rn,Ln,Pn,Gn);if(p){o&&(Nn.fromBufferAttribute(o,h),Un.fromBufferAttribute(o,c),zn.fromBufferAttribute(o,u),p.uv=Ye.getUV(Gn,Rn,Ln,Pn,Nn,Un,zn,new vt)),l&&(Nn.fromBufferAttribute(l,h),Un.fromBufferAttribute(l,c),zn.fromBufferAttribute(l,u),p.uv2=Ye.getUV(Gn,Rn,Ln,Pn,Nn,Un,zn,new vt));const t={a:h,b:c,c:u,normal:new It,materialIndex:0};Ye.getNormal(Rn,Ln,Pn,t.normal),p.face=t}return p}Wn.prototype.isMesh=!0;class jn extends Tn{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],h=[],c=[];let u=0,d=0;function p(t,e,n,i,r,s,p,f,g,m,v){const _=s/g,y=p/m,x=s/2,b=p/2,w=f/2,S=g+1,M=m+1;let T=0,E=0;const C=new It;for(let s=0;s<M;s++){const a=s*y-b;for(let o=0;o<S;o++){const u=o*_-x;C[t]=u*i,C[e]=a*r,C[n]=w,l.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[n]=f>0?1:-1,h.push(C.x,C.y,C.z),c.push(o/g),c.push(1-s/m),T+=1}}for(let t=0;t<m;t++)for(let e=0;e<g;e++){const n=u+e+S*t,i=u+e+S*(t+1),r=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;o.push(n,i,s),o.push(i,r,s),E+=6}a.addGroup(d,E,v),d+=E,u+=T}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new mn(l,3)),this.setAttribute("normal",new mn(h,3)),this.setAttribute("uv",new mn(c,2))}static fromJSON(t){return new jn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Xn(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Yn(t){const e={};for(let n=0;n<t.length;n++){const i=Xn(t[n]);for(const t in i)e[t]=i[t]}return e}const Zn={clone:Xn,merge:Yn};class qn extends qe{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Xn(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}qn.prototype.isShaderMaterial=!0;class Jn extends Be{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ue,this.projectionMatrix=new ue,this.projectionMatrixInverse=new ue}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Jn.prototype.isCamera=!0;class Kn extends Jn{constructor(t=50,e=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*lt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*ot*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*lt*Math.atan(Math.tan(.5*ot*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*ot*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/a,i*=s.width/t,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Kn.prototype.isPerspectiveCamera=!0;const Qn=90;class $n extends Be{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Kn(Qn,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new It(1,0,0)),this.add(i);const r=new Kn(Qn,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new It(-1,0,0)),this.add(r);const s=new Kn(Qn,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new It(0,1,0)),this.add(s);const a=new Kn(Qn,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new It(0,-1,0)),this.add(a);const o=new Kn(Qn,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new It(0,0,1)),this.add(o);const l=new Kn(Qn,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new It(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,a,o,l]=this.children,h=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,o),n.texture.generateMipmaps=u,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=h}}class ti extends Ct{constructor(t,e,n,i,s,a,o,l,h,c){super(t=void 0!==t?t:[],e=void 0!==e?e:r,n,i,s,a,o,l,h,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}ti.prototype.isCubeTexture=!0;class ei extends Lt{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new ti(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:m,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=E,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n=new jn(5,5,5),i=new qn({name:"CubemapFromEquirect",uniforms:Xn({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:1,blending:0});i.uniforms.tEquirect.value=e;const r=new Wn(n,i),s=e.minFilter;return e.minFilter===_&&(e.minFilter=m),new $n(1,10,this).update(t,r),e.minFilter=s,r.geometry.dispose(),r.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}ei.prototype.isWebGLCubeRenderTarget=!0;const ni=new It,ii=new It,ri=new _t;class si{constructor(t=new It(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=ni.subVectors(n,e).cross(ii.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(ni),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ri.getNormalMatrix(t),i=this.coplanarPoint(ni).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}si.prototype.isPlane=!0;const ai=new ne,oi=new It;class li{constructor(t=new si,e=new si,n=new si,i=new si,r=new si,s=new si){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],l=n[5],h=n[6],c=n[7],u=n[8],d=n[9],p=n[10],f=n[11],g=n[12],m=n[13],v=n[14],_=n[15];return e[0].setComponents(a-i,c-o,f-u,_-g).normalize(),e[1].setComponents(a+i,c+o,f+u,_+g).normalize(),e[2].setComponents(a+r,c+l,f+d,_+m).normalize(),e[3].setComponents(a-r,c-l,f-d,_-m).normalize(),e[4].setComponents(a-s,c-h,f-p,_-v).normalize(),e[5].setComponents(a+s,c+h,f+p,_+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),ai.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ai)}intersectsSprite(t){return ai.center.set(0,0,0),ai.radius=.7071067811865476,ai.applyMatrix4(t.matrixWorld),this.intersectsSphere(ai)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(oi.x=i.normal.x>0?t.max.x:t.min.x,oi.y=i.normal.y>0?t.max.y:t.min.y,oi.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(oi)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function hi(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function ci(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const r=e.array,s=e.usage,a=t.createBuffer();t.bindBuffer(i,a),t.bufferData(i,r,s),e.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?n?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(o=5121),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,i,r){const s=i.array,a=i.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class ui extends Tn{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,a=Math.floor(n),o=Math.floor(i),l=a+1,h=o+1,c=t/a,u=e/o,d=[],p=[],f=[],g=[];for(let t=0;t<h;t++){const e=t*u-s;for(let n=0;n<l;n++){const i=n*c-r;p.push(i,-e,0),f.push(0,0,1),g.push(n/a),g.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new mn(p,3)),this.setAttribute("normal",new mn(f,3)),this.setAttribute("uv",new mn(g,2))}static fromJSON(t){return new ui(t.width,t.height,t.widthSegments,t.heightSegments)}}const di={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},pi={common:{diffuse:{value:new nn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new _t},uv2Transform:{value:new _t},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new vt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new nn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new _t}},sprite:{diffuse:{value:new nn(16777215)},opacity:{value:1},center:{value:new vt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new _t}}},fi={basic:{uniforms:Yn([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.fog]),vertexShader:di.meshbasic_vert,fragmentShader:di.meshbasic_frag},lambert:{uniforms:Yn([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.fog,pi.lights,{emissive:{value:new nn(0)}}]),vertexShader:di.meshlambert_vert,fragmentShader:di.meshlambert_frag},phong:{uniforms:Yn([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.fog,pi.lights,{emissive:{value:new nn(0)},specular:{value:new nn(1118481)},shininess:{value:30}}]),vertexShader:di.meshphong_vert,fragmentShader:di.meshphong_frag},standard:{uniforms:Yn([pi.common,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.roughnessmap,pi.metalnessmap,pi.fog,pi.lights,{emissive:{value:new nn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag},toon:{uniforms:Yn([pi.common,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.gradientmap,pi.fog,pi.lights,{emissive:{value:new nn(0)}}]),vertexShader:di.meshtoon_vert,fragmentShader:di.meshtoon_frag},matcap:{uniforms:Yn([pi.common,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.fog,{matcap:{value:null}}]),vertexShader:di.meshmatcap_vert,fragmentShader:di.meshmatcap_frag},points:{uniforms:Yn([pi.points,pi.fog]),vertexShader:di.points_vert,fragmentShader:di.points_frag},dashed:{uniforms:Yn([pi.common,pi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:di.linedashed_vert,fragmentShader:di.linedashed_frag},depth:{uniforms:Yn([pi.common,pi.displacementmap]),vertexShader:di.depth_vert,fragmentShader:di.depth_frag},normal:{uniforms:Yn([pi.common,pi.bumpmap,pi.normalmap,pi.displacementmap,{opacity:{value:1}}]),vertexShader:di.meshnormal_vert,fragmentShader:di.meshnormal_frag},sprite:{uniforms:Yn([pi.sprite,pi.fog]),vertexShader:di.sprite_vert,fragmentShader:di.sprite_frag},background:{uniforms:{uvTransform:{value:new _t},t2D:{value:null}},vertexShader:di.background_vert,fragmentShader:di.background_frag},cube:{uniforms:Yn([pi.envmap,{opacity:{value:1}}]),vertexShader:di.cube_vert,fragmentShader:di.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:di.equirect_vert,fragmentShader:di.equirect_frag},distanceRGBA:{uniforms:Yn([pi.common,pi.displacementmap,{referencePosition:{value:new It},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:di.distanceRGBA_vert,fragmentShader:di.distanceRGBA_frag},shadow:{uniforms:Yn([pi.lights,pi.fog,{color:{value:new nn(0)},opacity:{value:1}}]),vertexShader:di.shadow_vert,fragmentShader:di.shadow_frag}};function gi(t,e,n,i,r){const s=new nn(0);let a,o,h=0,c=null,u=0,d=null;function p(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),p(s,h=e)},getClearAlpha:function(){return h},setClearAlpha:function(t){p(s,h=t)},render:function(n,r){let f=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=e.get(g));const m=t.xr,v=m.getSession&&m.getSession();v&&"additive"===v.environmentBlendMode&&(g=null),null===g?p(s,h):g&&g.isColor&&(p(g,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.mapping===l)?(void 0===o&&((o=new Wn(new jn(1,1,1),new qn({name:"BackgroundCubeMaterial",uniforms:Xn(fi.cube.uniforms),vertexShader:fi.cube.vertexShader,fragmentShader:fi.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),o.material.uniforms.envMap.value=g,o.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,c===g&&u===g.version&&d===t.toneMapping||(o.material.needsUpdate=!0,c=g,u=g.version,d=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):g&&g.isTexture&&(void 0===a&&((a=new Wn(new ui(2,2),new qn({name:"BackgroundMaterial",uniforms:Xn(fi.background.uniforms),vertexShader:fi.background.vertexShader,fragmentShader:fi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),a.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&u===g.version&&d===t.toneMapping||(a.material.needsUpdate=!0,c=g,u=g.version,d=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function mi(t,e,n,i){const r=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=d(null);let h=l;function c(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function u(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function p(){const t=h.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){g(t,0)}function g(n,r){const s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;s[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),o[n]!==r&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r)}function m(){const e=h.newAttributes,n=h.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,r,s,a,o){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,s,a,o):t.vertexAttribIPointer(e,n,r,a,o)}function _(){y(),h!==l&&c((h=l).object)}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,_,y){let x=!1;if(a){const e=function(e,n,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[n.id];void 0===h&&(h={},l[n.id]=h);let c=h[a];return void 0===c&&(c=d(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),h[a]=c),c}(_,u,l);h!==e&&c((h=e).object),(x=function(t,e){const n=h.attributes,i=t.attributes;let r=0;for(const t in i){const e=n[t],s=i[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return h.attributesNum!==r||h.index!==e}(_,y))&&function(t,e){const n={},i=_.attributes;let r=0;for(const t in i){const e=i[t],s={};s.attribute=e,e.data&&(s.data=e.data),n[t]=s,r++}h.attributes=n,h.attributesNum=r,h.index=e}(0,y)}else{const t=!0===l.wireframe;h.geometry===_.id&&h.program===u.id&&h.wireframe===t||(h.geometry=_.id,h.program=u.id,h.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==y&&n.update(y,34963),x&&(function(r,s,a,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=o.attributes,h=a.getAttributes(),c=s.defaultAttributeValues;for(const e in h){const i=h[e];if(i.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,a=s.itemSize,l=n.get(s);if(void 0===l)continue;const h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,d=s.offset;if(n&&n.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)g(i.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<i.locationSize;t++)f(i.location+t);t.bindBuffer(34962,h);for(let t=0;t<i.locationSize;t++)v(i.location+t,a/i.locationSize,c,e,l*u,(d+a/i.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)g(i.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)f(i.location+t);t.bindBuffer(34962,h);for(let t=0;t<i.locationSize;t++)v(i.location+t,a/i.locationSize,c,e,a*u,a/i.locationSize*t*u)}}else if(void 0!==c){const n=c[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i.location,n);break;case 3:t.vertexAttrib3fv(i.location,n);break;case 4:t.vertexAttrib4fv(i.location,n);break;default:t.vertexAttrib1fv(i.location,n)}}}}m()}(r,l,u,_),null!==y&&t.bindBuffer(34963,n.get(y).buffer))},reset:_,resetDefaultState:y,dispose:function(){_();for(const t in o){const e=o[t];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const n=o[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)u(i[t].object),delete i[t];delete n[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:m}}function vi(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(h="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,i,a,o),n.update(a,s,o)}}function _i(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),h=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),g=t.getParameter(36347),m=t.getParameter(36348),v=t.getParameter(36349),_=u>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:y,floatVertexTextures:_&&y,maxSamples:s?t.getParameter(36183):0}}function yi(t){const e=this;let n=null,i=0,r=!1,s=!1;const a=new si,o=new _t,l={value:null,needsUpdate:!1};function h(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(t,n,i,r){const s=null!==t?t.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const e=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(h,n),h[n+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==i||r;return r=e,n=c(t,s,0),i=t.length,a},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?c(null):h();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=c(u,a,e,o);for(let t=0;t!==e;++t)r[t]=n[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function xi(t){let e=new WeakMap;function n(t,e){return e===a?t.mapping=r:e===o&&(t.mapping=s),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===a||s===o){if(e.has(r))return n(e.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const a=t.getRenderTarget(),o=new ei(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),t.setRenderTarget(a),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}fi.physical={uniforms:Yn([fi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new vt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new nn(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new vt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new nn(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new nn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag};class bi extends Jn{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,a=i+e,o=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s=(r+=t*this.view.offsetX)+t*this.view.width,o=(a-=e*this.view.offsetY)-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}bi.prototype.isOrthographicCamera=!0;class wi extends qn{constructor(t){super(t),this.type="RawShaderMaterial"}}wi.prototype.isRawShaderMaterial=!0;const Si=Math.pow(2,8),Mi=[.125,.215,.35,.446,.526,.582],Ti=5+Mi.length,Ei=20,Ci={[Y]:0,[Z]:1,[J]:2,[K]:3,[Q]:4,[$]:5,[q]:6},Ai=new bi,{_lodPlanes:Ri,_sizeLods:Li,_sigmas:Pi}=function(){const t=[],e=[],n=[];let i=8;for(let r=0;r<Ti;r++){const s=Math.pow(2,i);e.push(s);let a=1/s;r>4?a=Mi[r-8+4-1]:0==r&&(a=0),n.push(a);const o=1/(s-1),l=-o/2,h=1+o/2,c=[l,l,h,l,h,h,l,l,h,h,l,h],u=6,d=6,p=3,f=2,g=1,m=new Float32Array(p*d*u),v=new Float32Array(f*d*u),_=new Float32Array(g*d*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];m.set(i,p*d*t),v.set(c,f*d*t);const r=[t,t,t,t,t,t];_.set(r,g*d*t)}const y=new Tn;y.setAttribute("position",new on(m,p)),y.setAttribute("uv",new on(v,f)),y.setAttribute("faceIndex",new on(_,g)),t.push(y),i>4&&i--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}(),ki=new nn;let Di=null;const Ii=(1+Math.sqrt(5))/2,Oi=1/Ii,Bi=[new It(1,1,1),new It(-1,1,1),new It(1,1,-1),new It(-1,1,-1),new It(0,Ii,Oi),new It(0,Ii,-Oi),new It(Oi,0,Ii),new It(-Oi,0,Ii),new It(Ii,Oi,0),new It(-Ii,Oi,0)];class Fi{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new It(0,1,0);return new wi({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Ci[3e3]},outputEncoding:{value:Ci[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(Ei),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Di=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Hi(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Gi(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<Ri.length;t++)Ri[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Di),t.scissorTest=!1,zi(t,0,0,t.width,t.height)}_fromTexture(t){Di=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:p,minFilter:p,generateMipmaps:!1,type:y,format:1023,encoding:Ni(t)?t.encoding:J,depthBuffer:!1},n=Ui(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Ui(e),n}_compileMaterial(t){const e=new Wn(Ri[0],t);this._renderer.compile(e,Ai)}_sceneToCubeUV(t,e,n,i){const r=new Kn(90,1,e,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.outputEncoding,c=o.toneMapping;o.getClearColor(ki),o.toneMapping=0,o.outputEncoding=Y,o.autoClear=!1;const u=new rn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Wn(new jn,u);let p=!1;const f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,p=!0):(u.color.copy(ki),p=!0);for(let e=0;e<6;e++){const n=e%3;0==n?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1==n?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e])),zi(i,n*Si,e>2?Si:0,Si,Si),o.setRenderTarget(i),p&&o.render(d,r),o.render(t,r)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=c,o.outputEncoding=h,o.autoClear=l,t.background=f}_setEncoding(t,e){t.value=Ci[e.encoding]}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===r||t.mapping===s;i?null==this._cubemapShader&&(this._cubemapShader=Hi()):null==this._equirectShader&&(this._equirectShader=Gi());const a=i?this._cubemapShader:this._equirectShader,o=new Wn(Ri[0],a),l=a.uniforms;l.envMap.value=t,i||l.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(l.inputEncoding,t),this._setEncoding(l.outputEncoding,e.texture),zi(e,0,0,3*Si,2*Si),n.setRenderTarget(e),n.render(o,Ai)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<Ti;e++){const n=Math.sqrt(Pi[e]*Pi[e]-Pi[e-1]*Pi[e-1]),i=Bi[(e-1)%Bi.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Wn(Ri[i],l),c=l.uniforms,u=Li[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Ei;f>Ei&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const g=[];let m=0;for(let t=0;t<Ei;++t){const e=t/p,n=Math.exp(-e*e/2);g.push(n),0==t?m+=n:t<f&&(m+=2*n)}for(let t=0;t<g.length;t++)g[t]=g[t]/m;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=g,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a),c.dTheta.value=d,c.mipInt.value=8-n,this._setEncoding(c.inputEncoding,t.texture),this._setEncoding(c.outputEncoding,t.texture);const v=Li[i];zi(e,3*Math.max(0,Si-2*v),(0===i?0:2*Si)+2*v*(i>4?i-8+4:0),3*v,2*v),o.setRenderTarget(e),o.render(h,Ai)}}function Ni(t){return void 0!==t&&t.type===y&&(t.encoding===Y||t.encoding===Z||t.encoding===q)}function Ui(t){const e=new Lt(3*Si,3*Si,t);return e.texture.mapping=l,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function zi(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Gi(){const t=new vt(1,1);return new wi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:Ci[3e3]},outputEncoding:{value:Ci[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Hi(){return new wi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ci[3e3]},outputEncoding:{value:Ci[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Wi(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(l){if(l&&l.isTexture&&!1===l.isRenderTargetTexture){const h=l.mapping,c=h===a||h===o,u=h===r||h===s;if(c||u){if(e.has(l))return e.get(l).texture;{const r=l.image;if(c&&r&&r.height>0||u&&r&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(r)){const r=t.getRenderTarget();null===n&&(n=new Fi(t));const s=c?n.fromEquirectangular(l):n.fromCubemap(l);return e.set(l,s),t.setRenderTarget(r),l.addEventListener("dispose",i),s.texture}return null}}}return l},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Vi(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function ji(t,e,n,i){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(t){const n=[],i=t.index,r=t.attributes.position;let a=0;if(null!==i){const t=i.array;a=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{const t=r.array;a=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const o=new(yt(n)>65535?fn:dn)(n,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const i=t.morphAttributes;for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&o(t)}else o(t);return s.get(t)}}}function Xi(t,e,n,i){const r=i.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,a,e*o),n.update(i,s,1)},this.renderInstances=function(i,l,h){if(0===h)return;let c,u;if(r)c=t,u="drawElementsInstanced";else if(u="drawElementsInstancedANGLE",null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](s,l,a,i*o,h),n.update(l,s,h)}}function Yi(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}class Zi extends Ct{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=p,this.minFilter=p,this.wrapR=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function qi(t,e){return t[0]-e[0]}function Ji(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ki(t,e){let n=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),t.divideScalar(n)}function Qi(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,a=new It,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,h,c,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const i=h.morphAttributes.position.length;let r=s.get(h);if(void 0===r||r.count!==i){void 0!==r&&r.texture.dispose();const t=void 0!==h.morphAttributes.normal,n=h.morphAttributes.position,o=h.morphAttributes.normal||[],l=!0===t?2:1;let c=h.attributes.position.count*l,u=1;c>e.maxTextureSize&&(u=Math.ceil(c/e.maxTextureSize),c=e.maxTextureSize);const d=new Float32Array(c*u*4*i),p=new Zi(d,c,u,i);p.format=E,p.type=w;const f=4*l;for(let e=0;e<i;e++){const i=n[e],r=o[e],s=c*u*4*e;for(let e=0;e<i.count;e++){a.fromBufferAttribute(i,e),!0===i.normalized&&Ki(a,i);const n=e*f;d[s+n+0]=a.x,d[s+n+1]=a.y,d[s+n+2]=a.z,d[s+n+3]=0,!0===t&&(a.fromBufferAttribute(r,e),!0===r.normalized&&Ki(a,r),d[s+n+4]=a.x,d[s+n+5]=a.y,d[s+n+6]=a.z,d[s+n+7]=0)}}r={count:i,texture:p,size:new vt(c,u)},s.set(h,r)}let o=0;for(let t=0;t<d.length;t++)o+=d[t];const l=h.morphTargetsRelative?1:1-o;u.getUniforms().setValue(t,"morphTargetBaseInfluence",l),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",r.texture,n),u.getUniforms().setValue(t,"morphTargetsTextureSize",r.size)}else{const e=void 0===d?0:d.length;let n=i[h.id];if(void 0===n||n.length!==e){n=[];for(let t=0;t<e;t++)n[t]=[t,0];i[h.id]=n}for(let t=0;t<e;t++){const e=n[t];e[0]=t,e[1]=d[t]}n.sort(Ji);for(let t=0;t<8;t++)t<e&&n[t][1]?(o[t][0]=n[t][0],o[t][1]=n[t][1]):(o[t][0]=Number.MAX_SAFE_INTEGER,o[t][1]=0);o.sort(qi);const s=h.morphAttributes.position,a=h.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=o[t],n=e[0],i=e[1];n!==Number.MAX_SAFE_INTEGER&&i?(s&&h.getAttribute("morphTarget"+t)!==s[n]&&h.setAttribute("morphTarget"+t,s[n]),a&&h.getAttribute("morphNormal"+t)!==a[n]&&h.setAttribute("morphNormal"+t,a[n]),r[t]=i,l+=i):(s&&!0===h.hasAttribute("morphTarget"+t)&&h.deleteAttribute("morphTarget"+t),a&&!0===h.hasAttribute("morphNormal"+t)&&h.deleteAttribute("morphNormal"+t),r[t]=0)}const c=h.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",c),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function $i(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const a=i.render.frame,o=t.geometry,l=e.get(t,o);return r.get(l)!==a&&(e.update(l),r.set(l,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Zi.prototype.isDataTexture2DArray=!0;class tr extends Ct{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=p,this.minFilter=p,this.wrapR=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}tr.prototype.isDataTexture3D=!0;const er=new Ct,nr=new Zi,ir=new tr,rr=new ti,sr=[],ar=[],or=new Float32Array(16),lr=new Float32Array(9),hr=new Float32Array(4);function cr(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=sr[r];if(void 0===s&&(s=new Float32Array(r),sr[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function ur(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function dr(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function pr(t,e){let n=ar[e];void 0===n&&(n=new Int32Array(e),ar[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function fr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function gr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ur(n,e))return;t.uniform2fv(this.addr,e),dr(n,e)}}function mr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ur(n,e))return;t.uniform3fv(this.addr,e),dr(n,e)}}function vr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ur(n,e))return;t.uniform4fv(this.addr,e),dr(n,e)}}function _r(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ur(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),dr(n,e)}else{if(ur(n,i))return;hr.set(i),t.uniformMatrix2fv(this.addr,!1,hr),dr(n,i)}}function yr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ur(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),dr(n,e)}else{if(ur(n,i))return;lr.set(i),t.uniformMatrix3fv(this.addr,!1,lr),dr(n,i)}}function xr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ur(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),dr(n,e)}else{if(ur(n,i))return;or.set(i),t.uniformMatrix4fv(this.addr,!1,or),dr(n,i)}}function br(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function wr(t,e){const n=this.cache;ur(n,e)||(t.uniform2iv(this.addr,e),dr(n,e))}function Sr(t,e){const n=this.cache;ur(n,e)||(t.uniform3iv(this.addr,e),dr(n,e))}function Mr(t,e){const n=this.cache;ur(n,e)||(t.uniform4iv(this.addr,e),dr(n,e))}function Tr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Er(t,e){const n=this.cache;ur(n,e)||(t.uniform2uiv(this.addr,e),dr(n,e))}function Cr(t,e){const n=this.cache;ur(n,e)||(t.uniform3uiv(this.addr,e),dr(n,e))}function Ar(t,e){const n=this.cache;ur(n,e)||(t.uniform4uiv(this.addr,e),dr(n,e))}function Rr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||er,r)}function Lr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||ir,r)}function Pr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||rr,r)}function kr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||nr,r)}function Dr(t,e){t.uniform1fv(this.addr,e)}function Ir(t,e){const n=cr(e,this.size,2);t.uniform2fv(this.addr,n)}function Or(t,e){const n=cr(e,this.size,3);t.uniform3fv(this.addr,n)}function Br(t,e){const n=cr(e,this.size,4);t.uniform4fv(this.addr,n)}function Fr(t,e){const n=cr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Nr(t,e){const n=cr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Ur(t,e){const n=cr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function zr(t,e){t.uniform1iv(this.addr,e)}function Gr(t,e){t.uniform2iv(this.addr,e)}function Hr(t,e){t.uniform3iv(this.addr,e)}function Wr(t,e){t.uniform4iv(this.addr,e)}function Vr(t,e){t.uniform1uiv(this.addr,e)}function jr(t,e){t.uniform2uiv(this.addr,e)}function Xr(t,e){t.uniform3uiv(this.addr,e)}function Yr(t,e){t.uniform4uiv(this.addr,e)}function Zr(t,e,n){const i=e.length,r=pr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTexture2D(e[t]||er,r[t])}function qr(t,e,n){const i=e.length,r=pr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture3D(e[t]||ir,r[t])}function Jr(t,e,n){const i=e.length,r=pr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTextureCube(e[t]||rr,r[t])}function Kr(t,e,n){const i=e.length,r=pr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||nr,r[t])}function Qr(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(e.type){case 5126:return fr;case 35664:return gr;case 35665:return mr;case 35666:return vr;case 35674:return _r;case 35675:return yr;case 35676:return xr;case 5124:case 35670:return br;case 35667:case 35671:return wr;case 35668:case 35672:return Sr;case 35669:case 35673:return Mr;case 5125:return Tr;case 36294:return Er;case 36295:return Cr;case 36296:return Ar;case 35678:case 36198:case 36298:case 36306:case 35682:return Rr;case 35679:case 36299:case 36307:return Lr;case 35680:case 36300:case 36308:case 36293:return Pr;case 36289:case 36303:case 36311:case 36292:return kr}}()}function $r(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return Dr;case 35664:return Ir;case 35665:return Or;case 35666:return Br;case 35674:return Fr;case 35675:return Nr;case 35676:return Ur;case 5124:case 35670:return zr;case 35667:case 35671:return Gr;case 35668:case 35672:return Hr;case 35669:case 35673:return Wr;case 5125:return Vr;case 36294:return jr;case 36295:return Xr;case 36296:return Yr;case 35678:case 36198:case 36298:case 36306:case 35682:return Zr;case 35679:case 36299:case 36307:return qr;case 35680:case 36300:case 36308:case 36293:return Jr;case 36289:case 36303:case 36311:case 36292:return Kr}}()}function ts(t){this.id=t,this.seq=[],this.map={}}$r.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),dr(e,t)},ts.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}};const es=/(\w+)(\])?(\[|\.)?/g;function ns(t,e){t.seq.push(e),t.map[e.id]=e}function is(t,e,n){const i=t.name,r=i.length;for(es.lastIndex=0;;){const s=es.exec(i),a=es.lastIndex;let o=s[1];const l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===r){ns(n,void 0===h?new Qr(o,t,e):new $r(o,t,e));break}{let t=n.map[o];void 0===t&&ns(n,t=new ts(o)),n=t}}}function rs(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);is(n,t.getUniformLocation(e,n.name),this)}}function ss(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}rs.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},rs.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},rs.upload=function(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,i)}},rs.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let as=0;function os(t){switch(t){case Y:return["Linear","( value )"];case Z:return["sRGB","( value )"];case J:return["RGBE","( value )"];case K:return["RGBM","( value, 7.0 )"];case Q:return["RGBM","( value, 16.0 )"];case $:return["RGBD","( value, 256.0 )"];case q:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function ls(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function hs(t,e){const n=os(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function cs(t,e){const n=os(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function us(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ds(t){return""!==t}function ps(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function fs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const gs=/^[ \t]*#include +<([\w\d./]+)>/gm;function ms(t){return t.replace(gs,vs)}function vs(t,e){const n=di[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return ms(n)}const _s=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ys=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function xs(t){return t.replace(ys,ws).replace(_s,bs)}function bs(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ws(t,e,n,i)}function ws(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Ss(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Ms(t,e,n,i){const a=t.getContext(),o=n.defines;let c=n.vertexShader,u=n.fragmentShader;const d=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),p=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case r:case s:e="ENVMAP_TYPE_CUBE";break;case l:case h:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),f=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case s:case h:e="ENVMAP_MODE_REFRACTION"}return e}(n),g=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),m=t.gammaFactor>0?t.gammaFactor:1,v=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ds).join("\n")}(n),_=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(o),y=a.createProgram();let x,b,w=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((x=[_].filter(ds).join("\n")).length>0&&(x+="\n"),(b=[v,_].filter(ds).join("\n")).length>0&&(b+="\n")):(x=[Ss(n),"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ds).join("\n"),b=[v,Ss(n),"#define SHADER_NAME "+n.shaderName,_,"#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",n.envMap?"#define "+g:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?di.tonemapping_pars_fragment:"",0!==n.toneMapping?us("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===T?"#define OPAQUE":"",di.encodings_pars_fragment,n.map?hs("mapTexelToLinear",n.mapEncoding):"",n.matcap?hs("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?hs("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?hs("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularColorMap?hs("specularColorMapTexelToLinear",n.specularColorMapEncoding):"",n.sheenColorMap?hs("sheenColorMapTexelToLinear",n.sheenColorMapEncoding):"",n.lightMap?hs("lightMapTexelToLinear",n.lightMapEncoding):"",cs("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ds).join("\n")),c=fs(c=ps(c=ms(c),n),n),u=fs(u=ps(u=ms(u),n),n),c=xs(c),u=xs(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(w="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,b=["#define varying in",n.glslVersion===it?"":"out highp vec4 pc_fragColor;",n.glslVersion===it?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const S=w+b+u,M=ss(a,35633,w+x+c),E=ss(a,35632,S);if(a.attachShader(y,M),a.attachShader(y,E),void 0!==n.index0AttributeName?a.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(y,0,"position"),a.linkProgram(y),t.debug.checkShaderErrors){const t=a.getProgramInfoLog(y).trim(),e=a.getShaderInfoLog(M).trim(),n=a.getShaderInfoLog(E).trim();let i=!0,r=!0;if(!1===a.getProgramParameter(y,35714)){i=!1;const e=ls(a,M,"vertex"),n=ls(a,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(r=!1);r&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:n,prefix:b}})}let C,A;return a.deleteShader(M),a.deleteShader(E),this.getUniforms=function(){return void 0===C&&(C=new rs(a,y)),C},this.getAttributes=function(){return void 0===A&&(A=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let a=1;35674===i.type&&(a=2),35675===i.type&&(a=3),35676===i.type&&(a=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:a}}return n}(a,y)),A},this.destroy=function(){i.releaseStatesOfProgram(this),a.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=as++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=E,this}function Ts(t,e,n,i,r,s,a){const o=[],c=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.floatVertexTextures,p=r.maxVertexUniforms,f=r.vertexTextures;let g=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function _(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Y,e}return{getParameters:function(s,o,v,y,x){const b=y.fog,w=s.isMeshStandardMaterial?y.environment:null,S=(s.isMeshStandardMaterial?n:e).get(s.envMap||w),M=m[s.type],T=x.isSkinnedMesh?function(t){const e=x.skeleton.bones;if(d)return 1024;{const t=p,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}():0;let E,C;if(null!==s.precision&&(g=r.getMaxPrecision(s.precision))!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",g,"instead."),M){const t=fi[M];E=t.vertexShader,C=t.fragmentShader}else E=s.vertexShader,C=s.fragmentShader;const A=t.getRenderTarget(),R=s.alphaTest>0,L=s.clearcoat>0;return{isWebGL2:c,shaderID:M,shaderName:s.type,vertexShader:E,fragmentShader:C,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:g,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:f,outputEncoding:null!==A?_(A.texture):t.outputEncoding,map:!!s.map,mapEncoding:_(s.map),matcap:!!s.matcap,matcapEncoding:_(s.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:_(S),envMapCubeUV:!!S&&(S.mapping===l||S.mapping===h),lightMap:!!s.lightMap,lightMapEncoding:_(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:_(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,clearcoat:L,clearcoatMap:L&&!!s.clearcoatMap,clearcoatRoughnessMap:L&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:L&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,specularColorMapEncoding:_(s.specularColorMap),alphaMap:!!s.alphaMap,alphaTest:R,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenColorMapEncoding:_(s.sheenColorMap),sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!x.geometry&&!!x.geometry.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!x.geometry&&!!x.geometry.attributes.color&&4===x.geometry.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!b,useFog:s.fog,fogExp2:b&&b.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===x.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:d,morphTargets:!!x.geometry&&!!x.geometry.morphAttributes.position,morphNormals:!!x.geometry&&!!x.geometry.morphAttributes.normal,morphTargetsCount:x.geometry&&x.geometry.morphAttributes.position?x.geometry.morphAttributes.position.length:0,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:s.format,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&v.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(St(e.fragmentShader)),n.push(St(e.vertexShader))),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<v.length;t++)n.push(e[v[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=m[t.type];let n;if(e){const t=fi[e];n=Zn.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=o.length;t<e;t++){const e=o[t];if(e.cacheKey===n){++(i=e).usedTimes;break}}return void 0===i&&(i=new Ms(t,n,e,s),o.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=o.indexOf(t);o[e]=o[o.length-1],o.pop(),t.destroy()}},programs:o}}function Es(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Cs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function As(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Rs(t){const e=[];let n=0;const i=[],r=[],s=[],a={id:-1};function o(i,r,s,o,l,h){let c=e[n];const u=t.get(s);return void 0===c?(c={id:i.id,object:i,geometry:r,material:s,program:u.program||a,groupOrder:o,renderOrder:i.renderOrder,z:l,group:h},e[n]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=s,c.program=u.program||a,c.groupOrder=o,c.renderOrder=i.renderOrder,c.z=l,c.group=h),n++,c}return{opaque:i,transmissive:r,transparent:s,init:function(){n=0,i.length=0,r.length=0,s.length=0},push:function(t,e,n,a,l,h){const c=o(t,e,n,a,l,h);n.transmission>0?r.push(c):!0===n.transparent?s.push(c):i.push(c)},unshift:function(t,e,n,a,l,h){const c=o(t,e,n,a,l,h);n.transmission>0?r.unshift(c):!0===n.transparent?s.unshift(c):i.unshift(c)},finish:function(){for(let t=n,i=e.length;t<i;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Cs),r.length>1&&r.sort(e||As),s.length>1&&s.sort(e||As)}}}function Ls(t){let e=new WeakMap;return{get:function(n,i){let r;return!1===e.has(n)?(r=new Rs(t),e.set(n,[r])):i>=e.get(n).length?(r=new Rs(t),e.get(n).push(r)):r=e.get(n)[i],r},dispose:function(){e=new WeakMap}}}function Ps(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new It,color:new nn};break;case"SpotLight":n={position:new It,direction:new It,color:new nn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new It,color:new nn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new It,skyColor:new nn,groundColor:new nn};break;case"RectAreaLight":n={color:new nn,position:new It,halfWidth:new It,halfHeight:new It}}return t[e.id]=n,n}}}let ks=0;function Ds(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Is(t,e){const n=new Ps,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new It);const s=new It,a=new ue,o=new ue;return{setup:function(s,a){let o=0,l=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,g=0,m=0,v=0;s.sort(Ds);const _=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,y=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*y*_,l+=a.g*y*_,h+=a.b*y*_;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*_),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[c]=n,r.directionalShadowMap[c]=b,r.directionalShadowMatrix[c]=e.shadow.matrix,g++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(y*_),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.spotShadow[d]=n,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=e.shadow.matrix,v++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(a).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*_),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=b,r.pointShadowMatrix[u]=e.shadow.matrix,m++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(y*_),t.groundColor.copy(e.groundColor).multiplyScalar(y*_),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=pi.LTC_FLOAT_1,r.rectAreaLTC2=pi.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=pi.LTC_HALF_1,r.rectAreaLTC2=pi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=h;const y=r.hash;y.directionalLength===c&&y.pointLength===u&&y.spotLength===d&&y.rectAreaLength===p&&y.hemiLength===f&&y.numDirectionalShadows===g&&y.numPointShadows===m&&y.numSpotShadows===v||(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=g,r.directionalShadowMap.length=g,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=g,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=v,y.directionalLength=c,y.pointLength=u,y.spotLength=d,y.rectAreaLength=p,y.hemiLength=f,y.numDirectionalShadows=g,y.numPointShadows=m,y.numSpotShadows=v,r.version=ks++)},setupView:function(t,e){let n=0,i=0,l=0,h=0,c=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[h];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),h++}else if(d.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const t=r.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),c++}}},state:r}}function Os(t,e){const n=new Is(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function Bs(t,e){let n=new WeakMap;return{get:function(i,r=0){let s;return!1===n.has(i)?(s=new Os(t,e),n.set(i,[s])):r>=n.get(i).length?(s=new Os(t,e),n.get(i).push(s)):s=n.get(i)[r],s},dispose:function(){n=new WeakMap}}}class Fs extends qe{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Fs.prototype.isMeshDepthMaterial=!0;class Ns extends qe{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new It,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Us(t,e,n){let i=new li;const r=new vt,s=new vt,a=new Rt,o=new Fs({depthPacking:3201}),l=new Ns,h={},c=n.maxTextureSize,u={0:1,1:0,2:2},d=new qn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new vt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const g=new Tn;g.setAttribute("position",new on(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new Wn(g,d),_=this;function y(n,i){const r=e.update(v);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,d,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,f,v,null)}function x(e,n,i,r,s,a,c){let d=null;const p=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(d=void 0!==p?p:!0===r.isPointLight?l:o,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=d.uuid,e=i.uuid;let n=h[t];void 0===n&&(n={},h[t]=n);let r=n[e];void 0===r&&(r=d.clone(),n[e]=r),d=r}return d.visible=i.visible,d.wireframe=i.wireframe,d.side=3===c?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],d.alphaMap=i.alphaMap,d.alphaTest=i.alphaTest,d.clipShadows=i.clipShadows,d.clippingPlanes=i.clippingPlanes,d.clipIntersection=i.clipIntersection,d.displacementMap=i.displacementMap,d.displacementScale=i.displacementScale,d.displacementBias=i.displacementBias,d.wireframeLinewidth=i.wireframeLinewidth,d.linewidth=i.linewidth,!0===r.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(r.matrixWorld),d.nearDistance=s,d.farDistance=a),d}function b(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],c=r[h.materialIndex];if(c&&c.visible){const e=x(n,0,c,a,s.near,s.far,o);t.renderBufferDirect(s,null,i,e,n,h)}}}else if(r.visible){const e=x(n,0,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,i,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,o){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const f=u.getFrameExtents();if(r.multiply(f),s.copy(u.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/f.x),r.x=s.x*f.x,u.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/f.y),r.y=s.y*f.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&3===this.type){const t={minFilter:m,magFilter:m,format:E};u.map=new Lt(r.x,r.y,t),u.map.texture.name=h.name+".shadowMap",u.mapPass=new Lt(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:p,magFilter:p,format:E};u.map=new Lt(r.x,r.y,t),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const g=u.getViewportCount();for(let t=0;t<g;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),u.updateMatrices(h,t),i=u.getFrustum(),b(n,o,u.camera,h,this.type)}u.isPointLightShadow||3!==this.type||y(u,o),u.needsUpdate=!1}_.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function zs(t,e,i){const r=i.isWebGL2,s=new function(){let e=!1;const n=new Rt;let i=null;const r=new Rt(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,a,o){!0===o&&(e*=a,i*=a,s*=a),n.set(e,i,s,a),!1===r.equals(n)&&(t.clearColor(e,i,s,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?F(2929):N(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},o=new function(){let e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(t){e||(t?F(2960):N(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&s===a||(t.stencilFunc(e,n,a),i=e,r=n,s=a)},setOp:function(e,n,i){a===e&&o===n&&l===i||(t.stencilOp(e,n,i),a=e,o=n,l=i)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,h=null}}};let l={},h={},c=null,u=!1,d=null,p=null,f=null,g=null,m=null,v=null,_=null,y=!1,x=null,b=null,w=null,S=null,M=null;const T=t.getParameter(35661);let E=!1,C=0;const A=t.getParameter(7938);-1!==A.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(A)[1]),E=C>=1):-1!==A.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),E=C>=2);let R=null,L={};const P=t.getParameter(3088),k=t.getParameter(2978),D=(new Rt).fromArray(P),I=(new Rt).fromArray(k);function O(e,n,i){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<i;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,r);return s}const B={};function F(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function N(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}B[3553]=O(3553,3553,1),B[34067]=O(34067,34069,6),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),F(2929),a.setFunc(3),H(!1),W(1),F(2884),G(0);const U={[n]:32774,101:32778,102:32779};if(r)U[103]=32775,U[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(U[103]=t.MIN_EXT,U[104]=t.MAX_EXT)}const z={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function G(e,i,r,s,a,o,l,h){if(0!==e){if(!1===u&&(F(3042),u=!0),5===e)a=a||i,o=o||r,l=l||s,i===p&&a===m||(t.blendEquationSeparate(U[i],U[a]),p=i,m=a),r===f&&s===g&&o===v&&l===_||(t.blendFuncSeparate(z[r],z[s],z[o],z[l]),f=r,g=s,v=o,_=l),d=e,y=null;else if(e!==d||h!==y){if(p===n&&m===n||(t.blendEquation(32774),p=n,m=n),h)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,g=null,v=null,_=null,d=e,y=h}}else!0===u&&(N(3042),u=!1)}function H(e){x!==e&&(e?t.frontFace(2304):t.frontFace(2305),x=e)}function W(e){0!==e?(F(2884),e!==b&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):N(2884),b=e}function V(e,n,i){e?(F(32823),S===n&&M===i||(t.polygonOffset(n,i),S=n,M=i)):N(32823)}function j(e){void 0===e&&(e=33984+T-1),R!==e&&(t.activeTexture(e),R=e)}return{buffers:{color:s,depth:a,stencil:o},enable:F,disable:N,bindFramebuffer:function(e,n){return h[e]!==n&&(t.bindFramebuffer(e,n),h[e]=n,r&&(36009===e&&(h[36160]=n),36160===e&&(h[36009]=n)),!0)},useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:G,setMaterial:function(t,e){2===t.side?N(2884):F(2884);let n=1===t.side;e&&(n=!n),H(n),1===t.blending&&!1===t.transparent?G(0):G(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),s.setMask(t.colorWrite);const i=t.stencilWrite;o.setTest(i),i&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),V(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?F(32926):N(32926)},setFlipSided:H,setCullFace:W,setLineWidth:function(e){e!==w&&(E&&t.lineWidth(e),w=e)},setPolygonOffset:V,setScissorTest:function(t){t?F(3089):N(3089)},activeTexture:j,bindTexture:function(e,n){null===R&&j();let i=L[R];void 0===i&&(i={type:void 0,texture:void 0},L[R]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||B[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=L[R];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===D.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),D.copy(e))},viewport:function(e){!1===I.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),I.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),l={},R=null,L={},h={},c=null,u=!1,d=null,p=null,f=null,g=null,m=null,v=null,_=null,y=!1,x=null,b=null,w=null,S=null,M=null,D.set(0,0,t.canvas.width,t.canvas.height),I.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}}}function Gs(t,e,n,i,r,s,a){const o=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,y=r.maxTextureSize,R=r.maxSamples,L=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,P=new WeakMap;let k,D=!1;try{D="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function I(t,e){return D?new OffscreenCanvas(t,e):wt("canvas")}function O(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?gt:Math.floor,s=i(r*t.width),a=i(r*t.height);void 0===k&&(k=I(s,a));const o=n?I(s,a):k;return o.width=s,o.height=a,o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function B(t){return pt(t.width)&&pt(t.height)}function F(t,e){return t.generateMipmaps&&e&&t.minFilter!==p&&t.minFilter!==m}function N(e){t.generateMipmap(e)}function U(n,i,r){if(!1===o)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=i;return 6403===i&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===i&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===i&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function z(t){return t===p||t===f||t===g?9728:9729}function G(e){const n=e.target;n.removeEventListener("dispose",G),function(e){const n=i.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),i.remove(e))}(n),n.isVideoTexture&&P.delete(n),a.memory.textures--}function H(e){const n=e.target;n.removeEventListener("dispose",H),function(e){const n=e.texture,r=i.get(e),s=i.get(n);if(e){if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}}(n)}let W=0;function V(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;P.get(t)!==e&&(P.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void J(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function j(e,r){const a=i.get(e);e.version>0&&a.__version!==e.version?function(e,i,r){if(6!==i.image.length)return;q(e,i),n.activeTexture(33984+r),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const a=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=a||l?l?i.image[t].image:i.image[t]:O(i.image[t],!1,!0,h);const u=B(c[0])||o,d=s.convert(i.format),p=s.convert(i.type),f=U(i.internalFormat,d,p,i.encoding);let g;if(Z(34067,i,u),a)for(let t=0;t<6;t++){g=c[t].mipmaps;for(let e=0;e<g.length;e++){const r=g[e];i.format!==E&&i.format!==T?null!==d?n.compressedTexImage2D(34069+t,e,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,f,r.width,r.height,0,d,p,r.data)}}else{g=i.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,f,c[t].width,c[t].height,0,d,p,c[t].data);for(let e=0;e<g.length;e++){const i=g[e].image[t].image;n.texImage2D(34069+t,e+1,f,i.width,i.height,0,d,p,i.data)}}else{n.texImage2D(34069+t,0,f,d,p,c[t]);for(let e=0;e<g.length;e++){const i=g[e];n.texImage2D(34069+t,e+1,f,d,p,i.image[t])}}}F(i,u)&&N(34067),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}(a,e,r):(n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture))}const X={[c]:10497,[u]:33071,[d]:33648},Y={[p]:9728,[f]:9984,[g]:9986,[m]:9729,[v]:9985,[_]:9987};function Z(n,s,a){if(a?(t.texParameteri(n,10242,X[s.wrapS]),t.texParameteri(n,10243,X[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,X[s.wrapR]),t.texParameteri(n,10240,Y[s.magFilter]),t.texParameteri(n,10241,Y[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===u&&s.wrapT===u||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,z(s.magFilter)),t.texParameteri(n,10241,z(s.minFilter)),s.minFilter!==p&&s.minFilter!==m&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===w&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===S&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function q(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",G),e.__webglTexture=t.createTexture(),a.memory.textures++)}function J(e,i,r){let a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),q(e,i),n.activeTexture(33984+r),n.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!o&&(t.wrapS!==u||t.wrapT!==u||t.minFilter!==p&&t.minFilter!==m)}(i)&&!1===B(i.image),h=O(i.image,l,!1,y),c=B(h)||o,d=s.convert(i.format);let f,g=s.convert(i.type),v=U(i.internalFormat,d,g,i.encoding);Z(a,i,c);const _=i.mipmaps;if(i.isDepthTexture)v=6402,o?v=i.type===w?36012:i.type===b?33190:i.type===M?35056:33189:i.type===w&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===C&&6402===v&&i.type!==x&&i.type!==b&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=x,g=s.convert(i.type)),i.format===A&&6402===v&&(v=34041,i.type!==M&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=M,g=s.convert(i.type))),n.texImage2D(3553,0,v,h.width,h.height,0,d,g,null);else if(i.isDataTexture)if(_.length>0&&c){for(let t=0,e=_.length;t<e;t++)f=_[t],n.texImage2D(3553,t,v,f.width,f.height,0,d,g,f.data);i.generateMipmaps=!1}else n.texImage2D(3553,0,v,h.width,h.height,0,d,g,h.data);else if(i.isCompressedTexture)for(let t=0,e=_.length;t<e;t++)f=_[t],i.format!==E&&i.format!==T?null!==d?n.compressedTexImage2D(3553,t,v,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,v,f.width,f.height,0,d,g,f.data);else if(i.isDataTexture2DArray)n.texImage3D(35866,0,v,h.width,h.height,h.depth,0,d,g,h.data);else if(i.isDataTexture3D)n.texImage3D(32879,0,v,h.width,h.height,h.depth,0,d,g,h.data);else{const t=function(t,e,n){return!0===F(t,c)?Math.log2(Math.max(e.width,e.height))+1:t.mipmaps.length>0?t.mipmaps.length:1}(i,h),r=o&&!0!==i.isVideoTexture,s=void 0===e.__version;if(_.length>0&&c){r&&s&&n.texStorage2D(3553,t,v,_[0].width,_[0].height);for(let t=0,e=_.length;t<e;t++)f=_[t],r?n.texSubImage2D(3553,t,0,0,d,g,f):n.texImage2D(3553,t,v,d,g,f);i.generateMipmaps=!1}else r?(s&&n.texStorage2D(3553,t,v,h.width,h.height),n.texSubImage2D(3553,0,0,0,d,g,h)):n.texImage2D(3553,0,v,d,g,h)}F(i,c)&&N(a),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function K(e,r,a,o,l){const h=s.convert(a.format),c=s.convert(a.type),u=U(a.internalFormat,h,c,a.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,u,r.width,r.height,r.depth,0,h,c,null):n.texImage2D(l,0,u,r.width,r.height,0,h,c,null)),n.bindFramebuffer(36160,e),r.useRenderToTexture?L.framebufferTexture2DMultisampleEXT(36160,o,l,i.get(a).__webglTexture,0,tt(r)):t.framebufferTexture2D(36160,o,l,i.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function Q(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||n.useRenderToTexture){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===w?r=36012:e.type===b&&(r=33190));const i=tt(n);n.useRenderToTexture?L.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=tt(n);i&&n.useRenderbuffer?t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):n.useRenderToTexture?L.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=s.convert(e.format),a=s.convert(e.type),o=U(e.internalFormat,r,a,e.encoding),l=tt(n);i&&n.useRenderbuffer?t.renderbufferStorageMultisample(36161,l,o,n.width,n.height):n.useRenderToTexture?L.renderbufferStorageMultisampleEXT(36161,l,o,n.width,n.height):t.renderbufferStorage(36161,o,n.width,n.height)}t.bindRenderbuffer(36161,null)}function $(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),V(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=tt(r);if(r.depthTexture.format===C)r.useRenderToTexture?L.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,a):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==A)throw new Error("Unknown depthTexture format");r.useRenderToTexture?L.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,a):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),Q(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),Q(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function tt(t){return o&&(t.useRenderbuffer||t.useRenderToTexture)?Math.min(R,t.samples):0}let et=!1,nt=!1;this.allocateTextureUnit=function(){const t=W;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),W+=1,t},this.resetTextureUnits=function(){W=0},this.setTexture2D=V,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?J(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?J(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=j,this.rebindTextures=function(t,e,n){const r=i.get(t);void 0!==e&&K(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&$(t)},this.setupRenderTarget=function(e){const l=e.texture,h=i.get(e),c=i.get(l);e.addEventListener("dispose",H),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=l.isDataTexture3D||l.isDataTexture2DArray,f=B(e)||o;if(!o||l.format!==T||l.type!==w&&l.type!==S||(l.format=E,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else if(h.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(e.useRenderbuffer)if(o){h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,h.__webglColorRenderbuffer);const i=s.convert(l.format),r=s.convert(l.type),a=U(l.internalFormat,i,r,l.encoding),o=tt(e);t.renderbufferStorageMultisample(36161,o,a,e.width,e.height),n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,h.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),Q(h.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,c.__webglTexture),Z(34067,l,f);for(let t=0;t<6;t++)K(h.__webglFramebuffer[t],e,l,36064,34069+t);F(l,f)&&N(34067),n.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=i.get(s);n.bindTexture(3553,a.__webglTexture),Z(3553,s,f),K(h.__webglFramebuffer,e,s,36064+r,3553),F(s,f)&&N(3553)}n.unbindTexture()}else{let t=3553;p&&(o?t=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(t,c.__webglTexture),Z(t,l,f),K(h.__webglFramebuffer,e,l,36064,t),F(l,f)&&N(t),n.unbindTexture()}e.depthBuffer&&$(e)},this.updateRenderTargetMipmap=function(t){const e=B(t)||o,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=r.length;s<a;s++){const a=r[s];if(F(a,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=i.get(a).__webglTexture;n.bindTexture(e,r),N(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.useRenderbuffer)if(o){const r=e.width,s=e.height;let a=16384;const o=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&o.push(l),e.ignoreDepthForMultisampleCopy||(e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024));const h=i.get(e);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer),e.ignoreDepthForMultisampleCopy&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,a,9728),t.invalidateFramebuffer(36008,o),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=$,this.setupFrameBufferTexture=K,this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===et&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),et=!0),t=t.texture),V(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===nt&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),nt=!0),t=t.texture),j(t,e)}}function Hs(t,e,n){const i=n.isWebGL2;return{convert:function(t){let n;if(t===y)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===x)return 5123;if(1013===t)return 5124;if(t===b)return 5125;if(t===w)return 5126;if(t===S)return i?5131:null!==(n=e.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===t)return 6406;if(t===T)return 6407;if(t===E)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===C)return 6402;if(t===A)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(t===R||t===L||t===P||t===k){if(null===(n=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===R)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===L)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===P)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===k)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===D||t===I||t===O||t===B){if(null===(n=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===D)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===I)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===O)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===B)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return null!==(n=e.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===F||t===N)&&null!==(n=e.get("WEBGL_compressed_texture_etc"))){if(t===F)return n.COMPRESSED_RGB8_ETC2;if(t===N)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?null!==(n=e.get("WEBGL_compressed_texture_astc"))?t:null:36492===t?null!==(n=e.get("EXT_texture_compression_bptc"))?t:null:t===M?i?34042:null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}Ns.prototype.isMeshDistanceMaterial=!0;class Ws extends Kn{constructor(t=[]){super(),this.cameras=t}}Ws.prototype.isArrayCamera=!0;class Vs extends Be{constructor(){super(),this.type="Group"}}Vs.prototype.isGroup=!0;const js={type:"move"};class Xs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Vs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Vs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new It,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new It),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Vs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new It,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new It),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&null!==(i=e.getPose(t.targetRaySpace,n))&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(js)),l&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const t=new Vs;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[i.jointName]=t,l.add(t)}const r=l.joints[i.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,n))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1);return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Ys extends Ct{constructor(t,e,n,i,r,s,a,o,l,h){if((h=void 0!==h?h:C)!==C&&h!==A)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&h===C&&(n=x),void 0===n&&h===A&&(n=M),super(null,i,r,s,a,o,h,n,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:p,this.minFilter=void 0!==o?o:p,this.flipY=!1,this.generateMipmaps=!1}}Ys.prototype.isDepthTexture=!0;class Zs extends rt{constructor(t,e){super();const n=this;let i=null,r=1,s=null,a="local-floor";const o=t.extensions.has("WEBGL_multisampled_render_to_texture");let l=null,h=null,c=null,u=null,d=!1,p=null;const f=e.getContextAttributes();let g=null,m=null;const v=[],_=new Map,b=new Kn;b.layers.enable(1),b.viewport=new Rt;const w=new Kn;w.layers.enable(2),w.viewport=new Rt;const S=[b,w],R=new Ws;R.layers.enable(1),R.layers.enable(2);let L=null,P=null;function k(t){const e=_.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function D(){_.forEach(function(t,e){t.disconnect(e)}),_.clear(),L=null,P=null,t.setRenderTarget(g),u=null,c=null,h=null,i=null,m=null,U.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function I(t){const e=i.inputSources;for(let t=0;t<v.length;t++)_.set(e[t],v[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=_.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),_.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],i=_.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new Xs,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new Xs,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new Xs,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==c?c:u},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=_async(function(l){const p=this;return _invokeIgnored(function(){if(null!==(i=l)){i.addEventListener("inputsourceschange",I),i.addEventListener("end",D),i.addEventListener("squeezeend",k),i.addEventListener("squeezestart",k),i.addEventListener("squeeze",k),i.addEventListener("selectend",k),i.addEventListener("selectstart",k),i.addEventListener("select",k),g=t.getRenderTarget();const l=!0!==f.xrCompatible;return _await(l&&e.makeXRCompatible(),function(l){if(void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const t={antialias:void 0!==i.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(i,e,t),i.updateRenderState({baseLayer:u}),m=new Lt(u.framebufferWidth,u.framebufferHeight)}else{d=f.antialias;let t=null,n=null,s=null;f.depth&&(s=f.stencil?35056:33189,t=f.stencil?A:C,n=f.stencil?M:x);const a={colorFormat:f.alpha||d?32856:32849,depthFormat:s,scaleFactor:r};h=new XRWebGLBinding(i,e),c=h.createProjectionLayer(a),i.updateRenderState({layers:[c]}),m=d?new kt(c.textureWidth,c.textureHeight,{format:E,type:y,depthTexture:new Ys(c.textureWidth,c.textureHeight,n,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:f.stencil,ignoreDepth:c.ignoreDepthValues,useRenderToTexture:o}):new Lt(c.textureWidth,c.textureHeight,{format:f.alpha?E:T,type:y,depthTexture:new Ys(c.textureWidth,c.textureHeight,n,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:f.stencil,ignoreDepth:c.ignoreDepthValues})}p.setFoveation(0);return _await(i.requestReferenceSpace(a),function(t){s=t,U.setContext(i),U.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})})},!l)}})});const O=new It,B=new It;function F(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;R.near=w.near=b.near=t.near,R.far=w.far=b.far=t.far,L===R.near&&P===R.far||(i.updateRenderState({depthNear:R.near,depthFar:R.far}),L=R.near,P=R.far);const e=t.parent,n=R.cameras;F(R,e);for(let t=0;t<n.length;t++)F(n[t],e);R.matrixWorld.decompose(R.position,R.quaternion,R.scale),t.position.copy(R.position),t.quaternion.copy(R.quaternion),t.scale.copy(R.scale),t.matrix.copy(R.matrix),t.matrixWorld.copy(R.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){O.setFromMatrixPosition(e.matrixWorld),B.setFromMatrixPosition(n.matrixWorld);const i=O.distanceTo(B),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*c,p=a*u,f=i/(-c+u),g=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(g),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const m=a+f,v=o+f,_=d-g,y=p+(i-g),x=l*o/v*m,b=h*o/v*m;t.projectionMatrix.makePerspective(_,y,x,b,m,v)}(R,b,w):R.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return R},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let N=null;const U=new hi;U.setAnimationLoop(function(e,n){if(l=n.getViewerPose(s),p=n,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(m,u.framebuffer),t.setRenderTarget(m));let n=!1;e.length!==R.cameras.length&&(R.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==u)s=u.getViewport(r);else{const e=h.getViewSubImage(c,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(m,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}const a=S[i];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&R.matrix.copy(a.matrix),!0===n&&R.cameras.push(a)}}const r=i.inputSources;for(let t=0;t<v.length;t++){const e=v[t],i=r[t];e.update(i,n,s)}N&&N(e,n),p=null}),this.setAnimationLoop=function(t){N=t},this.dispose=function(){}}}function qs(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest);const i=t.get(n).envMap;let r,s;i&&(e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,e.reflectivity.value=n.reflectivity,e.ior.value=n.ior,e.refractionRatio.value=n.refractionRatio),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,s,a){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i),i.isMeshPhysicalMaterial?function(t,e,i){n(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,i,a):n(t,i)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,s):i.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Js(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=wt("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let d=null,f=null;const g=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Y,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const v=this;let x=!1,b=0,M=0,T=null,C=-1,A=null;const R=new Rt,L=new Rt;let P=null,k=e.width,D=e.height,I=1,O=null,B=null;const F=new Rt(0,0,k,D),N=new Rt(0,0,k,D);let U=!1;const z=[],G=new li;let H=!1,W=!1,V=null;const j=new ue,X=new It,Z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===T?I:1}let J,K,Q,$,tt,et,nt,it,rt,st,at,ot,lt,ht,ct,ut,dt,pt,ft,gt,mt,vt,_t,yt=n;function xt(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const n={alpha:i,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r135"),e.addEventListener("webglcontextlost",Mt,!1),e.addEventListener("webglcontextrestored",Tt,!1),null===yt){const t=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&t.shift(),null===(yt=xt(t,n)))throw xt(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===yt.getShaderPrecisionFormat&&(yt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function bt(){J=new Vi(yt),K=new _i(yt,J,t),J.init(K),vt=new Hs(yt,J,K),Q=new zs(yt,J,K),z[0]=1029,$=new Yi(yt),tt=new Es,et=new Gs(yt,J,Q,tt,K,vt,$),nt=new xi(v),it=new Wi(v),rt=new ci(yt,K),_t=new mi(yt,J,rt,K),st=new ji(yt,rt,$,_t),at=new $i(yt,st,rt,$),ft=new Qi(yt,K,et),ut=new yi(tt),ot=new Ts(v,nt,it,J,K,_t,ut),lt=new qs(tt),ht=new Ls(tt),ct=new Bs(J,K),pt=new gi(v,nt,Q,at,o),dt=new Us(v,at,K),gt=new vi(yt,J,$,K),mt=new Xi(yt,J,$,K),$.programs=ot.programs,v.capabilities=K,v.extensions=J,v.properties=tt,v.renderLists=ht,v.shadowMap=dt,v.state=Q,v.info=$}bt();const St=new Zs(v,yt);function Mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Tt(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const t=$.autoReset,e=dt.enabled,n=dt.autoUpdate,i=dt.needsUpdate,r=dt.type;bt(),$.autoReset=t,dt.enabled=e,dt.autoUpdate=n,dt.needsUpdate=i,dt.type=r}function Et(t){const e=t.target;e.removeEventListener("dispose",Et),function(t){(function(t){const e=tt.get(t).programs;void 0!==e&&e.forEach(function(t){ot.releaseProgram(t)})})(t),tt.remove(t)}(e)}this.xr=St,this.getContext=function(){return yt},this.getContextAttributes=function(){return yt.getContextAttributes()},this.forceContextLoss=function(){const t=J.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=J.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(k,D,!1))},this.getSize=function(t){return t.set(k,D)},this.setSize=function(t,n,i){St.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(k=t,D=n,e.width=Math.floor(t*I),e.height=Math.floor(n*I),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(k*I,D*I).floor()},this.setDrawingBufferSize=function(t,n,i){k=t,D=n,I=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(R)},this.getViewport=function(t){return t.copy(F)},this.setViewport=function(t,e,n,i){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,n,i),Q.viewport(R.copy(F).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,n,i){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,i),Q.scissor(L.copy(N).multiplyScalar(I).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){Q.setScissorTest(U=t)},this.setOpaqueSort=function(t){O=t},this.setTransparentSort=function(t){B=t},this.getClearColor=function(t){return t.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor.apply(pt,arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha.apply(pt,arguments)},this.clear=function(t,e,n){let i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),yt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Mt,!1),e.removeEventListener("webglcontextrestored",Tt,!1),ht.dispose(),ct.dispose(),tt.dispose(),nt.dispose(),it.dispose(),at.dispose(),_t.dispose(),St.dispose(),St.removeEventListener("sessionstart",At),St.removeEventListener("sessionend",Pt),V&&(V.dispose(),V=null),Dt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=Z);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,n,i,r){!0!==e.isScene&&(e=Z),et.resetTextureUnits();const s=e.fog,a=i.isMeshStandardMaterial?e.environment:null,o=null===T?v.outputEncoding:T.texture.encoding,l=(i.isMeshStandardMaterial?it:nt).get(i.envMap||a),h=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=n.morphAttributes.position?n.morphAttributes.position.length:0,g=tt.get(i),m=f.state.lights;if(!0===H&&(!0===W||t!==A)){const e=t===A&&i.id===C;ut.setState(i,t,e)}let _=!1;i.version===g.__version?g.needsLights&&g.lightsStateVersion!==m.state.version||g.outputEncoding!==o||r.isInstancedMesh&&!1===g.instancing?_=!0:r.isInstancedMesh||!0!==g.instancing?r.isSkinnedMesh&&!1===g.skinning?_=!0:r.isSkinnedMesh||!0!==g.skinning?g.envMap!==l||i.fog&&g.fog!==s?_=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===ut.numPlanes&&g.numIntersection===ut.numIntersection?(g.vertexAlphas!==h||g.vertexTangents!==c||g.morphTargets!==u||g.morphNormals!==d||!0===K.isWebGL2&&g.morphTargetsCount!==p)&&(_=!0):_=!0:_=!0:_=!0:(_=!0,g.__version=i.version);let y=g.currentProgram;!0===_&&(y=Nt(i,e,r));let x=!1,b=!1,w=!1;const S=y.getUniforms(),M=g.uniforms;if(Q.useProgram(y.program)&&(x=!0,b=!0,w=!0),i.id!==C&&(C=i.id,b=!0),x||A!==t){if(S.setValue(yt,"projectionMatrix",t.projectionMatrix),K.logarithmicDepthBuffer&&S.setValue(yt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),A!==t&&(A=t,b=!0,w=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=S.map.cameraPosition;void 0!==e&&e.setValue(yt,X.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&S.setValue(yt,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&S.setValue(yt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){S.setOptional(yt,r,"bindMatrix"),S.setOptional(yt,r,"bindMatrixInverse");const t=r.skeleton;t&&(K.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),S.setValue(yt,"boneTexture",t.boneTexture,et),S.setValue(yt,"boneTextureSize",t.boneTextureSize)):S.setOptional(yt,t,"boneMatrices"))}var E,R;return!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ft.update(r,n,i,y),(b||g.receiveShadow!==r.receiveShadow)&&(g.receiveShadow=r.receiveShadow,S.setValue(yt,"receiveShadow",r.receiveShadow)),b&&(S.setValue(yt,"toneMappingExposure",v.toneMappingExposure),g.needsLights&&(R=w,(E=M).ambientLightColor.needsUpdate=R,E.lightProbe.needsUpdate=R,E.directionalLights.needsUpdate=R,E.directionalLightShadows.needsUpdate=R,E.pointLights.needsUpdate=R,E.pointLightShadows.needsUpdate=R,E.spotLights.needsUpdate=R,E.spotLightShadows.needsUpdate=R,E.rectAreaLights.needsUpdate=R,E.hemisphereLights.needsUpdate=R),s&&i.fog&&lt.refreshFogUniforms(M,s),lt.refreshMaterialUniforms(M,i,I,D,V),rs.upload(yt,g.uniformsList,M,et)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(rs.upload(yt,g.uniformsList,M,et),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&S.setValue(yt,"center",r.center),S.setValue(yt,"modelViewMatrix",r.modelViewMatrix),S.setValue(yt,"normalMatrix",r.normalMatrix),S.setValue(yt,"modelMatrix",r.matrixWorld),y}(t,e,n,i,r);Q.setMaterial(i,a);let l=n.index;const h=n.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===i.wireframe&&(l=st.getWireframeAttribute(n),u=2),_t.setup(r,i,o,n,l);let d=gt;null!==l&&(c=rt.get(l),(d=mt).setIndex(c));const p=null!==l?l.count:h.count,g=n.drawRange.start*u,m=n.drawRange.count*u,_=null!==s?s.start*u:0,y=null!==s?s.count*u:1/0,x=Math.max(g,_),b=Math.min(p,g+m,_+y)-1,w=Math.max(0,b-x+1);if(0!==w){if(r.isMesh)!0===i.wireframe?(Q.setLineWidth(i.wireframeLinewidth*q()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),Q.setLineWidth(t*q()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(x,w,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(x,w,t)}else d.render(x,w)}},this.compile=function(t,e){(f=ct.get(t)).init(),m.push(f),t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))}),f.setupLights(v.physicallyCorrectLights),t.traverse(function(e){const n=e.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)Nt(n[i],t,e);else Nt(n,t,e)}),m.pop(),f=null};let Ct=null;function At(){Dt.stop()}function Pt(){Dt.start()}const Dt=new hi;function Ot(t,e,n,i){const r=t.opaque,s=t.transmissive,o=t.transparent;f.setupLightsView(n),s.length>0&&function(t,e,n){if(null===V){const t=!0===a&&!0===K.isWebGL2;V=new(t?kt:Lt)(1024,1024,{generateMipmaps:!0,type:null!==vt.convert(S)?S:y,minFilter:_,magFilter:p,wrapS:u,wrapT:u,useRenderToTexture:J.has("WEBGL_multisampled_render_to_texture")})}const i=v.getRenderTarget();v.setRenderTarget(V),v.clear();const r=v.toneMapping;v.toneMapping=0,Bt(t,e,n),v.toneMapping=r,et.updateMultisampleRenderTarget(V),et.updateRenderTargetMipmap(V),v.setRenderTarget(i)}(r,e,n),i&&Q.viewport(R.copy(i)),r.length>0&&Bt(r,e,n),s.length>0&&Bt(s,e,n),o.length>0&&Bt(o,e,n)}function Bt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===i?s.material:i,h=s.group;a.layers.test(n.layers)&&Ft(a,e,n,o,l,h)}}function Ft(t,e,n,i,r,s){t.onBeforeRender(v,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(v,e,n,i,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,v.renderBufferDirect(n,e,i,r,t,s),r.side=0,r.needsUpdate=!0,v.renderBufferDirect(n,e,i,r,t,s),r.side=2):v.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(v,e,n,i,r,s)}function Nt(t,e,n){!0!==e.isScene&&(e=Z);const i=tt.get(t),r=f.state.lights,s=f.state.shadowsArray,a=r.state.version,o=ot.getParameters(t,r.state,s,e,n),l=ot.getProgramCacheKey(o);let h=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?it:nt).get(t.envMap||i.environment),void 0===h&&(t.addEventListener("dispose",Et),h=new Map,i.programs=h);let c=h.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===a)return Ut(t,o),c}else o.uniforms=ot.getUniforms(t),t.onBuild(n,o,v),t.onBeforeCompile(o,v),c=ot.acquireProgram(o,l),h.set(l,c),i.uniforms=o.uniforms;const u=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ut.uniform),Ut(t,o),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=c.getUniforms(),p=rs.seqWithValue(d.seq,u);return i.currentProgram=c,i.uniformsList=p,c}function Ut(t,e){const n=tt.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents}Dt.setAnimationLoop(function(t){Ct&&Ct(t)}),"undefined"!=typeof window&&Dt.setContext(window),this.setAnimationLoop=function(t){Ct=t,St.setAnimationLoop(t),null===t?Dt.stop():Dt.start()},St.addEventListener("sessionstart",At),St.addEventListener("sessionend",Pt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===St.enabled&&!0===St.isPresenting&&(!0===St.cameraAutoUpdate&&St.updateCamera(e),e=St.getCamera()),!0===t.isScene&&t.onBeforeRender(v,t,e,T),(f=ct.get(t,m.length)).init(),m.push(f),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),G.setFromProjectionMatrix(j),W=this.localClippingEnabled,H=ut.init(this.clippingPlanes,W,e),(d=ht.get(t,g.length)).init(),g.push(d),function t(e,n,i,r){if(!1===e.visible)return;if(e.layers.test(n.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(n);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||G.intersectsSprite(e)){r&&X.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);const t=at.update(e),n=e.material;n.visible&&d.push(e,t,n,i,X.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==$.render.frame&&(e.skeleton.update(),e.skeleton.frame=$.render.frame),!e.frustumCulled||G.intersectsObject(e))){r&&X.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);const t=at.update(e),n=e.material;if(Array.isArray(n)){const r=t.groups;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=n[a.materialIndex];o&&o.visible&&d.push(e,t,o,i,X.z,a)}}else n.visible&&d.push(e,t,n,i,X.z,null)}const s=e.children;for(let e=0,a=s.length;e<a;e++)t(s[e],n,i,r)}(t,e,0,v.sortObjects),d.finish(),!0===v.sortObjects&&d.sort(O,B),!0===H&&ut.beginShadows();const n=f.state.shadowsArray;if(dt.render(n,t,e),!0===H&&ut.endShadows(),!0===this.info.autoReset&&this.info.reset(),pt.render(d,t),f.setupLights(v.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Ot(d,t,i,i.viewport)}}else Ot(d,t,e);null!==T&&(et.updateMultisampleRenderTarget(T),et.updateRenderTargetMipmap(T)),!0===t.isScene&&t.onAfterRender(v,t,e),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1),_t.resetDefaultState(),C=-1,A=null,m.pop(),f=m.length>0?m[m.length-1]:null,g.pop(),d=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(t,e,n){tt.get(t.texture).__webglTexture=e,tt.get(t.depthTexture).__webglTexture=n;const i=tt.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||t.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),t.useRenderToTexture=!1,t.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(t,e){const n=tt.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){T=t,b=e,M=n;let i=!0;if(t){const e=tt.get(t);void 0!==e.__useDefaultFramebuffer?(Q.bindFramebuffer(36160,null),i=!1):void 0===e.__webglFramebuffer?et.setupRenderTarget(t):e.__hasExternalTextures&&et.rebindTextures(t,tt.get(t.texture).__webglTexture,tt.get(t.depthTexture).__webglTexture)}let r=null,s=!1,a=!1;if(t){const n=t.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(a=!0);const i=tt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=i[e],s=!0):r=t.useRenderbuffer?tt.get(t).__webglMultisampledFramebuffer:i,R.copy(t.viewport),L.copy(t.scissor),P=t.scissorTest}else R.copy(F).multiplyScalar(I).floor(),L.copy(N).multiplyScalar(I).floor(),P=U;if(Q.bindFramebuffer(36160,r)&&K.drawBuffers&&i){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const n=t.texture;if(z.length!==n.length||36064!==z[0]){for(let t=0,e=n.length;t<e;t++)z[t]=36064+t;z.length=n.length,e=!0}}else 1===z.length&&36064===z[0]||(z[0]=36064,z.length=1,e=!0);else 1===z.length&&1029===z[0]||(z[0]=1029,z.length=1,e=!0);e&&(K.isWebGL2?yt.drawBuffers(z):J.get("WEBGL_draw_buffers").drawBuffersWEBGL(z))}if(Q.viewport(R),Q.scissor(L),Q.setScissorTest(P),s){const i=tt.get(t.texture);yt.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(a){const i=tt.get(t.texture),r=e||0;yt.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}C=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=tt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Q.bindFramebuffer(36160,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==E&&vt.convert(o)!==yt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===S&&(J.has("EXT_color_buffer_half_float")||K.isWebGL2&&J.has("EXT_color_buffer_float"));if(!(l===y||vt.convert(l)===yt.getParameter(35738)||l===w&&(K.isWebGL2||J.has("OES_texture_float")||J.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===yt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&yt.readPixels(e,n,i,r,vt.convert(o),vt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==T?tt.get(T).__webglFramebuffer:null;Q.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);let a=vt.convert(e.format);K.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),et.setTexture2D(e,0),yt.copyTexImage2D(3553,n,a,t.x,t.y,r,s,0),Q.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,a=vt.convert(n.format),o=vt.convert(n.type);et.setTexture2D(n,0),yt.pixelStorei(37440,n.flipY),yt.pixelStorei(37441,n.premultiplyAlpha),yt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?yt.texSubImage2D(3553,i,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?yt.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):yt.texSubImage2D(3553,i,t.x,t.y,a,o,e.image),0===i&&n.generateMipmaps&&yt.generateMipmap(3553),Q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=vt.convert(i.format),h=vt.convert(i.type);let c;if(i.isDataTexture3D)et.setTexture3D(i,0),c=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");et.setTexture2DArray(i,0),c=35866}yt.pixelStorei(37440,i.flipY),yt.pixelStorei(37441,i.premultiplyAlpha),yt.pixelStorei(3317,i.unpackAlignment);const u=yt.getParameter(3314),d=yt.getParameter(32878),p=yt.getParameter(3316),f=yt.getParameter(3315),g=yt.getParameter(32877),m=n.isCompressedTexture?n.mipmaps[0]:n.image;yt.pixelStorei(3314,m.width),yt.pixelStorei(32878,m.height),yt.pixelStorei(3316,t.min.x),yt.pixelStorei(3315,t.min.y),yt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isDataTexture3D?yt.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,m.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),yt.compressedTexSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,m.data)):yt.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,m),yt.pixelStorei(3314,u),yt.pixelStorei(32878,d),yt.pixelStorei(3316,p),yt.pixelStorei(3315,f),yt.pixelStorei(32877,g),0===r&&i.generateMipmaps&&yt.generateMipmap(c),Q.unbindTexture()},this.initTexture=function(t){et.setTexture2D(t,0),Q.unbindTexture()},this.resetState=function(){b=0,M=0,T=null,Q.reset(),_t.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Js.prototype.isWebGLRenderer=!0;class Ks extends Js{}Ks.prototype.isWebGL1Renderer=!0;class Qs{constructor(t,e=25e-5){this.name="",this.color=new nn(t),this.density=e}clone(){return new Qs(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Qs.prototype.isFogExp2=!0;class $s{constructor(t,e=1,n=1e3){this.name="",this.color=new nn(t),this.near=e,this.far=n}clone(){return new $s(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}$s.prototype.isFog=!0;class ta extends Be{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}ta.prototype.isScene=!0;class ea{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=et,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ht()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ht()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ht()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ea.prototype.isInterleavedBuffer=!0;const na=new It;class ia{constructor(t,e,n,i=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)na.x=this.getX(e),na.y=this.getY(e),na.z=this.getZ(e),na.applyMatrix4(t),this.setXYZ(e,na.x,na.y,na.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)na.x=this.getX(e),na.y=this.getY(e),na.z=this.getZ(e),na.applyNormalMatrix(t),this.setXYZ(e,na.x,na.y,na.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)na.x=this.getX(e),na.y=this.getY(e),na.z=this.getZ(e),na.transformDirection(t),this.setXYZ(e,na.x,na.y,na.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new on(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ia(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ia.prototype.isInterleavedBufferAttribute=!0;class ra extends qe{constructor(t){super(),this.type="SpriteMaterial",this.color=new nn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let sa;ra.prototype.isSpriteMaterial=!0;const aa=new It,oa=new It,la=new It,ha=new vt,ca=new vt,ua=new ue,da=new It,pa=new It,fa=new It,ga=new vt,ma=new vt,va=new vt;class _a extends Be{constructor(t){if(super(),this.type="Sprite",void 0===sa){sa=new Tn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ea(t,5);sa.setIndex([0,1,2,0,2,3]),sa.setAttribute("position",new ia(e,3,0,!1)),sa.setAttribute("uv",new ia(e,2,3,!1))}this.geometry=sa,this.material=void 0!==t?t:new ra,this.center=new vt(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),oa.setFromMatrixScale(this.matrixWorld),ua.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),la.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&oa.multiplyScalar(-la.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;ya(da.set(-.5,-.5,0),la,s,oa,i,r),ya(pa.set(.5,-.5,0),la,s,oa,i,r),ya(fa.set(.5,.5,0),la,s,oa,i,r),ga.set(0,0),ma.set(1,0),va.set(1,1);let a=t.ray.intersectTriangle(da,pa,fa,!1,aa);if(null===a&&(ya(pa.set(-.5,.5,0),la,s,oa,i,r),ma.set(0,1),null===(a=t.ray.intersectTriangle(da,fa,pa,!1,aa))))return;const o=t.ray.origin.distanceTo(aa);o<t.near||o>t.far||e.push({distance:o,point:aa.clone(),uv:Ye.getUV(aa,da,pa,fa,ga,ma,va,new vt),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function ya(t,e,n,i,r,s){ha.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(ca.x=s*ha.x-r*ha.y,ca.y=r*ha.x+s*ha.y):ca.copy(ha),t.copy(e),t.x+=ca.x,t.y+=ca.y,t.applyMatrix4(ua)}_a.prototype.isSprite=!0;const xa=new It,ba=new It;class wa extends Be{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const n=this.levels;let i;for(i=0;i<n.length&&!(e<n[i].distance);i++);return n.splice(i,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){xa.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(xa);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){xa.setFromMatrixPosition(t.matrixWorld),ba.setFromMatrixPosition(this.matrixWorld);const n=xa.distanceTo(ba)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,i=n.length;t<i;t++){const i=n[t];e.object.levels.push({object:i.object.uuid,distance:i.distance})}return e}}const Sa=new It,Ma=new Rt,Ta=new Rt,Ea=new It,Ca=new ue;class Aa extends Wn{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ue,this.bindMatrixInverse=new ue}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Rt,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,i=this.geometry;Ma.fromBufferAttribute(i.attributes.skinIndex,t),Ta.fromBufferAttribute(i.attributes.skinWeight,t),Sa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=Ta.getComponent(t);if(0!==i){const r=Ma.getComponent(t);Ca.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Ea.copy(Sa).applyMatrix4(Ca),i)}}return e.applyMatrix4(this.bindMatrixInverse)}}Aa.prototype.isSkinnedMesh=!0;class Ra extends Be{constructor(){super(),this.type="Bone"}}Ra.prototype.isBone=!0;class La extends Ct{constructor(t=null,e=1,n=1,i,r,s,a,o,l=1003,h=1003,c,u){super(null,s,a,o,l,h,i,r,c,u),this.image={data:t,width:e,height:n},this.magFilter=l,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}La.prototype.isDataTexture=!0;const Pa=new ue,ka=new ue;class Da{constructor(t=[],e=[]){this.uuid=ht(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ue)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new ue;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:ka;Pa.multiplyMatrices(r,e[i]),Pa.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Da(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=ft(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new La(e,t,t,E,w);return this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Ra),this.bones.push(r),this.boneInverses.push((new ue).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class Ia extends on{constructor(t,e,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Ia.prototype.isInstancedBufferAttribute=!0;const Oa=new ue,Ba=new ue,Fa=[],Na=new Wn;class Ua extends Wn{constructor(t,e,n){super(t,e),this.instanceMatrix=new Ia(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Na.geometry=this.geometry,Na.material=this.material,void 0!==Na.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Oa),Ba.multiplyMatrices(n,Oa),Na.matrixWorld=Ba,Na.raycast(t,Fa);for(let t=0,n=Fa.length;t<n;t++){const n=Fa[t];n.instanceId=r,n.object=this,e.push(n)}Fa.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ia(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Ua.prototype.isInstancedMesh=!0;class za extends qe{constructor(t){super(),this.type="LineBasicMaterial",this.color=new nn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}za.prototype.isLineBasicMaterial=!0;const Ga=new It,Ha=new It,Wa=new ue,Va=new ce,ja=new ne;class Xa extends Be{constructor(t=new Tn,e=new za){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Ga.fromBufferAttribute(e,t-1),Ha.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Ga.distanceTo(Ha);t.setAttribute("lineDistance",new mn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ja.copy(n.boundingSphere),ja.applyMatrix4(i),ja.radius+=r,!1===t.ray.intersectsSphere(ja))return;Wa.copy(i).invert(),Va.copy(t.ray).applyMatrix4(Wa);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new It,h=new It,c=new It,u=new It,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i)for(let n=Math.max(0,s.start),a=Math.min(i.count,s.start+s.count)-1;n<a;n+=d){const s=i.getX(n),a=i.getX(n+1);if(l.fromBufferAttribute(r,s),h.fromBufferAttribute(r,a),Va.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),i=Math.min(r.count,s.start+s.count)-1;n<i;n+=d){if(l.fromBufferAttribute(r,n),h.fromBufferAttribute(r,n+1),Va.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Xa.prototype.isLine=!0;const Ya=new It,Za=new It;class qa extends Xa{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Ya.fromBufferAttribute(e,t),Za.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Ya.distanceTo(Za);t.setAttribute("lineDistance",new mn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}qa.prototype.isLineSegments=!0;class Ja extends Xa{constructor(t,e){super(t,e),this.type="LineLoop"}}Ja.prototype.isLineLoop=!0;class Ka extends qe{constructor(t){super(),this.type="PointsMaterial",this.color=new nn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}Ka.prototype.isPointsMaterial=!0;const Qa=new ue,$a=new ce,to=new ne,eo=new It;class no extends Be{constructor(t=new Tn,e=new Ka){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),to.copy(n.boundingSphere),to.applyMatrix4(i),to.radius+=r,!1===t.ray.intersectsSphere(to))return;Qa.copy(i).invert(),$a.copy(t.ray).applyMatrix4(Qa);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position;if(null!==r)for(let n=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);n<l;n++){const s=r.getX(n);eo.fromBufferAttribute(a,s),io(eo,s,o,i,t,e,this)}else for(let n=Math.max(0,s.start),r=Math.min(a.count,s.start+s.count);n<r;n++)eo.fromBufferAttribute(a,n),io(eo,n,o,i,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function io(t,e,n,i,r,s,a){const o=$a.distanceSqToPoint(t);if(o<n){const n=new It;$a.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:e,face:null,object:a})}}no.prototype.isPoints=!0;class ro extends Ct{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.format=void 0!==a?a:T,this.minFilter=void 0!==s?s:m,this.magFilter=void 0!==r?r:m,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;0=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ro.prototype.isVideoTexture=!0;class so extends Ct{constructor(t,e,n,i,r,s,a,o,l,h,c,u){super(null,s,a,o,l,h,i,r,c,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}so.prototype.isCompressedTexture=!0;class ao extends Ct{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.needsUpdate=!0}}ao.prototype.isCanvasTexture=!0;class oo extends Tn{constructor(t=1,e=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new It,h=new vt;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,c=3;r<=e;r++,c+=3){const u=n+r/e*i;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(s[c]/t+1)/2,h.y=(s[c+1]/t+1)/2,o.push(h.x,h.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new mn(s,3)),this.setAttribute("normal",new mn(a,3)),this.setAttribute("uv",new mn(o,2))}static fromJSON(t){return new oo(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class lo extends Tn{constructor(t=1,e=1,n=1,i=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const h=[],c=[],u=[],d=[];let p=0;const f=[],g=n/2;let m=0;function v(n){const r=p,s=new vt,f=new It;let v=0;const _=!0===n?t:e,y=!0===n?1:-1;for(let t=1;t<=i;t++)c.push(0,g*y,0),u.push(0,y,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=i;t++){const e=t/i*o+a,n=Math.cos(e),r=Math.sin(e);f.x=_*r,f.y=g*y,f.z=_*n,c.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=x+t;!0===n?h.push(i,i+1,e):h.push(i+1,i,e),v+=3}l.addGroup(m,v,!0===n?1:2),m+=v}!function(){const s=new It,v=new It;let _=0;const y=(e-t)/n;for(let l=0;l<=r;l++){const h=[],m=l/r,_=m*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*o+a,l=Math.sin(r),f=Math.cos(r);v.x=_*l,v.y=-m*n+g,v.z=_*f,c.push(v.x,v.y,v.z),s.set(l,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-m),h.push(p++)}f.push(h)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];h.push(n,i,s),h.push(i,r,s),_+=6}l.addGroup(m,_,0),m+=_}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new mn(c,3)),this.setAttribute("normal",new mn(u,3)),this.setAttribute("uv",new mn(d,2))}static fromJSON(t){return new lo(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ho extends lo{constructor(t=1,e=1,n=8,i=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new ho(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class co extends Tn{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function a(t,e,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const a=t.clone().lerp(n,i/r),o=e.clone().lerp(n,i/r),l=r-i;for(let t=0;t<=l;t++)s[i][t]=0===t&&i===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(o(s[t][n+1]),o(s[t+1][n]),o(s[t][n])):(o(s[t][n+1]),o(s[t+1][n+1]),o(s[t+1][n]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function h(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new It,i=new It,r=new It;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),a(n,i,r,t)}(i),function(t){const e=new It;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new It;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=c(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-a)}var e;(function(){const t=new It,e=new It,n=new It,i=new It,a=new vt,o=new vt,l=new vt;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=c(i);h(a,d+0,t,p),h(o,d+2,e,p),h(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),a=Math.min(e,n,i);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new mn(r,3)),this.setAttribute("normal",new mn(r.slice(),3)),this.setAttribute("uv",new mn(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new co(t.vertices,t.indices,t.radius,t.details)}}class uo extends co{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new uo(t.radius,t.detail)}}const po=new It,fo=new It,go=new It,mo=new Ye;class vo extends Tn{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(ot*e),s=t.getIndex(),a=t.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],h=["a","b","c"],c=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:o}=mo;if(e.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),mo.getNormal(go),c[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,c[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,c[2]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=c[t],i=c[e],s=mo[h[t]],a=mo[h[e]],o=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(go.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:go.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];po.fromBufferAttribute(a,e),fo.fromBufferAttribute(a,n),d.push(po.x,po.y,po.z),d.push(fo.x,fo.y,fo.z)}this.setAttribute("position",new mn(d,3))}}}class _o{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)r+=(n=this.getPoint(s/t)).distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if((a=n[i=Math.floor(o+(l-o)/2)]-s)<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(n[i=l]===s)return i/(r-1);const h=n[i];return(i+(s-h)/(n[i+1]-h))/(r-1)}getTangent(t,e){let n=t-1e-4,i=t+1e-4;n<0&&(n=0),i>1&&(i=1);const r=this.getPoint(n),s=this.getPoint(i),a=e||(r.isVector2?new vt:new It);return a.copy(s).sub(r).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new It,i=[],r=[],s=[],a=new It,o=new ue;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new It)}r[0]=new It,s[0]=new It;let l=Number.MAX_VALUE;const h=Math.abs(i[0].x),c=Math.abs(i[0].y),u=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(i[e-1],i[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(ct(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(ct(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class yo extends _o{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const n=e||new vt,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}yo.prototype.isEllipseCurve=!0;class xo extends yo{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.type="ArcCurve"}}function bo(){let t=0,e=0,n=0,i=0;function r(r,s,a,o){t=r,e=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,a,o){let l=(e-t)/s-(n-t)/(s+a)+(n-e)/a,h=(n-e)/a-(i-e)/(a+o)+(i-n)/o;r(e,n,l*=a,h*=a)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}xo.prototype.isArcCurve=!0;const wo=new It,So=new bo,Mo=new bo,To=new bo;class Eo extends _o{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new It){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?a=i[(l-1)%r]:(wo.subVectors(i[0],i[1]).add(i[0]),a=wo);const c=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(wo.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=wo),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),So.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,n,i),Mo.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,n,i),To.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(So.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),Mo.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),To.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return n.set(So.calc(h),Mo.calc(h),To.calc(h)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new It).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Co(t,e,n,i,r){const s=.5*(i-e),a=.5*(r-n),o=t*t;return(2*n-2*i+s+a)*(t*o)+(-3*n+3*i-2*s-a)*o+s*t+n}function Ao(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*n}(t)+function(t,e){return t*t*i}(t)}function Ro(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*i}(t)+function(t,e){return t*t*t*r}(t)}Eo.prototype.isCatmullRomCurve3=!0;class Lo extends _o{constructor(t=new vt,e=new vt,n=new vt,i=new vt){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new vt){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Ro(t,i.x,r.x,s.x,a.x),Ro(t,i.y,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Lo.prototype.isCubicBezierCurve=!0;class Po extends _o{constructor(t=new It,e=new It,n=new It,i=new It){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new It){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Ro(t,i.x,r.x,s.x,a.x),Ro(t,i.y,r.y,s.y,a.y),Ro(t,i.z,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Po.prototype.isCubicBezierCurve3=!0;class ko extends _o{constructor(t=new vt,e=new vt){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new vt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new vt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ko.prototype.isLineCurve=!0;class Do extends _o{constructor(t=new It,e=new It){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new It){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Io extends _o{constructor(t=new vt,e=new vt,n=new vt){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new vt){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Ao(t,i.x,r.x,s.x),Ao(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Io.prototype.isQuadraticBezierCurve=!0;class Oo extends _o{constructor(t=new It,e=new It,n=new It){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new It){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Ao(t,i.x,r.x,s.x),Ao(t,i.y,r.y,s.y),Ao(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Oo.prototype.isQuadraticBezierCurve3=!0;class Bo extends _o{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new vt){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],h=i[s>i.length-2?i.length-1:s+1],c=i[s>i.length-3?i.length-1:s+2];return n.set(Co(a,o.x,l.x,h.x,c.x),Co(a,o.y,l.y,h.y,c.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new vt).fromArray(n))}return this}}Bo.prototype.isSplineCurve=!0;var Fo=Object.freeze({__proto__:null,ArcCurve:xo,CatmullRomCurve3:Eo,CubicBezierCurve:Lo,CubicBezierCurve3:Po,EllipseCurve:yo,LineCurve:ko,LineCurve3:Do,QuadraticBezierCurve:Io,QuadraticBezierCurve3:Oo,SplineCurve:Bo});class No extends _o{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ko(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const i=o[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Fo[n.type]).fromJSON(n))}return this}}class Uo extends No{constructor(t){super(),this.type="Path",this.currentPoint=new vt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new ko(this.currentPoint.clone(),new vt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new Io(this.currentPoint.clone(),new vt(t,e),new vt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const a=new Lo(this.currentPoint.clone(),new vt(t,e),new vt(n,i),new vt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Bo(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,a,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,n,i,r,s,a,o),this}absellipse(t,e,n,i,r,s,a,o){const l=new yo(t,e,n,i,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class zo extends Uo{constructor(t){super(t),this.uuid=ht(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Uo).fromJSON(n))}return this}}const Go=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=Ho(t,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h,c,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,a,o,l,h;for(s=0,a=e.length;s<a;s++)(h=Ho(t,o=e[s]*i,l=s<a-1?e[s+1]*i:t.length,i,!1))===h.next&&(h.steiner=!0),r.push($o(h));for(r.sort(qo),s=0;s<r.length;s++)Jo(r[s],n),n=Wo(n,n.next);return n}(t,e,s,n)),t.length>80*n){o=h=t[0],l=c=t[1];for(let e=n;e<r;e+=n)(u=t[e])<o&&(o=u),(d=t[e+1])<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=0!==(p=Math.max(h-o,c-l))?1/p:0}return Vo(s,a,n,o,l,p),a};function Ho(t,e,n,i,r){let s,a;if(r===function(t,e,n,i){let r=0;for(let s=e,a=n-i;s<n;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)a=hl(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=hl(s,t[s],t[s+1],a);return a&&il(a,a.next)&&(cl(a),a=a.next),a}function Wo(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!il(i,i.next)&&0!==nl(i.prev,i,i.next))i=i.next;else{if(cl(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Vo(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){let r=t;do{null===r.z&&(r.z=Qo(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,a,o,l,h=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;e<h&&(o++,i=i.nextZ);e++);for(l=h;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,h*=2}while(a>1)}(r)}(t,i,r,s);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?Xo(t,i,r,s):jo(t))e.push(o.i/n),e.push(t.i/n),e.push(l.i/n),cl(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?Vo(t=Yo(Wo(t),e,n),e,n,i,r,s,2):2===a&&Zo(t,e,n,i,r,s):Vo(Wo(t),e,n,i,r,s,1);break}}function jo(t){const e=t.prev,n=t,i=t.next;if(nl(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(tl(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&nl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Xo(t,e,n,i){const r=t.prev,s=t,a=t.next;if(nl(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,h=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,c=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Qo(o,l,e,n,i),d=Qo(h,c,e,n,i);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&nl(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&nl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&nl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&nl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Yo(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!il(r,s)&&rl(r,i,i.next,s)&&ol(r,s)&&ol(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),cl(i),cl(i.next),i=t=s),i=i.next}while(i!==t);return Wo(i)}function Zo(t,e,n,i,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&el(a,t)){let o=ll(a,t);return a=Wo(a,a.next),o=Wo(o,o.next),Vo(a,e,n,i,r,s),void Vo(o,e,n,i,r,s)}t=t.next}a=a.next}while(a!==t)}function qo(t,e){return t.x-e.x}function Jo(t,e){if(e=function(t,e){let n=e;const i=t.x,r=t.y;let s,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>a){if(a=t,t===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===a)return s;const o=s,l=s.x,h=s.y;let c,u=1/0;n=s;do{i>=n.x&&n.x>=l&&i!==n.x&&tl(r<h?i:a,r,l,h,r<h?a:i,r,n.x,n.y)&&(c=Math.abs(r-n.y)/(i-n.x),ol(n,t)&&(c<u||c===u&&(n.x>s.x||n.x===s.x&&Ko(s,n)))&&(s=n,u=c)),n=n.next}while(n!==o);return s}(t,e)){const n=ll(e,t);Wo(e,e.next),Wo(n,n.next)}}function Ko(t,e){return nl(t.prev,t,e.prev)<0&&nl(e.next,t,t.next)<0}function Qo(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $o(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function tl(t,e,n,i,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(i-o)-(n-a)*(e-o)>=0&&(n-a)*(s-o)-(r-a)*(i-o)>=0}function el(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&rl(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ol(t,e)&&ol(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(nl(t.prev,t,e.prev)||nl(t,e.prev,e))||il(t,e)&&nl(t.prev,t,t.next)>0&&nl(e.prev,e,e.next)>0)}function nl(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function il(t,e){return t.x===e.x&&t.y===e.y}function rl(t,e,n,i){const r=al(nl(t,e,n)),s=al(nl(t,e,i)),a=al(nl(n,i,t)),o=al(nl(n,i,e));return r!==s&&a!==o||!(0!==r||!sl(t,n,e))||!(0!==s||!sl(t,i,e))||!(0!==a||!sl(n,t,i))||!(0!==o||!sl(n,e,i))}function sl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function al(t){return t>0?1:t<0?-1:0}function ol(t,e){return nl(t.prev,t,t.next)<0?nl(t,e,t.next)>=0&&nl(t,t.prev,e)>=0:nl(t,e,t.prev)<0||nl(t,t.next,e)<0}function ll(t,e){const n=new ul(t.i,t.x,t.y),i=new ul(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function hl(t,e,n,i){const r=new ul(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function cl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ul(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class dl{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return dl.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];pl(t),fl(n,t);let s=t.length;e.forEach(pl);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,fl(n,e[t]);const a=Go(n,i);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function pl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function fl(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class gl extends Tn{constructor(t=new zo([new vt(.5,.5),new vt(-.5,.5),new vt(-.5,-.5),new vt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++)s(t[e]);function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,g=void 0!==e.UVGenerator?e.UVGenerator:ml;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let m,v,_,y,x,b=!1;f&&(m=f.getSpacedPoints(o),b=!0,h=!1,v=f.computeFrenetFrames(o,!1),_=new It,y=new It,x=new It),h||(p=0,c=0,u=0,d=0);const w=t.extractPoints(a);let S=w.shape;const M=w.holes;if(!dl.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];dl.isClockWise(e)&&(M[t]=e.reverse())}}const T=dl.triangulateShape(S,M),E=S;for(let t=0,e=M.length;t<e;t++){const e=M[t];S=S.concat(e)}function C(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const A=S.length,R=T.length;function L(t,e,n){let i,r,s;const a=t.x-e.x,o=t.y-e.y,l=n.x-t.x,h=n.y-t.y,c=a*a+o*o,u=a*h-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-o/u,f=e.y+a/u,g=((n.x-h/d-p)*h-(n.y+l/d-f)*l)/(a*h-o*l),m=(i=p+a*g-t.x)*i+(r=f+o*g-t.y)*r;if(m<=2)return new vt(i,r);s=Math.sqrt(m/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(i=-o,r=a,s=Math.sqrt(c)):(i=a,r=o,s=Math.sqrt(c/2))}return new vt(i/s,r/s)}const P=[];for(let t=0,e=E.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),P[t]=L(E[t],E[n],E[i]);const k=[];let D,I=P.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];D=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[t]=L(e[t],e[i],e[r]);k.push(D),I=I.concat(D)}for(let t=0;t<p;t++){const e=t/p,n=c*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=C(E[t],P[t],i);F(e.x,e.y,-n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];D=k[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],D[t],i);F(r.x,r.y,-n)}}}const O=u+d;for(let t=0;t<A;t++){const e=h?C(S[t],I[t],O):S[t];b?(y.copy(v.normals[0]).multiplyScalar(e.x),_.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(m[0]).add(y).add(_),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<A;e++){const n=h?C(S[e],I[e],O):S[e];b?(y.copy(v.normals[t]).multiplyScalar(n.x),_.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(m[t]).add(y).add(_),F(x.x,x.y,x.z)):F(n.x,n.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=c*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=C(E[t],P[t],i);F(e.x,e.y,l+n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];D=k[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],D[t],i);b?F(r.x,r.y+m[o-1].y,m[o-1].x+n):F(r.x,r.y,l+n)}}}function B(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=o+2*p;t<n;t++){const n=A*t,s=A*(t+1);U(e+i+n,e+r+n,e+r+s,e+i+s)}}}function F(t,e,n){s.push(t),s.push(e),s.push(n)}function N(t,e,r){z(t),z(e),z(r);const s=i.length/3,a=g.generateTopUV(n,i,s-3,s-2,s-1);G(a[0]),G(a[1]),G(a[2])}function U(t,e,r,s){z(t),z(e),z(s),z(e),z(r),z(s);const a=i.length/3,o=g.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}function z(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function G(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(h){let t=0,e=A*t;for(let t=0;t<R;t++){const n=T[t];N(n[2]+e,n[1]+e,n[0]+e)}e=A*(t=o+2*p);for(let t=0;t<R;t++){const n=T[t];N(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<R;t++){const e=T[t];N(e[2],e[1],e[0])}for(let t=0;t<R;t++){const e=T[t];N(e[0]+A*o,e[1]+A*o,e[2]+A*o)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;B(E,e),e+=E.length;for(let t=0,n=M.length;t<n;t++){const n=M[t];B(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new mn(i,3)),this.setAttribute("uv",new mn(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Fo[i.type]).fromJSON(i)),new gl(n,t.options)}}const ml={generateTopUV:function(t,e,n,i,r){const s=e[3*n],a=e[3*n+1],o=e[3*i],l=e[3*i+1],h=e[3*r],c=e[3*r+1];return[new vt(s,a),new vt(o,l),new vt(h,c)]},generateSideWallUV:function(t,e,n,i,r,s){const a=e[3*n],o=e[3*n+1],l=e[3*n+2],h=e[3*i],c=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],g=e[3*s],m=e[3*s+1],v=e[3*s+2];return Math.abs(o-c)<Math.abs(a-h)?[new vt(a,1-l),new vt(h,1-u),new vt(d,1-f),new vt(g,1-v)]:[new vt(o,1-l),new vt(c,1-u),new vt(p,1-f),new vt(m,1-v)]}};class vl extends co{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new vl(t.radius,t.detail)}}class _l extends Tn{constructor(t=[new vt(0,.5),new vt(.5,0),new vt(0,-.5)],e=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=ct(i,0,2*Math.PI);const r=[],s=[],a=[],o=1/e,l=new It,h=new vt;for(let r=0;r<=e;r++){const c=n+r*o*i,u=Math.sin(c),d=Math.cos(c);for(let n=0;n<=t.length-1;n++)l.x=t[n].x*u,l.y=t[n].y,l.z=t[n].x*d,s.push(l.x,l.y,l.z),h.x=r/e,h.y=n/(t.length-1),a.push(h.x,h.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const i=e+n*t.length,s=i,a=i+t.length,o=i+t.length+1,l=i+1;r.push(s,a,l),r.push(a,o,l)}if(this.setIndex(r),this.setAttribute("position",new mn(s,3)),this.setAttribute("uv",new mn(a,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new It,r=new It,s=new It,a=e*t.length*3;for(let e=0,o=0;e<t.length;e++,o+=3)i.x=n[o+0],i.y=n[o+1],i.z=n[o+2],r.x=n[a+o+0],r.y=n[a+o+1],r.z=n[a+o+2],s.addVectors(i,r).normalize(),n[o+0]=n[a+o+0]=s.x,n[o+1]=n[a+o+1]=s.y,n[o+2]=n[a+o+2]=s.z}}static fromJSON(t){return new _l(t.points,t.segments,t.phiStart,t.phiLength)}}class yl extends co{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new yl(t.radius,t.detail)}}class xl extends Tn{constructor(t=.5,e=1,n=8,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],h=[];let c=t;const u=(e-t)/(i=Math.max(1,i)),d=new It,p=new vt;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){const i=r+t/n*s;d.x=c*Math.cos(i),d.y=c*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,h.push(p.x,p.y)}c+=u}for(let t=0;t<i;t++){const e=t*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new mn(o,3)),this.setAttribute("normal",new mn(l,3)),this.setAttribute("uv",new mn(h,2))}static fromJSON(t){return new xl(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class bl extends Tn{constructor(t=new zo([new vt(0,.5),new vt(-.5,-.5),new vt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=i.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===dl.isClockWise(h)&&(h=h.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===dl.isClockWise(e)&&(c[t]=e.reverse())}const u=dl.triangulateShape(h,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];h=h.concat(e)}for(let t=0,e=h.length;t<e;t++){const e=h[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+a,r=e[1]+a,s=e[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new mn(i,3)),this.setAttribute("normal",new mn(r,3)),this.setAttribute("uv",new mn(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new bl(n,t.curveSegments)}}class wl extends Tn{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const h=[],c=new It,u=new It,d=[],p=[],f=[],g=[];for(let d=0;d<=n;d++){const m=[],v=d/n;let _=0;0==d&&0==s?_=.5/e:d==n&&o==Math.PI&&(_=-.5/e);for(let n=0;n<=e;n++){const o=n/e;c.x=-t*Math.cos(i+o*r)*Math.sin(s+v*a),c.y=t*Math.cos(s+v*a),c.z=t*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),g.push(o+_,1-v),m.push(l++)}h.push(m)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=h[t][i+1],r=h[t][i],a=h[t+1][i],l=h[t+1][i+1];(0!==t||s>0)&&d.push(e,r,l),(t!==n-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new mn(p,3)),this.setAttribute("normal",new mn(f,3)),this.setAttribute("uv",new mn(g,2))}static fromJSON(t){return new wl(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Sl extends co{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Sl(t.radius,t.detail)}}class Ml extends Tn{constructor(t=1,e=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],h=new It,c=new It,u=new It;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;c.x=(t+e*Math.cos(f))*Math.cos(p),c.y=(t+e*Math.cos(f))*Math.sin(p),c.z=e*Math.sin(f),a.push(c.x,c.y,c.z),h.x=t*Math.cos(p),h.y=t*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,a=(i+1)*(t-1)+e,o=(i+1)*t+e;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new mn(a,3)),this.setAttribute("normal",new mn(o,3)),this.setAttribute("uv",new mn(l,2))}static fromJSON(t){return new Ml(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Tl extends Tn{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],h=[],c=new It,u=new It,d=new It,p=new It,f=new It,g=new It,m=new It;for(let a=0;a<=n;++a){const _=a/n*r*Math.PI*2;v(_,r,s,t,d),v(_+.01,r,s,t,p),g.subVectors(p,d),m.addVectors(p,d),f.crossVectors(g,m),m.crossVectors(f,g),f.normalize(),m.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);c.x=d.x+(s*m.x+p*f.x),c.y=d.y+(s*m.y+p*f.y),c.z=d.z+(s*m.z+p*f.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(a/n),h.push(t/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,o=(i+1)*(t-1)+e;a.push(n,r,o),a.push(r,s,o)}function v(t,e,n,i,r){const s=Math.cos(t),a=Math.sin(t),o=n/e*t,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new mn(o,3)),this.setAttribute("normal",new mn(l,3)),this.setAttribute("uv",new mn(h,2))}static fromJSON(t){return new Tl(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class El extends Tn{constructor(t=new Oo(new It(-1,-1,0),new It(-1,1,0),new It(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new It,o=new It,l=new vt;let h=new It;const c=[],u=[],d=[],p=[];function f(r){h=t.getPointAt(r/e,h);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=h.x+n*o.x,a.y=h.y+n*o.y,a.z=h.z+n*o.z,c.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,a=(i+1)*(t-1)+e;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new mn(c,3)),this.setAttribute("normal",new mn(u,3)),this.setAttribute("uv",new mn(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new El((new Fo[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Cl extends Tn{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new It,r=new It;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],h=l.start;for(let t=h,o=h+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),h=a.getX(t+(o+1)%3);i.fromBufferAttribute(s,l),r.fromBufferAttribute(s,h),!0===Al(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Al(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new mn(e,3))}}}function Al(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i,r),!0)}var Rl=Object.freeze({__proto__:null,BoxGeometry:jn,BoxBufferGeometry:jn,CircleGeometry:oo,CircleBufferGeometry:oo,ConeGeometry:ho,ConeBufferGeometry:ho,CylinderGeometry:lo,CylinderBufferGeometry:lo,DodecahedronGeometry:uo,DodecahedronBufferGeometry:uo,EdgesGeometry:vo,ExtrudeGeometry:gl,ExtrudeBufferGeometry:gl,IcosahedronGeometry:vl,IcosahedronBufferGeometry:vl,LatheGeometry:_l,LatheBufferGeometry:_l,OctahedronGeometry:yl,OctahedronBufferGeometry:yl,PlaneGeometry:ui,PlaneBufferGeometry:ui,PolyhedronGeometry:co,PolyhedronBufferGeometry:co,RingGeometry:xl,RingBufferGeometry:xl,ShapeGeometry:bl,ShapeBufferGeometry:bl,SphereGeometry:wl,SphereBufferGeometry:wl,TetrahedronGeometry:Sl,TetrahedronBufferGeometry:Sl,TorusGeometry:Ml,TorusBufferGeometry:Ml,TorusKnotGeometry:Tl,TorusKnotBufferGeometry:Tl,TubeGeometry:El,TubeBufferGeometry:El,WireframeGeometry:Cl});class Ll extends qe{constructor(t){super(),this.type="ShadowMaterial",this.color=new nn(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Ll.prototype.isShadowMaterial=!0;class Pl extends qe{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new nn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Pl.prototype.isMeshStandardMaterial=!0;class kl extends Pl{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new vt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ct(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new nn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new nn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new nn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}kl.prototype.isMeshPhysicalMaterial=!0;class Dl extends qe{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new nn(16777215),this.specular=new nn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Dl.prototype.isMeshPhongMaterial=!0;class Il extends qe{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new nn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Il.prototype.isMeshToonMaterial=!0;class Ol extends qe{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Ol.prototype.isMeshNormalMaterial=!0;class Bl extends qe{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new nn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Bl.prototype.isMeshLambertMaterial=!0;class Fl extends qe{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new nn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Fl.prototype.isMeshMatcapMaterial=!0;class Nl extends za{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Nl.prototype.isLineDashedMaterial=!0;var Ul=Object.freeze({__proto__:null,ShadowMaterial:Ll,SpriteMaterial:ra,RawShaderMaterial:wi,ShaderMaterial:qn,PointsMaterial:Ka,MeshPhysicalMaterial:kl,MeshStandardMaterial:Pl,MeshPhongMaterial:Dl,MeshToonMaterial:Il,MeshNormalMaterial:Ol,MeshLambertMaterial:Bl,MeshDepthMaterial:Fs,MeshDistanceMaterial:Ns,MeshBasicMaterial:rn,MeshMatcapMaterial:Fl,LineDashedMaterial:Nl,LineBasicMaterial:za,Material:qe});const zl={arraySlice:function(t,e,n){return zl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort(function(e,n){return t[e]-t[n]}),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[a++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=s[i])&&(e.push(s.time),n.push.apply(n,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{void 0!==(a=s[i])&&(e.push(s.time),a.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{void 0!==(a=s[i])&&(e.push(s.time),n.push(a)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],h=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<n||s>=i)){l.push(e.times[t]);for(let n=0;n<o;++n)h.push(e.values[t*o+n])}}0!==l.length&&(e.times=zl.convertArray(l,e.times.constructor),e.values=zl.convertArray(h,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find(function(t){return t.name===i.name&&t.ValueTypeName===r});if(void 0===a)continue;let o=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=i.times.length-1;let d;if(s<=i.times[0]){const t=o,e=l-o;d=zl.arraySlice(i.values,t,e)}else if(s>=i.times[u]){const t=u*l+o,e=t+l-o;d=zl.arraySlice(i.values,t,e)}else{const t=i.createInterpolant(),e=o,n=l-o;t.evaluate(s),d=zl.arraySlice(t.resultBuffer,e,n)}"quaternion"===r&&(new Dt).fromArray(d).normalize().conjugate().toArray(d);const p=a.times.length;for(let t=0;t<p;++t){const e=t*c+h;if("quaternion"===r)Dt.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=c-2*h;for(let n=0;n<t;++n)a.values[e+n]-=d[n]}}}return t.blendMode=X,t}};class Gl{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===s)break;if(r=i,t<(i=e[++n]))break e}s=e.length;break n}if(t>=r)break t;{const a=e[1];t<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===s)break;if(i=r,t>=(r=e[--n-1]))break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],void 0===(r=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Gl.prototype.beforeStart_=Gl.prototype.copySampleValue_,Gl.prototype.afterEnd_=Gl.prototype.copySampleValue_;class Hl extends Gl{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:H,endingEnd:H}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case W:r=t,a=2*e-n;break;case V:a=e+i[r=i.length-2]-i[r+1];break;default:r=t,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case W:s=t,o=2*n-e;break;case V:s=1,o=n+i[1]-i[0];break;default:s=t-1,o=e}const l=.5*(n-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-n),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,g=f*p,m=-u*g+2*u*f-u*p,v=(1+u)*g+(-1.5-2*u)*f+(-.5+u)*p+1,_=(-1-d)*g+(1.5+d)*f+.5*p,y=d*g-d*f;for(let t=0;t!==a;++t)r[t]=m*s[h+t]+v*s[l+t]+_*s[o+t]+y*s[c+t];return r}}class Wl extends Gl{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=(n-e)/(i-e),c=1-h;for(let t=0;t!==a;++t)r[t]=s[l+t]*c+s[o+t]*h;return r}}class Vl extends Gl{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class jl{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=zl.convertArray(e,this.TimeBufferType),this.values=zl.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:zl.convertArray(t.times,Array),values:zl.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Vl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Wl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Hl(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case U:e=this.InterpolantFactoryMethodDiscrete;break;case z:e=this.InterpolantFactoryMethodLinear;break;case G:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return U;case this.InterpolantFactoryMethodLinear:return z;case this.InterpolantFactoryMethodSmooth:return G}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(r=(s=Math.max(s,1))-1);const t=this.getValueSize();this.times=zl.arraySlice(n,r,s),this.values=zl.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&zl.isTypedArray(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=zl.arraySlice(this.times),e=zl.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===G,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(i)r=!0;else{const t=a*n,i=t-n,s=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[i+a]||n!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const i=a*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,a=0;a!==n;++a)e[i+a]=e[t+a];++s}return s!==t.length?(this.times=zl.arraySlice(t,0,s),this.values=zl.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=zl.arraySlice(this.times,0),e=zl.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}jl.prototype.TimeBufferType=Float32Array,jl.prototype.ValueBufferType=Float32Array,jl.prototype.DefaultInterpolation=z;class Xl extends jl{}Xl.prototype.ValueTypeName="bool",Xl.prototype.ValueBufferType=Array,Xl.prototype.DefaultInterpolation=U,Xl.prototype.InterpolantFactoryMethodLinear=void 0,Xl.prototype.InterpolantFactoryMethodSmooth=void 0;class Yl extends jl{}Yl.prototype.ValueTypeName="color";class Zl extends jl{}Zl.prototype.ValueTypeName="number";class ql extends Gl{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e);let l=t*a;for(let t=l+a;l!==t;l+=4)Dt.slerpFlat(r,0,s,l-a,s,l,o);return r}}class Jl extends jl{InterpolantFactoryMethodLinear(t){return new ql(this.times,this.values,this.getValueSize(),t)}}Jl.prototype.ValueTypeName="quaternion",Jl.prototype.DefaultInterpolation=z,Jl.prototype.InterpolantFactoryMethodSmooth=void 0;class Kl extends jl{}Kl.prototype.ValueTypeName="string",Kl.prototype.ValueBufferType=Array,Kl.prototype.DefaultInterpolation=U,Kl.prototype.InterpolantFactoryMethodLinear=void 0,Kl.prototype.InterpolantFactoryMethodSmooth=void 0;class Ql extends jl{}Ql.prototype.ValueTypeName="vector";class $l{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=ht(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(th(n[t]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(jl.toJSON(n[t]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=zl.getKeyframeOrder(a);a=zl.sortedArray(a,1,l),o=zl.sortedArray(o,1,l),i||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new Zl(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(r);if(s&&s.length>1){const t=s[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const s=[];for(const t in i)s.push(this.CreateFromMorphTargetSequence(t,i[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],a=[];zl.flattenJSON(n,s,a,i),0!==s.length&&r.push(new t(e,s,a))}},i=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new Zl(".morphTargetInfluence["+n+"]",t,s))}o=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";n(Ql,s+".position",r,"pos",i),n(Jl,s+".quaternion",r,"rot",i),n(Ql,s+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,o,i,a)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function th(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Zl;case"vector":case"vector2":case"vector3":case"vector4":return Ql;case"color":return Yl;case"quaternion":return Jl;case"bool":case"boolean":return Xl;case"string":return Kl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];zl.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const eh={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class nh{constructor(t,e,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===s&&void 0!==i.onStart&&i.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const ih=new nh;class rh{constructor(t){this.manager=void 0!==t?t:ih,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const sh={};class ah extends rh{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=eh.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(void 0!==sh[t])return void sh[t].push({onLoad:e,onProgress:n,onError:i});sh[t]=[],sh[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(s).then(e=>{if(200===e.status||0===e.status){0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const n=sh[t],i=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;return new ReadableStream({start(t){!function e(){i.read().then(({done:i,value:r})=>{if(i)t.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}})}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)}).then(t=>{const e=new Response(t);switch(this.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(t=>(new DOMParser).parseFromString(t,this.mimeType));case"json":return e.json();default:return e.text()}}).then(e=>{eh.add(t,e);const n=sh[t];delete sh[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}this.manager.itemEnd(t)}).catch(e=>{const n=sh[t];delete sh[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t),this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class oh extends rh{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=eh.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;const a=wt("img");function o(){h(),eh.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class lh extends rh{constructor(t){super(t)}load(t,e,n,i){const r=new ti,s=new oh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(t[n],function(t){r.images[n]=t,6==++a&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let e=0;e<t.length;++e)o(e);return r}}class hh extends rh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new La,a=new ah(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,function(t){const n=r.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:u,s.wrapT=void 0!==n.wrapT?n.wrapT:u,s.magFilter=void 0!==n.magFilter?n.magFilter:m,s.minFilter=void 0!==n.minFilter?n.minFilter:m,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=_),1===n.mipmapCount&&(s.minFilter=m),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n))},n,i),s}}class ch extends rh{constructor(t){super(t)}load(t,e,n,i){const r=new Ct,s=new oh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)},n,i),r}}class uh extends Be{constructor(t,e=1){super(),this.type="Light",this.color=new nn(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}uh.prototype.isLight=!0;class dh extends uh{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(Be.DefaultUp),this.updateMatrix(),this.groundColor=new nn(e)}copy(t){return uh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}dh.prototype.isHemisphereLight=!0;const ph=new ue,fh=new It,gh=new It;class mh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new vt(512,512),this.map=null,this.mapPass=null,this.matrix=new ue,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new li,this._frameExtents=new vt(1,1),this._viewportCount=1,this._viewports=[new Rt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;fh.setFromMatrixPosition(t.matrixWorld),e.position.copy(fh),gh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(gh),e.updateMatrixWorld(),ph.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ph),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class vh extends mh{constructor(){super(new Kn(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*lt*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}vh.prototype.isSpotLightShadow=!0;class _h extends uh{constructor(t,e,n=0,i=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(Be.DefaultUp),this.updateMatrix(),this.target=new Be,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new vh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}_h.prototype.isSpotLight=!0;const yh=new ue,xh=new It,bh=new It;class wh extends mh{constructor(){super(new Kn(90,1,.5,500)),this._frameExtents=new vt(4,2),this._viewportCount=6,this._viewports=[new Rt(2,1,1,1),new Rt(0,1,1,1),new Rt(3,1,1,1),new Rt(1,1,1,1),new Rt(3,0,1,1),new Rt(1,0,1,1)],this._cubeDirections=[new It(1,0,0),new It(-1,0,0),new It(0,0,1),new It(0,0,-1),new It(0,1,0),new It(0,-1,0)],this._cubeUps=[new It(0,1,0),new It(0,1,0),new It(0,1,0),new It(0,1,0),new It(0,0,1),new It(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),xh.setFromMatrixPosition(t.matrixWorld),n.position.copy(xh),bh.copy(n.position),bh.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(bh),n.updateMatrixWorld(),i.makeTranslation(-xh.x,-xh.y,-xh.z),yh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yh)}}wh.prototype.isPointLightShadow=!0;class Sh extends uh{constructor(t,e,n=0,i=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new wh}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Sh.prototype.isPointLight=!0;class Mh extends mh{constructor(){super(new bi(-5,5,5,-5,.5,500))}}Mh.prototype.isDirectionalLightShadow=!0;class Th extends uh{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Be.DefaultUp),this.updateMatrix(),this.target=new Be,this.shadow=new Mh}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Th.prototype.isDirectionalLight=!0;class Eh extends uh{constructor(t,e){super(t,e),this.type="AmbientLight"}}Eh.prototype.isAmbientLight=!0;class Ch extends uh{constructor(t,e,n=10,i=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Ch.prototype.isRectAreaLight=!0;class Ah{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new It)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}Ah.prototype.isSphericalHarmonics3=!0;class Rh extends uh{constructor(t=new Ah,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Rh.prototype.isLightProbe=!0;class Lh extends rh{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,s=new ah(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=new Ul[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new nn).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.format&&(i.format=t.format),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(i.uniforms[e]={},r.type){case"t":i.uniforms[e].value=n(r.value);break;case"c":i.uniforms[e].value=(new nn).setHex(r.value);break;case"v2":i.uniforms[e].value=(new vt).fromArray(r.value);break;case"v3":i.uniforms[e].value=(new It).fromArray(r.value);break;case"v4":i.uniforms[e].value=(new Rt).fromArray(r.value);break;case"m3":i.uniforms[e].value=(new _t).fromArray(r.value);break;case"m4":i.uniforms[e].value=(new ue).fromArray(r.value);break;default:i.uniforms[e].value=r.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new vt).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new vt).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}}class Ph{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class kh extends Tn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}kh.prototype.isInstancedBufferGeometry=!0;class Dh extends rh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new ah(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],s=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers[e],r=new Uint32Array(i).buffer;return n[e]=r,r}(t,r.buffer),a=bt(r.type,s),o=new ea(a,r.stride);return o.uuid=r.uuid,e[i]=o,o}const r=t.isInstancedBufferGeometry?new kh:new Tn,s=t.data.index;if(void 0!==s){const t=bt(s.type,s.array);r.setIndex(new on(t,1))}const a=t.data.attributes;for(const e in a){const n=a[e];let s;if(n.isInterleavedBufferAttribute){const e=i(t.data,n.data);s=new ia(e,n.itemSize,n.offset,n.normalized)}else{const t=bt(n.type,n.array);s=new(n.isInstancedBufferAttribute?Ia:on)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const n=o[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];let a;if(r.isInterleavedBufferAttribute){const e=i(t.data,r.data);a=new ia(e,r.itemSize,r.offset,r.normalized)}else{const t=bt(r.type,r.array);a=new on(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const h=t.data.boundingSphere;if(void 0!==h){const t=new It;void 0!==h.center&&t.fromArray(h.center),r.boundingSphere=new ne(t,h.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const Ih={UVMapping:i,CubeReflectionMapping:r,CubeRefractionMapping:s,EquirectangularReflectionMapping:a,EquirectangularRefractionMapping:o,CubeUVReflectionMapping:l,CubeUVRefractionMapping:h},Oh={RepeatWrapping:c,ClampToEdgeWrapping:u,MirroredRepeatWrapping:d},Bh={NearestFilter:p,NearestMipmapNearestFilter:f,NearestMipmapLinearFilter:g,LinearFilter:m,LinearMipmapNearestFilter:v,LinearMipmapLinearFilter:_};class Fh extends rh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=eh.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){eh.add(t,n),e&&e(n),r.manager.itemEnd(t)}).catch(function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}let Nh;Fh.prototype.isImageBitmapLoader=!0;const Uh={getContext:function(){return void 0===Nh&&(Nh=new(window.AudioContext||window.webkitAudioContext)),Nh},setContext:function(t){Nh=t}};class zh extends rh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new ah(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(t){try{const n=t.slice(0);Uh.getContext().decodeAudioData(n,function(t){e(t)})}catch(t){i?i(t):console.error(t),r.manager.itemError(n)}},n,i)}}class Gh extends Rh{constructor(t,e,n=1){super(void 0,n);const i=(new nn).set(t),r=(new nn).set(e),s=new It(i.r,i.g,i.b),a=new It(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}}Gh.prototype.isHemisphereLightProbe=!0;class Hh extends Rh{constructor(t,e=1){super(void 0,e);const n=(new nn).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Hh.prototype.isAmbientLightProbe=!0;const Wh=new ue,Vh=new ue,jh=new ue;class Xh{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Yh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Yh();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Yh(){return("undefined"==typeof performance?Date:performance).now()}const Zh=new It,qh=new Dt,Jh=new It,Kh=new It;class Qh extends Be{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const $h=new It,tc=new Dt,ec=new It,nc=new It;class ic{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class rc{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{const t=e/(s+=e);this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){a.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]}_slerp(t,e,n,i){Dt.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;Dt.multiplyQuaternionsFlat(t,s,t,e,t,n),Dt.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[n+a]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const sc=new RegExp("[\\[\\]\\.:\\/]","g"),ac="[^\\[\\]\\.:\\/]",oc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",lc=/((?:WC+[\/:])*)/.source.replace("WC",ac),hc=/(WCOD+)?/.source.replace("WCOD",oc),cc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ac),uc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ac),dc=new RegExp("^"+lc+hc+cc+uc+"$"),pc=["material","materials","bones"];class fc{constructor(t,e,n){this.path=e,this.parsedPath=n||fc.parseTrackName(e),this.node=fc.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new fc.Composite(t,e,n):new fc(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(sc,"")}static parseTrackName(t){const e=dc.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==pc.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=fc.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}fc.Composite=class{constructor(t,e,n){const i=n||fc.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},fc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},fc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},fc.prototype.GetterByBindingType=[fc.prototype._getValue_direct,fc.prototype._getValue_array,fc.prototype._getValue_arrayElement,fc.prototype._getValue_toArray],fc.prototype.SetterByBindingTypeAndVersioning=[[fc.prototype._setValue_direct,fc.prototype._setValue_direct_setNeedsUpdate,fc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[fc.prototype._setValue_array,fc.prototype._setValue_array_setNeedsUpdate,fc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[fc.prototype._setValue_arrayElement,fc.prototype._setValue_arrayElement_setNeedsUpdate,fc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[fc.prototype._setValue_fromArray,fc.prototype._setValue_fromArray_setNeedsUpdate,fc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class gc{constructor(){this.uuid=ht(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=t.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){const c=arguments[h],u=c.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(c);for(let t=0,e=s;t!==e;++t)r[t].push(new fc(c,n[t],i[t]))}else if(d<l){a=t[d];const o=--l,h=t[o];e[h.uuid]=d,t[d]=h,e[u]=o,t[o]=c;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new fc(c,n[t],i[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,h=t[s];e[h.uuid]=l,t[l]=h,e[o]=s,t[s]=a;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[l];e[l]=i,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],h=--s,c=t[h];e[o.uuid]=l,t[l]=o,e[c.uuid]=a,t[a]=c,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[a],r=e[h];e[l]=i,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);i=r.length,n[t]=i,s.push(t),a.push(e),r.push(c);for(let n=h,i=o.length;n!==i;++n){const i=o[n];c[n]=new fc(i,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}gc.prototype.isAnimationObjectGroup=!0;class mc{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:H,endingEnd:H};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===X)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(a);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=W,i.endingEnd=W):(i.endingStart=t?this.zeroSlopeAtStart?W:H:V,i.endingEnd=e?this.zeroSlopeAtEnd?W:H:V)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=n,this}}class vc extends rt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,a=t._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let h=l[o];void 0===h&&(h={},l[o]=h);for(let t=0;t!==r;++t){const r=i[t],l=r.name;let c=h[l];if(void 0!==c)s[t]=c;else{if(void 0!==(c=s[t])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;++(c=new rc(fc.create(n,l,i),r.ValueTypeName,r.getValueSize())).referenceCount,this._addInactiveBinding(c,o,l),s[t]=c}a[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&((n=new Wl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?$l.findByName(i,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:j),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const h=new mc(this,s,e,n);return this._bindAction(h,l),this._addInactiveAction(h,a,r),h}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?$l.findByName(n,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==n;++a)e[a]._update(i,t,r,s);const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}vc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class _c{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new _c(void 0===this.value.clone?this.value:this.value.clone())}}class yc extends ea{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}yc.prototype.isInstancedInterleavedBuffer=!0;class xc{constructor(t,e,n,i,r){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}function bc(t,e){return t.distance-e.distance}function wc(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)wc(i[t],e,n,!0)}}xc.prototype.isGLBufferAttribute=!0;const Sc=new vt;class Mc{constructor(t=new vt(1/0,1/0),e=new vt(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Sc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Sc.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Mc.prototype.isBox2=!0;const Tc=new It,Ec=new It;class Cc{constructor(t=new It,e=new It){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Tc.subVectors(t,this.start),Ec.subVectors(this.end,this.start);const n=Ec.dot(Ec);let i=Ec.dot(Tc)/n;return e&&(i=ct(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Ac=new It,Rc=new It,Lc=new ue,Pc=new ue;class kc extends qa{constructor(t){const e=function t(e){const n=[];e&&e.isBone&&n.push(e);for(let i=0;i<e.children.length;i++)n.push.apply(n,t(e.children[i]));return n}(t),n=new Tn,i=[],r=[],s=new nn(0,0,1),a=new nn(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new mn(i,3)),n.setAttribute("color",new mn(r,3)),super(n,new za({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Pc.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Lc.multiplyMatrices(Pc,r.matrixWorld),Rc.setFromMatrixPosition(Lc),i.setXYZ(n,Rc.x,Rc.y,Rc.z),Lc.multiplyMatrices(Pc,r.parent.matrixWorld),Rc.setFromMatrixPosition(Lc),i.setXYZ(n+1,Rc.x,Rc.y,Rc.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}const Dc=new It,Ic=new nn,Oc=new nn;class Bc extends qa{constructor(t=10,e=10,n=4473924,i=8947848){n=new nn(n),i=new nn(i);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,h=0,c=-a;t<=e;t++,c+=s){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);const e=t===r?n:i;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new Tn;h.setAttribute("position",new mn(o,3)),h.setAttribute("color",new mn(l,3)),super(h,new za({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Fc=new It,Nc=new It,Uc=new It,zc=new It,Gc=new Jn;function Hc(t,e,n,i,r,s,a){zc.set(r,s,a).unproject(i);const o=e[t];if(void 0!==o){const t=n.getAttribute("position");for(let e=0,n=o.length;e<n;e++)t.setXYZ(o[e],zc.x,zc.y,zc.z)}}const Wc=new Ft;class Vc extends qa{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Tn;r.setIndex(new on(n,1)),r.setAttribute("position",new on(i,3)),super(r,new za({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Wc.setFromObject(this.object),Wc.isEmpty())return;const e=Wc.min,n=Wc.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return qa.prototype.copy.call(this,t),this.object=t.object,this}}const jc=new It;let Xc,Yc;class Zc extends qa{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Tn;n.setAttribute("position",new mn(e,3)),n.setAttribute("color",new mn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new za({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new nn,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const qc=new Float32Array(1),Jc=new Int32Array(qc.buffer);_o.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(_o.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Uo.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Bc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},kc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},rh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ph.extractUrlBase(t)},rh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Mc.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Mc.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Mc.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Mc.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Ft.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ft.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ft.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ft.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Ft.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},ne.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},li.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Cc.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},_t.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},_t.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},_t.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},_t.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},_t.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},_t.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},ue.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},ue.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},ue.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new It).setFromMatrixColumn(this,3)},ue.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},ue.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ue.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ue.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ue.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ue.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},ue.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ue.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ue.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ue.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ue.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ue.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ue.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ue.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ue.prototype.makeFrustum=function(t,e,n,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,s)},ue.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},si.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Dt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Dt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},ce.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ce.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},ce.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Ye.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ye.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},Ye.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},Ye.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},Ye.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},Ye.barycoordFromPoint=function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ye.getBarycoord(t,e,n,i,r)},Ye.normal=function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ye.getNormal(t,e,n,i)},zo.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},zo.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new gl(this,t)},zo.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new bl(this,t)},vt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},vt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},vt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},It.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},It.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},It.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},It.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},It.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},It.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},It.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},It.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},It.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Rt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Rt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Be.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Be.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Be.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Be.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Be.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Be.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Wn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Wn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Aa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Kn.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(uh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(on.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===nt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(nt)}}}),on.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?nt:et),this},on.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},on.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Tn.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Tn.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new on(arguments[1],arguments[2])))},Tn.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Tn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Tn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Tn.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Tn.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Tn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ea.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?nt:et),this},ea.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},gl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},gl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},gl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ta.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},_c.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(qe.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new nn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(qn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Js.prototype.clearTarget=function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},Js.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},Js.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Js.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Js.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Js.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Js.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Js.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Js.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Js.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Js.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Js.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Js.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Js.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Js.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},Js.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Js.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Js.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Js.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Js.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Js.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Js.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Js.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Js.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Js.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Js.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Z:Y}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Us.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Lt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Qh.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new zh).load(t,function(t){e.setBuffer(t)}),this},ic.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$n.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},$n.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},Tt.crossOrigin=void 0,Tt.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new ch;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Tt.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new lh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Tt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Tt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Kc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e),t.ACESFilmicToneMapping=4,t.AddEquation=n,t.AddOperation=2,t.AdditiveAnimationBlendMode=X,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=Eh,t.AmbientLightProbe=Hh,t.AnimationClip=$l,t.AnimationLoader=class extends rh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new ah(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=$l.parse(t[n]);e.push(i)}return e}},t.AnimationMixer=vc,t.AnimationObjectGroup=gc,t.AnimationUtils=zl,t.ArcCurve=xo,t.ArrayCamera=Ws,t.ArrowHelper=class extends Be{constructor(t=new It(0,0,1),e=new It(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===Xc&&((Xc=new Tn).setAttribute("position",new mn([0,0,0,0,1,0],3)),(Yc=new lo(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Xa(Xc,new za({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Wn(Yc,new rn({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{jc.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(jc,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},t.Audio=Qh,t.AudioAnalyser=ic,t.AudioContext=Uh,t.AudioListener=class extends Be{constructor(){super(),this.type="AudioListener",this.context=Uh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Xh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Zh,qh,Jh),Kh.set(0,0,-1).applyQuaternion(qh),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Zh.x,t),e.positionY.linearRampToValueAtTime(Zh.y,t),e.positionZ.linearRampToValueAtTime(Zh.z,t),e.forwardX.linearRampToValueAtTime(Kh.x,t),e.forwardY.linearRampToValueAtTime(Kh.y,t),e.forwardZ.linearRampToValueAtTime(Kh.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Zh.x,Zh.y,Zh.z),e.setOrientation(Kh.x,Kh.y,Kh.z,n.x,n.y,n.z)}},t.AudioLoader=zh,t.AxesHelper=Zc,t.AxisHelper=function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Zc(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new hh(t)},t.Bone=Ra,t.BooleanKeyframeTrack=Xl,t.BoundingBoxHelper=function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Vc(t,e)},t.Box2=Mc,t.Box3=Ft,t.Box3Helper=class extends qa{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Tn;i.setIndex(new on(n,1)),i.setAttribute("position",new mn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new za({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},t.BoxBufferGeometry=jn,t.BoxGeometry=jn,t.BoxHelper=Vc,t.BufferAttribute=on,t.BufferGeometry=Tn,t.BufferGeometryLoader=Dh,t.ByteType=1010,t.Cache=eh,t.Camera=Jn,t.CameraHelper=class extends qa{constructor(t){const e=new Tn,n=new za({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},a=new nn(16755200),o=new nn(16711680),l=new nn(43775),h=new nn(16777215),c=new nn(3355443);function u(t,e,n){d(t,n),d(e,n)}function d(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.setAttribute("position",new mn(i,3)),e.setAttribute("color",new mn(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;Gc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Hc("c",e,t,Gc,0,0,-1),Hc("t",e,t,Gc,0,0,1),Hc("n1",e,t,Gc,-1,-1,-1),Hc("n2",e,t,Gc,1,-1,-1),Hc("n3",e,t,Gc,-1,1,-1),Hc("n4",e,t,Gc,1,1,-1),Hc("f1",e,t,Gc,-1,-1,1),Hc("f2",e,t,Gc,1,-1,1),Hc("f3",e,t,Gc,-1,1,1),Hc("f4",e,t,Gc,1,1,1),Hc("u1",e,t,Gc,.7,1.1,-1),Hc("u2",e,t,Gc,-.7,1.1,-1),Hc("u3",e,t,Gc,0,2,-1),Hc("cf1",e,t,Gc,-1,0,1),Hc("cf2",e,t,Gc,1,0,1),Hc("cf3",e,t,Gc,0,-1,1),Hc("cf4",e,t,Gc,0,1,1),Hc("cn1",e,t,Gc,-1,0,-1),Hc("cn2",e,t,Gc,1,0,-1),Hc("cn3",e,t,Gc,0,-1,-1),Hc("cn4",e,t,Gc,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},t.CanvasTexture=ao,t.CatmullRomCurve3=Eo,t.CineonToneMapping=3,t.CircleBufferGeometry=oo,t.CircleGeometry=oo,t.ClampToEdgeWrapping=u,t.Clock=Xh,t.Color=nn,t.ColorKeyframeTrack=Yl,t.CompressedTexture=so,t.CompressedTextureLoader=class extends rh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=[],a=new so,o=new ah(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function h(h){o.load(t[h],function(t){const n=r.parse(t,!0);s[h]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(a.minFilter=m),a.image=s,a.format=n.format,a.needsUpdate=!0,e&&e(a))},n,i)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)h(e);else o.load(t,function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=m),a.format=n.format,a.needsUpdate=!0,e&&e(a)},n,i);return a}},t.ConeBufferGeometry=ho,t.ConeGeometry=ho,t.CubeCamera=$n,t.CubeReflectionMapping=r,t.CubeRefractionMapping=s,t.CubeTexture=ti,t.CubeTextureLoader=lh,t.CubeUVReflectionMapping=l,t.CubeUVRefractionMapping=h,t.CubicBezierCurve=Lo,t.CubicBezierCurve3=Po,t.CubicInterpolant=Hl,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=_o,t.CurvePath=No,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderBufferGeometry=lo,t.CylinderGeometry=lo,t.Cylindrical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}},t.DataTexture=La,t.DataTexture2DArray=Zi,t.DataTexture3D=tr,t.DataTextureLoader=hh,t.DataUtils=class{static toHalfFloat(t){t>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),t=65504),qc[0]=t;const e=Jc[0];let n=e>>16&32768,i=e>>12&2047;const r=e>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&e):r<113?n|=((i|=2048)>>114-r)+(i>>113-r&1):(n|=r-112<<10|i>>1,n+=1&i)}},t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=ih,t.DepthFormat=C,t.DepthStencilFormat=A,t.DepthTexture=Ys,t.DirectionalLight=Th,t.DirectionalLightHelper=class extends Be{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new Tn;i.setAttribute("position",new mn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new za({fog:!1,toneMapped:!1});this.lightPlane=new Xa(i,r),this.add(this.lightPlane),(i=new Tn).setAttribute("position",new mn([0,0,0,0,0,1],3)),this.targetLine=new Xa(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Fc.setFromMatrixPosition(this.light.matrixWorld),Nc.setFromMatrixPosition(this.light.target.matrixWorld),Uc.subVectors(Nc,Fc),this.lightPlane.lookAt(Nc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Nc),this.targetLine.scale.z=Uc.length()}},t.DiscreteInterpolant=Vl,t.DodecahedronBufferGeometry=uo,t.DodecahedronGeometry=uo,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new on(t,e).setUsage(nt)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=nt,t.DynamicReadUsage=35049,t.EdgesGeometry=vo,t.EdgesHelper=function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new qa(new vo(t.geometry),new za({color:void 0!==e?e:16777215}))},t.EllipseCurve=yo,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=a,t.EquirectangularRefractionMapping=o,t.Euler=be,t.EventDispatcher=rt,t.ExtrudeBufferGeometry=gl,t.ExtrudeGeometry=gl,t.FaceColors=1,t.FileLoader=ah,t.FlatShading=1,t.Float16BufferAttribute=gn,t.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new mn(t,e)},t.Float32BufferAttribute=mn,t.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new vn(t,e)},t.Float64BufferAttribute=vn,t.FloatType=w,t.Fog=$s,t.FogExp2=Qs,t.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},t.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},t.FrontSide=0,t.Frustum=li,t.GLBufferAttribute=xc,t.GLSL1="100",t.GLSL3=it,t.GammaEncoding=q,t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=Bc,t.Group=Vs,t.HalfFloatType=S,t.HemisphereLight=dh,t.HemisphereLightHelper=class extends Be{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new yl(e);i.rotateY(.5*Math.PI),this.material=new rn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new on(s,3)),this.add(new Wn(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Ic.copy(this.light.color),Oc.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?Ic:Oc;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Dc.setFromMatrixPosition(this.light.matrixWorld).negate())}},t.HemisphereLightProbe=Gh,t.IcosahedronBufferGeometry=vl,t.IcosahedronGeometry=vl,t.ImageBitmapLoader=Fh,t.ImageLoader=oh,t.ImageUtils=Tt,t.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=Ia,t.InstancedBufferGeometry=kh,t.InstancedInterleavedBuffer=yc,t.InstancedMesh=Ua,t.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new un(t,e)},t.Int16BufferAttribute=un,t.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new pn(t,e)},t.Int32BufferAttribute=pn,t.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ln(t,e)},t.Int8BufferAttribute=ln,t.IntType=1013,t.InterleavedBuffer=ea,t.InterleavedBufferAttribute=ia,t.Interpolant=Gl,t.InterpolateDiscrete=U,t.InterpolateLinear=z,t.InterpolateSmooth=G,t.InvertStencilOp=5386,t.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},t.KeepStencilOp=tt,t.KeyframeTrack=jl,t.LOD=wa,t.LatheBufferGeometry=_l,t.LatheGeometry=_l,t.Layers=we,t.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=uh,t.LightProbe=Rh,t.Line=Xa,t.Line3=Cc,t.LineBasicMaterial=za,t.LineCurve=ko,t.LineCurve3=Do,t.LineDashedMaterial=Nl,t.LineLoop=Ja,t.LinePieces=1,t.LineSegments=qa,t.LineStrip=0,t.LinearEncoding=Y,t.LinearFilter=m,t.LinearInterpolant=Wl,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=_,t.LinearMipmapNearestFilter=v,t.LinearToneMapping=1,t.Loader=rh,t.LoaderUtils=Ph,t.LoadingManager=nh,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=qe,t.MaterialLoader=Lh,t.Math=mt,t.MathUtils=mt,t.Matrix3=_t,t.Matrix4=ue,t.MaxEquation=104,t.Mesh=Wn,t.MeshBasicMaterial=rn,t.MeshDepthMaterial=Fs,t.MeshDistanceMaterial=Ns,t.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},t.MeshLambertMaterial=Bl,t.MeshMatcapMaterial=Fl,t.MeshNormalMaterial=Ol,t.MeshPhongMaterial=Dl,t.MeshPhysicalMaterial=kl,t.MeshStandardMaterial=Pl,t.MeshToonMaterial=Il,t.MinEquation=103,t.MirroredRepeatWrapping=d,t.MixOperation=1,t.MultiMaterial=function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=p,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=g,t.NearestMipmapNearestFilter=f,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalAnimationBlendMode=j,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=Zl,t.Object3D=Be,t.ObjectLoader=class extends rh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===this.path?Ph.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new ah(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)},n,i)}loadAsync(t,e){const n=this;return _call(function(){const i=""===n.path?Ph.extractUrlBase(t):n.path;n.resourcePath=n.resourcePath||i;const r=new ah(n.manager);return r.setPath(n.path),r.setRequestHeader(n.requestHeader),r.setWithCredentials(n.withCredentials),_await(r.loadAsync(t,e),function(e){const i=JSON.parse(e),r=i.metadata;if(void 0===r||void 0===r.type||"geometry"===r.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return _await(n.parseAsync(i))})})}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),s=this.parseImages(t.images,function(){void 0!==e&&e(l)}),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,n),h=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,h),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}parseAsync(t){const e=this;return _call(function(){const n=e.parseAnimations(t.animations),i=e.parseShapes(t.shapes),r=e.parseGeometries(t.geometries,i);return _await(e.parseImagesAsync(t.images),function(i){const s=e.parseTextures(t.textures,i),a=e.parseMaterials(t.materials,s),o=e.parseObject(t.object,r,a,s,n),l=e.parseSkeletons(t.skeletons,o);return e.bindSkeletons(o,l),o})})}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new zo).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse(function(t){t.isBone&&(i[t.uuid]=t)}),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Da).fromJSON(t[e],i);n[r.uuid]=r}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new Dh;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Rl?s=Rl[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new Lh;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const i=s.materials[e];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),t.push(n[i.uuid])}i[s.uuid]=t}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=$l.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:bt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new nh(e);(r=new oh(n)).setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let t=0,e=r.length;t<e;t++){const e=s(r[t]);null!==e&&(e instanceof HTMLImageElement?i[n.uuid].push(e):i[n.uuid].push(new La(e.data,e.width,e.height)))}}else{const t=s(n.url);null!==t&&(i[n.uuid]=t)}}}return i}parseImagesAsync(t){const e=this;return _call(function(){const n=_async(function(t){let e=!1;return _invoke(function(){if("string"==typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:i.resourcePath+n;return _await((void 0).loadAsync(r),function(t){return e=!0,t})}},function(n){return e?n:t.data?{data:bt(t.type,t.data),width:t.width,height:t.height}:null})}),i=e,r={};return _await(_invoke(function(){if(void 0!==t&&t.length>0){(s=new oh(e.manager)).setCrossOrigin(e.crossOrigin);let i=0,s=t.length;return _continueIgnored(_for(function(){return i<s},function(){return i++},function(){const e=t[i],s=e.url;return _invokeIgnored(function(){if(Array.isArray(s)){r[e.uuid]=[];let t=0,i=s.length;return _continueIgnored(_for(function(){return t<i},function(){return t++},function(){const i=s[t];return _await(n(i),function(t){null!==t&&(t instanceof HTMLImageElement?r[e.uuid].push(t):r[e.uuid].push(new La(t.data,t.width,t.height)))})}))}return _await(n(e.url),function(t){null!==t&&(r[e.uuid]=t)})})}))}},function(){return r}))})}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];let a;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=e[s.image];Array.isArray(o)?(a=new ti(o),6===o.length&&(a.needsUpdate=!0)):(a=o&&o.data?new La(o.data,o.width,o.height):new Ct(o),o&&(a.needsUpdate=!0)),a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,Ih)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],Oh),a.wrapT=n(s.wrap[1],Oh)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,Bh)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,Bh)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i}parseObject(t,e,n,i,r){let s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function c(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":s=new ta,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new nn(t.background):s.background=c(t.background)),void 0!==t.environment&&(s.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new $s(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new Qs(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new Kn(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new bi(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Eh(t.color,t.intensity);break;case"DirectionalLight":s=new Th(t.color,t.intensity);break;case"PointLight":s=new Sh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Ch(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new _h(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new dh(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Rh).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=h(t.material),s=new Aa(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=h(t.material),s=new Wn(a,o);break;case"InstancedMesh":a=l(t.geometry),o=h(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;(s=new Ua(a,o,e)).instanceMatrix=new Ia(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new Ia(new Float32Array(i.array),i.itemSize));break;case"LOD":s=new wa;break;case"Line":s=new Xa(l(t.geometry),h(t.material));break;case"LineLoop":s=new Ja(l(t.geometry),h(t.material));break;case"LineSegments":s=new qa(l(t.geometry),h(t.material));break;case"PointCloud":case"Points":s=new no(l(t.geometry),h(t.material));break;case"Sprite":s=new _a(h(t.material));break;case"Group":s=new Vs;break;case"Bone":s=new Ra;break;default:s=new Be}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}})}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=yl,t.OctahedronGeometry=yl,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=bi,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=Fi,t.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Tn},t.Particle=function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new _a(t)},t.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ka(t)},t.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new no(t,e)},t.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ka(t)},t.Path=Uo,t.PerspectiveCamera=Kn,t.Plane=si,t.PlaneBufferGeometry=ui,t.PlaneGeometry=ui,t.PlaneHelper=class extends Xa{constructor(t,e=1,n=16776960){const i=n,r=new Tn;r.setAttribute("position",new mn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new za({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Tn;s.setAttribute("position",new mn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new Wn(s,new rn({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},t.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new no(t,e)},t.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ka(t)},t.PointLight=Sh,t.PointLightHelper=class extends Wn{constructor(t,e,n){super(new wl(e,4,2),new rn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t.Points=no,t.PointsMaterial=Ka,t.PolarGridHelper=class extends qa{constructor(t=10,e=16,n=8,i=64,r=4473924,s=8947848){r=new nn(r),s=new nn(s);const a=[],o=[];for(let n=0;n<=e;n++){const i=n/e*(2*Math.PI),l=Math.sin(i)*t,h=Math.cos(i)*t;a.push(0,0,0),a.push(l,0,h);const c=1&n?r:s;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let e=0;e<=n;e++){const l=1&e?r:s,h=t-t/n*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),n=Math.sin(e)*h,r=Math.cos(e)*h;a.push(n,0,r),o.push(l.r,l.g,l.b),e=(t+1)/i*(2*Math.PI),n=Math.sin(e)*h,r=Math.cos(e)*h,a.push(n,0,r),o.push(l.r,l.g,l.b)}}const l=new Tn;l.setAttribute("position",new mn(a,3)),l.setAttribute("color",new mn(o,3)),super(l,new za({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},t.PolyhedronBufferGeometry=co,t.PolyhedronGeometry=co,t.PositionalAudio=class extends Qh{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose($h,tc,ec),nc.set(0,0,1).applyQuaternion(tc);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime($h.x,t),e.positionY.linearRampToValueAtTime($h.y,t),e.positionZ.linearRampToValueAtTime($h.z,t),e.orientationX.linearRampToValueAtTime(nc.x,t),e.orientationY.linearRampToValueAtTime(nc.y,t),e.orientationZ.linearRampToValueAtTime(nc.z,t)}else e.setPosition($h.x,$h.y,$h.z),e.setOrientation(nc.x,nc.y,nc.z)}},t.PropertyBinding=fc,t.PropertyMixer=rc,t.QuadraticBezierCurve=Io,t.QuadraticBezierCurve3=Oo,t.Quaternion=Dt,t.QuaternionKeyframeTrack=Jl,t.QuaternionLinearInterpolant=ql,t.REVISION=e,t.RGBADepthPacking=3201,t.RGBAFormat=E,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_BPTC_Format=36492,t.RGBA_ETC2_EAC_Format=N,t.RGBA_PVRTC_2BPPV1_Format=B,t.RGBA_PVRTC_4BPPV1_Format=O,t.RGBA_S3TC_DXT1_Format=L,t.RGBA_S3TC_DXT3_Format=P,t.RGBA_S3TC_DXT5_Format=k,t.RGBDEncoding=$,t.RGBEEncoding=J,t.RGBEFormat=1023,t.RGBFormat=T,t.RGBIntegerFormat=1032,t.RGBM16Encoding=Q,t.RGBM7Encoding=K,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=F,t.RGB_PVRTC_2BPPV1_Format=I,t.RGB_PVRTC_4BPPV1_Format=D,t.RGB_S3TC_DXT1_Format=R,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=wi,t.Ray=ce,t.Raycaster=class{constructor(t,e,n=0,i=1/0){this.ray=new ce(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new we,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return wc(t,this,n,e),n.sort(bc),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)wc(t[i],this,n,e);return n.sort(bc),n}},t.RectAreaLight=Ch,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=c,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=xl,t.RingGeometry=xl,t.SRGB8_ALPHA8_ASTC_10x10_Format=37851,t.SRGB8_ALPHA8_ASTC_10x5_Format=37848,t.SRGB8_ALPHA8_ASTC_10x6_Format=37849,t.SRGB8_ALPHA8_ASTC_10x8_Format=37850,t.SRGB8_ALPHA8_ASTC_12x10_Format=37852,t.SRGB8_ALPHA8_ASTC_12x12_Format=37853,t.SRGB8_ALPHA8_ASTC_4x4_Format=37840,t.SRGB8_ALPHA8_ASTC_5x4_Format=37841,t.SRGB8_ALPHA8_ASTC_5x5_Format=37842,t.SRGB8_ALPHA8_ASTC_6x5_Format=37843,t.SRGB8_ALPHA8_ASTC_6x6_Format=37844,t.SRGB8_ALPHA8_ASTC_8x5_Format=37845,t.SRGB8_ALPHA8_ASTC_8x6_Format=37846,t.SRGB8_ALPHA8_ASTC_8x8_Format=37847,t.Scene=ta,t.SceneUtils=Kc,t.ShaderChunk=di,t.ShaderLib=fi,t.ShaderMaterial=qn,t.ShadowMaterial=Ll,t.Shape=zo,t.ShapeBufferGeometry=bl,t.ShapeGeometry=bl,t.ShapePath=class{constructor(){this.type="ShapePath",this.color=new nn,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Uo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function n(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new zo;r.curves=i.curves,e.push(r)}return e}function i(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],a=e[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],o=-o,a=e[r],l=-l),t.y<n.y||t.y>a.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-o*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(a.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=a.x)return!0}}return i}const r=dl.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);let a,o,l;const h=[];if(1===s.length)return o=s[0],(l=new zo).curves=o.curves,h.push(l),h;let c=!r(s[0].getPoints());c=t?!c:c;const u=[],d=[];let p,f,g=[],m=0;d[m]=void 0,g[m]=[];for(let e=0,n=s.length;e<n;e++)a=r(p=(o=s[e]).getPoints()),(a=t?!a:a)?(!c&&d[m]&&m++,d[m]={s:new zo,p:p},d[m].s.curves=o.curves,c&&m++,g[m]=[]):g[m].push({h:o,p:p[0]});if(!d[0])return n(s);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let n=0,r=d.length;n<r;n++){const r=g[n];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<d.length;r++)i(a.p,d[r].p)&&(n!==r&&e.push({froms:n,tos:r,hole:s}),o?(o=!1,u[r].push(a)):t=!0);o&&u[n].push(a)}}e.length>0&&(t||(g=u))}for(let t=0,e=d.length;t<e;t++){l=d[t].s,h.push(l),f=g[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return h}},t.ShapeUtils=dl,t.ShortType=1011,t.Skeleton=Da,t.SkeletonHelper=kc,t.SkinnedMesh=Aa,t.SmoothShading=2,t.Sphere=ne,t.SphereBufferGeometry=wl,t.SphereGeometry=wl,t.Spherical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(ct(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},t.SphericalHarmonics3=Ah,t.SplineCurve=Bo,t.SpotLight=_h,t.SpotLightHelper=class extends Be{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Tn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,s=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new mn(i,3));const r=new za({fog:!1,toneMapped:!1});this.cone=new qa(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Ac.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ac),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},t.Sprite=_a,t.SpriteMaterial=ra,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=et,t.StaticReadUsage=35045,t.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Kn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Kn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,jh.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(ot*e.fov*.5)/e.zoom;let s,a;Vh.elements[12]=-n,Wh.elements[12]=n,s=-r*e.aspect+i,a=r*e.aspect+i,jh.elements[0]=2*e.near/(a-s),jh.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(jh),s=-r*e.aspect-i,a=r*e.aspect-i,jh.elements[0]=2*e.near/(a-s),jh.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(jh)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Vh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Wh)}},t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Kl,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=Sl,t.TetrahedronGeometry=Sl,t.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Tn},t.Texture=Ct,t.TextureLoader=ch,t.TorusBufferGeometry=Ml,t.TorusGeometry=Ml,t.TorusKnotBufferGeometry=Tl,t.TorusKnotGeometry=Tl,t.Triangle=Ye,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=El,t.TubeGeometry=El,t.UVMapping=i,t.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new dn(t,e)},t.Uint16BufferAttribute=dn,t.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new fn(t,e)},t.Uint32BufferAttribute=fn,t.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new hn(t,e)},t.Uint8BufferAttribute=hn,t.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new cn(t,e)},t.Uint8ClampedBufferAttribute=cn,t.Uniform=_c,t.UniformsLib=pi,t.UniformsUtils=Zn,t.UnsignedByteType=y,t.UnsignedInt248Type=M,t.UnsignedIntType=b,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedShortType=x,t.VSMShadowMap=3,t.Vector2=vt,t.Vector3=It,t.Vector4=Rt,t.VectorKeyframeTrack=Ql,t.Vertex=function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new It(t,e,n)},t.VertexColors=2,t.VideoTexture=ro,t.WebGL1Renderer=Ks,t.WebGLCubeRenderTarget=ei,t.WebGLMultipleRenderTargets=Pt,t.WebGLMultisampleRenderTarget=kt,t.WebGLRenderTarget=Lt,t.WebGLRenderTargetCube=function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new ei(t,n)},t.WebGLRenderer=Js,t.WebGLUtils=Hs,t.WireframeGeometry=Cl,t.WireframeHelper=function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new qa(new Cl(t.geometry),new za({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=V,t.XHRLoader=function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ah(t)},t.ZeroCurvatureEnding=H,t.ZeroFactor=200,t.ZeroSlopeEnding=W,t.ZeroStencilOp=0,t.sRGBEncoding=Z,Object.defineProperty(t,"__esModule",{value:!0})}),function(){function t(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class n{constructor(t){this.parser=t,this.name=e.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const r=e.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let a;const o=new THREE.Color(16777215);void 0!==s.color&&o.fromArray(s.color);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":(a=new THREE.DirectionalLight(o)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new THREE.PointLight(o)).distance=l;break;case"spot":(a=new THREE.SpotLight(o)).distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(a),e.cache.add(n,i),i}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(t){return n._getNodeRef(e.cache,r,t)})}}class i{constructor(){this.name=e.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(t,e,n){const i=[];t.color=new THREE.Color(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture))}return Promise.all(i)}}class r{constructor(t){this.parser=t,this.name=e.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new THREE.Vector2(t,t)}return Promise.all(r)}}class s{constructor(t){this.parser=t,this.name=e.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new THREE.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];return void 0!==s.sheenColorFactor&&e.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class a{constructor(t){this.parser=t,this.name=e.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class o{constructor(t){this.parser=t,this.name=e.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;const a=s.attenuationColor||[1,1,1];return e.attenuationColor=new THREE.Color(a[0],a[1],a[2]),Promise.all(r)}}class l{constructor(t){this.parser=t,this.name=e.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class h{constructor(t){this.parser=t,this.name=e.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return e.specularColor=new THREE.Color(a[0],a[1],a[2]),void 0!==s.specularColorTexture&&r.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture).then(function(t){t.encoding=THREE.sRGBEncoding})),Promise.all(r)}}class c{constructor(t){this.parser=t,this.name=e.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=n.images[r.source],a=e.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,a)}}class u{constructor(t){this.parser=t,this.name=e.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const t=n.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(t,a,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class d{constructor(t){this.name=e.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then(function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,a=t.byteStride,o=new ArrayBuffer(s*a),l=new Uint8Array(e[0],n,i);return r.decodeGltfBuffer(new Uint8Array(o),s,a,l,t.mode,t.filter),o})}return null}}const p="glTF",f=12,g={JSON:1313821514,BIN:5130562};class m{constructor(t){this.name=e.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,f);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==p)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-f,r=new DataView(t,f);let s=0;for(;s<i;){const e=r.getUint32(s,!0);s+=4;const n=r.getUint32(s,!0);if(s+=4,n===g.JSON){const n=new Uint8Array(t,f+s,e);this.content=THREE.LoaderUtils.decodeText(n)}else if(n===g.BIN){const n=f+s;this.body=t.slice(n,n+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class v{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=e.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},o={},l={};for(const t in s){const e=L[t]||t.toLowerCase();a[e]=s[t]}for(const e in t.attributes){const i=L[e]||e.toLowerCase();if(void 0!==s[e]){const r=n.accessors[t.attributes[e]],s=E[r.componentType];l[i]=s,o[i]=!0===r.normalized}}return e.getDependency("bufferView",r).then(function(t){return new Promise(function(e){i.decodeDracoFile(t,function(t){for(const e in t.attributes){const n=t.attributes[e],i=o[e];void 0!==i&&(n.normalized=i)}e(t)},a,l)})})}}class _{constructor(){this.name=e.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale?t:(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t)}}class y extends THREE.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class x{constructor(){this.name=e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return y}extendParams(t,e,n){const i=e.extensions[this.name];t.color=new THREE.Color(1,1,1),t.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const e=i.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new THREE.Color(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const e=i.specularGlossinessTexture;r.push(n.assignTexture(t,"glossinessMap",e)),r.push(n.assignTexture(t,"specularMap",e))}return Promise.all(r)}createMaterial(t){const e=new y(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=THREE.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class b{constructor(){this.name=e.KHR_MESH_QUANTIZATION}}class w extends THREE.Interpolant{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let t=0;t!==i;t++)e[t]=n[r+t];return e}}w.prototype.beforeStart_=w.prototype.copySampleValue_,w.prototype.afterEnd_=w.prototype.copySampleValue_,w.prototype.interpolate_=function(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,h=i-e,c=(n-e)/h,u=c*c,d=u*c,p=t*l,f=p-l,g=-2*d+3*u,m=d-u,v=1-g,_=m-u+c;for(let t=0;t!==a;t++){const e=s[f+t+a],n=s[f+t+o]*h,i=s[p+t+a],l=s[p+t]*h;r[t]=v*e+_*n+g*i+m*l}return r};const S=new THREE.Quaternion;class M extends w{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return S.fromArray(r).normalize().toArray(r),r}}const T={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},E={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},A={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},L={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},P={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},k={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},D={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function I(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function O(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function B(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function F(t){const n=t.extensions&&t.extensions[e.KHR_DRACO_MESH_COMPRESSION];return n?"draco:"+n.bufferView+":"+n.indices+":"+N(n.attributes):t.indices+":"+N(t.attributes)+":"+t.mode}function N(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function U(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class z{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all(this._invokeAll(function(t){return t.beforeRoot&&t.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};I(r,s,i),O(s,i),Promise.all(n._invokeAll(function(t){return t.afterRoot&&t.afterRoot(s)})).then(function(){t(s)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n].joints;for(let e=0,n=i.length;e<n;e++)t[i[e]].isBone=!0}for(let e=0,i=t.length;e<i;e++){const i=t[e];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[n,i]of t.children.entries())r(i,e.children[n])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map(function(e,i){return n.getDependency(t,i)})),this.cache.add(t,e)}return e}loadBuffer(t){const n=this.json.buffers[t],i=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===t)return Promise.resolve(this.extensions[e.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(t,e){i.load(THREE.LoaderUtils.resolveURL(n.uri,r.path),t,void 0,function(){e(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)})}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(t){const r=t[0],s=R[i.type],a=E[i.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,h=i.byteOffset||0,c=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let d,p;if(c&&c!==l){const t=Math.floor(h/c),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(d=new a(r,t*c,i.count*c/o),l=new THREE.InterleavedBuffer(d,c/o),e.cache.add(n,l)),p=new THREE.InterleavedBufferAttribute(l,s,h%c/o,u)}else d=null===r?new a(i.count*s):new a(r,h,i.count*s),p=new THREE.BufferAttribute(d,s,u);if(void 0!==i.sparse){const e=R.SCALAR,n=E[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,h=new n(t[1],o,i.sparse.count*e),c=new a(t[2],l,i.sparse.count*s);null!==r&&(p=new THREE.BufferAttribute(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=h.length;t<e;t++){const e=h[t];if(p.setX(e,c[t*s]),s>=2&&p.setY(e,c[t*s+1]),s>=3&&p.setZ(e,c[t*s+2]),s>=4&&p.setW(e,c[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return p})}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t],r=e.images[i.source];let s=this.textureLoader;if(r.uri){const t=n.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,r,s)}loadTextureImage(t,e,n){const i=this,r=this.json,s=this.options,a=r.textures[t],o=(e.uri||e.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const l=self.URL||self.webkitURL;let h=e.uri||"",c=!1;if(void 0!==e.bufferView)h=i.getDependency("bufferView",e.bufferView).then(function(t){c=!0;const n=new Blob([t],{type:e.mimeType});return h=l.createObjectURL(n)});else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(h).then(function(t){return new Promise(function(e,i){let r=e;!0===n.isImageBitmapLoader&&(r=function(t){const n=new THREE.Texture(t);n.needsUpdate=!0,e(n)}),n.load(THREE.LoaderUtils.resolveURL(t,s.path),r,void 0,i)})}).then(function(e){!0===c&&l.revokeObjectURL(h),e.flipY=!1,a.name&&(e.name=a.name);const n=(r.samplers||{})[a.sampler]||{};return e.magFilter=C[n.magFilter]||THREE.LinearFilter,e.minFilter=C[n.minFilter]||THREE.LinearMipmapLinearFilter,e.wrapS=A[n.wrapS]||THREE.RepeatWrapping,e.wrapT=A[n.wrapT]||THREE.RepeatWrapping,i.associations.set(e,{textures:t}),e}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[o]=u,u}assignTexture(t,n,i){const r=this;return this.getDependency("texture",i.index).then(function(s){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===n&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+n+" not yet supported."),r.extensions[e.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[e.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const n=r.associations.get(s);s=r.extensions[e.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),r.associations.set(s,n)}}return t[n]=s,s})}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),i&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(t){const n=this,i=this.json,r=this.extensions,s=i.materials[t];let a;const o={},l=s.extensions||{},h=[];if(l[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=r[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=t.getMaterialType(),h.push(t.extendParams(o,s,n))}else if(l[e.KHR_MATERIALS_UNLIT]){const t=r[e.KHR_MATERIALS_UNLIT];a=t.getMaterialType(),h.push(t.extendParams(o,s,n))}else{const e=s.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(e.baseColorFactor)){const t=e.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==e.baseColorTexture&&h.push(n.assignTexture(o,"map",e.baseColorTexture)),o.metalness=void 0!==e.metallicFactor?e.metallicFactor:1,o.roughness=void 0!==e.roughnessFactor?e.roughnessFactor:1,void 0!==e.metallicRoughnessTexture&&(h.push(n.assignTexture(o,"metalnessMap",e.metallicRoughnessTexture)),h.push(n.assignTexture(o,"roughnessMap",e.metallicRoughnessTexture))),a=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),h.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)})))}!0===s.doubleSided&&(o.side=THREE.DoubleSide);const c=s.alphaMode||D.OPAQUE;if(c===D.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.format=THREE.RGBFormat,o.transparent=!1,c===D.MASK&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&a!==THREE.MeshBasicMaterial&&(h.push(n.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&a!==THREE.MeshBasicMaterial&&(h.push(n.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&a!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&a!==THREE.MeshBasicMaterial&&h.push(n.assignTexture(o,"emissiveMap",s.emissiveTexture)),Promise.all(h).then(function(){let i;return i=a===y?r[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new a(o),s.name&&(i.name=s.name),i.map&&(i.map.encoding=THREE.sRGBEncoding),i.emissiveMap&&(i.emissiveMap.encoding=THREE.sRGBEncoding),O(i,s),n.associations.set(i,{materials:t}),s.extensions&&I(r,i,s),i})}createUniqueName(t){const e=THREE.PropertyBinding.sanitizeNodeName(t||"");let n=e;for(let t=1;this.nodeNamesUsed[n];++t)n=e+"_"+t;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const n=this,i=this.extensions,r=this.primitiveCache;function s(t){return i[e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,n).then(function(e){return H(e,t,n)})}const a=[];for(let i=0,o=t.length;i<o;i++){const o=t[i],l=F(o),h=r[l];if(h)a.push(h.promise);else{let t;t=o.extensions&&o.extensions[e.KHR_DRACO_MESH_COMPRESSION]?s(o):H(new THREE.BufferGeometry,o,n),r[l]={primitive:o,promise:t},a.push(t)}}return Promise.all(a)}loadMesh(t){const e=this,n=this.json,i=this.extensions,r=n.meshes[t],s=r.primitives,a=[];for(let t=0,e=s.length;t<e;t++){const e=void 0===s[t].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),o.DefaultMaterial):this.getDependency("material",s[t].material);a.push(e)}var o;return a.push(e.loadGeometries(s)),Promise.all(a).then(function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let n=0,h=o.length;n<h;n++){const h=o[n],c=s[n];let u;const d=a[n];if(c.mode===T.TRIANGLES||c.mode===T.TRIANGLE_STRIP||c.mode===T.TRIANGLE_FAN||void 0===c.mode)!0!==(u=!0===r.isSkinnedMesh?new THREE.SkinnedMesh(h,d):new THREE.Mesh(h,d)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),c.mode===T.TRIANGLE_STRIP?u.geometry=W(u.geometry,THREE.TriangleStripDrawMode):c.mode===T.TRIANGLE_FAN&&(u.geometry=W(u.geometry,THREE.TriangleFanDrawMode));else if(c.mode===T.LINES)u=new THREE.LineSegments(h,d);else if(c.mode===T.LINE_STRIP)u=new THREE.Line(h,d);else if(c.mode===T.LINE_LOOP)u=new THREE.LineLoop(h,d);else{if(c.mode!==T.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new THREE.Points(h,d)}Object.keys(u.geometry.morphAttributes).length>0&&B(u,r),u.name=e.createUniqueName(r.name||"mesh_"+t),O(u,r),c.extensions&&I(i,u,c),e.assignFinalMaterial(u),l.push(u)}for(let n=0,i=l.length;n<i;n++)e.associations.set(l[n],{meshes:t,primitives:n});if(1===l.length)return l[0];const h=new THREE.Group;e.associations.set(h,{meshes:t});for(let t=0,e=l.length;t<e;t++)h.add(l[t]);return h})}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new THREE.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),O(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then(function(t){return n.inverseBindMatrices=t,n})}loadAnimation(t){const e=this.json.animations[t],n=[],i=[],r=[],s=[],a=[];for(let t=0,o=e.channels.length;t<o;t++){const o=e.channels[t],l=e.samplers[o.sampler],h=o.target,c=void 0!==h.node?h.node:h.id,u=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;n.push(this.getDependency("node",c)),i.push(this.getDependency("accessor",u)),r.push(this.getDependency("accessor",d)),s.push(l),a.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(a)]).then(function(n){const i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],l=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],n=r[t],h=s[t],c=a[t],u=o[t];if(void 0===e)continue;let d;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,P[u.path]){case P.weights:d=THREE.NumberKeyframeTrack;break;case P.rotation:d=THREE.QuaternionKeyframeTrack;break;case P.position:case P.scale:default:d=THREE.VectorKeyframeTrack}const p=e.name?e.name:e.uuid,f=void 0!==c.interpolation?k[c.interpolation]:THREE.InterpolateLinear,g=[];P[u.path]===P.weights?e.traverse(function(t){t.morphTargetInfluences&&g.push(t.name?t.name:t.uuid)}):g.push(p);let m=h.array;if(h.normalized){const t=U(m.constructor),e=new Float32Array(m.length);for(let n=0,i=m.length;n<i;n++)e[n]=m[n]*t;m=e}for(let t=0,e=g.length;t<e;t++){const e=new d(g[t]+"."+P[u.path],n.array,m,f);"CUBICSPLINE"===c.interpolation&&(e.createInterpolant=function(t){return new(this instanceof THREE.QuaternionKeyframeTrack?M:w)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const h=e.name?e.name:"animation_"+t;return new THREE.AnimationClip(h,void 0,l)})}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse(function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]}),e})}loadNode(t){const e=this.json,n=this.extensions,i=this,r=e.nodes[t],s=r.name?i.createUniqueName(r.name):"";return function(){const e=[],n=i._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(t)});return n&&e.push(n),void 0!==r.camera&&e.push(i.getDependency("camera",r.camera).then(function(t){return i._getNodeRef(i.cameraCache,r.camera,t)})),i._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)}).forEach(function(t){e.push(t)}),Promise.all(e)}().then(function(e){let a;if((a=!0===r.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(let t=0,n=e.length;t<n;t++)a.add(e[t]);if(r.name&&(a.userData.name=r.name,a.name=s),O(a,r),r.extensions&&I(n,a,r),void 0!==r.matrix){const t=new THREE.Matrix4;t.fromArray(r.matrix),a.applyMatrix4(t)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=t,a})}loadScene(t){const e=this.json,n=this.extensions,i=this.json.scenes[t],r=this,s=new THREE.Group;i.name&&(s.name=r.createUniqueName(i.name)),O(s,i),i.extensions&&I(n,s,i);const a=i.nodes||[],o=[];for(let t=0,n=a.length;t<n;t++)o.push(G(a[t],s,e,r));return Promise.all(o).then(function(){return r.associations=(t=>{const e=new Map;for(const[t,n]of r.associations)(t instanceof THREE.Material||t instanceof THREE.Texture)&&e.set(t,n);return t.traverse(t=>{const n=r.associations.get(t);null!=n&&e.set(t,n)}),e})(s),s})}}function G(t,e,n,i){const r=n.nodes[t];return i.getDependency("node",t).then(function(t){if(void 0===r.skin)return t;let e;return i.getDependency("skin",r.skin).then(function(t){const n=[];for(let r=0,s=(e=t).joints.length;r<s;r++)n.push(i.getDependency("node",e.joints[r]));return Promise.all(n)}).then(function(n){return t.traverse(function(t){if(!t.isMesh)return;const i=[],r=[];for(let t=0,s=n.length;t<s;t++){const s=n[t];if(s){i.push(s);const n=new THREE.Matrix4;void 0!==e.inverseBindMatrices&&n.fromArray(e.inverseBindMatrices.array,16*t),r.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}t.bind(new THREE.Skeleton(i,r),t.matrixWorld)}),t})}).then(function(t){e.add(t);const s=[];if(r.children){const e=r.children;for(let r=0,a=e.length;r<a;r++){const a=e[r];s.push(G(a,t,n,i))}}return Promise.all(s)})}function H(t,e,n){const i=e.attributes,r=[];function s(e,i){return n.getDependency("accessor",e).then(function(e){t.setAttribute(i,e)})}for(const e in i){const n=L[e]||e.toLowerCase();n in t.attributes||r.push(s(i[e],n))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then(function(e){t.setIndex(e)});r.push(i)}return O(t,e),function(t,e,n){const i=e.attributes,r=new THREE.Box3;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new THREE.Vector3(e[0],e[1],e[2]),new THREE.Vector3(s[0],s[1],s[2])),t.normalized){const e=U(E[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new THREE.Vector3,e=new THREE.Vector3;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,a=i.max;if(void 0!==s&&void 0!==a){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),i.normalized){const t=U(E[i.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(t)}t.boundingBox=r;const a=new THREE.Sphere;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=a}(t,e,n),Promise.all(r).then(function(){return void 0!==e.targets?function(t,e,n){let i=!1,r=!1;for(let t=0,n=e.length;t<n;t++){const n=e[t];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),i&&r)break}if(!i&&!r)return Promise.resolve(t);const s=[],a=[];for(let o=0,l=e.length;o<l;o++){const l=e[o];if(i){const e=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):t.attributes.position;s.push(e)}if(r){const e=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):t.attributes.normal;a.push(e)}}return Promise.all([Promise.all(s),Promise.all(a)]).then(function(e){const n=e[0],s=e[1];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=s),t.morphTargetsRelative=!0,t})}(t,e.targets,n):t})}function W(t,e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,r=[];if(e===THREE.TriangleFanDrawMode)for(let t=1;t<=i;t++)r.push(n.getX(0)),r.push(n.getX(t)),r.push(n.getX(t+1));else for(let t=0;t<i;t++)t%2==0?(r.push(n.getX(t)),r.push(n.getX(t+1)),r.push(n.getX(t+2))):(r.push(n.getX(t+2)),r.push(n.getX(t+1)),r.push(n.getX(t)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s}THREE.GLTFLoader=class extends THREE.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new r(t)}),this.register(function(t){return new c(t)}),this.register(function(t){return new u(t)}),this.register(function(t){return new s(t)}),this.register(function(t){return new a(t)}),this.register(function(t){return new o(t)}),this.register(function(t){return new l(t)}),this.register(function(t){return new h(t)}),this.register(function(t){return new n(t)}),this.register(function(t){return new d(t)})}load(t,e,n,i){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){i?i(e):console.error(e),r.manager.itemError(t),r.manager.itemEnd(t)},o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(n){try{r.parse(n,s,function(n){e(n),r.manager.itemEnd(t)},a)}catch(t){a(t)}},n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,r,s){let a;const o={},l={};if("string"==typeof t)a=t;else if(THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4))===p){try{o[e.KHR_BINARY_GLTF]=new m(t)}catch(t){return void(s&&s(t))}a=o[e.KHR_BINARY_GLTF].content}else a=THREE.LoaderUtils.decodeText(new Uint8Array(t));const h=JSON.parse(a);if(void 0===h.asset||h.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new z(h,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](c);l[e.name]=e,o[e.name]=!0}if(h.extensionsUsed)for(let t=0;t<h.extensionsUsed.length;++t){const n=h.extensionsUsed[t],r=h.extensionsRequired||[];switch(n){case e.KHR_MATERIALS_UNLIT:o[n]=new i;break;case e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[n]=new x;break;case e.KHR_DRACO_MESH_COMPRESSION:o[n]=new v(h,this.dracoLoader);break;case e.KHR_TEXTURE_TRANSFORM:o[n]=new _;break;case e.KHR_MESH_QUANTIZATION:o[n]=new b;break;default:r.indexOf(n)>=0&&void 0===l[n]&&console.warn('THREE.GLTFLoader: Unknown extension "'+n+'".')}}c.setExtensions(o),c.setPlugins(l),c.parse(r,s)}parseAsync(t,e){const n=this;return new Promise(function(i,r){n.parse(t,e,i,r)})}}}(),function(){function t(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function e(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function n(n,i,r){if("undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&n instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&n instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap){const s=1024/Math.max(n.width,n.height),a=document.createElement("canvas");a.width=n.width*Math.min(1,s),a.height=n.height*Math.min(1,s);const o=a.getContext("2d");if(o.drawImage(n,0,0,a.width,a.height),void 0!==i||void 0!==r){let n=1,s=1,l=1;if(null!=i){const t=parseInt(i,16);n=(t>>16&255)/255,s=(t>>8&255)/255,l=(255&t)/255}const h=o.getImageData(0,0,a.width,a.height),c=h.data;for(let i=0;i<c.length;i+=4){let a=c[i+0],o=c[i+1],h=c[i+2];a=t(a),o=t(o),h=t(h),o*=s,h*=l,a=e(a*=n),o=e(o),h=e(h),c[i+0]=a,c[i+1]=o,c[i+2]=h,"r"===r?(c[i+1]=c[i+0],c[i+2]=c[i+0]):"g"===r?(c[i+0]=c[i+1],c[i+2]=c[i+1]):"b"===r&&(c[i+0]=c[i+2],c[i+1]=c[i+2])}o.putImageData(h,0,0)}return a}}const i=7;function r(t,e){return`(${t[e+0]}, ${t[e+1]}, ${t[e+2]}, ${t[e+3]})`}function s(t,e){if(void 0===t)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const n=[];for(let e=0;e<t.count;e++){const r=t.getX(e),s=t.getY(e),a=t.getZ(e);n.push(`(${r.toPrecision(i)}, ${s.toPrecision(i)}, ${a.toPrecision(i)})`)}return n.join(", ")}function a(t,e){const n="            ",i=[],r=[];function s(n,i,r){let s=n.id+(r?"_"+r.getHexString():"");"occlusion"===i?s+="!r":"roughness"===i?s+="!g":"metallic"===i&&(s+="!b");const a=1023===n.format;return e[s]=n,`\n        def Shader "Transform2d_${i}" (\n            sdrMetadata = {\n                string role = "math"\n            }\n        )\n        {\n            uniform token info:id = "UsdTransform2d"\n            float2 inputs:in.connect = </Materials/Material_${t.id}/uvReader_st.outputs:result>\n            float2 inputs:scale = ${l(n.repeat)}\n            float2 inputs:translation = ${l(n.offset)}\n            float2 outputs:result\n        }\n\n        def Shader "Texture_${n.id}_${i}"\n        {\n            uniform token info:id = "UsdUVTexture"\n            asset inputs:file = @textures/Texture_${s}.${a?"png":"jpg"}@\n            float2 inputs:st.connect = </Materials/Material_${t.id}/Transform2d_${i}.outputs:result>\n            token inputs:wrapS = "repeat"\n            token inputs:wrapT = "repeat"\n\t\t\t${"roughness"!==i&&"metallic"!==i?"float outputs:r":""}\n\t\t\t${"occlusion"!==i&&"metallic"!==i?"float outputs:g":""}\n\t\t\t${"occlusion"!==i&&"roughness"!==i?"float outputs:b":""}\n\t\t\t${a&&"occlusion"!==i&&"roughness"!==i&&"metallic"!==i?"float outputs:a":""}\n\t\t\t${"occlusion"!==i&&"roughness"!==i&&"metallic"!==i?"float3 outputs:rgb":""}\n        }`}return null!==t.map?(i.push(`${n}color3f inputs:diffuseColor.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:rgb>`),r.push(s(t.map,"diffuse",t.color)),null!=t.alphaTest&&t.alphaTest>0&&!t.alphaMap&&(i.push(`${n}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:a>`),i.push(`${n}float inputs:opacityThreshold = 0.0001`))):i.push(`${n}color3f inputs:diffuseColor = ${o(t.color)}`),null!==t.emissiveMap?(i.push(`${n}color3f inputs:emissiveColor.connect = </Materials/Material_${t.id}/Texture_${t.emissiveMap.id}_emissive.outputs:rgb>`),r.push(s(t.emissiveMap,"emissive"))):t.emissive.getHex()>0&&i.push(`${n}color3f inputs:emissiveColor = ${o(t.emissive)}`),null!==t.normalMap&&(i.push(`${n}normal3f inputs:normal.connect = </Materials/Material_${t.id}/Texture_${t.normalMap.id}_normal.outputs:rgb>`),r.push(s(t.normalMap,"normal"))),null!==t.aoMap&&(i.push(`${n}float inputs:occlusion.connect = </Materials/Material_${t.id}/Texture_${t.aoMap.id}_occlusion.outputs:r>`),r.push(s(t.aoMap,"occlusion"))),null!==t.roughnessMap&&1===t.roughness?(i.push(`${n}float inputs:roughness.connect = </Materials/Material_${t.id}/Texture_${t.roughnessMap.id}_roughness.outputs:g>`),r.push(s(t.roughnessMap,"roughness"))):i.push(`${n}float inputs:roughness = ${t.roughness}`),null!==t.metalnessMap&&1===t.metalness?(i.push(`${n}float inputs:metallic.connect = </Materials/Material_${t.id}/Texture_${t.metalnessMap.id}_metallic.outputs:b>`),r.push(s(t.metalnessMap,"metallic"))):i.push(`${n}float inputs:metallic = ${t.metalness}`),null!==t.alphaMap?(i.push(`${n}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.alphaMap.id}_opacity.outputs:r>`),i.push(`${n}float inputs:opacityThreshold = 0.0001`),r.push(s(t.alphaMap,"opacity"))):i.push(`${n}float inputs:opacity = ${t.opacity}`),t.isMeshPhysicalMaterial&&(i.push(`${n}float inputs:clearcoat = ${t.clearcoat}`),i.push(`${n}float inputs:clearcoatRoughness = ${t.clearcoatRoughness}`),i.push(`${n}float inputs:ior = ${t.ior}`)),`\n    def Material "Material_${t.id}"\n    {\n        def Shader "PreviewSurface"\n        {\n            uniform token info:id = "UsdPreviewSurface"\n${i.join("\n")}\n            int inputs:useSpecularWorkflow = 0\n            token outputs:surface\n        }\n\n        token outputs:surface.connect = </Materials/Material_${t.id}/PreviewSurface.outputs:surface>\n        token inputs:frame:stPrimvarName = "st"\n\n        def Shader "uvReader_st"\n        {\n            uniform token info:id = "UsdPrimvarReader_float2"\n            token inputs:varname.connect = </Materials/Material_${t.id}.inputs:frame:stPrimvarName>\n            float2 inputs:fallback = (0.0, 0.0)\n            float2 outputs:result\n        }\n\n${r.join("\n")}\n\n    }\n`}function o(t){return`(${t.r}, ${t.g}, ${t.b})`}function l(t){return`(${t.x}, ${t.y})`}THREE.USDZExporter=class{parse(t){return _call(function(){const e={"model.usda":null};let o='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n';const l={},h={};return t.traverseVisible(t=>{if(t.isMesh)if(t.material.isMeshStandardMaterial){const n=t.geometry,a=t.material,h="geometries/Geometry_"+n.id+".usd";if(!(h in e)){const t=function(t){return`\ndef "Geometry"\n{\n  ${function(t){const e=t.attributes,n=e.position.count;return`\n    def Mesh "Geometry"\n    {\n        int[] faceVertexCounts = [${function(t){const e=null!==t.index?t.index.count:t.attributes.position.count;return Array(e/3).fill(3).join(", ")}(t)}]\n        int[] faceVertexIndices = [${function(t){const e=t.index,n=[];if(null!==e)for(let t=0;t<e.count;t++)n.push(e.getX(t));else{const e=t.attributes.position.count;for(let t=0;t<e;t++)n.push(t)}return n.join(", ")}(t)}]\n        normal3f[] normals = [${s(e.normal,n)}] (\n            interpolation = "vertex"\n        )\n        point3f[] points = [${s(e.position,n)}]\n        float2[] primvars:st = [${function(t,e){if(void 0===t)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const n=[];for(let e=0;e<t.count;e++){const r=t.getX(e),s=t.getY(e);n.push(`(${r.toPrecision(i)}, ${1-s.toPrecision(i)})`)}return n.join(", ")}(e.uv,n)}] (\n            interpolation = "vertex"\n        )\n        uniform token subdivisionScheme = "none"\n    }\n`}(n)}\n}\n`}();e[h]=function(t){let e='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n';return e+=t,fflate.strToU8(e)}(t)}a.uuid in l||(l[a.uuid]=a),o+=function(t,e,n){const i="Object_"+t.id,s=function(t){const e=t.elements;return`( ${r(e,0)}, ${r(e,4)}, ${r(e,8)}, ${r(e,12)} )`}(t.matrixWorld);return t.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",t),`def Xform "${i}" (\n    prepend references = @./geometries/Geometry_${e.id}.usd@</Geometry>\n)\n{\n    matrix4d xformOp:transform = ${s}\n    uniform token[] xformOpOrder = ["xformOp:transform"]\n\n    rel material:binding = </Materials/Material_${n.id}>\n}\n\n`}(t,n,a)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",t)}),o+=function(t,e){const n=[];for(const i in t){const r=t[i];n.push(a(r,e))}return`def "Materials"\n{\n${n.join("")}\n}\n\n`}(l,h),e["model.usda"]=fflate.strToU8(o),o=null,_await(_continue(_forIn(h,function(t){const i=h[t],r=t.split("_")[1],s=t.split("!")[1],a=1023===i.format,o=n(i.image,r,s);return _await(new Promise(t=>o.toBlob(t,a?"image/png":"image/jpeg",1)),function(n){return _await(n.arrayBuffer(),function(n){e[`textures/Texture_${t}.${a?"png":"jpg"}`]=new Uint8Array(n)})})}),function(){let t=0;for(const n in e){const i=e[n],r=63&(t+=34+n.length);if(4!==r){const t=new Uint8Array(64-r);e[n]=[i,{extra:{12345:t}}]}t=i.length}return fflate.zipSync(e,{level:0})}))})}}}();