!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PointerEventsPolyfill=e()}(this,function(){"use strict";var t=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],e=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function i(i,n){n=n||Object.create(null);var r=document.createEvent("Event");r.initEvent(i,n.bubbles||!1,n.cancelable||!1);for(var s,o=2;o<t.length;o++)r[s=t[o]]=n[s]||e[o];r.buttons=n.buttons||0;var a;return a=n.pressure&&r.buttons?n.pressure:r.buttons?.5:0,r.x=r.clientX,r.y=r.clientY,r.pointerId=n.pointerId||0,r.width=n.width||0,r.height=n.height||0,r.pressure=a,r.tiltX=n.tiltX||0,r.tiltY=n.tiltY||0,r.pointerType=n.pointerType||"",r.hwTimestamp=n.hwTimestamp||0,r.isPrimary=n.isPrimary||!1,r}var n=window.Map&&window.Map.prototype.forEach?Map:r;function r(){this.array=[],this.size=0}r.prototype={set:function(t,e){if(void 0===e)return this.delete(t);this.has(t)||this.size++,this.array[t]=e},has:function(t){return void 0!==this.array[t]},delete:function(t){this.has(t)&&(delete this.array[t],this.size--)},get:function(t){return this.array[t]},clear:function(){this.array.length=0,this.size=0},forEach:function(t,e){return this.array.forEach(function(i,n){t.call(e,i,n,this)},this)}};var s=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],o=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],a={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},h="undefined"!=typeof SVGElementInstance,l={pointermap:new n,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(t,e){var i=e,n=i.events;n&&(n.forEach(function(t){i[t]&&(this.eventMap[t]=i[t].bind(i))},this),this.eventSources[t]=i,this.eventSourceList.push(i))},register:function(t){for(var e,i=this.eventSourceList.length,n=0;n<i&&(e=this.eventSourceList[n]);n++)e.register.call(e,t)},unregister:function(t){for(var e,i=this.eventSourceList.length,n=0;n<i&&(e=this.eventSourceList[n]);n++)e.unregister.call(e,t)},contains:function(t,e){try{return t.contains(e)}catch(t){return!1}},down:function(t){t.bubbles=!0,this.fireEvent("pointerdown",t)},move:function(t){t.bubbles=!0,this.fireEvent("pointermove",t)},up:function(t){t.bubbles=!0,this.fireEvent("pointerup",t)},enter:function(t){t.bubbles=!1,this.fireEvent("pointerenter",t)},leave:function(t){t.bubbles=!1,this.fireEvent("pointerleave",t)},over:function(t){t.bubbles=!0,this.fireEvent("pointerover",t)},out:function(t){t.bubbles=!0,this.fireEvent("pointerout",t)},cancel:function(t){t.bubbles=!0,this.fireEvent("pointercancel",t)},leaveOut:function(t){this.out(t),this.propagate(t,this.leave,!1)},enterOver:function(t){this.over(t),this.propagate(t,this.enter,!0)},eventHandler:function(t){if(!t._handledByPE){var e=t.type,i=this.eventMap&&this.eventMap[e];i&&i(t),t._handledByPE=!0}},listen:function(t,e){e.forEach(function(e){this.addEvent(t,e)},this)},unlisten:function(t,e){e.forEach(function(e){this.removeEvent(t,e)},this)},addEvent:function(t,e){t.addEventListener(e,this.boundHandler)},removeEvent:function(t,e){t.removeEventListener(e,this.boundHandler)},makeEvent:function(t,e){this.captureInfo[e.pointerId]&&(e.relatedTarget=null);var n=new i(t,e);return e.preventDefault&&(n.preventDefault=e.preventDefault),n._target=n._target||e.target,n},fireEvent:function(t,e){var i=this.makeEvent(t,e);return this.dispatchEvent(i)},cloneEvent:function(t){for(var e,i=Object.create(null),n=0;n<s.length;n++)i[e=s[n]]=t[e]||o[n],!h||"target"!==e&&"relatedTarget"!==e||i[e]instanceof SVGElementInstance&&(i[e]=i[e].correspondingUseElement);return t.preventDefault&&(i.preventDefault=function(){t.preventDefault()}),i},getTarget:function(t){var e=this.captureInfo[t.pointerId];return e?t._target!==e&&t.type in a?void 0:e:t._target},propagate:function(t,e,i){for(var n=t.target,r=[];!n.contains(t.relatedTarget)&&n!==document;)r.push(n),n=n.parentNode;i&&r.reverse(),r.forEach(function(i){t.target=i,e.call(this,t)},this)},setCapture:function(t,e){this.captureInfo[t]&&this.releaseCapture(t),this.captureInfo[t]=e;var n=new i("gotpointercapture");n.pointerId=t,this.implicitRelease=this.releaseCapture.bind(this,t),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease),n._target=e,this.asyncDispatchEvent(n)},releaseCapture:function(t){var e=this.captureInfo[t];if(e){var n=new i("lostpointercapture");n.pointerId=t,this.captureInfo[t]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),n._target=e,this.asyncDispatchEvent(n)}},dispatchEvent:function(t){var e=this.getTarget(t);if(e)return e.dispatchEvent(t)},asyncDispatchEvent:function(t){requestAnimationFrame(this.dispatchEvent.bind(this,t))}};l.boundHandler=l.eventHandler.bind(l);var c={shadow:function(t){if(t)return t.shadowRoot||t.webkitShadowRoot},canTarget:function(t){return t&&Boolean(t.elementFromPoint)},targetingShadow:function(t){var e=this.shadow(t);if(this.canTarget(e))return e},olderShadow:function(t){var e=t.olderShadowRoot;if(!e){var i=t.querySelector("shadow");i&&(e=i.olderShadowRoot)}return e},allShadows:function(t){for(var e=[],i=this.shadow(t);i;)e.push(i),i=this.olderShadow(i);return e},searchRoot:function(t,e,i){if(t){var n,r,s=t.elementFromPoint(e,i);for(r=this.targetingShadow(s);r;){if(n=r.elementFromPoint(e,i)){var o=this.targetingShadow(n);return this.searchRoot(o,e,i)||n}r=this.olderShadow(r)}return s}},owner:function(t){for(var e=t;e.parentNode;)e=e.parentNode;return e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(e=document),e},findTarget:function(t){var e=t.clientX,i=t.clientY,n=this.owner(t.target);return n.elementFromPoint(e,i)||(n=document),this.searchRoot(n,e,i)}},u=Array.prototype.forEach.call.bind(Array.prototype.forEach),f=Array.prototype.map.call.bind(Array.prototype.map),d=Array.prototype.slice.call.bind(Array.prototype.slice),p=Array.prototype.filter.call.bind(Array.prototype.filter),g=window.MutationObserver||window.WebKitMutationObserver,v={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function m(t,e,i,n){this.addCallback=t.bind(n),this.removeCallback=e.bind(n),this.changedCallback=i.bind(n),g&&(this.observer=new g(this.mutationWatcher.bind(this)))}function _(t){return"body /shadow-deep/ "+y(t)}function y(t){return'[touch-action="'+t+'"]'}function x(t){return"{ -ms-touch-action: "+t+"; touch-action: "+t+"; }"}m.prototype={watchSubtree:function(t){this.observer&&c.canTarget(t)&&this.observer.observe(t,v)},enableOnSubtree:function(t){this.watchSubtree(t),t===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(t)},installNewSubtree:function(t){u(this.findElements(t),this.addElement,this)},findElements:function(t){return t.querySelectorAll?t.querySelectorAll("[touch-action]"):[]},removeElement:function(t){this.removeCallback(t)},addElement:function(t){this.addCallback(t)},elementChanged:function(t,e){this.changedCallback(t,e)},concatLists:function(t,e){return t.concat(d(e))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(t){return t.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(t){var e=f(t,this.findElements,this);return e.push(p(t,this.isElement)),e.reduce(this.concatLists,[])},mutationWatcher:function(t){t.forEach(this.mutationHandler,this)},mutationHandler:function(t){"childList"===t.type?(this.flattenMutationTree(t.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(t.removedNodes).forEach(this.removeElement,this)):"attributes"===t.type&&this.elementChanged(t.target,t.oldValue)}};var b=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],w="",S=window.PointerEvent||window.MSPointerEvent,C=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,T=l.pointermap,k=[1,4,2,8,16],E=!1;try{E=1===new MouseEvent("test",{buttons:1}).buttons}catch(t){}var A,M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(t){l.listen(t,this.events)},unregister:function(t){l.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(t){for(var e,i=this.lastTouches,n=t.clientX,r=t.clientY,s=0,o=i.length;s<o&&(e=i[s]);s++){var a=Math.abs(n-e.x),h=Math.abs(r-e.y);if(a<=25&&h<=25)return!0}},prepareEvent:function(t){var e=l.cloneEvent(t),i=e.preventDefault;return e.preventDefault=function(){t.preventDefault(),i()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,e},prepareButtonsForMove:function(t,e){var i=T.get(this.POINTER_ID);0!==e.which&&i?t.buttons=i.buttons:t.buttons=0,e.buttons=t.buttons},mousedown:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=T.get(this.POINTER_ID),i=this.prepareEvent(t);E||(i.buttons=k[i.button],e&&(i.buttons|=e.buttons),t.buttons=i.buttons),T.set(this.POINTER_ID,t),e&&0!==e.buttons?l.move(i):l.down(i)}},mousemove:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);E||this.prepareButtonsForMove(e,t),e.button=-1,T.set(this.POINTER_ID,t),l.move(e)}},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=T.get(this.POINTER_ID),i=this.prepareEvent(t);if(!E){var n=k[i.button];i.buttons=e?e.buttons&~n:0,t.buttons=i.buttons}T.set(this.POINTER_ID,t),i.buttons&=~k[i.button],0===i.buttons?l.up(i):l.move(i)}},mouseover:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);E||this.prepareButtonsForMove(e,t),e.button=-1,T.set(this.POINTER_ID,t),l.enterOver(e)}},mouseout:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);E||this.prepareButtonsForMove(e,t),e.button=-1,l.leaveOut(e)}},cancel:function(t){var e=this.prepareEvent(t);l.cancel(e),this.deactivateMouse()},deactivateMouse:function(){T.delete(this.POINTER_ID)}},D=l.captureInfo,O=c.findTarget.bind(c),L=c.allShadows.bind(c),P=l.pointermap,B={events:["touchstart","touchmove","touchend","touchcancel"],register:function(t){A.enableOnSubtree(t)},unregister:function(){},elementAdded:function(t){var e=t.getAttribute("touch-action"),i=this.touchActionToScrollType(e);i&&(t._scrollType=i,l.listen(t,this.events),L(t).forEach(function(t){t._scrollType=i,l.listen(t,this.events)},this))},elementRemoved:function(t){t._scrollType=void 0,l.unlisten(t,this.events),L(t).forEach(function(t){t._scrollType=void 0,l.unlisten(t,this.events)},this)},elementChanged:function(t,e){var i=t.getAttribute("touch-action"),n=this.touchActionToScrollType(i),r=this.touchActionToScrollType(e);n&&r?(t._scrollType=n,L(t).forEach(function(t){t._scrollType=n},this)):r?this.elementRemoved(t):n&&this.elementAdded(t)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(t){var e=t,i=this.scrollTypes;return"none"===e?"none":e===i.XSCROLLER?"X":e===i.YSCROLLER?"Y":i.SCROLLER.exec(e)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){(0===P.size||1===P.size&&P.has(1))&&(this.firstTouch=t.identifier,this.firstXY={X:t.clientX,Y:t.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(t){t.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var t=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(t,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(t){var e=0;return"touchstart"!==t&&"touchmove"!==t||(e=1),e},touchToPointer:function(t){var e=this.currentTouchEvent,i=l.cloneEvent(t),n=i.pointerId=t.identifier+2;i.target=D[n]||O(i),i.bubbles=!0,i.cancelable=!0,i.detail=this.clickCount,i.button=0,i.buttons=this.typeToButtons(e.type),i.width=t.radiusX||t.webkitRadiusX||0,i.height=t.radiusY||t.webkitRadiusY||0,i.pressure=t.force||t.webkitForce||.5,i.isPrimary=this.isPrimaryTouch(t),i.pointerType=this.POINTER_TYPE,i.altKey=e.altKey,i.ctrlKey=e.ctrlKey,i.metaKey=e.metaKey,i.shiftKey=e.shiftKey;var r=this;return i.preventDefault=function(){r.scrolling=!1,r.firstXY=null,e.preventDefault()},i},processTouches:function(t,e){var i=t.changedTouches;this.currentTouchEvent=t;for(var n,r=0;r<i.length;r++)n=i[r],e.call(this,this.touchToPointer(n))},shouldScroll:function(t){if(this.firstXY){var e,i=t.currentTarget._scrollType;if("none"===i)e=!1;else if("XY"===i)e=!0;else{var n=t.changedTouches[0],r=i,s="Y"===i?"X":"Y";e=Math.abs(n["client"+r]-this.firstXY[r])>=Math.abs(n["client"+s]-this.firstXY[s])}return this.firstXY=null,e}},findTouch:function(t,e){for(var i,n=0,r=t.length;n<r&&(i=t[n]);n++)if(i.identifier===e)return!0},vacuumTouches:function(t){var e=t.touches;if(P.size>=e.length){var i=[];P.forEach(function(t,n){if(1!==n&&!this.findTouch(e,n-2)){var r=t.out;i.push(r)}},this),i.forEach(this.cancelOut,this)}},touchstart:function(t){this.vacuumTouches(t),this.setPrimaryTouch(t.changedTouches[0]),this.dedupSynthMouse(t),this.scrolling||(this.clickCount++,this.processTouches(t,this.overDown))},overDown:function(t){P.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),l.enterOver(t),l.down(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var e=t,i=P.get(e.pointerId);if(i){var n=i.out,r=i.outTarget;l.move(e),n&&r!==e.target&&(n.relatedTarget=e.target,e.relatedTarget=r,n.target=r,e.target?(l.leaveOut(n),l.enterOver(e)):(e.target=r,e.relatedTarget=null,this.cancelOut(e))),i.out=e,i.outTarget=e.target}},touchend:function(t){this.dedupSynthMouse(t),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(l.up(t),l.leaveOut(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){l.cancel(t),l.leaveOut(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){P.delete(t.pointerId),this.removePrimaryPointer(t)},dedupSynthMouse:function(t){var e=M.lastTouches,i=t.changedTouches[0];if(this.isPrimaryTouch(i)){var n={x:i.clientX,y:i.clientY};e.push(n);var r=function(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}.bind(null,e,n);setTimeout(r,2500)}}};A=new m(B.elementAdded,B.elementRemoved,B.elementChanged,B);var I,R,F=l.pointermap,U=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,N={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(t){l.listen(t,this.events)},unregister:function(t){l.unlisten(t,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(t){var e=t;return U&&((e=l.cloneEvent(t)).pointerType=this.POINTER_TYPES[t.pointerType]),e},cleanup:function(t){F.delete(t)},MSPointerDown:function(t){F.set(t.pointerId,t);var e=this.prepareEvent(t);l.down(e)},MSPointerMove:function(t){var e=this.prepareEvent(t);l.move(e)},MSPointerUp:function(t){var e=this.prepareEvent(t);l.up(e),this.cleanup(t.pointerId)},MSPointerOut:function(t){var e=this.prepareEvent(t);l.leaveOut(e)},MSPointerOver:function(t){var e=this.prepareEvent(t);l.enterOver(e)},MSPointerCancel:function(t){var e=this.prepareEvent(t);l.cancel(e),this.cleanup(t.pointerId)},MSLostPointerCapture:function(t){var e=l.makeEvent("lostpointercapture",t);l.dispatchEvent(e)},MSGotPointerCapture:function(t){var e=l.makeEvent("gotpointercapture",t);l.dispatchEvent(e)}};function z(t){if(!l.pointermap.has(t)){var e=new Error("InvalidPointerId");throw e.name="InvalidPointerId",e}}function G(t){if(!t.ownerDocument.contains(t)){var e=new Error("InvalidStateError");throw e.name="InvalidStateError",e}}function X(t){return 0!==l.pointermap.get(t).buttons}return window.navigator.msPointerEnabled?(I=function(t){z(t),G(this),X(t)&&this.msSetPointerCapture(t)},R=function(t){z(t),this.msReleasePointerCapture(t)}):(I=function(t){z(t),G(this),X(t)&&l.setCapture(t,this)},R=function(t){z(t),l.releaseCapture(t,this)}),function(){if(S){b.forEach(function(t){String(t)===t?(w+=y(t)+x(t)+"\n",C&&(w+=_(t)+x(t)+"\n")):(w+=t.selectors.map(y)+x(t.rule)+"\n",C&&(w+=t.selectors.map(_)+x(t.rule)+"\n"))});var t=document.createElement("style");t.textContent=w,document.head.appendChild(t)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=i,window.navigator.msPointerEnabled){var t=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:t,enumerable:!0}),l.registerSource("ms",N)}else l.registerSource("mouse",M),void 0!==window.ontouchstart&&l.registerSource("touch",B);l.register(document)}}(),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:I},releasePointerCapture:{value:R}}),{dispatcher:l,Installer:m,PointerEvent:i,PointerMap:n,targetFinding:c}});var QRCode,paper=function(t,e){var i=(t=t||require("./node/self.js")).window,n=t.document,r=new function(){var t=/^(statics|enumerable|beans|preserve)$/,i=[],n=i.slice,r=Object.create,s=Object.getOwnPropertyDescriptor,o=Object.defineProperty,a=i.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},h=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},l=function(t,e,i){if(t){var n=s(t,"length");(n&&"number"==typeof n.value?a:function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)}).call(t,e,i=i||t)}return i};function c(e,i,n,r,a){var h={};function l(t,l){"string"==typeof(l=l||(l=s(i,t))&&(l.get?l:l.value))&&"#"===l[0]&&(l=e[l.substring(1)]||l);var c,f="function"==typeof l,d=l,p=a||f&&!l.base?l&&l.get?t in e:e[t]:null;a&&p||(f&&p&&(l.base=p),f&&!1!==r&&(c=t.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(h[c[3].toLowerCase()+c[4]]=c[2]),d&&!f&&d.get&&"function"==typeof d.get&&u.isPlainObject(d)||(d={value:d,writable:!0}),(s(e,t)||{configurable:!0}).configurable&&(d.configurable=!0,d.enumerable=null!=n?n:!c),o(e,t,d))}if(i){for(var c in i)i.hasOwnProperty(c)&&!t.test(c)&&l(c);for(var c in h){var f=h[c],d=e["set"+f],p=e["get"+f]||d&&e["is"+f];!p||!0!==r&&0!==p.length||l(c,{get:p,set:d})}}return e}function u(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&h(this,i)}return this}return c(u,{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,i=t.beans,n=t.preserve;e!==t&&c(this.prototype,t,t.enumerable,i,n),c(this,e,null,i,n)}for(var r=1,s=arguments.length;r<s;r++)this.inject(arguments[r]);return this},extend:function(){for(var t,e,i,n=this,s=0,a=arguments.length;s<a&&(!t||!e);s++)i=arguments[s],t=t||i.initialize,e=e||i.prototype;return e=(t=t||function(){n.apply(this,arguments)}).prototype=e||r(this.prototype),o(e,"constructor",{value:t,writable:!0,configurable:!0}),c(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=n,t}}).inject({enumerable:!1,initialize:u,set:u,inject:function(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&c(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var t=r(this);return t.inject.apply(t,arguments)},each:function(t,e){return l(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:h,each:l,create:r,define:o,describe:s,clone:function(t){return h(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===u||"Object"===e.name)},pick:function(t,i){return t!==e?t:i},slice:function(t,e,i){return n.call(t,e,i)}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?h.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),i=e.prototype._class;return i&&!r.exports[i]&&(r.exports[i]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((i=t.length)!==e.length)return!1;for(;i--;)if(!r.equals(t[i],e[i]))return!1}else{var i,n=Object.keys(t);if((i=n.length)!==Object.keys(e).length)return!1;for(;i--;){var s=n[i];if(!e.hasOwnProperty(s)||!r.equals(t[s],e[s]))return!1}}return!0}return!1},read:function(t,i,n,s){if(this===r){var o=this.peek(t,i);return t.__index++,o}var a=this.prototype,h=a._readIndex,l=i||h&&t.__index||0,c=t.length,u=t[l];if(s=s||c-l,u instanceof this||n&&n.readNull&&null==u&&s<=1)return h&&(t.__index=l+1),u&&n&&n.clone?u.clone():u;if(u=r.create(a),h&&(u.__read=!0),u=u.initialize.apply(u,l>0||l+s<c?r.slice(t,l,l+s):t)||u,h){t.__index=l+u.__read;var f=u.__filtered;f&&(t.__filtered=f,u.__filtered=e),u.__read=e}return u},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,i,n){for(var r,s=[],o=e||0,a=n?o+n:t.length,h=o;h<a;h++)s.push(Array.isArray(r=t[h])?this.read(r,0,i):this.read(t,h,i,1));return s},readNamed:function(t,i,n,s,o){var a=this.getNamed(t,i),h=a!==e;if(h){var l=t.__filtered;l||((l=t.__filtered=r.create(t[0])).__unfiltered=t[0]),l[i]=e}var c=h?[a]:t;return this.read(c,n,s,o)},getNamed:function(t,i){var n=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(n)),t._hasObject)return i?n[i]:t.__filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n,r){var s;function o(r){if(!(n&&r in n||s&&r in s)){var o=i[r];o!==e&&(t[r]=o)}}if(r){for(var a,h={},l=0,c=r.length;l<c;l++)(a=r[l])in i&&(o(a),h[a]=!0);s=h}return Object.keys(i.__unfiltered||i).forEach(o),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var s,o=!n;if(o&&(e.formatter=new h(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),s=t._class;s&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){s=t._serialize(e,n);var a=t._class;!a||t._compactSerialize||!o&&i||s[0]===a||s.unshift(a)}else if(Array.isArray(t)){s=[];for(var l=0,c=t.length;l<c;l++)s[l]=r.serialize(t[l],e,i,n)}else if(r.isPlainObject(t)){s={};var u=Object.keys(t);for(l=0,c=u.length;l<c;l++){var f=u[l];s[f]=r.serialize(t[f],e,i,n)}}else s="number"==typeof t?e.formatter.number(t,e.precision):t;return o&&n.length>0?[["dictionary",n.definitions],s]:s},deserialize:function(t,e,i,n,s){var o=t,a=!i,h=a&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var l=t[0],c="dictionary"===l;if(1==t.length&&/^#/.test(l))return i.dictionary[l];o=[];for(var u=(l=r.exports[l])?1:0,f=t.length;u<f;u++)o.push(r.deserialize(t[u],e,i,c,h));if(l){var d=o;e?o=e(l,d,a||s):(o=r.create(l.prototype),l.apply(o,d))}}else if(r.isPlainObject(t))for(var p in o={},n&&(i.dictionary=o),t)o[p]=r.deserialize(t[p],e,i);return h?o[1]:o},exportJSON:function(t,e){var i=r.serialize(t,e);return e&&0==e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var s=n&&e&&e.constructor===t,o=s?e:r.create(t.prototype);if(1===i.length&&o instanceof x&&(s||!(o instanceof w))){var a=i[0];r.isPlainObject(a)&&(a.insert=!1)}return(s?o.set:t).apply(o,i),s&&(e=null),o})},splice:function(t,i,n,r){var s=i&&i.length,o=n===e;(n=o?t.length:n)>t.length&&(n=t.length);for(var a=0;a<s;a++)i[a]._index=n+a;if(o)return t.push.apply(t,i),[];var h=[n,r];i&&h.push.apply(h,i);for(var l=t.splice.apply(t,h),c=(a=0,l.length);a<c;a++)l[a]._index=e;for(a=n+s,c=t.length;a<c;a++)t[a]._index=a;return l},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var s={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],s=this._callbacks=this._callbacks||{};-1===(s=s[t]=s[t]||[]).indexOf(e)&&(s.push(e),n&&n.install&&1===s.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var i,n=this._eventTypes,s=n&&n[t],o=this._callbacks&&this._callbacks[t];return o&&(!e||-1!==(i=o.indexOf(e))&&1===o.length?(s&&s.uninstall&&s.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&o.splice(i,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=r.slice(arguments,1),s=e&&e.target&&!e.currentTarget;i=i.slice(),s&&(e.currentTarget=this);for(var o=0,a=i.length;o<a;o++)if(0==i[o].apply(this,n)){e&&e.stop&&e.stop();break}return s&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var s=e[r],o=s&&s[n];o&&o.call(this,r)}},statics:{inject:function t(e){var i=e._events;if(i){var n={};r.each(i,function(t,i){var s="string"==typeof t,o=s?t:i,a=r.capitalize(o),h=o.substring(2).toLowerCase();n[h]=s?{}:t,o="_"+o,e["get"+a]=function(){return this[o]},e["set"+a]=function(t){var e=this[o];e&&this.off(h,e),t&&this.on(h,t),this[o]=t}}),e._eventTypes=n}return t.base.apply(this,arguments)}}},o=r.extend({_class:"PaperScope",initialize:function e(){paper=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var n=$.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:tt.nativeModes},$.release(n)}if(!this.agent){var s=t.navigator.userAgent.toLowerCase(),o=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(s)||[])[0],a="darwin"===o?"mac":o,h=i.agent=i.browser={platform:a};a&&(h[a]=!0),s.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!h.chrome){var s="opera"===e?n:/^(node|trident)$/.test(e)?r:i;h.version=s,h.versionNumber=parseFloat(s),e="trident"===e?"msie":e,h.name=e,h[e]=!0}}),h.chrome&&delete h.webkit,h.atom&&delete h.chrome}},version:"0.11.5",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),j.updateFocus()},install:function(t){var e=this;for(var i in r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})}),this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return paper=this,this.project=new y(t),this},createCanvas:function(t,e){return $.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,i=t.length-1;i>=0;i--)t[i].remove();for(i=e.length-1;i>=0;i--)e[i].remove()},remove:function(){this.clear(),delete o._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),a=r.extend(s,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),h=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});h.instance=new h;var l=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],i=Math.abs,n=Math.sqrt,r=Math.pow,s=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function o(t,e,i){return t<e?e:t>i?i:t}function a(t,e,n){function r(t){var e=134217729*t,i=t-e+e;return[i,t-i]}var s=e*e-t*n,o=e*e+t*n;if(3*i(s)<o){var a=r(t),h=r(e),l=r(n),c=e*e,u=t*n;s=c-u+(h[0]*h[0]-c+2*h[0]*h[1]+h[1]*h[1]-(a[0]*l[0]-u+a[0]*l[1]+a[1]*l[0]+a[1]*l[1]))}return s}function h(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?r(2,-Math.round(s(t))):0}return{EPSILON:1e-12,MACHINE_EPSILON:1.12e-16,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(n(2)-1)/3,isZero:function(t){return t>=-1e-12&&t<=1e-12},clamp:o,integrate:function(i,n,r,s){for(var o=t[s-2],a=e[s-2],h=.5*(r-n),l=h+n,c=0,u=s+1>>1,f=1&s?a[c++]*i(l):0;c<u;){var d=h*o[c];f+=a[c++]*(i(l+d)+i(l-d))}return h*f},findRoot:function(t,e,n,r,s,a,h){for(var l=0;l<a;l++){var c=t(n),u=c/e(n),f=n-u;if(i(u)<h){n=f;break}c>0?(s=n,n=f<=r?.5*(r+s):f):(r=n,n=f>=s?.5*(r+s):f)}return o(n,r,s)},solveQuadratic:function(t,e,r,s,l,c){var u,f=1/0;if(i(t)<1e-12){if(i(e)<1e-12)return i(r)<1e-12?-1:0;u=-r/e}else{var d=a(t,e*=-.5,r);if(d&&i(d)<1.12e-16){var p=h(i(t),i(e),i(r));p&&(d=a(t*=p,e*=p,r*=p))}if(d>=-1.12e-16){var g=d<0?0:n(d),v=e+(e<0?-g:g);0===v?f=-(u=r/t):(u=v/t,f=r/v)}}var m=0,_=null==l,y=l-1e-12,x=c+1e-12;return isFinite(u)&&(_||u>y&&u<x)&&(s[m++]=_?u:o(u,l,c)),f!==u&&isFinite(f)&&(_||f>y&&f<x)&&(s[m++]=_?f:o(f,l,c)),m},solveCubic:function(t,e,s,a,c,u,f){var d,p,g,v,m,_=h(i(t),i(e),i(s),i(a));function y(i){var n=t*(d=i);v=(n+(p=n+e))*d+(g=p*d+s),m=g*d+a}if(_&&(t*=_,e*=_,s*=_,a*=_),i(t)<1e-12)t=e,p=s,g=a,d=1/0;else if(i(a)<1e-12)p=e,g=s,d=0;else{y(-e/t/3);var x=m/t,b=r(i(x),1/3),w=x<0?-1:1,S=-v/t,C=S>0?1.324717957244746*Math.max(b,n(S)):b,T=d-w*C;if(T!==d){do{y(T),T=0===v?d:d-m/v/(1+1.12e-16)}while(w*T>w*d);i(t)*d*d>i(a/d)&&(p=((g=-a/d)-s)/d)}}var k=l.solveQuadratic(t,p,g,c,u,f),E=null==u;return isFinite(d)&&(0===k||k>0&&d!==c[0]&&d!==c[1])&&(E||d>u-1e-12&&d<f+1e-12)&&(c[k++]=E?d:o(d,u,f)),k}}},c={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},u=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var o="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(o)?this._set(+o[0],+(o.length>1?o[1]:o[0])):"x"in o?this._set(o.x||0,o.y||0):"width"in o?this._set(o.width||0,o.height||0):"angle"in o?(this._set(o.length||0,0),this.setAngle(o.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new u(this.x,this.y)},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();l.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=u.read(arguments),e=this.getLength()*t.getLength();if(l.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=u.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=u.read(arguments),e=t.x-this.x,i=t.y-this.y,n=e*e+i*i;return r.read(arguments)?n:Math.sqrt(n)},normalize:function(t){t===e&&(t=1);var i=this.getLength(),n=0!==i?t/i:0,r=new u(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new u(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=u.read(arguments);return new u(this.x+t.x,this.y+t.y)},subtract:function(){var t=u.read(arguments);return new u(this.x-t.x,this.y-t.y)},multiply:function(){var t=u.read(arguments);return new u(this.x*t.x,this.y*t.y)},divide:function(){var t=u.read(arguments);return new u(this.x/t.x,this.y/t.y)},modulo:function(){var t=u.read(arguments);return new u(this.x%t.x,this.y%t.y)},negate:function(){return new u(-this.x,-this.y)},isInside:function(){return g.read(arguments).contains(this)},isClose:function(){var t=u.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=u.read(arguments);return u.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=u.read(arguments);return u.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=l.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=u.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=u.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=u.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new u(t.x*e,t.y*e)},statics:{min:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new u(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new u(e(this.x),e(this.y))}},{})),f=u.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),d=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var o="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(o)?this._set(+o[0],+(o.length>1?o[1]:o[0])):"width"in o?this._set(o.width||0,o.height||0):"x"in o?this._set(o.x||0,o.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new d(this.width,this.height)},toString:function(){var t=h.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=d.read(arguments);return new d(this.width+t.width,this.height+t.height)},subtract:function(){var t=d.read(arguments);return new d(this.width-t.width,this.height-t.height)},multiply:function(){var t=d.read(arguments);return new d(this.width*t.width,this.height*t.height)},divide:function(){var t=d.read(arguments);return new d(this.width/t.width,this.height/t.height)},modulo:function(){var t=d.read(arguments);return new d(this.width%t.width,this.height%t.height)},negate:function(){return new d(-this.width,-this.height)},isZero:function(){var t=l.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new d(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new d(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new d(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new d(e(this.width),e(this.height))}},{})),p=d.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),g=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,s){var o,a=typeof t;if("number"===a?(this._set(t,i,n,s),o=4):"undefined"===a||null===t?(this._set(0,0,0,0),o=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),o=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),o=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.filter(this,t),o=1)),o===e){var h,l,c=u.readNamed(arguments,"from"),f=r.peek(arguments),p=c.x,g=c.y;if(f&&f.x!==e||r.hasNamed(arguments,"to")){var v=u.readNamed(arguments,"to");h=v.x-p,l=v.y-g,h<0&&(p=v.x,h=-h),l<0&&(g=v.y,l=-l)}else{var m=d.read(arguments);h=m.width,l=m.height}this._set(p,g,h,l),o=arguments.__index;var _=arguments.__filtered;_&&(this.__filtered=_)}return this.__read&&(this.__read=o),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new g(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?g.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?u:f)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?d:p)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=d.read(arguments),e=this._sx,i=this._sy,n=t.width,r=t.height;e&&(this.x+=(this.width-n)*e),i&&(this.y+=(this.height-r)*i),this.width=n,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var e=t-this.x;this.width-=.5===this._sx?2*e:e}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var e=t-this.y;this.height-=.5===this._sy?2*e:e}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var e=t-this.x;this.width=.5===this._sx?2*e:e}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var e=t-this.y;this.height=.5===this._sy?2*e:e}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?u:f)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=u.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(g.read(arguments)):this._containsPoint(u.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=g.read(arguments),e=r.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=g.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new g(e,i,n-e,r-i)},unite:function(){var t=g.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new g(e,i,n-e,r-i)},include:function(){var t=u.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new g(e,i,n-e,r-i)},expand:function(){var t=d.read(arguments),e=t.width,i=t.height;return new g(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],s=t[n?1:0],o="get"+r,a="get"+s,h="set"+r,l="set"+s,c="set"+i;this["get"+i]=function(t){return new(t?u:f)(this[o](),this[a](),this,c)},this[c]=function(){var t=u.read(arguments);this[h](t.x),this[l](t.y)}},{beans:!0})),v=g.extend({initialize:function(t,e,i,n,r,s){this._set(t,e,i,n,!0),this._owner=r,this._setter=s},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=g.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),m=r.extend({_class:"Matrix",initialize:function t(e,i){var n=arguments.length,r=!0;if(n>=6?this._set.apply(this,arguments):1===n||2===n?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,i):Array.isArray(e)?this._set.apply(this,i?e.concat([i]):e):r=!1:n?r=!1:this.reset(),!r)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,s,o){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=s,o||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new m(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=h.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=u.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=u.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),s=Math.sin(t),o=i-i*r+n*s,a=n-i*s-n*r,h=this._a,l=this._b,c=this._c,f=this._d;return this._a=r*h+s*c,this._b=r*l+s*f,this._c=-s*h+r*c,this._d=-s*l+r*f,this._tx+=o*h+a*c,this._ty+=o*l+a*f,this._changed(),this},shear:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new u(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},append:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,s=this._d,o=t._a,a=t._c,h=t._b,l=t._d,c=t._tx,u=t._ty;this._a=o*i+h*r,this._c=a*i+l*r,this._b=o*n+h*s,this._d=a*n+l*s,this._tx+=c*i+u*r,this._ty+=c*n+u*s,e||this._changed()}return this},prepend:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,s=this._d,o=this._tx,a=this._ty,h=t._a,l=t._c,c=t._b,u=t._d,f=t._tx,d=t._ty;this._a=h*i+l*n,this._c=h*r+l*s,this._b=c*i+u*n,this._d=c*r+u*s,this._tx=h*o+l*a+f,this._ty=c*o+u*a+d,e||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,o=t*n-e*i,a=null;return o&&!isNaN(o)&&isFinite(r)&&isFinite(s)&&(this._a=n/o,this._b=-e/o,this._c=-i/o,this._d=t/o,this._tx=(i*s-n*r)/o,this._ty=(e*r-t*s)/o,a=this),a},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new m(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(u.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new u),e._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var s=t[n],o=t[n+1];e[n]=s*this._a+o*this._c+this._tx,e[n+1]=s*this._b+o*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,s=[e,i,n,i,n,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),o=2;o<8;o++){var a=n[o],h=1&o;a<r[h]?r[h]=a:a>s[h]&&(s[h]=a)}return e||(e=new g),e._set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(u.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,s=this._c,o=this._d,a=this._tx,h=this._ty,l=n*o-r*s,c=null;if(l&&!isNaN(l)&&isFinite(a)&&isFinite(h)){var f=t.x-this._tx,d=t.y-this._ty;e||(e=new u),c=e._set((f*o-d*s)/l,(d*n-f*r)/l,i)}return c},decompose:function(){var t,e,i,n=this._a,r=this._b,s=this._c,o=this._d,a=n*o-r*s,h=Math.sqrt,l=Math.atan2,c=180/Math.PI;if(0!==n||0!==r){var f=h(n*n+r*r);t=Math.acos(n/f)*(r>0?1:-1),e=[f,a/f],i=[l(n*s+r*o,f*f),0]}else if(0!==s||0!==o){var d=h(s*s+o*o);t=Math.asin(s/d)*(o>0?1:-1),e=[a/d,d],i=[0,l(n*s+r*o,d*d)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*c,scaling:new u(e),skewing:new u(i[0]*c,i[1]*c)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new u(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),_=r.extend({_class:"Line",initialize:function(t,e,i,n,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=i),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new u(this._px,this._py)},getVector:function(){return new u(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return _.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return _.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return _.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return u.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return u.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,s,o,a,h,c){h||(i-=t,n-=e,o-=r,a-=s);var f=i*a-n*o;if(!l.isZero(f)){var d=t-r,p=e-s,g=(o*p-a*d)/f,v=(i*p-n*d)/f;if(c||-1e-12<g&&g<1+1e-12&&-1e-12<v&&v<1+1e-12)return c||(g=g<=0?0:g>=1?1:g),new u(t+g*i,e+g*n)}},getSide:function(t,e,i,n,r,s,o,a){o||(i-=t,n-=e);var h=r-t,c=h*n-(s-e)*i;return!a&&l.isZero(c)&&(c=(h*i+h*i)/(i*i+n*n))>=0&&c<=1&&(c=0),c<0?-1:c>0?1:0},getSignedDistance:function(t,e,i,n,r,s,o){return o||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)},getDistance:function(t,e,i,n,r,s,o){return Math.abs(_.getSignedDistance(t,e,i,n,r,s,o))}}}),y=a.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){a.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new X(null,null,this),this._view=j.create(this,t||$.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,s=e._id,o=r[s];o?o.flags|=t:n.push(r[s]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new w({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:T,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof w){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,i,n){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new w(x.NO_INSERT),!0)).insertChild(t,i),n&&i.activate&&i.activate(),i},getItems:function(t){return x._getItems(this,t)},getItem:function(t){return x._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var s in e){var o=e[s];o&&o!=i&&delete o[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,s=new r({offset:new u(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new m],updateMatrix:!0}),o=0,a=n.length;o<a;o++)n[o].draw(t,s);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var h=this._selectionItems,l=this._scope.settings.handleSize,c=this._updateVersion;for(var f in h)h[f]._drawSelection(t,e,l,h,c);t.restore()}}}),x=r.extend(s,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=r.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_enhanceBlendMode:!1,_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new m,pivot:null,visible:!0,blendMode:"normal",enhanceBlendMode:!1,opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),s=n&&!0===t.internal,o=this._matrix=new m,a=n&&t.project||paper.project,h=paper.settings;return this._id=s?null:c.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&h.applyMatrix,i&&o.translate(i),o._owner=this,this._style=new X(a._currentStyle,this,a),s||n&&0==t.insert||!h.insertItems&&(!n||!0!==t.insert)?this._setProject(a):(n&&t.parent||a)._insertItem(e,this,!0),n&&t!==x.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){var i={},n=this;function s(s){for(var o in s){var a=n[o];r.equals(a,"leading"===o?1.2*s.fontSize:s[o])||(i[o]=r.serialize(a,t,"data"!==o,e))}}return s(this._serializeFields),this instanceof b||s(this._style._defaults),[this._class,i]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),n&&40&t&&x._clearBoundsCache(n),2&t&&x._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(t&&i){var n=i._children,r=i._namedChildren;(r[t]=r[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide","enhanceBlendMode"],function(t){var e=r.capitalize(t),i="_"+t,n={locked:128,visible:137};this["get"+e]=function(){return this[i]},this["set"+e]=function(e){e!=this[i]&&(this[i]=e,this._changed(n[t]||129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?u:f;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(u.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new f(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=u.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof m,n=r.set({},i?e:t,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var s=this._getCachedBounds(i&&t,n).rect;return arguments.length?s:new v(s.x,s.y,s.width,s.height,this,"setBounds")},setBounds:function(){var t=g.read(arguments),e=this.getBounds(),i=this._matrix,n=new m,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.set(i._backup||(new m).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(x._updateBoundsCache(this,e.cacheItem),x._getBounds(i,t,e)):new g},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,i){t=t&&t._orNullIfIdentity();var n=e.internal&&!i,r=e.cacheItem,s=n?null:this._matrix._orNullIfIdentity(),o=r&&(!t||t.equals(s))&&this._getBoundsCacheKey(e,n),a=this._bounds;if(x._updateBoundsCache(this._parent||this._symbol,r),o&&a&&o in a)return{rect:(f=a[o]).rect.clone(),nonscaling:f.nonscaling};var h=this._getBounds(t||s,e),l=h.rect||h,c=this._style,u=h.nonscaling||c.hasStroke()&&!c.getStrokeScaling();if(o){a||(this._bounds=a={});var f=a[o]={rect:l.clone(),nonscaling:u,internal:n}}return{rect:l,nonscaling:u}},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,s=r.length;n<s;n++){var o=r[n];o!==t&&(o._bounds=o._position=e,o._boundsCache&&x._clearBoundsCache(o))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,s=n,o=r,a=!1;i=i||{};for(var h=0,l=t.length;h<l;h++){var c=t[h];if(c._visible&&!c.isEmpty()){var u=c._getCachedBounds(e&&e.appended(c._matrix),i,!0),f=u.rect;n=Math.min(f.x,n),s=Math.min(f.y,s),r=Math.max(f.x+f.width,r),o=Math.max(f.y+f.height,o),u.nonscaling&&(a=!0)}}return{rect:isFinite(n)?new g(n,s,r-n,o-s):new g,nonscaling:a}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new f(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var i=this.getRotation(),n=this._decomposed,r=new m,s=this.getPosition(!0);r.translate(s),i&&r.rotate(i),r.scale(e.x/t.x,e.y/t.y),i&&r.rotate(-i),r.translate(s.negate()),this.transform(r),n&&(n.scaling=e,this._decomposed=n)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.prepend(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof w)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var i=new this.constructor(x.NO_INSERT),n=this._children,s=r.pick(t?t.insert:e,t===e||!0===t),o=r.pick(t?t.deep:e,!0);n&&i.copyAttributes(this),n&&!o||i.copyContent(this),n||i.copyAttributes(this),s&&i.insertAbove(this);var a=this._name,h=this._parent;if(a&&h){n=h._children;for(var l=a,c=1;n[a];)a=l+" "+c++;a!==l&&i.setName(a)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide","_enhanceBlendMode"],n=0,s=i.length;n<s;n++){var o=i[n];t.hasOwnProperty(o)&&(this[o]=t[o])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var a=t._data,h=t._name;this._data=a?r.clone(a):null,h&&this.setName(h)},rasterize:function(t,i){var n=this.getStrokeBounds(),s=(t||this.getView().getResolution())/72,o=n.getTopLeft().floor(),a=n.getBottomRight().ceil(),h=new d(a.subtract(o)),l=new C(x.NO_INSERT);if(!h.isZero()){var c=$.getCanvas(h.multiply(s)),u=c.getContext("2d"),f=(new m).scale(s).translate(o.negate());u.save(),f.applyToContext(u),this.draw(u,new r({matrices:[f]})),u.restore(),l.setCanvas(c)}return l.transform((new m).translate(o.add(h.divide(2))).scale(1/s)),(i===e||i)&&l.insertAbove(this),l},contains:function(){return!!this._contains(this._matrix._inverseTransform(u.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return g.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new P.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof x&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(u.read(arguments),E.getOptions(arguments))}function e(){var t=u.read(arguments),e=E.getOptions(arguments),i=[];return this._hitTest(t,r.set({all:i},e)),i}function i(t,e,i,n){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var o=r[s],a=o!==n&&o._hitTest(t,e,i);if(a&&!e.all)return a}return null}return y.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var n=this._matrix,s=i?i.appended(n):this.getGlobalMatrix().prepend(this.getView()._matrix),o=Math.max(e.tolerance,1e-12),a=e._tolerancePadding=new d(P._getStrokePadding(o,n._shiftless().invert()));if(!(t=n._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(a.multiply(2))._containsPoint(t))return null;var h,l,c=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),u=e.match,f=this;function p(t){return t&&u&&!u(t)&&(t=null),t&&e.all&&e.all.push(t),t}function g(e,i){var n=i?h["get"+i]():f.getPosition();if(t.subtract(n).divide(a).length<=1)return new E(e,f,{name:i?r.hyphenate(i):e,point:n})}var v=e.position,m=e.center,_=e.bounds;if(c&&this._parent&&(v||m||_)){if((m||_)&&(h=this.getInternalBounds()),!(l=v&&g("position")||m&&g("center","Center"))&&_)for(var y=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],x=0;x<8&&!l;x++)l=g("bounds",y[x]);l=p(l)}return l||(l=this._hitTestChildren(t,e,s)||c&&p(this._hitTestSelf(t,e,s,this.getStrokeScaling()?null:s._shiftless().invert()))||null),l&&l.point&&(l.point=n.transform(l.point)),l},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new E("fill",this)},matches:function(t,e){var i=typeof t;if("object"===i){for(var n in t)if(t.hasOwnProperty(n)&&!this.matches(n,t[n]))return!1;return!0}if("function"===i)return t(this);if("match"===t)return e(this);var s=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;s=this._class}if("function"==typeof e)return!!e(s);if(e){if(e.test)return e.test(s);if(r.isPlainObject(e))return function t(e,i){for(var n in e)if(e.hasOwnProperty(n)){var s=e[n],o=i[n];if(r.isPlainObject(s)&&r.isPlainObject(o)){if(!t(s,o))return!1}else if(!r.equals(s,o))return!1}return!0}(e,s)}return r.equals(s,e)},getItems:function(t){return x._getItems(this,t,this._matrix)},getItem:function(t){return x._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,i,n,s,o){if(!s){var a="object"==typeof i&&i,h=a&&a.overlapping,l=a&&a.inside,c=(x=h||l)&&g.read([x]);s={items:[],recursive:a&&!1!==a.recursive,inside:!!l,overlapping:!!h,rect:c,path:h&&new P.Rectangle({rectangle:c,insert:!1})},a&&(i=r.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var u=e._children,f=s.items;n=(c=s.rect)&&(n||new m);for(var d=0,p=u&&u.length;d<p;d++){var v=u[d],_=n&&n.appended(v._matrix),y=!0;if(c){var x=v.getBounds(_);if(!c.intersects(x))continue;c.contains(x)||s.overlapping&&(x.contains(c)||s.path.intersects(v,_))||(y=!1)}if(y&&v.matches(i)&&(f.push(v),o))break;if(!1!==s.recursive&&t(v,i,_,s,o),o&&f.length>0)break}return f}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,e){var i=e?this.insertChildren(t,[e]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&e.length>0){for(var n={},s=(e=r.slice(e)).length-1;s>=0;s--){var o=(c=e[s])&&c._id;!c||n[o]?e.splice(s,1):(c._remove(!1,!0),n[o]=!0)}r.splice(i,e,t,0);for(var a=this._project,h=a._changes,l=(s=0,e.length);s<l;s++){var c,u=(c=e[s])._name;c._parent=this,c._setProject(a,!0),u&&c.setName(u),h&&c._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(e,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;-1!==s&&(e[n]==this&&delete e[n],r.splice(s,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,s=this._index;return!!i&&(this._name&&this._removeNamed(),null!=s&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,s,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:u).read(arguments),n=u.read(arguments,0,{readNull:!0});return this.transform((new m)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new m;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i,n){var r=this._matrix,s=t&&!t.isIdentity(),o=(e||this._applyMatrix)&&(!r.isIdentity()||s||e&&i&&this._children);if(!s&&!o)return this;if(s){!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0);var a=this._style,h=a.getFillColor(!0),l=a.getStrokeColor(!0);h&&h.transform(t),l&&l.transform(t)}if(o&&(o=this._transformContent(r,i,n))){var c=this._pivot;c&&r._transformPoint(c,c,!0),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,f=this._position;(s||o)&&this._changed(9);var d=s&&u&&t.decompose();if(d&&d.skewing.isZero()&&d.rotation%90==0){for(var p in u){var g=u[p];if(g.nonscaling)delete u[p];else if(o||!g.internal){var v=g.rect;t._transformBounds(v,v)}}this._bounds=u;var m=u[this._getBoundsCacheKey(this._boundsOptions||{})];m&&(this._position=m.rect.getCenter(!0))}else s&&f&&this._pivot&&(this._position=t._transformPoint(f,f));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(u.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(u.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(u.read(arguments))},localToParent:function(){return this._matrix._transformPoint(u.read(arguments))},fitBounds:function(t,e){t=g.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,s=(e?n>r:n<r)?t.width/i.width:t.height/i.height,o=new g(new u,new d(i.width*s,i.height*s));o.setCenter(t.getCenter()),this.setBounds(o)}}),{_setStyles:function(t,e,i){var n=this._style,r=this._matrix;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t,r)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t,r),t.lineWidth=n.getStrokeWidth();var s=n.getStrokeJoin(),o=n.getStrokeCap(),a=n.getMiterLimit();if(s&&(t.lineJoin=s),o&&(t.lineCap=o),a&&(t.miterLimit=a),paper.support.nativeDash){var h=n.getDashArray(),l=n.getDashOffset();h&&h.length&&("setLineDash"in t?(t.setLineDash(h),t.lineDashOffset=l):(t.mozDash=h,t.mozDashOffset=l))}}if(n.hasShadow()){var c=e.pixelRatio||1,f=i._shiftless().prepend((new m).scale(c,c)),d=f.transform(new u(n.getShadowBlur(),0)),p=f.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=d.getLength(),t.shadowOffsetX=p.x,t.shadowOffsetY=p.y}},draw:function(t,e,i){var n=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,s=e.viewMatrix,o=this._matrix,a=r[r.length-1].appended(o);if(a.isInvertible()){s=s?s.appended(a):a,r.push(a),e.updateMatrix&&(a._updateVersion=n,this._globalMatrix=a);var h,l,c,u=this._enhanceBlendMode,f=this._blendMode,d=this._opacity,p="normal"===f,g=tt.nativeModes[f],v=p&&1===d||e.dontStart||e.clip||(g||p&&d<1)&&this._canComposite(),m=e.pixelRatio||1;if(!v){var _=this.getStrokeBounds(s);if(!_.width||!_.height)return;c=e.offset,l=e.offset=_.getTopLeft().floor(),h=t,t=$.getContext(_.getSize().ceil().add(1).multiply(m)),1!==m&&t.scale(m,m)}t.save();var y=i?i.appended(o):this._canScaleStroke&&!this.getStrokeScaling(!0)&&s,x=!v&&e.clipItem,b=!y||x;if(v?(t.globalAlpha=d,g&&(t.globalCompositeOperation=f)):b&&t.translate(-l.x,-l.y),b&&(v?o:s).applyToContext(t),x&&e.clipItem.draw(t,e.extend({clip:!0})),y){t.setTransform(m,0,0,m,0,0);var w=e.offset;w&&t.translate(-w.x,-w.y)}this._draw(t,e,s,y),v&&"normal"!=f&&u&&this._draw(t,e,s,y),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),v||(tt.process(f,t,h,d,l.subtract(c).multiply(m)),"normal"!=f&&u&&tt.process(f,t,h,d,l.subtract(c).multiply(m)),$.release(t),e.offset=c)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof B)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var s=this._selection,o=1&s,a=2&s||o&&this._selectBounds,h=4&s;if(this._drawSelected||(o=!1),(o||a||h)&&this._isUpdated(r)){var l,c=this.getSelectedColor(!0)||(l=this.getLayer())&&l.getSelectedColor(!0),u=e.appended(this.getGlobalMatrix(!0)),f=i/2;if(t.strokeStyle=t.fillStyle=c?c.toCanvasStyle(t):"#009dec",o&&this._drawSelected(t,u,n),h){var d=this.getPosition(!0),p=d.x,g=d.y;t.beginPath(),t.arc(p,g,f,0,2*Math.PI,!0),t.stroke();for(var v=[[0,-1],[1,0],[0,1],[-1,0]],m=f,_=i+1,y=0;y<4;y++){var x=v[y],b=x[0],w=x[1];t.moveTo(p+b*m,g+w*m),t.lineTo(p+b*_,g+w*_),t.stroke()}}if(a){var S=u._transformCorners(this.getInternalBounds());for(t.beginPath(),y=0;y<8;y++)t[y?"lineTo":"moveTo"](S[y],S[++y]);for(t.closePath(),t.stroke(),y=0;y<8;y++)t.fillRect(S[y]-f,S[++y]-f,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),b=x.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(i){t.base.call(this,i),1026&i&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,i){var n=this._getClipItem();return n?n._getCachedBounds(e&&e.appended(n._matrix),r.set({},i,{stroke:!1})):t.base.call(this,e,i)},_hitTestChildren:function t(e,i,n){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,i,n,r)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,o=r.length;s<o;s++){var a=r[s];a!==n&&a.draw(t,e)}}}),w=b.extend({_class:"Layer",initialize:function(){b.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),S=x.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new p(t.width,t.height,this,"setSize")},setSize:function(){var t=d.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;"rectangle"===e?this._radius.set(d.min(this._radius,t.divide(2))):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new p(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size._set(i,i)}else if(t=d.read(arguments),this._radius){if(this._radius.equals(t))return;this._radius.set(t),"rectangle"===e?(i=d.max(this._size,t.multiply(2)),this._size.set(i)):"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new(P[r.capitalize(this._type)])({center:new u,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),paper.settings.applyMatrix&&i.setApplyMatrix(!0),(t===e||t)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,i,n){var r=this._style,s=r.hasFill(),o=r.hasStroke(),a=e.dontFinish||e.clip,h=!n;if(s||o||a){var l=this._type,c=this._radius,u="circle"===l;if(e.dontStart||t.beginPath(),h&&u)t.arc(0,0,c,0,2*Math.PI,!0);else{var f=u?c:c.width,d=u?c:c.height,p=this._size,g=p.width,v=p.height;if(h&&"rectangle"===l&&0===f&&0===d)t.rect(-g/2,-v/2,g,v);else{var m=g/2,_=v/2,y=.44771525016920644,x=f*y,b=d*y,w=[-m,-_+d,-m,-_+b,-m+x,-_,-m+f,-_,m-f,-_,m-x,-_,m,-_+b,m,-_+d,m,_-d,m,_-b,m-x,_,m-f,_,-m+f,_,-m+x,_,-m,_-b,-m,_-d];n&&n.transform(w,w,32),t.moveTo(w[0],w[1]),t.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),m!==f&&t.lineTo(w[8],w[9]),t.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),_!==d&&t.lineTo(w[16],w[17]),t.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),m!==f&&t.lineTo(w[24],w[25]),t.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}t.closePath()}a||!s&&!o||(this._setStyles(t,e,i),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(P._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=1;s<=4;s++){var o=new u(s>1&&s<4?-1:1,s>2?-1:1),a=o.multiply(r),h=a.subtract(o.multiply(n));if(new g(i?a.add(o.multiply(i)):a,h).contains(e))return{point:h,quadrant:s}}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n.point).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,s,o){var a=!1,h=this._style,l=r.stroke&&h.hasStroke(),c=r.fill&&h.hasFill();if(l||c){var u=this._type,f=this._radius,d=l?h.getStrokeWidth()/2:0,p=r._tolerancePadding.add(P._getStrokePadding(d,!h.getStrokeScaling()&&o));if("rectangle"===u){var v=p.multiply(2),m=t(this,n,v);if(m)a=e(n.subtract(m.point),f,p,m.quadrant);else{var _=new g(this._size).setCenter(0,0),y=_.expand(v),x=_.expand(v.negate());a=y._containsPoint(n)&&!x._containsPoint(n)}}else a=e(n,f,p)}return a?new E(l?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,s){var o=new S(r.getNamed(s),e);return o._type=t,o._size=i,o._radius=n,o}return{Circle:function(){var e=u.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return t("circle",e,new d(2*i),i,arguments)},Rectangle:function(){var e=g.readNamed(arguments,"rectangle"),i=d.min(d.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=S._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;if(r.hasNamed(t,"radius"))e=u.readNamed(t,"center"),i=d.readNamed(t,"radius");else{var n=g.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),C=x.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],initialize:function(t,i){if(!this._initialize(t,i!==e&&u.read(arguments,1))){var r="string"==typeof t?n.getElementById(t):t;r?this.setImage(r):this.setSource(t)}this._size||(this._size=new d,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=$.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new p(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=d.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage($.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&$.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new u(0,0).transform(t),i=new u(1,0).transform(t).subtract(e),n=new u(0,1).transform(t).subtract(e);return new d(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var e=this;function i(t){var i=e.getView(),n=t&&t.type||"load";i&&e.responds(n)&&(paper=i._scope,e.emit(n,new H(t)))}this._setImage(t),this._loaded?setTimeout(i,0):t&&W.add(t,{load:function(n){e._setImage(t),i(n)},error:i})},_setImage:function(t){this._canvas&&$.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new d(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=$.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){$.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var i=new t.Image,n=this._crossOrigin;n&&(i.crossOrigin=n),i.src=e,this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=g.read(arguments),e=$.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=g.read(arguments),e=new C(x.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=u.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof L?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new g(t):"x"in t&&(e=new g(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var n=Math.min(e.width,32),s=Math.min(e.height,32),o=C._sampleContext;o?o.clearRect(0,0,33,33):o=C._sampleContext=$.getContext(new d(32)),o.save();var a=(new m).scale(n/e.width,s/e.height).translate(-e.x,-e.y);a.applyToContext(o),i&&i.draw(o,new r({clip:!0,matrices:[a]})),this._matrix.applyToContext(o);var h=this.getElement(),l=this._size;h&&o.drawImage(h,-l.width/2,-l.height/2),o.restore();for(var c=o.getImageData(.5,.5,Math.ceil(n),Math.ceil(s)).data,u=[0,0,0],f=0,p=0,v=c.length;p<v;p+=4){var _=c[p+3];f+=_,_/=255,u[0]+=c[p]*_,u[1]+=c[p+1]*_,u[2]+=c[p+2]*_}for(p=0;p<3;p++)u[p]/=f;return f?N.read(u):null},getPixel:function(){var t=u.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new N("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=u.read(arguments),e=N.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),o=s.data;o[0]=255*i[0],o[1]=255*i[1],o[2]=255*i[2],o[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=d.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=g.read(arguments);return t.isEmpty()&&(t=new g(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=u.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new E("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),T=x.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&u.read(arguments,1))||this.setDefinition(t instanceof k?t:new k(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i){var n=this._definition._item._hitTest(t,e,i);return n&&(n.item=this),n},_draw:function(t,e){this._definition._item.draw(t,e)}}),k=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=c.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&x._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new u),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new T(this,t)},clone:function(){return new k(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),E=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&this.inject(i)},statics:{getOptions:function(t){var e=t&&r.read(t);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),A=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,s,o){var a,h,l,c,u=arguments.length;u>0&&(null==t||"object"==typeof t?1===u&&t&&"point"in t?(a=t.point,h=t.handleIn,l=t.handleOut,c=t.selection):(a=t,h=i,l=n,c=r):(a=[t,i],h=n!==e?[n,r]:null,l=s!==e?[s,o]:null)),new M(a,this,"_point"),new M(h,this,"_handleIn"),new M(l,this,"_handleOut"),c&&this.setSelection(c)},_serialize:function(t,e){var i=this._point,n=this._selection,s=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&s.push(n),r.serialize(s,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(u.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(u.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(u.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(129))},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new O(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,i,n){var r=t||{},s=r.type,o=r.factor,a=this.getPrevious(),h=this.getNext(),l=(a||this)._point,c=this._point,f=(h||this)._point,d=l.getDistance(c),p=c.getDistance(f);if(s&&"catmull-rom"!==s){if("geometric"!==s)throw new Error("Smoothing method '"+s+"' not supported.");if(a&&h){var g=l.subtract(f),v=o===e?.4:o,m=v*d/(d+p);i||this.setHandleIn(g.multiply(m)),n||this.setHandleOut(g.multiply(m-v))}}else{var _=o===e?.5:o,y=Math.pow(d,_),x=y*y,b=Math.pow(p,_),w=b*b;if(!i&&a){var S=2*w+3*b*y+x,C=3*b*(b+y);this.setHandleIn(0!==C?new u((w*l._x+S*c._x-x*f._x)/C-c._x,(w*l._y+S*c._y-x*f._y)/C-c._y):new u)}!n&&h&&(S=2*x+3*y*b+w,C=3*y*(y+b),this.setHandleOut(0!==C?new u((x*f._x+S*c._x-w*l._x)/C-c._x,(x*f._y+S*c._y-w*l._y)/C-c._y):new u))}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new A(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new A(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,s=t._point,o=e._point,a=t._handleIn,h=e._handleIn,l=e._handleOut,c=t._handleOut;this._point._set(n*s._x+r*o._x,n*s._y+r*o._y,!0),this._handleIn._set(n*a._x+r*h._x,n*a._y+r*h._y,!0),this._handleOut._set(n*c._x+r*l._x,n*c._y+r*l._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,o=n._x,a=n._y,h=2;return e[0]=o,e[1]=a,r&&(e[h++]=r._x+o,e[h++]=r._y+a),s&&(e[h++]=s._x+o,e[h++]=s._y+a),t&&(t._transformCoordinates(e,e,h/2),o=e[0],a=e[1],i?(n._x=o,n._y=a,h=2,r&&(r._x=e[h++]-o,r._y=e[h++]-a),s&&(s._x=e[h++]-o,s._y=e[h++]-a)):(r||(e[h++]=o,e[h++]=a),s||(e[h++]=o,e[h++]=a))),e}}),M=u.extend({initialize:function(t,i,n){var r,s,o;if(t)if((r=t[0])!==e)s=t[1];else{var a=t;(r=a.x)===e&&(r=(a=u.read(arguments)).x),s=a.y,o=a.selected}else r=s=0;this._x=r,this._y=s,this._owner=i,i[n]=this,o&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=l.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),D=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,s,o,a){var h,l,c,u,f,d,p=arguments.length;3===p?(this._path=t,h=e,l=i):p?1===p?"segment1"in t?(h=new A(t.segment1),l=new A(t.segment2)):"point1"in t?(c=t.point1,f=t.handle1,d=t.handle2,u=t.point2):Array.isArray(t)&&(c=[t[0],t[1]],u=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]):2===p?(h=new A(t),l=new A(e)):4===p?(c=t,f=e,d=i,u=n):8===p&&(c=[t,e],u=[o,a],f=[i-t,n-e],d=[r-o,s-a]):(h=new A,l=new A),this._segment1=h||new A(c,null,f),this._segment2=l||new A(u,d,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new D(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return D.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(u.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(u.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(u.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(u.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return D.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new u(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=D.getLength(this.getValues(),0,1)),this._length},getArea:function(){return D.getArea(this.getValues())},getLine:function(){return new _(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new D(D.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return D.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var i=null;if(t>=1e-8&&t<=1-1e-8){var n=D.subdivide(this.getValues(),t),r=n[0],s=n[1],o=e||this.hasHandles(),a=this._segment1,h=this._segment2,l=this._path;o&&(a._handleOut._set(r[2]-r[0],r[3]-r[1]),h._handleIn._set(s[4]-s[6],s[5]-s[7]));var c=r[6],f=r[7],d=new A(new u(c,f),o&&new u(r[4]-c,r[5]-f),o&&new u(s[2]-c,s[3]-f));l?(l.insert(a._index+1,d),i=this.getNext()):(this._segment2=d,this._changed(),i=new D(d,h))}return i},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new D(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,i,n){var r=t._point,s=t._handleOut,o=e._handleIn,a=e._point,h=r.x,l=r.y,c=a.x,u=a.y,f=n?[h,l,h,l,c,u,c,u]:[h,l,h+s._x,l+s._y,c+o._x,u+o._y,c,u];return i&&i._transformCoordinates(f,f,4),f},subdivide:function(t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],l=t[6],c=t[7];i===e&&(i=.5);var u=1-i,f=u*n+i*s,d=u*r+i*o,p=u*s+i*a,g=u*o+i*h,v=u*a+i*l,m=u*h+i*c,_=u*f+i*p,y=u*d+i*g,x=u*p+i*v,b=u*g+i*m,w=u*_+i*x,S=u*y+i*b;return[[n,r,f,d,_,y,w,S],[w,S,x,b,v,m,l,c]]},getMonoCurves:function(t,e){var i=[],n=e?0:1,r=t[n+0],s=t[n+2],o=t[n+4],a=t[n+6];if(r>=s==s>=o&&s>=o==o>=a||D.isStraight(t))i.push(t);else{var h=3*(s-o)-r+a,c=2*(r+o)-4*s,u=s-r,f=[],d=l.solveQuadratic(h,c,u,f,1e-8,1-1e-8);if(d){f.sort();var p=f[0],g=D.subdivide(t,p);i.push(g[0]),d>1&&(p=(f[1]-p)/(1-p),g=D.subdivide(g[1],p),i.push(g[0])),i.push(g[1])}else i.push(t)}return i},solveCubic:function(t,e,i,n,r,s){var o=t[e],a=t[e+2],h=t[e+4],c=t[e+6],u=0;if(!(o<i&&c<i&&a<i&&h<i||o>i&&c>i&&a>i&&h>i)){var f=3*(a-o),d=3*(h-a)-f,p=c-o-f-d;u=l.solveCubic(p,d,f,o-i,n,r,s)}return u},getTimeOf:function(t,e){var i=new u(t[0],t[1]),n=new u(t[6],t[7]);if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var r=[e.x,e.y],s=[],o=0;o<2;o++)for(var a=D.solveCubic(t,o,r[o],s,0,1),h=0;h<a;h++){var l=s[h];if(e.isClose(D.getPoint(t,l),1e-7))return l}return e.isClose(i,1e-7)?0:e.isClose(n,1e-7)?1:null},getNearestTime:function(t,e){if(D.isStraight(t)){var i=t[0],n=t[1],r=t[6]-i,s=t[7]-n,o=r*r+s*s;if(0===o)return 0;var a=((e.x-i)*r+(e.y-n)*s)/o;return a<1e-12?0:a>.999999999999?1:D.getTimeOf(t,new u(i+a*r,n+a*s))}var h=1/0,l=0;function c(i){if(i>=0&&i<=1){var n=e.getDistance(D.getPoint(t,i),!0);if(n<h)return h=n,l=i,!0}}for(var f=0;f<=100;f++)c(f/100);for(var d=.005;d>1e-8;)c(l-d)||c(l+d)||(d/=2);return l},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=D.subdivide(t,e)[1]),i<1&&(t=D.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],l=t[7],c=3*r-2*i-h,u=3*s-2*n-l,f=3*o-2*h-i,d=3*a-2*l-n;return Math.max(c*c,f*f)+Math.max(u*u,d*d)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7];return 3*((h-i)*(n+s)-(a-e)*(r+o)+r*(e-s)-n*(i-o)+h*(s+e/3)-a*(o+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)D._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new g(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,o,a,h){function c(t,e){var i=t-e,n=t+e;i<o[r]&&(o[r]=i),n>a[r]&&(a[r]=n)}s/=2;var u=o[r]-s,f=a[r]+s;if(t<u||e<u||i<u||n<u||t>f||e>f||i>f||n>f)if(e<t!=e<n&&i<t!=i<n)c(t,s),c(n,s);else{var d=3*(e-i)-t+n,p=2*(t+i)-4*e,g=e-t,v=l.solveQuadratic(d,p,g,h);c(n,0);for(var m=0;m<v;m++){var _=h[m],y=1-_;1e-8<=_&&_<=1-1e-8&&c(y*y*y*t+3*y*y*_*e+3*y*_*_*i+_*_*_*n,s)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=P[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,i,n){if(e.isZero()&&i.isZero())return!0;var r=n.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(i)){var s=new _(t,n);if(s.getDistance(t.add(e))<1e-7&&s.getDistance(n.add(i))<1e-7){var o=r.dot(r),a=r.dot(e)/o,h=r.dot(i)/o;return a>=0&&a<=1&&h<=0&&h>=-1}}return!1},isLinear:function(t,e,i,n){var r=n.subtract(t).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],s=e[6],o=e[7];return t(new u(n,r),new u(e[2]-n,e[3]-r),new u(e[4]-s,e[5]-o),new u(s,o),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new O(this,t):null},getTimeAt:function(t,e){return D.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(u.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return D.getTimeOf(this.getValues(),u.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=u.read(arguments),e=this.getValues(),i=D.getNearestTime(e,t),n=D.getPoint(e,i);return new O(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return D[t](n,i?e:D.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return D[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],l=9*(n-s)+3*(a-e),c=6*(e+s)-12*n,u=3*(n-e),f=9*(r-o)+3*(h-i),d=6*(i+o)-12*r,p=3*(r-i);return function(t){var e=(l*t+c)*t+u,i=(f*t+d)*t+p;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],s=t[1],o=t[2],a=t[3],h=t[4],c=t[5],f=t[6],d=t[7],p=l.isZero;p(o-r)&&p(a-s)&&(o=r,a=s),p(h-f)&&p(c-d)&&(h=f,c=d);var g,v,m=3*(o-r),_=3*(h-o)-m,y=f-r-m-_,x=3*(a-s),b=3*(c-a)-x,w=d-s-x-b;if(0===i)g=0===e?r:1===e?f:((y*e+_)*e+m)*e+r,v=0===e?s:1===e?d:((w*e+b)*e+x)*e+s;else{if(e<1e-8?(g=m,v=x):e>1-1e-8?(g=3*(f-h),v=3*(d-c)):(g=(3*y*e+2*_)*e+m,v=(3*w*e+2*b)*e+x),n){0===g&&0===v&&(e<1e-8||e>1-1e-8)&&(g=h-o,v=c-a);var S=Math.sqrt(g*g+v*v);S&&(g/=S,v/=S)}if(3===i){h=6*y*e+2*_,c=6*w*e+2*b;var C=Math.pow(g*g+v*v,1.5);g=0!==C?(g*c-v*h)/C:0,v=0}}return 2===i?new u(v,-g):new u(g,v)}return{statics:{classify:function(t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],u=r*(n-c)+s*(h-i)+i*c-n*h,f=3*(o*(s-n)+a*(i-r)+r*n-s*i),d=f-u,p=d-u+(i*(c-a)+n*(o-h)+h*a-c*o),g=Math.sqrt(p*p+d*d+f*f),v=0!==g?1/g:0,m=l.isZero;function _(t,i,n){var r=i!==e,s=r&&i>0&&i<1,o=r&&n>0&&n<1;return!r||(s||o)&&("loop"!==t||s&&o)||(t="arch",s=o=!1),{type:t,roots:s||o?s&&o?i<n?[i,n]:[n,i]:[s?i:n]:null}}if(d*=v,f*=v,m(p*=v))return m(d)?_(m(f)?"line":"quadratic"):_("serpentine",f/(3*d));var y=3*d*d-4*p*f;if(m(y))return _("cusp",d/(2*p));var x=y>0?Math.sqrt(y/3):Math.sqrt(-y),b=2*p;return _(y>0?"serpentine":"loop",(d+x)/b,(d-x)/b)},getLength:function(n,r,s,o){if(r===e&&(r=0),s===e&&(s=1),D.isStraight(n)){var a=n;s<1&&(a=D.subdivide(a,s)[0],r/=s),r>0&&(a=D.subdivide(a,r)[1]);var h=a[6]-a[0],c=a[7]-a[1];return Math.sqrt(h*h+c*c)}return l.integrate(o||t(n),r,s,i(r,s))},getTimeAt:function(n,r,s){if(s===e&&(s=r<0?1:0),0===r)return s;var o=Math.abs,a=r>0,h=a?s:0,c=a?1:s,u=t(n),f=D.getLength(n,h,c,u),d=o(r)-f;if(o(d)<1e-12)return a?c:h;if(d>1e-12)return null;var p=r/f,g=0;return l.findRoot(function(t){return g+=l.integrate(u,s,t,i(s,t)),s=t,g-r},u,s+p,h,c,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=3*n-e-3*s+t[6],h=3*e-6*n+3*s,c=-3*e+3*n,u=3*r-i-3*o+t[7],f=3*i-6*r+3*o,d=-3*i+3*r,p=[];return l.solveCubic(9*(a*a+u*u),9*(a*h+f*u),2*(h*h+f*f)+3*(c*a+d*u),c*h+f*d,p,1e-8,1-1e-8),p.sort()}}}},new function(){function t(t,e,i,n,r,s,o){var a=!o&&i.getPrevious()===r,h=!o&&i!==r&&i.getNext()===r;if(null!==n&&n>=(a?1e-8:0)&&n<=(h?1-1e-8:1)&&null!==s&&s>=(h?1e-8:0)&&s<=(a?1-1e-8:1)){var l=new O(i,n,null,o),c=new O(r,s,null,o);l._intersection=c,c._intersection=l,e&&!e(l)||O.insert(t,l,!0)}}function e(t,e,n,r){return t[0][1]<n?i(t,!0,n):e[0][1]>r?i(e,!1,r):t[0][0]}function i(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,o=t.length;s<o;s++){var a=t[s][0],h=t[s][1];if(e?h>=i:h<=i)return h===i?a:n+(i-r)*(a-n)/(h-r);n=a,r=h}return null}function n(t,e,i,n,r){var s=l.isZero;if(s(n)&&s(r)){var o=D.getTimeOf(t,new u(e,i));return null===o?[]:[o]}for(var a=Math.atan2(-r,n),h=Math.sin(a),c=Math.cos(a),f=[],d=[],p=0;p<8;p+=2){var g=t[p]-e,v=t[p+1]-i;f.push(g*c-v*h,g*h+v*c)}return D.solveCubic(f,1,0,d,0,1),d}function r(i,r,s,a,h,l){var c=Math.min,f=Math.max;if(f(i[0],i[2],i[4],i[6])+1e-12>c(r[0],r[2],r[4],r[6])&&c(i[0],i[2],i[4],i[6])-1e-12<f(r[0],r[2],r[4],r[6])&&f(i[1],i[3],i[5],i[7])+1e-12>c(r[1],r[3],r[5],r[7])&&c(i[1],i[3],i[5],i[7])-1e-12<f(r[1],r[3],r[5],r[7])){var d=o(i,r);if(d)for(var p=0;p<2;p++){var g=d[p];t(h,l,s,g[0],a,g[1],!0)}else{var v=D.isStraight(i),m=D.isStraight(r),y=v&&m,x=v&&!m,b=h.length;if((y?function(e,i,n,r,s,o){var a=_.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);a&&t(s,o,n,D.getTimeOf(e,a),r,D.getTimeOf(i,a))}:v||m?function(e,i,r,s,o,a,h){for(var l=i[0],c=i[1],u=n(e,l,c,i[6]-l,i[7]-c),f=0,d=u.length;f<d;f++){var p=u[f],g=D.getPoint(e,p),v=D.getTimeOf(i,g);null!==v&&t(o,a,h?s:r,h?v:p,h?r:s,h?p:v)}}:function i(n,r,s,o,a,h,l,c,u,f,d,p,g){if(++u>=4096||++c>=40)return u;var v,m,y=r[0],x=r[1],b=r[6],w=r[7],S=_.getSignedDistance,C=S(y,x,b,w,r[2],r[3]),T=S(y,x,b,w,r[4],r[5]),k=C*T>0?.75:4/9,E=k*Math.min(0,C,T),A=k*Math.max(0,C,T),M=S(y,x,b,w,n[0],n[1]),O=S(y,x,b,w,n[2],n[3]),L=S(y,x,b,w,n[4],n[5]),P=S(y,x,b,w,n[6],n[7]),B=function(t,e,i,n){var r,s=[0,M],o=[1/3,O],a=[2/3,L],h=[1,P],l=O-(2*M+P)/3,c=L-(M+2*P)/3;if(l*c<0)r=[[s,o,h],[s,a,h]];else{var u=l/c;r=[u>=2?[s,o,h]:u<=.5?[s,a,h]:[s,o,a,h],[s,h]]}return(l||c)<0?r.reverse():r}(),I=B[0],R=B[1];if(0===C&&0===T&&0===M&&0===O&&0===L&&0===P||null==(v=e(I,R,E,A))||null==(m=e(I.reverse(),R.reverse(),E,A)))return u;var F=f+(d-f)*v,U=f+(d-f)*m;if(Math.max(g-p,U-F)<1e-9){var N=(F+U)/2,z=(p+g)/2;t(a,h,l?o:s,l?z:N,l?s:o,l?N:z)}else if(n=D.getPart(n,v,m),m-v>.8){var G;if(U-F>g-p)N=(F+U)/2,u=i(r,(G=D.subdivide(n,.5))[0],o,s,a,h,!l,c,u,p,g,F,N),u=i(r,G[1],o,s,a,h,!l,c,u,p,g,N,U);else z=(p+g)/2,u=i((G=D.subdivide(r,.5))[0],n,o,s,a,h,!l,c,u,p,z,F,U),u=i(G[1],n,o,s,a,h,!l,c,u,z,g,F,U)}else u=g-p>=1e-9?i(r,n,o,s,a,h,!l,c,u,p,g,F,U):i(n,r,s,o,a,h,l,c,u,F,U,p,g);return u})(x?r:i,x?i:r,x?a:s,x?s:a,h,l,x,0,0,0,1,0,1),!y||h.length===b)for(p=0;p<4;p++){var w=p>>1,S=1&p,C=6*w,T=6*S,k=new u(i[C],i[C+1]),E=new u(r[T],r[T+1]);k.isClose(E,1e-12)&&t(h,l,s,w,a,S)}}}return h}function s(e,i,n,r){var s=D.classify(e);if("loop"===s.type){var o=s.roots;t(n,r,i,o[0],i,o[1])}return n}function o(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=_.getDistance,s=D.isStraight(t),o=D.isStraight(e),a=s&&o,h=i(t)<i(e),l=h?e:t,c=h?t:e,f=l[0],d=l[1],p=l[6]-f,g=l[7]-d;if(r(f,d,p,g,c[0],c[1],!0)<1e-7&&r(f,d,p,g,c[6],c[7],!0)<1e-7)!a&&r(f,d,p,g,l[2],l[3],!0)<1e-7&&r(f,d,p,g,l[4],l[5],!0)<1e-7&&r(f,d,p,g,c[2],c[3],!0)<1e-7&&r(f,d,p,g,c[4],c[5],!0)<1e-7&&(s=o=a=!0);else if(a)return null;if(s^o)return null;for(var v=[t,e],m=[],y=0;y<4&&m.length<2;y++){var x=1&y,b=1^x,w=y>>1,S=D.getTimeOf(v[x],new u(v[b][w?6:0],v[b][w?7:1]));if(null!=S){var C=x?[w,S]:[S,w];(!m.length||n(C[0]-m[0][0])>1e-8&&n(C[1]-m[0][1])>1e-8)&&m.push(C)}if(y>2&&!m.length)break}if(2!==m.length)m=null;else if(!a){var T=D.getPart(t,m[0][0],m[1][0]),k=D.getPart(e,m[0][1],m[1][1]);(n(k[2]-T[2])>1e-7||n(k[3]-T[3])>1e-7||n(k[4]-T[4])>1e-7||n(k[5]-T[5])>1e-7)&&(m=null)}return m}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?r(e,i,this,t,[]):s(e,this,[])},statics:{getOverlaps:o,getIntersections:function(t,e,i,n,o,a){var h=!e;h&&(e=t);for(var l,c,u=t.length,f=e.length,d=[],p=[],g=0;g<f;g++)d[g]=e[g].getValues(o);for(g=0;g<u;g++){var v=t[g],m=h?d[g]:v.getValues(n),_=v.getPath();_!==c&&(c=_,l=[],p.push(l)),h&&s(m,v,l,i);for(var y=h?g+1:0;y<f;y++){if(a&&l.length)return l;r(m,d[y],v,e[y],l,i)}}l=[],g=0;for(var x=p.length;g<x;g++)l.push.apply(l,p[g]);return l},getCurveLineIntersections:n}}}),O=r.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){if(e>=.99999999){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),i=this.getTime();0===i?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){var t=this._path,e=this;function i(t){var i=t&&t.getCurve();if(i&&null!=(e._time=i.getTimeOf(e._point)))return e._setCurve(i),i}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||i(this._segment)||i(this._segment1)||i(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(t,e){var i=this===t;if(!i&&t instanceof O){var n=this.getCurve(),r=t.getCurve(),s=n._path;if(s===r._path){var o=Math.abs,a=o(this.getOffset()-t.getOffset()),h=!e&&this._intersection,l=!e&&t._intersection;i=(a<1e-7||s&&o(s.getLength()-a)<1e-7)&&(!h&&!l||h&&l&&h.equals(l,!0))}}return i},toString:function(){var t=[],e=this.getPoint(),i=h.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){var t=this._intersection;if(!t)return!1;var e=this.getTime(),i=t.getTime(),n=e>=1e-8&&e<=1-1e-8,r=i>=1e-8&&i<=1-1e-8;if(n&&r)return!this.isTouching();var s=this.getCurve(),o=e<1e-8?s.getPrevious():s,a=t.getCurve(),h=i<1e-8?a.getPrevious():a;if(e>1-1e-8&&(s=s.getNext()),i>1-1e-8&&(a=a.getNext()),!(o&&s&&h&&a))return!1;var l=[];function c(t,e){var i=t.getValues(),n=D.classify(i).roots||D.getPeaks(i),r=n.length,s=e&&r>1?n[r-1]:r>0?n[0]:.5;l.push(D.getLength(i,e?s:0,e?1:s)/2)}function u(t,e,i){return e<i?t>e&&t<i:t>e||t<i}n||(c(o,!0),c(s,!1)),r||(c(h,!0),c(a,!1));var f=this.getPoint(),d=Math.min.apply(Math,l),p=n?s.getTangentAtTime(e):s.getPointAt(d).subtract(f),g=n?p.negate():o.getPointAt(-d).subtract(f),v=r?a.getTangentAtTime(i):a.getPointAt(d).subtract(f),m=r?v.negate():h.getPointAt(-d).subtract(f),_=g.getAngle(),y=p.getAngle(),x=m.getAngle(),b=v.getAngle();return!!(n?u(_,x,b)^u(y,x,b)&&u(_,b,x)^u(y,b,x):u(x,_,y)^u(b,_,y)&&u(x,y,_)^u(b,y,_))},hasOverlap:function(){return!!this._overlap}},r.each(D._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){var n=t.length,r=0,s=n-1;function o(i,r){for(var s=i+r;s>=-1&&s<=n;s+=r){var o=t[(s%n+n)%n];if(!e.getPoint().isClose(o.getPoint(),1e-7))break;if(e.equals(o))return o}return null}for(;r<=s;){var a,h=r+s>>>1,l=t[h];if(i&&(a=e.equals(l)?l:o(h,-1)||o(h,1)))return e._overlap&&(a._overlap=a._intersection._overlap=!0),a;var c=e.getPath(),u=l.getPath();(c!==u?c._id-u._id:e.getIndex()+e.getTime()-(l.getIndex()+l.getTime()))<0?s=h-1:r=h+1}return t.splice(r,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),L=x.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;if(r.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i){var s=i[0];n=s&&Array.isArray(s[0])}else e&&(n=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(n?B:P)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var e,i,n,r=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),s=!1,o=new u,a=new u;function h(t,i){var n=+e[t];return s&&(n+=o[i]),n}function l(t){return new u(h(t,"x"),h(t+1,"y"))}this.clear();for(var c=0,f=r&&r.length;c<f;c++){var p=r[c],g=p[0],v=g.toLowerCase(),m=(e=p.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&e.length;switch(s=g===v,"z"!==i||/[mz]/.test(v)||this.moveTo(o),v){case"m":case"l":for(var _="m"===v,y=0;y<m;y+=2)this[_?"moveTo":"lineTo"](o=l(y)),_&&(a=o,_=!1);n=o;break;case"h":case"v":var x="h"===v?"x":"y";for(o=o.clone(),y=0;y<m;y++)o[x]=h(y,x),this.lineTo(o);n=o;break;case"c":for(y=0;y<m;y+=6)this.cubicCurveTo(l(y),n=l(y+2),o=l(y+4));break;case"s":for(y=0;y<m;y+=4)this.cubicCurveTo(/[cs]/.test(i)?o.multiply(2).subtract(n):o,n=l(y),o=l(y+2)),i=v;break;case"q":for(y=0;y<m;y+=4)this.quadraticCurveTo(n=l(y),o=l(y+2));break;case"t":for(y=0;y<m;y+=2)this.quadraticCurveTo(n=/[qt]/.test(i)?o.multiply(2).subtract(n):o,o=l(y)),i=v;break;case"a":for(y=0;y<m;y+=7)this.arcTo(o=l(y+5),new d(+e[y],+e[y+1]),+e[y+2],+e[y+4],+e[y+3]);break;case"z":this.closePath(1e-12),o=a}i=v}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,i,n){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),o=r?s:(i||t._matrix)._orNullIfIdentity();return r||this.getBounds(s).intersects(t.getBounds(o),1e-12)?D.getIntersections(this.getCurves(),!r&&t.getCurves(),e,s,o,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=u.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var o=e[r].getNearestLocation(t);o._distance<i&&(i=o._distance,n=o)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",s=t[r],o=e[r],a=this[r];if(!s||!o||s.length!==o.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var h=a.length,l=o.length;if(h<l)for(var c=n?A:P,u=h;u<l;u++)this.add(new c);else h>l&&this[n?"removeSegments":"removeChildren"](l,h);for(u=0;u<l;u++)a[u].interpolate(s[u],o[u],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var i=this._children||[this],n=t._children?t._children.slice():[t],r=i.length,s=n.length,o=[],a=0;e=!0;for(var h=r-1;h>=0&&e;h--){var l=i[h];e=!1;for(var c=s-1;c>=0&&!e;c--)l.compare(n[c])&&(o[c]||(o[c]=!0,a++),e=!0)}e=e&&a===s}return e}}),P=L.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=e,this._segmentSelection=0,i||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!i&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(i){if(t.base.call(this,i),8&i){if(this._length=this._area=e,16&i)this._version++;else if(this._curves)for(var n=0,r=this._curves.length;n<r;n++)this._curves[n]._changed()}else 32&i&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof B?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var i=this.isFullySelected(),n=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,n){var r=t[n-1];"boolean"==typeof r&&(this.setClosed(r),n--),this._add(A.readList(t,0,{},n))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new D(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new D(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){var i,n,r,s,o,a,l,c,u=this._segments,f=u.length,d=new h(e),p=new Array(6),g=!0,v=[];function m(e,h){if(e._transformCoordinates(t,p),i=p[0],n=p[1],g)v.push("M"+d.pair(i,n)),g=!1;else if(o=p[2],a=p[3],o===i&&a===n&&l===r&&c===s){if(!h){var u=i-r,f=n-s;v.push(0===u?"v"+d.number(f):0===f?"h"+d.number(u):"l"+d.pair(u,f))}}else v.push("c"+d.pair(l-r,c-s)+" "+d.pair(o-r,a-s)+" "+d.pair(i-r,n-s));r=i,s=n,l=p[4],c=p[5]}if(!f)return"";for(var _=0;_<f;_++)m(u[_]);return this._closed&&f>0&&(m(u[0],!0),v.push("z")),v.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,s=null==e,o=(e=s?i.length:e,0);o<r;o++){var a=t[o];a._path&&(a=t[o]=a.clone()),a._path=this,a._index=e+o,a._selection&&this._updateSelection(a,0,a._selection)}if(s)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t)),o=e+r;for(var h=i.length;o<h;o++)i[o]._index=o}if(n){var l=this._countCurves(),c=e>0&&e+r-1===l?e-1:e,u=c,f=Math.min(c+r,l);for(t._curves&&(n.splice.apply(n,[c,0].concat(t._curves)),u+=t._curves.length),o=u;o<f;o++)n.splice(o,0,new D(this,null,null));this._adjustCurves(c,f)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)(i=r[s])._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(A.readList(arguments)):this._add([A.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(A.readList(arguments,1),t):this._add([A.read(arguments,1)],t)[0]},addSegment:function(){return this._add([A.read(arguments)])[0]},insertSegment:function(t){return this._add([A.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(A.readList(t))},insertSegments:function(t,e){return this._add(A.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=r.pick(e,this._segments.length);var n=this._segments,s=this._curves,o=n.length,a=n.splice(t,e-t),h=a.length;if(!h)return a;for(var l=0;l<h;l++){var c=a[l];c._selection&&this._updateSelection(c,c._selection,0),c._index=c._path=null}l=t;for(var u=n.length;l<u;l++)n[l]._index=l;if(s){var f=t>0&&e===o+(this._closed?1:0)?t-1:t;for(l=(s=s.splice(f,h)).length-1;l>=0;l--)s[l]._path=null;i&&(a._curves=s.slice(1)),this._adjustCurves(f,f)}return this._changed(25),a},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,i=this._closed;t=0;for(var n=0,r=e.length;n<r;n++){var s=n+1===r;t+=D.getArea(D.getValues(e[n],e[s?0:n+1],null,s&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i,(this._segmentSelection+=i-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,i=this.getLocationAt(t);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),i=e&&e.index,n=e&&e.time;n>1-1e-8&&(i++,n=0);var r=this.getCurves();if(i>=0&&i<r.length){n>=1e-8&&r[i++].divideAtTime(n);var s,o=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),s=this):((s=new P(x.NO_INSERT)).insertAbove(this),s.copyAttributes(this)),s._add(o,0),this.addSegment(o[0]),s}return null},split:function(t,i){var n,r=i===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(i);return null!=r?this.splitAt(r):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,i)&&t.reverse();var o=t.getFirstSegment();if(r&&r._point.isClose(o._point,i))r.setHandleOut(o._handleOut),this._add(n.slice(1));else{var a=this.getFirstSegment();a&&a._point.isClose(o._point,i)&&t.reverse(),s=t.getLastSegment(),a&&a._point.isClose(s._point,i)?(a.setHandleIn(s._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var h=this.getFirstSegment(),l=this.getLastSegment();return h!==l&&h._point.isClose(l._point,i)&&(h.setHandleIn(l._handleIn),l.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(!s.hasLength(n)||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new I(this,t||.25,256,!0).parts,i=e.length,n=[],r=0;r<i;r++)n.push(new A(e[r].curve.slice(0,2)));!this._closed&&i>0&&n.push(new A(e[i-1].curve.slice(6))),this.setSegments(n)},simplify:function(t){var e=new R(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){var i=this,n=t||{},r=n.type||"asymmetric",s=this._segments,o=s.length,a=this._closed;function h(t,e){var n=t&&t.index;if(null!=n){var r=t.path;if(r&&r!==i)throw new Error(t._class+" "+n+" of "+r+" is not part of "+i);e&&t instanceof D&&n++}else n="number"==typeof t?t:e;return Math.min(n<0&&a?n%o:n<0?n+o:n,o-1)}var l=a&&n.from===e&&n.to===e,c=h(n.from,0),u=h(n.to,o-1);if(c>u)if(a)c-=o;else{var f=c;c=u,u=f}if(/^(?:asymmetric|continuous)$/.test(r)){var d="asymmetric"===r,p=Math.min,g=u-c+1,v=g-1,m=l?p(g,4):1,_=m,y=m,x=[];if(a||(_=p(1,c),y=p(1,o-u-1)),(v+=_+y)<=1)return;for(var b=0,w=c-_;b<=v;b++,w++)x[b]=s[(w<0?w+o:w)%o]._point;var S=x[0]._x+2*x[1]._x,C=x[0]._y+2*x[1]._y,T=2,k=v-1,E=[S],A=[C],M=[T],O=[],L=[];for(b=1;b<v;b++){var P=b<k,B=P?4:d?2:7,I=P?4:d?3:8,R=P?2:d?0:1,F=(P?1:d?1:2)/T;T=M[b]=B-F,S=E[b]=I*x[b]._x+R*x[b+1]._x-F*S,C=A[b]=I*x[b]._y+R*x[b+1]._y-F*C}for(O[k]=E[k]/M[k],L[k]=A[k]/M[k],b=v-2;b>=0;b--)O[b]=(E[b]-O[b+1])/M[b],L[b]=(A[b]-L[b+1])/M[b];O[v]=(3*x[v]._x-O[k])/2,L[v]=(3*x[v]._y-L[k])/2,b=_;var U=v-y;for(w=c;b<=U;b++,w++){var N=s[w<0?w+o:w],z=N._point,G=O[b]-z._x,X=L[b]-z._y;(l||b<U)&&N.setHandleOut(G,X),(l||b>_)&&N.setHandleIn(-G,-X)}}else for(b=c;b<=u;b++)s[b<0?b+o:b].smooth(n,!l&&b===c,!l&&b===u)},toShape:function(t){if(!this._closed)return null;var i,n,r,s,o,a,h,c=this._segments;function u(t,e){var i=c[t],n=i.getNext(),r=c[e],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function f(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn;if(n.isOrthogonal(r)){var s=e._point,o=i._point,a=new _(s,n,!0).intersect(new _(o,r,!0),!0);return a&&l.isZero(n.getLength()/a.subtract(s).getLength()-.5522847498307936)&&l.isZero(r.getLength()/a.subtract(o).getLength()-.5522847498307936)}return!1}function p(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this.hasHandles()&&4===c.length&&u(0,2)&&u(1,3)&&(a=(o=c[1]).getPrevious(),h=o.getNext(),a._handleOut.isZero()&&o._handleIn.isZero()&&o._handleOut.isZero()&&h._handleIn.isZero()&&o._point.subtract(a._point).isOrthogonal(h._point.subtract(o._point)))?(i=S.Rectangle,n=new d(p(0,3),p(0,1)),s=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&f(0)&&f(2)&&f(4)&&f(6)&&u(1,5)&&u(3,7)?(i=S.Rectangle,r=(n=new d(p(1,6),p(0,3))).subtract(new d(p(0,7),p(1,2))).divide(2),s=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&f(0)&&f(1)&&f(2)&&f(3)&&(l.isZero(p(0,2)-p(1,3))?(i=S.Circle,r=p(0,2)/2):(i=S.Ellipse,r=new d(p(2,0)/2,p(3,1)/2)),s=c[1]._point),i){var g=this.getPosition(!0),v=new i({center:g,size:n,radius:r,insert:!1});return v.copyAttributes(this,!0),v._matrix.prepend(this._matrix),v.rotate(s.subtract(g).getAngle()+90),(t===e||t)&&v.insertAbove(this),v}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof B)return t.base.call(this,e);var i=this.getCurves(),n=e.getCurves(),r=i.length,s=n.length;if(!r||!s)return r==s;for(var o,a,h=i[0].getValues(),l=[],c=0,u=0,f=0;f<s;f++){var d=n[f].getValues();if(l.push(d),v=D.getOverlaps(h,d)){o=!f&&v[0][0]>0?s-1:f,a=v[0][1];break}}var p,g=Math.abs;for(d=l[o];h&&d;){var v;if((v=D.getOverlaps(h,d))&&g(v[0][0]-u)<1e-8){1===(u=v[1][0])&&(h=++c<r?i[c].getValues():null,u=0);var m=v[0][1];if(g(m-a)<1e-8){if(p||(p=[o,m]),1===(a=v[1][1])&&(++o>=s&&(o=0),d=l[o]||n[o].getValues(),a=0),!h)return p[0]===o&&p[1]===a;continue}}break}return!1},_hitTestSelf:function(t,e,i,n){var r,s,o,a,h,l,c=this,u=this.getStyle(),f=this._segments,d=f.length,p=this._closed,g=e._tolerancePadding,v=g,m=e.stroke&&u.hasStroke(),_=e.fill&&u.hasFill(),y=e.curves,x=m?u.getStrokeWidth()/2:_&&e.tolerance>0||y?0:null;function b(e,i){return t.subtract(e).divide(i).length<=1}function w(t,i,n){if(!e.selected||i.isSelected()){var r=t._point;if(i!==r&&(i=i.add(r)),b(i,v))return new E(n,c,{segment:t,point:i})}}function S(t,i){return(i||e.segments)&&w(t,t._point,"segment")||!i&&e.handles&&(w(t,t._handleIn,"handle-in")||w(t,t._handleOut,"handle-out"))}function C(t){a.add(t)}function T(e){var i,h=p||e._index>0&&e._index<d-1;return"round"===(h?r:s)?b(e._point,v):(a=new P({internal:!0,closed:!0}),h?e.isSmooth()||P._addBevelJoin(e,r,x,o,null,n,C,!0):"square"===s&&P._addSquareCap(e,s,x,null,n,C,!0),a.isEmpty()?void 0:a.contains(t)||(i=a.getNearestLocation(t))&&b(i.getPoint(),g))}if(null!==x&&(x>0?(r=u.getStrokeJoin(),s=u.getStrokeCap(),o=u.getMiterLimit(),v=v.add(P._getStrokePadding(x,n))):r=s="round"),!e.ends||e.segments||p){if(e.segments||e.handles)for(var k=0;k<d;k++)if(l=S(f[k]))return l}else if(l=S(f[0],!0)||S(f[d-1],!0))return l;if(null!==x){if(h=this.getNearestLocation(t)){var A=h.getTime();0===A||1===A&&d>1?T(h.getSegment())||(h=null):b(h.getPoint(),v)||(h=null)}if(!h&&"miter"===r&&d>1)for(k=0;k<d;k++){var M=f[k];if(t.getDistance(M._point)<=o*x&&T(M)){h=M.getLocation();break}}}return!h&&_&&this._contains(t)||h&&!m&&!y?new E("fill",this):h?new E(m?"stroke":"curve",this,{location:h,point:h.getPoint()}):null}},r.each(D._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=u.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var s=i,o=e[n];if((i+=o.getLength())>t)return o.getLocationAt(t-s)}if(e.length>0&&t<=this.getLength())return new O(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null}}),new function(){function t(t,e,i){var n,r,s,o,a,h,l,c,u=e._segments,f=u.length,d=new Array(6),p=!0;function g(e){if(i)e._transformCoordinates(i,d),n=d[0],r=d[1];else{var u=e._point;n=u._x,r=u._y}if(p)t.moveTo(n,r),p=!1;else{if(i)a=d[2],h=d[3];else{var f=e._handleIn;a=n+f._x,h=r+f._y}a===n&&h===r&&l===s&&c===o?t.lineTo(n,r):t.bezierCurveTo(l,c,a,h,n,r)}s=n,o=r,i?(l=d[4],c=d[5]):(f=e._handleOut,l=s+f._x,c=o+f._y)}for(var v=0;v<f;v++)g(u[v]);e._closed&&f>0&&g(u[0])}return{_draw:function(e,i,n,r){var s=i.dontStart,o=i.dontFinish||i.clip,a=this.getStyle(),h=a.hasFill(),l=a.hasStroke(),c=a.getDashArray(),u=!paper.support.nativeDash&&l&&c&&c.length;function f(t){return c[(t%u+u)%u]}if(s||e.beginPath(),(h||l&&!u||o)&&(t(e,this,r),this._closed&&e.closePath()),!o&&(h||l)&&(this._setStyles(e,i,n),h&&(e.fill(a.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),l)){if(u){s||e.beginPath();var d,p=new I(this,.25,32,!1,r),g=p.length,v=-a.getDashOffset(),m=0;for(v%=g;v>0;)v-=f(m--)+f(m--);for(;v<g;)d=v+f(m++),(v>0||d>0)&&p.drawPart(e,Math.max(v,0),Math.max(d,0)),v=d+f(m++)}e.stroke()}},_drawSelected:function(e,i){e.beginPath(),t(e,this,i),e.stroke(),function(t,e,i,n){var r,s,o=n/2,a=new Array(6);function h(e){var i=a[e],n=a[e+1];r==i&&s==n||(t.beginPath(),t.moveTo(r,s),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var l=0,c=e.length;l<c;l++){var u=e[l],f=u._selection;if(u._transformCoordinates(i,a),r=a[0],s=a[1],2&f&&h(2),4&f&&h(4),t.fillRect(r-o,s-o,n,n),!(1&f)){var d=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(r-o+1,s-o+1,n-2,n-2),t.fillStyle=d}}}(e,this._segments,i,paper.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new A(u.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new A(u.read(arguments))])},cubicCurveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=u.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new A(n,i.subtract(n))])},quadraticCurveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=r.pick(r.read(arguments),.5),s=1-n,o=t(this)._point,a=e.subtract(o.multiply(s*s)).subtract(i.multiply(n*n)).divide(2*n*s);if(a.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(a,i)},arcTo:function(){var e,i,n,s,o=Math.abs,a=Math.sqrt,h=t(this),c=h._point,f=u.read(arguments),p=r.peek(arguments);if("boolean"==typeof(b=r.pick(p,!0)))var g=(S=c.add(f).divide(2)).add(S.subtract(c).rotate(b?-90:90));else if(r.remain(arguments)<=2)g=f,f=u.read(arguments);else{var v=d.read(arguments),y=l.isZero;if(y(v.width)||y(v.height))return this.lineTo(f);var x=r.read(arguments),b=!!r.read(arguments),w=!!r.read(arguments),S=c.add(f).divide(2),C=(Z=c.subtract(S).rotate(-x)).x,T=Z.y,k=o(v.width),E=o(v.height),M=k*k,D=E*E,O=C*C,L=T*T,P=a(O/M+L/D);if(P>1&&(M=(k*=P)*k,D=(E*=P)*E),o(P=(M*D-M*L-D*O)/(M*L+D*O))<1e-12&&(P=0),P<0)throw new Error("Cannot create an arc with the given arguments");e=new u(k*T/E,-E*C/k).multiply((w===b?-1:1)*a(P)).rotate(x).add(S),i=(n=(s=(new m).translate(e).rotate(x).scale(k,E))._inverseTransform(c)).getDirectedAngle(s._inverseTransform(f)),!b&&i>0?i-=360:b&&i<0&&(i+=360)}if(g){var B=new _(c.add(g).divide(2),g.subtract(c).rotate(90),!0),I=new _(g.add(f).divide(2),f.subtract(g).rotate(90),!0),R=new _(c,f),F=R.getSide(g);if(!(e=B.intersect(I,!0))){if(!F)return this.lineTo(f);throw new Error("Cannot create an arc with the given arguments")}i=(n=c.subtract(e)).getDirectedAngle(f.subtract(e));var U=R.getSide(e);0===U?i=F*o(i):F===U&&(i+=i<0?360:-360)}for(var N=o(i),z=N>=360?4:Math.ceil((N-1e-7)/90),G=i/z,X=G*Math.PI/360,Y=4/3*Math.sin(X)/(1+Math.cos(X)),W=[],j=0;j<=z;j++){var Z=f,H=null;if(j<z&&(H=n.rotate(90).multiply(Y),s?(Z=s._transformPoint(n),H=s._transformPoint(n.add(H)).subtract(Z)):Z=e.add(n)),j){var V=n.rotate(-90).multiply(Y);s&&(V=s._transformPoint(n.add(V)).subtract(Z)),W.push(new A(Z,V,H))}else h.setHandleOut(H);n=n.rotate(G)}this._add(W)},lineBy:function(){var e=u.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=r.read(arguments),s=t(this)._point;this.curveTo(s.add(e),s.add(i),n)},cubicCurveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=u.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(u.read(arguments)),n=r.pick(r.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(u.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return P[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,s){var o=t[0];if(!o)return new g;var a=new Array(6),h=o._transformCoordinates(n,new Array(6)),l=h.slice(0,2),c=l.slice(),u=new Array(2);function f(t){t._transformCoordinates(n,a);for(var e=0;e<2;e++)D._addBounds(h[e],h[e+4],a[e+2],a[e],e,s?s[e]:0,l,c,u);var i=h;h=a,a=i}for(var d=1,p=t.length;d<p;d++)f(t[d]);return e&&f(o),new g(l[0],l[1],c[0]-l[0],c[1]-l[1])},getStrokeBounds:function(t,e,i,n,r){var s=i.getStyle(),o=s.hasStroke(),a=s.getStrokeWidth(),h=o&&i._getStrokeMatrix(n,r),l=o&&P._getStrokePadding(a,h),c=P.getBounds(t,e,i,n,r,l);if(!o)return c;var u=a/2,f=s.getStrokeJoin(),p=s.getStrokeCap(),v=s.getMiterLimit(),m=new g(new d(l));function _(t){c=c.include(t)}function y(t){c=c.unite(m.setCenter(t._point.transform(n)))}function x(t,e){"round"===e||t.isSmooth()?y(t):P._addBevelJoin(t,e,u,v,n,h,_)}function b(t,e){"round"===e?y(t):P._addSquareCap(t,e,u,n,h,_)}for(var w=t.length-(e?0:1),S=1;S<w;S++)x(t[S],f);return e?x(t[0],f):w>0&&(b(t[0],p),b(t[t.length-1],p)),c},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new u(t,0).transform(e),n=new u(0,t).transform(e),r=i.getAngleInRadians(),s=i.getLength(),o=n.getLength(),a=Math.sin(r),h=Math.cos(r),l=Math.tan(r),c=Math.atan2(o*l,s),f=Math.atan2(o,l*s);return[Math.abs(s*Math.cos(c)*h+o*Math.sin(c)*a),Math.abs(o*Math.sin(f)*h+s*Math.cos(f)*a)]},_addBevelJoin:function(t,e,i,n,r,s,o,a){var h=t.getCurve(),l=h.getPrevious(),c=h.getPoint1().transform(r),f=l.getNormalAtTime(1).multiply(i).transform(s),d=h.getNormalAtTime(0).multiply(i).transform(s);if(f.getDirectedAngle(d)<0&&(f=f.negate(),d=d.negate()),a&&o(c),o(c.add(f)),"miter"===e){var p=new _(c.add(f),new u(-f.y,f.x),!0).intersect(new _(c.add(d),new u(-d.y,d.x),!0),!0);p&&c.getDistance(p)<=n*i&&o(p)}o(c.add(d))},_addSquareCap:function(t,e,i,n,r,s,o){var a=t._point.transform(n),h=t.getLocation(),l=h.getNormal().multiply(0===h.getTime()?i:-i).transform(r);"square"===e&&(o&&(s(a.subtract(l)),s(a.add(l))),a=a.add(l.rotate(-90))),s(a.add(l)),s(a.subtract(l))},getHandleBounds:function(t,e,i,n,r){var s,o,a=i.getStyle();if(r.stroke&&a.hasStroke()){var h=i._getStrokeMatrix(n,r),l=a.getStrokeWidth()/2,c=l;"miter"===a.getStrokeJoin()&&(c=l*a.getMiterLimit()),"square"===a.getStrokeCap()&&(c=Math.max(c,l*Math.SQRT2)),s=P._getStrokePadding(l,h),o=P._getStrokePadding(c,h)}for(var u=new Array(6),f=1/0,d=-f,p=f,v=d,m=0,_=t.length;m<_;m++){t[m]._transformCoordinates(n,u);for(var y=0;y<6;y+=2){var x=y?s:o,b=x?x[0]:0,w=x?x[1]:0,S=u[y],C=u[y+1],T=S-b,k=S+b,E=C-w,A=C+w;T<f&&(f=T),k>d&&(d=k),E<p&&(p=E),A>v&&(v=A)}}return new g(f,p,d-f,v-p)}}});P.inject({statics:new function(){var t=.5522847498307936,e=[new A([-1,0],[0,t],[0,-t]),new A([0,-1],[-t,0],[t,0]),new A([1,0],[0,-t],[0,t]),new A([0,1],[t,0],[-t,0])];function i(t,e,i){var n=r.getNamed(i),s=new P(n&&0==n.insert&&x.NO_INSERT);return s._add(t),s._closed=e,s.set(n,{insert:!0})}function n(t,n,r){for(var s=new Array(4),o=0;o<4;o++){var a=e[o];s[o]=new A(a._point.multiply(n).add(t),a._handleIn.multiply(n),a._handleOut.multiply(n))}return i(s,!0,r)}return{Line:function(){return i([new A(u.readNamed(arguments,"from")),new A(u.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=u.readNamed(arguments,"center"),e=r.readNamed(arguments,"radius");return n(t,new d(e),arguments)},Rectangle:function(){var e,n=g.readNamed(arguments,"rectangle"),r=d.readNamed(arguments,"radius",0,{readNull:!0}),s=n.getBottomLeft(!0),o=n.getTopLeft(!0),a=n.getTopRight(!0),h=n.getBottomRight(!0);if(!r||r.isZero())e=[new A(s),new A(o),new A(a),new A(h)];else{var l=(r=d.min(r,n.getSize(!0).divide(2))).width,c=r.height,u=l*t,f=c*t;e=[new A(s.add(l,0),null,[-u,0]),new A(s.subtract(0,c),[0,f]),new A(o.add(0,c),null,[0,-f]),new A(o.add(l,0),[-u,0],null),new A(a.subtract(l,0),null,[u,0]),new A(a.add(0,c),[0,-f],null),new A(h.subtract(0,c),null,[0,f]),new A(h.subtract(l,0),[u,0])]}return i(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=S._readEllipse(arguments);return n(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=u.readNamed(arguments,"from"),e=u.readNamed(arguments,"through"),i=u.readNamed(arguments,"to"),n=r.getNamed(arguments),s=new P(n&&0==n.insert&&x.NO_INSERT);return s.moveTo(t),s.arcTo(e,i),s.set(n)},RegularPolygon:function(){for(var t=u.readNamed(arguments,"center"),e=r.readNamed(arguments,"sides"),n=r.readNamed(arguments,"radius"),s=360/e,o=e%3==0,a=new u(0,o?-n:n),h=o?-1:.5,l=new Array(e),c=0;c<e;c++)l[c]=new A(t.add(a.rotate((c+h)*s)));return i(l,!0,arguments)},Star:function(){for(var t=u.readNamed(arguments,"center"),e=2*r.readNamed(arguments,"points"),n=r.readNamed(arguments,"radius1"),s=r.readNamed(arguments,"radius2"),o=360/e,a=new u(0,-1),h=new Array(e),l=0;l<e;l++)h[l]=new A(t.add(a.rotate(o*l).multiply(l%2?s:n)));return i(h,!0,arguments)}}}});var B=L.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,i){var n=i,s=n[0];s&&"number"==typeof s[0]&&(n=[n]);for(var o=i.length-1;o>=0;o--){var a=n[o];n!==i||a instanceof P||(n=r.slice(n)),Array.isArray(a)?n[o]=new P({segments:a,insert:!1}):a instanceof B&&(n.splice.apply(n,[o,1].concat(a.removeChildren())),a.remove())}return t.base.call(this,e,n)},reduce:function t(e){for(var i=this._children,n=i.length-1;n>=0;n--){var r;(r=i[n].reduce(e)).isEmpty()&&r.remove()}return i.length?t.base.call(this):((r=new P(x.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var o=i[r],a=o._matrix;n.push(o.getPathData(t&&!a.isIdentity()?t.appended(a):t,e))}return n.join("")},_hitTestChildren:function t(e,i,n){return t.base.call(this,e,i.class===P||"path"===i.type?i:r.set({},i,{fill:!1}),n)},_draw:function(t,e,i,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,o=r.length;s<o;s++)r[s].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var a=this._style;a.hasFill()&&(t.fill(a.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var o=n[r],a=o._matrix;i[o._id]||o._drawSelected(t,a.isIdentity()?e:e.appended(a))}}},new function(){function t(t,e){var i=t._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new P(x.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=u.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][t](e)||i;return i}},{}));L.inject(new function(){var t=Math.min,i=Math.max,n=Math.abs,s={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function o(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0):i}function a(t,e,i,n,r){var s=new B(x.NO_INSERT);return s.addChildren(t,!0),s=s.reduce({simplify:e}),r&&0==r.insert||s.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),s.copyAttributes(i,!0),s}function h(t,e,i,n){if(n&&(0==n.trace||n.stroke)&&/^(subtract|intersect)$/.test(i))return c(t,e,i);var r=o(t,!0),h=e&&t!==e&&o(e,!0),l=s[i];l[i]=!0,h&&(l.subtract||l.exclude)^h.isClockwise()^r.isClockwise()&&h.reverse();var u,f=p(O.expand(r.getCrossings(h))),g=r._children||[r],_=h&&(h._children||[h]),y=[],x=[];function b(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];y.push.apply(y,n._segments),x.push.apply(x,n.getCurves()),n._overlapsOnly=!0}}if(f.length){b(g),_&&b(_);for(var w=0,S=f.length;w<S;w++)v(f[w]._segment,r,h,x,l);for(w=0,S=y.length;w<S;w++){var C=y[w],T=C._intersection;C._winding||v(C,r,h,x,l),T&&T._overlap||(C._path._overlapsOnly=!1)}u=m(y,l)}else u=d(_?g.concat(_):g.slice(),function(t){return!!l[t]});return a(u,!0,t,e,n)}function c(t,e,i){var n=o(t),r=o(e),s=n.getCrossings(r),h="subtract"===i,l="divide"===i,c={},u=[];function f(t){if(!c[t._id]&&(l||r.contains(t.getPointAt(t.getLength()/2))^h))return u.unshift(t),c[t._id]=!0}for(var d=s.length-1;d>=0;d--){var p=s[d].split();p&&(f(p)&&p.getFirstSegment().setHandleIn(0,0),n.getLastSegment().setHandleOut(0,0))}return f(n),a(u,!1,t,e)}function u(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function f(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function d(t,e,i){var s=t&&t.length;if(s){var o=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),a=t.slice().sort(function(t,e){return n(e.getArea())-n(t.getArea())}),h=a[0];null==i&&(i=h.isClockwise());for(var l=0;l<s;l++){for(var c=a[l],u=o[c._id],f=c.getInteriorPoint(),d=0,p=l-1;p>=0;p--){var g=a[p];if(g.contains(f)){var v=o[g._id];d=v.winding,u.winding+=d,u.container=v.exclude?v.container:g;break}}if(e(u.winding)===e(d))u.exclude=!0,t[u.index]=null;else{var m=u.container;c.setClockwise(m?!m.isClockwise():i)}}}return t}function p(t,e,i){var n,r,s,o=e&&[],a=!1,h=i||[],l=i&&{};function c(t){return t._path._id+"."+t._segment1._index}for(var d=(i&&i.length)-1;d>=0;d--)(p=i[d])._path&&(l[c(p)]=!0);for(d=t.length-1;d>=0;d--){var p,g,v=t[d],m=v._time,_=m,y=e&&!e(v);if((p=v._curve)&&(p!==r?(a=!p.hasHandles()||l&&l[c(p)],n=[],s=null,r=p):s>=1e-8&&(m/=s)),y)n&&n.push(v);else{if(e&&o.unshift(v),s=_,m<1e-8)g=p._segment1;else if(m>1-1e-8)g=p._segment2;else{var x=p.divideAtTime(m,!0);a&&h.push(p,x),g=x._segment1;for(var b=n.length-1;b>=0;b--){var w=n[b];w._time=(w._time-m)/(1-m)}}v._setSegment(g);var S=g._intersection,C=v._intersection;if(S){u(S,C);for(var T=S;T;)u(T._intersection,S),T=T._next}else g._intersection=C}}return i||f(h),o||t}function g(e,r,s,o,a){var h,l,c=s?1:0,u=1^c,f=[e.x,e.y],d=f[c],p=f[u],v=1e-6,m=d-1e-9,_=d+1e-9,y=0,x=0,b=0,w=0,S=!1,C=!1,T=1,k=[];function E(n){var l=n[u+0],f=n[u+6];if(!(p<t(l,f)||p>i(l,f))){var y=n[c+0],x=n[c+2],C=n[c+4],E=n[c+6];if(l!==f){var A=p===l?0:p===f?1:m>i(y,x,C,E)||_<t(y,x,C,E)?1:D.solveCubic(n,u,p,k,0,1)>0?k[0]:1,M=0===A?y:1===A?E:D.getPoint(n,A)[s?"y":"x"],O=l>f?1:-1,L=h[u]>h[u+6]?1:-1,P=h[c+6];return p!==l?(M<m?b+=O:M>_?w+=O:S=!0,M>d-v&&M<d+v&&(T/=2)):(O!==L?y<m?b+=O:y>_&&(w+=O):y!=P&&(P<_&&M>_?(w+=O,S=!0):P>m&&M<m&&(b+=O,S=!0)),T=0),h=n,!a&&M>m&&M<_&&0===D.getTangent(n,A)[s?"x":"y"]&&g(e,r,!s,o,!0)}(y<_&&E>m||E<_&&y>m)&&(S=!0)}}function A(e){var n=e[u+0],r=e[u+2],o=e[u+4],a=e[u+6];if(p<=i(n,r,o,a)&&p>=t(n,r,o,a))for(var h,l=e[c+0],f=e[c+2],d=e[c+4],g=e[c+6],v=m>i(l,f,d,g)||_<t(l,f,d,g)?[e]:D.getMonoCurves(e,s),y=0,x=v.length;y<x;y++)if(h=E(v[y]))return h}for(var M=0,O=r.length;M<O;M++){var L,P=r[M],B=P._path,I=P.getValues();if(!(M&&r[M-1]._path===B||(h=null,B._closed||(l=D.getValues(B.getLastCurve().getSegment2(),P.getSegment1(),null,!o))[u]!==l[u+6]&&(h=l),h))){h=I;for(var R=B.getLastCurve();R&&R!==P;){var F=R.getValues();if(F[u]!==F[u+6]){h=F;break}R=R.getPrevious()}}if(L=A(I))return L;if(M+1===O||r[M+1]._path!==B){if(l&&(L=A(l)))return L;!S||b||w||(b=w=B.isClockwise(o)^s?1:-1),y+=b,x+=w,b=w=0,S&&(C=!0,S=!1),l=null}}return y=n(y),x=n(x),{winding:i(y,x),windingL:y,windingR:x,quality:T,onPath:C}}function v(t,e,i,r,s){var o=[],a=t,h=0;do{var c=(y=t.getCurve()).getLength();o.push({segment:t,curve:y,length:c}),h+=c,t=t.getNext()}while(t&&!t._intersection&&t!==a);for(var u=[.5,.25,.75],f={winding:0,quality:-1},d=0;d<u.length&&f.quality<.5;d++){c=h*u[d];for(var p=0,v=o.length;p<v;p++){var m=o[p],_=m.length;if(c<=_){var y,x=(y=m.curve)._path,b=x._parent,w=b instanceof B?b:x,S=l.clamp(y.getTimeAt(c),1e-8,1-1e-8),C=y.getPointAtTime(S),T=n(y.getTangentAtTime(S).y)<Math.SQRT1_2,k=s.subtract&&i&&(w===e&&i._getWinding(C,T,!0).winding||w===i&&!e._getWinding(C,T,!0).winding)?{winding:0,quality:1}:g(C,r,T,!0);k.quality>f.quality&&(f=k);break}c-=_}}for(p=o.length-1;p>=0;p--)o[p].segment._winding=f}function m(t,e){var i,n=[];function r(t){var i;return!(!t||t._visited||e&&(!e[(i=t._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function s(t){if(t)for(var e=0,n=i.length;e<n;e++)if(t===i[e])return!0;return!1}function o(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}function a(t,e){var n=t._intersection,o=n,a=[];function h(n,o){for(;n&&n!==o;){var h=n._segment,l=h&&h._path;if(l){var c=h.getNext()||l.getFirstSegment(),u=c._intersection;h!==t&&(s(h)||s(c)||c&&r(h)&&(r(c)||u&&r(u._segment)))&&a.push(h),e&&i.push(h)}n=n._next}}if(e&&(i=[t]),n){for(h(n);n&&n._prev;)n=n._prev;h(n,o)}return a}t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),s=!(!n||!n._overlap),o=t._path,a=e._path;return r^s?r?1:-1:!i^!n?i?1:-1:o!==a?o._id-a._id:t._index-e._index});for(var h=0,l=t.length;h<l;h++){var c,u,f,d=t[h],p=r(d),g=null,v=!1,m=!0,_=[];if(p&&d._path._overlapsOnly){var y=d._path,b=d._intersection._segment._path;y.compare(b)&&(y.getArea()&&n.push(y.clone(!1)),o(y),o(b),p=!1)}for(;p;){var w=!g,S=a(d,w),C=S.shift(),T=!(v=!w&&(s(d)||s(C)))&&C;if(w&&(g=new P(x.NO_INSERT),c=null),v){(d.isFirst()||d.isLast())&&(m=d._path._closed),d._visited=!0;break}if(T&&c&&(_.push(c),c=null),c||(T&&S.push(d),c={start:g._segments.length,crossings:S,visited:u=[],handleIn:f}),T&&(d=C),!r(d)){g.removeSegments(c.start);for(var k=0,E=u.length;k<E;k++)u[k]._visited=!1;u.length=0;do{(d=c&&c.crossings.shift())&&d._path||(d=null,(c=_.pop())&&(u=c.visited,f=c.handleIn))}while(c&&!r(d));if(!d)break}var M=d.getNext();g.add(new A(d._point,f,M&&d._handleOut)),d._visited=!0,u.push(d),d=M||d._path.getFirstSegment(),f=M&&M._handleIn}v&&(m&&(g.getFirstSegment().setHandleIn(f),g.setClosed(m)),0!==g.getArea()&&n.push(g))}return n}return{_getWinding:function(t,e,i){return g(t,this.getCurves(),e,i)},unite:function(t,e){return h(this,t,"unite",e)},intersect:function(t,e){return h(this,t,"intersect",e)},subtract:function(t,e){return h(this,t,"subtract",e)},exclude:function(t,e){return h(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?c(this,t,"divide"):a([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function i(t,e){var i=t&&t._intersection;return i&&i._overlap&&i._path===e}var n=!1,s=!1,o=this.getIntersections(null,function(t){return t.hasOverlap()&&(n=!0)||t.isCrossing()&&(s=!0)}),a=n&&s&&[];if(o=O.expand(o),n)for(var h=p(o,function(t){return t.hasOverlap()},a),l=h.length-1;l>=0;l--){var c=h[l],u=c._path,d=c._segment,g=d.getPrevious(),v=d.getNext();i(g,u)&&i(v,u)&&(d.remove(),g._handleOut._set(0,0),v._handleIn._set(0,0),g===d||g.getCurve().hasLength()||(v._handleIn.set(g._handleIn),g.remove()))}s&&(p(o,n&&function(t){var e=t.getCurve(),i=t.getSegment(),n=t._intersection,r=n._curve,s=n._segment;if(e&&r&&e._path&&r._path)return!0;i&&(i._intersection=null),s&&(s._intersection=null)},a),a&&f(a),e=m(r.each(e,function(t){this.push.apply(this,t._segments)},[])));var _,y=e.length;return y>1&&t?(e!==t&&this.setChildren(e),_=this):1!==y||t||(e[0]!==this&&this.setSegments(e[0].removeSegments()),_=this),_||((_=new B(x.NO_INSERT)).addChildren(e),(_=_.reduce()).copyAttributes(this),this.replaceWith(_)),_},reorient:function(t,i){var n=this._children;return n&&n.length?this.setChildren(d(this.removeChildren(),function(e){return!!(t?e:1&e)},i)):i!==e&&this.setClockwise(i),this},getInteriorPoint:function(){var e=this.getBounds().getCenter(!0);if(!this.contains(e)){for(var n=this.getCurves(),r=e.y,s=[],o=[],a=0,h=n.length;a<h;a++){var l=n[a].getValues(),c=l[1],u=l[3],f=l[5],d=l[7];if(r>=t(c,u,f,d)&&r<=i(c,u,f,d))for(var p=D.getMonoCurves(l),g=0,v=p.length;g<v;g++){var m=p[g],_=m[1],y=m[7];if(_!==y&&(r>=_&&r<=y||r>=y&&r<=_)){var x=r===_?m[0]:r===y?m[6]:1===D.solveCubic(m,1,r,o,0,1)?D.getPoint(m,o[0]).x:(m[0]+m[6])/2;s.push(x)}}}s.length>1&&(s.sort(function(t,e){return t-e}),e.x=(s[0]+s[1])/2)}return e}}});var I=r.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){var s,o=[],a=[],h=0,l=1/(i||32),c=t._segments,u=c[0];function f(t,i){var s=D.getValues(t,i,r);o.push(s),function t(i,r,s,o){if(!(o-s>l)||n&&D.isStraight(i)||D.isFlatEnough(i,e||.25)){var c=i[6]-i[0],u=i[7]-i[1],f=Math.sqrt(c*c+u*u);f>0&&(h+=f,a.push({offset:h,curve:i,index:r,time:o}))}else{var d=D.subdivide(i,.5),p=(s+o)/2;t(d[0],r,s,p),t(d[1],r,p,o)}}(s,t._index,0,1)}for(var d=1,p=c.length;d<p;d++)f(u,s=c[d]),u=s;t._closed&&f(s,c[0]),this.curves=o,this.parts=a,this.length=h,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;e=r,r&&!(i[--r].offset<t););for(;e<n;e++){var s=i[e];if(s.offset>=t){this.index=e;var o=i[e-1],a=o&&o.index===s.index?o.time:0,h=o?o.offset:0;return{index:s.index,time:a+(s.time-a)*(t-h)/(s.offset-h)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),s=n.index,o=r.index;s<=o;s++){var a=D.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&t.moveTo(a[0],a[1]),t.bezierCurveTo.apply(t,a.slice(2))}}},r.each(D._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return D[t](this.curves[i.index],i.time)}},{})),R=r.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,s=0,o=n.length;s<o;s++){var a=n[s].point;e&&e.equals(a)||i.push(e=a.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new A(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,s){var o=this.points;if(n-i!=1){for(var a,h=this.chordLengthParameterize(i,n),l=Math.max(e,e*e),c=!0,u=0;u<=4;u++){var f=this.generateBezier(i,n,h,r,s),d=this.findMaxError(i,n,f,h);if(d.error<e&&c)return void this.addCurve(t,f);if(a=d.index,d.error>=l)break;c=this.reparameterize(i,n,h,f),l=d.error}var p=o[a-1].subtract(o[a+1]);this.fitCubic(t,e,i,a,r,p),this.fitCubic(t,e,a,n,p.negate(),s)}else{var g=o[i],v=o[n],m=g.getDistance(v)/3;this.addCurve(t,[g,g.add(r.normalize(m)),v.add(s.normalize(m)),v])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new A(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var s=Math.abs,o=this.points,a=o[t],h=o[e],l=[[0,0],[0,0]],c=[0,0],u=0,f=e-t+1;u<f;u++){var d=i[u],p=1-d,g=3*d*p,v=p*p*p,m=g*p,_=g*d,y=d*d*d,x=n.normalize(m),b=r.normalize(_),w=o[t+u].subtract(a.multiply(v+m)).subtract(h.multiply(_+y));l[0][0]+=x.dot(x),l[0][1]+=x.dot(b),l[1][0]=l[0][1],l[1][1]+=b.dot(b),c[0]+=x.dot(w),c[1]+=b.dot(w)}var S,C,T=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(s(T)>1e-12){var k=l[0][0]*c[1]-l[1][0]*c[0];S=(c[0]*l[1][1]-c[1]*l[0][1])/T,C=k/T}else{var E=l[0][0]+l[0][1],A=l[1][0]+l[1][1];S=C=s(E)>1e-12?c[0]/E:s(A)>1e-12?c[1]/A:0}var M,D,O=h.getDistance(a),L=1e-12*O;if(S<L||C<L)S=C=O/3;else{var P=h.subtract(a);M=n.normalize(S),D=r.normalize(C),M.dot(P)-D.dot(P)>O*O&&(S=C=O/3,M=D=null)}return[a,a.add(M||n.normalize(S)),h.add(D||r.normalize(C)),h]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);r=1;for(var s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var o=this.evaluate(3,t,i),a=this.evaluate(2,n,i),h=this.evaluate(1,r,i),c=o.subtract(e),u=a.dot(a)+c.dot(h);return l.isZero(u)?i:i-c.dot(a)/u},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);n=1;for(var r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,o=t+1;o<e;o++){var a=this.evaluate(3,i,n[o-t]).subtract(this.points[o]),h=a.x*a.x+a.y*a.y;h>=s&&(s=h,r=o)}return{error:s,index:r}}}),F=x.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&u.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),U=F.extend({_class:"PointText",initialize:function(){F.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new f(t.x,t.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,s=r.hasFill(),o=r.hasStroke(),a=r.getLeading(),h=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var l=0,c=n.length;l<c;l++){t.shadowColor=h;var u=n[l];s&&(t.fillText(u,0,0),t.shadowColor="rgba(0,0,0,0)"),o&&t.strokeText(u,0,0),t.translate(0,a)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),o=i.getLeading(),a=this.getView().getTextWidth(i.getFontStyle(),n),h=0;"left"!==s&&(h-=a/("center"===s?2:1));var l=new g(h,r?-.75*o:0,a,r*o);return t?t._transformBounds(l,l):l}}),N=r.extend(new function(){var t,e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},n={},s={},o=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],a={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=n-Math.min(t,e,i);return[0===r?0:60*(n==t?(e-i)/r+(e<i?6:0):n==e?(i-t)/r+2:(t-e)/r+4),0===n?0:r/n,n]},"hsb-rgb":function(t,e,i){var n,r=(t=(t/60%6+6)%6)-(n=Math.floor(t)),s=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[s[(n=o[n])[0]],s[n[1]],s[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,o=0===s,a=(n+r)/2;return[o?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),o?0:a<.5?s/(n+r):s/(2-n-r),a]},"hsl-rgb":function(t,e,i){if(0===e)return[i,i,i];for(var n=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,o=[],a=0;a<3;a++){var h=n[a];h<0&&(h+=1),h>1&&(h-=1),o[a]=6*h<1?s+6*(r-s)*h:2*h<1?r:3*h<2?s+(r-s)*(2/3-h)*6:s}return o},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(e,function(t,i){n[i]=[],r.each(t,function(t,s){var o=r.capitalize(t),a=/^(hue|saturation)$/.test(t),h=n[i][s]="gradient"===t?function(t){var e=this._components[0];return e!==(t=z.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===i?function(){return u.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+o]=function(){return this._type===i||a&&/^hs[bl]$/.test(this._type)?this._components[s]:this._convert(i)[s]},this["set"+o]=function(t){this._type===i||a&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(i),this._properties=e[i],this._type=i),this._components[s]=h.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function o(a){var h,l,c,u,f=arguments,d=this.__read,p=0;Array.isArray(a)&&(a=(f=a)[0]);var g=null!=a&&typeof a;if("string"===g&&a in e&&(h=a,a=f[1],Array.isArray(a)?(l=a,c=f[2]):(d&&(p=1),f=r.slice(f,1),g=typeof a)),!l){if(u="number"===g?f:"object"===g&&null!=a.length?a:null){h||(h=u.length>=3?"rgb":"gray");var v=e[h].length;c=u[v],d&&(p+=u===arguments?v+(null!=c?1:0):1),u.length>v&&(u=r.slice(u,0,v))}else if("string"===g)h="rgb",4===(l=function(e){var n,r=e.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r){n=[0,0,0];for(var o=0;o<3;o++){var a=r[o+1];n[o]=parseInt(1==a.length?a+a:a,16)/255}}else if(r=e.match(/^rgba?\((.*)\)$/)){o=0;for(var h=(n=r[1].split(",")).length;o<h;o++)a=+n[o],n[o]=o<3?a/255:a}else if(i){var l=s[e];if(!l){t||((t=$.getContext(1,1)).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=e,t.fillRect(0,0,1,1);var c=t.getImageData(0,0,1,1).data;l=s[e]=[c[0]/255,c[1]/255,c[2]/255]}n=l.slice()}else n=[0,0,0];return n}(a)).length&&(c=l[3],l.length--);else if("object"===g)if(a.constructor===o){if(h=a._type,l=a._components.slice(),c=a._alpha,"gradient"===h)for(var m=1,_=l.length;m<_;m++){var y=l[m];y&&(l[m]=y.clone())}}else if(a.constructor===z)h="gradient",u=f;else{var x=e[h="hue"in a?"lightness"in a?"hsl":"hsb":"gradient"in a||"stops"in a||"radial"in a?"gradient":"gray"in a?"gray":"rgb"],b=n[h];for(this._components=l=[],m=0,_=x.length;m<_;m++)null==(w=a[x[m]])&&!m&&"gradient"===h&&"stops"in a&&(w={stops:a.stops,radial:a.radial}),null!=(w=b[m].call(this,w))&&(l[m]=w);c=a.alpha}d&&h&&(p=1)}if(this._type=h||"rgb",!l)for(this._components=l=[],m=0,_=(b=n[this._type]).length;m<_;m++){var w;null!=(w=b[m].call(this,u&&u[m]))&&(l[m]=w)}return this._components=l,this._properties=e[this._type],this._alpha=c,d&&(this.__read=p),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=a[this._type+"-"+t])?e.apply(this,this._components):a["rgb-"+t].apply(this,a[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new N(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=e[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?N.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=h.instance,r=0,s=t.length;r<s;r++){var o=this._components[r];null!=o&&e.push(t[r]+": "+(i?o:n.number(o)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){var e=this._convert("rgb"),i=t||null==this._alpha?1:this._alpha;function n(t){return Math.round(255*(t<0?0:t>1?1:t))}return e=[n(e[0]),n(e[1]),n(e[2])],i<1&&e.push(i<0?0:i),t?"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):(4==e.length?"rgba(":"rgb(")+e.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,n=this._components,r=n[0],s=r._stops,o=n[1],a=n[2],h=n[3],l=e&&e.inverted();if(l&&(o=l._transformPoint(o),a=l._transformPoint(a),h&&(h=l._transformPoint(h))),r._radial){var c=a.getDistance(o);if(h){var u=h.subtract(o);u.getLength()>c&&(h=o.add(u.normalize(c-.1)))}var f=h||o;i=t.createRadialGradient(f.x,f.y,0,o.x,o.y,c)}else i=t.createLinearGradient(o.x,o.y,a.x,a.y);for(var d=0,p=s.length;d<p;d++){var g=s[d],v=g._offset;i.addColorStop(null==v?d/(p-1):v,g._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:e,random:function(){var t=Math.random;return new N(t(),t(),t())}}})},new function(){return r.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=N.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,o=n.length;s<o;s++)r[s]=t(n[s],r[s]);return new N(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),z=r.extend({_class:"Gradient",initialize:function(t,e){this._id=c.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var i=this._owners?this._owners.indexOf(t):-1;-1!=i&&(this._owners.splice(i,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new z(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;for(n=0,r=(i=this._stops=G.readList(t,0,{clone:!0})).length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),G=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new G(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=N.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),X=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new u,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontStretch:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new N}),s={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,fontStretch:9,font:9,leading:9,justification:9},o={beans:!0},a={_class:"Style",beans:!0,initialize:function(e,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||paper.project,this._defaults=!r||r instanceof b?i:r instanceof F?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),h="shadowOffset"===i,l=r.capitalize(i),c=s[i],f="set"+l,d="get"+l;a[f]=function(t){var r=this._owner,s=r&&r._children;if(s&&s.length>0&&!(r instanceof B))for(var o=0,a=s.length;o<a;o++)s[o]._style[f](t);else if(i in this._defaults){var h=this._values[i];h!==t&&(n&&(h&&h._owner!==e&&(h._owner=e),t&&t.constructor===N&&(t._owner&&(t=t.clone()),t._owner=r)),this._values[i]=t,r&&r._changed(c||65))}},a[d]=function(t){var s,o=this._owner,a=o&&o._children;if(i in this._defaults&&(!a||!a.length||t||o instanceof B))if((s=this._values[i])===e)(s=this._defaults[i])&&s.clone&&(s=s.clone());else{var l=n?N:h?u:null;!l||s&&s.constructor===l||(this._values[i]=s=l.read([s],0,{readNull:!0,clone:!0}),s&&n&&(s._owner=o))}else if(a)for(var c=0,f=a.length;c<f;c++){var p=a[c]._style[d]();if(c){if(!r.equals(s,p))return e}else s=p}return s},o[d]=function(t){return this._style[d](t)},o[f]=function(t){this._style[f](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;a[i]=o[i]="#get"+t,a[n]=o[n]="#set"+t}),x.inject(o),a},{set:function(t){var e=t instanceof X,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){function i(t,i,n){var s=t._values,o=i._values,a=i._defaults;for(var h in s){var l=s[h],c=o[h];if(!(n&&h in o||r.equals(l,c===e?a[h]:c)))return!1}return!0}return t===this||t&&this._class===t._class&&i(this,t)&&i(t,this,!0)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize(),e=this.getFontStretch();return this.getFontWeight()+" "+e+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),Y=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),o=0;o<6;o++){var a=r[o],h=a?a+s:e;if(h in t){if(!i)return t[h];t[h]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,s=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var o=i.left-(s.clientLeft||r.clientLeft||0),a=i.top-(s.clientTop||r.clientTop||0);if(!e){var h=n.defaultView;o+=h.pageXOffset||s.scrollLeft||r.scrollLeft,a+=h.pageYOffset||s.scrollTop||r.scrollTop}return new g(o,a,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new g(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return Y.getBounds(t,e).getPoint()},getSize:function(t){return Y.getBounds(t,!0).getSize()},isInvisible:function(t){return Y.getSize(t).equals(new d(0,0))},isInView:function(t){return!Y.isInvisible(t)&&Y.getViewportBounds(t).intersects(Y.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},W={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,o=r.length;s<o;s++)t.addEventListener(r[s],n,!1)},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,o=r.length;s<o;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new u(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return W.getPoint(t).subtract(Y.getOffset(e||W.getTarget(t)))}};W.requestAnimationFrame=new function(){var t,e=Y.getPrefixed(i,"requestAnimationFrame"),n=!1,r=[];function s(){var t=r;r=[];for(var i=0,o=t.length;i<o;i++)t[i]();(n=e&&r.length)&&e(s)}return function(i){r.push(i),e?n||(e(s),n=!0):t||(t=setInterval(s,1e3/60))}};var j=r.extend(s,{_class:"View",initialize:function t(e,r){function s(t){return r[t]||parseInt(r.getAttribute(t),10)}function a(){var t=Y.getSize(r);return t.isNaN()||t.isZero()?new d(s("width"),s("height")):t}var h;if(i&&r){if(this._id=r.getAttribute("id"),null==this._id&&r.setAttribute("id",this._id="view-"+t._id++),W.add(r,this._viewEvents),Y.setPrefixed(r.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),o.hasAttribute(r,"resize")){var l=this;W.add(i,this._windowEvents={resize:function(){l.setViewSize(a())}})}if(h=a(),o.hasAttribute(r,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var c=this._stats.domElement,u=c.style,f=Y.getOffset(r);u.position="absolute",u.left=f.x+"px",u.top=f.y+"px",n.body.appendChild(c)}}else h=new d(r),r=null;this._project=e,this._scope=e._scope,this._element=r,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(h.width,h.height),this._viewSize=h,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new m)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;j._focused===this&&(j._focused=null),j._views.splice(j._views.indexOf(this),1),delete j._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),W.remove(this._element,this._viewEvents),W.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(x._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;W.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;Y.getPrefixed(n,"hidden")&&"true"!==o.getAttribute(e,"keepalive")||!Y.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new p(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=d.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new g(new u,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return Y.isInView(this._element)},isInserted:function(){return Y.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var r=i.parentNode,s=n.createElement("div");s.style.fontSize=t,r.appendChild(s),e=parseFloat(Y.getStyles(s).fontSize),r.removeChild(s)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:u).read(arguments),n=u.read(arguments,0,{readNull:!0});return this.transform((new m)[t](i,n||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new m;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=u.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose(),e=t&&t.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new m).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),i=t&&t.scaling;return i?new f(i.x,i.y,this,"setScaling"):e},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(u.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(u.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(u.read(arguments))},getEventPoint:function(t){return this.viewToProject(W.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return n&&"string"==typeof e&&(e=n.getElementById(e)),new(i?Z:j)(t,e)}}},new function(){if(i){var t,e,r,s,o,a=!1,h=!1,l=i.navigator;l.pointerEnabled||l.msPointerEnabled?(r="pointerdown MSPointerDown",s="pointermove MSPointerMove",o="pointerup pointercancel MSPointerUp MSPointerCancel"):(r="touchstart",s="touchmove",o="touchend touchcancel","ontouchstart"in i&&l.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(r+=" mousedown",s+=" mousemove",o+=" mouseup"));var c={},u={mouseout:function(t){var e=j._focused,i=W.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=W.getOffset(t,e._element),r=n.x,s=Math.abs,o=s(r),a=o-(1<<25);n.x=s(a)<o?a*(r<0?-1:1):r,E(e,t,e.viewToProject(n))}},scroll:k};c[r]=function(t){var e=j._focused=T(t);a||(a=!0,e._handleMouseEvent("mousedown",t))},u[s]=function(i){var n=j._focused;if(!h){var r=T(i);r?n!==r&&(n&&E(n,i),t||(t=n),n=j._focused=e=r):e&&e===n&&(t&&!t.isInserted()&&(t=null),n=j._focused=t,t=null,k())}n&&E(n,i)},u[r]=function(){h=!0},u[o]=function(t){var e=j._focused;e&&a&&e._handleMouseEvent("mouseup",t),h=a=!1},W.add(n,u),W.add(i,{load:k});var f,d,p,g,v,m,_,y,x=!1,b=!1,w={doubleclick:"click",mousedrag:"mousemove"},S=!1,C={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:c,_handleMouseEvent:function(t,e,i){var n=this._itemEvents,r=n.native[t],s="mousemove"===t,o=this._scope.tool,h=this;function l(t){return n.virtual[t]||h.responds(t)||o&&o.responds(t)}s&&a&&l("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var c=this.getBounds().contains(i),u=r&&c&&h._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),w=u&&u.item||null,C=!1,T={};if(T[t.substr(5)]=!0,r&&w!==g&&(g&&A(g,null,"mouseleave",e,i),w&&A(w,null,"mouseenter",e,i),g=w),S^c&&(A(this,null,c?"mouseenter":"mouseleave",e,i),C=!0),!c&&!T.drag||i.equals(d)||(M(this,w,s?t:"mousemove",e,i,d),C=!0),S=c,T.down&&c||T.up&&f){if(M(this,w,t,e,i,f),T.down){if(y=w===m&&Date.now()-_<300,p=m=w,!b&&w){for(var k=w;k&&!k.responds("mousedrag");)k=k._parent;k&&(v=w)}f=i}else T.up&&(b||w!==p||(_=Date.now(),M(this,w,y?"doubleclick":"click",e,i,f),y=!1),p=v=null);S=!1,C=!0}d=i,C&&o&&(x=o._handleMouseEvent(t,e,i,T)||x),(x&&!T.move||T.down&&l("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){var r,s=this._scope,o=s.tool;function a(o){o.responds(t)&&(paper=s,o.emit(t,r=r||new V(t,e,i,n)))}this.isVisible()&&(a(this),o&&o.responds(t)&&a(o))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var s in C)n[s]=(n[s]||0)+(C[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:k}}}function T(t){var e=W.getTarget(t);return e.getAttribute&&j._viewsById[e.getAttribute("id")]}function k(){var t=j._focused;if(!t||!t.isVisible())for(var i=0,n=j._views.length;i<n;i++)if((t=j._views[i]).isVisible()){j._focused=e=t;break}}function E(t,e,i){t._handleMouseEvent("mousemove",e,i)}function A(t,e,i,n,r,s,o){var a,h=!1;function l(t,i){if(t.responds(i)){if(a||(a=new K(i,n,r,e||t,s?r.subtract(s):null)),t.emit(i,a)&&(x=!0,a.prevented&&(b=!0),a.stopped))return h=!0}else{var o=w[i];if(o)return l(t,o)}}for(;t&&t!==o&&!l(t,i);)t=t._parent;return h}function M(t,e,i,n,r,s){return t._project.removeOn(i),b=x=!1,v&&A(v,null,i,n,r,s)||e&&e!==v&&!e.isDescendant(v)&&A(e,null,i,n,r,s,v)||A(t,v||e||t,i,n,r,s)}}),Z=j.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var n=d.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=$.getCanvas(n)}var s=this._context=e.getContext("2d");if(s.save(),this._pixelRatio=1,!/^off|false$/.test(o.getAttribute(e,"hidpi"))){var a=i.devicePixelRatio||1,h=Y.getPrefixed(s,"backingStorePixelRatio")||1;this._pixelRatio=a/h}j.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,i){var n=this._pixelRatio;if(t.base.call(this,e*n,i*n),1!==n){var r=this._element,s=this._context;if(!o.hasAttribute(r,"resize")){var a=r.style;a.width=e+"px",a.height=i+"px"}s.restore(),s.save(),s.scale(n,n)}},getPixelSize:function t(e){var i,n=paper.agent;if(n&&n.firefox)i=t.base.call(this,e);else{var r=this._context,s=r.font;r.font=e+" serif",i=parseFloat(r.font),r.font=s}return i},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,o=e.length;s<o;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),H=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return q.modifiers}}),V=H.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),q=new function(){var t,s,o={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},a={tab:"\t",space:" ",enter:"\r"},h={},l={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});function u(t){var i=t.key||t.keyIdentifier;return i=/^U\+/.test(i)?String.fromCharCode(parseInt(i.substr(2),16)):/^Arrow[A-Z]/.test(i)?i.substr(5):"Unidentified"===i||i===e?String.fromCharCode(t.keyCode):i,o[i]||(i.length>1?r.hyphenate(i):i.toLowerCase())}function f(e,i,n,s){var o,a=j._focused;if(h[i]=e,e?l[i]=n:delete l[i],i.length>1&&(o=r.camelize(i))in c){c[o]=e;var u=paper&&paper.agent;if("meta"===o&&u&&u.mac)if(e)t={};else{for(var d in t)d in l&&f(!1,d,t[d],s);t=null}}else e&&t&&(t[i]=n);a&&a._handleKeyEvent(e?"keydown":"keyup",s,i,n)}return W.add(n,{keydown:function(t){var e=u(t),i=paper&&paper.agent;e.length>1||i&&i.chrome&&(t.altKey||i.mac&&t.metaKey||!i.mac&&t.ctrlKey)?f(!0,e,a[e]||(e.length>1?"":e),t):s=e},keypress:function(t){if(s){var e=u(t),i=t.charCode,n=i>=32?String.fromCharCode(i):e.length>1?"":e;e!==s&&(e=n.toLowerCase()),f(!0,e,n,t),s=null}},keyup:function(t){var e=u(t);e in l&&f(!1,e,l[e],t)}}),W.add(i,{blur:function(t){for(var e in l)f(!1,e,l[e],t)}}),{modifiers:c,isDown:function(t){return!!h[t]}}},K=H.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),J=H.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Q=(a.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){a.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){paper=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var r=n.move||n.drag,s=this.responds(t),o=this.minDistance,a=this.maxDistance,h=!1,l=this;function c(t,e){var s=i,o=r?l._point:l._downPoint||s;if(r){if(l._moveCount&&s.equals(o))return!1;if(o&&(null!=t||null!=e)){var a=s.subtract(o),h=a.getLength();if(h<(t||0))return!1;e&&(s=o.add(a.normalize(Math.min(h,e))))}l._moveCount++}return l._point=s,l._lastPoint=o||s,n.down&&(l._moveCount=-1,l._downPoint=s,l._downCount++),!0}function u(){s&&(h=l.emit(t,new J(l,t,e))||h)}if(n.down)c(),u();else if(n.up)c(null,a),u();else if(s)for(;c(o,a);)u();return h}}),{request:function(e){var i=new t.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var t=i.status;0===t||200===t?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,n='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(n);e.onError(n,t)},i.send(null)}}),$={canvases:[],getCanvas:function(t,e){if(!i)return null;var r,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=n.createElement("canvas"),s=!1);var o=r.getContext("2d");if(!o)throw new Error("Canvas "+r+" is unable to provide a 2D context.");return r.width===t&&r.height===e?s&&o.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),o.save(),r},getContext:function(t,e){var i=this.getCanvas(t,e);return i?i.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},tt=new function(){var t,e,i,n,s,o,a,h,l,c,u,f=Math.min,d=Math.max,p=Math.abs;function g(t,e,i){return.2989*t+.587*e+.114*i}function v(t,e,i,n){var r=n-g(t,e,i),s=(n=g(l=t+r,c=e+r,u=i+r),f(l,c,u)),o=d(l,c,u);if(s<0){var a=n-s;l=n+(l-n)*n/a,c=n+(c-n)*n/a,u=n+(u-n)*n/a}if(o>255){var h=255-n,p=o-n;l=n+(l-n)*h/p,c=n+(c-n)*h/p,u=n+(u-n)*h/p}}function m(t,e,i){return d(t,e,i)-f(t,e,i)}function _(t,e,i,n){var r,s=[t,e,i],o=d(t,e,i),a=f(t,e,i);r=0===f(a=a===t?0:a===e?1:2,o=o===t?0:o===e?1:2)?1===d(a,o)?2:1:0,s[o]>s[a]?(s[r]=(s[r]-s[a])*n/(s[o]-s[a]),s[o]=n):s[r]=s[o]=0,s[a]=0,l=s[0],c=s[1],u=s[2]}var y={multiply:function(){l=s*t/255,c=o*e/255,u=a*i/255},screen:function(){l=s+t-s*t/255,c=o+e-o*e/255,u=a+i-a*i/255},overlay:function(){l=s<128?2*s*t/255:255-2*(255-s)*(255-t)/255,c=o<128?2*o*e/255:255-2*(255-o)*(255-e)/255,u=a<128?2*a*i/255:255-2*(255-a)*(255-i)/255},"soft-light":function(){var n=t*s/255;l=n+s*(255-(255-s)*(255-t)/255-n)/255,c=(n=e*o/255)+o*(255-(255-o)*(255-e)/255-n)/255,u=(n=i*a/255)+a*(255-(255-a)*(255-i)/255-n)/255},"hard-light":function(){l=t<128?2*t*s/255:255-2*(255-t)*(255-s)/255,c=e<128?2*e*o/255:255-2*(255-e)*(255-o)/255,u=i<128?2*i*a/255:255-2*(255-i)*(255-a)/255},"color-dodge":function(){l=0===s?0:255===t?255:f(255,255*s/(255-t)),c=0===o?0:255===e?255:f(255,255*o/(255-e)),u=0===a?0:255===i?255:f(255,255*a/(255-i))},"color-burn":function(){l=255===s?255:0===t?0:d(0,255-255*(255-s)/t),c=255===o?255:0===e?0:d(0,255-255*(255-o)/e),u=255===a?255:0===i?0:d(0,255-255*(255-a)/i)},darken:function(){l=s<t?s:t,c=o<e?o:e,u=a<i?a:i},lighten:function(){l=s>t?s:t,c=o>e?o:e,u=a>i?a:i},difference:function(){(l=s-t)<0&&(l=-l),(c=o-e)<0&&(c=-c),(u=a-i)<0&&(u=-u)},exclusion:function(){l=s+t*(255-s-s)/255,c=o+e*(255-o-o)/255,u=a+i*(255-a-a)/255},hue:function(){_(t,e,i,m(s,o,a)),v(l,c,u,g(s,o,a))},saturation:function(){_(s,o,a,m(t,e,i)),v(l,c,u,g(s,o,a))},luminosity:function(){v(s,o,a,g(t,e,i))},color:function(){v(t,e,i,g(s,o,a))},add:function(){l=f(s+t,255),c=f(o+e,255),u=f(a+i,255)},subtract:function(){l=d(s-t,0),c=d(o-e,0),u=d(a-i,0)},average:function(){l=(s+t)/2,c=(o+e)/2,u=(a+i)/2},negation:function(){l=255-p(255-t-s),c=255-p(255-e-o),u=255-p(255-i-a)}},x=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),b=$.getContext(1,1);b&&(r.each(y,function(t,e){var i="darken"===e,n=!1;b.save();try{b.fillStyle=i?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=e,b.globalCompositeOperation===e&&(b.fillStyle=i?"#a00":"#300",b.fillRect(0,0,1,1),n=b.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}b.restore(),x[e]=n}),$.release(b)),this.process=function(r,f,d,p,g){var v=f.canvas,m="normal"===r;if(m||x[r])d.save(),d.setTransform(1,0,0,1,0,0),d.globalAlpha=p,m||(d.globalCompositeOperation=r),d.drawImage(v,g.x,g.y),d.restore();else{var _=y[r];if(!_)return;for(var b=d.getImageData(g.x,g.y,v.width,v.height),w=b.data,S=f.getImageData(0,0,v.width,v.height).data,C=0,T=w.length;C<T;C+=4){t=S[C],s=w[C],e=S[C+1],o=w[C+1],i=S[C+2],a=w[C+2],n=S[C+3],h=w[C+3],_();var k=n*p/255,E=1-k;w[C]=k*l+E*s,w[C+1]=k*c+E*o,w[C+2]=k*u+E*a,w[C+3]=n*p+E*h}d.putImageData(b,g.x,g.y)}}},et=new function(){var t="http://www.w3.org/2000/svg",e="http://www.w3.org/2000/xmlns",i="http://www.w3.org/1999/xlink",r={href:i,xlink:e,xmlns:e+"/","xmlns:xlink":e+"/"};function s(t,e,i){for(var n in e){var s=e[n],o=r[n];"number"==typeof s&&i&&(s=i.number(s)),o?t.setAttributeNS(o,n,s):t.setAttribute(n,s)}return t}return{svg:t,xmlns:e,xlink:i,create:function(e,i,r){return s(n.createElementNS(t,e),i,r)},get:function(t,e){var i=r[e],n=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===n?null:n},set:s}},it=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof L||t instanceof S||t instanceof F)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],fontStretch:["font-stretch","string"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});return new function(){var e;function i(t,i,n){var s=new r,o=t.getTranslation();if(i){var a=(t=t._shiftless())._inverseTransform(o);s[n?"cx":"x"]=a.x,s[n?"cy":"y"]=a.y,o=null}if(!t.isIdentity()){var h=t.decompose();if(h){var c=[],u=h.rotation,f=h.scaling,d=h.skewing;o&&!o.isZero()&&c.push("translate("+e.point(o)+")"),u&&c.push("rotate("+e.number(u)+")"),l.isZero(f.x-1)&&l.isZero(f.y-1)||c.push("scale("+e.point(f)+")"),d.x&&c.push("skewX("+e.number(d.x)+")"),d.y&&c.push("skewY("+e.number(d.y)+")"),s.transform=c.join(" ")}else s.transform="matrix("+t.getValues().join(",")+")"}return s}function s(t,n){for(var r=i(t._matrix),s=t._children,o=et.create("g",r,e),a=0,h=s.length;a<h;a++){var l=s[a],c=_(l,n);if(c)if(l.isClipMask()){var u=et.create("clipPath");u.appendChild(c),p(l,u,"clip"),et.set(o,{"clip-path":"url(#"+u.id+")"})}else o.appendChild(c)}return o}function o(t){var n=t._type,r=t._radius,s=i(t._matrix,!0,"rectangle"!==n);if("rectangle"===n){n="rect";var o=t._size,a=o.width,h=o.height;s.x-=a/2,s.y-=h/2,s.width=a,s.height=h,r.isZero()&&(r=null)}return r&&("circle"===n?s.r=r:(s.rx=r.width,s.ry=r.height)),et.create(n,s,e)}var a,u={Group:s,Layer:s,Raster:function(t,n){var r=i(t._matrix,!0),s=t.getSize(),o=t.getImage();return r.x-=s.width/2,r.y-=s.height/2,r.width=s.width,r.height=s.height,r.href=0==n.embedImages&&o&&o.src||t.toDataURL(),et.create("image",r,e)},Path:function(t,n){var r=n.matchShapes;if(r){var s=t.toShape(!1);if(s)return o(s)}var a,h=t._segments,l=h.length,c=i(t._matrix);if(r&&l>=2&&!t.hasHandles())if(l>2){a=t._closed?"polygon":"polyline";for(var u=[],f=0;f<l;f++)u.push(e.point(h[f]._point));c.points=u.join(" ")}else{a="line";var d=h[0]._point,p=h[1]._point;c.set({x1:d.x,y1:d.y,x2:p.x,y2:p.y})}else a="path",c.d=t.getPathData(null,n.precision);return et.create(a,c,e)},Shape:o,CompoundPath:function(t,n){var r=i(t._matrix),s=t.getPathData(null,n.precision);return s&&(r.d=s),et.create("path",r,e)},SymbolItem:function(t,n){var r=i(t._matrix,!0),s=t._definition,o=d(s,"symbol"),a=s._item,h=a.getBounds();return o||((o=et.create("symbol",{viewBox:e.rectangle(h)})).appendChild(_(a,n)),p(s,o,"symbol")),r.href="#"+o.id,r.x+=h.x,r.y+=h.y,r.width=h.width,r.height=h.height,r.overflow="visible",et.create("use",r,e)},PointText:function(t){var r=et.create("text",i(t._matrix,!0),e);if(""==t.content||""==t.content)return null;/[\u0590-\u05ff\u0600-\u06ff]/.test(t.content)&&(r.style.direction="rtl",r.style.textAnchor="end");for(var s=t.leading,o=0;o<t._lines.length;o++){var a=n.createElementNS("http://www.w3.org/2000/svg","tspan");a.textContent=t._lines[o],0===o&&(s=0),a.setAttributeNS(null,"x",r.getAttribute("x")),a.setAttributeNS(null,"dy",s),""==a.textContent.trim()?s+=t.leading:s=t.leading,r.appendChild(a)}return r}};function f(t,i,n){var s={},o=!n&&t.getParent(),a=[];return null!=t._name&&(s.id=t._name),r.each(it,function(i){var n=i.get,h=i.type,l=t[n]();if(i.exportFilter?i.exportFilter(t,l):!o||!r.equals(o[n](),l)){if("color"===h&&null!=l){var c=l.getAlpha();c<1&&(s[i.attribute+"-opacity"]=c)}"style"===h?a.push(i.attribute+": "+l):s[i.attribute]=null==l?"none":"color"===h?l.gradient?function(t){var i=d(t,"color");if(!i){var n,r=t.getGradient(),s=r._radial,o=t.getOrigin(),a=t.getDestination();if(s){n={cx:o.x,cy:o.y,r:o.getDistance(a)};var h=t.getHighlight();h&&(n.fx=h.x,n.fy=h.y)}else n={x1:o.x,y1:o.y,x2:a.x,y2:a.y};n.gradientUnits="userSpaceOnUse",i=et.create((s?"radial":"linear")+"Gradient",n,e);for(var l=r._stops,c=0,u=l.length;c<u;c++){var f=l[c],g=f._color,v=g.getAlpha(),m=f._offset;n={offset:null==m?c/(u-1):m},g&&(n["stop-color"]=g.toCSS(!0)),v<1&&(n["stop-opacity"]=v),i.appendChild(et.create("stop",n,e))}p(t,i,"color")}return"url(#"+i.id+")"}(l):l.toCSS(!0):"array"===h?l.join(","):"lookup"===h?i.toSVG[l]:l}}),a.length&&(s.style=a.join(";")),1===s.opacity&&delete s.opacity,t._visible||(s.visibility="hidden"),et.set(i,s,e)}function d(t,e){return a||(a={ids:{},svgs:{}}),t&&a.svgs[e+"-"+(t._id||t.__id||(t.__id=c.get("svg")))]}function p(t,e,i){a||d();var n=a.ids[i]=(a.ids[i]||0)+1;e.id=i+"-"+n,a.svgs[i+"-"+(t._id||t.__id)]=e}function v(e,i){var n=e,r=null;if(a){for(var s in n="svg"===e.nodeName.toLowerCase()&&e,a.svgs)r||(n||(n=et.create("svg")).appendChild(e),r=n.insertBefore(et.create("defs"),n.firstChild)),r.appendChild(a.svgs[s]);a=null}return i.asString?(new t.XMLSerializer).serializeToString(n):n}function _(t,e,i){var n=u[t._class],r=n&&n(t,e);if(r){var s=e.onExport;s&&(r=s(t,r,e)||r);var o=JSON.stringify(t._data);o&&"{}"!==o&&"null"!==o&&r.setAttribute("data-paper-data",o)}return r&&f(t,r,i)}function b(t){return t||(t={}),e=new h(t.precision),t}x.inject({exportSVG:function(t){return v(_(this,t=b(t),!0),t)}}),y.inject({exportSVG:function(t){t=b(t);var n=this._children,s=this.getView(),o=r.pick(t.bounds,"view"),a=t.matrix||"view"===o&&s._matrix,h=a&&m.read([a]),l="view"===o?new g([0,0],s.getViewSize()):"content"===o?x._getBounds(n,h,{stroke:!0}).rect:g.read([o],0,{readNull:!0}),c={version:"1.1",xmlns:et.svg,"xmlns:xlink":et.xlink};l&&(c.width=l.width,c.height=l.height,(l.x||l.y)&&(c.viewBox=e.rectangle(l)));var u=et.create("svg",c,e),f=u;h&&!h.isIdentity()&&(f=u.appendChild(et.create("g",i(h),e)));for(var d=0,p=n.length;d<p;d++)f.appendChild(_(n[d],t,!0));return v(u,t)}})},new function(){var s,o={};function a(t,e,i,n,r){var o=et.get(t,e),a=null==o?n?null:i?"":0:i?o:parseFloat(o);return/%\s*$/.test(o)?a/100*(r?1:s[/x|^width/.test(e)?"width":"height"]):a}function h(t,e,i,n,r){return e=a(t,e||"x",!1,n,r),i=a(t,i||"y",!1,n,r),!n||null!=e&&null!=i?new u(e,i):null}function l(t,e,i,n,r){return e=a(t,e||"width",!1,n,r),i=a(t,i||"height",!1,n,r),!n||null!=e&&null!=i?new d(e,i):null}function c(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?D(t)||t:"lookup"===e?i[t]:t}function f(t,e,i,n){var r=t.childNodes,s="clippath"===e,o="defs"===e,a=new b,h=a._project,l=h._currentStyle,c=[];if(s||o||(a=M(a,t,n),h._currentStyle=a._style.clone()),n)for(var u=t.querySelectorAll("defs"),f=0,d=u.length;f<d;f++)O(u[f],i,!1);for(f=0,d=r.length;f<d;f++){var p,g=r[f];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(p=O(g,i,!1))||p instanceof k||c.push(p)}return a.addChildren(c),s&&(a=M(a.reduce(),t,n)),h._currentStyle=l,(s||o)&&(a.remove(),a=null),a}function p(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new u(parseFloat(i[r]),parseFloat(i[r+1])));var o=new P(n);return"polygon"===e&&o.closePath(),o}function v(t,e){var i,n=(a(t,"href",!0)||"").substring(1),r="radialgradient"===e;if(n)(i=o[n].getGradient())._radial^r&&((i=i.clone())._radial=r);else{for(var s=t.childNodes,l=[],c=0,u=s.length;c<u;c++){var f=s[c];1===f.nodeType&&l.push(M(new G,f))}i=new z(l,r)}var d,p,g,v="userSpaceOnUse"!==a(t,"gradientUnits",!0);return r?(p=(d=h(t,"cx","cy",!1,v)).add(a(t,"r",!1,!1,v),0),g=h(t,"fx","fy",!0,v)):(d=h(t,"x1","y1",!1,v),p=h(t,"x2","y2",!1,v)),M(new N(i,d,p,g),t)._scaleToBounds=v,null}var _={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,o=r.length;s<o;s++){var a=r[s];if(1===a.nodeType)return O(a,i,n)}},g:f,svg:f,clippath:f,polygon:p,polyline:p,path:function(t){return L.create(t.getAttribute("d"))},lineargradient:v,radialgradient:v,image:function(t){var e=new C(a(t,"href",!0));return e.on("load",function(){var e=l(t);this.setSize(e);var i=this._matrix._transformPoint(h(t).add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new k(f(t,e,i,n),!0)},defs:f,use:function(t){var e=(a(t,"href",!0)||"").substring(1),i=o[e],n=h(t);return i?i instanceof k?i.place(n):i.clone().translate(n):null},circle:function(t){return new S.Circle(h(t,"cx","cy"),a(t,"r"))},ellipse:function(t){return new S.Ellipse({center:h(t,"cx","cy"),radius:l(t,"rx","ry")})},rect:function(t){return new S.Rectangle(new g(h(t),l(t)),l(t,"rx","ry"))},line:function(t){return new P.Line(h(t,"x1","y1"),h(t,"x2","y2"))},text:function(t){var e=new U(h(t).add(h(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}};function w(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new m,o=0,a=r.length;o<a;o++){var h=r[o];if(!h)break;for(var l=h.split(/\(\s*/),c=l[0],u=l[1].split(/[\s,]+/g),f=0,d=u.length;f<d;f++)u[f]=parseFloat(u[f]);switch(c){case"matrix":s.append(new m(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":s.rotate(u[0],u[1],u[2]);break;case"translate":s.translate(u[0],u[1]);break;case"scale":s.scale(u);break;case"skewX":s.skew(u[0],0);break;case"skewY":s.skew(0,u[0])}}t.transform(s)}}function T(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}var E=r.set(r.each(it,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](c(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n&&n._scaleToBounds){var r=e.getBounds();n.transform((new m).translate(r.getPoint()).scale(r.getSize()))}}}},{}),{id:function(t,e){o[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=D(e);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof b))return new b(i,t);t.insertChild(0,i)}},gradientTransform:w,transform:w,"fill-opacity":T,"stroke-opacity":T,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,r){var s,o=new g(c(e,"array")),a=l(n,null,null,!0);if(t instanceof b){var h=a?a.divide(o.getSize()):1,u=(new m).scale(h).translate(o.getPoint().negate());s=t}else t instanceof k&&(a&&o.setSize(a),s=t._item);if(s){if("visible"!==A(n,"overflow",r)){var f=new S.Rectangle(o);f.setClipMask(!0),s.addChild(f)}u&&s.transform(u)}}});function A(t,i,n){var s=t.attributes[i],o=s&&s.value;if(!o){var a=r.camelize(i);(o=t.style[a])||n.node[a]===n.parent[a]||(o=n.node[a])}return o?"none"===o?null:o:e}function M(t,i,n){if(i.style){var s=i.parentNode,o={node:Y.getStyles(i)||{},parent:!n&&!/^defs$/i.test(s.tagName)&&Y.getStyles(s)||{}};r.each(E,function(n,r){var s=A(i,r,o);t=s!==e&&n(t,s,r,i,o)||t})}return t}function D(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=e&&e[1],r=n&&o[i?n.replace(i.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function O(t,e,i){var a,h,c,u=t.nodeName.toLowerCase(),f="#document"!==u,d=n.body;i&&f&&(s=paper.getView().getSize(),s=l(t,null,null,!0)||s,a=et.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),h=t.parentNode,c=t.nextSibling,a.appendChild(t),d.appendChild(a));var p=paper.settings,g=p.applyMatrix,v=p.insertItems;p.applyMatrix=!1,p.insertItems=!1;var m=_[u],y=m&&m(t,u,e,i)||null;if(p.insertItems=v,p.applyMatrix=g,y){!f||y instanceof b||(y=M(y,t,i));var x=e.onImport,w=f&&t.getAttribute("data-paper-data");x&&(y=x(t,y,e)||y),e.expandShapes&&y instanceof S&&(y.remove(),y=y.toPath()),w&&(y._data=JSON.parse(w))}return a&&(d.removeChild(a),h&&(c?h.insertBefore(t,c):h.appendChild(t))),i&&(o={},y&&r.pick(e.applyMatrix,g)&&y.matrix.apply(!0,!0)),y}function B(i,r,s){if(!i)return null;r="function"==typeof r?{onLoad:r}:r||{};var o=paper,a=null;function h(n){try{var h="object"==typeof n?n:(new t.DOMParser).parseFromString(n,"image/svg+xml");if(!h.nodeName)throw h=null,new Error("Unsupported SVG source: "+i);paper=o,a=O(h,r,!0),r&&!1===r.insert||s._insertItem(e,a);var c=r.onLoad;c&&c(a,n)}catch(t){l(t)}}function l(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if("string"!=typeof i||/^.*</.test(i)){if("undefined"!=typeof File&&i instanceof File){var c=new FileReader;return c.onload=function(){h(c.result)},c.onerror=function(){l(c.error)},c.readAsText(i)}h(i)}else{var u=n.getElementById(i);u?h(u):Q.request({url:i,async:!0,onLoad:h,onError:l})}return a}x.inject({importSVG:function(t,e){return B(t,e,this)}}),y.inject({importSVG:function(t,e){return this.activate(),B(t,e,this)}})},(paper=new(o.inject(r.exports,{Base:r,Numerical:l,Key:q,DomEvent:W,DomElement:Y,document:n,window:i,Symbol:k,PlacedSymbol:T}))).agent.node&&require("./node/extend.js")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);(Zakeke=Zakeke||{}).isIPhoneX=function(){var t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,e=window.devicePixelRatio||1,i=window.screen.width*e,n=window.screen.height*e;return!(!t||1125!==i||2436!==n)},Zakeke.getViewport=function(){var t="CSS1Compat"===document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(t?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(t?document.documentElement.clientHeight:document.body.clientHeight)}},Zakeke.getContrastYIQ=function(t,e,i){return(299*t+587*e+114*i)/1e3>=128?"black":"white"},Zakeke.getContrastYIQHex=function(t){return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},Zakeke.arrayContains=function(t,e){return null!=e&&null!=e&&("[object Array]"===Object.prototype.toString.call(t)&&function(t){var e=t!=t;return(e||"function"!=typeof Array.prototype.indexOf?function(t){var i=-1,n=-1;for(i=0;i<this.length;i++){var r=this[i];if(e&&r!=r||r===t){n=i;break}}return n}:Array.prototype.indexOf).call(this,t)>-1}.call(t,e))},Zakeke.getColorBrightness=function(t){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t.substr(0,2),16),i=parseInt(t.substr(2,2),16),n=parseInt(t.substr(4,2),16);return Math.sqrt(e*e*.241+i*i*.691+n*n*.068)},Zakeke.isColorDark=function(t){return Zakeke.getColorBrightness(t)<130},Zakeke.changeColorLuminosity=function(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,n,r="#";for(n=0;n<3;n++)i=parseInt(t.substr(2*n,2),16),r+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16))).substr(i.length);return r},Zakeke.cropImageTransparency=function(t,e,i,n){var r=new Image,s=$("<canvas>"),o=s[0],a=o.getContext("2d");r.crossOrigin="anonymous",r.onload=function(){s.attr({width:this.width,height:this.height}),(a=o.getContext("2d"))?(a.drawImage(this,0,0),function(t,r){var s=a.getImageData(0,0,o.width,o.height).data,h=function(e,i){return s[4*(t*i+e)+3]},l=function(t){return 0==t},c=function(e){for(var i=e?1:-1,n=e?0:r-1;e?n<r:n>-1;n+=i)for(var s=0;s<t;s++)if(!l(h(s,n)))return n;return null},u=function(e){for(var i=e?1:-1,n=e?0:t-1;e?n<t:n>-1;n+=i)for(var s=0;s<r;s++)if(!l(h(n,s)))return n;return null},f=c(!0),d=c(!1),p=u(!0),g=u(!1)-p,v=d-f,m=e,_=i,y=m/g,x=_/v,b=g*y,w=v*y;w>_&&(b=g*x,w=v*x);var S=$("<canvas>").attr({width:m,height:_});S[0].getContext("2d").drawImage(o,p,f,g,v,(m-b)/2,(_-w)/2,b,w);var C=S[0],T=(S[0].getContext("2d").getImageData(0,0,C.width,C.height),C.toDataURL());n&&n(T)}(this.width,this.height)):alert("Get a real browser!")},r.src=t},Zakeke.getColorImage=function(t,e,i){var n=$("<canvas>");n.attr({width:e,height:i});var r=n[0],s=r.getContext("2d");return s.fillStyle=t,s.fillRect(0,0,e,i),r.toDataURL()},Zakeke.chunkString=function(t,e){return t?t.match(new RegExp(".[^]{1,"+e+"}","g")):null},Zakeke.getStringHashCode=function(t){var e,i=0;if(0===t.length)return i;for(e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i},function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).msgpack=t()}(function(){return function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){return r(e[o][1][t]||t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){i.encode=t("./encode").encode,i.decode=t("./decode").decode,i.Encoder=t("./encoder").Encoder,i.Decoder=t("./decoder").Decoder,i.createCodec=t("./ext").createCodec,i.codec=t("./codec").codec},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(t,e,i){(function(t){function i(t){return t&&t.isBuffer&&t}e.exports=i(void 0!==t&&t)||i(this.Buffer)||i("undefined"!=typeof window&&window.Buffer)||this.Buffer}).call(this,t("buffer").Buffer)},{buffer:29}],3:[function(t,e,i){i.copy=function(t,e,i,n){var r;i||(i=0),n||0===n||(n=this.length),e||(e=0);var s=n-i;if(t===this&&i<e&&e<n)for(r=s-1;r>=0;r--)t[r+e]=this[r+i];else for(r=0;r<s;r++)t[r+e]=this[r+i];return s},i.toString=function(t,e,i){var n=this,r=0|e;i||(i=n.length);for(var s="",o=0;r<i;)(o=n[r++])<128?s+=String.fromCharCode(o):(192==(224&o)?o=(31&o)<<6|63&n[r++]:224==(240&o)?o=(15&o)<<12|(63&n[r++])<<6|63&n[r++]:240==(248&o)&&(o=(7&o)<<18|(63&n[r++])<<12|(63&n[r++])<<6|63&n[r++]),o>=65536?(o-=65536,s+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):s+=String.fromCharCode(o));return s},i.write=function(t,e){for(var i=this,n=e||(e|=0),r=t.length,s=0,o=0;o<r;)(s=t.charCodeAt(o++))<128?i[n++]=s:s<2048?(i[n++]=192|s>>>6,i[n++]=128|63&s):s<55296||s>57343?(i[n++]=224|s>>>12,i[n++]=128|s>>>6&63,i[n++]=128|63&s):(s=65536+(s-55296<<10|t.charCodeAt(o++)-56320),i[n++]=240|s>>>18,i[n++]=128|s>>>12&63,i[n++]=128|s>>>6&63,i[n++]=128|63&s);return n-e}},{}],4:[function(t,e,i){function n(t){return new Array(t)}var r=t("./bufferish");(i=e.exports=n(0)).alloc=n,i.concat=r.concat,i.from=function(t){if(!r.isBuffer(t)&&r.isView(t))t=r.Uint8Array.from(t);else if(r.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return r.from.call(i,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(t)}},{"./bufferish":8}],5:[function(t,e,i){function n(t){return new s(t)}var r=t("./bufferish"),s=r.global;(i=e.exports=r.hasBuffer?n(0):[]).alloc=r.hasBuffer&&s.alloc||n,i.concat=r.concat,i.from=function(t){if(!r.isBuffer(t)&&r.isView(t))t=r.Uint8Array.from(t);else if(r.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return r.from.call(i,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return s.from&&1!==s.from.length?s.from(t):new s(t)}},{"./bufferish":8}],6:[function(t,e,i){function n(t,e,i,n){var a=o.isBuffer(this),h=o.isBuffer(t);if(a&&h)return this.copy(t,e,i,n);if(l||a||h||!o.isView(this)||!o.isView(t))return s.copy.call(this,t,e,i,n);var c=i||null!=n?r.call(this,i,n):this;return t.set(c,e),c.length}function r(t,e){var i=this.slice||!l&&this.subarray;if(i)return i.call(this,t,e);var r=o.alloc.call(this,e-t);return n.call(this,r,0,t,e),r}var s=t("./buffer-lite");i.copy=n,i.slice=r,i.toString=function(t,e,i){return(!h&&o.isBuffer(this)?this.toString:s.toString).apply(this,arguments)},i.write=function(t){return function(){return(this[t]||s[t]).apply(this,arguments)}}("write");var o=t("./bufferish"),a=o.global,h=o.hasBuffer&&"TYPED_ARRAY_SUPPORT"in a,l=h&&!a.TYPED_ARRAY_SUPPORT},{"./buffer-lite":3,"./bufferish":8}],7:[function(t,e,i){function n(t){return new Uint8Array(t)}var r=t("./bufferish");(i=e.exports=r.hasArrayBuffer?n(0):[]).alloc=n,i.concat=r.concat,i.from=function(t){if(r.isView(t)){var e=t.byteOffset,n=t.byteLength;(t=t.buffer).byteLength!==n&&(t.slice?t=t.slice(e,e+n):(t=new Uint8Array(t)).byteLength!==n&&(t=Array.prototype.slice.call(t,e,e+n)))}else{if("string"==typeof t)return r.from.call(i,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(t)}},{"./bufferish":8}],8:[function(t,e,i){function n(t){return r(this).alloc(t)}function r(t){return u(t)?p:f(t)?g:c(t)?d:h?p:l?g:d}function s(){return!1}function o(t,e){return t="[object "+t+"]",function(i){return null!=i&&{}.toString.call(e?i[e]:i)===t}}var a=i.global=t("./buffer-global"),h=i.hasBuffer=a&&!!a.isBuffer,l=i.hasArrayBuffer="undefined"!=typeof ArrayBuffer,c=i.isArray=t("isarray");i.isArrayBuffer=l?function(t){return t instanceof ArrayBuffer||m(t)}:s;var u=i.isBuffer=h?a.isBuffer:s,f=i.isView=l?ArrayBuffer.isView||o("ArrayBuffer","buffer"):s;i.alloc=n,i.concat=function(t,e){e||(e=0,Array.prototype.forEach.call(t,function(t){e+=t.length}));var r=this!==i&&this||t[0],s=n.call(r,e),o=0;return Array.prototype.forEach.call(t,function(t){o+=v.copy.call(t,s,o)}),s},i.from=function(t){return"string"==typeof t?function(t){var e=3*t.length,i=n.call(this,e),r=v.write.call(i,t);return e!==r&&(i=v.slice.call(i,0,r)),i}.call(this,t):r(this).from(t)};var d=i.Array=t("./bufferish-array"),p=i.Buffer=t("./bufferish-buffer"),g=i.Uint8Array=t("./bufferish-uint8array"),v=i.prototype=t("./bufferish-proto"),m=o("ArrayBuffer")},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(t,e,i){function n(t){return this instanceof n?(this.options=t,void this.init()):new n(t)}function r(t,e){return t&&e?function(){return t.apply(this,arguments),e.apply(this,arguments)}:t||e}function s(t){return new n(t)}var o=t("isarray");i.createCodec=s,i.install=function(t){for(var e in t)n.prototype[e]=r(n.prototype[e],t[e])},i.filter=function(t){return o(t)?function(t){function e(t,e){return e(t)}return t=t.slice(),function(i){return t.reduce(e,i)}}(t):t};var a=t("./bufferish");n.prototype.init=function(){var t=this.options;return t&&t.uint8array&&(this.bufferish=a.Uint8Array),this},i.preset=s({preset:!0})},{"./bufferish":8,isarray:34}],10:[function(t,e,i){t("./read-core"),t("./write-core"),i.codec={preset:t("./codec-base").preset}},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(t,e,i){function n(t){if(!(this instanceof n))return new n(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}i.DecodeBuffer=n;var r=t("./read-core").preset;t("./flex-buffer").FlexDecoder.mixin(n.prototype),n.prototype.codec=r,n.prototype.fetch=function(){return this.codec.decode(this)}},{"./flex-buffer":21,"./read-core":22}],12:[function(t,e,i){i.decode=function(t,e){var i=new n(e);return i.write(t),i.read()};var n=t("./decode-buffer").DecodeBuffer},{"./decode-buffer":11}],13:[function(t,e,i){function n(t){return this instanceof n?void s.call(this,t):new n(t)}i.Decoder=n;var r=t("event-lite"),s=t("./decode-buffer").DecodeBuffer;n.prototype=new s,r.mixin(n.prototype),n.prototype.decode=function(t){arguments.length&&this.write(t),this.flush()},n.prototype.push=function(t){this.emit("data",t)},n.prototype.end=function(t){this.decode(t),this.emit("end")}},{"./decode-buffer":11,"event-lite":31}],14:[function(t,e,i){function n(t){if(!(this instanceof n))return new n(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}i.EncodeBuffer=n;var r=t("./write-core").preset;t("./flex-buffer").FlexEncoder.mixin(n.prototype),n.prototype.codec=r,n.prototype.write=function(t){this.codec.encode(this,t)}},{"./flex-buffer":21,"./write-core":25}],15:[function(t,e,i){i.encode=function(t,e){var i=new n(e);return i.write(t),i.read()};var n=t("./encode-buffer").EncodeBuffer},{"./encode-buffer":14}],16:[function(t,e,i){function n(t){return this instanceof n?void s.call(this,t):new n(t)}i.Encoder=n;var r=t("event-lite"),s=t("./encode-buffer").EncodeBuffer;n.prototype=new s,r.mixin(n.prototype),n.prototype.encode=function(t){this.write(t),this.emit("data",this.read())},n.prototype.end=function(t){arguments.length&&this.encode(t),this.flush(),this.emit("end")}},{"./encode-buffer":14,"event-lite":31}],17:[function(t,e,i){i.ExtBuffer=function t(e,i){return this instanceof t?(this.buffer=n.from(e),void(this.type=i)):new t(e,i)};var n=t("./bufferish")},{"./bufferish":8}],18:[function(t,e,i){function n(e){return a||(a=t("./encode").encode),a(e)}function r(t){return t.valueOf()}function s(t){(t=RegExp.prototype.toString.call(t).split("/")).shift();var e=[t.pop()];return e.unshift(t.join("/")),e}function o(t){var e={};for(var i in u)e[i]=t[i];return e}i.setExtPackers=function(t){t.addExtPacker(14,Error,[o,n]),t.addExtPacker(1,EvalError,[o,n]),t.addExtPacker(2,RangeError,[o,n]),t.addExtPacker(3,ReferenceError,[o,n]),t.addExtPacker(4,SyntaxError,[o,n]),t.addExtPacker(5,TypeError,[o,n]),t.addExtPacker(6,URIError,[o,n]),t.addExtPacker(10,RegExp,[s,n]),t.addExtPacker(11,Boolean,[r,n]),t.addExtPacker(12,String,[r,n]),t.addExtPacker(13,Date,[Number,n]),t.addExtPacker(15,Number,[r,n]),"undefined"!=typeof Uint8Array&&(t.addExtPacker(17,Int8Array,c),t.addExtPacker(18,Uint8Array,c),t.addExtPacker(19,Int16Array,c),t.addExtPacker(20,Uint16Array,c),t.addExtPacker(21,Int32Array,c),t.addExtPacker(22,Uint32Array,c),t.addExtPacker(23,Float32Array,c),"undefined"!=typeof Float64Array&&t.addExtPacker(24,Float64Array,c),"undefined"!=typeof Uint8ClampedArray&&t.addExtPacker(25,Uint8ClampedArray,c),t.addExtPacker(26,ArrayBuffer,c),t.addExtPacker(29,DataView,c)),h.hasBuffer&&t.addExtPacker(27,l,h.from)};var a,h=t("./bufferish"),l=h.global,c=h.Uint8Array.from,u={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./encode":15}],19:[function(t,e,i){function n(e){return h||(h=t("./decode").decode),h(e)}function r(t){return RegExp.apply(null,t)}function s(t){return function(e){var i=new t;for(var n in u)i[n]=e[n];return i}}function o(t){return function(e){return new t(e)}}function a(t){return new Uint8Array(t).buffer}i.setExtUnpackers=function(t){t.addExtUnpacker(14,[n,s(Error)]),t.addExtUnpacker(1,[n,s(EvalError)]),t.addExtUnpacker(2,[n,s(RangeError)]),t.addExtUnpacker(3,[n,s(ReferenceError)]),t.addExtUnpacker(4,[n,s(SyntaxError)]),t.addExtUnpacker(5,[n,s(TypeError)]),t.addExtUnpacker(6,[n,s(URIError)]),t.addExtUnpacker(10,[n,r]),t.addExtUnpacker(11,[n,o(Boolean)]),t.addExtUnpacker(12,[n,o(String)]),t.addExtUnpacker(13,[n,o(Date)]),t.addExtUnpacker(15,[n,o(Number)]),"undefined"!=typeof Uint8Array&&(t.addExtUnpacker(17,o(Int8Array)),t.addExtUnpacker(18,o(Uint8Array)),t.addExtUnpacker(19,[a,o(Int16Array)]),t.addExtUnpacker(20,[a,o(Uint16Array)]),t.addExtUnpacker(21,[a,o(Int32Array)]),t.addExtUnpacker(22,[a,o(Uint32Array)]),t.addExtUnpacker(23,[a,o(Float32Array)]),"undefined"!=typeof Float64Array&&t.addExtUnpacker(24,[a,o(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&t.addExtUnpacker(25,o(Uint8ClampedArray)),t.addExtUnpacker(26,a),t.addExtUnpacker(29,[a,o(DataView)])),l.hasBuffer&&t.addExtUnpacker(27,o(c))};var h,l=t("./bufferish"),c=l.global,u={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./decode":12}],20:[function(t,e,i){t("./read-core"),t("./write-core"),i.createCodec=t("./codec-base").createCodec},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(t,e,i){function n(){if(!(this instanceof n))return new n}function r(){if(!(this instanceof r))return new r}function s(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function o(t){(this.buffers||(this.buffers=[])).push(t)}function a(t){return function(e){for(var i in t)e[i]=t[i];return e}}i.FlexDecoder=n,i.FlexEncoder=r;var h=t("./bufferish"),l="BUFFER_SHORTAGE";n.mixin=a({bufferish:h,write:function(t){var e=this.offset?h.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=e?t?this.bufferish.concat([e,t]):e:t,this.offset=0},fetch:function(){throw new Error("method not implemented: fetch()")},flush:function(){for(;this.offset<this.buffer.length;){var t,e=this.offset;try{t=this.fetch()}catch(t){if(t&&t.message!=l)throw t;this.offset=e;break}this.push(t)}},push:o,pull:function(){return(this.buffers||(this.buffers=[])).shift()},read:s,reserve:function(t){var e=this.offset,i=e+t;if(i>this.buffer.length)throw new Error(l);return this.offset=i,e},offset:0}),n.mixin(n.prototype),r.mixin=a({bufferish:h,write:function(){throw new Error("method not implemented: write()")},fetch:function(){var t=this.start;if(t<this.offset){var e=this.start=this.offset;return h.prototype.slice.call(this.buffer,t,e)}},flush:function(){for(;this.start<this.offset;){var t=this.fetch();t&&this.push(t)}},push:o,pull:function(){var t=this.buffers||(this.buffers=[]),e=t.length>1?this.bufferish.concat(t):t[0];return t.length=0,e},read:s,reserve:function(t){var e=0|t;if(this.buffer){var i=this.buffer.length,n=0|this.offset,r=n+e;if(r<i)return this.offset=r,n;this.flush(),t=Math.max(t,Math.min(2*i,this.maxBufferSize))}return t=Math.max(t,this.minBufferSize),this.buffer=this.bufferish.alloc(t),this.start=0,this.offset=e,0},send:function(t){var e=t.length;if(e>this.minBufferSize)this.flush(),this.push(t);else{var i=this.reserve(e);h.prototype.copy.call(t,this.buffer,i)}},maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}),r.mixin(r.prototype)},{"./bufferish":8}],22:[function(t,e,i){function n(){var t=this.options;return this.decode=function(t){var e=a.getReadToken(t);return function(t){var i=o(t),n=e[i];if(!n)throw new Error("Invalid type: "+(i?"0x"+i.toString(16):i));return n(t)}}(t),t&&t.preset&&s.setExtUnpackers(this),this}var r=t("./ext-buffer").ExtBuffer,s=t("./ext-unpacker"),o=t("./read-format").readUint8,a=t("./read-token"),h=t("./codec-base");h.install({addExtUnpacker:function(t,e){(this.extUnpackers||(this.extUnpackers=[]))[t]=h.filter(e)},getExtUnpacker:function(t){return(this.extUnpackers||(this.extUnpackers=[]))[t]||function(e){return new r(e,t)}},init:n}),i.preset=n.call(h.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(t,e,i){function n(t,e){var i,n={},r=new Array(e),s=new Array(e),o=t.codec.decode;for(i=0;i<e;i++)r[i]=o(t),s[i]=o(t);for(i=0;i<e;i++)n[r[i]]=s[i];return n}function r(t,e){var i,n=new Map,r=new Array(e),s=new Array(e),o=t.codec.decode;for(i=0;i<e;i++)r[i]=o(t),s[i]=o(t);for(i=0;i<e;i++)n.set(r[i],s[i]);return n}function s(t,e){for(var i=new Array(e),n=t.codec.decode,r=0;r<e;r++)i[r]=n(t);return i}function o(t,e){var i=t.reserve(e),n=i+e;return A.toString.call(t.buffer,"utf-8",i,n)}function a(t,e){var i=t.reserve(e),n=i+e,r=A.slice.call(t.buffer,i,n);return E.from(r)}function h(t,e){var i=t.reserve(e),n=i+e,r=A.slice.call(t.buffer,i,n);return E.Uint8Array.from(r).buffer}function l(t,e){var i=t.reserve(e+1),n=t.buffer[i++],r=i+e,s=t.codec.getExtUnpacker(n);if(!s)throw new Error("Invalid ext type: "+(n?"0x"+n.toString(16):n));return s(A.slice.call(t.buffer,i,r))}function c(t){var e=t.reserve(1);return t.buffer[e]}function u(t){var e=t.reserve(1),i=t.buffer[e];return 128&i?i-256:i}function f(t){var e=t.reserve(2),i=t.buffer;return i[e++]<<8|i[e]}function d(t){var e=t.reserve(2),i=t.buffer,n=i[e++]<<8|i[e];return 32768&n?n-65536:n}function p(t){var e=t.reserve(4),i=t.buffer;return 16777216*i[e++]+(i[e++]<<16)+(i[e++]<<8)+i[e]}function g(t){var e=t.reserve(4),i=t.buffer;return i[e++]<<24|i[e++]<<16|i[e++]<<8|i[e]}function v(t,e){return function(i){var n=i.reserve(t);return e.call(i.buffer,n,D)}}function m(t){return new T(this,t).toNumber()}function _(t){return new k(this,t).toNumber()}function y(t){return new T(this,t)}function x(t){return new k(this,t)}function b(t){return S.read(this,t,!1,23,4)}function w(t){return S.read(this,t,!1,52,8)}var S=t("ieee754"),C=t("int64-buffer"),T=C.Uint64BE,k=C.Int64BE;i.getReadFormat=function(t){var e=E.hasArrayBuffer&&t&&t.binarraybuffer,i=t&&t.int64;return{map:M&&t&&t.usemap?r:n,array:s,str:o,bin:e?h:a,ext:l,uint8:c,uint16:f,uint32:p,uint64:v(8,i?y:m),int8:u,int16:d,int32:g,int64:v(8,i?x:_),float32:v(4,b),float64:v(8,w)}},i.readUint8=c;var E=t("./bufferish"),A=t("./bufferish-proto"),M="undefined"!=typeof Map,D=!0},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(t,e,i){function n(t){var e,i=new Array(256);for(e=0;e<=127;e++)i[e]=r(e);for(e=128;e<=143;e++)i[e]=o(e-128,t.map);for(e=144;e<=159;e++)i[e]=o(e-144,t.array);for(e=160;e<=191;e++)i[e]=o(e-160,t.str);for(i[192]=r(null),i[193]=null,i[194]=r(!1),i[195]=r(!0),i[196]=s(t.uint8,t.bin),i[197]=s(t.uint16,t.bin),i[198]=s(t.uint32,t.bin),i[199]=s(t.uint8,t.ext),i[200]=s(t.uint16,t.ext),i[201]=s(t.uint32,t.ext),i[202]=t.float32,i[203]=t.float64,i[204]=t.uint8,i[205]=t.uint16,i[206]=t.uint32,i[207]=t.uint64,i[208]=t.int8,i[209]=t.int16,i[210]=t.int32,i[211]=t.int64,i[212]=o(1,t.ext),i[213]=o(2,t.ext),i[214]=o(4,t.ext),i[215]=o(8,t.ext),i[216]=o(16,t.ext),i[217]=s(t.uint8,t.str),i[218]=s(t.uint16,t.str),i[219]=s(t.uint32,t.str),i[220]=s(t.uint16,t.array),i[221]=s(t.uint32,t.array),i[222]=s(t.uint16,t.map),i[223]=s(t.uint32,t.map),e=224;e<=255;e++)i[e]=r(e-256);return i}function r(t){return function(){return t}}function s(t,e){return function(i){var n=t(i);return e(i,n)}}function o(t,e){return function(i){return e(i,t)}}var a=t("./read-format");i.getReadToken=function(t){var e=a.getReadFormat(t);return t&&t.useraw?function(t){var e,i=n(t).slice();for(i[217]=i[196],i[218]=i[197],i[219]=i[198],e=160;e<=191;e++)i[e]=o(e-160,t.bin);return i}(e):n(e)}},{"./read-format":23}],25:[function(t,e,i){function n(){var t=this.options;return this.encode=function(t){var e=o.getWriteType(t);return function(t,i){var n=e[typeof i];if(!n)throw new Error('Unsupported type "'+typeof i+'": '+i);n(t,i)}}(t),t&&t.preset&&s.setExtPackers(this),this}var r=t("./ext-buffer").ExtBuffer,s=t("./ext-packer"),o=t("./write-type"),a=t("./codec-base");a.install({addExtPacker:function(t,e,i){function n(e){return i&&(e=i(e)),new r(e,t)}i=a.filter(i);var s=e.name;s&&"Object"!==s?(this.extPackers||(this.extPackers={}))[s]=n:(this.extEncoderList||(this.extEncoderList=[])).unshift([e,n])},getExtPacker:function(t){var e=this.extPackers||(this.extPackers={}),i=t.constructor,n=i&&i.name&&e[i.name];if(n)return n;for(var r=this.extEncoderList||(this.extEncoderList=[]),s=r.length,o=0;o<s;o++){var a=r[o];if(i===a[0])return a[1]}},init:n}),i.preset=n.call(a.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(t,e,i){function n(){var t=v.slice();return t[196]=r(196),t[197]=s(197),t[198]=o(198),t[199]=r(199),t[200]=s(200),t[201]=o(201),t[202]=a(202,4,x.writeFloatBE||c,!0),t[203]=a(203,8,x.writeDoubleBE||u,!0),t[204]=r(204),t[205]=s(205),t[206]=o(206),t[207]=a(207,8,h),t[208]=r(208),t[209]=s(209),t[210]=o(210),t[211]=a(211,8,l),t[217]=r(217),t[218]=s(218),t[219]=o(219),t[220]=s(220),t[221]=o(221),t[222]=s(222),t[223]=o(223),t}function r(t){return function(e,i){var n=e.reserve(2),r=e.buffer;r[n++]=t,r[n]=i}}function s(t){return function(e,i){var n=e.reserve(3),r=e.buffer;r[n++]=t,r[n++]=i>>>8,r[n]=i}}function o(t){return function(e,i){var n=e.reserve(5),r=e.buffer;r[n++]=t,r[n++]=i>>>24,r[n++]=i>>>16,r[n++]=i>>>8,r[n]=i}}function a(t,e,i,n){return function(r,s){var o=r.reserve(e+1);r.buffer[o++]=t,i.call(r.buffer,s,o,n)}}function h(t,e){new p(this,e,t)}function l(t,e){new g(this,e,t)}function c(t,e){f.write(this,t,e,!1,23,4)}function u(t,e){f.write(this,t,e,!1,52,8)}var f=t("ieee754"),d=t("int64-buffer"),p=d.Uint64BE,g=d.Int64BE,v=t("./write-uint8").uint8,m=t("./bufferish"),_=m.global,y=m.hasBuffer&&"TYPED_ARRAY_SUPPORT"in _&&!_.TYPED_ARRAY_SUPPORT,x=m.hasBuffer&&_.prototype||{};i.getWriteToken=function(t){return t&&t.uint8array?function(){var t=n();return t[202]=a(202,4,c),t[203]=a(203,8,u),t}():y||m.hasBuffer&&t&&t.safe?function(){var t=v.slice();return t[196]=a(196,1,_.prototype.writeUInt8),t[197]=a(197,2,_.prototype.writeUInt16BE),t[198]=a(198,4,_.prototype.writeUInt32BE),t[199]=a(199,1,_.prototype.writeUInt8),t[200]=a(200,2,_.prototype.writeUInt16BE),t[201]=a(201,4,_.prototype.writeUInt32BE),t[202]=a(202,4,_.prototype.writeFloatBE),t[203]=a(203,8,_.prototype.writeDoubleBE),t[204]=a(204,1,_.prototype.writeUInt8),t[205]=a(205,2,_.prototype.writeUInt16BE),t[206]=a(206,4,_.prototype.writeUInt32BE),t[207]=a(207,8,h),t[208]=a(208,1,_.prototype.writeInt8),t[209]=a(209,2,_.prototype.writeInt16BE),t[210]=a(210,4,_.prototype.writeInt32BE),t[211]=a(211,8,l),t[217]=a(217,1,_.prototype.writeUInt8),t[218]=a(218,2,_.prototype.writeUInt16BE),t[219]=a(219,4,_.prototype.writeUInt32BE),t[220]=a(220,2,_.prototype.writeUInt16BE),t[221]=a(221,4,_.prototype.writeUInt32BE),t[222]=a(222,2,_.prototype.writeUInt16BE),t[223]=a(223,4,_.prototype.writeUInt32BE),t}():n()}},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(t,e,i){var n=t("isarray"),r=t("int64-buffer"),s=r.Uint64BE,o=r.Int64BE,a=t("./bufferish"),h=t("./bufferish-proto"),l=t("./write-token"),c=t("./write-uint8").uint8,u=t("./ext-buffer").ExtBuffer,f="undefined"!=typeof Uint8Array,d="undefined"!=typeof Map,p=[];p[1]=212,p[2]=213,p[4]=214,p[8]=215,p[16]=216,i.getWriteType=function(t){function e(t,e){if(null===e)return i(t,e);if(y(e))return x(t,e);if(n(e))return function(t,e){var i=e.length;v[i<16?144+i:i<=65535?220:221](t,i);for(var n=t.codec.encode,r=0;r<i;r++)n(t,e[r])}(t,e);if(s.isUint64BE(e))return function(t,e){v[207](t,e.toArray())}(t,e);if(o.isInt64BE(e))return function(t,e){v[211](t,e.toArray())}(t,e);var r=t.codec.getExtPacker(e);return r&&(e=r(e)),e instanceof u?function(t,e){var i=e.buffer,n=i.length,r=p[n]||(n<255?199:n<=65535?200:201);v[r](t,n),c[e.type](t),t.send(i)}(t,e):void b(t,e)}function i(t,e){v[192](t,e)}function r(t,e){var i=e.length;v[i<255?196:i<=65535?197:198](t,i),t.send(e)}function g(t,e){var i=Object.keys(e),n=i.length;v[n<16?128+n:n<=65535?222:223](t,n);var r=t.codec.encode;i.forEach(function(i){r(t,i),r(t,e[i])})}var v=l.getWriteToken(t),m=t&&t.useraw,_=f&&t&&t.binarraybuffer,y=_?a.isArrayBuffer:a.isBuffer,x=_?function(t,e){r(t,new Uint8Array(e))}:r,b=d&&t&&t.usemap?function(t,e){if(!(e instanceof Map))return g(t,e);var i=e.size;v[i<16?128+i:i<=65535?222:223](t,i);var n=t.codec.encode;e.forEach(function(e,i,r){n(t,i),n(t,e)})}:g;return{boolean:function(t,e){v[e?195:194](t,e)},function:i,number:function(t,e){var i=0|e;return e!==i?void v[203](t,e):void v[-32<=i&&i<=127?255&i:0<=i?i<=255?204:i<=65535?205:206:-128<=i?208:-32768<=i?209:210](t,i)},object:m?function(t,i){return y(i)?function(t,e){var i=e.length;v[i<32?160+i:i<=65535?218:219](t,i),t.send(e)}(t,i):void e(t,i)}:e,string:function(t){return function(e,i){var n=i.length,r=5+3*n;e.offset=e.reserve(r);var s=e.buffer,o=t(n),a=e.offset+o;n=h.write.call(s,i,a);var l=t(n);if(o!==l){var c=a+l-o,u=a+n;h.copy.call(s,s,c,a,u)}v[1===l?160+n:l<=3?215+l:219](e,n),e.offset+=n}}(m?function(t){return t<32?1:t<=65535?3:5}:function(t){return t<32?1:t<=255?2:t<=65535?3:5}),symbol:i,undefined:i}}},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(t,e,i){function n(t){return function(e){var i=e.reserve(1);e.buffer[i]=t}}for(var r=i.uint8=new Array(256),s=0;s<=255;s++)r[s]=n(s)},{}],29:[function(t,e,i){(function(e){"use strict";function n(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(t,e){if(n()<e)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=s.prototype:(null===t&&(t=new s(e)),t.length=e),t}function s(t,e,i){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return o(this,t,e,i)}function o(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n),s.TYPED_ARRAY_SUPPORT?(t=e).__proto__=s.prototype:t=l(t,e),t}(t,e,i,n):"string"==typeof e?function(t,e,i){if("string"==typeof i&&""!==i||(i="utf8"),!s.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|u(e,i),o=(t=r(t,n)).write(e,i);return o!==n&&(t=t.slice(0,o)),t}(t,e,i):function(t,e){if(s.isBuffer(e)){var i=0|c(e.length);return 0===(t=r(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?r(t,0):l(t,e);if("Buffer"===e.type&&z(e.data))return l(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(a(e),t=r(t,e<0?0:0|c(e)),!s.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function l(t,e){var i=e.length<0?0:0|c(e.length);t=r(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function c(t){if(t>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|t}function u(t,e){if(s.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return I(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return R(t).length;default:if(n)return I(t).length;e=(""+e).toLowerCase(),n=!0}}function f(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function d(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:p(t,e,i,n,r);if("number"==typeof e)return e&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):p(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function p(t,e,i,n,r){function s(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var o,a=1,h=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,h/=2,l/=2,i/=2}if(r){var c=-1;for(o=i;o<h;o++)if(s(t,o)===s(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(i+l>h&&(i=h-l),o=i;o>=0;o--){for(var u=!0,f=0;f<l;f++)if(s(t,o+f)!==s(e,f)){u=!1;break}if(u)return o}return-1}function g(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[i+o]=a}return o}function v(t,e,i,n){return F(I(e,t.length-i),t,i,n)}function m(t,e,i,n){return F(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function _(t,e,i,n){return m(t,e,i,n)}function y(t,e,i,n){return F(R(e),t,i,n)}function x(t,e,i,n){return F(function(t,e){for(var i,n,r,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(i=t.charCodeAt(o))>>8,r=i%256,s.push(r),s.push(n);return s}(e,t.length-i),t,i,n)}function b(t,e,i){return 0===e&&i===t.length?U.fromByteArray(t):U.fromByteArray(t.slice(e,i))}function w(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var s,o,a,h,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u<=i)switch(u){case 1:l<128&&(c=l);break;case 2:128==(192&(s=t[r+1]))&&(h=(31&l)<<6|63&s)>127&&(c=h);break;case 3:s=t[r+1],o=t[r+2],128==(192&s)&&128==(192&o)&&(h=(15&l)<<12|(63&s)<<6|63&o)>2047&&(h<55296||h>57343)&&(c=h);break;case 4:s=t[r+1],o=t[r+2],a=t[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(h=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&h<1114112&&(c=h)}null===c?(c=65533,u=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),r+=u}return function(t){var e=t.length;if(e<=G)return String.fromCharCode.apply(String,t);for(var i="",n=0;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=G));return i}(n)}function S(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function C(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function T(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",s=e;s<i;++s)r+=B(t[s]);return r}function k(t,e,i){for(var n=t.slice(e,i),r="",s=0;s<n.length;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}function E(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function A(t,e,i,n,r,o){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function M(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,s=Math.min(t.length-i,2);r<s;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function D(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,s=Math.min(t.length-i,4);r<s;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function O(t,e,i,n,r,s){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function L(t,e,i,n,r){return r||O(t,0,i,4),N.write(t,e,i,n,23,4),i+4}function P(t,e,i,n,r){return r||O(t,0,i,8),N.write(t,e,i,n,52,8),i+8}function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function I(t,e){e=e||1/0;for(var i,n=t.length,r=null,s=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function R(t){return U.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(X,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function F(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}var U=t("base64-js"),N=t("ieee754"),z=t("isarray");i.Buffer=s,i.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},i.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),i.kMaxLength=n(),s.poolSize=8192,s._augment=function(t){return t.__proto__=s.prototype,t},s.from=function(t,e,i){return o(null,t,e,i)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(t,e,i){return function(t,e,i,n){return a(e),e<=0?r(t,e):void 0!==i?"string"==typeof n?r(t,e).fill(i,n):r(t,e).fill(i):r(t,e)}(null,t,e,i)},s.allocUnsafe=function(t){return h(null,t)},s.allocUnsafeSlow=function(t){return h(null,t)},s.isBuffer=function(t){return!(null==t||!t._isBuffer)},s.compare=function(t,e){if(!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,o=Math.min(i,n);r<o;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!z(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=s.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r),r+=o.length}return n},s.byteLength=u,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)f(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)f(this,e,e+3),f(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)f(this,e,e+7),f(this,e+1,e+6),f(this,e+2,e+5),f(this,e+3,e+4);return this},s.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?w(this,0,t):function(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,i);case"utf8":case"utf-8":return w(this,e,i);case"ascii":return S(this,e,i);case"latin1":case"binary":return C(this,e,i);case"base64":return b(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",e=i.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},s.prototype.compare=function(t,e,i,n,r){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(this===t)return 0;for(var o=(r>>>=0)-(n>>>=0),a=(i>>>=0)-(e>>>=0),h=Math.min(o,a),l=this.slice(n,r),c=t.slice(e,i),u=0;u<h;++u)if(l[u]!==c[u]){o=l[u],a=c[u];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},s.prototype.indexOf=function(t,e,i){return d(this,t,e,i,!0)},s.prototype.lastIndexOf=function(t,e,i){return d(this,t,e,i,!1)},s.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return g(this,t,e,i);case"utf8":case"utf-8":return v(this,t,e,i);case"ascii":return m(this,t,e,i);case"latin1":case"binary":return _(this,t,e,i);case"base64":return y(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var G=4096;s.prototype.slice=function(t,e){var i,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),s.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=s.prototype;else{var r=e-t;i=new s(r,void 0);for(var o=0;o<r;++o)i[o]=this[o+t]}return i},s.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||E(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n},s.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||E(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},s.prototype.readUInt8=function(t,e){return e||E(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return e||E(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return e||E(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return e||E(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return e||E(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||E(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||E(t,e,this.length);for(var n=e,r=1,s=this[t+--n];n>0&&(r*=256);)s+=this[t+--n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},s.prototype.readInt8=function(t,e){return e||E(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){e||E(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},s.prototype.readInt16BE=function(t,e){e||E(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},s.prototype.readInt32LE=function(t,e){return e||E(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return e||E(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return e||E(t,4,this.length),N.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return e||E(t,4,this.length),N.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return e||E(t,8,this.length),N.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return e||E(t,8,this.length),N.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,i,n){t=+t,e|=0,i|=0,n||A(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,s=0;for(this[e]=255&t;++s<i&&(r*=256);)this[e+s]=t/r&255;return e+i},s.prototype.writeUIntBE=function(t,e,i,n){t=+t,e|=0,i|=0,n||A(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,s=1;for(this[e+r]=255&t;--r>=0&&(s*=256);)this[e+r]=t/s&255;return e+i},s.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,1,255,0),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},s.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},s.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):D(this,t,e,!0),e+4},s.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},s.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);A(this,t,e,i,r-1,-r)}var s=0,o=1,a=0;for(this[e]=255&t;++s<i&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},s.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);A(this,t,e,i,r-1,-r)}var s=i-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},s.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,1,127,-128),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},s.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},s.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):D(this,t,e,!0),e+4},s.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||A(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},s.prototype.writeFloatLE=function(t,e,i){return L(this,t,e,!0,i)},s.prototype.writeFloatBE=function(t,e,i){return L(this,t,e,!1,i)},s.prototype.writeDoubleLE=function(t,e,i){return P(this,t,e,!0,i)},s.prototype.writeDoubleBE=function(t,e,i){return P(this,t,e,!1,i)},s.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,o=n-i;if(this===t&&i<e&&e<n)for(r=o-1;r>=0;--r)t[r+e]=this[r+i];else if(o<1e3||!s.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+o),e);return o},s.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var o;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(o=e;o<i;++o)this[o]=t;else{var a=s.isBuffer(t)?t:I(new s(t,n).toString()),h=a.length;for(o=0;o<i-e;++o)this[o+e]=a[o%h]}return this};var X=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":30,ieee754:32,isarray:34}],30:[function(t,e,i){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function r(t){return o[t>>18&63]+o[t>>12&63]+o[t>>6&63]+o[63&t]}function s(t,e,i){for(var n,s=[],o=e;o<i;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],s.push(r(n));return s.join("")}i.byteLength=function(t){return 3*t.length/4-n(t)},i.toByteArray=function(t){var e,i,r,s,o,l,c=t.length;o=n(t),l=new h(3*c/4-o),r=o>0?c-4:c;var u=0;for(e=0,i=0;e<r;e+=4,i+=3)s=a[t.charCodeAt(e)]<<18|a[t.charCodeAt(e+1)]<<12|a[t.charCodeAt(e+2)]<<6|a[t.charCodeAt(e+3)],l[u++]=s>>16&255,l[u++]=s>>8&255,l[u++]=255&s;return 2===o?(s=a[t.charCodeAt(e)]<<2|a[t.charCodeAt(e+1)]>>4,l[u++]=255&s):1===o&&(s=a[t.charCodeAt(e)]<<10|a[t.charCodeAt(e+1)]<<4|a[t.charCodeAt(e+2)]>>2,l[u++]=s>>8&255,l[u++]=255&s),l},i.fromByteArray=function(t){for(var e,i=t.length,n=i%3,r="",a=[],h=16383,l=0,c=i-n;l<c;l+=h)a.push(s(t,l,l+h>c?c:l+h));return 1===n?(e=t[i-1],r+=o[e>>2],r+=o[e<<4&63],r+="=="):2===n&&(e=(t[i-2]<<8)+t[i-1],r+=o[e>>10],r+=o[e>>4&63],r+=o[e<<2&63],r+="="),a.push(r),a.join("")};for(var o=[],a=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,u=l.length;c<u;++c)o[c]=l[c],a[l.charCodeAt(c)]=c;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],31:[function(t,e,i){!function(t){function i(t){for(var e in o)t[e]=o[e];return t}function n(t,e){var i,o=this;if(arguments.length){if(e){if(i=r(o,t,!0)){if(!(i=i.filter(function(t){return t!==e&&t.originalListener!==e})).length)return n.call(o,t);o[s][t]=i}}else if((i=o[s])&&(delete i[t],!Object.keys(i).length))return n.call(o)}else delete o[s];return o}function r(t,e,i){if(!i||t[s]){var n=t[s]||(t[s]={});return n[e]||(n[e]=[])}}void 0!==e&&(e.exports=t);var s="listeners",o={on:function(t,e){return r(this,t).push(e),this},once:function(t,e){function i(){n.call(s,t,i),e.apply(this,arguments)}var s=this;return i.originalListener=e,r(s,t).push(i),s},off:n,emit:function(t,e){var i=this,n=r(i,t,!0);if(!n)return!1;var s=arguments.length;if(1===s)n.forEach(function(t){t.call(i)});else if(2===s)n.forEach(function(t){t.call(i,e)});else{var o=Array.prototype.slice.call(arguments,1);n.forEach(function(t){t.apply(i,o)})}return!!n.length}};i(t.prototype),t.mixin=i}(function t(){if(!(this instanceof t))return new t})},{}],32:[function(t,e,i){i.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,h=(1<<a)-1,l=h>>1,c=-7,u=i?r-1:0,f=i?-1:1,d=t[e+u];for(u+=f,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=256*s+t[e+u],u+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+t[e+u],u+=f,c-=8);if(0===s)s=1-l;else{if(s===h)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=l}return(d?-1:1)*o*Math.pow(2,s-n)},i.write=function(t,e,i,n,r,s){var o,a,h,l=8*s-r-1,c=(1<<l)-1,u=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+u>=1?f/h:f*Math.pow(2,1-u))*h>=2&&(o++,h/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*h-1)*Math.pow(2,r),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;t[i+d]=255&a,d+=p,a/=256,r-=8);for(o=o<<r|a,l+=r;l>0;t[i+d]=255&o,d+=p,o/=256,l-=8);t[i+d-p]|=128*g}},{}],33:[function(t,e,i){(function(t){!function(e){function i(t,i,y){function w(t,e,i,n){return this instanceof w?function(t,e,i,n,r){if(v&&m&&(e instanceof m&&(e=new v(e)),n instanceof m&&(n=new v(n))),e||i||n||d){if(!o(e,i))r=i,n=e,i=0,e=new(d||Array)(8);t.buffer=e,t.offset=i|=0,p!==typeof n&&("string"==typeof n?function(t,e,i,n){var r=0,s=i.length,o=0,a=0;"-"===i[0]&&r++;for(var h=r;r<s;){var l=parseInt(i[r++],n);if(!(l>=0))break;a=a*n+l,o=o*n+Math.floor(a/x),a%=x}h&&(o=~o,a?a=x-a:o++),C(t,e+k,o),C(t,e+E,a)}(e,i,n,r||10):o(n,r)?a(e,i,n,r):"number"==typeof r?(C(e,i+k,n),C(e,i+E,r)):n>0?L(e,i,n):n<0?P(e,i,n):a(e,i,_,0))}else t.buffer=h(_,0)}(this,t,e,i,n):new w(t,e,i,n)}function S(){var t=this.buffer,e=this.offset,i=T(t,e+k),n=T(t,e+E);return y||(i|=0),i?i*x+n:n}function C(t,e,i){t[e+O]=255&i,i>>=8,t[e+D]=255&i,i>>=8,t[e+M]=255&i,i>>=8,t[e+A]=255&i}function T(t,e){return t[e+A]*b+(t[e+M]<<16)+(t[e+D]<<8)+t[e+O]}var k=i?0:4,E=i?4:0,A=i?0:3,M=i?1:2,D=i?2:1,O=i?3:0,L=i?l:u,P=i?c:f,B=w.prototype,I="is"+t,R="_"+I;return B.buffer=void 0,B.offset=0,B[R]=!0,B.toNumber=S,B.toString=function(t){var e=this.buffer,i=this.offset,n=T(e,i+k),r=T(e,i+E),s="",o=!y&&2147483648&n;for(o&&(n=~n,r=x-r),t=t||10;;){var a=n%t*x+r;if(n=Math.floor(n/t),r=Math.floor(a/t),s=(a%t).toString(t)+s,!n&&!r)break}return o&&(s="-"+s),s},B.toJSON=S,B.toArray=n,g&&(B.toBuffer=r),v&&(B.toArrayBuffer=s),w[I]=function(t){return!(!t||!t[R])},e[t]=w,w}function n(t){var e=this.buffer,i=this.offset;return d=null,!1!==t&&0===i&&8===e.length&&y(e)?e:h(e,i)}function r(e){var i=this.buffer,n=this.offset;if(d=g,!1!==e&&0===n&&8===i.length&&t.isBuffer(i))return i;var r=new g(8);return a(r,0,i,n),r}function s(t){var e=this.buffer,i=this.offset,n=e.buffer;if(d=v,!1!==t&&0===i&&n instanceof m&&8===n.byteLength)return n;var r=new v(8);return a(r,0,e,i),r.buffer}function o(t,e){var i=t&&t.length;return e|=0,i&&e+8<=i&&"string"!=typeof t[e]}function a(t,e,i,n){e|=0,n|=0;for(var r=0;r<8;r++)t[e++]=255&i[n++]}function h(t,e){return Array.prototype.slice.call(t,e,e+8)}function l(t,e,i){for(var n=e+8;n>e;)t[--n]=255&i,i/=256}function c(t,e,i){var n=e+8;for(i++;n>e;)t[--n]=255&-i^255,i/=256}function u(t,e,i){for(var n=e+8;e<n;)t[e++]=255&i,i/=256}function f(t,e,i){var n=e+8;for(i++;e<n;)t[e++]=255&-i^255,i/=256}var d,p="undefined",g=p!==typeof t&&t,v=p!==typeof Uint8Array&&Uint8Array,m=p!==typeof ArrayBuffer&&ArrayBuffer,_=[0,0,0,0,0,0,0,0],y=Array.isArray||function(t){return!!t&&"[object Array]"==Object.prototype.toString.call(t)},x=4294967296,b=16777216;i("Uint64BE",!0,!0),i("Int64BE",!0,!1),i("Uint64LE",!1,!0),i("Int64LE",!1,!1)}("object"==typeof i&&"string"!=typeof i.nodeName?i:this||{})}).call(this,t("buffer").Buffer)},{buffer:29}],34:[function(t,e,i){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}]},{},[1])(1)}),Logger={info:function(){},error:function(){}},MakeIncremental=function(){},MakeIncremental.prototype={getSceneIncrementalFiles:function(t,e,i){var n=[],r={useDraco:i.useDraco||!1,dracoEncodingSpeed:i.dracoEncodingSpeed||5,dracoDecodingSpeed:i.dracoDecodingSpeed||5},s=i.excludedMeshes||[],o=this;t.autoClear=!0;var a=[];t.meshes.forEach(function(t){if(!s.some(function(e){return e.test(t.name)})){if(t.subMeshes&&t.subMeshes.length>1)return void(t.geometryId&&a.push(t.geometryId));if(t.checkCollisions)t.geometryId&&a.push(t.geometryId);else{var i=o.extractIncrementalFile(e,t,!0,r);i&&n.push(i)}}});var h=t.geometries;if(h&&h.vertexData.forEach(function(t){var i=t.id;if(!a.some(function(t){return t===i})){var s=o.extractIncrementalFile(e,t,!1,r);s&&n.push(s)}}),t.metadata&&t.metadata.delayedMaterials)for(var l=Object.keys(t.metadata.delayedMaterials),c=0;c<t.materials.length;c++){var u=t.materials[c];if(l.includes(u.id)){var f=t.metadata.delayedMaterials[u.id],d=o.extractIncrementalMaterialFile(e,u,f.file);d&&(n.push(d),t.materials.splice(c--,1))}}if(t.metadata&&t.metadata.offloadedMaterials)for(var p=Object.keys(t.metadata.offloadedMaterials),g=0;g<t.materials.length;g++){var v=t.materials[g];if(p.includes(v.id)){var m=t.metadata.offloadedMaterials[v.id];m&&m.data&&t.materials.splice(g--,1)}}var _=new Zakeke.IncrementalFileInfo;return _.name="scene_"+e+".incremental.babylon",_.isScene=!0,_.dracoEncoded=!1,_.data=JSON.stringify(t,null,0),n.push(_),n},extractIncrementalFile:function(t,e,i,n){var r=null;if(Logger.info(e.name),e.positions&&e.normals&&e.indices&&(r=this.createDelayLoadingFile(t,e,i,n))&&r.data){e.delayLoadingFile=r.name,Logger.info("Delay loading file: "+e.delayLoadingFile);for(var s=e.positions.map(function(t){return parseFloat(t)}),o=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],a=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],h=0;h<s.length;h+=3){var l=s[h],c=s[h+1],u=s[h+2];l<o[0]&&(o[0]=l),l>a[0]&&(a[0]=l),c<o[1]&&(o[1]=c),c>a[1]&&(a[1]=c),u<o[2]&&(o[2]=u),u>a[2]&&(a[2]=u)}e.boundingBoxMinimum=o,e.boundingBoxMaximum=a,e.positions=null,e.normals=null,e.indices=null,e.uvs&&(e.hasUVs=!0,e.uvs=null),e.uv2s&&(e.hasUVs2=!0,e.uv2s=null),e.colors&&(e.hasColors=!0,e.colors=null),e.tangents&&(e.hasTangents=!0,e.tangents=null),e.matricesIndices&&(e.hasMatricesIndices=!0,e.matricesIndices=null),e.matricesWeights&&(e.hasMatricesWeights=!0,e.matricesWeights=null),i&&e.subMeshes&&(e.subMeshes=null)}return r&&r.data?r:null},createDelayLoadingFile:function(t,e,i,n){var r=new Zakeke.IncrementalFileInfo;r.isScene=!1;var s=n.useDraco&&!i&&!(e.matricesIndices||e.matricesWeights)&&e.indices.length>0&&e.positions.length>0&&e.normals.length>0;r.dracoEncoded=s;var o=(i?e.name:e.id).replace("+","_").replace(" ","_"),a=s?"draco":"";return r.name="scene_"+t+"."+o+(i?".babylonmesh"+a+"data":".babylongeometry"+a+"data"),r.data=s?this.createDracoDelayLoadingFileData(e,n):this.createPlainDelayLoadingFileData(e,i),r},createPlainDelayLoadingFileData:function(t,e){var i={positions:t.positions,indices:t.indices,normals:t.normals};return t.uvs&&(i.uvs=t.uvs),t.uv2s&&(i.uv2s=t.uv2s),t.colors&&(i.colors=t.colors),t.tangents&&(i.tangents=t.tangents),t.matricesIndices&&(i.matricesIndices=t.matricesIndices),t.matricesWeights&&(i.matricesWeights=t.matricesWeights),e&&t.subMeshes&&(i.subMeshes=t.subMeshes),JSON.stringify(i,null,0)},createDracoDelayLoadingFileData:function(t,e){var i=(new Date).getTime(),n=this.getDracoEncodedGeometry(t,e),r=(new Date).getTime()-i;if(Logger.info("Draco Encoding - "+t.id+"\t"+r+" ms"),n){var s={type:"draco",data:n.data,attributes:n.attributes};return msgpack.encode(s)}return null},getDracoEncodedGeometry:function(t,e){if(!t)return null;var i=t.positions,n=t.normals,r=t.tangents,s=t.colors,o=t.uvs,a=t.uv2s,h=t.uv3s,l=t.uv4s,c=t.uv5s,u=t.uv6s,f=t.indices;const d={indices:new Uint32Array(f),positions:new Float32Array(i),normals:new Float32Array(n)};r&&(d.tangents=new Float32Array(r)),o&&(d.uvs=new Float32Array(o)),a&&(d.uv2s=new Float32Array(a)),h&&(d.uv3s=new Float32Array(h)),l&&(d.uv4s=new Float32Array(l)),c&&(d.uv5s=new Float32Array(c)),u&&(d.uv6s=new Float32Array(u)),s&&(d.colors=new Float32Array(s));const p=DracoEncoderModule(),g=new p.Encoder,v=new p.MeshBuilder,m=new p.Mesh,_=d.indices.length/3,y=d.positions.length/3,x={};v.AddFacesToMesh(m,_,d.indices),x.position=v.AddFloatAttributeToMesh(m,p.POSITION,y,3,d.positions),d.normals&&(x.normal=v.AddFloatAttributeToMesh(m,p.NORMAL,y,3,d.normals)),d.tangents&&(x.tangent=v.AddFloatAttributeToMesh(m,p.GENERIC,y,3,d.tangents)),d.colors&&(x.color=v.AddFloatAttributeToMesh(m,p.COLOR,y,4,d.colors)),d.uvs&&(x.uv=v.AddFloatAttributeToMesh(m,p.TEX_COORD,y,2,d.uvs)),d.uv2s&&(x.uv2=v.AddFloatAttributeToMesh(m,p.TEX_COORD,y,2,d.uv2s)),d.uv2s&&d.uv3s&&(x.uv3=v.AddFloatAttributeToMesh(m,p.TEX_COORD,y,2,d.uv3s)),d.uv2s&&d.uv3s&&d.uv4s&&(x.uv4=v.AddFloatAttributeToMesh(m,p.TEX_COORD,y,2,d.uv4s)),d.uv2s&&d.uv3s&&d.uv4s&&d.uv5s&&(x.uv5=v.AddFloatAttributeToMesh(m,p.TEX_COORD,y,2,d.uv5s)),d.uv2s&&d.uv3s&&d.uv4s&&d.uv5s&&d.uv6s&&(x.uv6=v.AddFloatAttributeToMesh(m,p.TEX_COORD,y,2,d.uv6s)),g.SetSpeedOptions(e.dracoEncodingSpeed,e.dracoDecodingSpeed),g.SetAttributeQuantization(p.POSITION,14),g.SetAttributeQuantization(p.TEX_COORD,12),g.SetAttributeQuantization(p.NORMAL,10),g.SetAttributeQuantization(p.COLOR,10),g.SetAttributeQuantization(p.GENERIC,10),g.SetEncodingMethod(p.MESH_EDGEBREAKER_ENCODING);const b=new p.DracoInt8Array,w=g.EncodeMeshToDracoBuffer(m,b);var S=new ArrayBuffer(w),C=new Int8Array(S);for(let t=0;t<w;++t)C[t]=b.GetValue(t);return p.destroy(m),p.destroy(b),p.destroy(g),p.destroy(v),{attributes:x,data:S}},extractIncrementalMaterialFile:function(t,e,i){Logger.info("Extracting material "+e.id);var n=this.createDelayLoadingMaterialFile(t,e,i);return Logger.info("Delay loading material file: "+n.name),n},createDelayLoadingMaterialFile:function(t,e,i){var n=new Zakeke.IncrementalFileInfo;return n.isScene=!1,n.dracoEncoded=!1,n.name=i,n.data=this.createMaterialFileData(e),n},createMaterialFileData:function(t){return JSON.stringify(t,null,0)}},function(t,e,i,n){"use strict";function r(t,e,i){return setTimeout(l(t,i),e)}function s(t,e,i){return!!Array.isArray(t)&&(o(t,i[e],i),!0)}function o(t,e,i){var r;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==n)for(r=0;r<t.length;)e.call(i,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r,t)}function a(e,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=t.console&&(t.console.warn||t.Logger.info);return s&&s.call(t.console,r,n),e.apply(this,arguments)}}function h(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&$(n,i)}function l(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return typeof t==it?t.apply(e&&e[0]||n,e):t}function u(t,e){return t===n?e:t}function f(t,e,i){o(v(e),function(e){t.addEventListener(e,i,!1)})}function d(t,e,i){o(v(e),function(e){t.removeEventListener(e,i,!1)})}function p(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function g(t,e){return t.indexOf(e)>-1}function v(t){return t.trim().split(/\s+/g)}function m(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function _(t){return Array.prototype.slice.call(t,0)}function y(t,e,i){for(var n=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];m(r,o)<0&&n.push(t[s]),r[s]=o,s++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function x(t,e){for(var i,r,s=e[0].toUpperCase()+e.slice(1),o=0;o<tt.length;){if((r=(i=tt[o])?i+s:e)in t)return r;o++}return n}function b(e){var i=e.ownerDocument||e;return i.defaultView||i.parentWindow||t}function w(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){c(t.options.enable,[t])&&i.handler(e)},this.init()}function S(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&gt&&n-r==0,o=e&(vt|mt)&&n-r==0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=T(e)),r>1&&!i.firstMultiple?i.firstMultiple=T(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,a=o?o.center:s.center,h=e.center=k(n);e.timeStamp=st(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=D(a,h),e.distance=M(a,h),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==gt&&s.eventType!==vt||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=A(e.deltaX,e.deltaY);var l=E(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=rt(l.x)>rt(l.y)?l.x:l.y,e.scale=o?function(t,e){return M(e[0],e[1],Et)/M(t[0],t[1],Et)}(o.pointers,n):1,e.rotation=o?function(t,e){return D(e[1],e[0],Et)+D(t[1],t[0],Et)}(o.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,C(i,e);var c=t.element;p(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function C(t,e){var i,r,s,o,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(e.eventType!=mt&&(h>pt||a.velocity===n)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,u=E(h,l,c);r=u.x,s=u.y,i=rt(u.x)>rt(u.y)?u.x:u.y,o=A(l,c),t.lastInterval=e}else i=a.velocity,r=a.velocityX,s=a.velocityY,o=a.direction;e.velocity=i,e.velocityX=r,e.velocityY=s,e.direction=o}function T(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:nt(t.pointers[i].clientX),clientY:nt(t.pointers[i].clientY)},i++;return{timeStamp:st(),pointers:e,center:k(e),deltaX:t.deltaX,deltaY:t.deltaY}}function k(t){var e=t.length;if(1===e)return{x:nt(t[0].clientX),y:nt(t[0].clientY)};for(var i=0,n=0,r=0;e>r;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:nt(i/e),y:nt(n/e)}}function E(t,e,i){return{x:e/t||0,y:i/t||0}}function A(t,e){return t===e?_t:rt(t)>=rt(e)?0>t?yt:xt:0>e?bt:wt}function M(t,e,i){i||(i=kt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function D(t,e,i){i||(i=kt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function O(){this.evEl=Mt,this.evWin=Dt,this.pressed=!1,w.apply(this,arguments)}function L(){this.evEl=Pt,this.evWin=Bt,w.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function P(){this.evTarget=Rt,this.evWin=Ft,this.started=!1,w.apply(this,arguments)}function B(){this.evTarget=Nt,this.targetIds={},w.apply(this,arguments)}function I(){w.apply(this,arguments);var t=l(this.handler,this);this.touch=new B(this.manager,t),this.mouse=new O(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function R(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)},zt)}}function F(t,e){this.manager=t,this.set(e)}function U(t){this.options=$({},this.defaults,t||{}),this.id=ht++,this.manager=null,this.options.enable=u(this.options.enable,!0),this.state=qt,this.simultaneous={},this.requireFail=[]}function N(t){return t&te?"cancel":t&Qt?"end":t&Jt?"move":t&Kt?"start":""}function z(t){return t==wt?"down":t==bt?"up":t==yt?"left":t==xt?"right":""}function G(t,e){var i=e.manager;return i?i.get(t):t}function X(){U.apply(this,arguments)}function Y(){X.apply(this,arguments),this.pX=null,this.pY=null}function W(){X.apply(this,arguments)}function j(){U.apply(this,arguments),this._timer=null,this._input=null}function Z(){X.apply(this,arguments)}function H(){X.apply(this,arguments)}function V(){U.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function q(t,e){return(e=e||{}).recognizers=u(e.recognizers,q.defaults.preset),new K(t,e)}function K(t,e){this.options=$({},q.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){return new(t.options.inputClass||(ct?L:ut?B:lt?I:O))(t,S)}(this),this.touchAction=new F(this,this.options.touchAction),J(this,!0),o(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function J(t,e){var i,n=t.element;n.style&&(o(t.options.cssProps,function(r,s){i=x(n.style,s),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={}))}function Q(t,i){var n=e.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var $,tt=["","webkit","Moz","MS","ms","o"],et=e.createElement("div"),it="function",nt=Math.round,rt=Math.abs,st=Date.now;$="function"!=typeof Object.assign?function(t){if(t===n||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==n&&null!==r)for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])}return e}:Object.assign;var ot=a(function(t,e,i){for(var r=Object.keys(e),s=0;s<r.length;)(!i||i&&t[r[s]]===n)&&(t[r[s]]=e[r[s]]),s++;return t},"extend","Use `assign`."),at=a(function(t,e){return ot(t,e,!0)},"merge","Use `assign`."),ht=1,lt="ontouchstart"in t,ct=x(t,"PointerEvent")!==n,ut=lt&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),ft="touch",dt="mouse",pt=25,gt=1,vt=4,mt=8,_t=1,yt=2,xt=4,bt=8,wt=16,St=yt|xt,Ct=bt|wt,Tt=St|Ct,kt=["x","y"],Et=["clientX","clientY"];w.prototype={handler:function(){},init:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(b(this.element),this.evWin,this.domHandler)}};var At={mousedown:gt,mousemove:2,mouseup:vt},Mt="mousedown",Dt="mousemove mouseup";h(O,w,{handler:function(t){var e=At[t.type];e&gt&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=vt),this.pressed&&(e&vt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:dt,srcEvent:t}))}});var Ot={pointerdown:gt,pointermove:2,pointerup:vt,pointercancel:mt,pointerout:mt},Lt={2:ft,3:"pen",4:dt,5:"kinect"},Pt="pointerdown",Bt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Pt="MSPointerDown",Bt="MSPointerMove MSPointerUp MSPointerCancel"),h(L,w,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Ot[n],s=Lt[t.pointerType]||t.pointerType,o=s==ft,a=m(e,t.pointerId,"pointerId");r&gt&&(0===t.button||o)?0>a&&(e.push(t),a=e.length-1):r&(vt|mt)&&(i=!0),0>a||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var It={touchstart:gt,touchmove:2,touchend:vt,touchcancel:mt},Rt="touchstart",Ft="touchstart touchmove touchend touchcancel";h(P,w,{handler:function(t){var e=It[t.type];if(e===gt&&(this.started=!0),this.started){var i=function(t,e){var i=_(t.touches),n=_(t.changedTouches);return e&(vt|mt)&&(i=y(i.concat(n),"identifier",!0)),[i,n]}.call(this,t,e);e&(vt|mt)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:ft,srcEvent:t})}}});var Ut={touchstart:gt,touchmove:2,touchend:vt,touchcancel:mt},Nt="touchstart touchmove touchend touchcancel";h(B,w,{handler:function(t){var e=Ut[t.type],i=function(t,e){var i=_(t.touches),n=this.targetIds;if(e&(2|gt)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=_(t.changedTouches),a=[],h=this.target;if(s=i.filter(function(t){return p(t.target,h)}),e===gt)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;for(r=0;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(vt|mt)&&delete n[o[r].identifier],r++;return a.length?[y(s.concat(a),"identifier",!0),a]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:ft,srcEvent:t})}});var zt=2500;h(I,w,{handler:function(t,e,i){var n=i.pointerType==ft,r=i.pointerType==dt;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&gt?(this.primaryTouch=e.changedPointers[0].identifier,R.call(this,e)):t&(vt|mt)&&R.call(this,e)}).call(this,e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],s=Math.abs(e-r.x),o=Math.abs(i-r.y);if(25>=s&&25>=o)return!0}return!1}.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Gt=x(et.style,"touchAction"),Xt=Gt!==n,Yt="compute",Wt="manipulation",jt="none",Zt="pan-x",Ht="pan-y",Vt=function(){if(!Xt)return!1;var e={},i=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!i||t.CSS.supports("touch-action",n)}),e}();F.prototype={set:function(t){t==Yt&&(t=this.compute()),Xt&&this.manager.element.style&&Vt[t]&&(this.manager.element.style[Gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return o(this.manager.recognizers,function(e){c(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(g(t,jt))return jt;var e=g(t,Zt),i=g(t,Ht);return e&&i?jt:e||i?e?Zt:Ht:g(t,Wt)?Wt:"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(!this.manager.session.prevented){var n=this.actions,r=g(n,jt)&&!Vt[jt],s=g(n,Ht)&&!Vt[Ht],o=g(n,Zt)&&!Vt[Zt];if(r){var a=1===t.pointers.length,h=t.distance<2,l=t.deltaTime<250;if(a&&h&&l)return}return o&&s?void 0:r||s&&i&St||o&&i&Ct?this.preventSrc(e):void 0}e.preventDefault()},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var qt=1,Kt=2,Jt=4,Qt=8,$t=Qt,te=16;U.prototype={defaults:{},set:function(t){return $(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=G(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)?this:(t=G(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return-1===m(e,t=G(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=G(t,this);var e=m(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(e,t)}var i=this,n=this.state;Qt>n&&e(i.options.event+N(n)),e(i.options.event),t.additionalEvent&&e(t.additionalEvent),n>=Qt&&e(i.options.event+N(n))},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|qt)))return!1;t++}return!0},recognize:function(t){var e=$({},t);return c(this.options.enable,[this,e])?(this.state&($t|te|32)&&(this.state=qt),this.state=this.process(e),void(this.state&(Kt|Jt|Qt|te)&&this.tryEmit(e))):(this.reset(),void(this.state=32))},process:function(t){},getTouchAction:function(){},reset:function(){}},h(X,U,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Kt|Jt),r=this.attrTest(t);return n&&(i&mt||!r)?e|te:n||r?i&vt?e|Qt:e&Kt?e|Jt:Kt:32}}),h(Y,X,{defaults:{event:"pan",threshold:10,pointers:1,direction:Tt},getTouchAction:function(){var t=this.options.direction,e=[];return t&St&&e.push(Ht),t&Ct&&e.push(Zt),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&St?(r=0===s?_t:0>s?yt:xt,i=s!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?_t:0>o?bt:wt,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return X.prototype.attrTest.call(this,t)&&(this.state&Kt||!(this.state&Kt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=z(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),h(W,X,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Kt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),h(j,U,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(vt|mt)&&!s)this.reset();else if(t.eventType&gt)this.reset(),this._timer=r(function(){this.state=$t,this.tryEmit()},e.time,this);else if(t.eventType&vt)return $t;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===$t&&(t&&t.eventType&vt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=st(),this.manager.emit(this.options.event,this._input)))}}),h(Z,X,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Kt)}}),h(H,X,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:St|Ct,pointers:1},getTouchAction:function(){return Y.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(St|Ct)?e=t.overallVelocity:i&St?e=t.overallVelocityX:i&Ct&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&rt(e)>this.options.velocity&&t.eventType&vt},emit:function(t){var e=z(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),h(V,U,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Wt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&gt&&0===this.count)return this.failTimeout();if(n&&s&&i){if(t.eventType!=vt)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||M(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=$t,this.tryEmit()},e.interval,this),Kt):$t}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==$t&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),q.VERSION="2.0.8",q.defaults={domEvents:!1,touchAction:Yt,enable:!0,inputTarget:null,inputClass:null,preset:[[Z,{enable:!1}],[W,{enable:!1},["rotate"]],[H,{direction:St}],[Y,{direction:St},["swipe"]],[V],[V,{event:"doubletap",taps:2},["tap"]],[j]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},K.prototype={set:function(t){return $(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&$t)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Kt|Jt|Qt)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof U)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=m(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==n&&e!==n){var i=this.handlers;return o(v(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==n){var i=this.handlers;return o(v(t),function(t){e?i[t]&&i[t].splice(m(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&Q(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&J(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},$(q,{INPUT_START:gt,INPUT_MOVE:2,INPUT_END:vt,INPUT_CANCEL:mt,STATE_POSSIBLE:qt,STATE_BEGAN:Kt,STATE_CHANGED:Jt,STATE_ENDED:Qt,STATE_RECOGNIZED:$t,STATE_CANCELLED:te,STATE_FAILED:32,DIRECTION_NONE:_t,DIRECTION_LEFT:yt,DIRECTION_RIGHT:xt,DIRECTION_UP:bt,DIRECTION_DOWN:wt,DIRECTION_HORIZONTAL:St,DIRECTION_VERTICAL:Ct,DIRECTION_ALL:Tt,Manager:K,Input:w,TouchAction:F,TouchInput:B,MouseInput:O,PointerEventInput:L,TouchMouseInput:I,SingleTouchInput:P,Recognizer:U,AttrRecognizer:X,Tap:V,Pan:Y,Swipe:H,Pinch:W,Rotate:Z,Press:j,on:f,off:d,each:o,merge:at,extend:ot,assign:$,inherit:h,bindFn:l,prefixed:x}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=q,"function"==typeof define&&define.amd?define(function(){return q}):"undefined"!=typeof module&&module.exports?module.exports=q:t.Hammer=q}(window,document),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).earcut=t()}(function(){return function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){return r(e[o][1][t]||t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,s,a,h,l,c,f,d=e&&e.length,p=d?e[0]*i:t.length,g=r(t,0,p,i,!0),v=[];if(!g)return v;if(d&&(g=u(t,e,g,i)),t.length>80*i){n=a=t[0],s=h=t[1];for(var m=i;p>m;m+=i)n>(l=t[m])&&(n=l),s>(c=t[m+1])&&(s=c),l>a&&(a=l),c>h&&(h=c);f=Math.max(a-n,h-s)}return o(g,v,i,n,s,f),v}function r(t,e,i,n,r){var s,o;if(r===E(t,e,i,n)>0)for(s=e;i>s;s+=n)o=C(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=C(s,t[s],t[s+1],o);return o&&x(o,o.next)&&(T(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!x(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(T(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function o(t,e,i,n,r,u,f){if(t){!f&&u&&p(t,n,r,u);for(var d,g,v=t;t.prev!==t.next;)if(d=t.prev,g=t.next,u?h(t,n,r,u):a(t))e.push(d.i/i),e.push(t.i/i),e.push(g.i/i),T(t),t=g.next,v=g.next;else if((t=g)===v){f?1===f?o(t=l(t,e,i),e,i,n,r,u,2):2===f&&c(t,e,i,n,r,u):o(s(t),e,i,n,r,u,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(y(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(m(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function h(t,e,i,n){var r=t.prev,s=t,o=t.next;if(y(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,h=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,l=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,c=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=g(a,h,e,i,n),f=g(l,c,e,i,n),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&m(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&y(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&m(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&y(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function l(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!x(r,s)&&b(r,n,n.next,s)&&w(r,s)&&w(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),T(n),T(n.next),n=t=s),n=n.next}while(n!==t);return n}function c(t,e,i,n,r,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&_(h,l)){var c=S(h,l);return h=s(h,h.next),c=s(c,c.next),o(h,e,i,n,r,a),void o(c,e,i,n,r,a)}l=l.next}h=h.next}while(h!==t)}function u(t,e,i,n){var o,a,h,l=[];for(o=0,a=e.length;a>o;o++)(h=r(t,e[o]*n,a-1>o?e[o+1]*n:t.length,n,!1))===h.next&&(h.steiner=!0),l.push(v(h));for(l.sort(f),o=0;o<l.length;o++)d(l[o],i),i=s(i,i.next);return i}function f(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(r>=a&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i.prev;var h,l=i,c=i.x,u=i.y,f=1/0;for(n=i.next;n!==l;)r>=n.x&&n.x>=c&&m(u>s?r:o,s,c,u,u>s?o:r,s,n.x,n.y)&&((f>(h=Math.abs(s-n.y)/(r-n.x))||h===f&&n.x>i.x)&&w(n,t)&&(i=n,f=h)),n=n.next;return i}(t,e)){var i=S(e,t);s(i,i.next)}}function p(t,e,i,n){var r=t;do{null===r.z&&(r.z=g(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,h,l=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;l>e&&(a++,n=n.nextZ);e++);for(h=l;a>0||h>0&&n;)0===a?(r=n,n=n.nextZ,h--):0!==h&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,h--):(r=i,i=i.nextZ,a--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,l*=2}while(o>1)}(r)}function g(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function _(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&b(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&w(t,e)&&w(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,i,n){return!!(x(t,e)&&x(i,n)||x(t,n)&&x(i,e))||y(t,e,i)>0!=y(t,e,n)>0&&y(i,n,t)>0!=y(i,n,e)>0}function w(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function S(t,e){var i=new k(t.i,t.x,t.y),n=new k(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function C(t,e,i,n){var r=new k(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function k(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,i,n){for(var r=0,s=e,o=i-n;i>s;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}e.exports=n,n.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(E(t,0,s,i));if(r)for(var a=0,h=e.length;h>a;a++){var l=e[a]*i,c=h-1>a?e[a+1]*i:t.length;o-=Math.abs(E(t,l,c,i))}var u=0;for(a=0;a<n.length;a+=3){var f=n[a]*i,d=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;e>o;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}]},{},[1])(1)}),function(){"use strict";var t=function(e){if(!(this instanceof t))return new t(e);if(this.version=1,this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),!this.support)return!1;var i=this;i.files=[],i.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",chunkNumberParameterName:"resumableChunkNumber",chunkSizeParameterName:"resumableChunkSize",currentChunkSizeParameterName:"resumableCurrentChunkSize",totalSizeParameterName:"resumableTotalSize",typeParameterName:"resumableType",identifierParameterName:"resumableIdentifier",fileNameParameterName:"resumableFilename",relativePathParameterName:"resumableRelativePath",totalChunksParameterName:"resumableTotalChunks",dragOverClass:"dragover",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,preprocessFile:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",testTarget:null,parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:100,chunkRetryInterval:void 0,permanentErrors:[400,401,403,404,409,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,clearInput:!0,chunkFormat:"blob",setChunkTypeFromFile:!1,maxFilesErrorCallback:function(t,e){var n=i.getOpt("maxFiles");alert("Please upload no more than "+n+" file"+(1===n?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(t,e){alert(t.fileName||t.name+"is too small, please upload files larger than "+n.formatSize(i.getOpt("minFileSize"))+".File size:"+t.size+" - File type:"+t.type+" - File object type:"+typeof t)},maxFileSize:void 0,maxFileSizeErrorCallback:function(t,e){alert(t.fileName||t.name+" is too large, please upload files less than "+n.formatSize(i.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(t,e){alert(t.fileName||t.name+" has type not allowed, please upload files of type "+i.getOpt("fileType")+".")}},i.opts=e||{},i.getOpt=function(e){var i=this;if(e instanceof Array){var r={};return n.each(e,function(t){r[t]=i.getOpt(t)}),r}if(i instanceof u){if(void 0!==i.opts[e])return i.opts[e];i=i.fileObj}if(i instanceof c){if(void 0!==i.opts[e])return i.opts[e];i=i.resumableObj}if(i instanceof t)return void 0!==i.opts[e]?i.opts[e]:i.defaults[e]},i.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},i.events=[],i.on=function(t,e){i.events.push(t.toLowerCase(),e)},i.fire=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var n=t[0].toLowerCase();for(e=0;e<=i.events.length;e+=2)i.events[e]==n&&i.events[e+1].apply(i,t.slice(1)),"catchall"==i.events[e]&&i.events[e+1].apply(null,t);"fileerror"==n&&i.fire("error",t[2],t[1]),"fileprogress"==n&&i.fire("progress")};var n={stopEvent:function(t){t.stopPropagation(),t.preventDefault()},each:function(t,e){if(void 0!==t.length){for(var i=0;i<t.length;i++)if(!1===e(t[i]))return}else for(i in t)if(!1===e(i,t[i]))return},generateUniqueIdentifier:function(t,e){var n=i.getOpt("generateUniqueIdentifier");if("function"==typeof n)return n(t,e);var r=t.webkitRelativePath||t.relativePath||t.fileName||t.name;return t.size+"-"+r.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(t,e){var i=!1;return n.each(t,function(t){return t!=e||(i=!0,!1)}),i},formatSize:function(t){return t<1024?t+" bytes":t<1048576?(t/1024).toFixed(0)+" KB":t<1073741824?(t/1024/1024).toFixed(1)+" MB":(t/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(t,e){var n=i.getOpt("target");if("test"===t&&i.getOpt("testTarget")&&(n="/"===i.getOpt("testTarget")?i.getOpt("target"):i.getOpt("testTarget")),"function"==typeof n)return n(e);var r=n.indexOf("?")<0?"?":"&",s=e.join("&");return s&&(n=n+r+s),n}},r=function(t){t.currentTarget.classList.remove(i.getOpt("dragOverClass")),n.stopEvent(t),t.dataTransfer&&t.dataTransfer.items?h(t.dataTransfer.items,t):t.dataTransfer&&t.dataTransfer.files&&h(t.dataTransfer.files,t)},s=function(t){t.currentTarget.classList.remove(i.getOpt("dragOverClass"))},o=function(t){t.preventDefault();var e=t.dataTransfer;i.indexOf(e.types,"Files")>=0?(t.stopPropagation(),e.dropEffect="copy",e.effectAllowed="copy",t.currentTarget.classList.add(i.getOpt("dragOverClass"))):(e.dropEffect="none",e.effectAllowed="none")};function a(t,e){if(!t||0===t.length)return e();t[0](function(){a(t.slice(1),e)})}function h(t,e){if(t.length){i.fire("beforeAdd");var n=[];a(Array.prototype.map.call(t,function(t){var e=t;return"function"==typeof t.webkitGetAsEntry&&(e=t.webkitGetAsEntry()),function t(e,i,n,r){var s;return e.isFile?e.file(function(t){t.relativePath=i+t.name,n.push(t),r()}):(e.isDirectory?s=e:e instanceof File&&n.push(e),"function"==typeof e.webkitGetAsEntry&&(s=e.webkitGetAsEntry()),s&&s.isDirectory?function(e,i,n,r){var s=e.createReader(),o=[];!function e(){s.readEntries(function(s){if(s.length)return o=o.concat(s),e();a(o.map(function(e){return t.bind(null,e,i,n)}),r)})}()}(s,i+s.name+"/",n,r):("function"==typeof e.getAsFile&&(e=e.getAsFile())instanceof File&&(e.relativePath=i+e.name,n.push(e)),void r()))}.bind(null,e,"",n)}),function(){n.length&&l(n,e)})}}var l=function(t,e){var r=0,s=i.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(void 0!==s.maxFiles&&s.maxFiles<t.length+i.files.length){if(1!==s.maxFiles||1!==i.files.length||1!==t.length)return s.maxFilesErrorCallback(t,r++),!1;i.removeFile(i.files[0])}var o=[],a=[],h=t.length,l=function(){if(!--h){if(!o.length&&!a.length)return;window.setTimeout(function(){i.fire("filesAdded",o,a)},0)}};n.each(t,function(t){var h=t.name,u=t.type;if(s.fileType.length>0){var f=!1;for(var d in s.fileType){s.fileType[d]=s.fileType[d].replace(/\s/g,"").toLowerCase();var p=(s.fileType[d].match(/^[^.][^/]+$/)?".":"")+s.fileType[d];if(h.substr(-1*p.length).toLowerCase()===p||-1!==p.indexOf("/")&&(-1!==p.indexOf("*")&&u.substr(0,p.indexOf("*"))===p.substr(0,p.indexOf("*"))||u===p)){f=!0;break}}if(!f)return s.fileTypeErrorCallback(t,r++),!0}if(void 0!==s.minFileSize&&t.size<s.minFileSize)return s.minFileSizeErrorCallback(t,r++),!0;if(void 0!==s.maxFileSize&&t.size>s.maxFileSize)return s.maxFileSizeErrorCallback(t,r++),!0;function g(n){i.getFromUniqueIdentifier(n)?a.push(t):function(){t.uniqueIdentifier=n;var r=new c(i,t,n);i.files.push(r),o.push(r),r.container=void 0!==e?e.srcElement:null,window.setTimeout(function(){i.fire("fileAdded",r,e)},0)}(),l()}var v=n.generateUniqueIdentifier(t,e);v&&"function"==typeof v.then?v.then(function(t){g(t)},function(){l()}):g(v)})};function c(t,e,i){var r=this;r.opts={},r.getOpt=t.getOpt,r._prevProgress=0,r.resumableObj=t,r.file=e,r.fileName=e.fileName||e.name,r.size=e.size,r.relativePath=e.relativePath||e.webkitRelativePath||r.fileName,r.uniqueIdentifier=i,r._pause=!1,r.container="",r.preprocessState=0;var s=void 0!==i,o=function(t,e){switch(t){case"progress":r.resumableObj.fire("fileProgress",r,e);break;case"error":r.abort(),s=!0,r.chunks=[],r.resumableObj.fire("fileError",r,e);break;case"success":if(s)return;r.resumableObj.fire("fileProgress",r,e),r.isComplete()&&r.resumableObj.fire("fileSuccess",r,e);break;case"retry":r.resumableObj.fire("fileRetry",r)}};return r.chunks=[],r.abort=function(){var t=0;n.each(r.chunks,function(e){"uploading"==e.status()&&(e.abort(),t++)}),t>0&&r.resumableObj.fire("fileProgress",r)},r.cancel=function(){var t=r.chunks;r.chunks=[],n.each(t,function(t){"uploading"==t.status()&&(t.abort(),r.resumableObj.uploadNextChunk())}),r.resumableObj.removeFile(r),r.resumableObj.fire("fileProgress",r)},r.retry=function(){r.bootstrap();var t=!1;r.resumableObj.on("chunkingComplete",function(){t||r.resumableObj.upload(),t=!0})},r.bootstrap=function(){r.abort(),s=!1,r.chunks=[],r._prevProgress=0;for(var t=r.getOpt("forceChunkSize")?Math.ceil:Math.floor,e=Math.max(t(r.file.size/r.getOpt("chunkSize")),1),i=0;i<e;i++)!function(t){window.setTimeout(function(){r.chunks.push(new u(r.resumableObj,r,t,o)),r.resumableObj.fire("chunkingProgress",r,t/e)},0)}(i);window.setTimeout(function(){r.resumableObj.fire("chunkingComplete",r)},0)},r.progress=function(){if(s)return 1;var t=0,e=!1;return n.each(r.chunks,function(i){"error"==i.status()&&(e=!0),t+=i.progress(!0)}),t=e?1:t>.99999?1:t,t=Math.max(r._prevProgress,t),r._prevProgress=t,t},r.isUploading=function(){var t=!1;return n.each(r.chunks,function(e){if("uploading"==e.status())return t=!0,!1}),t},r.isComplete=function(){var t=!1;return 1!==r.preprocessState&&(n.each(r.chunks,function(e){var i=e.status();if("pending"==i||"uploading"==i||1===e.preprocessState)return t=!0,!1}),!t)},r.pause=function(t){r._pause=void 0===t?!r._pause:t},r.isPaused=function(){return r._pause},r.preprocessFinished=function(){r.preprocessState=2,r.upload()},r.upload=function(){var t=!1;if(!1===r.isPaused()){var e=r.getOpt("preprocessFile");if("function"==typeof e)switch(r.preprocessState){case 0:return r.preprocessState=1,e(r),!0;case 1:return!0}n.each(r.chunks,function(e){if("pending"==e.status()&&1!==e.preprocessState)return e.send(),t=!0,!1})}return t},r.markChunksCompleted=function(t){if(r.chunks&&!(r.chunks.length<=t))for(var e=0;e<t;e++)r.chunks[e].markComplete=!0},r.resumableObj.fire("chunkingStart",r),r.bootstrap(),this}function u(t,e,i,r){var s=this;s.opts={},s.getOpt=t.getOpt,s.resumableObj=t,s.fileObj=e,s.fileObjSize=e.size,s.fileObjType=e.file.type,s.offset=i,s.callback=r,s.lastProgressCallback=new Date,s.tested=!1,s.retries=0,s.pendingRetry=!1,s.preprocessState=0,s.markComplete=!1;var o=s.getOpt("chunkSize");return s.loaded=0,s.startByte=s.offset*o,s.endByte=Math.min(s.fileObjSize,(s.offset+1)*o),s.fileObjSize-s.endByte<o&&!s.getOpt("forceChunkSize")&&(s.endByte=s.fileObjSize),s.xhr=null,s.test=function(){s.xhr=new XMLHttpRequest;var t=function(t){s.tested=!0;var e=s.status();"success"==e?(s.callback(e,s.message()),s.resumableObj.uploadNextChunk()):s.send()};s.xhr.addEventListener("load",t,!1),s.xhr.addEventListener("error",t,!1),s.xhr.addEventListener("timeout",t,!1);var e=[],i=s.getOpt("parameterNamespace"),r=s.getOpt("query");"function"==typeof r&&(r=r(s.fileObj,s)),n.each(r,function(t,n){e.push([encodeURIComponent(i+t),encodeURIComponent(n)].join("="))}),e=e.concat([["chunkNumberParameterName",s.offset+1],["chunkSizeParameterName",s.getOpt("chunkSize")],["currentChunkSizeParameterName",s.endByte-s.startByte],["totalSizeParameterName",s.fileObjSize],["typeParameterName",s.fileObjType],["identifierParameterName",s.fileObj.uniqueIdentifier],["fileNameParameterName",s.fileObj.fileName],["relativePathParameterName",s.fileObj.relativePath],["totalChunksParameterName",s.fileObj.chunks.length]].filter(function(t){return s.getOpt(t[0])}).map(function(t){return[i+s.getOpt(t[0]),encodeURIComponent(t[1])].join("=")})),s.xhr.open(s.getOpt("testMethod"),n.getTarget("test",e)),s.xhr.timeout=s.getOpt("xhrTimeout"),s.xhr.withCredentials=s.getOpt("withCredentials");var o=s.getOpt("headers");"function"==typeof o&&(o=o(s.fileObj,s)),n.each(o,function(t,e){s.xhr.setRequestHeader(t,e)}),s.xhr.send(null)},s.preprocessFinished=function(){s.preprocessState=2,s.send()},s.send=function(){var t=s.getOpt("preprocess");if("function"==typeof t)switch(s.preprocessState){case 0:return s.preprocessState=1,void t(s);case 1:return}if(!s.getOpt("testChunks")||s.tested){s.xhr=new XMLHttpRequest,s.xhr.upload.addEventListener("progress",function(t){new Date-s.lastProgressCallback>1e3*s.getOpt("throttleProgressCallbacks")&&(s.callback("progress"),s.lastProgressCallback=new Date),s.loaded=t.loaded||0},!1),s.loaded=0,s.pendingRetry=!1,s.callback("progress");var e=function(t){var e=s.status();if("success"==e||"error"==e)s.callback(e,s.message()),s.resumableObj.uploadNextChunk();else{s.callback("retry",s.message()),s.abort(),s.retries++;var i=s.getOpt("chunkRetryInterval");void 0!==i?(s.pendingRetry=!0,setTimeout(s.send,i)):s.send()}};s.xhr.addEventListener("load",e,!1),s.xhr.addEventListener("error",e,!1),s.xhr.addEventListener("timeout",e,!1);var i=[["chunkNumberParameterName",s.offset+1],["chunkSizeParameterName",s.getOpt("chunkSize")],["currentChunkSizeParameterName",s.endByte-s.startByte],["totalSizeParameterName",s.fileObjSize],["typeParameterName",s.fileObjType],["identifierParameterName",s.fileObj.uniqueIdentifier],["fileNameParameterName",s.fileObj.fileName],["relativePathParameterName",s.fileObj.relativePath],["totalChunksParameterName",s.fileObj.chunks.length]].filter(function(t){return s.getOpt(t[0])}).reduce(function(t,e){return t[s.getOpt(e[0])]=e[1],t},{}),r=s.getOpt("query");"function"==typeof r&&(r=r(s.fileObj,s)),n.each(r,function(t,e){i[t]=e});var o=s.fileObj.file.slice?"slice":s.fileObj.file.mozSlice?"mozSlice":s.fileObj.file.webkitSlice?"webkitSlice":"slice",a=s.fileObj.file[o](s.startByte,s.endByte,s.getOpt("setChunkTypeFromFile")?s.fileObj.file.type:""),h=null,l=[],c=s.getOpt("parameterNamespace");if("octet"===s.getOpt("method"))h=a,n.each(i,function(t,e){l.push([encodeURIComponent(c+t),encodeURIComponent(e)].join("="))});else if(h=new FormData,n.each(i,function(t,e){h.append(c+t,e),l.push([encodeURIComponent(c+t),encodeURIComponent(e)].join("="))}),"blob"==s.getOpt("chunkFormat"))h.append(c+s.getOpt("fileParameterName"),a,s.fileObj.fileName);else if("base64"==s.getOpt("chunkFormat")){var u=new FileReader;u.onload=function(t){h.append(c+s.getOpt("fileParameterName"),u.result),s.xhr.send(h)},u.readAsDataURL(a)}var f=n.getTarget("upload",l),d=s.getOpt("uploadMethod");s.xhr.open(d,f),"octet"===s.getOpt("method")&&s.xhr.setRequestHeader("Content-Type","application/octet-stream"),s.xhr.timeout=s.getOpt("xhrTimeout"),s.xhr.withCredentials=s.getOpt("withCredentials");var p=s.getOpt("headers");"function"==typeof p&&(p=p(s.fileObj,s)),n.each(p,function(t,e){s.xhr.setRequestHeader(t,e)}),"blob"==s.getOpt("chunkFormat")&&s.xhr.send(h)}else s.test()},s.abort=function(){s.xhr&&s.xhr.abort(),s.xhr=null},s.status=function(){return s.pendingRetry?"uploading":s.markComplete?"success":s.xhr?s.xhr.readyState<4?"uploading":200==s.xhr.status||201==s.xhr.status?"success":n.contains(s.getOpt("permanentErrors"),s.xhr.status)||s.retries>=s.getOpt("maxChunkRetries")?"error":(s.abort(),"pending"):"pending"},s.message=function(){return s.xhr?s.xhr.responseText:""},s.progress=function(t){void 0===t&&(t=!1);var e=t?(s.endByte-s.startByte)/s.fileObjSize:1;if(s.pendingRetry)return 0;switch(s.xhr&&s.xhr.status||s.markComplete||(e*=.95),s.status()){case"success":case"error":return 1*e;case"pending":return 0*e;default:return s.loaded/(s.endByte-s.startByte)*e}},this}return i.uploadNextChunk=function(){var t=!1;if(i.getOpt("prioritizeFirstAndLastChunk")&&(n.each(i.files,function(e){return e.chunks.length&&"pending"==e.chunks[0].status()&&0===e.chunks[0].preprocessState?(e.chunks[0].send(),t=!0,!1):e.chunks.length>1&&"pending"==e.chunks[e.chunks.length-1].status()&&0===e.chunks[e.chunks.length-1].preprocessState?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return!0;if(n.each(i.files,function(e){if(t=e.upload())return!1}),t)return!0;var e=!1;return n.each(i.files,function(t){if(!t.isComplete())return e=!0,!1}),e||i.fire("complete"),!1},i.assignBrowse=function(t,e){void 0===t.length&&(t=[t]),n.each(t,function(t){var n;"INPUT"===t.tagName&&"file"===t.type?n=t:((n=document.createElement("input")).setAttribute("type","file"),n.style.display="none",t.addEventListener("click",function(){n.style.opacity=0,n.style.display="block",n.focus(),n.click(),n.style.display="none"},!1),t.appendChild(n));var r=i.getOpt("maxFiles");void 0===r||1!=r?n.setAttribute("multiple","multiple"):n.removeAttribute("multiple"),e?n.setAttribute("webkitdirectory","webkitdirectory"):n.removeAttribute("webkitdirectory");var s=i.getOpt("fileType");void 0!==s&&s.length>=1?n.setAttribute("accept",s.map(function(t){return(t=t.replace(/\s/g,"").toLowerCase()).match(/^[^.][^/]+$/)&&(t="."+t),t}).join(",")):n.removeAttribute("accept"),n.addEventListener("change",function(t){l(t.target.files,t),i.getOpt("clearInput")&&(t.target.value="")},!1)})},i.assignDrop=function(t){void 0===t.length&&(t=[t]),n.each(t,function(t){t.addEventListener("dragover",o,!1),t.addEventListener("dragenter",o,!1),t.addEventListener("dragleave",s,!1),t.addEventListener("drop",r,!1)})},i.unAssignDrop=function(t){void 0===t.length&&(t=[t]),n.each(t,function(t){t.removeEventListener("dragover",o),t.removeEventListener("dragenter",o),t.removeEventListener("dragleave",s),t.removeEventListener("drop",r)})},i.isUploading=function(){var t=!1;return n.each(i.files,function(e){if(e.isUploading())return t=!0,!1}),t},i.upload=function(){if(!i.isUploading()){i.fire("uploadStart");for(var t=1;t<=i.getOpt("simultaneousUploads");t++)i.uploadNextChunk()}},i.pause=function(){n.each(i.files,function(t){t.abort()}),i.fire("pause")},i.cancel=function(){i.fire("beforeCancel");for(var t=i.files.length-1;t>=0;t--)i.files[t].cancel();i.fire("cancel")},i.progress=function(){var t=0,e=0;return n.each(i.files,function(i){t+=i.progress()*i.size,e+=i.size}),e>0?t/e:0},i.addFile=function(t,e){l([t],e)},i.addFiles=function(t,e){l(t,e)},i.removeFile=function(t){for(var e=i.files.length-1;e>=0;e--)i.files[e]===t&&i.files.splice(e,1)},i.getFromUniqueIdentifier=function(t){var e=!1;return n.each(i.files,function(i){i.uniqueIdentifier==t&&(e=i)}),e},i.getSize=function(){var t=0;return n.each(i.files,function(e){t+=e.size}),t},i.handleDropEvent=function(t){r(t)},i.handleChangeEvent=function(t){l(t.target.files,t),t.target.value=""},i.updateQuery=function(t){i.opts.query=t},this};"undefined"!=typeof module?(module.exports=t,module.exports.Resumable=t):"function"==typeof define&&define.amd?define(function(){return t}):window.Resumable=t}(),function(){function t(t){this.mode=i.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,n=this.data.length;e<n;e++){var r=[],s=this.data.charCodeAt(e);s>65536?(r[0]=240|(1835008&s)>>>18,r[1]=128|(258048&s)>>>12,r[2]=128|(4032&s)>>>6,r[3]=128|63&s):s>2048?(r[0]=224|(61440&s)>>>12,r[1]=128|(4032&s)>>>6,r[2]=128|63&s):s>128?(r[0]=192|(1984&s)>>>6,r[1]=128|63&s):r[0]=s,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,i=this.parsedData.length;e<i;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var i=new t(e);this.dataList.push(i),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,i){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[n][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,i),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,i)},setupPositionProbePattern:function(t,e){for(var i=-1;i<=7;i++)if(!(t+i<=-1||this.moduleCount<=t+i))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(this.modules[t+i][e+n]=0<=i&&i<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var t=0,e=0,i=0;i<8;i++){this.makeImpl(!0,i);var n=r.getLostPoint(this);(0==i||t>n)&&(t=n,e=i)}return e},createMovieClip:function(t,e,i){var n=t.createEmptyMovieClip(e,i);this.make();for(var r=0;r<this.modules.length;r++)for(var s=1*r,o=0;o<this.modules[r].length;o++){var a=1*o;this.modules[r][o]&&(n.beginFill(0,100),n.moveTo(a,s),n.lineTo(a+1,s),n.lineTo(a+1,s+1),n.lineTo(a,s+1),n.endFill())}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=r.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var i=0;i<t.length;i++){var n=t[e],s=t[i];if(null==this.modules[n][s])for(var o=-2;o<=2;o++)for(var a=-2;a<=2;a++)this.modules[n+o][s+a]=-2==o||2==o||-2==a||2==a||0==o&&0==a}},setupTypeNumber:function(t){for(var e=r.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){var n=!t&&1==(e>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=n}for(i=0;i<18;i++)n=!t&&1==(e>>i&1),this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=n},setupTypeInfo:function(t,e){for(var i=this.errorCorrectLevel<<3|e,n=r.getBCHTypeInfo(i),s=0;s<15;s++){var o=!t&&1==(n>>s&1);s<6?this.modules[s][8]=o:s<8?this.modules[s+1][8]=o:this.modules[this.moduleCount-15+s][8]=o}for(s=0;s<15;s++)o=!t&&1==(n>>s&1),s<8?this.modules[8][this.moduleCount-s-1]=o:s<9?this.modules[8][15-s-1+1]=o:this.modules[8][15-s-1]=o;this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var i=-1,n=this.moduleCount-1,s=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var h=0;h<2;h++)if(null==this.modules[n][a-h]){var l=!1;o<t.length&&(l=1==(t[o]>>>s&1)),r.getMask(e,n,a-h)&&(l=!l),this.modules[n][a-h]=l,-1==--s&&(o++,s=7)}if((n+=i)<0||this.moduleCount<=n){n-=i,i=-i;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,i,n){for(var s=h.getRSBlocks(t,i),o=new l,a=0;a<n.length;a++){var c=n[a];o.put(c.mode,4),o.put(c.getLength(),r.getLengthInBits(c.mode,t)),c.write(o)}var u=0;for(a=0;a<s.length;a++)u+=s[a].dataCount;if(o.getLengthInBits()>8*u)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*u+")");for(o.getLengthInBits()+4<=8*u&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*u||(o.put(e.PAD0,8),o.getLengthInBits()>=8*u));)o.put(e.PAD1,8);return e.createBytes(o,s)},e.createBytes=function(t,e){for(var i=0,n=0,s=0,o=new Array(e.length),h=new Array(e.length),l=0;l<e.length;l++){var c=e[l].dataCount,u=e[l].totalCount-c;n=Math.max(n,c),s=Math.max(s,u),o[l]=new Array(c);for(var f=0;f<o[l].length;f++)o[l][f]=255&t.buffer[f+i];i+=c;var d=r.getErrorCorrectPolynomial(u),p=new a(o[l],d.getLength()-1).mod(d);for(h[l]=new Array(d.getLength()-1),f=0;f<h[l].length;f++){var g=f+p.getLength()-h[l].length;h[l][f]=g>=0?p.get(g):0}}var v=0;for(f=0;f<e.length;f++)v+=e[f].totalCount;var m=new Array(v),_=0;for(f=0;f<n;f++)for(l=0;l<e.length;l++)f<o[l].length&&(m[_++]=o[l][f]);for(f=0;f<s;f++)for(l=0;l<e.length;l++)f<h[l].length&&(m[_++]=h[l][f]);return m};for(var i={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},r={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;r.getBCHDigit(e)-r.getBCHDigit(r.G15)>=0;)e^=r.G15<<r.getBCHDigit(e)-r.getBCHDigit(r.G15);return(t<<10|e)^r.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;r.getBCHDigit(e)-r.getBCHDigit(r.G18)>=0;)e^=r.G18<<r.getBCHDigit(e)-r.getBCHDigit(r.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return r.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,i){switch(t){case 0:return(e+i)%2==0;case 1:return e%2==0;case 2:return i%3==0;case 3:return(e+i)%3==0;case 4:return(Math.floor(e/2)+Math.floor(i/3))%2==0;case 5:return e*i%2+e*i%3==0;case 6:return(e*i%2+e*i%3)%2==0;case 7:return(e*i%3+(e+i)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new a([1],0),i=0;i<t;i++)e=e.multiply(new a([1,s.gexp(i)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case i.MODE_NUMBER:return 10;case i.MODE_ALPHA_NUM:return 9;case i.MODE_8BIT_BYTE:case i.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case i.MODE_NUMBER:return 12;case i.MODE_ALPHA_NUM:return 11;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case i.MODE_NUMBER:return 14;case i.MODE_ALPHA_NUM:return 13;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),i=0,n=0;n<e;n++)for(var r=0;r<e;r++){for(var s=0,o=t.isDark(n,r),a=-1;a<=1;a++)if(!(n+a<0||e<=n+a))for(var h=-1;h<=1;h++)r+h<0||e<=r+h||0==a&&0==h||o==t.isDark(n+a,r+h)&&s++;s>5&&(i+=3+s-5)}for(n=0;n<e-1;n++)for(r=0;r<e-1;r++){var l=0;t.isDark(n,r)&&l++,t.isDark(n+1,r)&&l++,t.isDark(n,r+1)&&l++,t.isDark(n+1,r+1)&&l++,0!=l&&4!=l||(i+=3)}for(n=0;n<e;n++)for(r=0;r<e-6;r++)t.isDark(n,r)&&!t.isDark(n,r+1)&&t.isDark(n,r+2)&&t.isDark(n,r+3)&&t.isDark(n,r+4)&&!t.isDark(n,r+5)&&t.isDark(n,r+6)&&(i+=40);for(r=0;r<e;r++)for(n=0;n<e-6;n++)t.isDark(n,r)&&!t.isDark(n+1,r)&&t.isDark(n+2,r)&&t.isDark(n+3,r)&&t.isDark(n+4,r)&&!t.isDark(n+5,r)&&t.isDark(n+6,r)&&(i+=40);var c=0;for(r=0;r<e;r++)for(n=0;n<e;n++)t.isDark(n,r)&&c++;return i+Math.abs(100*c/e/e-50)/5*10}},s={glog:function(t){if(t<1)throw new Error("glog("+t+")");return s.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return s.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},o=0;o<8;o++)s.EXP_TABLE[o]=1<<o;for(o=8;o<256;o++)s.EXP_TABLE[o]=s.EXP_TABLE[o-4]^s.EXP_TABLE[o-5]^s.EXP_TABLE[o-6]^s.EXP_TABLE[o-8];for(o=0;o<255;o++)s.LOG_TABLE[s.EXP_TABLE[o]]=o;function a(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var i=0;i<t.length&&0==t[i];)i++;this.num=new Array(t.length-i+e);for(var n=0;n<t.length-i;n++)this.num[n]=t[n+i]}function h(t,e){this.totalCount=t,this.dataCount=e}function l(){this.buffer=[],this.length=0}a.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),i=0;i<this.getLength();i++)for(var n=0;n<t.getLength();n++)e[i+n]^=s.gexp(s.glog(this.get(i))+s.glog(t.get(n)));return new a(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=s.glog(this.get(0))-s.glog(t.get(0)),i=new Array(this.getLength()),n=0;n<this.getLength();n++)i[n]=this.get(n);for(n=0;n<t.getLength();n++)i[n]^=s.gexp(s.glog(t.get(n))+e);return new a(i,0).mod(t)}},h.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],h.getRSBlocks=function(t,e){var i=h.getRsBlockTable(t,e);if(null==i)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=i.length/3,r=[],s=0;s<n;s++)for(var o=i[3*s+0],a=i[3*s+1],l=i[3*s+2],c=0;c<o;c++)r.push(new h(a,l));return r},h.getRsBlockTable=function(t,e){switch(e){case n.L:return h.RS_BLOCK_TABLE[4*(t-1)+0];case n.M:return h.RS_BLOCK_TABLE[4*(t-1)+1];case n.Q:return h.RS_BLOCK_TABLE[4*(t-1)+2];case n.H:return h.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},l.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var i=0;i<e;i++)this.putBit(1==(t>>>e-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var c=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function u(){var t=!1,e=navigator.userAgent;if(/android/i.test(e)){t=!0;var i=e.toString().match(/android ([0-9]\.[0-9])/i);i&&i[1]&&(t=parseFloat(i[1]))}return t}var f=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){var e=this._htOption,i=this._el,n=t.getModuleCount();function r(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)e.hasOwnProperty(n)&&i.setAttribute(n,e[n]);return i}Math.floor(e.width/n),Math.floor(e.height/n),this.clear();var s=r("svg",{viewBox:"0 0 "+String(n)+" "+String(n),width:"100%",height:"100%",fill:e.colorLight});s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),i.appendChild(s),s.appendChild(r("rect",{fill:e.colorLight,width:"100%",height:"100%"})),s.appendChild(r("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var o=0;o<n;o++)for(var a=0;a<n;a++)if(t.isDark(o,a)){var h=r("use",{x:String(a),y:String(o)});h.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),s.appendChild(h)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),d="svg"===document.documentElement.tagName.toLowerCase()?f:"undefined"==typeof CanvasRenderingContext2D?function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,i=this._el,n=t.getModuleCount(),r=Math.floor(e.width/n),s=Math.floor(e.height/n),o=['<table style="border:0;border-collapse:collapse;">'],a=0;a<n;a++){o.push("<tr>");for(var h=0;h<n;h++)o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+r+"px;height:"+s+"px;background-color:"+(t.isDark(a,h)?e.colorDark:e.colorLight)+';"></td>');o.push("</tr>")}o.push("</table>"),i.innerHTML=o.join("");var l=i.childNodes[0],c=(e.width-l.offsetWidth)/2,u=(e.height-l.offsetHeight)/2;c>0&&u>0&&(l.style.margin=u+"px "+c+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,i=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,n,r,s,o,a,h,l,c){if("nodeName"in t&&/img/i.test(t.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*e;else void 0===l&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);i.apply(this,arguments)}}var n=function(t,e){this._bIsPainted=!1,this._android=u(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return n.prototype.draw=function(t){var e=this._elImage,i=this._oContext,n=this._htOption,r=t.getModuleCount(),s=n.width/r,o=n.height/r,a=Math.round(s),h=Math.round(o);e.style.display="none",this.clear();for(var l=0;l<r;l++)for(var c=0;c<r;c++){var u=t.isDark(l,c),f=c*s,d=l*o;i.strokeStyle=u?n.colorDark:n.colorLight,i.lineWidth=1,i.fillStyle=u?n.colorDark:n.colorLight,i.fillRect(f,d,s,o),i.strokeRect(Math.floor(f)+.5,Math.floor(d)+.5,a,h),i.strokeRect(Math.ceil(f)-.5,Math.ceil(d)-.5,a,h)}this._bIsPainted=!0},n.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var i=this;if(i._fFail=e,i._fSuccess=t,null===i._bSupportDataURI){var n=document.createElement("img"),r=function(){i._bSupportDataURI=!1,i._fFail&&i._fFail.call(i)};return n.onabort=r,n.onerror=r,n.onload=function(){i._bSupportDataURI=!0,i._fSuccess&&i._fSuccess.call(i)},void(n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===i._bSupportDataURI&&i._fSuccess?i._fSuccess.call(i):!1===i._bSupportDataURI&&i._fFail&&i._fFail.call(i)}.call(this,t)},n.prototype.isPainted=function(){return this._bIsPainted},n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},n.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},n}();(QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},"string"==typeof e&&(e={text:e}),e)for(var i in e)this._htOption[i]=e[i];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(d=f),this._android=u(),this._el=t,this._oQRCode=null,this._oDrawing=new d(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(function(t,e){for(var i=1,r=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),s=0,o=c.length;s<=o;s++){var a=0;switch(e){case n.L:a=c[s][0];break;case n.M:a=c[s][1];break;case n.Q:a=c[s][2];break;case n.H:a=c[s][3]}if(r<=a)break;i++}if(i>c.length)throw new Error("Too long data");return i}(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=n}(),"undefined"!=typeof module&&(module.exports=QRCode),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).opentype={})}(this,function(t){"use strict";var e,i;String.prototype.codePointAt||(e=function(){try{var t={},e=Object.defineProperty,i=e(t,t,t)&&e}catch(t){}return i}(),i=function(t){if(null==this)throw TypeError();var e=String(this),i=e.length,n=t?Number(t):0;if(n!=n&&(n=0),!(n<0||n>=i)){var r,s=e.charCodeAt(n);return s>=55296&&s<=56319&&i>n+1&&(r=e.charCodeAt(n+1))>=56320&&r<=57343?1024*(s-55296)+r-56320+65536:s}},e?e(String.prototype,"codePointAt",{value:i,configurable:!0,writable:!0}):String.prototype.codePointAt=i);var n=0,r=-3;function s(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function o(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new s,this.dtree=new s}var a=new s,h=new s,l=new Uint8Array(30),c=new Uint16Array(30),u=new Uint8Array(30),f=new Uint16Array(30),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),p=new s,g=new Uint8Array(320);function v(t,e,i,n){var r,s;for(r=0;r<i;++r)t[r]=0;for(r=0;r<30-i;++r)t[r+i]=r/i|0;for(s=n,r=0;r<30;++r)e[r]=s,s+=1<<t[r]}var m=new Uint16Array(16);function _(t,e,i,n){var r,s;for(r=0;r<16;++r)t.table[r]=0;for(r=0;r<n;++r)t.table[e[i+r]]++;for(t.table[0]=0,s=0,r=0;r<16;++r)m[r]=s,s+=t.table[r];for(r=0;r<n;++r)e[i+r]&&(t.trans[m[e[i+r]]++]=r)}function y(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=1&t.tag;return t.tag>>>=1,e}function x(t,e,i){if(!e)return i;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,n+i}function b(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var i=0,n=0,r=0,s=t.tag;do{n=2*n+(1&s),s>>>=1,++r,i+=e.table[r],n-=e.table[r]}while(n>=0);return t.tag=s,t.bitcount-=r,e.trans[i+n]}function w(t,e,i){var n,r,s,o,a,h;for(n=x(t,5,257),r=x(t,5,1),s=x(t,4,4),o=0;o<19;++o)g[o]=0;for(o=0;o<s;++o){var l=x(t,3,0);g[d[o]]=l}for(_(p,g,0,19),a=0;a<n+r;){var c=b(t,p);switch(c){case 16:var u=g[a-1];for(h=x(t,2,3);h;--h)g[a++]=u;break;case 17:for(h=x(t,3,3);h;--h)g[a++]=0;break;case 18:for(h=x(t,7,11);h;--h)g[a++]=0;break;default:g[a++]=c}}_(e,g,0,n),_(i,g,n,r)}function S(t,e,i){for(;;){var r,s,o,a,h=b(t,e);if(256===h)return n;if(h<256)t.dest[t.destLen++]=h;else for(r=x(t,l[h-=257],c[h]),s=b(t,i),a=o=t.destLen-x(t,u[s],f[s]);a<o+r;++a)t.dest[t.destLen++]=t.dest[a]}}function C(t){for(var e,i;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if((e=256*(e=t.source[t.sourceIndex+1])+t.source[t.sourceIndex])!==(65535&~(256*t.source[t.sourceIndex+3]+t.source[t.sourceIndex+2])))return r;for(t.sourceIndex+=4,i=e;i;--i)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,n}!function(t,e){var i;for(i=0;i<7;++i)t.table[i]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,i=0;i<24;++i)t.trans[i]=256+i;for(i=0;i<144;++i)t.trans[24+i]=i;for(i=0;i<8;++i)t.trans[168+i]=280+i;for(i=0;i<112;++i)t.trans[176+i]=144+i;for(i=0;i<5;++i)e.table[i]=0;for(e.table[5]=32,i=0;i<32;++i)e.trans[i]=i}(a,h),v(l,c,4,3),v(u,f,2,1),l[28]=0,c[28]=258;var T=function(t,e){var i,s,l=new o(t,e);do{switch(i=y(l),x(l,2,0)){case 0:s=C(l);break;case 1:s=S(l,a,h);break;case 2:w(l,l.ltree,l.dtree),s=S(l,l.ltree,l.dtree);break;default:s=r}if(s!==n)throw new Error("Data error")}while(!i);return l.destLen<l.dest.length?"function"==typeof l.dest.slice?l.dest.slice(0,l.destLen):l.dest.subarray(0,l.destLen):l.dest};function k(t,e,i,n,r){return Math.pow(1-r,3)*t+3*Math.pow(1-r,2)*r*e+3*(1-r)*Math.pow(r,2)*i+Math.pow(r,3)*n}function E(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function A(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function M(t){throw new Error(t)}function D(t,e){t||M(e)}E.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},E.prototype.addPoint=function(t,e){"number"==typeof t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),"number"==typeof e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},E.prototype.addX=function(t){this.addPoint(t,null)},E.prototype.addY=function(t){this.addPoint(null,t)},E.prototype.addBezier=function(t,e,i,n,r,s,o,a){var h=[t,e],l=[i,n],c=[r,s],u=[o,a];this.addPoint(t,e),this.addPoint(o,a);for(var f=0;f<=1;f++){var d=6*h[f]-12*l[f]+6*c[f],p=-3*h[f]+9*l[f]-9*c[f]+3*u[f],g=3*l[f]-3*h[f];if(0!==p){var v=Math.pow(d,2)-4*g*p;if(!(v<0)){var m=(-d+Math.sqrt(v))/(2*p);0<m&&m<1&&(0===f&&this.addX(k(h[f],l[f],c[f],u[f],m)),1===f&&this.addY(k(h[f],l[f],c[f],u[f],m)));var _=(-d-Math.sqrt(v))/(2*p);0<_&&_<1&&(0===f&&this.addX(k(h[f],l[f],c[f],u[f],_)),1===f&&this.addY(k(h[f],l[f],c[f],u[f],_)))}}else{if(0===d)continue;var y=-g/d;0<y&&y<1&&(0===f&&this.addX(k(h[f],l[f],c[f],u[f],y)),1===f&&this.addY(k(h[f],l[f],c[f],u[f],y)))}}},E.prototype.addQuad=function(t,e,i,n,r,s){var o=t+2/3*(i-t),a=e+2/3*(n-e),h=o+1/3*(r-t),l=a+1/3*(s-e);this.addBezier(t,e,o,a,h,l,r,s)},A.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},A.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},A.prototype.curveTo=A.prototype.bezierCurveTo=function(t,e,i,n,r,s){this.commands.push({type:"C",x1:t,y1:e,x2:i,y2:n,x:r,y:s})},A.prototype.quadTo=A.prototype.quadraticCurveTo=function(t,e,i,n){this.commands.push({type:"Q",x1:t,y1:e,x:i,y:n})},A.prototype.close=A.prototype.closePath=function(){this.commands.push({type:"Z"})},A.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof E){var e=t;return this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),void this.close()}Array.prototype.push.apply(this.commands,t)},A.prototype.getBoundingBox=function(){for(var t=new E,e=0,i=0,n=0,r=0,s=0;s<this.commands.length;s++){var o=this.commands[s];switch(o.type){case"M":t.addPoint(o.x,o.y),e=n=o.x,i=r=o.y;break;case"L":t.addPoint(o.x,o.y),n=o.x,r=o.y;break;case"Q":t.addQuad(n,r,o.x1,o.y1,o.x,o.y),n=o.x,r=o.y;break;case"C":t.addBezier(n,r,o.x1,o.y1,o.x2,o.y2,o.x,o.y),n=o.x,r=o.y;break;case"Z":n=e,r=i;break;default:throw new Error("Unexpected path command "+o.type)}}return t.isEmpty()&&t.addPoint(0,0),t},A.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var i=this.commands[e];"M"===i.type?t.moveTo(i.x,i.y):"L"===i.type?t.lineTo(i.x,i.y):"C"===i.type?t.bezierCurveTo(i.x1,i.y1,i.x2,i.y2,i.x,i.y):"Q"===i.type?t.quadraticCurveTo(i.x1,i.y1,i.x,i.y):"Z"===i.type&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},A.prototype.toPathData=function(t){function e(e){return Math.round(e)===e?""+Math.round(e):e.toFixed(t)}function i(){for(var t=arguments,i="",n=0;n<arguments.length;n+=1){var r=t[n];r>=0&&n>0&&(i+=" "),i+=e(r)}return i}t=void 0!==t?t:2;for(var n="",r=0;r<this.commands.length;r+=1){var s=this.commands[r];"M"===s.type?n+="M"+i(s.x,s.y):"L"===s.type?n+="L"+i(s.x,s.y):"C"===s.type?n+="C"+i(s.x1,s.y1,s.x2,s.y2,s.x,s.y):"Q"===s.type?n+="Q"+i(s.x1,s.y1,s.x,s.y):"Z"===s.type&&(n+="Z")}return n},A.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&"black"!==this.fill&&(null===this.fill?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+"/>"},A.prototype.toDOMElement=function(t){var e=this.toPathData(t),i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",e),i};var O={fail:M,argument:D,assert:D},L={},P={},B={};function I(t){return function(){return t}}P.BYTE=function(t){return O.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},B.BYTE=I(1),P.CHAR=function(t){return[t.charCodeAt(0)]},B.CHAR=I(1),P.CHARARRAY=function(t){for(var e=[],i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e},B.CHARARRAY=function(t){return t.length},P.USHORT=function(t){return[t>>8&255,255&t]},B.USHORT=I(2),P.SHORT=function(t){return t>=32768&&(t=-(65536-t)),[t>>8&255,255&t]},B.SHORT=I(2),P.UINT24=function(t){return[t>>16&255,t>>8&255,255&t]},B.UINT24=I(3),P.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},B.ULONG=I(4),P.LONG=function(t){return t>=2147483648&&(t=-(4294967296-t)),[t>>24&255,t>>16&255,t>>8&255,255&t]},B.LONG=I(4),P.FIXED=P.ULONG,B.FIXED=B.ULONG,P.FWORD=P.SHORT,B.FWORD=B.SHORT,P.UFWORD=P.USHORT,B.UFWORD=B.USHORT,P.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t]},B.LONGDATETIME=I(8),P.TAG=function(t){return O.argument(4===t.length,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},B.TAG=I(4),P.Card8=P.BYTE,B.Card8=B.BYTE,P.Card16=P.USHORT,B.Card16=B.USHORT,P.OffSize=P.BYTE,B.OffSize=B.BYTE,P.SID=P.USHORT,B.SID=B.USHORT,P.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?[247+((t-=108)>>8),255&t]:t>=-1131&&t<=-108?[251+((t=-t-108)>>8),255&t]:t>=-32768&&t<=32767?P.NUMBER16(t):P.NUMBER32(t)},B.NUMBER=function(t){return P.NUMBER(t).length},P.NUMBER16=function(t){return[28,t>>8&255,255&t]},B.NUMBER16=I(3),P.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,255&t]},B.NUMBER32=I(5),P.REAL=function(t){var e=t.toString(),i=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(i){var n=parseFloat("1e"+((i[2]?+i[2]:0)+i[1].length));e=(Math.round(t*n)/n).toString()}for(var r="",s=0,o=e.length;s<o;s+=1){var a=e[s];r+="e"===a?"-"===e[++s]?"c":"b":"."===a?"a":"-"===a?"e":a}for(var h=[30],l=0,c=(r+=1&r.length?"f":"ff").length;l<c;l+=2)h.push(parseInt(r.substr(l,2),16));return h},B.REAL=function(t){return P.REAL(t).length},P.NAME=P.CHARARRAY,B.NAME=B.CHARARRAY,P.STRING=P.CHARARRAY,B.STRING=B.CHARARRAY,L.UTF8=function(t,e,i){for(var n=[],r=i,s=0;s<r;s++,e+=1)n[s]=t.getUint8(e);return String.fromCharCode.apply(null,n)},L.UTF16=function(t,e,i){for(var n=[],r=i/2,s=0;s<r;s++,e+=2)n[s]=t.getUint16(e);return String.fromCharCode.apply(null,n)},P.UTF16=function(t){for(var e=[],i=0;i<t.length;i+=1){var n=t.charCodeAt(i);e[e.length]=n>>8&255,e[e.length]=255&n}return e},B.UTF16=function(t){return 2*t.length};var R={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};L.MACSTRING=function(t,e,i,n){var r=R[n];if(void 0!==r){for(var s="",o=0;o<i;o++){var a=t.getUint8(e+o);s+=a<=127?String.fromCharCode(a):r[127&a]}return s}};var F,U="function"==typeof WeakMap&&new WeakMap;function N(t){return t>=-128&&t<=127}function z(t,e,i){for(var n=0,r=t.length;e<r&&n<64&&0===t[e];)++e,++n;return i.push(128|n-1),e}function G(t,e,i){for(var n=0,r=t.length,s=e;s<r&&n<64;){var o=t[s];if(!N(o))break;if(0===o&&s+1<r&&0===t[s+1])break;++s,++n}i.push(n-1);for(var a=e;a<s;++a)i.push(t[a]+256&255);return s}function X(t,e,i){for(var n=0,r=t.length,s=e;s<r&&n<64;){var o=t[s];if(0===o)break;if(N(o)&&s+1<r&&N(t[s+1]))break;++s,++n}i.push(64|n-1);for(var a=e;a<s;++a){var h=t[a];i.push(h+65536>>8&255,h+256&255)}return s}P.MACSTRING=function(t,e){var i=function(t){if(!F)for(var e in F={},R)F[e]=new String(e);var i=F[t];if(void 0!==i){if(U){var n=U.get(i);if(void 0!==n)return n}var r=R[t];if(void 0!==r){for(var s={},o=0;o<r.length;o++)s[r.charCodeAt(o)]=o+128;return U&&U.set(i,s),s}}}(e);if(void 0!==i){for(var n=[],r=0;r<t.length;r++){var s=t.charCodeAt(r);if(s>=128&&void 0===(s=i[s]))return;n[r]=s}return n}},B.MACSTRING=function(t,e){var i=P.MACSTRING(t,e);return void 0!==i?i.length:0},P.VARDELTAS=function(t){for(var e=0,i=[];e<t.length;){var n=t[e];e=0===n?z(t,e,i):n>=-128&&n<=127?G(t,e,i):X(t,e,i)}return i},P.INDEX=function(t){for(var e=1,i=[e],n=[],r=0;r<t.length;r+=1){var s=P.OBJECT(t[r]);Array.prototype.push.apply(n,s),e+=s.length,i.push(e)}if(0===n.length)return[0,0];for(var o=[],a=1+Math.floor(Math.log(e)/Math.log(2))/8|0,h=[void 0,P.BYTE,P.USHORT,P.UINT24,P.ULONG][a],l=0;l<i.length;l+=1){var c=h(i[l]);Array.prototype.push.apply(o,c)}return Array.prototype.concat(P.Card16(t.length),P.OffSize(a),o,n)},B.INDEX=function(t){return P.INDEX(t).length},P.DICT=function(t){for(var e=[],i=Object.keys(t),n=i.length,r=0;r<n;r+=1){var s=parseInt(i[r],0),o=t[s];e=(e=e.concat(P.OPERAND(o.value,o.type))).concat(P.OPERATOR(s))}return e},B.DICT=function(t){return P.DICT(t).length},P.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},P.OPERAND=function(t,e){var i=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)O.argument(t.length===e.length,"Not enough arguments given for type"+e),i=i.concat(P.OPERAND(t[n],e[n]));else if("SID"===e)i=i.concat(P.NUMBER(t));else if("offset"===e)i=i.concat(P.NUMBER32(t));else if("number"===e)i=i.concat(P.NUMBER(t));else{if("real"!==e)throw new Error("Unknown operand type "+e);i=i.concat(P.REAL(t))}return i},P.OP=P.BYTE,B.OP=B.BYTE;var Y="function"==typeof WeakMap&&new WeakMap;function W(t,e,i){for(var n=0;n<e.length;n+=1){var r=e[n];this[r.name]=r.value}if(this.tableName=t,this.fields=e,i)for(var s=Object.keys(i),o=0;o<s.length;o+=1){var a=s[o],h=i[a];void 0!==this[a]&&(this[a]=h)}}function j(t,e,i){void 0===i&&(i=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:i};for(var r=0;r<e.length;r++)n[r+1]={name:t+r,type:"USHORT",value:e[r]};return n}function Z(t,e,i){var n=e.length,r=new Array(n+1);r[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)r[s+1]={name:t+s,type:"TABLE",value:i(e[s],s)};return r}function H(t,e,i){var n=e.length,r=[];r[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)r=r.concat(i(e[s],s));return r}function V(t){1===t.format?W.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(j("glyph",t.glyphs))):O.assert(!1,"Can't create coverage table format 2 yet.")}function q(t){W.call(this,"scriptListTable",H("scriptRecord",t,function(t,e){var i=t.script,n=i.defaultLangSys;return O.assert(!!n,"Unable to write GSUB: script "+t.tag+" has no default language system."),[{name:"scriptTag"+e,type:"TAG",value:t.tag},{name:"script"+e,type:"TABLE",value:new W("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new W("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(j("featureIndex",n.featureIndexes)))}].concat(H("langSys",i.langSysRecords,function(t,e){var i=t.langSys;return[{name:"langSysTag"+e,type:"TAG",value:t.tag},{name:"langSys"+e,type:"TABLE",value:new W("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(j("featureIndex",i.featureIndexes)))}]})))}]}))}function K(t){W.call(this,"featureListTable",H("featureRecord",t,function(t,e){var i=t.feature;return[{name:"featureTag"+e,type:"TAG",value:t.tag},{name:"feature"+e,type:"TABLE",value:new W("featureTable",[{name:"featureParams",type:"USHORT",value:i.featureParams}].concat(j("lookupListIndex",i.lookupListIndexes)))}]}))}function J(t,e){W.call(this,"lookupListTable",Z("lookup",t,function(t){var i=e[t.lookupType];return O.assert(!!i,"Unable to write GSUB lookup type "+t.lookupType+" tables."),new W("lookupTable",[{name:"lookupType",type:"USHORT",value:t.lookupType},{name:"lookupFlag",type:"USHORT",value:t.lookupFlag}].concat(Z("subtable",t.subtables,i)))}))}P.CHARSTRING=function(t){if(Y){var e=Y.get(t);if(void 0!==e)return e}for(var i=[],n=t.length,r=0;r<n;r+=1){var s=t[r];i=i.concat(P[s.type](s.value))}return Y&&Y.set(t,i),i},B.CHARSTRING=function(t){return P.CHARSTRING(t).length},P.OBJECT=function(t){var e=P[t.type];return O.argument(void 0!==e,"No encoding function for type "+t.type),e(t.value)},B.OBJECT=function(t){var e=B[t.type];return O.argument(void 0!==e,"No sizeOf function for type "+t.type),e(t.value)},P.TABLE=function(t){for(var e=[],i=t.fields.length,n=[],r=[],s=0;s<i;s+=1){var o=t.fields[s],a=P[o.type];O.argument(void 0!==a,"No encoding function for field type "+o.type+" ("+o.name+")");var h=t[o.name];void 0===h&&(h=o.value);var l=a(h);"TABLE"===o.type?(r.push(e.length),e=e.concat([0,0]),n.push(l)):e=e.concat(l)}for(var c=0;c<n.length;c+=1){var u=r[c],f=e.length;O.argument(f<65536,"Table "+t.tableName+" too big."),e[u]=f>>8,e[u+1]=255&f,e=e.concat(n[c])}return e},B.TABLE=function(t){for(var e=0,i=t.fields.length,n=0;n<i;n+=1){var r=t.fields[n],s=B[r.type];O.argument(void 0!==s,"No sizeOf function for field type "+r.type+" ("+r.name+")");var o=t[r.name];void 0===o&&(o=r.value),e+=s(o),"TABLE"===r.type&&(e+=2)}return e},P.RECORD=P.TABLE,B.RECORD=B.TABLE,P.LITERAL=function(t){return t},B.LITERAL=function(t){return t.length},W.prototype.encode=function(){return P.TABLE(this)},W.prototype.sizeOf=function(){return B.TABLE(this)},V.prototype=Object.create(W.prototype),V.prototype.constructor=V,q.prototype=Object.create(W.prototype),q.prototype.constructor=q,K.prototype=Object.create(W.prototype),K.prototype.constructor=K,J.prototype=Object.create(W.prototype),J.prototype.constructor=J;var Q={Table:W,Record:W,Coverage:V,ScriptList:q,FeatureList:K,LookupList:J,ushortList:j,tableList:Z,recordList:H};function $(t,e){return t.getUint8(e)}function tt(t,e){return t.getUint16(e,!1)}function et(t,e){return t.getUint32(e,!1)}function it(t,e){return t.getInt16(e,!1)+t.getUint16(e+2,!1)/65535}var nt={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function rt(t,e){this.data=t,this.offset=e,this.relativeOffset=0}rt.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},rt.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},rt.prototype.parseCard8=rt.prototype.parseByte,rt.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},rt.prototype.parseCard16=rt.prototype.parseUShort,rt.prototype.parseSID=rt.prototype.parseUShort,rt.prototype.parseOffset16=rt.prototype.parseUShort,rt.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},rt.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},rt.prototype.parseULong=function(){var t=et(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},rt.prototype.parseOffset32=rt.prototype.parseULong,rt.prototype.parseFixed=function(){var t=it(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},rt.prototype.parseString=function(t){var e=this.data,i=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var r=0;r<t;r++)n+=String.fromCharCode(e.getUint8(i+r));return n},rt.prototype.parseTag=function(){return this.parseString(4)},rt.prototype.parseLongDateTime=function(){var t=et(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},rt.prototype.parseVersion=function(t){var e=tt(this.data,this.offset+this.relativeOffset),i=tt(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===t&&(t=4096),e+i/t/10},rt.prototype.skip=function(t,e){void 0===e&&(e=1),this.relativeOffset+=nt[t]*e},rt.prototype.parseULongList=function(t){void 0===t&&(t=this.parseULong());for(var e=new Array(t),i=this.data,n=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=i.getUint32(n),n+=4;return this.relativeOffset+=4*t,e},rt.prototype.parseOffset16List=rt.prototype.parseUShortList=function(t){void 0===t&&(t=this.parseUShort());for(var e=new Array(t),i=this.data,n=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=i.getUint16(n),n+=2;return this.relativeOffset+=2*t,e},rt.prototype.parseShortList=function(t){for(var e=new Array(t),i=this.data,n=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=i.getInt16(n),n+=2;return this.relativeOffset+=2*t,e},rt.prototype.parseByteList=function(t){for(var e=new Array(t),i=this.data,n=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=i.getUint8(n++);return this.relativeOffset+=t,e},rt.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var i=new Array(t),n=0;n<t;n++)i[n]=e.call(this);return i},rt.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var i=new Array(t),n=0;n<t;n++)i[n]=e.call(this);return i},rt.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var i=new Array(t),n=Object.keys(e),r=0;r<t;r++){for(var s={},o=0;o<n.length;o++){var a=n[o],h=e[a];s[a]=h.call(this)}i[r]=s}return i},rt.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var i=new Array(t),n=Object.keys(e),r=0;r<t;r++){for(var s={},o=0;o<n.length;o++){var a=n[o],h=e[a];s[a]=h.call(this)}i[r]=s}return i},rt.prototype.parseStruct=function(t){if("function"==typeof t)return t.call(this);for(var e=Object.keys(t),i={},n=0;n<e.length;n++){var r=e[n],s=t[r];i[r]=s.call(this)}return i},rt.prototype.parseValueRecord=function(t){if(void 0===t&&(t=this.parseUShort()),0!==t){var e={};return 1&t&&(e.xPlacement=this.parseShort()),2&t&&(e.yPlacement=this.parseShort()),4&t&&(e.xAdvance=this.parseShort()),8&t&&(e.yAdvance=this.parseShort()),16&t&&(e.xPlaDevice=void 0,this.parseShort()),32&t&&(e.yPlaDevice=void 0,this.parseShort()),64&t&&(e.xAdvDevice=void 0,this.parseShort()),128&t&&(e.yAdvDevice=void 0,this.parseShort()),e}},rt.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),i=new Array(e),n=0;n<e;n++)i[n]=this.parseValueRecord(t);return i},rt.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new rt(this.data,this.offset+e).parseStruct(t)},rt.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new rt(this.data,this.offset+e).parseStruct(t)},rt.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),i=e.length,n=this.relativeOffset,r=new Array(i),s=0;s<i;s++){var o=e[s];if(0!==o)if(this.relativeOffset=o,t){for(var a=this.parseOffset16List(),h=new Array(a.length),l=0;l<a.length;l++)this.relativeOffset=o+a[l],h[l]=t.call(this);r[s]=h}else r[s]=this.parseUShortList();else r[s]=void 0}return this.relativeOffset=n,r},rt.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),i=this.parseUShort();if(1===e)return{format:1,glyphs:this.parseUShortList(i)};if(2===e){for(var n=new Array(i),r=0;r<i;r++)n[r]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},rt.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(1===e)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===e)return{format:2,ranges:this.parseRecordList({start:rt.uShort,end:rt.uShort,classId:rt.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},rt.list=function(t,e){return function(){return this.parseList(t,e)}},rt.list32=function(t,e){return function(){return this.parseList32(t,e)}},rt.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},rt.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},rt.pointer=function(t){return function(){return this.parsePointer(t)}},rt.pointer32=function(t){return function(){return this.parsePointer32(t)}},rt.tag=rt.prototype.parseTag,rt.byte=rt.prototype.parseByte,rt.uShort=rt.offset16=rt.prototype.parseUShort,rt.uShortList=rt.prototype.parseUShortList,rt.uLong=rt.offset32=rt.prototype.parseULong,rt.uLongList=rt.prototype.parseULongList,rt.struct=rt.prototype.parseStruct,rt.coverage=rt.prototype.parseCoverage,rt.classDef=rt.prototype.parseClassDef;var st={reserved:rt.uShort,reqFeatureIndex:rt.uShort,featureIndexes:rt.uShortList};rt.prototype.parseScriptList=function(){return this.parsePointer(rt.recordList({tag:rt.tag,script:rt.pointer({defaultLangSys:rt.pointer(st),langSysRecords:rt.recordList({tag:rt.tag,langSys:rt.pointer(st)})})}))||[]},rt.prototype.parseFeatureList=function(){return this.parsePointer(rt.recordList({tag:rt.tag,feature:rt.pointer({featureParams:rt.offset16,lookupListIndexes:rt.uShortList})}))||[]},rt.prototype.parseLookupList=function(t){return this.parsePointer(rt.list(rt.pointer(function(){var e=this.parseUShort();O.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var i=this.parseUShort(),n=16&i;return{lookupType:e,lookupFlag:i,subtables:this.parseList(rt.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},rt.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();return O.argument(1===t&&e<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:rt.offset32,featureTableSubstitutionOffset:rt.offset32})})||[]};var ot={getByte:$,getCard8:$,getUShort:tt,getCard16:tt,getShort:function(t,e){return t.getInt16(e,!1)},getULong:et,getFixed:it,getTag:function(t,e){for(var i="",n=e;n<e+4;n+=1)i+=String.fromCharCode(t.getInt8(n));return i},getOffset:function(t,e,i){for(var n=0,r=0;r<i;r+=1)n<<=8,n+=t.getUint8(e+r);return n},getBytes:function(t,e,i){for(var n=[],r=e;r<i;r+=1)n.push(t.getUint8(r));return n},bytesToString:function(t){for(var e="",i=0;i<t.length;i+=1)e+=String.fromCharCode(t[i]);return e},Parser:rt};function at(t,e,i){t.segments.push({end:e,start:e,delta:-(e-i),offset:0,glyphIndex:i})}var ht={parse:function(t,e){var i={};i.version=ot.getUShort(t,e),O.argument(0===i.version,"cmap table version should be 0."),i.numTables=ot.getUShort(t,e+2);for(var n=-1,r=i.numTables-1;r>=0;r-=1){var s=ot.getUShort(t,e+4+8*r),o=ot.getUShort(t,e+4+8*r+2);if(3===s&&(0===o||1===o||10===o)||0===s&&(0===o||1===o||2===o||3===o||4===o)){n=ot.getULong(t,e+4+8*r+4);break}}if(-1===n)throw new Error("No valid cmap sub-tables found.");var a=new ot.Parser(t,e+n);if(i.format=a.parseUShort(),12===i.format)!function(t,e){var i;e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong(),t.groupCount=i=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<i;n+=1)for(var r=e.parseULong(),s=e.parseULong(),o=e.parseULong(),a=r;a<=s;a+=1)t.glyphIndexMap[a]=o,o++}(i,a);else{if(4!==i.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+i.format+").");!function(t,e,i,n,r){var s;t.length=e.parseUShort(),t.language=e.parseUShort(),t.segCount=s=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var o=new ot.Parser(i,n+r+14),a=new ot.Parser(i,n+r+16+2*s),h=new ot.Parser(i,n+r+16+4*s),l=new ot.Parser(i,n+r+16+6*s),c=n+r+16+8*s,u=0;u<s-1;u+=1)for(var f=void 0,d=o.parseUShort(),p=a.parseUShort(),g=h.parseShort(),v=l.parseUShort(),m=p;m<=d;m+=1)0!==v?(c=l.offset+l.relativeOffset-2,c+=v,c+=2*(m-p),0!==(f=ot.getUShort(i,c))&&(f=f+g&65535)):f=m+g&65535,t.glyphIndexMap[m]=f}(i,a,t,e,n)}return i},make:function(t){var e,i=!0;for(e=t.length-1;e>0;e-=1)if(t.get(e).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),i=!1;break}var n=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:i?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:i?12:20}];i||(n=n.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),n=n.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var r=new Q.Table("cmap",n);for(r.segments=[],e=0;e<t.length;e+=1){for(var s=t.get(e),o=0;o<s.unicodes.length;o+=1)at(r,s.unicodes[o],e);r.segments=r.segments.sort(function(t,e){return t.start-e.start})}r.segments.push({end:65535,start:65535,delta:1,offset:0});var a=r.segments.length,h=0,l=[],c=[],u=[],f=[],d=[],p=[];for(e=0;e<a;e+=1){var g=r.segments[e];g.end<=65535&&g.start<=65535?(l=l.concat({name:"end_"+e,type:"USHORT",value:g.end}),c=c.concat({name:"start_"+e,type:"USHORT",value:g.start}),u=u.concat({name:"idDelta_"+e,type:"SHORT",value:g.delta}),f=f.concat({name:"idRangeOffset_"+e,type:"USHORT",value:g.offset}),void 0!==g.glyphId&&(d=d.concat({name:"glyph_"+e,type:"USHORT",value:g.glyphId}))):h+=1,i||void 0===g.glyphIndex||(p=(p=(p=p.concat({name:"cmap12Start_"+e,type:"ULONG",value:g.start})).concat({name:"cmap12End_"+e,type:"ULONG",value:g.end})).concat({name:"cmap12Glyph_"+e,type:"ULONG",value:g.glyphIndex}))}if(r.segCountX2=2*(a-h),r.searchRange=2*Math.pow(2,Math.floor(Math.log(a-h)/Math.log(2))),r.entrySelector=Math.log(r.searchRange/2)/Math.log(2),r.rangeShift=r.segCountX2-r.searchRange,r.fields=r.fields.concat(l),r.fields.push({name:"reservedPad",type:"USHORT",value:0}),r.fields=r.fields.concat(c),r.fields=r.fields.concat(u),r.fields=r.fields.concat(f),r.fields=r.fields.concat(d),r.cmap4Length=14+2*l.length+2+2*c.length+2*u.length+2*f.length+2*d.length,!i){var v=16+4*p.length;r.cmap12Offset=20+r.cmap4Length,r.fields=r.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:v},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:p.length/3}]),r.fields=r.fields.concat(p)}return r}},lt=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],ct=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],ut=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],ft=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function dt(t){this.font=t}function pt(t){this.cmap=t}function gt(t,e){this.encoding=t,this.charset=e}function vt(t){switch(t.version){case 1:this.names=ft.slice();break;case 2:this.names=new Array(t.numberOfGlyphs);for(var e=0;e<t.numberOfGlyphs;e++)t.glyphNameIndex[e]<ft.length?this.names[e]=ft[t.glyphNameIndex[e]]:this.names[e]=t.names[t.glyphNameIndex[e]-ft.length];break;case 2.5:this.names=new Array(t.numberOfGlyphs);for(var i=0;i<t.numberOfGlyphs;i++)this.names[i]=ft[i+t.glyphNameIndex[i]];break;case 3:default:this.names=[]}}dt.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),i=this.font.glyphs;if(i)for(var n=0;n<i.length;n+=1)for(var r=i.get(n),s=0;s<r.unicodes.length;s+=1)if(r.unicodes[s]===e)return n;return null},pt.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.codePointAt(0)]||0},gt.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),i=this.encoding[e];return this.charset.indexOf(i)},vt.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)},vt.prototype.glyphIndexToName=function(t){return this.names[t]};var mt=function(t,e,i,n,r){t.beginPath(),t.moveTo(e,i),t.lineTo(n,r),t.stroke()};function _t(t){this.bindConstructorValues(t)}function yt(t,e,i){Object.defineProperty(t,e,{get:function(){return t.path,t[i]},set:function(e){t[i]=e},enumerable:!0,configurable:!0})}function xt(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var i=0;i<e.length;i++){var n=e[i];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[i]=n}this.length=e&&e.length||0}_t.prototype.bindConstructorValues=function(t){var e,i;this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||void 0!==t.unicode?[t.unicode]:[],t.xMin&&(this.xMin=t.xMin),t.yMin&&(this.yMin=t.yMin),t.xMax&&(this.xMax=t.xMax),t.yMax&&(this.yMax=t.yMax),t.advanceWidth&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",(e=t.path,i=e||new A,{configurable:!0,get:function(){return"function"==typeof i&&(i=i()),i},set:function(t){i=t}}))},_t.prototype.addUnicode=function(t){0===this.unicodes.length&&(this.unicode=t),this.unicodes.push(t)},_t.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},_t.prototype.getPath=function(t,e,i,n,r){var s,o;t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:72,n||(n={});var a=n.xScale,h=n.yScale;if(n.hinting&&r&&r.hinting&&(o=this.path&&r.hinting.exec(this,i)),o)s=r.hinting.getCommands(o),t=Math.round(t),e=Math.round(e),a=h=1;else{s=this.path.commands;var l=1/(this.path.unitsPerEm||1e3)*i;void 0===a&&(a=l),void 0===h&&(h=l)}for(var c=new A,u=0;u<s.length;u+=1){var f=s[u];"M"===f.type?c.moveTo(t+f.x*a,e+-f.y*h):"L"===f.type?c.lineTo(t+f.x*a,e+-f.y*h):"Q"===f.type?c.quadraticCurveTo(t+f.x1*a,e+-f.y1*h,t+f.x*a,e+-f.y*h):"C"===f.type?c.curveTo(t+f.x1*a,e+-f.y1*h,t+f.x2*a,e+-f.y2*h,t+f.x*a,e+-f.y*h):"Z"===f.type&&c.closePath()}return c},_t.prototype.getContours=function(){if(void 0===this.points)return[];for(var t=[],e=[],i=0;i<this.points.length;i+=1){var n=this.points[i];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return O.argument(0===e.length,"There are still points left in the current contour."),t},_t.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],i=[],n=0;n<t.length;n+=1){var r=t[n];"Z"!==r.type&&(e.push(r.x),i.push(r.y)),"Q"!==r.type&&"C"!==r.type||(e.push(r.x1),i.push(r.y1)),"C"===r.type&&(e.push(r.x2),i.push(r.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,i),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},_t.prototype.draw=function(t,e,i,n,r){this.getPath(e,i,n,r).draw(t)},_t.prototype.drawPoints=function(t,e,i,n){function r(e,i,n,r){var s=2*Math.PI;t.beginPath();for(var o=0;o<e.length;o+=1)t.moveTo(i+e[o].x*r,n+e[o].y*r),t.arc(i+e[o].x*r,n+e[o].y*r,2,0,s,!1);t.closePath(),t.fill()}e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:24;for(var s=1/this.path.unitsPerEm*n,o=[],a=[],h=this.path,l=0;l<h.commands.length;l+=1){var c=h.commands[l];void 0!==c.x&&o.push({x:c.x,y:-c.y}),void 0!==c.x1&&a.push({x:c.x1,y:-c.y1}),void 0!==c.x2&&a.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",r(o,e,i,s),t.fillStyle="red",r(a,e,i,s)},_t.prototype.drawMetrics=function(t,e,i,n){var r;e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:24,r=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",mt(t,e,-1e4,e,1e4),mt(t,-1e4,i,1e4,i);var s=this.xMin||0,o=this.yMin||0,a=this.xMax||0,h=this.yMax||0,l=this.advanceWidth||0;t.strokeStyle="blue",mt(t,e+s*r,-1e4,e+s*r,1e4),mt(t,e+a*r,-1e4,e+a*r,1e4),mt(t,-1e4,i+-o*r,1e4,i+-o*r),mt(t,-1e4,i+-h*r,1e4,i+-h*r),t.strokeStyle="green",mt(t,e+l*r,-1e4,e+l*r,1e4)},xt.prototype.get=function(t){if(void 0===this.glyphs[t]){this.font._push(t),"function"==typeof this.glyphs[t]&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],i=this.font._IndexToUnicodeMap[t];if(i)for(var n=0;n<i.unicodes.length;n++)e.addUnicode(i.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else"function"==typeof this.glyphs[t]&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},xt.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};var bt={GlyphSet:xt,glyphLoader:function(t,e){return new _t({index:e,font:t})},ttfGlyphLoader:function(t,e,i,n,r,s){return function(){var o=new _t({index:e,font:t});return o.path=function(){i(o,n,r);var e=s(t.glyphs,o);return e.unitsPerEm=t.unitsPerEm,e},yt(o,"xMin","_xMin"),yt(o,"xMax","_xMax"),yt(o,"yMin","_yMin"),yt(o,"yMax","_yMax"),o}},cffGlyphLoader:function(t,e,i,n){return function(){var r=new _t({index:e,font:t});return r.path=function(){var e=i(t,r,n);return e.unitsPerEm=t.unitsPerEm,e},r}}};function wt(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i+=1)if(!wt(t[i],e[i]))return!1;return!0}return!1}function St(t){return t.length<1240?107:t.length<33900?1131:32768}function Ct(t,e,i){var n,r,s=[],o=[],a=ot.getCard16(t,e);if(0!==a){var h=ot.getByte(t,e+2);n=e+(a+1)*h+2;for(var l=e+3,c=0;c<a+1;c+=1)s.push(ot.getOffset(t,l,h)),l+=h;r=n+s[a]}else r=e+2;for(var u=0;u<s.length-1;u+=1){var f=ot.getBytes(t,n+s[u],n+s[u+1]);i&&(f=i(f)),o.push(f)}return{objects:o,startOffset:e,endOffset:r}}function Tt(t,e){if(28===e)return t.parseByte()<<8|t.parseByte();if(29===e)return t.parseByte()<<24|t.parseByte()<<16|t.parseByte()<<8|t.parseByte();if(30===e)return function(t){for(var e="",i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=t.parseByte(),r=n>>4,s=15&n;if(15===r)break;if(e+=i[r],15===s)break;e+=i[s]}return parseFloat(e)}(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return 256*(e-247)+t.parseByte()+108;if(e>=251&&e<=254)return 256*-(e-251)-t.parseByte()-108;throw new Error("Invalid b0 "+e)}function kt(t,e,i){e=void 0!==e?e:0;var n=new ot.Parser(t,e),r=[],s=[];for(i=void 0!==i?i:t.length;n.relativeOffset<i;){var o=n.parseByte();o<=21?(12===o&&(o=1200+n.parseByte()),r.push([o,s]),s=[]):s.push(Tt(n,o))}return function(t){for(var e={},i=0;i<t.length;i+=1){var n,r=t[i][0],s=t[i][1];if(n=1===s.length?s[0]:s,e.hasOwnProperty(r)&&!isNaN(e[r]))throw new Error("Object "+e+" already has key "+r);e[r]=n}return e}(r)}function Et(t,e){return e<=390?lt[e]:t[e-391]}function At(t,e,i){for(var n,r={},s=0;s<e.length;s+=1){var o=e[s];if(Array.isArray(o.type)){var a=[];a.length=o.type.length;for(var h=0;h<o.type.length;h++)void 0===(n=void 0!==t[o.op]?t[o.op][h]:void 0)&&(n=void 0!==o.value&&void 0!==o.value[h]?o.value[h]:null),"SID"===o.type[h]&&(n=Et(i,n)),a[h]=n;r[o.name]=a}else void 0===(n=t[o.op])&&(n=void 0!==o.value?o.value:null),"SID"===o.type&&(n=Et(i,n)),r[o.name]=n}return r}var Mt=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Dt=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Ot(t,e){return At(kt(t,0,t.byteLength),Mt,e)}function Lt(t,e,i,n){return At(kt(t,e,i),Dt,n)}function Pt(t,e,i,n){for(var r=[],s=0;s<i.length;s+=1){var o=Ot(new DataView(new Uint8Array(i[s]).buffer),n);o._subrs=[],o._subrsBias=0;var a=o.private[0],h=o.private[1];if(0!==a&&0!==h){var l=Lt(t,h+e,a,n);if(o._defaultWidthX=l.defaultWidthX,o._nominalWidthX=l.nominalWidthX,0!==l.subrs){var c=Ct(t,h+l.subrs+e);o._subrs=c.objects,o._subrsBias=St(o._subrs)}o._privateDict=l}r.push(o)}return r}function Bt(t,e,i){var n,r,s,o,a,h,l,c,u=new A,f=[],d=0,p=!1,g=!1,v=0,m=0;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],y=t.tables.cff.topDict._fdArray[_];a=y._subrs,h=y._subrsBias,l=y._defaultWidthX,c=y._nominalWidthX}else a=t.tables.cff.topDict._subrs,h=t.tables.cff.topDict._subrsBias,l=t.tables.cff.topDict._defaultWidthX,c=t.tables.cff.topDict._nominalWidthX;var x=l;function b(t,e){g&&u.closePath(),u.moveTo(t,e),g=!0}function w(){f.length%2!=0&&!p&&(x=f.shift()+c),d+=f.length>>1,f.length=0,p=!0}return function i(l){for(var _,y,S,C,T,k,E,A,M,D,O,L,P=0;P<l.length;){var B=l[P];switch(P+=1,B){case 1:case 3:w();break;case 4:f.length>1&&!p&&(x=f.shift()+c,p=!0),m+=f.pop(),b(v,m);break;case 5:for(;f.length>0;)v+=f.shift(),m+=f.shift(),u.lineTo(v,m);break;case 6:for(;f.length>0&&(v+=f.shift(),u.lineTo(v,m),0!==f.length);)m+=f.shift(),u.lineTo(v,m);break;case 7:for(;f.length>0&&(m+=f.shift(),u.lineTo(v,m),0!==f.length);)v+=f.shift(),u.lineTo(v,m);break;case 8:for(;f.length>0;)n=v+f.shift(),r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),v=s+f.shift(),m=o+f.shift(),u.curveTo(n,r,s,o,v,m);break;case 10:T=f.pop()+h,(k=a[T])&&i(k);break;case 11:return;case 12:switch(B=l[P],P+=1,B){case 35:n=v+f.shift(),r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),E=s+f.shift(),A=o+f.shift(),M=E+f.shift(),D=A+f.shift(),O=M+f.shift(),L=D+f.shift(),v=O+f.shift(),m=L+f.shift(),f.shift(),u.curveTo(n,r,s,o,E,A),u.curveTo(M,D,O,L,v,m);break;case 34:n=v+f.shift(),r=m,s=n+f.shift(),o=r+f.shift(),E=s+f.shift(),A=o,M=E+f.shift(),D=o,O=M+f.shift(),L=m,v=O+f.shift(),u.curveTo(n,r,s,o,E,A),u.curveTo(M,D,O,L,v,m);break;case 36:n=v+f.shift(),r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),E=s+f.shift(),A=o,M=E+f.shift(),D=o,O=M+f.shift(),L=D+f.shift(),v=O+f.shift(),u.curveTo(n,r,s,o,E,A),u.curveTo(M,D,O,L,v,m);break;case 37:n=v+f.shift(),r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),E=s+f.shift(),A=o+f.shift(),M=E+f.shift(),D=A+f.shift(),O=M+f.shift(),L=D+f.shift(),Math.abs(O-v)>Math.abs(L-m)?v=O+f.shift():m=L+f.shift(),u.curveTo(n,r,s,o,E,A),u.curveTo(M,D,O,L,v,m);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+B),f.length=0}break;case 14:f.length>0&&!p&&(x=f.shift()+c,p=!0),g&&(u.closePath(),g=!1);break;case 18:w();break;case 19:case 20:w(),P+=d+7>>3;break;case 21:f.length>2&&!p&&(x=f.shift()+c,p=!0),m+=f.pop(),b(v+=f.pop(),m);break;case 22:f.length>1&&!p&&(x=f.shift()+c,p=!0),b(v+=f.pop(),m);break;case 23:w();break;case 24:for(;f.length>2;)n=v+f.shift(),r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),v=s+f.shift(),m=o+f.shift(),u.curveTo(n,r,s,o,v,m);v+=f.shift(),m+=f.shift(),u.lineTo(v,m);break;case 25:for(;f.length>6;)v+=f.shift(),m+=f.shift(),u.lineTo(v,m);n=v+f.shift(),r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),v=s+f.shift(),m=o+f.shift(),u.curveTo(n,r,s,o,v,m);break;case 26:for(f.length%2&&(v+=f.shift());f.length>0;)n=v,r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),v=s,m=o+f.shift(),u.curveTo(n,r,s,o,v,m);break;case 27:for(f.length%2&&(m+=f.shift());f.length>0;)n=v+f.shift(),r=m,s=n+f.shift(),o=r+f.shift(),v=s+f.shift(),m=o,u.curveTo(n,r,s,o,v,m);break;case 28:_=l[P],y=l[P+1],f.push((_<<24|y<<16)>>16),P+=2;break;case 29:T=f.pop()+t.gsubrsBias,(k=t.gsubrs[T])&&i(k);break;case 30:for(;f.length>0&&(n=v,r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),v=s+f.shift(),m=o+(1===f.length?f.shift():0),u.curveTo(n,r,s,o,v,m),0!==f.length);)n=v+f.shift(),r=m,s=n+f.shift(),o=r+f.shift(),m=o+f.shift(),v=s+(1===f.length?f.shift():0),u.curveTo(n,r,s,o,v,m);break;case 31:for(;f.length>0&&(n=v+f.shift(),r=m,s=n+f.shift(),o=r+f.shift(),m=o+f.shift(),v=s+(1===f.length?f.shift():0),u.curveTo(n,r,s,o,v,m),0!==f.length);)n=v,r=m+f.shift(),s=n+f.shift(),o=r+f.shift(),v=s+f.shift(),m=o+(1===f.length?f.shift():0),u.curveTo(n,r,s,o,v,m);break;default:B<32?console.log("Glyph "+e.index+": unknown operator "+B):B<247?f.push(B-139):B<251?(_=l[P],P+=1,f.push(256*(B-247)+_+108)):B<255?(_=l[P],P+=1,f.push(256*-(B-251)-_-108)):(_=l[P],y=l[P+1],S=l[P+2],C=l[P+3],P+=4,f.push((_<<24|y<<16|S<<8|C)/65536))}}}(i),e.advanceWidth=x,u}function It(t,e){var i,n=lt.indexOf(t);return n>=0&&(i=n),(n=e.indexOf(t))>=0?i=n+lt.length:(i=lt.length+e.length,e.push(t)),i}function Rt(t,e,i){for(var n={},r=0;r<t.length;r+=1){var s=t[r],o=e[s.name];void 0===o||wt(o,s.value)||("SID"===s.type&&(o=It(o,i)),n[s.op]={name:s.name,type:s.type,value:o})}return n}function Ft(t,e){var i=new Q.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return i.dict=Rt(Mt,t,e),i}function Ut(t){var e=new Q.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function Nt(t){var e=[],i=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,r=0,s=0;s<i.commands.length;s+=1){var o=void 0,a=void 0,h=i.commands[s];if("Q"===h.type&&(h={type:"C",x:h.x,y:h.y,x1:1/3*n+2/3*h.x1,y1:1/3*r+2/3*h.y1,x2:1/3*h.x+2/3*h.x1,y2:1/3*h.y+2/3*h.y1}),"M"===h.type)o=Math.round(h.x-n),a=Math.round(h.y-r),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(h.x),r=Math.round(h.y);else if("L"===h.type)o=Math.round(h.x-n),a=Math.round(h.y-r),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(h.x),r=Math.round(h.y);else if("C"===h.type){var l=Math.round(h.x1-n),c=Math.round(h.y1-r),u=Math.round(h.x2-h.x1),f=Math.round(h.y2-h.y1);o=Math.round(h.x-h.x2),a=Math.round(h.y-h.y2),e.push({name:"dx1",type:"NUMBER",value:l}),e.push({name:"dy1",type:"NUMBER",value:c}),e.push({name:"dx2",type:"NUMBER",value:u}),e.push({name:"dy2",type:"NUMBER",value:f}),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(h.x),r=Math.round(h.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}var zt={parse:function(t,e,i,n){i.tables.cff={};var r=function(t,e){var i={};return i.formatMajor=ot.getCard8(t,e),i.formatMinor=ot.getCard8(t,e+1),i.size=ot.getCard8(t,e+2),i.offsetSize=ot.getCard8(t,e+3),i.startOffset=e,i.endOffset=e+4,i}(t,e),s=Ct(t,r.endOffset,ot.bytesToString),o=Ct(t,s.endOffset),a=Ct(t,o.endOffset,ot.bytesToString),h=Ct(t,a.endOffset);i.gsubrs=h.objects,i.gsubrsBias=St(i.gsubrs);var l=Pt(t,e,o.objects,a.objects);if(1!==l.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+l.length);var c=l[0];if(i.tables.cff.topDict=c,c._privateDict&&(i.defaultWidthX=c._privateDict.defaultWidthX,i.nominalWidthX=c._privateDict.nominalWidthX),void 0!==c.ros[0]&&void 0!==c.ros[1]&&(i.isCIDFont=!0),i.isCIDFont){var u=c.fdArray,f=c.fdSelect;if(0===u||0===f)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var d=Ct(t,u+=e),p=Pt(t,e,d.objects,a.objects);c._fdArray=p,f+=e,c._fdSelect=function(t,e,i,n){var r,s=[],o=new ot.Parser(t,e),a=o.parseCard8();if(0===a)for(var h=0;h<i;h++){if((r=o.parseCard8())>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+r+" (FD count "+n+")");s.push(r)}else{if(3!==a)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+a);var l,c=o.parseCard16(),u=o.parseCard16();if(0!==u)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+u);for(var f=0;f<c;f++){if(r=o.parseCard8(),l=o.parseCard16(),r>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+r+" (FD count "+n+")");if(l>i)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+l);for(;u<l;u++)s.push(r);u=l}if(l!==i)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+l)}return s}(t,f,i.numGlyphs,p.length)}var g,v=e+c.private[1],m=Lt(t,v,c.private[0],a.objects);if(i.defaultWidthX=m.defaultWidthX,i.nominalWidthX=m.nominalWidthX,0!==m.subrs){var _=v+m.subrs,y=Ct(t,_);i.subrs=y.objects,i.subrsBias=St(i.subrs)}else i.subrs=[],i.subrsBias=0;n.lowMemory?(g=function(t,e){var i,n,r=[],s=ot.getCard16(t,e);if(0!==s){var o=ot.getByte(t,e+2);i=e+(s+1)*o+2;for(var a=e+3,h=0;h<s+1;h+=1)r.push(ot.getOffset(t,a,o)),a+=o;n=i+r[s]}else n=e+2;return{offsets:r,startOffset:e,endOffset:n}}(t,e+c.charStrings),i.nGlyphs=g.offsets.length):(g=Ct(t,e+c.charStrings),i.nGlyphs=g.objects.length);var x=function(t,e,i,n){var r,s,o=new ot.Parser(t,e);i-=1;var a=[".notdef"],h=o.parseCard8();if(0===h)for(var l=0;l<i;l+=1)r=o.parseSID(),a.push(Et(n,r));else if(1===h)for(;a.length<=i;){r=o.parseSID(),s=o.parseCard8();for(var c=0;c<=s;c+=1)a.push(Et(n,r)),r+=1}else{if(2!==h)throw new Error("Unknown charset format "+h);for(;a.length<=i;){r=o.parseSID(),s=o.parseCard16();for(var u=0;u<=s;u+=1)a.push(Et(n,r)),r+=1}}return a}(t,e+c.charset,i.nGlyphs,a.objects);if(0===c.encoding?i.cffEncoding=new gt(ct,x):1===c.encoding?i.cffEncoding=new gt(ut,x):i.cffEncoding=function(t,e,i){var n,r={},s=new ot.Parser(t,e),o=s.parseCard8();if(0===o)for(var a=s.parseCard8(),h=0;h<a;h+=1)r[n=s.parseCard8()]=h;else{if(1!==o)throw new Error("Unknown encoding format "+o);var l=s.parseCard8();n=1;for(var c=0;c<l;c+=1)for(var u=s.parseCard8(),f=s.parseCard8(),d=u;d<=u+f;d+=1)r[d]=n,n+=1}return new gt(r,i)}(t,e+c.encoding,x),i.encoding=i.encoding||i.cffEncoding,i.glyphs=new bt.GlyphSet(i),n.lowMemory)i._push=function(n){var r=function(t,e,i,n,r){var s=ot.getCard16(i,n),o=0;0!==s&&(o=n+(s+1)*ot.getByte(i,n+2)+2);var a=ot.getBytes(i,o+e[t],o+e[t+1]);return a}(n,g.offsets,t,e+c.charStrings);i.glyphs.push(n,bt.cffGlyphLoader(i,n,Bt,r))};else for(var b=0;b<i.nGlyphs;b+=1){var w=g.objects[b];i.glyphs.push(b,bt.cffGlyphLoader(i,b,Bt,w))}},make:function(t,e){for(var i,n=new Q.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),r=1/e.unitsPerEm,s={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[r,0,0,r,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o=[],a=1;a<t.length;a+=1)i=t.get(a),o.push(i.name);var h=[];n.header=new Q.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),n.nameIndex=function(t){var e=new Q.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var i=0;i<t.length;i+=1)e.names.push({name:"name_"+i,type:"NAME",value:t[i]});return e}([e.postScriptName]);var l=Ft(s,h);n.topDictIndex=Ut(l),n.globalSubrIndex=new Q.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),n.charsets=function(t,e){for(var i=new Q.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var r=It(t[n],e);i.fields.push({name:"glyph_"+n,type:"SID",value:r})}return i}(o,h),n.charStringsIndex=function(t){for(var e=new Q.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),i=0;i<t.length;i+=1){var n=t.get(i),r=Nt(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:r})}return e}(t),n.privateDict=function(t,e){var i=new Q.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return i.dict=Rt(Dt,{},e),i}(0,h),n.stringIndex=function(t){var e=new Q.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var i=0;i<t.length;i+=1)e.strings.push({name:"string_"+i,type:"STRING",value:t[i]});return e}(h);var c=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return s.charset=c,s.encoding=0,s.charStrings=s.charset+n.charsets.sizeOf(),s.private[1]=s.charStrings+n.charStringsIndex.sizeOf(),l=Ft(s,h),n.topDictIndex=Ut(l),n}},Gt={parse:function(t,e){var i={},n=new ot.Parser(t,e);return i.version=n.parseVersion(),i.fontRevision=Math.round(1e3*n.parseFixed())/1e3,i.checkSumAdjustment=n.parseULong(),i.magicNumber=n.parseULong(),O.argument(1594834165===i.magicNumber,"Font header has wrong magic number."),i.flags=n.parseUShort(),i.unitsPerEm=n.parseUShort(),i.created=n.parseLongDateTime(),i.modified=n.parseLongDateTime(),i.xMin=n.parseShort(),i.yMin=n.parseShort(),i.xMax=n.parseShort(),i.yMax=n.parseShort(),i.macStyle=n.parseUShort(),i.lowestRecPPEM=n.parseUShort(),i.fontDirectionHint=n.parseShort(),i.indexToLocFormat=n.parseShort(),i.glyphDataFormat=n.parseShort(),i},make:function(t){var e=Math.round((new Date).getTime()/1e3)+2082844800,i=e;return t.createdTimestamp&&(i=t.createdTimestamp+2082844800),new Q.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:i},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}},Xt={parse:function(t,e){var i={},n=new ot.Parser(t,e);return i.version=n.parseVersion(),i.ascender=n.parseShort(),i.descender=n.parseShort(),i.lineGap=n.parseShort(),i.advanceWidthMax=n.parseUShort(),i.minLeftSideBearing=n.parseShort(),i.minRightSideBearing=n.parseShort(),i.xMaxExtent=n.parseShort(),i.caretSlopeRise=n.parseShort(),i.caretSlopeRun=n.parseShort(),i.caretOffset=n.parseShort(),n.relativeOffset+=8,i.metricDataFormat=n.parseShort(),i.numberOfHMetrics=n.parseUShort(),i},make:function(t){return new Q.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}},Yt={parse:function(t,e,i,n,r,s,o){o.lowMemory?function(t,e,i,n,r){var s,o;t._hmtxTableData={};for(var a=new ot.Parser(e,i),h=0;h<r;h+=1)h<n&&(s=a.parseUShort(),o=a.parseShort()),t._hmtxTableData[h]={advanceWidth:s,leftSideBearing:o}}(t,e,i,n,r):function(t,e,i,n,r){for(var s,o,a=new ot.Parser(t,e),h=0;h<n;h+=1){h<i&&(s=a.parseUShort(),o=a.parseShort());var l=r.get(h);l.advanceWidth=s,l.leftSideBearing=o}}(e,i,n,r,s)},make:function(t){for(var e=new Q.Table("hmtx",[]),i=0;i<t.length;i+=1){var n=t.get(i),r=n.advanceWidth||0,s=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+i,type:"USHORT",value:r}),e.fields.push({name:"leftSideBearing_"+i,type:"SHORT",value:s})}return e}},Wt={make:function(t){for(var e=new Q.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),i="",n=12+4*t.length,r=0;r<t.length;++r){var s=i.indexOf(t[r]);s<0&&(s=i.length,i+=t[r]),e.fields.push({name:"offset "+r,type:"USHORT",value:n+s}),e.fields.push({name:"length "+r,type:"USHORT",value:t[r].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:i}),e},parse:function(t,e){var i=new ot.Parser(t,e),n=i.parseULong();O.argument(1===n,"Unsupported ltag table version."),i.skip("uLong",1);for(var r=i.parseULong(),s=[],o=0;o<r;o++){for(var a="",h=e+i.parseUShort(),l=i.parseUShort(),c=h;c<h+l;++c)a+=String.fromCharCode(t.getInt8(c));s.push(a)}return s}},jt={parse:function(t,e){var i={},n=new ot.Parser(t,e);return i.version=n.parseVersion(),i.numGlyphs=n.parseUShort(),1===i.version&&(i.maxPoints=n.parseUShort(),i.maxContours=n.parseUShort(),i.maxCompositePoints=n.parseUShort(),i.maxCompositeContours=n.parseUShort(),i.maxZones=n.parseUShort(),i.maxTwilightPoints=n.parseUShort(),i.maxStorage=n.parseUShort(),i.maxFunctionDefs=n.parseUShort(),i.maxInstructionDefs=n.parseUShort(),i.maxStackElements=n.parseUShort(),i.maxSizeOfInstructions=n.parseUShort(),i.maxComponentElements=n.parseUShort(),i.maxComponentDepth=n.parseUShort()),i},make:function(t){return new Q.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}},Zt=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Ht={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Vt={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},qt={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Kt(t,e,i){switch(t){case 0:if(65535===e)return"und";if(i)return i[e];break;case 1:return Ht[e];case 3:return qt[e]}}var Jt="utf-16",Qt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},$t={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function te(t,e,i){switch(t){case 0:return Jt;case 1:return $t[i]||Qt[e];case 3:if(1===e||10===e)return Jt}}function ee(t){var e={};for(var i in t)e[t[i]]=parseInt(i);return e}function ie(t,e,i,n,r,s){return new Q.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:i},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:r},{name:"offset",type:"USHORT",value:s}])}function ne(t,e){var i=function(t,e){var i=t.length,n=e.length-i+1;t:for(var r=0;r<n;r++)for(;r<n;r++){for(var s=0;s<i;s++)if(e[r+s]!==t[s])continue t;return r}return-1}(t,e);if(i<0){i=e.length;for(var n=0,r=t.length;n<r;++n)e.push(t[n])}return i}var re={parse:function(t,e,i){for(var n={},r=new ot.Parser(t,e),s=r.parseUShort(),o=r.parseUShort(),a=r.offset+r.parseUShort(),h=0;h<o;h++){var l=r.parseUShort(),c=r.parseUShort(),u=r.parseUShort(),f=r.parseUShort(),d=Zt[f]||f,p=r.parseUShort(),g=r.parseUShort(),v=Kt(l,u,i),m=te(l,c,u);if(void 0!==m&&void 0!==v){var _;if(_=m===Jt?L.UTF16(t,a+g,p):L.MACSTRING(t,a+g,p,m)){var y=n[d];void 0===y&&(y=n[d]={}),y[v]=_}}}return 1===s&&r.parseUShort(),n},make:function(t,e){var i,n=[],r={},s=ee(Zt);for(var o in t){var a=s[o];if(void 0===a&&(a=o),i=parseInt(a),isNaN(i))throw new Error('Name table entry "'+o+'" does not exist, see nameTableNames for complete list.');r[i]=t[o],n.push(i)}for(var h=ee(Ht),l=ee(qt),c=[],u=[],f=0;f<n.length;f++){var d=r[i=n[f]];for(var p in d){var g=d[p],v=1,m=h[p],_=Vt[m],y=te(v,_,m),x=P.MACSTRING(g,y);void 0===x&&(v=0,(m=e.indexOf(p))<0&&(m=e.length,e.push(p)),_=4,x=P.UTF16(g));var b=ne(x,u);c.push(ie(v,_,m,i,x.length,b));var w=l[p];if(void 0!==w){var S=P.UTF16(g),C=ne(S,u);c.push(ie(3,1,w,i,S.length,C))}}}c.sort(function(t,e){return t.platformID-e.platformID||t.encodingID-e.encodingID||t.languageID-e.languageID||t.nameID-e.nameID});for(var T=new Q.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+12*c.length}]),k=0;k<c.length;k++)T.fields.push({name:"record_"+k,type:"RECORD",value:c[k]});return T.fields.push({name:"strings",type:"LITERAL",value:u}),T}},se=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}],oe={parse:function(t,e){var i={},n=new ot.Parser(t,e);i.version=n.parseUShort(),i.xAvgCharWidth=n.parseShort(),i.usWeightClass=n.parseUShort(),i.usWidthClass=n.parseUShort(),i.fsType=n.parseUShort(),i.ySubscriptXSize=n.parseShort(),i.ySubscriptYSize=n.parseShort(),i.ySubscriptXOffset=n.parseShort(),i.ySubscriptYOffset=n.parseShort(),i.ySuperscriptXSize=n.parseShort(),i.ySuperscriptYSize=n.parseShort(),i.ySuperscriptXOffset=n.parseShort(),i.ySuperscriptYOffset=n.parseShort(),i.yStrikeoutSize=n.parseShort(),i.yStrikeoutPosition=n.parseShort(),i.sFamilyClass=n.parseShort(),i.panose=[];for(var r=0;r<10;r++)i.panose[r]=n.parseByte();return i.ulUnicodeRange1=n.parseULong(),i.ulUnicodeRange2=n.parseULong(),i.ulUnicodeRange3=n.parseULong(),i.ulUnicodeRange4=n.parseULong(),i.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),i.fsSelection=n.parseUShort(),i.usFirstCharIndex=n.parseUShort(),i.usLastCharIndex=n.parseUShort(),i.sTypoAscender=n.parseShort(),i.sTypoDescender=n.parseShort(),i.sTypoLineGap=n.parseShort(),i.usWinAscent=n.parseUShort(),i.usWinDescent=n.parseUShort(),i.version>=1&&(i.ulCodePageRange1=n.parseULong(),i.ulCodePageRange2=n.parseULong()),i.version>=2&&(i.sxHeight=n.parseShort(),i.sCapHeight=n.parseShort(),i.usDefaultChar=n.parseUShort(),i.usBreakChar=n.parseUShort(),i.usMaxContent=n.parseUShort()),i},make:function(t){return new Q.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)},unicodeRanges:se,getUnicodeRange:function(t){for(var e=0;e<se.length;e+=1){var i=se[e];if(t>=i.begin&&t<i.end)return e}return-1}},ae={parse:function(t,e){var i={},n=new ot.Parser(t,e);switch(i.version=n.parseVersion(),i.italicAngle=n.parseFixed(),i.underlinePosition=n.parseShort(),i.underlineThickness=n.parseShort(),i.isFixedPitch=n.parseULong(),i.minMemType42=n.parseULong(),i.maxMemType42=n.parseULong(),i.minMemType1=n.parseULong(),i.maxMemType1=n.parseULong(),i.version){case 1:i.names=ft.slice();break;case 2:i.numberOfGlyphs=n.parseUShort(),i.glyphNameIndex=new Array(i.numberOfGlyphs);for(var r=0;r<i.numberOfGlyphs;r++)i.glyphNameIndex[r]=n.parseUShort();i.names=[];for(var s=0;s<i.numberOfGlyphs;s++)if(i.glyphNameIndex[s]>=ft.length){var o=n.parseChar();i.names.push(n.parseString(o))}break;case 2.5:i.numberOfGlyphs=n.parseUShort(),i.offset=new Array(i.numberOfGlyphs);for(var a=0;a<i.numberOfGlyphs;a++)i.offset[a]=n.parseChar()}return i},make:function(){return new Q.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},he=new Array(9);he[1]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{substFormat:1,coverage:this.parsePointer(rt.coverage),deltaGlyphId:this.parseUShort()}:2===e?{substFormat:2,coverage:this.parsePointer(rt.coverage),substitute:this.parseOffset16List()}:void O.assert(!1,"0x"+t.toString(16)+": lookup type 1 format must be 1 or 2.")},he[2]=function(){var t=this.parseUShort();return O.argument(1===t,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),sequences:this.parseListOfLists()}},he[3]=function(){var t=this.parseUShort();return O.argument(1===t,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),alternateSets:this.parseListOfLists()}},he[4]=function(){var t=this.parseUShort();return O.argument(1===t,"GSUB ligature table identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var le={sequenceIndex:rt.uShort,lookupListIndex:rt.uShort};he[5]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(1===e)return{substFormat:e,coverage:this.parsePointer(rt.coverage),ruleSets:this.parseListOfLists(function(){var t=this.parseUShort(),e=this.parseUShort();return{input:this.parseUShortList(t-1),lookupRecords:this.parseRecordList(e,le)}})};if(2===e)return{substFormat:e,coverage:this.parsePointer(rt.coverage),classDef:this.parsePointer(rt.classDef),classSets:this.parseListOfLists(function(){var t=this.parseUShort(),e=this.parseUShort();return{classes:this.parseUShortList(t-1),lookupRecords:this.parseRecordList(e,le)}})};if(3===e){var i=this.parseUShort(),n=this.parseUShort();return{substFormat:e,coverages:this.parseList(i,rt.pointer(rt.coverage)),lookupRecords:this.parseRecordList(n,le)}}O.assert(!1,"0x"+t.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},he[6]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{substFormat:1,coverage:this.parsePointer(rt.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(le)}})}:2===e?{substFormat:2,coverage:this.parsePointer(rt.coverage),backtrackClassDef:this.parsePointer(rt.classDef),inputClassDef:this.parsePointer(rt.classDef),lookaheadClassDef:this.parsePointer(rt.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(le)}})}:3===e?{substFormat:3,backtrackCoverage:this.parseList(rt.pointer(rt.coverage)),inputCoverage:this.parseList(rt.pointer(rt.coverage)),lookaheadCoverage:this.parseList(rt.pointer(rt.coverage)),lookupRecords:this.parseRecordList(le)}:void O.assert(!1,"0x"+t.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},he[7]=function(){var t=this.parseUShort();O.argument(1===t,"GSUB Extension Substitution subtable identifier-format must be 1");var e=this.parseUShort(),i=new rt(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:e,extension:he[e].call(i)}},he[8]=function(){var t=this.parseUShort();return O.argument(1===t,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(rt.coverage),backtrackCoverage:this.parseList(rt.pointer(rt.coverage)),lookaheadCoverage:this.parseList(rt.pointer(rt.coverage)),substitutes:this.parseUShortList()}};var ce=new Array(9);ce[1]=function(t){return 1===t.substFormat?new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)},{name:"deltaGlyphID",type:"USHORT",value:t.deltaGlyphId}]):new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)}].concat(Q.ushortList("substitute",t.substitute)))},ce[3]=function(t){return O.assert(1===t.substFormat,"Lookup type 3 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)}].concat(Q.tableList("altSet",t.alternateSets,function(t){return new Q.Table("alternateSetTable",Q.ushortList("alternate",t))})))},ce[4]=function(t){return O.assert(1===t.substFormat,"Lookup type 4 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(t.coverage)}].concat(Q.tableList("ligSet",t.ligatureSets,function(t){return new Q.Table("ligatureSetTable",Q.tableList("ligature",t,function(t){return new Q.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:t.ligGlyph}].concat(Q.ushortList("component",t.components,t.components.length+1)))}))})))};var ue={parse:function(t,e){var i=new rt(t,e=e||0),n=i.parseVersion(1);return O.argument(1===n||1.1===n,"Unsupported GSUB table version."),1===n?{version:n,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(he)}:{version:n,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(he),variations:i.parseFeatureVariationsList()}},make:function(t){return new Q.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Q.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Q.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Q.LookupList(t.lookups,ce)}])}},fe={parse:function(t,e){var i=new ot.Parser(t,e),n=i.parseULong();O.argument(1===n,"Unsupported META table version."),i.parseULong(),i.parseULong();for(var r=i.parseULong(),s={},o=0;o<r;o++){var a=i.parseTag(),h=i.parseULong(),l=i.parseULong(),c=L.UTF8(t,e+h,l);s[a]=c}return s},make:function(t){var e=Object.keys(t).length,i="",n=16+12*e,r=new Q.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var s in t){var o=i.length;i+=t[s],r.fields.push({name:"tag "+s,type:"TAG",value:s}),r.fields.push({name:"offset "+s,type:"ULONG",value:n+o}),r.fields.push({name:"length "+s,type:"ULONG",value:t[s].length})}return r.fields.push({name:"stringPool",type:"CHARARRAY",value:i}),r}};function de(t){return Math.log(t)/Math.log(2)|0}function pe(t){for(;t.length%4!=0;)t.push(0);for(var e=0,i=0;i<t.length;i+=4)e+=(t[i]<<24)+(t[i+1]<<16)+(t[i+2]<<8)+t[i+3];return e%Math.pow(2,32)}function ge(t,e,i,n){return new Q.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==t?t:""},{name:"checkSum",type:"ULONG",value:void 0!==e?e:0},{name:"offset",type:"ULONG",value:void 0!==i?i:0},{name:"length",type:"ULONG",value:void 0!==n?n:0}])}function ve(t){var e=new Q.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var i=Math.pow(2,de(e.numTables));e.searchRange=16*i,e.entrySelector=de(i),e.rangeShift=16*e.numTables-e.searchRange;for(var n=[],r=[],s=e.sizeOf()+ge().sizeOf()*e.numTables;s%4!=0;)s+=1,r.push({name:"padding",type:"BYTE",value:0});for(var o=0;o<t.length;o+=1){var a=t[o];O.argument(4===a.tableName.length,"Table name"+a.tableName+" is invalid.");var h=a.sizeOf(),l=ge(a.tableName,pe(a.encode()),s,h);for(n.push({name:l.tag+" Table Record",type:"RECORD",value:l}),r.push({name:a.tableName+" table",type:"RECORD",value:a}),s+=h,O.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!=0;)s+=1,r.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(t,e){return t.value.tag>e.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(r),e}function me(t,e,i){for(var n=0;n<e.length;n+=1){var r=t.charToGlyphIndex(e[n]);if(r>0)return t.glyphs.get(r).getMetrics()}return i}function _e(t){for(var e=0,i=0;i<t.length;i+=1)e+=t[i];return e/t.length}var ye=function(t){for(var e,i=[],n=[],r=[],s=[],o=[],a=[],h=[],l=0,c=0,u=0,f=0,d=0,p=0;p<t.glyphs.length;p+=1){var g=t.glyphs.get(p),v=0|g.unicode;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+p+"): advanceWidth is not a number.");(e>v||void 0===e)&&v>0&&(e=v),l<v&&(l=v);var m=oe.getUnicodeRange(v);if(m<32)c|=1<<m;else if(m<64)u|=1<<m-32;else if(m<96)f|=1<<m-64;else{if(!(m<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");d|=1<<m-96}if(".notdef"!==g.name){var _=g.getMetrics();i.push(_.xMin),n.push(_.yMin),r.push(_.xMax),s.push(_.yMax),a.push(_.leftSideBearing),h.push(_.rightSideBearing),o.push(g.advanceWidth)}}var y={xMin:Math.min.apply(null,i),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,r),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:_e(o),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,h)};y.ascender=t.ascender,y.descender=t.descender;var x=Gt.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:y.xMin,yMin:y.yMin,xMax:y.xMax,yMax:y.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),b=Xt.make({ascender:y.ascender,descender:y.descender,advanceWidthMax:y.advanceWidthMax,minLeftSideBearing:y.minLeftSideBearing,minRightSideBearing:y.minRightSideBearing,xMaxExtent:y.maxLeftSideBearing+(y.xMax-y.xMin),numberOfHMetrics:t.glyphs.length}),w=jt.make(t.glyphs.length),S=oe.make({xAvgCharWidth:Math.round(y.advanceWidthAvg),usWeightClass:t.tables.os2.usWeightClass,usWidthClass:t.tables.os2.usWidthClass,usFirstCharIndex:e,usLastCharIndex:l,ulUnicodeRange1:c,ulUnicodeRange2:u,ulUnicodeRange3:f,ulUnicodeRange4:d,fsSelection:t.tables.os2.fsSelection,sTypoAscender:y.ascender,sTypoDescender:y.descender,sTypoLineGap:0,usWinAscent:y.yMax,usWinDescent:Math.abs(y.yMin),ulCodePageRange1:1,sxHeight:me(t,"xyvw",{yMax:Math.round(y.ascender/2)}).yMax,sCapHeight:me(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",y).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0}),C=Yt.make(t.glyphs),T=ht.make(t.glyphs),k=t.getEnglishName("fontFamily"),E=t.getEnglishName("fontSubfamily"),A=k+" "+E,M=t.getEnglishName("postScriptName");M||(M=k.replace(/\s/g,"")+"-"+E);var D={};for(var O in t.names)D[O]=t.names[O];D.uniqueID||(D.uniqueID={en:t.getEnglishName("manufacturer")+":"+A}),D.postScriptName||(D.postScriptName={en:M}),D.preferredFamily||(D.preferredFamily=t.names.fontFamily),D.preferredSubfamily||(D.preferredSubfamily=t.names.fontSubfamily);var L=[],P=re.make(D,L),B=L.length>0?Wt.make(L):void 0,I=ae.make(),R=zt.make(t.glyphs,{version:t.getEnglishName("version"),fullName:A,familyName:k,weightName:E,postScriptName:M,unitsPerEm:t.unitsPerEm,fontBBox:[0,y.yMin,y.ascender,y.advanceWidthMax]}),F=t.metas&&Object.keys(t.metas).length>0?fe.make(t.metas):void 0,U=[x,b,w,S,P,T,I,R,C];B&&U.push(B),t.tables.gsub&&U.push(ue.make(t.tables.gsub)),F&&U.push(F);for(var N=ve(U),z=pe(N.encode()),G=N.fields,X=!1,Y=0;Y<G.length;Y+=1)if("head table"===G[Y].name){G[Y].value.checkSumAdjustment=2981146554-z,X=!0;break}if(!X)throw new Error("Could not find head table with checkSum to adjust.");return N};function xe(t,e){for(var i=0,n=t.length-1;i<=n;){var r=i+n>>>1,s=t[r].tag;if(s===e)return r;s<e?i=r+1:n=r-1}return-i-1}function be(t,e){for(var i=0,n=t.length-1;i<=n;){var r=i+n>>>1,s=t[r];if(s===e)return r;s<e?i=r+1:n=r-1}return-i-1}function we(t,e){for(var i,n=0,r=t.length-1;n<=r;){var s=n+r>>>1,o=(i=t[s]).start;if(o===e)return i;o<e?n=s+1:r=s-1}if(n>0)return e>(i=t[n-1]).end?0:i}function Se(t,e){this.font=t,this.tableName=e}function Ce(t){Se.call(this,t,"gpos")}function Te(t){Se.call(this,t,"gsub")}function ke(t,e){var i=t.length;if(i!==e.length)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ee(t,e,i){for(var n=t.subtables,r=0;r<n.length;r++){var s=n[r];if(s.substFormat===e)return s}if(i)return n.push(i),i}function Ae(t){for(var e=new ArrayBuffer(t.length),i=new Uint8Array(e),n=0;n<t.length;++n)i[n]=t[n];return e}function Me(t,e){if(!t)throw e}function De(t,e,i,n,r){var s;return(e&n)>0?(s=t.parseByte(),0==(e&r)&&(s=-s),s=i+s):s=(e&r)>0?i:i+t.parseShort(),s}function Oe(t,e,i){var n,r,s=new ot.Parser(e,i);if(t.numberOfContours=s.parseShort(),t._xMin=s.parseShort(),t._yMin=s.parseShort(),t._xMax=s.parseShort(),t._yMax=s.parseShort(),t.numberOfContours>0){for(var o=t.endPointIndices=[],a=0;a<t.numberOfContours;a+=1)o.push(s.parseUShort());t.instructionLength=s.parseUShort(),t.instructions=[];for(var h=0;h<t.instructionLength;h+=1)t.instructions.push(s.parseByte());var l=o[o.length-1]+1;n=[];for(var c=0;c<l;c+=1)if(r=s.parseByte(),n.push(r),(8&r)>0)for(var u=s.parseByte(),f=0;f<u;f+=1)n.push(r),c+=1;if(O.argument(n.length===l,"Bad flags."),o.length>0){var d,p=[];if(l>0){for(var g=0;g<l;g+=1)r=n[g],(d={}).onCurve=!!(1&r),d.lastPointOfContour=o.indexOf(g)>=0,p.push(d);for(var v=0,m=0;m<l;m+=1)r=n[m],(d=p[m]).x=De(s,r,v,2,16),v=d.x;for(var _=0,y=0;y<l;y+=1)r=n[y],(d=p[y]).y=De(s,r,_,4,32),_=d.y}t.points=p}else t.points=[]}else if(0===t.numberOfContours)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var x=!0;x;){n=s.parseUShort();var b={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&n)>0?(2&n)>0?(b.dx=s.parseShort(),b.dy=s.parseShort()):b.matchedPoints=[s.parseUShort(),s.parseUShort()]:(2&n)>0?(b.dx=s.parseChar(),b.dy=s.parseChar()):b.matchedPoints=[s.parseByte(),s.parseByte()],(8&n)>0?b.xScale=b.yScale=s.parseF2Dot14():(64&n)>0?(b.xScale=s.parseF2Dot14(),b.yScale=s.parseF2Dot14()):(128&n)>0&&(b.xScale=s.parseF2Dot14(),b.scale01=s.parseF2Dot14(),b.scale10=s.parseF2Dot14(),b.yScale=s.parseF2Dot14()),t.components.push(b),x=!!(32&n)}if(256&n){t.instructionLength=s.parseUShort(),t.instructions=[];for(var w=0;w<t.instructionLength;w+=1)t.instructions.push(s.parseByte())}}}function Le(t,e){for(var i=[],n=0;n<t.length;n+=1){var r=t[n],s={x:e.xScale*r.x+e.scale01*r.y+e.dx,y:e.scale10*r.x+e.yScale*r.y+e.dy,onCurve:r.onCurve,lastPointOfContour:r.lastPointOfContour};i.push(s)}return i}function Pe(t){var e=new A;if(!t)return e;for(var i=function(t){for(var e=[],i=[],n=0;n<t.length;n+=1){var r=t[n];i.push(r),r.lastPointOfContour&&(e.push(i),i=[])}return O.argument(0===i.length,"There are still points left in the current contour."),e}(t),n=0;n<i.length;++n){var r=i[n],s=null,o=r[r.length-1],a=r[0];if(o.onCurve)e.moveTo(o.x,o.y);else if(a.onCurve)e.moveTo(a.x,a.y);else{var h={x:.5*(o.x+a.x),y:.5*(o.y+a.y)};e.moveTo(h.x,h.y)}for(var l=0;l<r.length;++l)if(s=o,o=a,a=r[(l+1)%r.length],o.onCurve)e.lineTo(o.x,o.y);else{var c=a;s.onCurve||(o.x,s.x,o.y,s.y),a.onCurve||(c={x:.5*(o.x+a.x),y:.5*(o.y+a.y)}),e.quadraticCurveTo(o.x,o.y,c.x,c.y)}e.closePath()}return e}function Be(t,e){if(e.isComposite)for(var i=0;i<e.components.length;i+=1){var n=e.components[i],r=t.get(n.glyphIndex);if(r.getPath(),r.points){var s=void 0;if(void 0===n.matchedPoints)s=Le(r.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>r.points.length-1)throw Error("Matched points out of range in "+e.name);var o=e.points[n.matchedPoints[0]],a=r.points[n.matchedPoints[1]],h={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};a=Le([a],h)[0],h.dx=o.x-a.x,h.dy=o.y-a.y,s=Le(r.points,h)}e.points=e.points.concat(s)}}return Pe(e.points)}Se.prototype={searchTag:xe,binSearch:be,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(t){return t.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,i=0;i<t.scripts.length;i++){var n=t.scripts[i].tag;if("DFLT"===n)return n;"latn"===n&&(e=!0)}return e?"latn":void 0}},getScriptTable:function(t,e){var i=this.getTable(e);if(i){t=t||"DFLT";var n=i.scripts,r=xe(i.scripts,t);if(r>=0)return n[r].script;if(e){var s={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-r,0,s),s.script}}},getLangSysTable:function(t,e,i){var n=this.getScriptTable(t,i);if(n){if(!e||"dflt"===e||"DFLT"===e)return n.defaultLangSys;var r=xe(n.langSysRecords,e);if(r>=0)return n.langSysRecords[r].langSys;if(i){var s={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-r,0,s),s.langSys}}},getFeatureTable:function(t,e,i,n){var r=this.getLangSysTable(t,e,n);if(r){for(var s,o=r.featureIndexes,a=this.font.tables[this.tableName].features,h=0;h<o.length;h++)if((s=a[o[h]]).tag===i)return s.feature;if(n){var l=a.length;return O.assert(0===l||i>=a[l-1].tag,"Features must be added in alphabetical order."),s={tag:i,feature:{params:0,lookupListIndexes:[]}},a.push(s),o.push(l),s.feature}}},getLookupTables:function(t,e,i,n,r){var s=this.getFeatureTable(t,e,i,r),o=[];if(s){for(var a,h=s.lookupListIndexes,l=this.font.tables[this.tableName].lookups,c=0;c<h.length;c++)(a=l[h[c]]).lookupType===n&&o.push(a);if(0===o.length&&r){a={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=l.length;return l.push(a),h.push(u),[a]}}return o},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var i=we(t.ranges,e);return i?i.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var i=be(t.glyphs,e);return i>=0?i:-1;case 2:var n=we(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(1===t.format)return t.glyphs;for(var e=[],i=t.ranges,n=0;n<i.length;n++)for(var r=i[n],s=r.start,o=r.end,a=s;a<=o;a++)e.push(a);return e}},Ce.prototype=Se.prototype,Ce.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Ce.prototype.getKerningValue=function(t,e,i){for(var n=0;n<t.length;n++)for(var r=t[n].subtables,s=0;s<r.length;s++){var o=r[s],a=this.getCoverageIndex(o.coverage,e);if(!(a<0))switch(o.posFormat){case 1:for(var h=o.pairSets[a],l=0;l<h.length;l++){var c=h[l];if(c.secondGlyph===i)return c.value1&&c.value1.xAdvance||0}break;case 2:var u=this.getGlyphClass(o.classDef1,e),f=this.getGlyphClass(o.classDef2,i),d=o.classRecords[u][f];return d.value1&&d.value1.xAdvance||0}}return 0},Ce.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)},Te.prototype=Se.prototype,Te.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Te.prototype.getSingle=function(t,e,i){for(var n=[],r=this.getLookupTables(e,i,t,1),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++){var h=o[a],l=this.expandCoverage(h.coverage),c=void 0;if(1===h.substFormat){var u=h.deltaGlyphId;for(c=0;c<l.length;c++){var f=l[c];n.push({sub:f,by:f+u})}}else{var d=h.substitute;for(c=0;c<l.length;c++)n.push({sub:l[c],by:d[c]})}}return n},Te.prototype.getAlternates=function(t,e,i){for(var n=[],r=this.getLookupTables(e,i,t,3),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++)for(var h=o[a],l=this.expandCoverage(h.coverage),c=h.alternateSets,u=0;u<l.length;u++)n.push({sub:l[u],by:c[u]});return n},Te.prototype.getLigatures=function(t,e,i){for(var n=[],r=this.getLookupTables(e,i,t,4),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++)for(var h=o[a],l=this.expandCoverage(h.coverage),c=h.ligatureSets,u=0;u<l.length;u++)for(var f=l[u],d=c[u],p=0;p<d.length;p++){var g=d[p];n.push({sub:[f].concat(g.components),by:g.ligGlyph})}return n},Te.prototype.addSingle=function(t,e,i,n){var r=Ee(this.getLookupTables(i,n,t,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});O.assert(1===r.coverage.format,"Ligature: unable to modify coverage table format "+r.coverage.format);var s=e.sub,o=this.binSearch(r.coverage.glyphs,s);o<0&&(o=-1-o,r.coverage.glyphs.splice(o,0,s),r.substitute.splice(o,0,0)),r.substitute[o]=e.by},Te.prototype.addAlternate=function(t,e,i,n){var r=Ee(this.getLookupTables(i,n,t,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});O.assert(1===r.coverage.format,"Ligature: unable to modify coverage table format "+r.coverage.format);var s=e.sub,o=this.binSearch(r.coverage.glyphs,s);o<0&&(o=-1-o,r.coverage.glyphs.splice(o,0,s),r.alternateSets.splice(o,0,0)),r.alternateSets[o]=e.by},Te.prototype.addLigature=function(t,e,i,n){var r=this.getLookupTables(i,n,t,4,!0)[0],s=r.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},r.subtables[0]=s),O.assert(1===s.coverage.format,"Ligature: unable to modify coverage table format "+s.coverage.format);var o=e.sub[0],a=e.sub.slice(1),h={ligGlyph:e.by,components:a},l=this.binSearch(s.coverage.glyphs,o);if(l>=0){for(var c=s.ligatureSets[l],u=0;u<c.length;u++)if(ke(c[u].components,a))return;c.push(h)}else l=-1-l,s.coverage.glyphs.splice(l,0,o),s.ligatureSets.splice(l,0,[h])},Te.prototype.getFeature=function(t,e,i){if(/ss\d\d/.test(t))return this.getSingle(t,e,i);switch(t){case"aalt":case"salt":return this.getSingle(t,e,i).concat(this.getAlternates(t,e,i));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,i)}},Te.prototype.add=function(t,e,i,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,i,n);switch(t){case"aalt":case"salt":return"number"==typeof e.by?this.addSingle(t,e,i,n):this.addAlternate(t,e,i,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,i,n)}};var Ie,Re,Fe,Ue,Ne={getPath:Pe,parse:function(t,e,i,n,r){return r.lowMemory?function(t,e,i,n){var r=new bt.GlyphSet(n);return n._push=function(s){var o=i[s];o!==i[s+1]?r.push(s,bt.ttfGlyphLoader(n,s,Oe,t,e+o,Be)):r.push(s,bt.glyphLoader(n,s))},r}(t,e,i,n):function(t,e,i,n){for(var r=new bt.GlyphSet(n),s=0;s<i.length-1;s+=1){var o=i[s];o!==i[s+1]?r.push(s,bt.ttfGlyphLoader(n,s,Oe,t,e+o,Be)):r.push(s,bt.glyphLoader(n,s))}return r}(t,e,i,n)}};function ze(t){this.font=t,this.getCommands=function(t){return Ne.getPath(t).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Ge(t){return t}function Xe(t){return Math.sign(t)*Math.round(Math.abs(t))}function Ye(t){return Math.sign(t)*Math.round(Math.abs(2*t))/2}function We(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function je(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Ze(t){return Math.sign(t)*Math.floor(Math.abs(t))}var He=function(t){var e=this.srPeriod,i=this.srPhase,n=1;return t<0&&(t=-t,n=-1),t+=this.srThreshold-i,t=Math.trunc(t/e)*e,(t+=i)<0?i*n:t*n},Ve={x:1,y:0,axis:"x",distance:function(t,e,i,n){return(i?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,i,n){var r,s,o,a,h,l,c;if(!n||n===this)return r=t.xo-e.xo,s=t.xo-i.xo,h=e.x-e.xo,l=i.x-i.xo,0===(c=(o=Math.abs(r))+(a=Math.abs(s)))?void(t.x=t.xo+(h+l)/2):void(t.x=t.xo+(h*a+l*o)/c);r=n.distance(t,e,!0,!0),s=n.distance(t,i,!0,!0),h=n.distance(e,e,!1,!0),l=n.distance(i,i,!1,!0),0!==(c=(o=Math.abs(r))+(a=Math.abs(s)))?Ve.setRelative(t,t,(h*a+l*o)/c,n,!0):Ve.setRelative(t,t,(h+l)/2,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,i,n,r){if(n&&n!==this){var s=r?e.xo:e.x,o=r?e.yo:e.y,a=s+i*n.x,h=o+i*n.y;t.x=a+(t.y-h)/n.normalSlope}else t.x=(r?e.xo:e.x)+i},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},qe={x:0,y:1,axis:"y",distance:function(t,e,i,n){return(i?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,i,n){var r,s,o,a,h,l,c;if(!n||n===this)return r=t.yo-e.yo,s=t.yo-i.yo,h=e.y-e.yo,l=i.y-i.yo,0===(c=(o=Math.abs(r))+(a=Math.abs(s)))?void(t.y=t.yo+(h+l)/2):void(t.y=t.yo+(h*a+l*o)/c);r=n.distance(t,e,!0,!0),s=n.distance(t,i,!0,!0),h=n.distance(e,e,!1,!0),l=n.distance(i,i,!1,!0),0!==(c=(o=Math.abs(r))+(a=Math.abs(s)))?qe.setRelative(t,t,(h*a+l*o)/c,n,!0):qe.setRelative(t,t,(h+l)/2,n,!0)},normalSlope:0,setRelative:function(t,e,i,n,r){if(n&&n!==this){var s=r?e.xo:e.x,o=r?e.yo:e.y,a=s+i*n.x,h=o+i*n.y;t.y=h+n.normalSlope*(t.x-a)}else t.y=(r?e.yo:e.y)+i},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};function Ke(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}function Je(t,e){var i=Math.sqrt(t*t+e*e);return e/=i,1==(t/=i)&&0===e?Ve:0===t&&1===e?qe:new Ke(t,e)}function Qe(t,e,i,n){this.x=this.xo=Math.round(64*t)/64,this.y=this.yo=Math.round(64*e)/64,this.lastPointOfContour=i,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(Ve),Object.freeze(qe),Ke.prototype.distance=function(t,e,i,n){return this.x*Ve.distance(t,e,i,n)+this.y*qe.distance(t,e,i,n)},Ke.prototype.interpolate=function(t,e,i,n){var r,s,o,a,h,l,c;o=n.distance(t,e,!0,!0),a=n.distance(t,i,!0,!0),r=n.distance(e,e,!1,!0),s=n.distance(i,i,!1,!0),0!==(c=(h=Math.abs(o))+(l=Math.abs(a)))?this.setRelative(t,t,(r*l+s*h)/c,n,!0):this.setRelative(t,t,(r+s)/2,n,!0)},Ke.prototype.setRelative=function(t,e,i,n,r){n=n||this;var s=r?e.xo:e.x,o=r?e.yo:e.y,a=s+i*n.x,h=o+i*n.y,l=n.normalSlope,c=this.slope,u=t.x,f=t.y;t.x=(c*u-l*a+h-f)/(c-l),t.y=c*(t.x-u)+f},Ke.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0},Qe.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},Qe.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var $e=Object.freeze(new Qe(0,0)),ti={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function ei(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Ve,this.round=Xe}}function ii(t){for(var e=t.tZone=new Array(t.gZone.length),i=0;i<e.length;i++)e[i]=new Qe(0,0)}function ni(t,e){var i,n=t.prog,r=t.ip,s=1;do{if(88===(i=n[++r]))s++;else if(89===i)s--;else if(64===i)r+=n[r+1]+1;else if(65===i)r+=2*n[r+1]+1;else if(i>=176&&i<=183)r+=i-176+1;else if(i>=184&&i<=191)r+=2*(i-184+1);else if(e&&1===s&&27===i)break}while(s>0);t.ip=r}function ri(e,i){t.DEBUG&&console.log(i.step,"SVTCA["+e.axis+"]"),i.fv=i.pv=i.dpv=e}function si(e,i){t.DEBUG&&console.log(i.step,"SPVTCA["+e.axis+"]"),i.pv=i.dpv=e}function oi(e,i){t.DEBUG&&console.log(i.step,"SFVTCA["+e.axis+"]"),i.fv=e}function ai(e,i){var n,r,s=i.stack,o=s.pop(),a=s.pop(),h=i.z2[o],l=i.z1[a];t.DEBUG&&console.log("SPVTL["+e+"]",o,a),e?(n=h.y-l.y,r=l.x-h.x):(n=l.x-h.x,r=l.y-h.y),i.pv=i.dpv=Je(n,r)}function hi(e,i){var n,r,s=i.stack,o=s.pop(),a=s.pop(),h=i.z2[o],l=i.z1[a];t.DEBUG&&console.log("SFVTL["+e+"]",o,a),e?(n=h.y-l.y,r=l.x-h.x):(n=l.x-h.x,r=l.y-h.y),i.fv=Je(n,r)}function li(e){t.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function ci(e,i){var n=i.stack.pop(),r=i.z0[n],s=i.fv,o=i.pv;t.DEBUG&&console.log(i.step,"MDAP["+e+"]",n);var a=o.distance(r,$e);e&&(a=i.round(a)),s.setRelative(r,$e,a,o),s.touch(r),i.rp0=i.rp1=n}function ui(e,i){var n,r,s,o=i.z2,a=o.length-2;t.DEBUG&&console.log(i.step,"IUP["+e.axis+"]");for(var h=0;h<a;h++)n=o[h],e.touched(n)||(r=n.prevTouched(e))!==n&&(r===(s=n.nextTouched(e))&&e.setRelative(n,n,e.distance(r,r,!1,!0),e,!0),e.interpolate(n,r,s,e))}function fi(e,i){for(var n=i.stack,r=e?i.rp1:i.rp2,s=(e?i.z0:i.z1)[r],o=i.fv,a=i.pv,h=i.loop,l=i.z2;h--;){var c=n.pop(),u=l[c],f=a.distance(s,s,!1,!0);o.setRelative(u,u,f,a),o.touch(u),t.DEBUG&&console.log(i.step,(i.loop>1?"loop "+(i.loop-h)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",c)}i.loop=1}function di(e,i){var n=i.stack,r=e?i.rp1:i.rp2,s=(e?i.z0:i.z1)[r],o=i.fv,a=i.pv,h=n.pop(),l=i.z2[i.contours[h]],c=l;t.DEBUG&&console.log(i.step,"SHC["+e+"]",h);var u=a.distance(s,s,!1,!0);do{c!==s&&o.setRelative(c,c,u,a),c=c.nextPointOnContour}while(c!==l)}function pi(e,i){var n,r,s=i.stack,o=e?i.rp1:i.rp2,a=(e?i.z0:i.z1)[o],h=i.fv,l=i.pv,c=s.pop();switch(t.DEBUG&&console.log(i.step,"SHZ["+e+"]",c),c){case 0:n=i.tZone;break;case 1:n=i.gZone;break;default:throw new Error("Invalid zone")}for(var u=l.distance(a,a,!1,!0),f=n.length-2,d=0;d<f;d++)r=n[d],h.setRelative(r,r,u,l)}function gi(e,i){var n=i.stack,r=n.pop()/64,s=n.pop(),o=i.z1[s],a=i.z0[i.rp0],h=i.fv,l=i.pv;h.setRelative(o,a,r,l),h.touch(o),t.DEBUG&&console.log(i.step,"MSIRP["+e+"]",r,s),i.rp1=i.rp0,i.rp2=s,e&&(i.rp0=s)}function vi(e,i){var n=i.stack,r=n.pop(),s=n.pop(),o=i.z0[s],a=i.fv,h=i.pv,l=i.cvt[r];t.DEBUG&&console.log(i.step,"MIAP["+e+"]",r,"(",l,")",s);var c=h.distance(o,$e);e&&(Math.abs(c-l)<i.cvCutIn&&(c=l),c=i.round(c)),a.setRelative(o,$e,c,h),0===i.zp0&&(o.xo=o.x,o.yo=o.y),a.touch(o),i.rp0=i.rp1=s}function mi(e,i){var n=i.stack,r=n.pop(),s=i.z2[r];t.DEBUG&&console.log(i.step,"GC["+e+"]",r),n.push(64*i.dpv.distance(s,$e,e,!1))}function _i(e,i){var n=i.stack,r=n.pop(),s=n.pop(),o=i.z1[r],a=i.z0[s],h=i.dpv.distance(a,o,e,e);t.DEBUG&&console.log(i.step,"MD["+e+"]",r,s,"->",h),i.stack.push(Math.round(64*h))}function yi(e,i){var n=i.stack,r=n.pop(),s=i.fv,o=i.pv,a=i.ppem,h=i.deltaBase+16*(e-1),l=i.deltaShift,c=i.z0;t.DEBUG&&console.log(i.step,"DELTAP["+e+"]",r,n);for(var u=0;u<r;u++){var f=n.pop(),d=n.pop();if(h+((240&d)>>4)===a){var p=(15&d)-8;p>=0&&p++,t.DEBUG&&console.log(i.step,"DELTAPFIX",f,"by",p*l);var g=c[f];s.setRelative(g,g,p*l,o)}}}function xi(e,i){var n=i.stack,r=n.pop();t.DEBUG&&console.log(i.step,"ROUND[]"),n.push(64*i.round(r/64))}function bi(e,i){var n=i.stack,r=n.pop(),s=i.ppem,o=i.deltaBase+16*(e-1),a=i.deltaShift;t.DEBUG&&console.log(i.step,"DELTAC["+e+"]",r,n);for(var h=0;h<r;h++){var l=n.pop(),c=n.pop();if(o+((240&c)>>4)===s){var u=(15&c)-8;u>=0&&u++;var f=u*a;t.DEBUG&&console.log(i.step,"DELTACFIX",l,"by",f),i.cvt[l]+=f}}}function wi(e,i){var n,r,s=i.stack,o=s.pop(),a=s.pop(),h=i.z2[o],l=i.z1[a];t.DEBUG&&console.log(i.step,"SDPVTL["+e+"]",o,a),e?(n=h.y-l.y,r=l.x-h.x):(n=l.x-h.x,r=l.y-h.y),i.dpv=Je(n,r)}function Si(e,i){var n=i.stack,r=i.prog,s=i.ip;t.DEBUG&&console.log(i.step,"PUSHB["+e+"]");for(var o=0;o<e;o++)n.push(r[++s]);i.ip=s}function Ci(e,i){var n=i.ip,r=i.prog,s=i.stack;t.DEBUG&&console.log(i.ip,"PUSHW["+e+"]");for(var o=0;o<e;o++){var a=r[++n]<<8|r[++n];32768&a&&(a=-(1+(65535^a))),s.push(a)}i.ip=n}function Ti(e,i,n,r,s,o){var a,h,l,c,u=o.stack,f=e&&u.pop(),d=u.pop(),p=o.rp0,g=o.z0[p],v=o.z1[d],m=o.minDis,_=o.fv,y=o.dpv;l=(h=a=y.distance(v,g,!0,!0))>=0?1:-1,h=Math.abs(h),e&&(c=o.cvt[f],r&&Math.abs(h-c)<o.cvCutIn&&(h=c)),n&&h<m&&(h=m),r&&(h=o.round(h)),_.setRelative(v,g,l*h,y),_.touch(v),t.DEBUG&&console.log(o.step,(e?"MIRP[":"MDRP[")+(i?"M":"m")+(n?">":"_")+(r?"R":"_")+(0===s?"Gr":1===s?"Bl":2===s?"Wh":"")+"]",e?f+"("+o.cvt[f]+","+c+")":"",d,"(d =",a,"->",l*h,")"),o.rp1=o.rp0,o.rp2=d,i&&(o.rp0=d)}function ki(t){this.char=t,this.state={},this.activeState=null}function Ei(t,e,i){this.contextName=i,this.startIndex=t,this.endOffset=e}function Ai(t,e,i){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=i}function Mi(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Di(t){this.eventId=t,this.subscribers=[]}function Oi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],function(t){var e=this,i=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];i.forEach(function(t){Object.defineProperty(e.events,t,{value:new Di(t)})}),t&&i.forEach(function(i){var n=t[i];"function"==typeof n&&e.events[i].subscribe(n)}),["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach(function(t){e.events[t].subscribe(e.updateContextsRanges)})}.call(this,t)}function Li(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Pi(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function Bi(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Ii(t){return/[A-z]/.test(t)}function Ri(t){this.font=t,this.features={}}function Fi(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Ui(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var i=e.ranges,n=0;n<i.length;n++){var r=i[n];if(t>=r.start&&t<=r.end){var s=t-r.start;return r.index+s}}break;default:return-1}return-1}function Ni(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n],s=e.current,o=Ui(s=Array.isArray(s)?s[0]:s,r);-1!==o&&i.push(o)}return i.length!==t.length?-1:i}ze.prototype.exec=function(e,i){if("number"!=typeof i)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var n=this.font,r=this._prepState;if(!r||r.ppem!==i){var s=this._fpgmState;if(!s){ei.prototype=ti,(s=this._fpgmState=new ei("fpgm",n.tables.fpgm)).funcs=[],s.font=n,t.DEBUG&&(console.log("---EXEC FPGM---"),s.step=-1);try{Re(s)}catch(t){return console.log("Hinting error in FPGM:"+t),void(this._errorState=3)}}ei.prototype=s,(r=this._prepState=new ei("prep",n.tables.prep)).ppem=i;var o=n.tables.cvt;if(o)for(var a=r.cvt=new Array(o.length),h=i/n.unitsPerEm,l=0;l<o.length;l++)a[l]=o[l]*h;else r.cvt=[];t.DEBUG&&(console.log("---EXEC PREP---"),r.step=-1);try{Re(r)}catch(t){this._errorState<2&&console.log("Hinting error in PREP:"+t),this._errorState=2}}if(!(this._errorState>1))try{return Fe(e,r)}catch(t){return this._errorState<1&&(console.log("Hinting error:"+t),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},Fe=function(e,i){var n,r,s,o=i.ppem/i.font.unitsPerEm,a=o,h=e.components;if(ei.prototype=i,h){var l=i.font;r=[],n=[];for(var c=0;c<h.length;c++){var u=h[c],f=l.glyphs.get(u.glyphIndex);s=new ei("glyf",f.instructions),t.DEBUG&&(console.log("---EXEC COMP "+c+"---"),s.step=-1),Ue(f,s,o,a);for(var d=Math.round(u.dx*o),p=Math.round(u.dy*a),g=s.gZone,v=s.contours,m=0;m<g.length;m++){var _=g[m];_.xTouched=_.yTouched=!1,_.xo=_.x=_.x+d,_.yo=_.y=_.y+p}var y=r.length;r.push.apply(r,g);for(var x=0;x<v.length;x++)n.push(v[x]+y)}e.instructions&&!s.inhibitGridFit&&((s=new ei("glyf",e.instructions)).gZone=s.z0=s.z1=s.z2=r,s.contours=n,r.push(new Qe(0,0),new Qe(Math.round(e.advanceWidth*o),0)),t.DEBUG&&(console.log("---EXEC COMPOSITE---"),s.step=-1),Re(s),r.length-=2)}else s=new ei("glyf",e.instructions),t.DEBUG&&(console.log("---EXEC GLYPH---"),s.step=-1),Ue(e,s,o,a),r=s.gZone;return r},Ue=function(e,i,n,r){for(var s,o,a,h=e.points||[],l=h.length,c=i.gZone=i.z0=i.z1=i.z2=[],u=i.contours=[],f=0;f<l;f++)s=h[f],c[f]=new Qe(s.x*n,s.y*r,s.lastPointOfContour,s.onCurve);for(var d=0;d<l;d++)s=c[d],o||(o=s,u.push(d)),s.lastPointOfContour?(s.nextPointOnContour=o,o.prevPointOnContour=s,o=void 0):(a=c[d+1],s.nextPointOnContour=a,a.prevPointOnContour=s);if(!i.inhibitGridFit){if(t.DEBUG){console.log("PROCESSING GLYPH",i.stack);for(var p=0;p<l;p++)console.log(p,c[p].x,c[p].y)}if(c.push(new Qe(0,0),new Qe(Math.round(e.advanceWidth*n),0)),Re(i),c.length-=2,t.DEBUG){console.log("FINISHED GLYPH",i.stack);for(var g=0;g<l;g++)console.log(g,c[g].x,c[g].y)}}},Re=function(e){var i=e.prog;if(i){var n,r=i.length;for(e.ip=0;e.ip<r;e.ip++){if(t.DEBUG&&e.step++,!(n=Ie[i[e.ip]]))throw new Error("unknown instruction: 0x"+Number(i[e.ip]).toString(16));n(e)}}},Ie=[ri.bind(void 0,qe),ri.bind(void 0,Ve),si.bind(void 0,qe),si.bind(void 0,Ve),oi.bind(void 0,qe),oi.bind(void 0,Ve),ai.bind(void 0,0),ai.bind(void 0,1),hi.bind(void 0,0),hi.bind(void 0,1),function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"SPVFS[]",n,r),e.pv=e.dpv=Je(r,n)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"SPVFS[]",n,r),e.fv=Je(r,n)},function(e){var i=e.stack,n=e.pv;t.DEBUG&&console.log(e.step,"GPV[]"),i.push(16384*n.x),i.push(16384*n.y)},function(e){var i=e.stack,n=e.fv;t.DEBUG&&console.log(e.step,"GFV[]"),i.push(16384*n.x),i.push(16384*n.y)},function(e){e.fv=e.pv,t.DEBUG&&console.log(e.step,"SFVTPV[]")},function(e){var i=e.stack,n=i.pop(),r=i.pop(),s=i.pop(),o=i.pop(),a=i.pop(),h=e.z0,l=e.z1,c=h[n],u=h[r],f=l[s],d=l[o],p=e.z2[a];t.DEBUG&&console.log("ISECT[], ",n,r,s,o,a);var g=c.x,v=c.y,m=u.x,_=u.y,y=f.x,x=f.y,b=d.x,w=d.y,S=(g-m)*(x-w)-(v-_)*(y-b),C=g*_-v*m,T=y*w-x*b;p.x=(C*(y-b)-T*(g-m))/S,p.y=(C*(x-w)-T*(v-_))/S},function(e){e.rp0=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)},function(e){e.rp1=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)},function(e){e.rp2=e.stack.pop(),t.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)},function(e){var i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP0[]",i),e.zp0=i,i){case 0:e.tZone||ii(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP1[]",i),e.zp1=i,i){case 0:e.tZone||ii(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZP2[]",i),e.zp2=i,i){case 0:e.tZone||ii(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var i=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SZPS[]",i),e.zp0=e.zp1=e.zp2=i,i){case 0:e.tZone||ii(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),t.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)},function(e){t.DEBUG&&console.log(e.step,"RTG[]"),e.round=Xe},function(e){t.DEBUG&&console.log(e.step,"RTHG[]"),e.round=We},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"SMD[]",i),e.minDis=i/64},function(e){t.DEBUG&&console.log(e.step,"ELSE[]"),ni(e,!1)},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"JMPR[]",i),e.ip+=i-1},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"SCVTCI[]",i),e.cvCutIn=i/64},void 0,void 0,function(e){var i=e.stack;t.DEBUG&&console.log(e.step,"DUP[]"),i.push(i[i.length-1])},li,function(e){t.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"SWAP[]"),i.push(n),i.push(r)},function(e){var i=e.stack;t.DEBUG&&console.log(e.step,"DEPTH[]"),i.push(i.length)},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"CINDEX[]",n),i.push(i[i.length-n])},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"MINDEX[]",n),i.push(i.splice(i.length-n,1)[0])},void 0,void 0,void 0,function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"LOOPCALL[]",n,r);var s=e.ip,o=e.prog;e.prog=e.funcs[n];for(var a=0;a<r;a++)Re(e),t.DEBUG&&console.log(++e.step,a+1<r?"next loopcall":"done loopcall",a);e.ip=s,e.prog=o},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"CALL[]",i);var n=e.ip,r=e.prog;e.prog=e.funcs[i],Re(e),e.ip=n,e.prog=r,t.DEBUG&&console.log(++e.step,"returning from",i)},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var i=e.stack,n=e.prog,r=e.ip,s=i.pop(),o=r;for(t.DEBUG&&console.log(e.step,"FDEF[]",s);45!==n[++r];);e.ip=r,e.funcs[s]=n.slice(o+1,r)},void 0,ci.bind(void 0,0),ci.bind(void 0,1),ui.bind(void 0,qe),ui.bind(void 0,Ve),fi.bind(void 0,0),fi.bind(void 0,1),di.bind(void 0,0),di.bind(void 0,1),pi.bind(void 0,0),pi.bind(void 0,1),function(e){for(var i=e.stack,n=e.loop,r=e.fv,s=i.pop()/64,o=e.z2;n--;){var a=i.pop(),h=o[a];t.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"SHPIX[]",a,s),r.setRelative(h,h,s),r.touch(h)}e.loop=1},function(e){for(var i=e.stack,n=e.rp1,r=e.rp2,s=e.loop,o=e.z0[n],a=e.z1[r],h=e.fv,l=e.dpv,c=e.z2;s--;){var u=i.pop(),f=c[u];t.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"IP[]",u,n,"<->",r),h.interpolate(f,o,a,l),h.touch(f)}e.loop=1},gi.bind(void 0,0),gi.bind(void 0,1),function(e){for(var i=e.stack,n=e.rp0,r=e.z0[n],s=e.loop,o=e.fv,a=e.pv,h=e.z1;s--;){var l=i.pop(),c=h[l];t.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"ALIGNRP[]",l),o.setRelative(c,r,0,a),o.touch(c)}e.loop=1},function(e){t.DEBUG&&console.log(e.step,"RTDG[]"),e.round=Ye},vi.bind(void 0,0),vi.bind(void 0,1),function(e){var i=e.prog,n=e.ip,r=e.stack,s=i[++n];t.DEBUG&&console.log(e.step,"NPUSHB[]",s);for(var o=0;o<s;o++)r.push(i[++n]);e.ip=n},function(e){var i=e.ip,n=e.prog,r=e.stack,s=n[++i];t.DEBUG&&console.log(e.step,"NPUSHW[]",s);for(var o=0;o<s;o++){var a=n[++i]<<8|n[++i];32768&a&&(a=-(1+(65535^a))),r.push(a)}e.ip=i},function(e){var i=e.stack,n=e.store;n||(n=e.store=[]);var r=i.pop(),s=i.pop();t.DEBUG&&console.log(e.step,"WS",r,s),n[s]=r},function(e){var i=e.stack,n=e.store,r=i.pop();t.DEBUG&&console.log(e.step,"RS",r);var s=n&&n[r]||0;i.push(s)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"WCVTP",n,r),e.cvt[r]=n/64},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"RCVT",n),i.push(64*e.cvt[n])},mi.bind(void 0,0),mi.bind(void 0,1),void 0,_i.bind(void 0,0),_i.bind(void 0,1),function(e){t.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)},void 0,function(e){t.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0},void 0,void 0,function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"LT[]",n,r),i.push(r<n?1:0)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"LTEQ[]",n,r),i.push(r<=n?1:0)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"GT[]",n,r),i.push(r>n?1:0)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"GTEQ[]",n,r),i.push(r>=n?1:0)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"EQ[]",n,r),i.push(n===r?1:0)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"NEQ[]",n,r),i.push(n!==r?1:0)},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"ODD[]",n),i.push(Math.trunc(n)%2?1:0)},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"EVEN[]",n),i.push(Math.trunc(n)%2?0:1)},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"IF[]",i),i||(ni(e,!0),t.DEBUG&&console.log(e.step,"EIF[]"))},function(e){t.DEBUG&&console.log(e.step,"EIF[]")},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"AND[]",n,r),i.push(n&&r?1:0)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"OR[]",n,r),i.push(n||r?1:0)},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"NOT[]",n),i.push(n?0:1)},yi.bind(void 0,1),function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"SDB[]",i),e.deltaBase=i},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"SDS[]",i),e.deltaShift=Math.pow(.5,i)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"ADD[]",n,r),i.push(r+n)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"SUB[]",n,r),i.push(r-n)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"DIV[]",n,r),i.push(64*r/n)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"MUL[]",n,r),i.push(r*n/64)},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"ABS[]",n),i.push(Math.abs(n))},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"NEG[]",n),i.push(-n)},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"FLOOR[]",n),i.push(64*Math.floor(n/64))},function(e){var i=e.stack,n=i.pop();t.DEBUG&&console.log(e.step,"CEILING[]",n),i.push(64*Math.ceil(n/64))},xi.bind(void 0,0),xi.bind(void 0,1),xi.bind(void 0,2),xi.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"WCVTF[]",n,r),e.cvt[r]=n*e.ppem/e.font.unitsPerEm},yi.bind(void 0,2),yi.bind(void 0,3),bi.bind(void 0,1),bi.bind(void 0,2),bi.bind(void 0,3),function(e){var i,n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"SROUND[]",n),e.round=He,192&n){case 0:i=.5;break;case 64:i=1;break;case 128:i=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=i,48&n){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*i;break;case 32:e.srPhase=.5*i;break;case 48:e.srPhase=.75*i;break;default:throw new Error("invalid SROUND value")}n&=15,e.srThreshold=0===n?0:(n/8-.5)*i},function(e){var i,n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"S45ROUND[]",n),e.round=He,192&n){case 0:i=Math.sqrt(2)/2;break;case 64:i=Math.sqrt(2);break;case 128:i=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=i,48&n){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*i;break;case 32:e.srPhase=.5*i;break;case 48:e.srPhase=.75*i;break;default:throw new Error("invalid S45ROUND value")}n&=15,e.srThreshold=0===n?0:(n/8-.5)*i},void 0,void 0,function(e){t.DEBUG&&console.log(e.step,"ROFF[]"),e.round=Ge},void 0,function(e){t.DEBUG&&console.log(e.step,"RUTG[]"),e.round=je},function(e){t.DEBUG&&console.log(e.step,"RDTG[]"),e.round=Ze},li,li,void 0,void 0,void 0,void 0,void 0,function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"SCANCTRL[]",i)},wi.bind(void 0,0),wi.bind(void 0,1),function(e){var i=e.stack,n=i.pop(),r=0;t.DEBUG&&console.log(e.step,"GETINFO[]",n),1&n&&(r=35),32&n&&(r|=4096),i.push(r)},void 0,function(e){var i=e.stack,n=i.pop(),r=i.pop(),s=i.pop();t.DEBUG&&console.log(e.step,"ROLL[]"),i.push(r),i.push(n),i.push(s)},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"MAX[]",n,r),i.push(Math.max(r,n))},function(e){var i=e.stack,n=i.pop(),r=i.pop();t.DEBUG&&console.log(e.step,"MIN[]",n,r),i.push(Math.min(r,n))},function(e){var i=e.stack.pop();t.DEBUG&&console.log(e.step,"SCANTYPE[]",i)},function(e){var i=e.stack.pop(),n=e.stack.pop();switch(t.DEBUG&&console.log(e.step,"INSTCTRL[]",i,n),i){case 1:return void(e.inhibitGridFit=!!n);case 2:return void(e.ignoreCvt=!!n);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Si.bind(void 0,1),Si.bind(void 0,2),Si.bind(void 0,3),Si.bind(void 0,4),Si.bind(void 0,5),Si.bind(void 0,6),Si.bind(void 0,7),Si.bind(void 0,8),Ci.bind(void 0,1),Ci.bind(void 0,2),Ci.bind(void 0,3),Ci.bind(void 0,4),Ci.bind(void 0,5),Ci.bind(void 0,6),Ci.bind(void 0,7),Ci.bind(void 0,8),Ti.bind(void 0,0,0,0,0,0),Ti.bind(void 0,0,0,0,0,1),Ti.bind(void 0,0,0,0,0,2),Ti.bind(void 0,0,0,0,0,3),Ti.bind(void 0,0,0,0,1,0),Ti.bind(void 0,0,0,0,1,1),Ti.bind(void 0,0,0,0,1,2),Ti.bind(void 0,0,0,0,1,3),Ti.bind(void 0,0,0,1,0,0),Ti.bind(void 0,0,0,1,0,1),Ti.bind(void 0,0,0,1,0,2),Ti.bind(void 0,0,0,1,0,3),Ti.bind(void 0,0,0,1,1,0),Ti.bind(void 0,0,0,1,1,1),Ti.bind(void 0,0,0,1,1,2),Ti.bind(void 0,0,0,1,1,3),Ti.bind(void 0,0,1,0,0,0),Ti.bind(void 0,0,1,0,0,1),Ti.bind(void 0,0,1,0,0,2),Ti.bind(void 0,0,1,0,0,3),Ti.bind(void 0,0,1,0,1,0),Ti.bind(void 0,0,1,0,1,1),Ti.bind(void 0,0,1,0,1,2),Ti.bind(void 0,0,1,0,1,3),Ti.bind(void 0,0,1,1,0,0),Ti.bind(void 0,0,1,1,0,1),Ti.bind(void 0,0,1,1,0,2),Ti.bind(void 0,0,1,1,0,3),Ti.bind(void 0,0,1,1,1,0),Ti.bind(void 0,0,1,1,1,1),Ti.bind(void 0,0,1,1,1,2),Ti.bind(void 0,0,1,1,1,3),Ti.bind(void 0,1,0,0,0,0),Ti.bind(void 0,1,0,0,0,1),Ti.bind(void 0,1,0,0,0,2),Ti.bind(void 0,1,0,0,0,3),Ti.bind(void 0,1,0,0,1,0),Ti.bind(void 0,1,0,0,1,1),Ti.bind(void 0,1,0,0,1,2),Ti.bind(void 0,1,0,0,1,3),Ti.bind(void 0,1,0,1,0,0),Ti.bind(void 0,1,0,1,0,1),Ti.bind(void 0,1,0,1,0,2),Ti.bind(void 0,1,0,1,0,3),Ti.bind(void 0,1,0,1,1,0),Ti.bind(void 0,1,0,1,1,1),Ti.bind(void 0,1,0,1,1,2),Ti.bind(void 0,1,0,1,1,3),Ti.bind(void 0,1,1,0,0,0),Ti.bind(void 0,1,1,0,0,1),Ti.bind(void 0,1,1,0,0,2),Ti.bind(void 0,1,1,0,0,3),Ti.bind(void 0,1,1,0,1,0),Ti.bind(void 0,1,1,0,1,1),Ti.bind(void 0,1,1,0,1,2),Ti.bind(void 0,1,1,0,1,3),Ti.bind(void 0,1,1,1,0,0),Ti.bind(void 0,1,1,1,0,1),Ti.bind(void 0,1,1,1,0,2),Ti.bind(void 0,1,1,1,0,3),Ti.bind(void 0,1,1,1,1,0),Ti.bind(void 0,1,1,1,1,1),Ti.bind(void 0,1,1,1,1,2),Ti.bind(void 0,1,1,1,1,3)],ki.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},ki.prototype.getState=function(t){return this.state[t]||null},Oi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Oi.prototype.composeRUD=function(t){var e=this,i=t.map(function(t){return e[t[0]].apply(e,t.slice(1).concat(!0))}),n=function(t){return"object"==typeof t&&t.hasOwnProperty("FAIL")};if(i.every(n))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:i.filter(n)};this.dispatch("composeRUD",[i.filter(function(t){return!n(t)})])},Oi.prototype.replaceRange=function(t,e,i,n){e=null!==e?e:this.tokens.length;var r=i.every(function(t){return t instanceof ki});if(!isNaN(t)&&this.inboundIndex(t)&&r){var s=this.tokens.splice.apply(this.tokens,[t,e].concat(i));return n||this.dispatch("replaceToken",[t,e,i]),[s,i]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},Oi.prototype.replaceToken=function(t,e,i){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof ki){var n=this.tokens.splice(t,1,e);return i||this.dispatch("replaceToken",[t,e]),[n[0],e]}return{FAIL:"replaceToken: invalid token or index."}},Oi.prototype.removeRange=function(t,e,i){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return i||this.dispatch("removeRange",[n,t,e]),n},Oi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var i=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[i,t]),i}return{FAIL:"removeToken: invalid token index."}},Oi.prototype.insertToken=function(t,e,i){return t.every(function(t){return t instanceof ki})?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),i||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Oi.prototype.registerModifier=function(t,e,i){this.events.newToken.subscribe(function(n,r){var s=[n,r],o=[n,r];if(null===e||!0===e.apply(this,s)){var a=i.apply(this,o);n.setState(t,a)}}),this.registeredModifiers.push(t)},Di.prototype.subscribe=function(t){return"function"==typeof t?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Di.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},Mi.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},Mi.prototype.get=function(t){switch(!0){case 0===t:return this.current;case t<0&&Math.abs(t)<=this.backtrack.length:return this.backtrack.slice(t)[0];case t>0&&t<=this.lookahead.length:return this.lookahead[t-1];default:return null}},Oi.prototype.rangeToText=function(t){if(t instanceof Ei)return this.getRangeTokens(t).map(function(t){return t.char}).join("")},Oi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Oi.prototype.getContext=function(t){return this.registeredContexts[t]||null},Oi.prototype.on=function(t,e){var i=this.events[t];return i?i.subscribe(e):null},Oi.prototype.dispatch=function(t,e){var i=this,n=this.events[t];n instanceof Di&&n.subscribers.forEach(function(t){t.apply(i,e||[])})},Oi.prototype.registerContextChecker=function(t,e,i){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if("function"!=typeof e)return{FAIL:"missing context start check."};if("function"!=typeof i)return{FAIL:"missing context end check."};var n=new Ai(t,e,i);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Oi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Oi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Oi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)t.hasOwnProperty(e)&&(t[e].ranges=[])},Oi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(t){return t.char}),e=0;e<t.length;e++){var i=new Mi(t,e);this.runContextCheck(i)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Oi.prototype.setEndOffset=function(t,e){var i=new Ei(this.getContext(e).openRange.startIndex,t,e),n=this.getContext(e).ranges;return i.rangeId=e+"."+n.length,n.push(i),this.getContext(e).openRange=null,i},Oi.prototype.runContextCheck=function(t){var e=this,i=t.index;this.contextCheckers.forEach(function(n){var r=n.contextName,s=e.getContext(r).openRange;if(!s&&n.checkStart(t)&&(s=new Ei(i,null,r),e.getContext(r).openRange=s,e.dispatch("contextStart",[r,i])),s&&n.checkEnd(t)){var o=i-s.startIndex+1,a=e.setEndOffset(o,r);e.dispatch("contextEnd",[r,a])}})},Oi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var i=0;i<e.length;i++){var n=e[i],r=new Mi(e,i);this.dispatch("next",[r]),this.runContextCheck(r);var s=new ki(n);this.tokens.push(s),this.dispatch("newToken",[s,r])}return this.dispatch("end",[this.tokens]),this.tokens},Ri.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var i=t[e];if("DFLT"===i.tag)return i.script.defaultLangSys.featureIndexes}return[]},Ri.prototype.getScriptFeaturesIndexes=function(t){if(!this.font.tables.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var e=this.font.tables.gsub.scripts,i=0;i<e.length;i++){var n=e[i];if(n.tag===t&&n.script.defaultLangSys)return n.script.defaultLangSys.featureIndexes;var r=n.langSysRecords;if(r)for(var s=0;s<r.length;s++){var o=r[s];if(o.tag===t)return o.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},Ri.prototype.mapTagsToFeatures=function(t,e){for(var i={},n=0;n<t.length;n++){var r=t[n].tag,s=t[n].feature;i[r]=s}this.features[e].tags=i},Ri.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var i=this.getScriptFeaturesIndexes(t);if(!i)return null;var n=this.font.tables.gsub;return e=i.map(function(t){return n.features[t]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},Ri.prototype.getSubstitutionType=function(t,e){return t.lookupType.toString()+e.substFormat.toString()},Ri.prototype.getLookupMethod=function(t,e){var i=this;switch(this.getSubstitutionType(t,e)){case"11":return function(t){return function(t,e){return-1===Ui(t,e.coverage)?null:t+e.deltaGlyphId}.apply(i,[t,e])};case"12":return function(t){return function(t,e){var i=Ui(t,e.coverage);return-1===i?null:e.substitute[i]}.apply(i,[t,e])};case"63":return function(t){return function(t,e){var i=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<i)return[];var n=Ni(e.inputCoverage,t);if(-1===n)return[];var r=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var s=t.lookahead.slice(r);s.length&&Bi(s[0].char);)s.shift();var o=new Mi(s,0),a=Ni(e.lookaheadCoverage,o),h=[].concat(t.backtrack);for(h.reverse();h.length&&Bi(h[0].char);)h.shift();if(h.length<e.backtrackCoverage.length)return[];var l=new Mi(h,0),c=Ni(e.backtrackCoverage,l),u=[];if(n.length===e.inputCoverage.length&&a.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length)for(var f=0;f<e.lookupRecords.length;f++)for(var d=e.lookupRecords[f].lookupListIndex,p=this.getLookupByIndex(d),g=0;g<p.subtables.length;g++){var v=p.subtables[g],m=this.getLookupMethod(p,v);if("12"===this.getSubstitutionType(p,v))for(var _=0;_<n.length;_++){var y=m(t.get(_));y&&u.push(y)}}return u}.apply(i,[t,e])};case"41":return function(t){return function(t,e){var i,n=Ui(t.current,e.coverage);if(-1===n)return null;for(var r=e.ligatureSets[n],s=0;s<r.length;s++){i=r[s];for(var o=0;o<i.components.length&&t.lookahead[o]===i.components[o];o++)if(o===i.components.length-1)return i}return null}.apply(i,[t,e])};case"21":return function(t){return function(t,e){var i=Ui(t,e.coverage);return-1===i?null:e.sequences[i]}.apply(i,[t,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},Ri.prototype.lookupFeature=function(t){var e=t.contextParams,i=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var r=this.getFeatureLookups(n),s=[].concat(e.context),o=0;o<r.length;o++)for(var a=r[o],h=this.getLookupSubtables(a),l=0;l<h.length;l++){var c=h[l],u=this.getSubstitutionType(a,c),f=this.getLookupMethod(a,c),d=void 0;switch(u){case"11":(d=f(e.current))&&s.splice(i,1,new Fi({id:11,tag:t.tag,substitution:d}));break;case"12":(d=f(e.current))&&s.splice(i,1,new Fi({id:12,tag:t.tag,substitution:d}));break;case"63":d=f(e),Array.isArray(d)&&d.length&&s.splice(i,1,new Fi({id:63,tag:t.tag,substitution:d}));break;case"41":(d=f(e))&&s.splice(i,1,new Fi({id:41,tag:t.tag,substitution:d}));break;case"21":(d=f(e.current))&&s.splice(i,1,new Fi({id:21,tag:t.tag,substitution:d}))}e=new Mi(s,i),Array.isArray(d)&&!d.length||(d=null)}return s.length?s:null},Ri.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var i=this.features[t.script].some(function(e){return e.tag===t.tag});return e&&i},Ri.prototype.getLookupSubtables=function(t){return t.subtables||null},Ri.prototype.getLookupByIndex=function(t){return this.font.tables.gsub.lookups[t]||null},Ri.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Ri.prototype.getFeature=function(t){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(t.script)||this.getScriptFeatures(t.script);var e=this.features[t.script];return e?e.tags[t.tag]?this.features[t.script].tags[t.tag]:null:{FAIL:"No feature for script "+t.script}};var zi={startCheck:function(t){var e=t.current,i=t.get(-1);return null===i&&Li(e)||!Li(i)&&Li(e)},endCheck:function(t){var e=t.get(1);return null===e||!Li(e)}},Gi={startCheck:function(t){var e=t.current,i=t.get(-1);return(Li(e)||Bi(e))&&!Li(i)},endCheck:function(t){var e=t.get(1);switch(!0){case null===e:return!0;case!Li(e)&&!Bi(e):var i=/\s/.test(e);if(!i)return!0;if(i&&!t.lookahead.some(function(t){return Li(t)||Bi(t)}))return!0;break;default:return!1}}},Xi={11:function(t,e,i){e[i].setState(t.tag,t.substitution)},12:function(t,e,i){e[i].setState(t.tag,t.substitution)},63:function(t,e,i){t.substitution.forEach(function(n,r){e[i+r].setState(t.tag,n)})},41:function(t,e,i){var n=e[i];n.setState(t.tag,t.substitution.ligGlyph);for(var r=t.substitution.components.length,s=0;s<r;s++)(n=e[i+s+1]).setState("deleted",!0)}};function Yi(t,e,i){t instanceof Fi&&Xi[t.id](t,e,i)}function Wi(t,e){return new Mi(t.map(function(t){return t.activeState.value}),e||0)}var ji={startCheck:function(t){var e=t.current,i=t.get(-1);return null===i&&Ii(e)||!Ii(i)&&Ii(e)},endCheck:function(t){var e=t.get(1);return null===e||!Ii(e)}};function Zi(t,e){return new Mi(t.map(function(t){return t.activeState.value}),e||0)}function Hi(t){this.baseDir=t||"ltr",this.tokenizer=new Oi,this.featuresTags={}}function Vi(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function qi(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Ki(t){(t=t||{}).empty||(Me(t.familyName,"When creating a new Font object, familyName is required."),Me(t.styleName,"When creating a new Font object, styleName is required."),Me(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Me(t.ascender,"When creating a new Font object, ascender is required."),Me(t.descender,"When creating a new Font object, descender is required."),Me(t.descender<0,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables={os2:{usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR}}),this.supported=!0,this.glyphs=new bt.GlyphSet(this,t.glyphs||[]),this.encoding=new dt(this),this.position=new Ce(this),this.substitution=new Te(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new ze(this):void 0}})}function Ji(t,e){var i=JSON.stringify(t),n=256;for(var r in e){var s=parseInt(r);if(s&&!(s<256)){if(JSON.stringify(e[r])===i)return s;n<=s&&(n=s+1)}}return e[n]=t,n}function Qi(t,e,i){var n=Ji(e.name,i);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:n}]}function $i(t,e,i){var n={},r=new ot.Parser(t,e);return n.tag=r.parseTag(),n.minValue=r.parseFixed(),n.defaultValue=r.parseFixed(),n.maxValue=r.parseFixed(),r.skip("uShort",1),n.name=i[r.parseUShort()]||{},n}function tn(t,e,i,n){for(var r=[{name:"nameID_"+t,type:"USHORT",value:Ji(e.name,n)},{name:"flags_"+t,type:"USHORT",value:0}],s=0;s<i.length;++s){var o=i[s].tag;r.push({name:"axis_"+t+" "+o,type:"FIXED",value:e.coordinates[o]<<16})}return r}function en(t,e,i,n){var r={},s=new ot.Parser(t,e);r.name=n[s.parseUShort()]||{},s.skip("uShort",1),r.coordinates={};for(var o=0;o<i.length;++o)r.coordinates[i[o].tag]=s.parseFixed();return r}Hi.prototype.setText=function(t){this.text=t},Hi.prototype.contextChecks={latinWordCheck:ji,arabicWordCheck:zi,arabicSentenceCheck:Gi},Hi.prototype.registerFeatures=function(t,e){var i=this,n=e.filter(function(e){return i.query.supports({script:t,tag:e})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},Hi.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Ri(t));for(var i=0;i<e.length;i++){var n=e[i];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},Hi.prototype.registerModifier=function(t,e,i){this.tokenizer.registerModifier(t,e,i)},Hi.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},Hi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(function(){var t=this;this.featuresTags.hasOwnProperty("arab")&&(qi.call(this),this.tokenizer.getContextRanges("arabicWord").forEach(function(e){(function(t){var e=this,i=this.featuresTags.arab,n=this.tokenizer.getRangeTokens(t);if(1!==n.length){var r=new Mi(n.map(function(t){return t.getState("glyphIndex")}),0),s=new Mi(n.map(function(t){return t.char}),0);n.forEach(function(t,o){if(!Bi(t.char)){r.setCurrentIndex(o),s.setCurrentIndex(o);var a,h=0;switch(function(t){for(var e=[].concat(t.backtrack),i=e.length-1;i>=0;i--){var n=e[i],r=Pi(n),s=Bi(n);if(!r&&!s)return!0;if(r)return!1}return!1}(s)&&(h|=1),function(t){if(Pi(t.current))return!1;for(var e=0;e<t.lookahead.length;e++)if(!Bi(t.lookahead[e]))return!0;return!1}(s)&&(h|=2),h){case 1:a="fina";break;case 2:a="init";break;case 3:a="medi"}if(-1!==i.indexOf(a)){var l=e.query.lookupFeature({tag:a,script:"arab",contextParams:r});if(l instanceof Error)return console.info(l.message);l.forEach(function(t,e){t instanceof Fi&&(Yi(t,n,e),r.context[e]=t.substitution)})}}})}}).call(t,e)}))}.call(this),function(){var t=this;this.featuresTags.hasOwnProperty("arab")&&-1!==this.featuresTags.arab.indexOf("rlig")&&(qi.call(this),this.tokenizer.getContextRanges("arabicWord").forEach(function(e){(function(t){var e=this,i=this.tokenizer.getRangeTokens(t),n=Wi(i);n.context.forEach(function(t,r){n.setCurrentIndex(r);var s=e.query.lookupFeature({tag:"rlig",script:"arab",contextParams:n});s.length&&(s.forEach(function(t){return Yi(t,i,r)}),n=Wi(i))})}).call(t,e)}))}.call(this)),this.checkContextReady("latinWord")&&function(){var t=this;this.featuresTags.hasOwnProperty("latn")&&-1!==this.featuresTags.latn.indexOf("liga")&&(qi.call(this),this.tokenizer.getContextRanges("latinWord").forEach(function(e){(function(t){var e=this,i=this.tokenizer.getRangeTokens(t),n=Zi(i);n.context.forEach(function(t,r){n.setCurrentIndex(r);var s=e.query.lookupFeature({tag:"liga",script:"latn",contextParams:n});s.length&&(s.forEach(function(t){return Yi(t,i,r)}),n=Zi(i))})}).call(t,e)}))}.call(this),this.checkContextReady("arabicSentence")&&function(){var t=this;this.tokenizer.getContextRanges("arabicSentence").forEach(function(e){var i=t.tokenizer.getRangeTokens(e);t.tokenizer.replaceRange(e.startIndex,e.endOffset,i.reverse())})}.call(this)},Hi.prototype.processText=function(t){this.text&&this.text===t||(this.setText(t),function(){return Vi.call(this,"latinWord"),Vi.call(this,"arabicWord"),Vi.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}.call(this),this.applyFeaturesToContexts())},Hi.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},Hi.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],i=0;i<this.tokenizer.tokens.length;i++){var n=this.tokenizer.tokens[i];if(!n.state.deleted){var r=n.activeState.value;e.push(Array.isArray(r)?r[0]:r)}}return e},Ki.prototype.hasChar=function(t){return null!==this.encoding.charToGlyphIndex(t)},Ki.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},Ki.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),i=this.glyphs.get(e);return i||(i=this.glyphs.get(0)),i},Ki.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return"latn"===e.script?{script:"latn",tags:e.tags.filter(function(e){return t[e]})}:e})},Ki.prototype.stringToGlyphs=function(t,e){var i=this,n=new Hi;n.registerModifier("glyphIndex",null,function(t){return i.charToGlyphIndex(t.char)});var r=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,r);for(var s=n.getTextGlyphs(t),o=s.length,a=new Array(o),h=this.glyphs.get(0),l=0;l<o;l+=1)a[l]=i.glyphs.get(s[l])||h;return a},Ki.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},Ki.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),i=this.glyphs.get(e);return i||(i=this.glyphs.get(0)),i},Ki.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},Ki.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var i=this.position.defaultKerningTables;return i?this.position.getKerningValue(i,t,e):this.kerningPairs[t+","+e]||0},Ki.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Ki.prototype.forEachGlyph=function(t,e,i,n,r,s){e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:72,r=Object.assign({},this.defaultRenderOptions,r);var o,a=1/this.unitsPerEm*n,h=this.stringToGlyphs(t,r);if(r.kerning){var l=r.script||this.position.getDefaultScriptName();o=this.position.getKerningTables(l,r.language)}for(var c=0;c<h.length;c+=1){var u=h[c];const t=u.advanceWidth;s.call(this,u,e,i,n,r),t&&(u.advanceWidth=t,e+=u.advanceWidth*a),r.kerning&&c<h.length-1&&(e+=(o?this.position.getKerningValue(o,u.index,h[c+1].index):this.getKerningValue(u,h[c+1]))*a),r.letterSpacing?e+=r.letterSpacing*n:r.tracking&&(e+=r.tracking/1e3*n)}return e},Ki.prototype.getPath=function(t,e,i,n,r){var s=new A;return this.forEachGlyph(t,e,i,n,r,function(t,e,i,n){var o=t.getPath(e,i,n,r,this);s.extend(o)}),s},Ki.prototype.getPaths=function(t,e,i,n,r){var s=[];return this.forEachGlyph(t,e,i,n,r,function(t,e,i,n){var o=t.getPath(e,i,n,r,this);s.push(o)}),s},Ki.prototype.getAdvanceWidth=function(t,e,i){return this.forEachGlyph(t,0,0,e,i,function(){})},Ki.prototype.draw=function(t,e,i,n,r,s){this.getPath(e,i,n,r,s).draw(t)},Ki.prototype.drawPoints=function(t,e,i,n,r,s){this.forEachGlyph(e,i,n,r,s,function(e,i,n,r){e.drawPoints(t,i,n,r)})},Ki.prototype.drawMetrics=function(t,e,i,n,r,s){this.forEachGlyph(e,i,n,r,s,function(e,i,n,r){e.drawMetrics(t,i,n,r)})},Ki.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},Ki.prototype.validate=function(){var t=this;function e(e){var i=t.getEnglishName(e);i&&i.trim().length}e("fontFamily"),e("weightName"),e("manufacturer"),e("copyright"),e("version"),this.unitsPerEm},Ki.prototype.toTables=function(){return ye(this)},Ki.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Ki.prototype.toArrayBuffer=function(){for(var t=this.toTables().encode(),e=new ArrayBuffer(t.length),i=new Uint8Array(e),n=0;n<t.length;n++)i[n]=t[n];return e},Ki.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),i=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+i+".otf";var n=this.toArrayBuffer();if("undefined"!=typeof window)if(window.URL=window.URL||window.webkitURL,window.URL){var r=new DataView(n),s=new Blob([r],{type:"font/opentype"}),o=document.createElement("a");o.href=window.URL.createObjectURL(s),o.download=t;var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!1),o.dispatchEvent(a)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var h=require("fs"),l=function(t){for(var e=new Buffer(t.byteLength),i=new Uint8Array(t),n=0;n<e.length;++n)e[n]=i[n];return e}(n);h.writeFileSync(t,l)}},Ki.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Ki.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Ki.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var nn={make:function(t,e){var i=new Q.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*t.axes.length}]);i.offsetToData=i.sizeOf();for(var n=0;n<t.axes.length;n++)i.fields=i.fields.concat(Qi(n,t.axes[n],e));for(var r=0;r<t.instances.length;r++)i.fields=i.fields.concat(tn(r,t.instances[r],t.axes,e));return i},parse:function(t,e,i){var n=new ot.Parser(t,e),r=n.parseULong();O.argument(65536===r,"Unsupported fvar table version.");var s=n.parseOffset16();n.skip("uShort",1);for(var o=n.parseUShort(),a=n.parseUShort(),h=n.parseUShort(),l=n.parseUShort(),c=[],u=0;u<o;u++)c.push($i(t,e+s+u*a,i));for(var f=[],d=e+s+o*a,p=0;p<h;p++)f.push(en(t,d+p*l,c,i));return{axes:c,instances:f}}},rn=new Array(10);rn[1]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();return 1===e?{posFormat:1,coverage:this.parsePointer(rt.coverage),value:this.parseValueRecord()}:2===e?{posFormat:2,coverage:this.parsePointer(rt.coverage),values:this.parseValueRecordList()}:void O.assert(!1,"0x"+t.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},rn[2]=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();O.assert(1===e||2===e,"0x"+t.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var i=this.parsePointer(rt.coverage),n=this.parseUShort(),r=this.parseUShort();if(1===e)return{posFormat:e,coverage:i,valueFormat1:n,valueFormat2:r,pairSets:this.parseList(rt.pointer(rt.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(n),value2:this.parseValueRecord(r)}})))};if(2===e){var s=this.parsePointer(rt.classDef),o=this.parsePointer(rt.classDef),a=this.parseUShort(),h=this.parseUShort();return{posFormat:e,coverage:i,valueFormat1:n,valueFormat2:r,classDef1:s,classDef2:o,class1Count:a,class2Count:h,classRecords:this.parseList(a,rt.list(h,function(){return{value1:this.parseValueRecord(n),value2:this.parseValueRecord(r)}}))}}},rn[3]=function(){return{error:"GPOS Lookup 3 not supported"}},rn[4]=function(){return{error:"GPOS Lookup 4 not supported"}},rn[5]=function(){return{error:"GPOS Lookup 5 not supported"}},rn[6]=function(){return{error:"GPOS Lookup 6 not supported"}},rn[7]=function(){return{error:"GPOS Lookup 7 not supported"}},rn[8]=function(){return{error:"GPOS Lookup 8 not supported"}},rn[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var sn=new Array(10),on={parse:function(t,e){var i=new rt(t,e=e||0),n=i.parseVersion(1);return O.argument(1===n||1.1===n,"Unsupported GPOS table version "+n),1===n?{version:n,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(rn)}:{version:n,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(rn),variations:i.parseFeatureVariationsList()}},make:function(t){return new Q.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Q.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Q.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Q.LookupList(t.lookups,sn)}])}},an={parse:function(t,e){var i=new ot.Parser(t,e),n=i.parseUShort();if(0===n)return function(t){var e={};t.skip("uShort");var i=t.parseUShort();O.argument(0===i,"Unsupported kern sub-table version."),t.skip("uShort",2);var n=t.parseUShort();t.skip("uShort",3);for(var r=0;r<n;r+=1){var s=t.parseUShort(),o=t.parseUShort(),a=t.parseShort();e[s+","+o]=a}return e}(i);if(1===n)return function(t){var e={};t.skip("uShort"),t.parseULong()>1&&console.warn("Only the first kern subtable is supported."),t.skip("uLong");var i=255&t.parseUShort();if(t.skip("uShort"),0===i){var n=t.parseUShort();t.skip("uShort",3);for(var r=0;r<n;r+=1){var s=t.parseUShort(),o=t.parseUShort(),a=t.parseShort();e[s+","+o]=a}}return e}(i);throw new Error("Unsupported kern table version ("+n+").")}},hn={parse:function(t,e,i,n){for(var r=new ot.Parser(t,e),s=n?r.parseUShort:r.parseULong,o=[],a=0;a<i+1;a+=1){var h=s.call(r);n&&(h*=2),o.push(h)}return o}};function ln(t,e){require("fs").readFile(t,function(t,i){if(t)return e(t.message);e(null,Ae(i))})}function cn(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.responseType="arraybuffer",i.onload=function(){return i.response?e(null,i.response):e("Font could not be loaded: "+i.statusText)},i.onerror=function(){e("Font could not be loaded")},i.send()}function un(t,e){for(var i=[],n=12,r=0;r<e;r+=1){var s=ot.getTag(t,n),o=ot.getULong(t,n+4),a=ot.getULong(t,n+8),h=ot.getULong(t,n+12);i.push({tag:s,checksum:o,offset:a,length:h,compression:!1}),n+=16}return i}function fn(t,e){if("WOFF"===e.compression){var i=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(T(i,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");return{data:new DataView(n.buffer,0),offset:0}}return{data:t,offset:e.offset}}function dn(t,e){var i,n;e=null==e?{}:e;var r,s,o,a,h,l,c,u,f,d,p,g,v=new Ki({empty:!0}),m=new DataView(t,0),_=[],y=ot.getTag(m,0);if(y===String.fromCharCode(0,1,0,0)||"true"===y||"typ1"===y)v.outlinesFormat="truetype",_=un(m,r=ot.getUShort(m,4));else if("OTTO"===y)v.outlinesFormat="cff",_=un(m,r=ot.getUShort(m,4));else{if("wOFF"!==y)throw new Error("Unsupported OpenType signature "+y);var x=ot.getTag(m,4);if(x===String.fromCharCode(0,1,0,0))v.outlinesFormat="truetype";else{if("OTTO"!==x)throw new Error("Unsupported OpenType flavor "+y);v.outlinesFormat="cff"}_=function(t,e){for(var i=[],n=44,r=0;r<e;r+=1){var s,o=ot.getTag(t,n),a=ot.getULong(t,n+4),h=ot.getULong(t,n+8),l=ot.getULong(t,n+12);s=h<l&&"WOFF",i.push({tag:o,offset:a,compression:s,compressedLength:h,length:l}),n+=20}return i}(m,r=ot.getUShort(m,12))}for(var b=0;b<r;b+=1){var w=_[b],S=void 0;switch(w.tag){case"cmap":S=fn(m,w),v.tables.cmap=ht.parse(S.data,S.offset),v.encoding=new pt(v.tables.cmap);break;case"cvt ":S=fn(m,w),g=new ot.Parser(S.data,S.offset),v.tables.cvt=g.parseShortList(w.length/2);break;case"fvar":o=w;break;case"fpgm":S=fn(m,w),g=new ot.Parser(S.data,S.offset),v.tables.fpgm=g.parseByteList(w.length);break;case"head":S=fn(m,w),v.tables.head=Gt.parse(S.data,S.offset),v.unitsPerEm=v.tables.head.unitsPerEm,i=v.tables.head.indexToLocFormat;break;case"hhea":S=fn(m,w),v.tables.hhea=Xt.parse(S.data,S.offset),v.ascender=v.tables.hhea.ascender,v.descender=v.tables.hhea.descender,v.numberOfHMetrics=v.tables.hhea.numberOfHMetrics;break;case"hmtx":c=w;break;case"ltag":S=fn(m,w),n=Wt.parse(S.data,S.offset);break;case"maxp":S=fn(m,w),v.tables.maxp=jt.parse(S.data,S.offset),v.numGlyphs=v.tables.maxp.numGlyphs;break;case"name":d=w;break;case"OS/2":S=fn(m,w),v.tables.os2=oe.parse(S.data,S.offset);break;case"post":S=fn(m,w),v.tables.post=ae.parse(S.data,S.offset),v.glyphNames=new vt(v.tables.post);break;case"prep":S=fn(m,w),g=new ot.Parser(S.data,S.offset),v.tables.prep=g.parseByteList(w.length);break;case"glyf":a=w;break;case"loca":f=w;break;case"CFF ":s=w;break;case"kern":u=w;break;case"GPOS":h=w;break;case"GSUB":l=w;break;case"meta":p=w}}var C=fn(m,d);if(v.tables.name=re.parse(C.data,C.offset,n),v.names=v.tables.name,a&&f){var T=0===i,k=fn(m,f),E=hn.parse(k.data,k.offset,v.numGlyphs,T),A=fn(m,a);v.glyphs=Ne.parse(A.data,A.offset,E,v,e)}else{if(!s)throw new Error("Font doesn't contain TrueType or CFF outlines.");var M=fn(m,s);zt.parse(M.data,M.offset,v,e)}var D=fn(m,c);if(Yt.parse(v,D.data,D.offset,v.numberOfHMetrics,v.numGlyphs,v.glyphs,e),function(t,e){e.lowMemory?function(t){t._IndexToUnicodeMap={};for(var e=t.tables.cmap.glyphIndexMap,i=Object.keys(e),n=0;n<i.length;n+=1){var r=i[n],s=e[r];void 0===t._IndexToUnicodeMap[s]?t._IndexToUnicodeMap[s]={unicodes:[parseInt(r)]}:t._IndexToUnicodeMap[s].unicodes.push(parseInt(r))}}(t):function(t){for(var e,i=t.tables.cmap.glyphIndexMap,n=Object.keys(i),r=0;r<n.length;r+=1){var s=n[r],o=i[s];(e=t.glyphs.get(o)).addUnicode(parseInt(s))}for(var a=0;a<t.glyphs.length;a+=1)e=t.glyphs.get(a),t.cffEncoding?t.isCIDFont?e.name="gid"+a:e.name=t.cffEncoding.charset[a]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(a))}(t)}(v,e),u){var O=fn(m,u);v.kerningPairs=an.parse(O.data,O.offset)}else v.kerningPairs={};if(h){var L=fn(m,h);v.tables.gpos=on.parse(L.data,L.offset),v.position.init()}if(l){var P=fn(m,l);v.tables.gsub=ue.parse(P.data,P.offset)}if(o){var B=fn(m,o);v.tables.fvar=nn.parse(B.data,B.offset,v.names)}if(p){var I=fn(m,p);v.tables.meta=fe.parse(I.data,I.offset),v.metas=v.tables.meta}return v}t.BoundingBox=E,t.Font=Ki,t.Glyph=_t,t.Path=A,t._parse=ot,t.load=function(t,e,i){var n="undefined"==typeof window?ln:cn;return new Promise(function(r){n(t,function(t,n){if(t)return e(t);var s;try{s=dn(n,i)}catch(t){return e(t,null)}if(e)return e(null,s);r(s)})})},t.loadSync=function(t,e){return dn(Ae(require("fs").readFileSync(t)),e)},t.parse=dn,Object.defineProperty(t,"__esModule",{value:!0})}),function(t){!function(t){var e=function(){function t(){this._topNode=void 0,this._count=0,this._changedEventListeners=[],this._enableChangedEvent=!0}return t.prototype.count=function(){return this._count},t.prototype.isEmpty=function(){return void 0===this._topNode},t.prototype.push=function(t){var e=new i(t,this._topNode);this._topNode=e,this._count++,this.fireChangedEventListener()},t.prototype.pop=function(){if(0!=this._count){var t=this._topNode;return this._topNode=t.previous,this._count--,this.fireChangedEventListener(),t.data}},t.prototype.peek=function(){return this._topNode.data},t.prototype.clear=function(){this._topNode&&this._count>0&&(this._topNode=void 0,this._count=0,this.fireChangedEventListener())},t.prototype.addChangedEventListener=function(t){this._changedEventListeners.push(t)},t.prototype.removeChangedEventListener=function(t){for(var e=0;e<this._changedEventListeners.length;e++)this._changedEventListeners[e]==t&&this._changedEventListeners.splice(e--,1)},t.prototype.fireChangedEventListener=function(){if(this._enableChangedEvent)for(var t=0;t<this._changedEventListeners.length;t++)(0,this._changedEventListeners[t])()},t.prototype.getAllData=function(){for(var t=new Array(this._count),e=this._count-1,i=this._topNode;i;)t[e]=i.data,i=i.previous,e--;return t},t.prototype.getLastData=function(t){for(var e=this._topNode;e;){if(!t||t(e.data))return e.data;e=e.previous}return null},t.prototype.getAllDataAfter=function(t){for(var e=[],i=this._topNode;i&&i.data!=t;)e.push(i.data),i=i.previous;return e.reverse()},t.prototype.removeDataArray=function(t){var e=this;this._enableChangedEvent=!1,t.forEach(function(t){e.removeData(t)}),this._enableChangedEvent=!0,this.fireChangedEventListener()},t.prototype.removeData=function(t){var e=this.getNodeHavingData(t);e&&(this.removeNode(e),this.fireChangedEventListener())},t.prototype.getNodeHavingData=function(t){for(var e=this._topNode;e;){if(e.data==t)return e;e=e.previous}return null},t.prototype.removeNode=function(t){if(t)if(this._topNode==t)this._topNode=t.previous,this._count--;else{var e=this.getFollowingNode(t);e&&(e.previous=t.previous,this._count--)}},t.prototype.getFollowingNode=function(t){for(var e=this._topNode;e;){if(e.previous==t)return e;e=e.previous}},t}();t.Stack=e;var i=function(t,e){this.previous=e,this.data=t}}(t.Customizer||(t.Customizer={}))}(Zakeke||(Zakeke={}));var CryptoJS=CryptoJS||function(t,e){var i={},n=i.lib={},r=function(){},s=n.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=s.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,i=t.words,n=this.sigBytes;if(t=t.sigBytes,this.clamp(),n%4)for(var r=0;r<t;r++)e[n+r>>>2]|=(i[r>>>2]>>>24-r%4*8&255)<<24-(n+r)%4*8;else if(65535<i.length)for(r=0;r<t;r+=4)e[n+r>>>2]=i[r>>>2];else e.push.apply(e,i);return this.sigBytes+=t,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i=[],n=0;n<e;n+=4)i.push(4294967296*t.random()|0);return new o.init(i,e)}}),a=i.enc={},h=a.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++){var r=e[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n+=2)i[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new o.init(i,e/2)}},l=a.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++)i.push(String.fromCharCode(e[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n++)i[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new o.init(i,e)}},c=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},u=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,n=i.words,r=i.sigBytes,s=this.blockSize,a=r/(4*s);if(e=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*s,r=t.min(4*e,r),e){for(var h=0;h<e;h+=s)this._doProcessBlock(n,h);h=n.splice(0,e),i.sigBytes-=r}return new o.init(h,r)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});n.Hasher=u.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new f.HMAC.init(t,i).finalize(e)}}});var f=i.algo={};return i}(Math);!function(){var t=CryptoJS,e=(r=t.lib).WordArray,i=r.Hasher,n=[],r=t.algo.SHA1=i.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,r=i[0],s=i[1],o=i[2],a=i[3],h=i[4],l=0;80>l;l++){if(16>l)n[l]=0|t[e+l];else{var c=n[l-3]^n[l-8]^n[l-14]^n[l-16];n[l]=c<<1|c>>>31}c=(r<<5|r>>>27)+h+n[l],c=20>l?c+(1518500249+(s&o|~s&a)):40>l?c+(1859775393+(s^o^a)):60>l?c+((s&o|s&a|o&a)-1894007588):c+((s^o^a)-899497514),h=a,a=o,o=s<<30|s>>>2,s=r,r=c}i[0]=i[0]+r|0,i[1]=i[1]+s|0,i[2]=i[2]+o|0,i[3]=i[3]+a|0,i[4]=i[4]+h|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=Math.floor(i/4294967296),e[15+(n+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(r),t.HmacSHA1=i._createHmacHelper(r)}(),(Zakeke=Zakeke||{}).generateUUID=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:7&i|8).toString(16)})},Zakeke.getEmptyUUID=function(){return"00000000-0000-0000-0000-000000000000"},Zakeke.makeID=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},Zakeke.ShaderInputType={Float:1,Int:2,Texture:3,Array2:4,Array3:5,Color3:6,Color4:7,Matrix:8,Matrix2x2:9,Matrix3x3:10,Vector2:11,Vector3:12,Vector4:13},Zakeke.TryOnType={Glasses:1,Shoes:2},Zakeke.ShaderOptionType={Attribute:1,Uniform:2,Sampler:3},Zakeke.TextureCompressionFormat={None:"None",WebP:"Webp"},Zakeke.TextureCompressionType={Lossless:"Lossless",Lossy:"Lossy"},Zakeke.IncrementalFileInfo=function(){this.name="",this.data=null,this.isScene=!1,this.dracoEncoded=!1},Zakeke.TextureUsage={Any:0,Desktop:1,Mobile:2},Zakeke.SceneCameraConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGroundConfig=Backbone.AssociatedModel.extend({defaults:{createGround:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSkyboxConfig=Backbone.AssociatedModel.extend({defaults:{createSkybox:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneShadowsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneEnvironmentConfig=Backbone.AssociatedModel.extend({defaults:{skybox:null,ground:null,shadows:null},initialize:function(){this.get("skybox")&&(this.get("skybox").parentModel=this),this.get("ground")&&(this.get("ground").parentModel=this),this.get("shadows")&&(this.get("shadows").parentModel=this)},relations:[{type:Backbone.One,key:"skybox",relatedModel:Zakeke.SceneSkyboxConfig},{type:Backbone.One,key:"ground",relatedModel:Zakeke.SceneGroundConfig},{type:Backbone.One,key:"shadows",relatedModel:Zakeke.SceneShadowsConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.EnvironmentOptionsConfig=Backbone.AssociatedModel.extend({defaults:{mipMaps:null,generateHarmonics:null,gammaSpace:null,prefilterOnLoad:null,rotationY:null,intensity:null},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGeneralConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){this.get("environmentOptions")&&(this.get("environmentOptions").parentModel=this)},relations:[{type:Backbone.One,key:"environmentOptions",relatedModel:Zakeke.EnvironmentOptionsConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGlowConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneInfoPointsStyleConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneInfoPointsConfig=Backbone.AssociatedModel.extend({defaults:{pointsStyle:null},initialize:function(){this.get("pointsStyle")&&(this.get("pointsStyle").parentModel=this)},relations:[{type:Backbone.One,key:"pointsStyle",relatedModel:Zakeke.SceneInfoPointsStyleConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneLightsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneShadowsConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneModelConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneModelTransformsConfig=Backbone.AssociatedModel.extend({defaults:{scale:null,rotation:null,position:null},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.WebPOptions=Backbone.AssociatedModel.extend({defaults:{type:Zakeke.TextureCompressionType.Lossy,quality:80},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneTexturesConfig=Backbone.AssociatedModel.extend({defaults:{format:Zakeke.TextureCompressionFormat.None,webpOptions:null},initialize:function(){this.get("webpOptions")&&(this.get("webpOptions").parentModel=this)},relations:[{type:Backbone.One,key:"webpOptions",relatedModel:Zakeke.WebPOptions}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneUiConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneConfig=Backbone.AssociatedModel.extend({defaults:{general:null,environment:null,camera:null,model:null,glow:null,infoPoints:null,uiConfig:null,lights:null,textures:null,modelTransforms:null},initialize:function(){const t=this;this.get("general")&&(this.get("general").parentModel=this),this.get("environment")&&(this.get("environment").parentModel=this),this.get("camera")&&(this.get("camera").parentModel=this),this.get("glow")&&(this.get("glow").parentModel=this),this.get("infoPoints")&&(this.get("infoPoints").parentModel=this),this.get("uiConfig")&&(this.get("uiConfig").parentModel=this),this.get("lights")&&(this.get("lights").parentModel=this),this.get("model")&&(this.get("model").parentModel=this),this.get("modelTransforms")&&(this.get("modelTransforms").parentModel=this),this.get("textures")&&(this.get("textures").parentModel=this),this.get("general")&&this.get("general").on("change",function(){t.trigger("change")}),this.get("environment")&&this.get("environment").on("change",function(){t.trigger("change")}),this.get("camera")&&this.get("camera").on("change",function(){t.trigger("change")}),this.get("glow")&&this.get("glow").on("change",function(){t.trigger("change")}),this.get("infoPoints")&&this.get("infoPoints").on("change",function(){t.trigger("change")}),this.get("uiConfig")&&this.get("uiConfig").on("change",function(){t.trigger("change")}),this.get("lights")&&this.get("lights").on("change",function(){t.trigger("change")}),this.get("model")&&this.get("model").on("change",function(){t.trigger("change")}),this.get("modelTransforms")&&this.get("modelTransforms").on("change",function(){t.trigger("change")}),this.get("textures")&&this.get("textures").on("change",function(){t.trigger("change")})},relations:[{type:Backbone.One,key:"general",relatedModel:Zakeke.SceneGeneralConfig},{type:Backbone.One,key:"environment",relatedModel:Zakeke.SceneEnvironmentConfig},{type:Backbone.One,key:"camera",relatedModel:Zakeke.SceneCameraConfig},{type:Backbone.One,key:"glow",relatedModel:Zakeke.SceneGlowConfig},{type:Backbone.One,key:"infoPoints",relatedModel:Zakeke.SceneInfoPointsConfig},{type:Backbone.One,key:"uiConfig",relatedModel:Zakeke.SceneUiConfig},{type:Backbone.One,key:"lights",relatedModel:Zakeke.SceneLightsConfig},{type:Backbone.One,key:"model",relatedModel:Zakeke.SceneModelConfig},{type:Backbone.One,key:"modelTransforms",relatedModel:Zakeke.SceneModelTransformsConfig},{type:Backbone.One,key:"textures",relatedModel:Zakeke.SceneTexturesConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSourceTaskOptions=Backbone.AssociatedModel.extend({defaults:{textures:null},initialize:function(){this.get("textures")&&(this.get("textures").parentModel=this)},relations:[{type:Backbone.One,key:"textures",relatedModel:Zakeke.SceneTexturesConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSourceTexture=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,url:""},idAttribute:"textureID",initialize:function(){},relations:[],getTextureID:function(){return this.get("textureID")},getSourceID:function(){return this.collection&&this.collection.getSourceID?this.collection.getSourceID():null},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneSourceTextures=Backbone.Collection.extend({model:Zakeke.SceneSourceTexture,getSourceID:function(){return this.parentModel&&this.parentModel.getSourceID?this.parentModel.getSourceID():null},getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findTexture:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("textureID")==t)return i}return null}}),Zakeke.SceneSource=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,url:"",rootUrl:"",sceneFileName:"",textures:[]},idAttribute:"sourceID",initialize:function(){this.get("textures").parentModel=this},relations:[{type:Backbone.Many,key:"textures",collectionType:Zakeke.SceneSourceTextures}],getSourceID:function(){return this.get("sourceID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneSources=Backbone.Collection.extend({model:Zakeke.SceneSource,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findSource:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sourceID")==t)return i}return null}}),Zakeke.SceneShaderMaterial=Backbone.AssociatedModel.extend({defaults:{materialID:"",name:"",vertex:"",fragment:""},idAttribute:"materialID",initialize:function(){},relations:[],getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneShaderMaterials=Backbone.Collection.extend({model:Zakeke.SceneShaderMaterial,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findShaderMaterial:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("materialID")==t)return i}return null}}),Zakeke.SceneTexture=Backbone.AssociatedModel.extend({defaults:{materialID:"",isDefaultEnvironment:!1,fileObjectID:-1,fileLength:-1,url:"",usage:Zakeke.TextureUsage.Any},idAttribute:"textureID",initialize:function(){},relations:[],getTextureID:function(){return this.get("textureID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneTextures=Backbone.Collection.extend({model:Zakeke.SceneTexture,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findTexture:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("textureID")==t)return i}return null}}),Zakeke.SceneMaterialPhoto=Backbone.AssociatedModel.extend({defaults:{materialID:"",displayOrder:0,fileObjectID:-1,fileLength:-1,url:""},idAttribute:"photoID",initialize:function(){},relations:[],getMaterialPhotoID:function(){return this.get("photoID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMaterialPhotos=Backbone.Collection.extend({model:Zakeke.SceneMaterialPhoto,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findMaterialPhoto:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("photoID")===t)return i}return null},getMaterialPhotoUrls:function(t){for(var e=[],i=0;i<this.length;i++)this.at(i).get("materialID")===t&&e.push(this.at(i).get("url"));return e}}),Zakeke.SceneCameraLocation=Backbone.AssociatedModel.extend({defaults:{name:"",px:0,py:0,pz:0,tx:0,ty:0,tz:0},idAttribute:"locationID",initialize:function(){this.get("locationID")||this.set("locationID",Zakeke.generateUUID())},relations:[],getLocationID:function(){return this.get("locationID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneCameraLocations=Backbone.Collection.extend({model:Zakeke.SceneCameraLocation,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findCameraLocation:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("locationID")==t)return i}return null}}),Zakeke.SceneMeshLocation=Backbone.AssociatedModel.extend({defaults:{name:"",tempImageFileKey:"",imageUrl:"",displayOrder:0,isCollapsed:!1,isExploded:!1,adjustCamera:!0,data:[]},idAttribute:"locationID",initialize:function(){this.get("locationID")||this.set("locationID",Zakeke.generateUUID())},relations:[],getLocationID:function(){return this.get("locationID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMeshLocations=Backbone.Collection.extend({model:Zakeke.SceneMeshLocation,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findMeshLocation:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("locationID")==t)return i}return null},getFirstExplodedMeshLocation:function(){for(var t=0;t<this.length;t++){var e=this.at(t);if(e.get("isExploded"))return e}return null},getFirstCollapsedMeshLocation:function(){for(var t=0;t<this.length;t++){var e=this.at(t);if(e.get("isCollapsed"))return e}return null},getOrCreateExplodedMeshLocation:function(){var t=this.getFirstExplodedMeshLocation();return t||((t=new Zakeke.SceneMeshLocation).set("name","exploded"),t.set("isExploded",!0),this.push(t)),t},getOrCreateCollapsedMeshLocation:function(){var t=this.getFirstCollapsedMeshLocation();return t||((t=new Zakeke.SceneMeshLocation).set("name","collapsed"),t.set("isCollapsed",!0),this.push(t)),t}}),Zakeke.SceneMaterialMapping=Backbone.AssociatedModel.extend({defaults:{libraryMaterialID:"",sceneMaterialID:""},initialize:function(){},relations:[],getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMaterialMappings=Backbone.Collection.extend({model:Zakeke.SceneMaterialMapping,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},getMappingForSceneMaterial:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sceneMaterialID")==t)return i}},getMappingsForLibraryMaterial:function(t){for(var e=[],i=0;i<this.length;i++){var n=this.at(i);n.get("libraryMaterialID")==t&&e.push(n)}return e},getLibraryMaterialIDs:function(){for(var t=[],e={},i=0;i<this.length;i++)e[this.at(i).get("libraryMaterialID")]=!0;for(var n in e)t.push(n);return t}}),Zakeke.SceneARFile=Backbone.AssociatedModel.extend({defaults:{fileType:"",url:""},idAttribute:"fileID",initialize:function(){this.get("fileID")||this.set("fileID",Zakeke.generateUUID())},getFileID:function(){return this.get("fileID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneARFiles=Backbone.Collection.extend({model:Zakeke.SceneARFile,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findFile:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("fileID")===t)return i}return null}}),Zakeke.Scene=Backbone.AssociatedModel.extend({defaults:{name:"",fileObjectID:-1,fileLength:-1,url:"",rootUrl:"",sceneFileName:"",manifestFileObjectID:-1,manifestFileLength:-1,manifestFileUrl:"",sellerID:-1,imageData:null,imageUrl:"",useDefaultEnvironmentTexture:!1,cameraLimitLowerRadius:!0,version:0,config:null,usedTextureUrls:null,sources:[],cameraLocations:[],materialMappings:[],textures:[],materialPhotos:[],shaderMaterials:[],meshLocations:[],arFiles:[]},idAttribute:"sceneID",_eventListeners:{change:[]},_fireEvent:function(t,e){if(this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&_.isArray(this._eventListeners[t]))for(var i=this._eventListeners[t],n=0;n<i.length;++n)i[n](e)},trigger:function(t){this._fireEvent(t)},addEventListener:function(t,e){this._eventListeners&&_.isObject(this._eventListeners)&&(_.has(this._eventListeners,t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},removeEventListener:function(t){this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&delete this._eventListeners[t]},getSceneID:function(){return null!=this.id&&null!=this.id?this.id:this.get("tempSceneID")},initialize:function(){this.get("tempSceneID")||this.set("tempSceneID",Zakeke.generateUUID());var t=this;this.get("config")&&(this.get("config").parentModel=this),this.get("sources").parentModel=this,this.get("sources").url=function(){return t.url()+"/"+t.getSceneID()+"/sources"},this.get("cameraLocations").parentModel=this,this.get("cameraLocations").url=function(){return t.url()+"/"+t.getSceneID()+"/cameraLocations"},this.get("meshLocations").parentModel=this,this.get("meshLocations").url=function(){return t.url()+"/"+t.getSceneID()+"/meshLocations"},this.get("materialMappings").parentModel=this,this.get("textures").parentModel=this,this.get("materialPhotos").parentModel=this,this.get("shaderMaterials").parentModel=this,this.get("arFiles").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("config")&&this.get("config").on("change",function(){t._fireEvent("change")})},relations:[{type:Backbone.One,key:"config",relatedModel:Zakeke.SceneConfig},{type:Backbone.Many,key:"sources",collectionType:Zakeke.SceneSources},{type:Backbone.Many,key:"cameraLocations",collectionType:Zakeke.SceneCameraLocations},{type:Backbone.Many,key:"meshLocations",collectionType:Zakeke.SceneMeshLocations},{type:Backbone.Many,key:"materialMappings",collectionType:Zakeke.SceneMaterialMappings},{type:Backbone.Many,key:"textures",collectionType:Zakeke.SceneTextures},{type:Backbone.Many,key:"materialPhotos",collectionType:Zakeke.SceneMaterialPhotos},{type:Backbone.Many,key:"shaderMaterials",collectionType:Zakeke.SceneShaderMaterials},{type:Backbone.Many,key:"arFiles",collectionType:Zakeke.SceneARFiles}],url:function(){var t=this.getSceneBaseUrl()+"scenes";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},getSceneBaseUrl:function(){return Zakeke.config.baseScenesApiUrl||Zakeke.config.baseApiUrl},getSceneFileUploadUrl:function(){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/scenefile"},getSceneRootUrlApiUrl:function(){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/rooturl"},getSceneIncrementalFileUploadUrl:function(){return this.getSceneFileUploadUrl()+"?incremental=true"},getSourceUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/sources/"+t},getSourceTasksUrl:function(){return Zakeke.config.baseImagesUploadApiUrl+"scenes/"+this.getSceneID()+"/sourcetasks"},getSourceTaskResultUrl:function(t){return Zakeke.config.baseImagesUploadApiUrl+"scenes/"+this.getSceneID()+"/sourcetaskresult/"+t},getSourceTasksUrl:function(){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/sourcetasks"},getSourceTaskResultUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/sourcetaskresult/"+t},getTexturesUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/textures/"+t},getMaterialPhotosUrl:function(t){return this.getSceneBaseUrl()+"scenes/"+this.getSceneID()+"/materialphotos/"+t},getSourcesIDs:function(){for(var t=[],e=0;e<this.get("sources").length;e++){var i=this.get("sources").at(e);t.push(i.getSourceID())}return t},getMappingForSceneMaterial:function(t){return this.get("materialMappings").getMappingForSceneMaterial(t)},getMappingsForLibraryMaterial:function(t){return this.get("materialMappings").getMappingsForLibraryMaterial(t)},getLibraryMaterialIDs:function(){return this.get("materialMappings").getLibraryMaterialIDs()},mapLibraryMaterial:function(t,e){var i=new Zakeke.SceneMaterialMapping;i.set("libraryMaterialID",t),i.set("sceneMaterialID",e),this.get("materialMappings").push(i)},removeMappingForSceneMaterial:function(t){var e=this.get("materialMappings").getMappingForSceneMaterial(t);e&&this.get("materialMappings").remove(e)},registerShaderMaterial:function(t,e,i,n){var r=this.get("shaderMaterials").findWhere({materialID:t});r||((r=new Zakeke.SceneShaderMaterial).set("materialID",t),r.set("name",e),r.set("vertex",i),r.set("fragment",n),this.get("shaderMaterials").push(r))},getLibraryShaderMaterialIDForSceneMaterial:function(t){var e=this.getMappingForSceneMaterial(t);if(e)for(var i=e.get("libraryMaterialID"),n=0;n<this.get("shaderMaterials").length;n++)if(this.get("shaderMaterials").at(n).get("materialID")===i)return i;return null},unregisterShaderMaterial:function(t){var e=this.get("shaderMaterials").findWhere({materialID:t});e&&this.get("shaderMaterials").remove(e)},getCameraLocation:function(t){return this.get("cameraLocations").findCameraLocation(t)},getMeshLocation:function(t){return this.get("meshLocations").findMeshLocation(t)},getSceneConfig:function(){return this.get("config")},getOrCreateSceneConfig:function(){const t=this;let e=this.getSceneConfig();return e||((e=new Zakeke.SceneConfig).on("change",function(){t._fireEvent("change")}),this.set("config",e)),e},getGeneralConfig:function(){var t=this.getSceneConfig();return t&&t.get("general")&&t.get("general")instanceof Zakeke.SceneGeneralConfig?t.get("general"):null},getOrCreateGeneralConfig:function(){const t=this.getOrCreateSceneConfig();let e=t.get("general");return e||((e=new Zakeke.SceneGeneralConfig).on("change",function(){t.trigger("change")}),t.set("general",e)),e},getMatchSameNameTextures:function(){var t=this.getGeneralConfig();if(t)return t.get("matchSameNameTextures")},setMatchSameNameTextures:function(t){this.getOrCreateGeneralConfig().set("matchSameNameTextures",t)},getAntialiasEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("antialiasEnabled")},setAntialiasEnabled:function(t){this.getOrCreateGeneralConfig().set("antialiasEnabled",t)},getTryOnEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnEnabled")},setTryOnEnabled:function(t){this.getOrCreateGeneralConfig().set("tryOnEnabled",t)},getTryOnSettings:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnSettings")},setTryOnSettings:function(t){this.getOrCreateGeneralConfig().set("tryOnSettings",t)},getFrameDAMSettings:function(){var t=this.getGeneralConfig();if(t)return t.get("frameDAMSettings")},setFrameDAMSettings:function(t){this.getOrCreateGeneralConfig().set("frameDAMSettings",t)},getAREnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("arEnabled")},setAREnabled:function(t){this.getOrCreateGeneralConfig().set("arEnabled",t)},getAROnTheFly:function(){return this.getOrCreateGeneralConfig().get("arOnTheFly")},setAROnTheFly:function(t){this.getOrCreateGeneralConfig().set("arOnTheFly",t)},getARAnchor:function(){return this.getOrCreateGeneralConfig().get("arAnchor")},setARAnchor:function(t){this.getOrCreateGeneralConfig().set("arAnchor",t)},getTryOnEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnEnabled")},setTryOnEnabled:function(t){this.getOrCreateGeneralConfig().set("tryOnEnabled",t)},getARScale:function(){var t=this.getGeneralConfig();if(t){var e=t.get("arScale");return null==e||e}return!0},setARScale:function(t){this.getOrCreateGeneralConfig().set("arScale",t)},getARMeshSize:function(){var t=this.getGeneralConfig();if(t){var e=t.get("meshSize");return null==e||e}return!0},setARMeshSize:function(t){this.getOrCreateGeneralConfig().set("meshSize",t)},setForceDracoCompression:function(t){this.getOrCreateGeneralConfig().set("forceDracoCompression",t)},getForceDracoCompression:function(){var t=this.getGeneralConfig();if(t)return t.get("forceDracoCompression")},setFitToScreenMargin:function(t){this.getOrCreateGeneralConfig().set("fitToScreenMargin",t)},getFitToScreenMargin:function(){var t=this.getGeneralConfig();return t?t.get("fitToScreenMargin"):1},getUseDelayedTextureLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedTextureLoading")},setUseDelayedTextureLoading:function(t){this.getOrCreateGeneralConfig().set("useDelayedTextureLoading",t)},getUseDelayedMaterialLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedMaterialLoading")},setUseDelayedMaterialLoading:function(t){this.getOrCreateGeneralConfig().set("useDelayedMaterialLoading",t)},getUseMaterialOffloading:function(){var t=this.getGeneralConfig();if(t)return t.get("useMaterialOffloading")},setUseMaterialOffloading:function(t){this.getOrCreateGeneralConfig().set("useMaterialOffloading",t)},getPrefetchMeshes:function(){var t=this.getGeneralConfig();if(t)return t.get("prefetchMeshes")},setPrefetchMeshes:function(t){this.getOrCreateGeneralConfig().set("prefetchMeshes",t)},getPrefetchMaterials:function(){var t=this.getGeneralConfig();if(t)return t.get("prefetchMaterials")},setPrefetchMaterials:function(t){this.getOrCreateGeneralConfig().set("prefetchMaterials",t)},getEnvironmentConfig:function(){var t=this.getSceneConfig();return t&&t.get("environment")&&t.get("environment")instanceof Zakeke.SceneEnvironmentConfig?t.get("environment"):null},getOrCreateEnvironmentConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("environment");return e||(e=new Zakeke.SceneEnvironmentConfig,t.set("environment",e)),e},getSkyboxConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("skybox")&&t.get("skybox")instanceof Zakeke.SceneSkyboxConfig?t.get("skybox"):null},getOrCreateSkyboxConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("skybox");return e||(e=new Zakeke.SceneSkyboxConfig,t.set("skybox",e)),e},getGroundConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("ground")&&t.get("ground")instanceof Zakeke.SceneGroundConfig?t.get("ground"):null},getOrCreateGroundConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("ground");return e||(e=new Zakeke.SceneGroundConfig,t.set("ground",e)),e},getShadowsConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("shadows")?t.get("shadows"):null},getOrCreateShadowsConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("shadows");return e||(e=new Zakeke.SceneShadowsConfig,t.set("shadows",e)),e},getCameraConfig:function(){var t=this.getSceneConfig();return t&&t.get("camera")&&t.get("camera")instanceof Zakeke.SceneCameraConfig?t.get("camera"):null},getOrCreateCameraConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("camera");return e||(e=new Zakeke.SceneCameraConfig,t.set("camera",e)),e},getCameraPositionScale:function(){var t=this.getCameraConfig();if(t)return t.get("positionScale")},setCameraPositionScale:function(t){this.getOrCreateCameraConfig().set("positionScale",t)},getCameraLimitLowerRadius:function(){var t=this.getCameraConfig();if(t)return t.get("limitLowerRadius")},setCameraLimitLowerRadius:function(t){this.getOrCreateCameraConfig().set("limitLowerRadius",t)},getCameraZoomEnabled:function(){var t=this.getCameraConfig();if(t)return t.get("zoomEnabled")},setCameraZoomEnabled:function(t){this.getOrCreateCameraConfig().set("zoomEnabled",t)},getCameraUseMinZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("useMinZoomPerc")},setCameraUseMinZoomPerc:function(t){this.getOrCreateCameraConfig().set("useMinZoomPerc",t)},getCameraMinZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("minZoomPerc")},setCameraMinZoomPerc:function(t){this.getOrCreateCameraConfig().set("minZoomPerc",t)},getCameraUseMaxZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("useMaxZoomPerc")},setCameraUseMaxZoomPerc:function(t){this.getOrCreateCameraConfig().set("useMaxZoomPerc",t)},getCameraMaxZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("maxZoomPerc")},setCameraMaxZoomPerc:function(t){this.getOrCreateCameraConfig().set("maxZoomPerc",t)},getCameraLowerAlphaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("lowerAlphaLimit")},setCameraLowerAlphaLimit:function(t){this.getOrCreateCameraConfig().set("lowerAlphaLimit",t)},getCameraUpperAlphaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("upperAlphaLimit")},setCameraUpperAlphaLimit:function(t){this.getOrCreateCameraConfig().set("upperAlphaLimit",t)},getCameraLowerBetaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("lowerBetaLimit")},setCameraLowerBetaLimit:function(t){this.getOrCreateCameraConfig().set("lowerBetaLimit",t)},getCameraUpperBetaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("upperBetaLimit")},setCameraUpperBetaLimit:function(t){this.getOrCreateCameraConfig().set("upperBetaLimit",t)},getGlowConfig:function(){var t=this.getSceneConfig();return t&&t.get("glow")&&t.get("glow")instanceof Zakeke.SceneGlowConfig?t.get("glow"):null},getOrCreateGlowConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("glow");return e||(e=new Zakeke.SceneGlowConfig,t.set("glow",e)),e},getInfoPointsConfig:function(){var t=this.getSceneConfig();return t&&t.get("infoPoints")&&t.get("infoPoints")instanceof Zakeke.SceneInfoPointsConfig?t.get("infoPoints"):null},getOrCreateInfoPointsConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("infoPoints");return e||(e=new Zakeke.SceneInfoPointsConfig,t.set("infoPoints",e)),e},getInfoPointsEnabled:function(){var t=!1,e=this.getInfoPointsConfig();return e&&(t=e.get("enabled")),null==t&&(t=!1),t},setInfoPointsEnabled:function(t){this.getOrCreateInfoPointsConfig().set("enabled",t)},getInfoPointsStyleConfig:function(){var t=this.getInfoPointsConfig();return t&&t.get("pointsStyle")&&t.get("pointsStyle")instanceof Zakeke.SceneInfoPointsStyleConfig?t.get("pointsStyle"):null},getOrCreateInfoPointsStyleConfig:function(){var t=this.getOrCreateInfoPointsConfig(),e=t.get("pointsStyle");return e||(e=new Zakeke.SceneInfoPointsStyleConfig,t.set("pointsStyle",e)),e},getInfoPointsBorderColor:function(){var t="#ffffff",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("borderColor")),t||(t="#ffffff"),t},setInfoPointsBorderColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("borderColor",t)},getInfoPointsInnerPointColor:function(){var t="#ffffff",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("innerPointColor")),t||(t="#ffffff"),t},setInfoPointsInnerPointColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("innerPointColor",t)},getInfoPointsColor:function(){var t="#a01c20",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("color")),t||(t="#a01c20"),t},setInfoPointsColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("color",t)},getInfoPointsHighlightColor:function(){var t="#bb2025",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("highlightColor")),t||(t="#bb2025"),t},setInfoPointsHighlightColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("highlightColor",t)},getFirstExplodedMeshLocation:function(){return this.get("meshLocations").getFirstExplodedMeshLocation()},getFirstCollapsedMeshLocation:function(){return this.get("meshLocations").getFirstCollapsedMeshLocation()},getOrCreateExplodedMeshLocation:function(){return this.get("meshLocations").getOrCreateExplodedMeshLocation()},getOrCreateCollapsedMeshLocation:function(){return this.get("meshLocations").getOrCreateCollapsedMeshLocation()},getWebPEnabled:function(){var t=this.getTexturesConfig();return!!t&&"WebP"===t.get("format")},setWebPEnabled:function(t){var e=this.getOrCreateTexturesConfig(),i=t?"WebP":"None";"WebP"==i&&this.getOrCreateTextureWebPOptions(),e.set("format",i)},getWebPType:function(){var t=this.getTextureWepPOptions();return t?t.get("type"):"Lossy"},setWebPType:function(t){var e=this.getOrCreateTextureWebPOptions(),i="Lossy";t&&"lossless"===t.toLowerCase()&&(i="Lossless"),e.set("type",i)},getWebPQuality:function(){var t=this.getTextureWepPOptions();return t?t.get("quality"):80},setWebPQuality:function(t){var e=this.getOrCreateTextureWebPOptions(),i=Number(t);isNaN(i)&&(i=80),i=Math.max(1,Math.min(100,i)),e.set("quality",t)},getTexturesConfig:function(){var t=this.getSceneConfig();return t&&t.get("textures")&&t.get("textures")instanceof Zakeke.SceneTexturesConfig?t.get("textures"):null},getOrCreateTexturesConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("textures");return e||(e=new Zakeke.SceneTexturesConfig,t.set("textures",e)),e},getTextureCompressionFormat:function(){var t=this.getTexturesConfig();if(t)return t.get("format")},setTextureCompressionFormat:function(t){this.getOrCreateTexturesConfig().set("format",t)},getTextureWepPOptions:function(){var t=this.getTexturesConfig();if(t)return t.get("webpOptions")},getOrCreateTextureWebPOptions:function(){var t=this.getOrCreateTexturesConfig(),e=t.get("webpOptions");return e||(e=new Zakeke.WebPOptions,t.set("webpOptions",e)),e},setTextureWepPOptions:function(t){this.getOrCreateTexturesConfig().set("webpOptions",t)},setTextureWebPType:function(t){this.getOrCreateTextureWebPOptions().set("type",t)},setTextureWebPQuality:function(t){this.getOrCreateTextureWebPOptions().set("quality",t)},getOrCreateSceneModelTransformsConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("modelTransforms");return e||(e=new Zakeke.SceneModelTransformsConfig,t.set("modelTransforms",e)),e},getSceneModelTransformsConfig:function(){var t=this.getSceneConfig();return t&&t.get("modelTransforms")&&t.get("modelTransforms")instanceof Zakeke.SceneModelTransformsConfig?t.get("modelTransforms"):null},getModelTransformsScale:function(){var t=this.getSceneModelTransformsConfig();return t?t.get("scale"):null},setModelTransformsScale:function(t){this.getOrCreateSceneModelTransformsConfig().set("scale",t)},getModelTransformsRotation:function(){var t=this.getSceneModelTransformsConfig();return t?t.get("rotation"):null},setModelTransformsRotation:function(t){this.getOrCreateSceneModelTransformsConfig().set("rotation",t)},getModelTransformsPosition:function(){var t=this.getSceneModelTransformsConfig();return t?t.get("position"):null},setModelTransformsPosition:function(t){this.getOrCreateSceneModelTransformsConfig().set("position",t)}}),Zakeke.Scenes=Backbone.Collection.extend({model:Zakeke.Scene,url:function(){return Zakeke.config.baseApiUrl+"scenes"},getScene:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sceneID")==t)return i}return null}}),Zakeke.MaterialSourceTextureImage=Backbone.AssociatedModel.extend({defaults:{sceneID:null,sourceID:null,materialID:null,fileObjectID:-1,fileLength:-1,url:""},initialize:function(){},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialSourceTextureImages=Backbone.Collection.extend({model:Zakeke.MaterialSourceTextureImage,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null}}),Zakeke.MaterialTextureImage=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,imageUrl:""},idAttribute:"textureImageID",initialize:function(){},relations:[],getTextureImageID:function(){return this.get("textureImageID")},getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialTextureImages=Backbone.Collection.extend({model:Zakeke.MaterialTextureImage,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findTextureImage:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("textureImageID")==t)return i}return null}}),Zakeke.MaterialShaderOption=Backbone.AssociatedModel.extend({defaults:{name:"",shaderOptionTypeID:Zakeke.ShaderOptionType.Attribute},idAttribute:"optionID",initialize:function(){this.get("optionID")||this.set("optionID",Zakeke.generateUUID())},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialShaderOptions=Backbone.Collection.extend({model:Zakeke.MaterialShaderOption,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findShaderOption:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("optionID")==t)return i}return null}}),Zakeke.MaterialShaderInput=Backbone.AssociatedModel.extend({defaults:{name:"",shaderInputTypeID:Zakeke.ShaderInputType.Float},idAttribute:"inputID",initialize:function(){this.get("inputID")||this.set("inputID",Zakeke.generateUUID())},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialShaderInputs=Backbone.Collection.extend({model:Zakeke.MaterialShaderInput,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findShaderInput:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("inputID")==t)return i}return null}}),Zakeke.MaterialShader=Backbone.AssociatedModel.extend({defaults:{name:"",vertex:"",fragment:""},idAttribute:"materialID",initialize:function(){},relations:[],getMaterialID:function(){return this.collection&&this.collection.getModelID?this.collection.getMaterialID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){}}),Zakeke.Material=Backbone.AssociatedModel.extend({defaults:{name:"",JSON:"",url:"",rootUrl:"",materialFileName:"",sellerID:-1,imageData:null,imageUrl:"",fileLength:-1,sourceTextureImages:[],textureImages:[],shaders:null,shaderInputs:[],shaderOptions:[]},idAttribute:"materialID",getMaterialID:function(){return null!=this.id&&null!=this.id?this.id:this.get("tempMaterialID")},initialize:function(){this.set("tempMaterialID",Zakeke.generateUUID());var t=this;this.get("textureImages").parentModel=this,this.get("textureImages").url=function(){return t.url()+"/"+t.getMaterialID()+"/textures"},this.get("sourceTextureImages").parentModel=this,this.get("shaders")&&(this.get("shaders").parentModel=this),this.get("shaderInputs").parentModel=this,this.get("shaderOptions").parentModel=this},relations:[{type:Backbone.Many,key:"sourceTextureImages",collectionType:Zakeke.MaterialSourceTextureImages},{type:Backbone.Many,key:"textureImages",collectionType:Zakeke.MaterialTextureImages},{type:Backbone.One,key:"shaders",relatedModel:Zakeke.MaterialShader},{type:Backbone.Many,key:"shaderInputs",collectionType:Zakeke.MaterialShaderInputs},{type:Backbone.Many,key:"shaderOptions",collectionType:Zakeke.MaterialShaderOptions}],url:function(){var t=Zakeke.config.baseApiUrl+"materials";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},getTexturesUrl:function(){return Zakeke.config.baseApiUrl+"materials/"+this.getMaterialID()+"/textures"},getClonedContentForSceneUrl:function(t){return Zakeke.config.baseApiUrl+"materials/"+this.getMaterialID()+"/clonedContentForScene/"+t},getShaderAttributeOptions:function(t){for(var e=[],i=0;i<this.get("shaderOptions").length;i++){var n=this.get("shaderOptions").at(i);n.get("shaderOptionTypeID")===t&&e.push(n.get("name"))}return e}}),Zakeke.Materials=Backbone.Collection.extend({model:Zakeke.Material,url:function(){return Zakeke.config.baseApiUrl+"materials"},getMaterial:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("materialID")==t)return i}return null},comparator:function(t){return t.get("name")}}),(Zakeke=Zakeke||{}).cloudFlareApiUrl=function(){return"string"==typeof Zakeke.config.cloudFlareApiUrl&&null!==Zakeke.config.cloudFlareApiUrl&&""!==Zakeke.config.cloudFlareApiUrl.trim()?Zakeke.config.cloudFlareApiUrl:null},Zakeke.ComposerModels=Backbone.AssociatedModel.extend({defaults:{model:null,scene:null},idAttribute:"modelID",initialize:function(){},sceneIDSuccessfull:function(t,e,i,n){var r=n.sceneID,s=new MPlaza.Model;s.set("modelID",this.get("modelID")),this.set("model",s);var o=t.get("model").fetch({data:e.data}),a=new Zakeke.Scene;a.set("sceneID",r),t.set("scene",a);var h=t.get("scene").fetch({data:e.data});$.when(o,h).done(function(n){e.success&&e.success(t,n,e),t.trigger("sync",t,n,e),i.resolve()}).fail(function(){i.reject()})},getSceneID:function(t,e){var i=this,n=i.get("modelID"),r=!0,s=Zakeke.cloudFlareApiUrl(),o=Zakeke.config.baseApiUrl;null==e&&(e=$.Deferred()),null!==s&&r&&(o=s,r=!1);var a=o+"models/"+n+"/defaultSceneId";return null!=t&&(a+="?c="+t),$.get(a).then(function(t){e.resolve(t)},function(){!1===r?i.getSceneID(t,e):e.reject()}),e.promise()},fetch:function(t){t=t||{};var e=$.Deferred(),i=void 0!==t.data?t.data.c:void 0;return this.getSceneID(i).then(this.sceneIDSuccessfull.bind(this,this,t,e),function(){e.reject()}),e.promise()},relations:[{type:Backbone.One,key:"model",relatedModel:MPlaza.Model},{type:Backbone.One,key:"scene",relatedModel:Zakeke.Scene}]}),(Zakeke=Zakeke||{}).OptionSelection=Backbone.Model.extend({defaults:{optionID:-1,attributeID:-1,optionGuid:"",optionCode:"",name:"",selected:!1,enabled:!0},idAttribute:"optionID",initialize:function(){}}),Zakeke.OptionSelectionCollection=Backbone.Collection.extend({model:Zakeke.OptionSelection}),Zakeke.AttributeSelection=Backbone.Model.extend({idAttribute:"attributeID",initialize:function(){myDefaults={attributeID:-1,attributeGuid:"",attributeCode:"",attributeTypeID:MPlaza.AttributeType.Options,groupID:-1,name:"",enabled:!0,selectedValue:null,optionPreviewShapeID:MPlaza.AttributeOptionPreviewShape.Rectangle,options:new Zakeke.OptionSelectionCollection},this.set(myDefaults)},getOptionSelection:function(t){return this.get("options").findWhere({optionID:t})},getOptionSelectionByGuid:function(t){return this.get("options").findWhere({optionGuid:t})},getOptionSelectionsByName:function(t){for(var e=[],i=0;i<this.get("options").length;i++)this.get("options").at(i).get("name")==t&&e.push(this.get("options").at(i));return e},getOptionIDsByName:function(t){for(var e=[],i=0;i<this.get("options").length;i++)this.get("options").at(i).get("name")==t&&e.push(this.get("options").at(i).get("optionID"));return e},getSelectedOption:function(){return this.get("options").findWhere({selected:!0})},getUnselectedOptions:function(){return this.get("options").where({selected:!1})},getUnselectedEnabledOptions:function(){return this.get("options").where({selected:!1,enabled:!0})},getEnabledOptions:function(){return this.get("options").where({enabled:!0})}}),Zakeke.AttributeSelectionCollection=Backbone.Collection.extend({model:Zakeke.AttributeSelection}),Zakeke.TemplateCompositionSelection=Backbone.Model.extend({idAttribute:"compositionID",defaults:{compositionID:-1,name:"",previewImageUrl:""},initialize:function(){}}),Zakeke.TemplateCompositionSelectionCollection=Backbone.Collection.extend({model:Zakeke.TemplateCompositionSelection}),Zakeke.CategorySelection=Backbone.Model.extend({idAttribute:"categoryID",initialize:function(){myDefaults={categoryID:-1,name:"",composition:new Zakeke.TemplateCompositionSelectionCollection},this.set(myDefaults)}}),Zakeke.CategorySelectionCollection=Backbone.Collection.extend({model:Zakeke.CategorySelection}),Zakeke.MacroCategorySelection=Backbone.Model.extend({idAttribute:"macroCategoryID",initialize:function(){myDefaults={macroCategoryID:-1,name:"",category:new Zakeke.CategorySelectionCollection},this.set(myDefaults)}}),Zakeke.MacroCategorySelectionCollection=Backbone.Collection.extend({model:Zakeke.MacroCategorySelection}),Zakeke.TemplateGroupSelection=Backbone.Model.extend({idAttribute:"templateGroupID",initialize:function(){myDefaults={templateGroupID:-1,name:"",groupID:-1,stepID:-1,displayOrder:0,macrocategory:new Zakeke.MacroCategorySelectionCollection},this.set(myDefaults)}}),Zakeke.TemplateGroupSelectionCollection=Backbone.Collection.extend({model:Zakeke.TemplateGroupSelection}),Zakeke.AttributeGroupSelection=Backbone.Model.extend({idAttribute:"groupID",initialize:function(){myDefaults={groupID:-1,groupGuid:"",name:"",attributes:new Zakeke.AttributeSelectionCollection,templateGroups:new Zakeke.TemplateGroupSelectionCollection},this.set(myDefaults)},containsAttributeSelection:function(t){return!!this.get("attributes").findWhere({attributeID:t})},countEnabledAttributeSelections:function(){return this.get("attributes").where({enabled:!0}).length}}),Zakeke.AttributeGroupSelectionCollection=Backbone.Collection.extend({model:Zakeke.AttributeGroupSelection}),Zakeke.ComposerSelection=Backbone.Model.extend({initialize:function(){myDefaults={zkModel:null,groups:new Zakeke.AttributeGroupSelectionCollection,attributeDependencies:{},optionDependencies:{},suggestions:{},currentModelColorID:null},this.set(myDefaults)},buildDependencies:function(){var t=this.get("zkModel");if(t&&t instanceof MPlaza.Model)for(var e=0;e<t.get("attributes").length;e++){var i=t.get("attributes").at(e);if(l=i.get("constraintExpression"))for(var n=i.get("attributeGuid"),r=l.getAllAttributeGuids(),s=0;s<r.length;s++){var o=r[s];if(this.get("attributeDependencies").hasOwnProperty(o)){var a=this.get("attributeDependencies")[o];Zakeke.arrayContains(a,n)||a.push(n)}else this.get("attributeDependencies")[o]=[n]}for(var h=0;h<i.get("options").length;h++){var l,c=i.get("options").at(h);if(l=c.get("constraintExpression")){n=c.get("optionGuid"),r=l.getAllAttributeGuids();for(var u=0;u<r.length;u++)o=r[u],this.get("optionDependencies").hasOwnProperty(o)?(a=this.get("optionDependencies")[o],Zakeke.arrayContains(a,n)||a.push(n)):this.get("optionDependencies")[o]=[n]}}}},checkAllConstraintExpressions:function(){var t=this.get("zkModel");if(t&&t instanceof MPlaza.Model){for(var e=this.getDependenceAwareAttributeSelections(),i=[],n=0;n<e.length;n++){var r=e[n],s=t.getAttribute(r.get("attributeID"));this.checkConstraintExpression(r);for(var o=0;o<r.get("options").length;o++){var a=r.get("options").at(o);s.getOption(a.get("optionID")).get("constraintExpression")&&i.push(a)}}for(n=0;n<i.length;n++)a=i[n],this.checkOptionConstraintExpression(a)}},checkConstraintExpression:function(t){var e=this.get("zkModel");if(e&&e instanceof MPlaza.Model){var i=e.getAttribute(t.get("attributeID")).get("constraintExpression");if(i){var n=this.evaluateAttributeExpression(i);t.set("enabled",n)}}},checkDependentConstraintExpressions:function(t){var e=this.getAttributeSelection(t);if(e){var i=e.get("attributeGuid"),n=this.get("attributeDependencies");if(n.hasOwnProperty(i))for(var r=n[i],s=0;s<r.length;s++){var o=r[s],a=this.getAttributeSelectionByGuid(o);this.checkConstraintExpression(a)}var h=[],l=this.get("optionDependencies");if(l.hasOwnProperty(i))for(r=l[i],s=0;s<r.length;s++){o=r[s];var c=this.getOptionSelectionByGuid(o);this.checkOptionConstraintExpression(c);var u=c.get("attributeID");Zakeke.arrayContains(h,u)||h.push(u)}for(s=0;s<h.length;s++){var f=h[s];this.getAttributeSelection(f).getSelectedOption().get("enabled")||this.selectFirstEnabledOption(f)}}},checkOptionConstraintExpression:function(t){var e=this.get("zkModel");if(e&&e instanceof MPlaza.Model){var i=e.getOption(t.get("optionID")).get("constraintExpression");if(i){var n=this.evaluateAttributeExpression(i);t.set("enabled",n)}}},selectFirstEnabledOption:function(t){var e=this.getAttributeSelection(t);if(e){var i=e.getEnabledOptions(),n=null;i&&i.length>0&&(n=i[0]);var r=e.getSelectedOption();!n||null!=r&&r.get("optionID")==n.get("optionID")||(null!=r&&r.set("selected",!1),n.set("selected",!0))}},evaluateAttributeExpression:function(t){if(!(t&&t instanceof MPlaza.AttributeExpression))return!1;for(var e=t.get("op"),i=e==MPlaza.LogicalOperator.AND,n=0;n<t.get("propositions").length;n++){var r=t.get("propositions")[n],s=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&s))return!1}else if(i=i||s)return!0}for(n=0;n<t.get("expressions").length;n++){var o=t.get("expressions")[n];if(s=this.evaluateChildAttributeExpression(o),e==MPlaza.LogicalOperator.AND){if(!(i=i&&s))return!1}else if(i=i||s)return!0}return i},evaluateChildAttributeExpression:function(t){for(var e=t.op,i=e==MPlaza.LogicalOperator.AND,n=0;n<t.propositions.length;n++){var r=t.propositions[n],s=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&s))return!1}else if(i=i||s)return!0}for(n=0;n<t.expressions.length;n++){var o=t.expressions[n];if(s=this.evaluateChildAttributeExpression(o),e==MPlaza.LogicalOperator.AND){if(!(i=i&&s))return!1}else if(i=i||s)return!0}return i},evaluateAttributeProposition:function(t){if(t&&t.hasOwnProperty("attributeGuid")&&t.hasOwnProperty("op")&&t.hasOwnProperty("value")){var e=t.attributeGuid,i=this.getAttributeSelectionByGuid(e);if(i&&i.get("enabled")){var n=i.get("selectedValue");if(i.get("attributeTypeID")==MPlaza.AttributeType.Options){var r=i.getSelectedOption();r&&(n=r.get("optionGuid"))}var s=!1;if(t.op==MPlaza.ComparisonOperator.Equal)s=n==t.value;else if(t.op==MPlaza.ComparisonOperator.NotEqual)s=n!=t.value;else if(t.op==MPlaza.ComparisonOperator.In||t.op==MPlaza.ComparisonOperator.NotIn){var o=t.value.split(";");s=t.op==MPlaza.ComparisonOperator.In?Zakeke.arrayContains(o,n):!Zakeke.arrayContains(o,n)}return s}}return!1},getAttributeGroupSelection:function(t){var e=this.get("zkModel");if(e){var i=e.get("attributes").findWhere({attributeID:t});if(i){var n=i.get("groupID");return this.get("groups").findWhere({groupID:n})}}return null},getAttributeSelection:function(t){var e=this.get("zkModel");if(e){var i=e.get("attributes").findWhere({attributeID:t});if(i){var n=i.get("groupID"),r=this.get("groups").findWhere({groupID:n});if(r)return r.get("attributes").findWhere({attributeID:t})}}return null},getAttributeSelectionByGuid:function(t){var e=this.get("zkModel");if(e){var i=e.get("attributes").findWhere({attributeGuid:t});if(i){var n=i.get("groupID"),r=this.get("groups").findWhere({groupID:n});if(r)return r.get("attributes").findWhere({attributeGuid:t})}}return null},getAttributeSelectionByOptionID:function(t){var e=this.getOptionSelection(t);if(e){var i=e.get("attributeID");return this.getAttributeSelection(i)}return null},getAllAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);t.push(r)}return t},getDependenceAwareAttributeSelections:function(){for(var t={},e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i].get("attributeGuid");t.hasOwnProperty(n)||(t[n]=0);for(var r=this.getFullDependencyChain(n),s=0;s<r.length;s++){var o=r[s];t.hasOwnProperty(o)?t[o]+=1:t[o]=1}}return e.sort(function(e,i){var n=t[e.get("attributeGuid")],r=t[i.get("attributeGuid")];return n<r?-1:n>r?1:0}),e},getFullDependencyChain:function(t){var e=this.get("attributeDependencies"),i=function(n,r){if(n===t||Zakeke.arrayContains(r,n)||r.push(n),e.hasOwnProperty(n))for(var s=e[n],o=0;o<s.length;o++)i(s[o],r)},n=[];if(e.hasOwnProperty(t)){n=e[t].slice(0);for(var r=0;r<n.length;r++)i(n[r],n)}return n},getAllAttributeIDs:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);t.push(r.get("attributeID"))}return t},getEnabledAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);r.get("enabled")&&t.push(r)}return t},getEnabledAttributeIDs:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);r.get("enabled")&&t.push(r.get("attributeID"))}return t},getDisabledAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);r.get("enabled")||t.push(r)}return t},getAttributeOptionSelection:function(t,e){var i=this.getAttributeSelection(t);return i?i.getOptionSelection(e):null},getOptionSelection:function(t){for(var e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++)for(var r=i.get("attributes").at(n),s=0;s<r.get("options").length;s++){var o=r.get("options").at(s);if(o.get("optionID")==t)return o}return null},getOptionSelectionByGuid:function(t){for(var e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++)for(var r=i.get("attributes").at(n),s=0;s<r.get("options").length;s++){var o=r.get("options").at(s);if(o.get("optionGuid")==t)return o}return null},getAllAttributeTransformationScript:function(){for(var t=[],e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i];if(n.get("enabled")){var r=this.getAttributeTransformationScript(n.get("attributeID"));r&&t.push(r)}}return t},getAttributeTransformationScript:function(t){var e=null,i=this.getAttributeSelection(t);if(i&&i.get("enabled"))if(e={attributeID:t,selectedValue:"",actions:this.getAttributeSceneActions(t)},i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=i.getSelectedOption();n&&n.get("enabled")?e.selectedValue=n.get("optionID").toString():e=null}else e.selectedValue=i.get("selectedValue");return e},getAttributeSceneActions:function(t){var e=[],i=this.get("zkModel");if(i&&i instanceof MPlaza.Model){var n=i.getAttribute(t),r=this.getAttributeSelection(t),s=n.get("preActions").sortBy(function(t){return t.get("execOrder")});if(Array.prototype.push.apply(e,s),r&&n)if(r.get("attributeTypeID")==MPlaza.AttributeType.Options){var o=r.getSelectedOption();if(o){var a=n.get("options").findWhere({optionID:o.get("optionID")});if(a){var h=a.get("actions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,h)}}}else{var l=n.get("valueActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,l)}var c=n.get("postActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,c)}return e},getAttributeUnselectedOptionsSceneActions:function(t){var e=[],i=this.get("zkModel");if(i&&i instanceof MPlaza.Model){var n=i.getAttribute(t),r=this.getAttributeSelection(t),s=n.get("preActions").sortBy(function(t){return t.get("execOrder")});if(Array.prototype.push.apply(e,s),r&&n&&r.get("attributeTypeID")==MPlaza.AttributeType.Options)for(var o=r.getUnselectedEnabledOptions(),a=0;a<o.length;a++){var h=o[a],l=n.get("options").findWhere({optionID:h.get("optionID")});if(l){var c=l.get("actions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,c)}}var u=n.get("postActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,u)}return e},getAllAttributesUnselectedOptionsSceneActions:function(){for(var t=[],e=this.getEnabledAttributeSelections(),i=0;i<e.length;i++){var n=e[i],r=this.getAttributeUnselectedOptionsSceneActions(n.get("attributeID"));Array.prototype.push.apply(t,r)}return t},detachEvents:function(){for(var t=this.getAllAttributeSelections(),e=0;e<t.length;e++){var i=t[e];i.get("attributeID"),i.off("change:selectedValue"),i.off("change:enabled");for(var n=0;n<i.get("options").length;n++){var r=i.get("options").at(n);r.get("optionID"),r.off("change:selected"),r.off("change:enabled")}}},attachEvents:function(){for(var t=this,e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i];n.get("attributeID"),n.on("change:selectedValue",function(){t.onAttributeSelectedValueChanged(this.get("attributeID"))}),n.on("change:enabled",function(){t.onAttributeEnablingChanged(this.get("attributeID"))});for(var r=0;r<n.get("options").length;r++){var s=n.get("options").at(r);s.get("optionID"),s.on("change:selected",function(){t.onAttributeSelectedOptionChanged(this.get("attributeID"),this.get("optionID"))}),s.on("change:enabled",function(){t.onAttributeOptionEnablingChanged(this.get("attributeID"),this.get("optionID"))})}}},onAttributeSelectedValueChanged:function(t){var e=this.getAttributeSelection(t),i=this.getAttributeSceneActions(t),n={attributeID:t,selectedValue:e.get("selectedValue"),actions:i};this.trigger("attributeSelectionChanged",n),this.checkCurrentModelColor(),this.checkDependentConstraintExpressions(t)},onAttributeSelectedOptionChanged:function(t,e){this.getAttributeSelection(t);var i=this.getAttributeOptionSelection(t,e);if(i&&i.get("selected")){var n=this.getAttributeSceneActions(t),r={attributeID:t,selectedValue:e.toString(),actions:n};this.trigger("attributeSelectionChanged",r),this.checkCurrentModelColor(),this.checkDependentConstraintExpressions(t)}},onAttributeEnablingChanged:function(t){var e={attributeID:t},i=this.getAttributeSelection(t);if(i.get("enabled")?this.trigger("attributeEnabled",e):this.trigger("attributeDisabled",e),i.get("enabled")&&(i.get("selectedValue"),i.get("attributeTypeID")==MPlaza.AttributeType.Options)){var n=!1,r=this.getSuggestions(t);if(r){this.removeSuggestions(t);for(var s=0;s<r.length;s++){var o=r[s],a=i.getOptionSelection(o);if(a&&a.get("enabled")){n=!0,this.selectAttributeValue(t,o);break}}}if(!n){var h=i.getSelectedOption();h?this.onAttributeSelectedOptionChanged(t,h.get("optionID")):this.onAttributeSelectedValueChanged(t)}}this.checkDependentConstraintExpressions(t)},onAttributeOptionEnablingChanged:function(t,e){var i=this.getAttributeOptionSelection(t,e),n={attributeID:t,optionID:e},r=!1,s=!1;i&&(r=i.get("enabled"),s=i.get("selected")),r?this.trigger("attributeOptionEnabled",n):this.trigger("attributeOptionDisabled",n),s&&r&&this.onAttributeSelectedOptionChanged(t,e),this.checkDependentConstraintExpressions(t)},selectAttributeOptionByGuid:function(t,e){var i=this.getAttributeSelectionByGuid(t);if(i&&i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=i.getOptionSelectionByGuid(e);n&&this._selectAttributeOption(i,n)}},selectAttributeValue:function(t,e){var i=this.getAttributeSelection(t);if(i)if(i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=-1;if(e&&!isNaN(e)){n=parseInt(e);var r=i.getOptionSelection(n);r&&this._selectAttributeOption(i,r)}}else i.set("selectedValue",e)},_selectAttributeOption:function(t,e){if(t&&e){-1!==t.get("attributeID")&&this.saveSuggestionsForSelectedOption(t.get("attributeID"),e.get("optionID"));var i=t.getSelectedOption();i&&i.set("selected",!1),e.set("selected",!0)}},checkCurrentModelColor:function(){var t=this.getModelColorIDForSelection(),e=null!=t&&null!=t,i=null!=this.currentModelColorID&&null!=this.currentModelColorID;if(e&&i&&t!=this.currentModelColorID||!e&&i||e&&!i){var n={colorID:t};this.trigger("modelColorChanged",n)}},saveSuggestionsForSelectedOption:function(t,e){this.get("suggestions")[t]=[e]},getSuggestions:function(t){return this.get("suggestions").hasOwnProperty(t)?this.get("suggestions")[t]:null},removeSuggestions:function(t){this.get("suggestions").hasOwnProperty(t)&&delete this.get("suggestions")[t]},setupOnComposition:function(t){var e=this.get("zkModel");if(e&&t&&e.get("modelID")==t.get("modelID")){this.detachEvents();for(var i=0;i<t.get("compositionItems").length;i++){var n=t.get("compositionItems").at(i),r=n.get("attributeID"),s=n.get("selectedValue");n.get("attributeTypeID")==MPlaza.AttributeType.Options&&null!=n.get("selectedOptionID")&&null!=n.get("selectedOptionID")&&(s=n.get("selectedOptionID")),this.selectAttributeValue(r,s)}this.buildDependencies(),this.checkAllConstraintExpressions(),this.attachEvents()}},buildComposition:function(){var t=new MPlaza.Composition;return this.updateComposition(t),t},updateComposition:function(t){var e=this.get("zkModel");t.set("modelID",e.get("modelID")),t.set("modelName",e.get("name")),t.set("modelPrice",e.get("price")),this.updateCompositionItems(t)},updateCompositionItems:function(t){for(var e=[],i=0;i<t.get("compositionItems").length;i++){var n=t.get("compositionItems").at(i);(s=this.getAttributeSelection(n.get("attributeID")))&&s.get("enabled")?this.updateCompositionItem(n,s):e.push(n)}var r=this.getEnabledAttributeSelections();for(i=0;i<r.length;i++){var s=r[i];(n=t.getCompositionItemByAttributeID(s.get("attributeID")))||(n=new MPlaza.CompositionItem,this.updateCompositionItem(n,s),t.get("compositionItems").push(n))}e.length>0&&t.get("compositionItems").remove(e)},updateCompositionItem:function(t,e){if(t.set("attributeID",e.get("attributeID")),t.set("attributeGuid",e.get("attributeGuid")),t.set("attributeTypeID",e.get("attributeTypeID")),t.set("attributeName",e.get("name")),t.set("attributeCode",e.get("attributeCode")),e.get("attributeTypeID")==MPlaza.AttributeType.Options){var i=e.getSelectedOption();i&&(t.set("selectedOptionID",i.get("optionID")),t.set("selectedOptionGuid",i.get("optionGuid")),t.set("selectedOptionCode",i.get("optionCode")),t.set("selectedOptionName",i.get("name")),t.set("selectedValue",null))}else{var n=e.get("selectedValue");t.set("selectedOptionID",null),t.set("selectedOptionGuid",null),t.set("selectedOptionCode",null),t.set("selectedValue",n)}},getModelColorIDForSelection:function(){if(this.get("zkModel")){var t=this.get("zkModel").get("attributeSelectionColors");if(t)for(var e=0;e<t.length;e++){var i=t[e],n=i.get("selectionExpression"),r=i.get("colorID");if(n&&this.evaluateAttributeExpression(n))return r}}return null},getCompositionBaseJSON:function(){for(var t={items:[]},e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i],r={code:n.get("attributeID"),value:""};if(n.get("enabled"))if(n.get("attributeTypeID")===MPlaza.AttributeType.Options){var s=n.getSelectedOption();s&&(r.value=s.get("optionID").toString())}else r.value=n.get("selectedValue");else r.value="disabled";t.items.push(r)}return JSON.stringify(t)},getCompositionHashCode:function(){var t=this.getCompositionBaseJSON();return CryptoJS.SHA1(t).toString()},refresh:function(){this.detachEvents(),this._resetProperties();var t=this.get("zkModel"),e=this;if(t&&t instanceof MPlaza.Model){var i=function(t,e){var i=new Zakeke.AttributeSelection;i.set("attributeID",t.get("attributeID")),i.set("attributeGuid",t.get("attributeGuid")),i.set("attributeCode",t.get("attributeCode")),i.set("attributeTypeID",t.get("attributeTypeID")),i.set("groupID",e.get("groupID")),i.set("name",t.get("name")),i.set("optionPreviewShapeID",t.get("optionPreviewShapeID")),e.get("attributes").add(i);var n=t.get("defaultValue");if(t.get("attributeTypeID")==MPlaza.AttributeType.Options){for(var r=t.get("options").sortBy(function(t){return t.get("displayOrder")}),s=null,o=0;o<r.length;o++){var a=r[o],h=a.get("isDefault")&&null==s,l=new Zakeke.OptionSelection;l.set("optionID",a.get("optionID")),l.set("optionGuid",a.get("optionGuid")),l.set("optionCode",a.get("optionCode")),l.set("attributeID",t.get("attributeID")),l.set("name",a.get("name")),l.set("selected",h),l.set("enabled",!0),h&&(s=l),i.get("options").add(l)}null==s&&i.get("options").length>0&&i.get("options").at(0).set("selected",!0)}else t.get("attributeTypeID")==MPlaza.AttributeType.Color?n?i.set("selectedValue",n):i.selectedValue="#ffffff":t.get("attributeTypeID")==MPlaza.AttributeType.Number?n&&!isNaN(n)?i.set("selectedValue",n):i.selectedValue=0:t.get("attributeTypeID")==MPlaza.AttributeType.Number&&(n?i.set("selectedValue",n):i.selectedValue="")};t.get("attributeGroups").sortBy(function(t){return t.get("displayOrder")}).forEach(function(n){var r=n.get("groupID"),s=new Zakeke.AttributeGroupSelection;s.set("groupID",n.get("groupID")),s.set("groupGuid",n.get("groupGuid")),s.set("name",n.get("name")),e.get("groups").add(s);for(var o=t.get("attributes").where({groupID:r}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")}),a=0;a<o.length;a++){var h=o[a];i(h,s)}});var n=t.getAttributesWithoutGroup();if(n.length>0){var r=new Zakeke.AttributeGroupSelection;r.set("groupID",-1),r.set("groupGuid",""),r.set("name","default"),e.get("groups").add(r);for(var s=0;s<n.length;s++){var o=n[s];i(o,r)}}}this.buildDependencies(),this.checkAllConstraintExpressions(),this.attachEvents()},_resetProperties:function(){this.set("groups",new Zakeke.AttributeGroupSelectionCollection),this.set("attributeDependencies",{}),this.set("optionDependencies",{}),this.set("suggestions",{}),this.set("currentModelColorID",null)}},{CreateComposerSelection:function(t){var e=new Zakeke.ComposerSelection;if(e.set("zkModel",t),t&&t instanceof MPlaza.Model){var i=function(t,e){var i=new Zakeke.AttributeSelection;i.set("attributeID",t.get("attributeID")),i.set("attributeGuid",t.get("attributeGuid")),i.set("attributeCode",t.get("attributeCode")),i.set("attributeTypeID",t.get("attributeTypeID")),i.set("groupID",e.get("groupID")),i.set("name",t.get("name")),i.set("optionPreviewShapeID",t.get("optionPreviewShapeID")),e.get("attributes").add(i);var n=t.get("defaultValue");if(t.get("attributeTypeID")==MPlaza.AttributeType.Options){for(var r=t.get("options").sortBy(function(t){return t.get("displayOrder")}),s=null,o=0;o<r.length;o++){var a=r[o],h=a.get("isDefault")&&null==s,l=new Zakeke.OptionSelection;l.set("optionID",a.get("optionID")),l.set("optionGuid",a.get("optionGuid")),l.set("optionCode",a.get("optionCode")),l.set("attributeID",t.get("attributeID")),l.set("name",a.get("name")),l.set("selected",h),l.set("enabled",!0),h&&(s=l),i.get("options").add(l)}null==s&&i.get("options").length>0&&i.get("options").at(0).set("selected",!0)}else t.get("attributeTypeID")==MPlaza.AttributeType.Color?n?i.set("selectedValue",n):i.selectedValue="#ffffff":t.get("attributeTypeID")==MPlaza.AttributeType.Number?n&&!isNaN(n)?i.set("selectedValue",n):i.selectedValue=0:t.get("attributeTypeID")==MPlaza.AttributeType.Number&&(n?i.set("selectedValue",n):i.selectedValue="")},n=function(t,e){var i=new Zakeke.TemplateGroupSelection;i.set("templateGroupID",t.get("templateGroupID")),i.set("name",t.get("name")),i.set("groupID",t.get("groupID")),i.set("stepID",t.get("stepID")),i.set("displayOrder",t.get("displayOrder")),e.get("templateGroups").add(i);for(var n=t.get("macrocategory"),r=0;r<n.length;r++){var s=n.at(r),o=new Zakeke.MacroCategorySelection;o.set("macroCategoryID",s.get("macroCategoryID")),o.set("name",s.get("name"));for(var a=s.get("category"),h=0;h<a.length;h++){var l=a.at(h),c=new Zakeke.CategorySelection;c.set("categoryID",l.get("categoryID")),c.set("name",l.get("name"));for(var u=l.get("composition"),f=0;f<u.length;f++){var d=u.at(f),p=new Zakeke.TemplateCompositionSelection;p.set("compositionID",d.get("compositionID")),p.set("name",d.get("name")),p.set("previewImageUrl",d.get("previewImageUrl")),c.get("composition").add(p)}o.get("category").add(c)}i.get("macrocategory").add(o)}};t.get("attributeGroups").sortBy(function(t){return t.get("displayOrder")}).forEach(function(r){var s=r.get("groupID"),o=new Zakeke.AttributeGroupSelection;o.set("groupID",r.get("groupID")),o.set("groupGuid",r.get("groupGuid")),o.set("name",r.get("name")),e.get("groups").add(o);for(var a=t.get("attributes").where({groupID:s}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")}),h=0;h<a.length;h++){var l=a[h];i(l,o)}var c=t.get("templateGroups").where({groupID:s}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")});for(h=0;h<c.length;h++){var u=c[h];n(u,o)}});var r=t.getAttributesWithoutGroup(),s=t.getTemplateGroupsWithoutGroup(),o=new Zakeke.AttributeGroupSelection;if(o.set("groupID",-1),o.set("groupGuid",""),o.set("name","default"),e.get("groups").add(o),r.length>0)for(var a=0;a<r.length;a++){var h=r[a];i(h,o)}if(s.length>0)for(a=0;a<s.length;a++){var l=s[a];n(l,o)}}return e.buildDependencies(),e.checkAllConstraintExpressions(),e.attachEvents(),e}}),function(){var t,e,i,n,r,s,o,a,h,l,c,u,f,d,p,g,v,m,_,y,x,b,w,S,C,T,k,E,A,M,D={}.hasOwnProperty,O=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},L=[].slice;S=Array.prototype.slice,t=function(t,e){return null==e&&(e=document),"object"==typeof t||"undefined"!=typeof exports&&null!==exports?t:e.querySelector(t)},b=function(){function t(){}var e;return t.uniqid=(e=0,{get:function(){return e++}}),t.extend=function(t){var e,i,n,r,s,o;for(i=t,s=0,o=(r=S.call(arguments,1)).length;s<o;s++)for(n in e=r[s])D.call(e,n)&&(i[n]=e[n]);return i},t.clampRGB=function(t){return t<0?0:t>255?255:t},t.copyAttributes=function(t,e,i){var n,r,s,o,a,h;for(null==i&&(i={}),h=[],r=0,s=(o=t.attributes).length;r<s;r++)n=o[r],null!=i.except&&(a=n.nodeName,O.call(i.except,a)>=0)||h.push(e.setAttribute(n.nodeName,n.nodeValue));return h},t.dataArray=function(t){return null==t&&(t=0),r.NodeJS||null!=window.Uint8Array?new Uint8Array(t):new Array(t)},t}(),"undefined"!=typeof exports&&null!==exports?(y=exports,o=require("canvas"),f=o.Image,l=require("fibers"),w=require("fs")):y=window,y.Caman=r=function(){function i(){var t,n,r,s=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof i?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),t=arguments[0],i.NodeJS||(r=parseInt(i.getAttrId(t[0]),10),n="function"==typeof t[1]?t[1]:"function"==typeof t[2]?t[2]:function(){},isNaN(r)||!x.has(r))?(this.id=b.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new e(this),this.renderer=new _(this),this.domIsLoaded(function(){return s.parseArguments(t),s.setup()}),this):x.execute(r,n)):new i(arguments)}return i.version={release:"4.1.1",date:"4/8/2013"},i.DEBUG=!1,i.NodeJS="undefined"!=typeof exports&&null!==exports,i.autoload=!i.NodeJS,i.allowRevert=!0,i.crossOrigin="anonymous",i.toString=function(){return"Version "+i.version.release+", Released "+i.version.date},i.remoteProxy="",i.proxyParam="camanProxyUrl",i.getAttrId=function(e){return!!i.NodeJS||("string"==typeof e&&(e=t(e)),null==e||null==e.getAttribute?null:e.getAttribute("data-caman-id"))},i.prototype.domIsLoaded=function(t){var e,n=this;return i.NodeJS?setTimeout(function(){return t.call(n)},0):"complete"===document.readyState?(p.debug("DOM initialized"),setTimeout(function(){return t.call(n)},0)):(e=function(){if("complete"===document.readyState)return p.debug("DOM initialized"),t.call(n)},document.addEventListener("readystatechange",e,!1))},i.prototype.parseArguments=function(t){var e,i,n,r;if(0===t.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(t[0]),1!==t.length){switch(typeof t[1]){case"string":this.imageUrl=t[1];break;case"function":this.callback=t[1]}if(2!==t.length&&(this.callback=t[2],4===t.length)){for(e in r=[],n=t[4])D.call(n,e)&&(i=n[e],r.push(this.options[e]=i));return r}}},i.prototype.setInitObject=function(e){if(i.NodeJS)return this.initObj=e,void(this.initType="node");if(this.initObj="object"==typeof e?e:t(e),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},i.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},i.prototype.initNode=function(){var t=this;return p.debug("Initializing for NodeJS"),this.image=new f,this.image.onload=function(){return p.debug("Image loaded. Width = "+t.imageWidth()+", Height = "+t.imageHeight()),t.canvas=new o(t.imageWidth(),t.imageHeight()),t.finishInit()},this.image.onerror=function(t){throw t},this.image.src=this.initObj},i.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),b.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},i.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},i.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(p.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),u.isRemote(this.image))return this.image.src=u.proxyUrl(this.image.src),p.debug("Remote image detected, using URL = "+this.image.src)},i.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},i.prototype.isImageLoaded=function(){return!!this.image.complete&&(null==this.image.naturalWidth||0!==this.image.naturalWidth)},i.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},i.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},i.prototype.imageLoaded=function(){return p.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},i.prototype.finishInit=function(){var t,e,n,r,s;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.reloadCanvasData(),i.allowRevert)for(this.initializedPixelData=b.dataArray(this.pixelData.length),this.originalPixelData=b.dataArray(this.pixelData.length),t=n=0,r=(s=this.pixelData).length;n<r;t=++n)e=s[t],this.initializedPixelData[t]=e,this.originalPixelData[t]=e;return this.dimensions={width:this.canvas.width,height:this.canvas.height},x.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},i.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},i.prototype.resetOriginalPixelData=function(){var t,e,n,r,s;if(!i.allowRevert)throw"Revert disabled";for(this.originalPixelData=b.dataArray(this.pixelData.length),s=[],e=0,n=(r=this.pixelData).length;e<n;e++)t=r[e],s.push(this.originalPixelData.push(t));return s},i.prototype.hasId=function(){return null!=i.getAttrId(this.canvas)},i.prototype.assignId=function(){if(!i.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},i.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},i.prototype.hiDPIAdjustments=function(){var t;if(!i.NodeJS&&!this.hiDPIDisabled())return 1!==(t=this.hiDPIRatio())?(p.debug("HiDPI ratio = "+t),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*t,this.canvas.height=this.preScaledHeight*t,this.canvas.style.width=this.preScaledWidth+"px",this.canvas.style.height=this.preScaledHeight+"px",this.context.scale(t,t),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},i.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)},i.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},i.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},i.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},i.prototype.replaceCanvas=function(t){var e;return e=this.canvas,this.canvas=t,this.context=this.canvas.getContext("2d"),e.parentNode.replaceChild(this.canvas,e),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},i.prototype.render=function(t){var e=this;return null==t&&(t=function(){}),h.trigger(this,"renderStart"),this.renderer.execute(function(){return e.context.putImageData(e.imageData,0,0),t.call(e)})},i.prototype.revert=function(){var t,e,n,r,s;if(!i.allowRevert)throw"Revert disabled";for(t=n=0,r=(s=this.originalVisiblePixels()).length;n<r;t=++n)e=s[t],this.pixelData[t]=e;return this.context.putImageData(this.imageData,0,0)},i.prototype.reset=function(){var t,e,i,n,r,s,o,a,h;for(t=document.createElement("canvas"),b.copyAttributes(this.canvas,t),t.width=this.originalWidth,t.height=this.originalHeight,s=(n=(e=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,i=o=0,a=(h=this.initializedPixelData).length;o<a;i=++o)r=h[i],s[i]=r;return e.putImageData(n,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(t)},i.prototype.originalVisiblePixels=function(){var t,e,n,r,s,o,a,h,l,c,u,f,d,p,g,m,_,y,x,b,w;if(!i.allowRevert)throw"Revert disabled";if(c=[],r=(f=this.cropCoordinates.x)+this.width,s=(d=this.cropCoordinates.y)+this.height,this.resized){for((t=document.createElement("canvas")).width=this.originalWidth,t.height=this.originalHeight,l=(a=(n=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,o=g=0,_=(y=this.originalPixelData).length;g<_;o=++g)h=y[o],l[o]=h;n.putImageData(a,0,0),(u=document.createElement("canvas")).width=this.width,u.height=this.height,(n=u.getContext("2d")).drawImage(t,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),l=n.getImageData(0,0,this.width,this.height).data,p=this.width}else l=this.originalPixelData,p=this.originalWidth;for(o=m=0,x=l.length;m<x;o=m+=4)f<=(b=(e=v.locationToCoordinates(o,p)).x)&&b<r&&d<=(w=e.y)&&w<s&&c.push(l[o],l[o+1],l[o+2],l[o+3]);return c},i.prototype.process=function(t,e){return this.renderer.add({type:c.Type.Single,name:t,processFn:e}),this},i.prototype.processKernel=function(t,e,i,n){var r,s,o;if(!i)for(i=0,r=s=0,o=e.length;0<=o?s<o:s>o;r=0<=o?++s:--s)i+=e[r];return this.renderer.add({type:c.Type.Kernel,name:t,adjust:e,divisor:i,bias:n||0}),this},i.prototype.processPlugin=function(t,e){return this.renderer.add({type:c.Type.Plugin,plugin:t,args:e}),this},i.prototype.newLayer=function(t){var e;return e=new d(this),this.canvasQueue.push(e),this.renderer.add({type:c.Type.LayerDequeue}),t.call(e),this.renderer.add({type:c.Type.LayerFinished}),this},i.prototype.executeLayer=function(t){return this.pushContext(t)},i.prototype.pushContext=function(t){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData},i.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},i.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},i}(),e=function(){function t(t){this.c=t}return t.prototype.calculateLevels=function(){var t,e,i,n,r,s,o;for(e={r:{},g:{},b:{}},t=n=0;n<=255;t=++n)e.r[t]=0,e.g[t]=0,e.b[t]=0;for(t=r=0,o=this.c.pixelData.length;r<o;t=r+=4)e.r[this.c.pixelData[t]]++,e.g[this.c.pixelData[t+1]]++,e.b[this.c.pixelData[t+2]]++;for(i=this.c.pixelData.length/4,t=s=0;s<=255;t=++s)e.r[t]/=i,e.g[t]/=i,e.b[t]/=i;return e},t}(),r.DOMUpdated=function(){var t,e,i,n,r;if((e=document.querySelectorAll("img[data-caman]")).length>0){for(r=[],i=0,n=e.length;i<n;i++)t=e[i],r.push(new s(t,function(){return this.parse(),this.execute()}));return r}},r.autoload&&("complete"===document.readyState?r.DOMUpdated():document.addEventListener("DOMContentLoaded",r.DOMUpdated,!1)),s=function(){function t(t,e){this.dataStr=t.getAttribute("data-caman"),this.caman=r(t,e.bind(this))}return t.prototype.parse=function(){var t,e,i,n,r,s,o,a,h,l;if(this.ele=this.caman.canvas,r=new RegExp("(\\w+)\\((.*?)\\)","g"),(s=this.dataStr.match(r)).length>0){for(r=new RegExp("(\\w+)\\((.*?)\\)"),l=[],o=0,a=s.length;o<a;o++){(h=s[o].match(r))[0],e=h[1],t=h[2],n=new Function("return function() {        this."+e+"("+t+");      };");try{i=n(),l.push(i.call(this.caman))}catch(t){l.push(p.debug(t))}}return l}},t.prototype.execute=function(){var t;return t=this.ele,this.caman.render(function(){return t.parentNode.replaceChild(this.toImage(),t)})},t}(),r.Blender=i=function(){function t(){}return t.blenders={},t.register=function(t,e){return this.blenders[t]=e},t.execute=function(t,e,i){return this.blenders[t](e,i)},t}(),r.Calculate=n=function(){function t(){}return t.distance=function(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))},t.randomRange=function(t,e,i){var n;return null==i&&(i=!1),n=t+Math.random()*(e-t),i?n.toFixed(i):Math.round(n)},t.luminance=function(t){return.299*t.r+.587*t.g+.114*t.b},t.bezier=function(t,e,i,n,r,s){var o,a,h,l,c,u,f,d,p,g,v,m,_,y,x,b,w,S,C,T,k,E,A,M,D,O,L;for(x=t[0],C=t[1],b=e[0],T=e[1],w=i[0],k=i[1],S=n[0],E=n[1],f={},o=S-x-(c=parseInt(3*(b-x),10))-(h=3*(w-b)-c),a=E-C-(u=3*(T-C))-(l=3*(k-T)-u),g=A=0;A<1e3;g=++A)y=g/1e3,d=Math.round(o*Math.pow(y,3)+h*Math.pow(y,2)+c*y+x),p=Math.round(a*Math.pow(y,3)+l*Math.pow(y,2)+u*y+C),r&&p<r?p=r:s&&p>s&&(p=s),f[d]=p;if(f.length<n[0]+1)for(g=M=0,O=n[0];0<=O?M<=O:M>=O;g=0<=O?++M:--M)if(null==f[g]){for(m=[g-1,f[g-1]],v=D=g,L=n[0];g<=L?D<=L:D>=L;v=g<=L?++D:--D)if(null!=f[v]){_=[v,f[v]];break}f[g]=m[1]+(_[1]-m[1])/(_[0]-m[0])*(g-m[0])}return null==f[n[0]]&&(f[n[0]]=f[n[0]-1]),f},t}(),a=function(){function t(){}return t.hexToRGB=function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}},t.rgbToHSL=function(t,e,i){var n,r,s,o,a,h;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),t/=255,e/=255,i/=255,o=Math.max(t,e,i),a=Math.min(t,e,i),s=(o+a)/2,o===a?r=h=0:(n=o-a,h=s>.5?n/(2-o-a):n/(o+a),r=function(){switch(o){case t:return(e-i)/n+(e<i?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:h,l:s}},t.hslToRGB=function(t,e,i){var n,r,s,o,a;return"object"==typeof t&&(e=t.s,i=t.l,t=t.h),0===e?a=r=n=i:(s=2*i-(o=i<.5?i*(1+e):i+e-i*e),a=this.hueToRGB(s,o,t+1/3),r=this.hueToRGB(s,o,t),n=this.hueToRGB(s,o,t-1/3)),{r:255*a,g:255*r,b:255*n}},t.hueToRGB=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},t.rgbToHSV=function(t,e,i){var n,r,s,o,a,h;return t/=255,e/=255,i/=255,s=Math.max(t,e,i),o=Math.min(t,e,i),h=s,n=s-o,a=0===s?0:n/s,s===o?r=0:(r=function(){switch(s){case t:return(e-i)/n+(e<i?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:a,v:h}},t.hsvToRGB=function(t,e,i){var n,r,s,o,a,h,l,c;switch(a=i*(1-e),h=i*(1-(r=6*t-(o=Math.floor(6*t)))*e),c=i*(1-(1-r)*e),o%6){case 0:l=i,s=c,n=a;break;case 1:l=h,s=i,n=a;break;case 2:l=a,s=i,n=c;break;case 3:l=a,s=h,n=i;break;case 4:l=c,s=a,n=i;break;case 5:l=i,s=a,n=h}return{r:255*l,g:255*s,b:255*n}},t.rgbToXYZ=function(t,e,i){return e/=255,i/=255,(t/=255)>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:100*(.4124*t+.3576*e+.1805*i),y:100*(.2126*t+.7152*e+.0722*i),z:100*(.0193*t+.1192*e+.9505*i)}},t.xyzToRGB=function(t,e,i){var n,r,s;return r=-.9689*(t/=100)+1.8758*(e/=100)+.0415*(i/=100),n=.0557*t+-.204*e+1.057*i,(s=3.2406*t+-1.5372*e+-.4986*i)>.0031308?s=1.055*Math.pow(s,.4166666667)-.055:s*=12.92,r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,n>.0031308?n=1.055*Math.pow(n,.4166666667)-.055:n*=12.92,{r:255*s,g:255*r,b:255*n}},t.xyzToLab=function(t,e,i){return"object"==typeof t&&(e=t.y,i=t.z,t=t.x),e/=100,i/=108.883,t=(t/=95.047)>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345,{l:116*(e=e>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345)-16,a:500*(t-e),b:200*(e-(i=i>.008856451679?Math.pow(i,.3333333333):7.787037037*i+.1379310345))}},t.labToXYZ=function(t,e,i){var n,r,s;return"object"==typeof t&&(e=t.a,i=t.b,t=t.l),s=(r=(t+16)/116)-i/200,(n=r+e/500)>.2068965517?n*=n*n:n=.1284185493*(n-.1379310345),r>.2068965517?r*=r*r:r=.1284185493*(r-.1379310345),s>.2068965517?s*=s*s:s=.1284185493*(s-.1379310345),{x:95.047*n,y:100*r,z:108.883*s}},t.rgbToLab=function(t,e,i){var n;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),n=this.rgbToXYZ(t,e,i),this.xyzToLab(n)},t.labToRGB=function(t,e,i){},t}(),h=function(){function t(){}return t.events={},t.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],t.trigger=function(t,e,i){var n,r,s,o,a;if(this.events[e]&&this.events[e].length){for(a=[],r=0,s=(o=this.events[e]).length;r<s;r++)null===(n=o[r]).target||t.id===n.target.id?a.push(n.fn.call(t,i)):a.push(void 0);return a}},t.listen=function(t,e,i){var n,r;return"string"==typeof t&&(r=t,n=e,t=null,e=r,i=n),!(O.call(this.types,e)<0||(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:i}),0))},t}(),r.Event=h,r.Filter=c=function(){function t(){}return t.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},t.register=function(t,e){return r.prototype[t]=e},t}(),r.IO=u=function(){function t(){}return t.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,t.isRemote=function(t){return null!=t&&!this.corsEnabled(t)&&this.isURLRemote(t.src)},t.corsEnabled=function(t){var e;return null!=t.crossOrigin&&("anonymous"===(e=t.crossOrigin.toLowerCase())||"use-credentials"===e)},t.isURLRemote=function(t){var e;return!!(e=t.match(this.domainRegex))&&e[1]!==document.domain},t.remoteCheck=function(t){if(this.isURLRemote(t)){if(r.remoteProxy.length)return r.isURLRemote(r.remoteProxy)?void g.info("Cannot use a remote proxy for loading images."):r.remoteProxy+"?camanProxyUrl="+encodeURIComponent(t);g.info("Attempting to load a remote image without a configured proxy. URL: "+t)}},t.proxyUrl=function(t){return r.remoteProxy+"?"+r.proxyParam+"="+encodeURIComponent(t)},t.useProxy=function(t){var e;return null!=(e={ruby:"rb",python:"py",perl:"pl",javascript:"js"})[t=t.toLowerCase()]&&(t=e[t]),"proxies/caman_proxy."+t},t}(),r.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},r.prototype.browserSave=function(t){var e;return null==t&&(t="png"),t=t.toLowerCase(),e=this.toBase64(t).replace("image/"+t,"image/octet-stream"),document.location.href=e},r.prototype.nodeSave=function(t,e){null==e&&(e=!0);try{if(w.statSync(t).isFile()&&!e)return!1}catch(e){p.debug("Creating output file "+t)}return w.writeFile(t,this.canvas.toBuffer(),function(){return p.debug("Finished writing to "+t)})},r.prototype.toImage=function(t){var e;return(e=document.createElement("img")).src=this.toBase64(t),e.width=this.dimensions.width,e.height=this.dimensions.height,window.devicePixelRatio&&(e.width/=window.devicePixelRatio,e.height/=window.devicePixelRatio),e},r.prototype.toBase64=function(t){return null==t&&(t="png"),t=t.toLowerCase(),this.canvas.toDataURL("image/"+t)},d=function(){function e(t){this.c=t,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=b.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new o:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return e.prototype.newLayer=function(t){return this.c.newLayer.call(this.c,t)},e.prototype.setBlendingMode=function(t){return this.options.blendingMode=t,this},e.prototype.opacity=function(t){return this.options.opacity=t/100,this},e.prototype.copyParent=function(){var t,e,i,n;for(e=this.c.pixelData,t=i=0,n=this.c.pixelData.length;i<n;t=i+=4)this.pixelData[t]=e[t],this.pixelData[t+1]=e[t+1],this.pixelData[t+2]=e[t+2],this.pixelData[t+3]=e[t+3];return this},e.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},e.prototype.overlayImage=function(e){return"object"==typeof e?e=e.src:"string"==typeof e&&"#"===e[0]&&(e=t(e).src),e?(this.c.renderer.renderQueue.push({type:c.Type.LoadOverlay,src:e,layer:this}),this):this},e.prototype.applyToParent=function(){var t,e,n,r,s,o,a,h,l;for(n=this.c.pixelStack[this.c.pixelStack.length-1],l=[],t=a=0,h=(e=this.c.pixelData).length;a<h;t=a+=4)o={r:n[t],g:n[t+1],b:n[t+2],a:n[t+3]},s={r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]},(r=i.execute(this.options.blendingMode,s,o)).r=b.clampRGB(r.r),r.g=b.clampRGB(r.g),r.b=b.clampRGB(r.b),null==r.a&&(r.a=s.a),n[t]=o.r-(o.r-r.r)*(this.options.opacity*(r.a/255)),n[t+1]=o.g-(o.g-r.g)*(this.options.opacity*(r.a/255)),l.push(n[t+2]=o.b-(o.b-r.b)*(this.options.opacity*(r.a/255)));return l},e}(),p=new(g=function(){var t,e,i,n;for(e=0,i=(n=["log","info","warn","error"]).length;e<i;e++)this[t=n[e]]=function(t){return function(){var e;if(e=1<=arguments.length?L.call(arguments,0):[],r.DEBUG)try{return console[t].apply(console,e)}catch(i){return console[t](e)}}}(t);this.debug=this.log}),v=function(){function t(t){this.c=t,this.loc=0}return t.coordinatesToLocation=function(t,e,i){return 4*(e*i+t)},t.locationToCoordinates=function(t,e){return{x:t%(4*e)/4,y:Math.floor(t/(4*e))}},t.prototype.locationXY=function(){var t;return t=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),{x:this.loc%(4*this.c.dimensions.width)/4,y:t}},t.prototype.getPixelRelative=function(t,e){var i;return(i=this.loc+4*this.c.dimensions.width*(-1*e)+4*t)>this.c.pixelData.length||i<0?{r:0,g:0,b:0,a:0}:{r:this.c.pixelData[i],g:this.c.pixelData[i+1],b:this.c.pixelData[i+2],a:this.c.pixelData[i+3]}},t.prototype.putPixelRelative=function(t,e,i){if(this.loc,this.c.dimensions.width,!(newLoc>this.c.pixelData.length||newLoc<0))return this.c.pixelData[newLoc]=i.r,this.c.pixelData[newLoc+1]=i.g,this.c.pixelData[newLoc+2]=i.b,this.c.pixelData[newLoc+3]=i.a,!0},t.prototype.getPixel=function(t,e){var i;return i=this.coordinatesToLocation(t,e,this.width),{r:this.c.pixelData[i],g:this.c.pixelData[i+1],b:this.c.pixelData[i+2],a:this.c.pixelData[i+3]}},t.prototype.putPixel=function(t,e,i){var n;return n=this.coordinatesToLocation(t,e,this.width),this.c.pixelData[n]=i.r,this.c.pixelData[n+1]=i.g,this.c.pixelData[n+2]=i.b,this.c.pixelData[n+3]=i.a},t}(),m=function(){function t(){}return t.plugins={},t.register=function(t,e){return this.plugins[t]=e},t.execute=function(t,e,i){return this.plugins[e].apply(t,i)},t}(),r.Plugin=m,r.Renderer=_=function(){function t(e){var i=this;this.c=e,this.processNext=function(){return t.prototype.processNext.apply(i,arguments)},this.renderQueue=[],this.modPixelData=null}return t.Blocks=r.NodeJS?require("os").cpus().length:4,t.prototype.add=function(t){if(null!=t)return this.renderQueue.push(t)},t.prototype.processNext=function(){var t;if(0===this.renderQueue.length)return h.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case c.Type.LayerDequeue:return t=this.c.canvasQueue.shift(),this.c.executeLayer(t),this.processNext();case c.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case c.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case c.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},t.prototype.execute=function(t){return this.finishedFn=t,this.modPixelData=b.dataArray(this.c.pixelData.length),this.processNext()},t.prototype.eachBlock=function(e){var i,n,s,o,a,h,c,u,f,d,p=this;for(this.blocksDone=0,h=this.c.pixelData.length,a=(i=4*Math.floor(h/4/t.Blocks))+h/4%t.Blocks*4,d=[],o=u=0,f=t.Blocks;0<=f?u<f:u>f;o=0<=f?++u:--u)s=(c=o*i)+(o===t.Blocks-1?a:i),r.NodeJS?(n=l(function(){return e.call(p,o,c,s)}).run(),d.push(this.blockFinished(n))):d.push(setTimeout(function(t,i,n){return function(){return e.call(p,t,i,n)}}(o,c,s),0));return d},t.prototype.executeFilter=function(){return h.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===c.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},t.prototype.executePlugin=function(){return p.debug("Executing plugin "+this.currentJob.plugin),m.execute(this.c,this.currentJob.plugin,this.currentJob.args),p.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},t.prototype.renderBlock=function(e,i,n){var s,o,a,c,u;for(p.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+i+", End: "+n),h.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:t.Blocks,startPixel:i,endPixel:n}),s={r:0,g:0,b:0,a:0},a=new v(this.c),o=u=i;u<n;o=u+=4)a.loc=o,s.r=this.c.pixelData[o],s.g=this.c.pixelData[o+1],s.b=this.c.pixelData[o+2],s.a=this.c.pixelData[o+3],null==(c=this.currentJob.processFn.call(a,s)).a&&(c.a=s.a),this.c.pixelData[o]=b.clampRGB(c.r),this.c.pixelData[o+1]=b.clampRGB(c.g),this.c.pixelData[o+2]=b.clampRGB(c.b),this.c.pixelData[o+3]=b.clampRGB(c.a);return r.NodeJS?l.yield(e):this.blockFinished(e)},t.prototype.renderKernel=function(t,e,i){var n,s,o,a,h,c,u,f,d,g,m,_,y,x,w,S,C;for(this.currentJob.name,o=this.currentJob.bias,c=this.currentJob.divisor,m=this.c.pixelData.length,n=this.currentJob.adjust,s=Math.sqrt(n.length),g=[],p.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((s-1)/2)),i=Math.min(i,m-4*this.c.dimensions.width*((s-1)/2)),a=(s-1)/2,y=new v(this.c),u=w=e;w<i;u=w+=4){for(y.loc=u,h=0,f=S=-a;-a<=a?S<=a:S>=a;f=-a<=a?++S:--S)for(d=C=a;a<=-a?C<=-a:C>=-a;d=a<=-a?++C:--C)_=y.getPixelRelative(f,d),g[3*h]=_.r,g[3*h+1]=_.g,g[3*h+2]=_.b,h++;x=this.processKernel(n,g,c,o),this.modPixelData[u]=b.clampRGB(x.r),this.modPixelData[u+1]=b.clampRGB(x.g),this.modPixelData[u+2]=b.clampRGB(x.b),this.modPixelData[u+3]=this.c.pixelData[u+3]}return r.NodeJS?l.yield(t):this.blockFinished(t)},t.prototype.blockFinished=function(e){var i,n,r;if(e>=0&&p.debug("Block #"+e+" finished! Filter: "+this.currentJob.name),this.blocksDone++,h.trigger(this.c,"blockFinished",{blockNum:e,blocksFinished:this.blocksDone,totalBlocks:t.Blocks}),this.blocksDone===t.Blocks){if(this.currentJob.type===c.Type.Kernel)for(i=n=0,r=this.c.pixelData.length;0<=r?n<r:n>r;i=0<=r?++n:--n)this.c.pixelData[i]=this.modPixelData[i];return e>=0&&p.debug("Filter "+this.currentJob.name+" finished!"),h.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},t.prototype.processKernel=function(t,e,i,n){var r,s,o,a;for(s={r:0,g:0,b:0},r=o=0,a=t.length;0<=a?o<a:o>a;r=0<=a?++o:--o)s.r+=t[r]*e[3*r],s.g+=t[r]*e[3*r+1],s.b+=t[r]*e[3*r+2];return s.r=s.r/i+n,s.g=s.g/i+n,s.b=s.b/i+n,s},t.prototype.loadOverlay=function(t,e){var i,n,r=this;return(i=document.createElement("img")).onload=function(){return t.context.drawImage(i,0,0,r.c.dimensions.width,r.c.dimensions.height),t.imageData=t.context.getImageData(0,0,r.c.dimensions.width,r.c.dimensions.height),t.pixelData=t.imageData.data,r.c.pixelData=t.pixelData,r.processNext()},n=u.remoteCheck(e),i.src=null!=n?n:e},t}(),r.Store=x=function(){function t(){}return t.items={},t.has=function(t){return null!=this.items[t]},t.get=function(t){return this.items[t]},t.put=function(t,e){return this.items[t]=e},t.execute=function(t,e){var i=this;return setTimeout(function(){return e.call(i.get(t),i.get(t))},0),this.get(t)},t.flush=function(t){return null==t&&(t=!1),t?delete this.items[t]:this.items={}},t}(),i.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),i.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),i.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),i.register("overlay",function(t,e){var i;return(i={}).r=e.r>128?255-2*(255-t.r)*(255-e.r)/255:e.r*t.r*2/255,i.g=e.g>128?255-2*(255-t.g)*(255-e.g)/255:e.g*t.g*2/255,i.b=e.b>128?255-2*(255-t.b)*(255-e.b)/255:e.b*t.b*2/255,i}),i.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),i.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),i.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),i.register("softLight",function(t,e){var i;return(i={}).r=e.r>128?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,i.g=e.g>128?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,i.b=e.b>128?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,i}),i.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),i.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}}),c.register("fillColor",function(){var t;return t=1===arguments.length?a.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(e){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=255,e})}),c.register("brightness",function(t){return t=Math.floor(t/100*255),this.process("brightness",function(e){return e.r+=t,e.g+=t,e.b+=t,e})}),c.register("saturation",function(t){return t*=-.01,this.process("saturation",function(e){var i;return i=Math.max(e.r,e.g,e.b),e.r!==i&&(e.r+=(i-e.r)*t),e.g!==i&&(e.g+=(i-e.g)*t),e.b!==i&&(e.b+=(i-e.b)*t),e})}),c.register("vibrance",function(t){return t*=-1,this.process("vibrance",function(e){var i,n,r;return r=Math.max(e.r,e.g,e.b),n=(e.r+e.g+e.b)/3,i=2*Math.abs(r-n)/255*t/100,e.r!==r&&(e.r+=(r-e.r)*i),e.g!==r&&(e.g+=(r-e.g)*i),e.b!==r&&(e.b+=(r-e.b)*i),e})}),c.register("greyscale",function(t){return this.process("greyscale",function(t){var e;return e=n.luminance(t),t.r=e,t.g=e,t.b=e,t})}),c.register("contrast",function(t){return t=Math.pow((t+100)/100,2),this.process("contrast",function(e){return e.r/=255,e.r-=.5,e.r*=t,e.r+=.5,e.r*=255,e.g/=255,e.g-=.5,e.g*=t,e.g+=.5,e.g*=255,e.b/=255,e.b-=.5,e.b*=t,e.b+=.5,e.b*=255,e})}),c.register("hue",function(t){return this.process("hue",function(e){var i,n,r;return i=100*(n=a.rgbToHSV(e.r,e.g,e.b)).h,i+=Math.abs(t),i%=100,i/=100,n.h=i,(r=a.hsvToRGB(n.h,n.s,n.v)).a=e.a,r})}),c.register("colorize",function(){var t,e;return 2===arguments.length?(e=a.hexToRGB(arguments[0]),t=arguments[1]):4===arguments.length&&(e={r:arguments[0],g:arguments[1],b:arguments[2]},t=arguments[3]),this.process("colorize",function(i){return i.r-=(i.r-e.r)*(t/100),i.g-=(i.g-e.g)*(t/100),i.b-=(i.b-e.b)*(t/100),i})}),c.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),c.register("sepia",function(t){return null==t&&(t=100),t/=100,this.process("sepia",function(e){return e.r=Math.min(255,e.r*(1-.607*t)+e.g*(.769*t)+e.b*(.189*t)),e.g=Math.min(255,e.r*(.349*t)+e.g*(1-.314*t)+e.b*(.168*t)),e.b=Math.min(255,e.r*(.272*t)+e.g*(.534*t)+e.b*(1-.869*t)),e})}),c.register("gamma",function(t){return this.process("gamma",function(e){return e.r=255*Math.pow(e.r/255,t),e.g=255*Math.pow(e.g/255,t),e.b=255*Math.pow(e.b/255,t),e})}),c.register("noise",function(t){return t=2.55*Math.abs(t),this.process("noise",function(e){var i;return i=n.randomRange(-1*t,t),e.r+=i,e.g+=i,e.b+=i,e})}),c.register("clip",function(t){return t=2.55*Math.abs(t),this.process("clip",function(e){return e.r>255-t?e.r=255:e.r<t&&(e.r=0),e.g>255-t?e.g=255:e.g<t&&(e.g=0),e.b>255-t?e.b=255:e.b<t&&(e.b=0),e})}),c.register("channels",function(t){var e;if("object"!=typeof t)return this;for(e in t)D.call(t,e)&&(0!==t[e]?t[e]/=100:delete t[e]);return 0===t.length?this:this.process("channels",function(e){return null!=t.red&&(t.red>0?e.r+=(255-e.r)*t.red:e.r-=e.r*Math.abs(t.red)),null!=t.green&&(t.green>0?e.g+=(255-e.g)*t.green:e.g-=e.g*Math.abs(t.green)),null!=t.blue&&(t.blue>0?e.b+=(255-e.b)*t.blue:e.b-=e.b*Math.abs(t.blue)),e})}),c.register("curves",function(){var t,e,i,r,s,o,a,h,l,c,u,f;if(e=arguments[0],i=2<=arguments.length?L.call(arguments,1):[],"string"==typeof e&&(e=e.split("")),"v"===e[0]&&(e=["r","g","b"]),i.length<3||i.length>4)throw"Invalid number of arguments to curves filter";if(h=i[0],r=i[1],s=4===i.length?i[2]:i[1],o=i[i.length-1],t=n.bezier(h,r,s,o,0,255),h[0]>0)for(a=l=0,u=h[0];0<=u?l<u:l>u;a=0<=u?++l:--l)t[a]=h[1];if(o[0]<255)for(a=c=f=o[0];f<=255?c<=255:c>=255;a=f<=255?++c:--c)t[a]=o[1];return this.process("curves",function(i){var n,r;for(a=n=0,r=e.length;0<=r?n<r:n>r;a=0<=r?++n:--n)i[e[a]]=t[i[e[a]]];return i})}),c.register("exposure",function(t){var e,i,n;return e=[0,255*(n=Math.abs(t)/100)],i=[255-255*n,255],t<0&&(e=e.reverse(),i=i.reverse()),this.curves("rgb",[0,0],e,i,[255,255])}),r.Plugin.register("crop",function(t,e,i,n){var r;return null==i&&(i=0),null==n&&(n=0),"undefined"!=typeof exports&&null!==exports?r=new o(t,e):(r=document.createElement("canvas"),b.copyAttributes(this.canvas,r),r.width=t,r.height=e),r.getContext("2d").drawImage(this.canvas,i,n,t,e,0,0,t,e),this.cropCoordinates={x:i,y:n},this.cropped=!0,this.replaceCanvas(r)}),r.Plugin.register("resize",function(t){var e;if(null==t&&(t=null),null!==t&&(null!=t.width||null!=t.height))return null==t.width?t.width=this.canvas.width*t.height/this.canvas.height:null==t.height&&(t.height=this.canvas.height*t.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?e=new o(t.width,t.height):(e=document.createElement("canvas"),b.copyAttributes(this.canvas,e),e.width=t.width,e.height=t.height),e.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,t.width,t.height),this.resized=!0,this.replaceCanvas(e);p.error("Invalid or missing dimensions given for resize")}),r.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),r.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),r.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),r.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),r.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),r.Filter.register("motionBlur",function(t){var e;return e=0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:t>0&&t<90||t>180&&t<270?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",e)}),r.Filter.register("sharpen",function(t){return null==t&&(t=100),t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])}),C={brightness:function(t,e,i){return t.r=t.r-t.r*e*i.strength,t.g=t.g-t.g*e*i.strength,t.b=t.b-t.b*e*i.strength,t},gamma:function(t,e,i){return t.r=255*Math.pow(t.r/255,Math.max(10*e*i.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*i.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*i.strength,1)),t},colorize:function(t,e,i){return t.r-=(t.r-i.color.r)*e,t.g-=(t.g-i.color.g)*e,t.b-=(t.b-i.color.b)*e,t}},c.register("vignette",function(t,e){var i,r,s,o;return null==e&&(e=60),"string"==typeof t&&"%"===t.substr(-1)&&(t=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(t.substr(0,t.length-1),10)/100):this.dimensions.height*(parseInt(t.substr(0,t.length-1),10)/100)),e/=100,r=[this.dimensions.width/2,this.dimensions.height/2],o=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)),s=o-t,i=n.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(o){var a,h,l;return l=this.locationXY(),(a=n.distance(l.x,l.y,r[0],r[1]))>s&&(h=Math.max(1,i[Math.round((a-s)/t*100)]/10*e),o.r=255*Math.pow(o.r/255,h),o.g=255*Math.pow(o.g/255,h),o.b=255*Math.pow(o.b/255,h)),o})}),c.register("rectangularVignette",function(t){var e,i,s,o,h,l,c;if(e={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},!(t=b.extend(e,t)).size)return this;if("string"==typeof t.size)s=parseInt(t.size,10)/100,t.size={width:this.dimensions.width*s,height:this.dimensions.height*s};else if("object"==typeof t.size)for(h=0,l=(c=["width","height"]).length;h<l;h++)i=c[h],"string"==typeof t.size[i]&&(t.size[i]=this.dimensions[i]*(parseInt(t.size[i],10)/100));else"number"===t.size&&(o=t.size,t.size={width:o,height:o});return"string"==typeof t.cornerRadius&&(t.cornerRadius=t.size.width/2*(parseInt(t.cornerRadius,10)/100)),t.strength/=100,t.size.width=Math.floor(t.size.width),t.size.height=Math.floor(t.size.height),t.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===t.method&&"string"==typeof t.color&&(t.color=a.hexToRGB(t.color)),t.coords={left:(this.dimensions.width-t.size.width)/2,right:this.dimensions.width-t.coords.left,bottom:(this.dimensions.height-t.size.height)/2,top:this.dimensions.height-t.coords.bottom},t.corners=[{x:t.coords.left+t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.bottom+t.cornerRadius},{x:t.coords.left+t.cornerRadius,y:t.coords.bottom+t.cornerRadius}],t.maxDist=n.distance(0,0,t.corners[3].x,t.corners[3].y)-t.cornerRadius,this.process("rectangularVignette",function(e){var i,n;return(n=this.locationXY()).x>t.corners[0].x&&n.x<t.corners[1].x&&n.y>t.coords.bottom&&n.y<t.coords.top?e:n.x>t.coords.left&&n.x<t.coords.right&&n.y>t.corners[3].y&&n.y<t.corners[2].y?e:(n.x>t.corners[0].x&&n.x<t.corners[1].x&&n.y>t.coords.top?i=(n.y-t.coords.top)/t.maxDist:n.y>t.corners[2].y&&n.y<t.corners[1].y&&n.x>t.coords.right?i=(n.x-t.coords.right)/t.maxDist:n.x>t.corners[0].x&&n.x<t.corners[1].x&&n.y<t.coords.bottom?i=(t.coords.bottom-n.y)/t.maxDist:n.y>t.corners[2].y&&n.y<t.corners[1].y&&n.x<t.coords.left?i=(t.coords.left-n.x)/t.maxDist:n.x<=t.corners[0].x&&n.y>=t.corners[0].y?i=(r.distance(n.x,n.y,t.corners[0].x,t.corners[0].y)-t.cornerRadius)/t.maxDist:n.x>=t.corners[1].x&&n.y>=t.corners[1].y?i=(r.distance(n.x,n.y,t.corners[1].x,t.corners[1].y)-t.cornerRadius)/t.maxDist:n.x>=t.corners[2].x&&n.y<=t.corners[2].y?i=(r.distance(n.x,n.y,t.corners[2].x,t.corners[2].y)-t.cornerRadius)/t.maxDist:n.x<=t.corners[3].x&&n.y<=t.corners[3].y&&(i=(r.distance(n.x,n.y,t.corners[3].x,t.corners[3].y)-t.cornerRadius)/t.maxDist),i<0?e:C[t.method](e,i,t))})}),A=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],M=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],k=function(t,e,i,n,r,s,a){var h,l,c,u,f,d,p;return(h="undefined"!=typeof exports&&null!==exports?new o:document.createElement("canvas")).width=t,h.height=e,u=i+Math.cos(r)*s*.5,d=n+Math.sin(r)*s*.5,f=i-Math.cos(r)*s*.5,p=n-Math.sin(r)*s*.5,c=(l=h.getContext("2d")).createLinearGradient(u,d,f,p),a?(c.addColorStop(0,"white"),c.addColorStop(.5,"black"),c.addColorStop(1,"white")):(c.addColorStop(0,"white"),c.addColorStop(1,"black")),l.fillStyle=c,l.fillRect(0,0,t,e),l.getImageData(0,0,t,e)},E=function(t,e,i,n,r,s){var a,h,l;return(a="undefined"!=typeof exports&&null!==exports?new o:document.createElement("canvas")).width=t,a.height=e,(l=(h=a.getContext("2d")).createRadialGradient(i,n,r,i,n,s)).addColorStop(1,"white"),l.addColorStop(0,"black"),h.fillStyle=l,h.fillRect(0,0,t,e),h.getImageData(0,0,t,e)},T=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},r.Plugin.register("compoundBlur",function(t,e,i,n){var r,s,o,a,h,l,c,u,f,d,p,g,v,m,_,y,x,b,w,S,C,k,E,D,O,L,P,B,I,R,F,U,N,z,G,X,Y,W,j,Z,H,V,q,K,J,Q,$,tt,et,it,nt,rt,st,ot,at,ht,lt;for(H=this.dimensions.width,d=this.dimensions.height,_=this.pixelData,B=t.data,Z=(j=H*d)<<2,E=[],g=tt=0;0<=Z?tt<Z:tt>Z;g=0<=Z?++tt:--tt)E[g]=_[g];for(h=0,Y=n,n-=1;Y-- >=0;)if(0!=(x=e+.5|0)){for(x>256&&(x=256),l=x+x+1,V=H-1,p=d-1,W=(I=x+1)*(I+1)/2,N=void 0,U=X=new T,g=et=1;1<=l?et<l:et>l;g=1<=l?++et:--et)U=U.next=new T,g===I&&(N=U);for(U.next=X,z=null,G=null,$=J=0,w=A[x],F=M[x],K=it=0;0<=d?it<d:it>d;K=0<=d?++it:--it){for(O=c=r=P=f=o=0,L=I*(D=E[J]),u=I*(k=E[J+1]),s=I*(C=E[J+2]),P+=W*D,f+=W*k,o+=W*C,U=X,g=nt=0;0<=I?nt<I:nt>I;g=0<=I?++nt:--nt)U.r=D,U.g=k,U.b=C,U=U.next;for(g=rt=1;1<=I?rt<I:rt>I;g=1<=I?++rt:--rt)S=J+((V<g?V:g)<<2),P+=(U.r=D=E[S])*(R=I-g),f+=(U.g=k=E[S+1])*R,o+=(U.b=C=E[S+2])*R,O+=D,c+=k,r+=C,U=U.next;for(z=X,G=N,q=st=0;0<=H?st<H:st>H;q=0<=H?++st:--st)E[J]=P*w>>F,E[J+1]=f*w>>F,E[J+2]=o*w>>F,P-=L,f-=u,o-=s,L-=z.r,u-=z.g,s-=z.b,S=$+((S=q+I)<V?S:V)<<2,P+=O+=z.r=E[S],f+=c+=z.g=E[S+1],o+=r+=z.b=E[S+2],z=z.next,L+=D=G.r,u+=k=G.g,s+=C=G.b,O-=D,c-=k,r-=C,G=G.next,J+=4;$+=H}for(q=ot=0;0<=H?ot<H:ot>H;q=0<=H?++ot:--ot){for(c=r=O=f=o=P=0,L=I*(D=E[J=q<<2]),u=I*(k=E[J+1]),s=I*(C=E[J+2]),P+=W*D,f+=W*k,o+=W*C,U=X,g=at=0;0<=I?at<I:at>I;g=0<=I?++at:--at)U.r=D,U.g=k,U.b=C,U=U.next;for(Q=H,g=ht=1;1<=I?ht<I:ht>I;g=1<=I?++ht:--ht)J=Q+q<<2,P+=(U.r=D=E[J])*(R=I-g),f+=(U.g=k=E[J+1])*R,o+=(U.b=C=E[J+2])*R,O+=D,c+=k,r+=C,U=U.next,g<p&&(Q+=H);for(J=q,z=X,G=N,K=lt=0;0<=d?lt<d:lt>d;K=0<=d?++lt:--lt)E[S=J<<2]=P*w>>F,E[S+1]=f*w>>F,E[S+2]=o*w>>F,P-=L,f-=u,o-=s,L-=z.r,u-=z.g,s-=z.b,S=q+((S=K+I)<p?S:p)*H<<2,P+=O+=z.r=E[S],f+=c+=z.g=E[S+1],o+=r+=z.b=E[S+2],z=z.next,L+=D=G.r,u+=k=G.g,s+=C=G.b,O-=D,c-=k,r-=C,G=G.next,J+=H}for(e*=i,g=j;--g>-1;)(y=0|(b=(255&B[2+(m=g<<2)])/255*n))===h?(v=256-(a=256*(b-(0|b))),_[m]=_[m]*v+E[m]*a>>8,_[m+1]=_[m+1]*v+E[m+1]*a>>8,_[m+2]=_[m+2]*v+E[m+2]*a>>8):y===h+1&&(_[m]=E[m],_[m+1]=E[m+1],_[m+2]=E[m+2]);h++}return this}),r.Filter.register("tiltShift",function(t){var e,i;return e={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},(t=b.extend(e,t)).angle*=Math.PI/180,i=k(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.angle,t.focusWidth,!0),this.processPlugin("compoundBlur",[i,t.startRadius,t.radiusFactor,t.steps])}),r.Filter.register("radialBlur",function(t){var e,i,n,r;return e={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},(t=b.extend(e,t)).radius||(t.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),n=t.radius/2-t.size,r=t.radius/2,i=E(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,n,r),this.processPlugin("compoundBlur",[i,t.startRadius,t.radiusFactor,t.steps])}),r.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),r.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),r.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),r.Filter.register("posterize",function(t){var e,i;return e=256/t,i=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*i),t.g=Math.floor(Math.floor(t.g/e)*i),t.b=Math.floor(Math.floor(t.b/e)*i),t})}),r.Filter.register("vintage",function(t){if(null==t&&(t=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t)return this.vignette("40%",30)}),r.Filter.register("lomo",function(t){return null==t&&(t=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),r.Filter.register("clarity",function(t){return null==t&&(t=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),r.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),r.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),r.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),r.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),r.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),r.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),r.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),r.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),r.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),r.Filter.register("glowingSun",function(t){if(null==t&&(t=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t)return this.vignette("45%",20)}),r.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),r.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),r.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),r.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),r.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),function(){var t,e,i;e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],t=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},r.Plugin.register("stackBlur",function(n){var r,s,o,a,h,l,c,u,f,d,p,g,v,m,_,y,x,b,w,S,C,T,k,E,A,M,D,O,L,P,B,I,R,F,U,N,z,G,X,Y,W,j,Z,H;if(!(isNaN(n)||n<1)){for(n|=0,_=this.pixelData,a=n+n+1,P=(L=this.dimensions.width)-1,f=(u=this.dimensions.height)-1,O=(S=n+1)*(S+1)/2,k=D=new t,d=N=1;1<=a?N<a:N>a;d=1<=a?++N:--N)k=k.next=new t,d===S&&(E=k);for(k.next=D,A=null,M=null,U=R=0,p=e[n],T=i[n],I=z=0;0<=u?z<u:z>u;I=0<=u?++z:--z){for(x=h=r=w=c=o=0,b=S*(y=_[R]),l=S*(m=_[R+1]),s=S*(v=_[R+2]),w+=O*y,c+=O*m,o+=O*v,k=D,d=G=0;0<=S?G<S:G>S;d=0<=S?++G:--G)k.r=y,k.g=m,k.b=v,k=k.next;for(d=X=1;1<=S?X<S:X>S;d=1<=S?++X:--X)g=R+((P<d?P:d)<<2),w+=(k.r=y=_[g])*(C=S-d),c+=(k.g=m=_[g+1])*C,o+=(k.b=v=_[g+2])*C,x+=y,h+=m,r+=v,k=k.next;for(A=D,M=E,B=Y=0;0<=L?Y<L:Y>L;B=0<=L?++Y:--Y)_[R]=w*p>>T,_[R+1]=c*p>>T,_[R+2]=o*p>>T,w-=b,c-=l,o-=s,b-=A.r,l-=A.g,s-=A.b,g=U+((g=B+n+1)<P?g:P)<<2,w+=x+=A.r=_[g],c+=h+=A.g=_[g+1],o+=r+=A.b=_[g+2],A=A.next,b+=y=M.r,l+=m=M.g,s+=v=M.b,x-=y,h-=m,r-=v,M=M.next,R+=4;U+=L}for(B=W=0;0<=L?W<L:W>L;B=0<=L?++W:--W){for(h=r=x=c=o=w=0,b=S*(y=_[R=B<<2]),l=S*(m=_[R+1]),s=S*(v=_[R+2]),w+=O*y,c+=O*m,o+=O*v,k=D,d=j=0;0<=S?j<S:j>S;d=0<=S?++j:--j)k.r=y,k.g=m,k.b=v,k=k.next;for(F=L,d=Z=1;1<=n?Z<=n:Z>=n;d=1<=n?++Z:--Z)R=F+B<<2,w+=(k.r=y=_[R])*(C=S-d),c+=(k.g=m=_[R+1])*C,o+=(k.b=v=_[R+2])*C,x+=y,h+=m,r+=v,k=k.next,d<f&&(F+=L);for(R=B,A=D,M=E,I=H=0;0<=u?H<u:H>u;I=0<=u?++H:--H)_[g=R<<2]=w*p>>T,_[g+1]=c*p>>T,_[g+2]=o*p>>T,w-=b,c-=l,o-=s,b-=A.r,l-=A.g,s-=A.b,g=B+((g=I+S)<f?g:f)*L<<2,w+=x+=A.r=_[g],c+=h+=A.g=_[g+1],o+=r+=A.b=_[g+2],A=A.next,b+=y=M.r,l+=m=M.g,s+=v=M.b,x-=y,h-=m,r-=v,M=M.next,R+=L}return this}}),r.Filter.register("stackBlur",function(t){return this.processPlugin("stackBlur",[t])})}(),r.Filter.register("threshold",function(t){return this.process("threshold",function(e){return.2126*e.r+.7152*e.g+.0722*e.b<t?(e.r=0,e.g=0,e.b=0):(e.r=255,e.g=255,e.b=255),e})})}.call(this),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){return r(e[o][1][t]||t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){"use strict";var n=t("./utils"),r=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,r,o,a,h,l,c=[],u=0,f=t.length,d=f,p="string"!==n.getTypeOf(t);u<t.length;)d=f-u,r=p?(e=t[u++],i=u<f?t[u++]:0,u<f?t[u++]:0):(e=t.charCodeAt(u++),i=u<f?t.charCodeAt(u++):0,u<f?t.charCodeAt(u++):0),o=e>>2,a=(3&e)<<4|i>>4,h=1<d?(15&i)<<2|r>>6:64,l=2<d?63&r:64,c.push(s.charAt(o)+s.charAt(a)+s.charAt(h)+s.charAt(l));return c.join("")},i.decode=function(t){var e,i,n,o,a,h,l=0,c=0,u="data:";if(t.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var f,d=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===s.charAt(64)&&d--,t.charAt(t.length-2)===s.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(f=r.uint8array?new Uint8Array(0|d):new Array(0|d);l<t.length;)e=s.indexOf(t.charAt(l++))<<2|(o=s.indexOf(t.charAt(l++)))>>4,i=(15&o)<<4|(a=s.indexOf(t.charAt(l++)))>>2,n=(3&a)<<6|(h=s.indexOf(t.charAt(l++))),f[c++]=e,64!==a&&(f[c++]=i),64!==h&&(f[c++]=n);return f}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";var n=t("./external"),r=t("./stream/DataWorker"),s=t("./stream/DataLengthProbe"),o=t("./stream/Crc32Probe");function a(t,e,i,n,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=n,this.compressedContent=r}s=t("./stream/DataLengthProbe"),a.prototype={getContentWorker:function(){var t=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(t,e,i){return t.pipe(new o).pipe(new s("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new s("compressedSize")).withStreamInfo("compression",e)},e.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";var n=t("./utils"),r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function(t,e,i,n){var s=r,o=0+i;t^=-1;for(var a=0;a<o;a++)t=t>>>8^s[255&(t^e[a])];return-1^t}(0|e,t,t.length):function(t,e,i,n){var s=r,o=0+i;t^=-1;for(var a=0;a<o;a++)t=t>>>8^s[255&(t^e.charCodeAt(a))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var n;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:37}],7:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),s=t("./utils"),o=t("./stream/GenericWorker"),a=n?"uint8array":"array";function h(t,e){o.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",s.inherits(h,o),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,t.data),!1)},h.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new h("Deflate",t)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,i){"use strict";function n(t,e){var i,n="";for(i=0;i<e;i++)n+=String.fromCharCode(255&t),t>>>=8;return n}function r(t,e,i,r,o,c){var u,f,d=t.file,p=t.compression,g=c!==a.utf8encode,v=s.transformTo("string",c(d.name)),m=s.transformTo("string",a.utf8encode(d.name)),_=d.comment,y=s.transformTo("string",c(_)),x=s.transformTo("string",a.utf8encode(_)),b=m.length!==d.name.length,w=x.length!==_.length,S="",C="",T="",k=d.dir,E=d.date,A={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(A.crc32=t.crc32,A.compressedSize=t.compressedSize,A.uncompressedSize=t.uncompressedSize);var M=0;e&&(M|=8),g||!b&&!w||(M|=2048);var D=0,O=0;k&&(D|=16),"UNIX"===o?(O=798,D|=function(t,e){var i=t;return t||(i=k?16893:33204),(65535&i)<<16}(d.unixPermissions)):(O=20,D|=63&(d.dosPermissions||0)),u=E.getUTCHours(),u<<=6,u|=E.getUTCMinutes(),u<<=5,u|=E.getUTCSeconds()/2,f=E.getUTCFullYear()-1980,f<<=4,f|=E.getUTCMonth()+1,f<<=5,f|=E.getUTCDate(),b&&(C=n(1,1)+n(h(v),4)+m,S+="up"+n(C.length,2)+C),w&&(T=n(1,1)+n(h(y),4)+x,S+="uc"+n(T.length,2)+T);var L="";return L+="\n\0",L+=n(M,2),L+=p.magic,L+=n(u,2),L+=n(f,2),L+=n(A.crc32,4),L+=n(A.compressedSize,4),L+=n(A.uncompressedSize,4),L+=n(v.length,2),L+=n(S.length,2),{fileRecord:l.LOCAL_FILE_HEADER+L+v+S,dirRecord:l.CENTRAL_FILE_HEADER+n(O,2)+L+n(y.length,2)+"\0\0\0\0"+n(D,4)+n(r,4)+v+S+y}}var s=t("../utils"),o=t("../stream/GenericWorker"),a=t("../utf8"),h=t("../crc32"),l=t("../signature");function c(t,e,i,n){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(c,o),c.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,o.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-n-1))/i:100}}))},c.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=r(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=r(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:function(t){return l.DATA_DESCRIPTOR+n(t.crc32,4)+n(t.compressedSize,4)+n(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,r=function(t,e,i,r,o){var a=s.transformTo("string",o(r));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(t,2)+n(t,2)+n(e,4)+n(i,4)+n(a.length,2)+a}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},c.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(t){var e=this._sources;if(!o.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},c.prototype.lock=function(){o.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(t,e,i){var s=new r(e.streamFiles,i,e.platform,e.encodeFileName),o=0;try{t.forEach(function(t,i){o++;var r=function(t,e){var i=t||e,r=n[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,e.compression),a=i.options.compressionOptions||e.compressionOptions||{},h=i.dir,l=i.date;i._compressWorker(r,a).withStreamInfo("file",{name:t,dir:h,date:l,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(s)}),s.entriesCount=o}catch(t){s.error(t)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.2.0",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";var n=t("./utils"),r=t("./external"),s=t("./utf8"),o=(n=t("./utils"),t("./zipEntries")),a=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function l(t){return new r.Promise(function(e,i){var n=t.decompressed.getContentWorker().pipe(new a);n.on("error",function(t){i(t)}).on("end",function(){n.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var i=this;return e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),h.isNode&&h.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var i=new o(e);return i.load(t),i}).then(function(t){var i=[r.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var s=0;s<n.length;s++)i.push(l(n[s]));return r.Promise.all(i)}).then(function(t){for(var n=t.shift(),r=n.files,s=0;s<r.length;s++){var o=r[s];i.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:e.createFolders})}return n.zipComment.length&&(i.comment=n.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../stream/GenericWorker");function s(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(s,r),s.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},s.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";var n=t("readable-stream").Readable;function r(t,e,i){n.call(this,e),this._helper=t;var r=this;t.on("data",function(t,e){r.push(t)||r._helper.pause(),i&&i(e)}).on("error",function(t){r.emit("error",t)}).on("end",function(){r.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function n(t,e,i){var n,r=s.getTypeOf(e),a=s.extend(i||{},h);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(t=g(t)),a.createFolders&&(n=p(t))&&v.call(this,n,!0);var u,m="string"===r&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!m),(e instanceof l&&0===e.uncompressedSize||a.dir||!e||0===e.length)&&(a.base64=!1,a.binary=!0,e="",a.compression="STORE",r="string"),u=e instanceof l||e instanceof o?e:f.isNode&&f.isStream(e)?new d(t,e):s.prepareContent(t,e,a.binary,a.optimizedBinaryString,a.base64);var _=new c(t,u,a);this.files[t]=_}var r=t("./utf8"),s=t("./utils"),o=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),h=t("./defaults"),l=t("./compressedObject"),c=t("./zipObject"),u=t("./generate"),f=t("./nodejsUtils"),d=t("./nodejs/NodejsStreamInputAdapter"),p=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},g=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},v=function(t,e){return e=void 0!==e?e:h.createFolders,t=g(t),this.files[t]||n.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function m(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,n;for(e in this.files)this.files.hasOwnProperty(e)&&(n=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,n))},filter:function(t){var e=[];return this.forEach(function(i,n){t(i,n)&&e.push(n)}),e},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,n.call(this,t,e,i),this;if(m(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}var s=this.files[this.root+t];return s&&!s.dir?s:null},folder:function(t){if(!t)return this;if(m(t))return this.filter(function(e,i){return i.dir&&t.test(e)});var e=this.root+t,i=v.call(this,e),n=this.clone();return n.root=i.name,n},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter(function(e,i){return i.name.slice(0,t.length)===t}),n=0;n<i.length;n++)delete this.files[i[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=s.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");s.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var n=i.comment||this.comment||"";e=u.generateWorker(this,i,n)}catch(t){(e=new o("error")).error(t)}return new a(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";var n=t("./DataReader");function r(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,n),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===e&&this.data[s+1]===i&&this.data[s+2]===n&&this.data[s+3]===r)return s-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&i===s[1]&&n===s[2]&&r===s[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";var n=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,i){"use strict";var n=t("./Uint8ArrayReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";var n=t("./DataReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";var n=t("./ArrayReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../support"),s=t("./ArrayReader"),o=t("./StringReader"),a=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new a(t):r.uint8array?new h(n.transformTo("uint8array",t)):new s(n.transformTo("array",t)):new o(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";var n=t("./GenericWorker"),r=t("../utils");function s(t){n.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(s,n),s.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";var n=t("./GenericWorker"),r=t("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(s,n),s.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./GenericWorker");function s(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(s,r),s.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./GenericWorker");function s(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(s,r),s.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./ConvertWorker"),s=t("./GenericWorker"),o=t("../base64"),a=t("../support"),h=t("../external"),l=null;if(a.nodestream)try{l=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function c(t,e,i){var o=e;switch(e){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=e,this._mimeType=i,n.checkSupport(o),this._worker=t.pipe(new r(o)),t.lock()}catch(t){this._worker=new s("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return function(t,e){return new h.Promise(function(i,r){var s=[],a=t._internalType,h=t._outputType,l=t._mimeType;t.on("data",function(t,i){s.push(t),e&&e(i)}).on("error",function(t){s=[],r(t)}).on("end",function(){try{var t=function(t,e,i){switch(t){case"blob":return n.newBlob(n.transformTo("arraybuffer",e),i);case"base64":return o.encode(e);default:return n.transformTo(t,e)}}(h,function(t,e){var i,n=0,r=null,s=0;for(i=0;i<e.length;i++)s+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(s),i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(a,s),l);i(t)}catch(t){r(t)}s=[]}).resume()})}(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,function(t){e.call(i,t.data,t.meta)}):this._worker.on(t,function(){n.delay(e,arguments,i)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=0===r.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";for(var n=t("./utils"),r=t("./support"),s=t("./nodejsUtils"),o=t("./stream/GenericWorker"),a=new Array(256),h=0;h<256;h++)a[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function l(){o.call(this,"utf-8 decode"),this.leftOver=null}function c(){o.call(this,"utf-8 encode")}a[254]=a[254]=1,i.utf8encode=function(t){return r.nodebuffer?s.newBufferFrom(t,"utf-8"):function(t){var e,i,n,s,o,a=t.length,h=0;for(s=0;s<a;s++)55296==(64512&(i=t.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=t.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=r.uint8array?new Uint8Array(h):new Array(h),s=o=0;o<h;s++)55296==(64512&(i=t.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=t.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),i<128?e[o++]=i:(i<2048?e[o++]=192|i>>>6:(i<65536?e[o++]=224|i>>>12:(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63),e[o++]=128|i>>>6&63),e[o++]=128|63&i);return e}(t)},i.utf8decode=function(t){return r.nodebuffer?n.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,r,s,o=t.length,h=new Array(2*o);for(e=i=0;e<o;)if((r=t[e++])<128)h[i++]=r;else if(4<(s=a[r]))h[i++]=65533,e+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&e<o;)r=r<<6|63&t[e++],s--;1<s?h[i++]=65533:r<65536?h[i++]=r:(r-=65536,h[i++]=55296|r>>10&1023,h[i++]=56320|1023&r)}return h.length!==i&&(h.subarray?h=h.subarray(0,i):h.length=i),n.applyFromCharCode(h)}(t=n.transformTo(r.uint8array?"uint8array":"array",t))},n.inherits(l,o),l.prototype.processChunk=function(t){var e=n.transformTo(r.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var s=e;(e=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),e.set(s,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var o=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+a[t[i]]>e?i:e}(e),h=e;o!==e.length&&(r.uint8array?(h=e.subarray(0,o),this.leftOver=e.subarray(o,e.length)):(h=e.slice(0,o),this.leftOver=e.slice(o,e.length))),this.push({data:i.utf8decode(h),meta:t.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=l,n.inherits(c,o),c.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";var n=t("./support"),r=t("./base64"),s=t("./nodejsUtils"),o=t("set-immediate-shim"),a=t("./external");function h(t){return t}function l(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,i){var n=[],r=0,s=t.length;if(s<=i)return String.fromCharCode.apply(null,t);for(;r<s;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+i,s)))):n.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+i,s)))),r+=i;return n.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(t){return!1}}()}};function u(t){var e=65536,n=i.getTypeOf(t),r=!0;if("uint8array"===n?r=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(r=c.applyCanBeUsed.nodebuffer),r)for(;1<e;)try{return c.stringifyByChunk(t,n,e)}catch(t){e=Math.floor(e/2)}return c.stringifyByChar(t)}function f(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}i.applyFromCharCode=u;var d={};d.string={string:h,array:function(t){return l(t,new Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return l(t,new Uint8Array(t.length))},nodebuffer:function(t){return l(t,s.allocBuffer(t.length))}},d.array={string:u,array:h,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(t)}},d.arraybuffer={string:function(t){return u(new Uint8Array(t))},array:function(t){return f(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:h,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(new Uint8Array(t))}},d.uint8array={string:u,array:function(t){return f(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:h,nodebuffer:function(t){return s.newBufferFrom(t)}},d.nodebuffer={string:u,array:function(t){return f(t,new Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return f(t,new Uint8Array(t.length))},nodebuffer:h},i.transformTo=function(t,e){if(e=e||"",!t)return e;i.checkSupport(t);var n=i.getTypeOf(e);return d[n][t](e)},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":n.nodebuffer&&s.isBuffer(t)?"nodebuffer":n.uint8array&&t instanceof Uint8Array?"uint8array":n.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!n[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,n="";for(i=0;i<(t||"").length;i++)n+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return n},i.delay=function(t,e,i){o(function(){t.apply(i||null,e||[])})},i.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,s,o,h){return a.Promise.resolve(e).then(function(t){return n.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new a.Promise(function(e,i){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){i(t.target.error)},n.readAsArrayBuffer(t)}):t}).then(function(e){var c=i.getTypeOf(e);return c?("arraybuffer"===c?e=i.transformTo("uint8array",e):"string"===c&&(h?e=r.decode(e):s&&!0!==o&&(e=function(t){return l(t,n.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):a.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,i){"use strict";var n=t("./reader/readerFor"),r=t("./utils"),s=t("./signature"),o=t("./zipEntry"),a=(t("./utf8"),t("./support"));function h(t){this.files=[],this.loadOptions=t}h.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;return this.reader.setIndex(i),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=a.uint8array?"uint8array":"array",i=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(t=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=e-i;if(0<n)this.isSignature(e,s.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";var n=t("./reader/readerFor"),r=t("./utils"),s=t("./compressedObject"),o=t("./crc32"),a=t("./utf8"),h=t("./compressions"),l=t("./support");function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,n,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<r;)e=t.readInt(2),i=t.readInt(2),n=t.readData(i),this.extraFields[e]={id:e,length:i,value:n}},handleUTF8:function(){var t=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=r.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var s=r.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:o(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:o(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";function n(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var r=t("./stream/StreamHelper"),s=t("./stream/DataWorker"),o=t("./utf8"),a=t("./compressedObject"),h=t("./stream/GenericWorker");n.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var n="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var s=!this._dataBinary;s&&!n&&(e=e.pipe(new o.Utf8EncodeWorker)),!s&&n&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){(e=new h("error")).error(t)}return new r(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof h?this._data:new s(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)n.prototype[l[u]]=c;e.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){(function(t){"use strict";var i,n,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var s=0,o=new r(c),a=t.document.createTextNode("");o.observe(a,{characterData:!0}),i=function(){a.data=s=++s%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var h=new t.MessageChannel;h.port1.onmessage=c,i=function(){h.port2.postMessage(0)}}var l=[];function c(){var t,e;n=!0;for(var i=l.length;i;){for(e=l,l=[],t=-1;++t<i;)e[t]();i=l.length}n=!1}e.exports=function(t){1!==l.push(t)||n||i()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,i){"use strict";var n=t("immediate");function r(){}var s={},o=["REJECTED"],a=["FULFILLED"],h=["PENDING"];function l(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,t!==r&&d(this,t)}function c(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function u(t,e,i){n(function(){var n;try{n=e(i)}catch(n){return s.reject(t,n)}n===t?s.reject(t,new TypeError("Cannot resolve promise with itself")):s.resolve(t,n)})}function f(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var i=!1;function n(e){i||(i=!0,s.reject(t,e))}function r(e){i||(i=!0,s.resolve(t,e))}var o=p(function(){e(r,n)});"error"===o.status&&n(o.value)}function p(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=l).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){throw i})})},l.prototype.catch=function(t){return this.then(null,t)},l.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var i=new this.constructor(r);return this.state!==h?u(i,this.state===a?t:e,this.outcome):this.queue.push(new c(i,t,e)),i},c.prototype.callFulfilled=function(t){s.resolve(this.promise,t)},c.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},c.prototype.callRejected=function(t){s.reject(this.promise,t)},c.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},s.resolve=function(t,e){var i=p(f,e);if("error"===i.status)return s.reject(t,i.value);var n=i.value;if(n)d(t,n);else{t.state=a,t.outcome=e;for(var r=-1,o=t.queue.length;++r<o;)t.queue[r].callFulfilled(e)}return t},s.reject=function(t,e){t.state=o,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},l.resolve=function(t){return t instanceof this?t:s.resolve(new this(r),t)},l.reject=function(t){var e=new this(r);return s.reject(e,t)},l.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,h=-1,l=new this(r);++h<i;)c(t[h],h);return l;function c(t,r){e.resolve(t).then(function(t){o[r]=t,++a!==i||n||(n=!0,s.resolve(l,o))},function(t){n||(n=!0,s.reject(l,t))})}},l.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);for(var n,o=-1,a=new this(r);++o<e;)n=t[o],this.resolve(n).then(function(t){i||(i=!0,s.resolve(a,t))},function(t){i||(i=!0,s.reject(a,t))});return a}},{immediate:36}],38:[function(t,e,i){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,i){"use strict";var n=t("./zlib/deflate"),r=t("./utils/common"),s=t("./utils/strings"),o=t("./zlib/messages"),a=t("./zlib/zstream"),h=Object.prototype.toString,l=0,c=-1,u=0,f=8;function d(t){if(!(this instanceof d))return new d(t);this.options=r.assign({level:c,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==l)throw new Error(o[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=n.deflateSetDictionary(this.strm,p))!==l)throw new Error(o[i]);this._dict_set=!0}}function p(t,e){var i=new d(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}d.prototype.push=function(t,e){var i,o,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=s.string2buf(t):"[object ArrayBuffer]"===h.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(c),a.next_out=0,a.avail_out=c),1!==(i=n.deflate(a,o))&&i!==l)return this.onEnd(i),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==i);return 4===o?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l):2!==o||(this.onEnd(l),!(a.avail_out=0))},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=d,i.deflate=p,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,i){"use strict";var n=t("./zlib/inflate"),r=t("./utils/common"),s=t("./utils/strings"),o=t("./zlib/constants"),a=t("./zlib/messages"),h=t("./zlib/zstream"),l=t("./zlib/gzheader"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==o.Z_OK)throw new Error(a[i]);this.header=new l,n.inflateGetHeader(this.strm,this.header)}function f(t,e){var i=new u(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}u.prototype.push=function(t,e){var i,a,h,l,u,f,d=this.strm,p=this.options.chunkSize,g=this.options.dictionary,v=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof t?d.input=s.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new r.Buf8(p),d.next_out=0,d.avail_out=p),(i=n.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&g&&(f="string"==typeof g?s.string2buf(g):"[object ArrayBuffer]"===c.call(g)?new Uint8Array(g):g,i=n.inflateSetDictionary(this.strm,f)),i===o.Z_BUF_ERROR&&!0===v&&(i=o.Z_OK,v=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),!(this.ended=!0);d.next_out&&(0!==d.avail_out&&i!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(h=s.utf8border(d.output,d.next_out),l=d.next_out-h,u=s.buf2string(d.output,h),d.next_out=l,d.avail_out=p-l,l&&r.arraySet(d.output,d.output,h,l,0),this.onData(u)):this.onData(r.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(v=!0)}while((0<d.avail_in||0===d.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(d.avail_out=0))},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=u,i.inflate=f,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},i.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var s=0;s<n;s++)t[r+s]=e[i+s]},flattenChunks:function(t){var e,i,n,r,s,o;for(e=n=0,i=t.length;e<i;e++)n+=t[e].length;for(o=new Uint8Array(n),e=r=0,i=t.length;e<i;e++)s=t[e],o.set(s,r),r+=s.length;return o}},s={arraySet:function(t,e,i,n,r){for(var s=0;s<n;s++)t[r+s]=e[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,s))},i.setTyped(n)},{}],42:[function(t,e,i){"use strict";var n=t("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function h(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",o=0;o<e;o++)i+=String.fromCharCode(t[o]);return i}o[254]=o[254]=1,i.string2buf=function(t){var e,i,r,s,o,a=t.length,h=0;for(s=0;s<a;s++)55296==(64512&(i=t.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=t.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(h),s=o=0;o<h;s++)55296==(64512&(i=t.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=t.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),i<128?e[o++]=i:(i<2048?e[o++]=192|i>>>6:(i<65536?e[o++]=224|i>>>12:(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63),e[o++]=128|i>>>6&63),e[o++]=128|63&i);return e},i.buf2binstring=function(t){return h(t,t.length)},i.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,n,r,s,a=e||t.length,l=new Array(2*a);for(i=n=0;i<a;)if((r=t[i++])<128)l[n++]=r;else if(4<(s=o[r]))l[n++]=65533,i+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&i<a;)r=r<<6|63&t[i++],s--;1<s?l[n++]=65533:r<65536?l[n++]=r:(r-=65536,l[n++]=55296|r>>10&1023,l[n++]=56320|1023&r)}return h(l,n)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+o[t[i]]>e?i:e}},{"./common":41}],43:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){for(var r=65535&t|0,s=t>>>16&65535|0,o=0;0!==i;){for(i-=o=2e3<i?2e3:i;s=s+(r=r+e[n++]|0)|0,--o;);r%=65521,s%=65521}return r|s<<16|0}},{}],44:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,r){var s=n,o=r+i;t^=-1;for(var a=r;a<o;a++)t=t>>>8^s[255&(t^e[a])];return-1^t}},{}],46:[function(t,e,i){"use strict";var n,r=t("../utils/common"),s=t("./trees"),o=t("./adler32"),a=t("./crc32"),h=t("./messages"),l=0,c=4,u=0,f=-2,d=-1,p=4,g=2,v=8,m=9,_=286,y=30,x=19,b=2*_+1,w=15,S=3,C=258,T=C+S+1,k=42,E=113,A=1,M=2,D=3,O=4;function L(t,e){return t.msg=h[e],e}function P(t){return(t<<1)-(4<t?9:0)}function B(t){for(var e=t.length;0<=--e;)t[e]=0}function I(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function R(t,e){s._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,I(t.strm)}function F(t,e){t.pending_buf[t.pending++]=e}function U(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function N(t,e){var i,n,r=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match,h=t.strstart>t.w_size-T?t.strstart-(t.w_size-T):0,l=t.window,c=t.w_mask,u=t.prev,f=t.strstart+C,d=l[s+o-1],p=l[s+o];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(l[(i=e)+o]===p&&l[i+o-1]===d&&l[i]===l[s]&&l[++i]===l[s+1]){s+=2,i++;do{}while(l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&s<f);if(n=C-(f-s),s=f-C,o<n){if(t.match_start=e,a<=(o=n))break;d=l[s+o-1],p=l[s+o]}}}while((e=u[e&c])>h&&0!=--r);return o<=t.lookahead?o:t.lookahead}function z(t){var e,i,n,s,h,l,c,u,f,d,p=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-T)){for(r.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=i=t.hash_size;n=t.head[--e],t.head[e]=p<=n?n-p:0,--i;);for(e=i=p;n=t.prev[--e],t.prev[e]=p<=n?n-p:0,--i;);s+=p}if(0===t.strm.avail_in)break;if(l=t.strm,c=t.window,u=t.strstart+t.lookahead,d=void 0,(f=s)<(d=l.avail_in)&&(d=f),i=0===d?0:(l.avail_in-=d,r.arraySet(c,l.input,l.next_in,d,u),1===l.state.wrap?l.adler=o(l.adler,c,d,u):2===l.state.wrap&&(l.adler=a(l.adler,c,d,u)),l.next_in+=d,l.total_in+=d,d),t.lookahead+=i,t.lookahead+t.insert>=S)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+S-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<T&&0!==t.strm.avail_in)}function G(t,e){for(var i,n;;){if(t.lookahead<T){if(z(t),t.lookahead<T&&e===l)return A;if(0===t.lookahead)break}if(i=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-T&&(t.match_length=N(t,i)),t.match_length>=S)if(n=s._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(R(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<S-1?t.strstart:S-1,e===c?(R(t,!0),0===t.strm.avail_out?D:O):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?A:M}function X(t,e){for(var i,n,r;;){if(t.lookahead<T){if(z(t),t.lookahead<T&&e===l)return A;if(0===t.lookahead)break}if(i=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-T&&(t.match_length=N(t,i),t.match_length<=5&&(1===t.strategy||t.match_length===S&&4096<t.strstart-t.match_start)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-S,n=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=S-1,t.strstart++,n&&(R(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((n=s._tr_tally(t,0,t.window[t.strstart-1]))&&R(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===c?(R(t,!0),0===t.strm.avail_out?D:O):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?A:M}function Y(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*b),this.dyn_dtree=new r.Buf16(2*(2*y+1)),this.bl_tree=new r.Buf16(2*(2*x+1)),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(w+1),this.heap=new r.Buf16(2*_+1),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*_+1),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function j(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=g,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?k:E,t.adler=2===e.wrap?0:1,e.last_flush=l,s._tr_init(e),u):L(t,f)}function Z(t){var e=j(t);return e===u&&function(t){t.window_size=2*t.w_size,B(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0}(t.state),e}function H(t,e,i,n,s,o){if(!t)return f;var a=1;if(e===d&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),s<1||m<s||i!==v||n<8||15<n||e<0||9<e||o<0||p<o)return L(t,f);8===n&&(n=9);var h=new W;return(t.state=h).strm=t,h.wrap=a,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+S-1)/S),h.window=new r.Buf8(2*h.w_size),h.head=new r.Buf16(h.hash_size),h.prev=new r.Buf16(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new r.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=o,h.method=i,Z(t)}n=[new Y(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(z(t),0===t.lookahead&&e===l)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,R(t,!1),0===t.strm.avail_out))return A;if(t.strstart-t.block_start>=t.w_size-T&&(R(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===c?(R(t,!0),0===t.strm.avail_out?D:O):(t.strstart>t.block_start&&(R(t,!1),t.strm.avail_out),A)}),new Y(4,4,8,4,G),new Y(4,5,16,8,G),new Y(4,6,32,32,G),new Y(4,4,16,16,X),new Y(8,16,32,32,X),new Y(8,16,128,128,X),new Y(8,32,128,256,X),new Y(32,128,258,1024,X),new Y(32,258,258,4096,X)],i.deflateInit=function(t,e){return H(t,e,v,15,8,0)},i.deflateInit2=H,i.deflateReset=Z,i.deflateResetKeep=j,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?f:(t.state.gzhead=e,u):f},i.deflate=function(t,e){var i,r,o,h;if(!t||!t.state||5<e||e<0)return t?L(t,f):f;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==c)return L(t,0===t.avail_out?-5:f);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===k)if(2===r.wrap)t.adler=0,F(r,31),F(r,139),F(r,8),r.gzhead?(F(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),F(r,255&r.gzhead.time),F(r,r.gzhead.time>>8&255),F(r,r.gzhead.time>>16&255),F(r,r.gzhead.time>>24&255),F(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),F(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(F(r,255&r.gzhead.extra.length),F(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=a(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(F(r,0),F(r,0),F(r,0),F(r,0),F(r,0),F(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),F(r,3),r.status=E);else{var d=v+(r.w_bits-8<<4)<<8;d|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(d|=32),d+=31-d%31,r.status=E,U(r,d),0!==r.strstart&&(U(r,t.adler>>>16),U(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),I(t),o=r.pending,r.pending!==r.pending_buf_size));)F(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),I(t),o=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,F(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),0===h&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),I(t),o=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,F(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),0===h&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&I(t),r.pending+2<=r.pending_buf_size&&(F(r,255&t.adler),F(r,t.adler>>8&255),t.adler=0,r.status=E)):r.status=E),0!==r.pending){if(I(t),0===t.avail_out)return r.last_flush=-1,u}else if(0===t.avail_in&&P(e)<=P(i)&&e!==c)return L(t,-5);if(666===r.status&&0!==t.avail_in)return L(t,-5);if(0!==t.avail_in||0!==r.lookahead||e!==l&&666!==r.status){var p=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(z(t),0===t.lookahead)){if(e===l)return A;break}if(t.match_length=0,i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(R(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===c?(R(t,!0),0===t.strm.avail_out?D:O):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?A:M}(r,e):3===r.strategy?function(t,e){for(var i,n,r,o,a=t.window;;){if(t.lookahead<=C){if(z(t),t.lookahead<=C&&e===l)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&0<t.strstart&&(n=a[r=t.strstart-1])===a[++r]&&n===a[++r]&&n===a[++r]){o=t.strstart+C;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<o);t.match_length=C-(o-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(i=s._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(R(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===c?(R(t,!0),0===t.strm.avail_out?D:O):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?A:M}(r,e):n[r.level].func(r,e);if(p!==D&&p!==O||(r.status=666),p===A||p===D)return 0===t.avail_out&&(r.last_flush=-1),u;if(p===M&&(1===e?s._tr_align(r):5!==e&&(s._tr_stored_block(r,0,0,!1),3===e&&(B(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),I(t),0===t.avail_out))return r.last_flush=-1,u}return e!==c?u:r.wrap<=0?1:(2===r.wrap?(F(r,255&t.adler),F(r,t.adler>>8&255),F(r,t.adler>>16&255),F(r,t.adler>>24&255),F(r,255&t.total_in),F(r,t.total_in>>8&255),F(r,t.total_in>>16&255),F(r,t.total_in>>24&255)):(U(r,t.adler>>>16),U(r,65535&t.adler)),I(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?u:1)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==k&&69!==e&&73!==e&&91!==e&&103!==e&&e!==E&&666!==e?L(t,f):(t.state=null,e===E?L(t,-3):u):f},i.deflateSetDictionary=function(t,e){var i,n,s,a,h,l,c,d,p=e.length;if(!t||!t.state)return f;if(2===(a=(i=t.state).wrap)||1===a&&i.status!==k||i.lookahead)return f;for(1===a&&(t.adler=o(t.adler,e,p,0)),i.wrap=0,p>=i.w_size&&(0===a&&(B(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new r.Buf8(i.w_size),r.arraySet(d,e,p-i.w_size,i.w_size,0),e=d,p=i.w_size),h=t.avail_in,l=t.next_in,c=t.input,t.avail_in=p,t.next_in=0,t.input=e,z(i);i.lookahead>=S;){for(n=i.strstart,s=i.lookahead-(S-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+S-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,--s;);i.strstart=n,i.lookahead=S-1,z(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=S-1,i.match_available=0,t.next_in=l,t.input=c,t.avail_in=h,i.wrap=a,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,i){"use strict";e.exports=function(t,e){var i,n,r,s,o,a,h,l,c,u,f,d,p,g,v,m,_,y,x,b,w,S,C,T,k;i=t.state,n=t.next_in,T=t.input,r=n+(t.avail_in-5),s=t.next_out,k=t.output,o=s-(e-t.avail_out),a=s+(t.avail_out-257),h=i.dmax,l=i.wsize,c=i.whave,u=i.wnext,f=i.window,d=i.hold,p=i.bits,g=i.lencode,v=i.distcode,m=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),y=g[d&m];e:for(;;){if(d>>>=x=y>>>24,p-=x,0==(x=y>>>16&255))k[s++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=g[(65535&y)+(d&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}b=65535&y,(x&=15)&&(p<x&&(d+=T[n++]<<p,p+=8),b+=d&(1<<x)-1,d>>>=x,p-=x),p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),y=v[d&_];i:for(;;){if(d>>>=x=y>>>24,p-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=v[(65535&y)+(d&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&y,p<(x&=15)&&(d+=T[n++]<<p,(p+=8)<x&&(d+=T[n++]<<p,p+=8)),h<(w+=d&(1<<x)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(d>>>=x,p-=x,(x=s-o)<w){if(c<(x=w-x)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(C=f,(S=0)===u){if(S+=l-x,x<b){for(b-=x;k[s++]=f[S++],--x;);S=s-w,C=k}}else if(u<x){if(S+=l+u-x,(x-=u)<b){for(b-=x;k[s++]=f[S++],--x;);if(S=0,u<b){for(b-=x=u;k[s++]=f[S++],--x;);S=s-w,C=k}}}else if(S+=u-x,x<b){for(b-=x;k[s++]=f[S++],--x;);S=s-w,C=k}for(;2<b;)k[s++]=C[S++],k[s++]=C[S++],k[s++]=C[S++],b-=3;b&&(k[s++]=C[S++],1<b&&(k[s++]=C[S++]))}else{for(S=s-w;k[s++]=k[S++],k[s++]=k[S++],k[s++]=k[S++],2<(b-=3););b&&(k[s++]=k[S++],1<b&&(k[s++]=k[S++]))}break}}break}}while(n<r&&s<a);n-=b=p>>3,d&=(1<<(p-=b<<3))-1,t.next_in=n,t.next_out=s,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=s<a?a-s+257:257-(s-a),i.hold=d,i.bits=p}},{}],49:[function(t,e,i){"use strict";var n=t("../utils/common"),r=t("./adler32"),s=t("./crc32"),o=t("./inffast"),a=t("./inftrees"),h=1,l=2,c=0,u=-2,f=1,d=852,p=592;function g(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function m(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=f,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(d),e.distcode=e.distdyn=new n.Buf32(p),e.sane=1,e.back=-1,c):u}function _(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,m(t)):u}function y(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?u:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,_(t))):u}function x(t,e){var i,n;return t?(n=new v,(t.state=n).window=null,(i=y(t,e))!==c&&(t.state=null),i):u}var b,w,S=!0;function C(t){if(S){var e;for(b=new n.Buf32(512),w=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(h,t.lens,0,288,b,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(l,t.lens,0,32,w,0,t.work,{bits:5}),S=!1}t.lencode=b,t.lenbits=9,t.distcode=w,t.distbits=5}function T(t,e,i,r){var s,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),r>=o.wsize?(n.arraySet(o.window,e,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r<(s=o.wsize-o.wnext)&&(s=r),n.arraySet(o.window,e,i-r,s,o.wnext),(r-=s)?(n.arraySet(o.window,e,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}i.inflateReset=_,i.inflateReset2=y,i.inflateResetKeep=m,i.inflateInit=function(t){return x(t,15)},i.inflateInit2=x,i.inflate=function(t,e){var i,d,p,v,m,_,y,x,b,w,S,k,E,A,M,D,O,L,P,B,I,R,F,U,N=0,z=new n.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return u;12===(i=t.state).mode&&(i.mode=13),m=t.next_out,p=t.output,y=t.avail_out,v=t.next_in,d=t.input,_=t.avail_in,x=i.hold,b=i.bits,w=_,S=y,R=c;t:for(;;)switch(i.mode){case f:if(0===i.wrap){i.mode=13;break}for(;b<16;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(2&i.wrap&&35615===x){z[i.check=0]=255&x,z[1]=x>>>8&255,i.check=s(i.check,z,2,0),b=x=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&x)<<8)+(x>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&x)){t.msg="unknown compression method",i.mode=30;break}if(b-=4,I=8+(15&(x>>>=4)),0===i.wbits)i.wbits=I;else if(I>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<I,t.adler=i.check=1,i.mode=512&x?10:12,b=x=0;break;case 2:for(;b<16;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(i.flags=x,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=x>>8&1),512&i.flags&&(z[0]=255&x,z[1]=x>>>8&255,i.check=s(i.check,z,2,0)),b=x=0,i.mode=3;case 3:for(;b<32;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}i.head&&(i.head.time=x),512&i.flags&&(z[0]=255&x,z[1]=x>>>8&255,z[2]=x>>>16&255,z[3]=x>>>24&255,i.check=s(i.check,z,4,0)),b=x=0,i.mode=4;case 4:for(;b<16;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}i.head&&(i.head.xflags=255&x,i.head.os=x>>8),512&i.flags&&(z[0]=255&x,z[1]=x>>>8&255,i.check=s(i.check,z,2,0)),b=x=0,i.mode=5;case 5:if(1024&i.flags){for(;b<16;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}i.length=x,i.head&&(i.head.extra_len=x),512&i.flags&&(z[0]=255&x,z[1]=x>>>8&255,i.check=s(i.check,z,2,0)),b=x=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(_<(k=i.length)&&(k=_),k&&(i.head&&(I=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,d,v,k,I)),512&i.flags&&(i.check=s(i.check,d,k,v)),_-=k,v+=k,i.length-=k),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===_)break t;for(k=0;I=d[v+k++],i.head&&I&&i.length<65536&&(i.head.name+=String.fromCharCode(I)),I&&k<_;);if(512&i.flags&&(i.check=s(i.check,d,k,v)),_-=k,v+=k,I)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===_)break t;for(k=0;I=d[v+k++],i.head&&I&&i.length<65536&&(i.head.comment+=String.fromCharCode(I)),I&&k<_;);if(512&i.flags&&(i.check=s(i.check,d,k,v)),_-=k,v+=k,I)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;b<16;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(x!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}b=x=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;b<32;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}t.adler=i.check=g(x),b=x=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=m,t.avail_out=y,t.next_in=v,t.avail_in=_,i.hold=x,i.bits=b,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){x>>>=7&b,b-=7&b,i.mode=27;break}for(;b<3;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}switch(i.last=1&x,b-=1,3&(x>>>=1)){case 0:i.mode=14;break;case 1:if(C(i),i.mode=20,6!==e)break;x>>>=2,b-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}x>>>=2,b-=2;break;case 14:for(x>>>=7&b,b-=7&b;b<32;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if((65535&x)!=(x>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&x,b=x=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(k=i.length){if(_<k&&(k=_),y<k&&(k=y),0===k)break t;n.arraySet(p,d,v,k,m),_-=k,v+=k,y-=k,m+=k,i.length-=k;break}i.mode=12;break;case 17:for(;b<14;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(i.nlen=257+(31&x),x>>>=5,b-=5,i.ndist=1+(31&x),x>>>=5,b-=5,i.ncode=4+(15&x),x>>>=4,b-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;b<3;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}i.lens[G[i.have++]]=7&x,x>>>=3,b-=3}for(;i.have<19;)i.lens[G[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,F={bits:i.lenbits},R=a(0,i.lens,0,19,i.lencode,0,i.work,F),i.lenbits=F.bits,R){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;D=(N=i.lencode[x&(1<<i.lenbits)-1])>>>16&255,O=65535&N,!((M=N>>>24)<=b);){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(O<16)x>>>=M,b-=M,i.lens[i.have++]=O;else{if(16===O){for(U=M+2;b<U;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(x>>>=M,b-=M,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}I=i.lens[i.have-1],k=3+(3&x),x>>>=2,b-=2}else if(17===O){for(U=M+3;b<U;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}b-=M,I=0,k=3+(7&(x>>>=M)),x>>>=3,b-=3}else{for(U=M+7;b<U;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}b-=M,I=0,k=11+(127&(x>>>=M)),x>>>=7,b-=7}if(i.have+k>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;k--;)i.lens[i.have++]=I}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,F={bits:i.lenbits},R=a(h,i.lens,0,i.nlen,i.lencode,0,i.work,F),i.lenbits=F.bits,R){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,F={bits:i.distbits},R=a(l,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,F),i.distbits=F.bits,R){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=_&&258<=y){t.next_out=m,t.avail_out=y,t.next_in=v,t.avail_in=_,i.hold=x,i.bits=b,o(t,S),m=t.next_out,p=t.output,y=t.avail_out,v=t.next_in,d=t.input,_=t.avail_in,x=i.hold,b=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;D=(N=i.lencode[x&(1<<i.lenbits)-1])>>>16&255,O=65535&N,!((M=N>>>24)<=b);){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(D&&0==(240&D)){for(L=M,P=D,B=O;D=(N=i.lencode[B+((x&(1<<L+P)-1)>>L)])>>>16&255,O=65535&N,!(L+(M=N>>>24)<=b);){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}x>>>=L,b-=L,i.back+=L}if(x>>>=M,b-=M,i.back+=M,i.length=O,0===D){i.mode=26;break}if(32&D){i.back=-1,i.mode=12;break}if(64&D){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&D,i.mode=22;case 22:if(i.extra){for(U=i.extra;b<U;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}i.length+=x&(1<<i.extra)-1,x>>>=i.extra,b-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;D=(N=i.distcode[x&(1<<i.distbits)-1])>>>16&255,O=65535&N,!((M=N>>>24)<=b);){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(0==(240&D)){for(L=M,P=D,B=O;D=(N=i.distcode[B+((x&(1<<L+P)-1)>>L)])>>>16&255,O=65535&N,!(L+(M=N>>>24)<=b);){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}x>>>=L,b-=L,i.back+=L}if(x>>>=M,b-=M,i.back+=M,64&D){t.msg="invalid distance code",i.mode=30;break}i.offset=O,i.extra=15&D,i.mode=24;case 24:if(i.extra){for(U=i.extra;b<U;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}i.offset+=x&(1<<i.extra)-1,x>>>=i.extra,b-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===y)break t;if(k=S-y,i.offset>k){if((k=i.offset-k)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}E=k>i.wnext?(k-=i.wnext,i.wsize-k):i.wnext-k,k>i.length&&(k=i.length),A=i.window}else A=p,E=m-i.offset,k=i.length;for(y<k&&(k=y),y-=k,i.length-=k;p[m++]=A[E++],--k;);0===i.length&&(i.mode=21);break;case 26:if(0===y)break t;p[m++]=i.length,y--,i.mode=21;break;case 27:if(i.wrap){for(;b<32;){if(0===_)break t;_--,x|=d[v++]<<b,b+=8}if(S-=y,t.total_out+=S,i.total+=S,S&&(t.adler=i.check=i.flags?s(i.check,p,S,m-S):r(i.check,p,S,m-S)),S=y,(i.flags?x:g(x))!==i.check){t.msg="incorrect data check",i.mode=30;break}b=x=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;b<32;){if(0===_)break t;_--,x+=d[v++]<<b,b+=8}if(x!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}b=x=0}i.mode=29;case 29:R=1;break t;case 30:R=-3;break t;case 31:return-4;case 32:default:return u}return t.next_out=m,t.avail_out=y,t.next_in=v,t.avail_in=_,i.hold=x,i.bits=b,(i.wsize||S!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&T(t,t.output,t.next_out,S-t.avail_out)?(i.mode=31,-4):(w-=t.avail_in,S-=t.avail_out,t.total_in+=w,t.total_out+=S,i.total+=S,i.wrap&&S&&(t.adler=i.check=i.flags?s(i.check,p,S,t.next_out-S):r(i.check,p,S,t.next_out-S)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==w&&0===S||4===e)&&R===c&&(R=-5),R)},i.inflateEnd=function(t){if(!t||!t.state)return u;var e=t.state;return e.window&&(e.window=null),t.state=null,c},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?u:((i.head=e).done=!1,c):u},i.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?u:11===i.mode&&r(1,e,n,0)!==i.check?-3:T(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,c):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,i){"use strict";var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,h,l,c,u,f){var d,p,g,v,m,_,y,x,b,w=f.bits,S=0,C=0,T=0,k=0,E=0,A=0,M=0,D=0,O=0,L=0,P=null,B=0,I=new n.Buf16(16),R=new n.Buf16(16),F=null,U=0;for(S=0;S<=15;S++)I[S]=0;for(C=0;C<h;C++)I[e[i+C]]++;for(E=w,k=15;1<=k&&0===I[k];k--);if(k<E&&(E=k),0===k)return l[c++]=20971520,l[c++]=20971520,f.bits=1,0;for(T=1;T<k&&0===I[T];T++);for(E<T&&(E=T),S=D=1;S<=15;S++)if(D<<=1,(D-=I[S])<0)return-1;if(0<D&&(0===t||1!==k))return-1;for(R[1]=0,S=1;S<15;S++)R[S+1]=R[S]+I[S];for(C=0;C<h;C++)0!==e[i+C]&&(u[R[e[i+C]]++]=C);if(_=0===t?(P=F=u,19):1===t?(P=r,B-=257,F=s,U-=257,256):(P=o,F=a,-1),S=T,m=c,M=C=L=0,g=-1,v=(O=1<<(A=E))-1,1===t&&852<O||2===t&&592<O)return 1;for(;;){for(y=S-M,b=u[C]<_?(x=0,u[C]):u[C]>_?(x=F[U+u[C]],P[B+u[C]]):(x=96,0),d=1<<S-M,T=p=1<<A;l[m+(L>>M)+(p-=d)]=y<<24|x<<16|b|0,0!==p;);for(d=1<<S-1;L&d;)d>>=1;if(0!==d?(L&=d-1,L+=d):L=0,C++,0==--I[S]){if(S===k)break;S=e[i+u[C]]}if(E<S&&(L&v)!==g){for(0===M&&(M=E),m+=T,D=1<<(A=S-M);A+M<k&&!((D-=I[A+M])<=0);)A++,D<<=1;if(O+=1<<A,1===t&&852<O||2===t&&592<O)return 1;l[g=L&v]=E<<24|A<<16|m-c|0}}return 0!==L&&(l[m+L]=S-M<<24|64<<16|0),f.bits=E,0}},{"../utils/common":41}],51:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,i){"use strict";var n=t("../utils/common");function r(t){for(var e=t.length;0<=--e;)t[e]=0}var s=0,o=256,a=o+1+29,h=30,l=19,c=2*a+1,u=15,f=16,d=256,p=16,g=17,v=18,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=new Array(2*(a+2));r(b);var w=new Array(2*h);r(w);var S=new Array(512);r(S);var C=new Array(256);r(C);var T=new Array(29);r(T);var k,E,A,M=new Array(h);function D(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function O(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function L(t){return t<256?S[t]:S[256+(t>>>7)]}function P(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function B(t,e,i){t.bi_valid>f-i?(t.bi_buf|=e<<t.bi_valid&65535,P(t,t.bi_buf),t.bi_buf=e>>f-t.bi_valid,t.bi_valid+=i-f):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function I(t,e,i){B(t,i[2*e],i[2*e+1])}function R(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function F(t,e,i){var n,r,s=new Array(u+1),o=0;for(n=1;n<=u;n++)s[n]=o=o+i[n-1]<<1;for(r=0;r<=e;r++){var a=t[2*r+1];0!==a&&(t[2*r]=R(s[a]++,a))}}function U(t){var e;for(e=0;e<a;e++)t.dyn_ltree[2*e]=0;for(e=0;e<h;e++)t.dyn_dtree[2*e]=0;for(e=0;e<l;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*d]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function N(t){8<t.bi_valid?P(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function z(t,e,i,n){var r=2*e,s=2*i;return t[r]<t[s]||t[r]===t[s]&&n[e]<=n[i]}function G(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&z(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!z(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function X(t,e,i){var n,r,s,a,h=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===n?I(t,r,e):(I(t,(s=C[r])+o+1,e),0!==(a=m[s])&&B(t,r-=T[s],a),I(t,s=L(--n),i),0!==(a=_[s])&&B(t,n-=M[s],a)),h<t.last_lit;);I(t,d,e)}function Y(t,e){var i,n,r,s=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,h=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=c,i=0;i<h;i++)0!==s[2*i]?(t.heap[++t.heap_len]=l=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)s[2*(r=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[r]=0,t.opt_len--,a&&(t.static_len-=o[2*r+1]);for(e.max_code=l,i=t.heap_len>>1;1<=i;i--)G(t,s,i);for(r=h;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],G(t,s,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,s[2*r]=s[2*i]+s[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,s[2*i+1]=s[2*n+1]=r,t.heap[1]=r++,G(t,s,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,s,o,a,h=e.dyn_tree,l=e.max_code,f=e.stat_desc.static_tree,d=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,g=e.stat_desc.extra_base,v=e.stat_desc.max_length,m=0;for(s=0;s<=u;s++)t.bl_count[s]=0;for(h[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<c;i++)v<(s=h[2*h[2*(n=t.heap[i])+1]+1]+1)&&(s=v,m++),h[2*n+1]=s,l<n||(t.bl_count[s]++,o=0,g<=n&&(o=p[n-g]),a=h[2*n],t.opt_len+=a*(s+o),d&&(t.static_len+=a*(f[2*n+1]+o)));if(0!==m){do{for(s=v-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[v]--,m-=2}while(0<m);for(s=v;0!==s;s--)for(n=t.bl_count[s];0!==n;)l<(r=t.heap[--i])||(h[2*r+1]!==s&&(t.opt_len+=(s-h[2*r+1])*h[2*r],h[2*r+1]=s),n--)}}(t,e),F(s,l,t.bl_count)}function W(t,e,i){var n,r,s=-1,o=e[1],a=0,h=7,l=4;for(0===o&&(h=138,l=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=o,o=e[2*(n+1)+1],++a<h&&r===o||(a<l?t.bl_tree[2*r]+=a:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[2*p]++):a<=10?t.bl_tree[2*g]++:t.bl_tree[2*v]++,s=r,l=(a=0)===o?(h=138,3):r===o?(h=6,3):(h=7,4))}function j(t,e,i){var n,r,s=-1,o=e[1],a=0,h=7,l=4;for(0===o&&(h=138,l=3),n=0;n<=i;n++)if(r=o,o=e[2*(n+1)+1],!(++a<h&&r===o)){if(a<l)for(;I(t,r,t.bl_tree),0!=--a;);else 0!==r?(r!==s&&(I(t,r,t.bl_tree),a--),I(t,p,t.bl_tree),B(t,a-3,2)):a<=10?(I(t,g,t.bl_tree),B(t,a-3,3)):(I(t,v,t.bl_tree),B(t,a-11,7));s=r,l=(a=0)===o?(h=138,3):r===o?(h=6,3):(h=7,4)}}r(M);var Z=!1;function H(t,e,i,r){B(t,(s<<1)+(r?1:0),3),function(t,e,i,r){N(t),P(t,i),P(t,~i),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}i._tr_init=function(t){Z||(function(){var t,e,i,n,r,s=new Array(u+1);for(n=i=0;n<28;n++)for(T[n]=i,t=0;t<1<<m[n];t++)C[i++]=n;for(C[i-1]=n,n=r=0;n<16;n++)for(M[n]=r,t=0;t<1<<_[n];t++)S[r++]=n;for(r>>=7;n<h;n++)for(M[n]=r<<7,t=0;t<1<<_[n]-7;t++)S[256+r++]=n;for(e=0;e<=u;e++)s[e]=0;for(t=0;t<=143;)b[2*t+1]=8,t++,s[8]++;for(;t<=255;)b[2*t+1]=9,t++,s[9]++;for(;t<=279;)b[2*t+1]=7,t++,s[7]++;for(;t<=287;)b[2*t+1]=8,t++,s[8]++;for(F(b,a+1,s),t=0;t<h;t++)w[2*t+1]=5,w[2*t]=R(t,5);k=new D(b,m,o+1,a,u),E=new D(w,_,0,h,u),A=new D(new Array(0),y,0,l,7)}(),Z=!0),t.l_desc=new O(t.dyn_ltree,k),t.d_desc=new O(t.dyn_dtree,E),t.bl_desc=new O(t.bl_tree,A),t.bi_buf=0,t.bi_valid=0,U(t)},i._tr_stored_block=H,i._tr_flush_block=function(t,e,i,n){var r,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<o;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),Y(t,t.l_desc),Y(t,t.d_desc),a=function(t){var e;for(W(t,t.dyn_ltree,t.l_desc.max_code),W(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),e=l-1;3<=e&&0===t.bl_tree[2*x[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=r&&(r=s)):r=s=i+5,i+4<=r&&-1!==e?H(t,e,i,n):4===t.strategy||s===r?(B(t,2+(n?1:0),3),X(t,b,w)):(B(t,4+(n?1:0),3),function(t,e,i,n){var r;for(B(t,e-257,5),B(t,i-1,5),B(t,n-4,4),r=0;r<n;r++)B(t,t.bl_tree[2*x[r]+1],3);j(t,t.dyn_ltree,e-1),j(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),X(t,t.dyn_ltree,t.dyn_dtree)),U(t),n&&N(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(C[i]+o+1)]++,t.dyn_dtree[2*L(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){B(t,2,3),I(t,d,b),function(t){16===t.bi_valid?(P(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,i){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)});var LZString=function(){function t(t,e){if(!r[t]){r[t]={};for(var i=0;i<t.length;i++)r[t][t.charAt(i)]=i}return r[t][e]}var e=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},s={compressToBase64:function(t){if(null==t)return"";var e=s._compress(t,6,function(t){return i.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:s._decompress(e.length,32,function(n){return t(i,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":s._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:s._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=s.compress(t),i=new Uint8Array(2*e.length),n=0,r=e.length;r>n;n++){var o=e.charCodeAt(n);i[2*n]=o>>>8,i[2*n+1]=o%256}return i},decompressFromUint8Array:function(t){if(null==t)return s.decompress(t);for(var i=new Array(t.length/2),n=0,r=i.length;r>n;n++)i[n]=256*t[2*n]+t[2*n+1];var o=[];return i.forEach(function(t){o.push(e(t))}),s.decompress(o.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":s._compress(t,6,function(t){return n.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),s._decompress(e.length,32,function(i){return t(n,e.charAt(i))}))},compress:function(t){return s._compress(t,16,function(t){return e(t)})},_compress:function(t,e,i){if(null==t)return"";var n,r,s,o={},a={},h="",l="",c="",u=2,f=3,d=2,p=[],g=0,v=0;for(s=0;s<t.length;s+=1)if(h=t.charAt(s),Object.prototype.hasOwnProperty.call(o,h)||(o[h]=f++,a[h]=!0),l=c+h,Object.prototype.hasOwnProperty.call(o,l))c=l;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(n=0;d>n;n++)g<<=1,v==e-1?(v=0,p.push(i(g)),g=0):v++;for(r=c.charCodeAt(0),n=0;8>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1}else{for(r=1,n=0;d>n;n++)g=g<<1|r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r=0;for(r=c.charCodeAt(0),n=0;16>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1}0==--u&&(u=Math.pow(2,d),d++),delete a[c]}else for(r=o[c],n=0;d>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1;0==--u&&(u=Math.pow(2,d),d++),o[l]=f++,c=String(h)}if(""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(n=0;d>n;n++)g<<=1,v==e-1?(v=0,p.push(i(g)),g=0):v++;for(r=c.charCodeAt(0),n=0;8>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1}else{for(r=1,n=0;d>n;n++)g=g<<1|r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r=0;for(r=c.charCodeAt(0),n=0;16>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1}0==--u&&(u=Math.pow(2,d),d++),delete a[c]}else for(r=o[c],n=0;d>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1;0==--u&&(u=Math.pow(2,d),d++)}for(r=2,n=0;d>n;n++)g=g<<1|1&r,v==e-1?(v=0,p.push(i(g)),g=0):v++,r>>=1;for(;;){if(g<<=1,v==e-1){p.push(i(g));break}v++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:s._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,i,n){var r,s,o,a,h,l,c,u=[],f=4,d=4,p=3,g="",v=[],m={val:n(0),position:i,index:1};for(r=0;3>r;r+=1)u[r]=r;for(o=0,h=Math.pow(2,2),l=1;l!=h;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=n(m.index++)),o|=(a>0?1:0)*l,l<<=1;switch(o){case 0:for(o=0,h=Math.pow(2,8),l=1;l!=h;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=n(m.index++)),o|=(a>0?1:0)*l,l<<=1;c=e(o);break;case 1:for(o=0,h=Math.pow(2,16),l=1;l!=h;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=n(m.index++)),o|=(a>0?1:0)*l,l<<=1;c=e(o);break;case 2:return""}for(u[3]=c,s=c,v.push(c);;){if(m.index>t)return"";for(o=0,h=Math.pow(2,p),l=1;l!=h;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=n(m.index++)),o|=(a>0?1:0)*l,l<<=1;switch(c=o){case 0:for(o=0,h=Math.pow(2,8),l=1;l!=h;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=n(m.index++)),o|=(a>0?1:0)*l,l<<=1;u[d++]=e(o),c=d-1,f--;break;case 1:for(o=0,h=Math.pow(2,16),l=1;l!=h;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=n(m.index++)),o|=(a>0?1:0)*l,l<<=1;u[d++]=e(o),c=d-1,f--;break;case 2:return v.join("")}if(0==f&&(f=Math.pow(2,p),p++),u[c])g=u[c];else{if(c!==d)return null;g=s+s.charAt(0)}v.push(g),u[d++]=s+g.charAt(0),s=g,0==--f&&(f=Math.pow(2,p),p++)}}};return s}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString),function(){var t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v2.2.8",t.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},t.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},t._UID=0,"undefined"!=typeof Float32Array?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array,t.Uint32Array=Uint32Array,t.ArrayBuffer=ArrayBuffer):(t.Float32Array=Array,t.Uint16Array=Array),t.INTERACTION_FREQUENCY=30,t.AUTO_PREVENT_DEFAULT=!0,t.PI_2=2*Math.PI,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RETINA_PREFIX="@2x",t.dontSayHello=!1,t.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},t.sayHello=function(e){if(!t.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+t.VERSION+" - "+e+"  %c  %c  http://www.pixijs.com/  %c %c %c%c ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+t.VERSION+" - http://www.pixijs.com/");t.dontSayHello=!0}},t.Point=function(t,e){this.x=t||0,this.y=e||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},t.Point.prototype.constructor=t.Point,t.Rectangle=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1},t.Rectangle.prototype.constructor=t.Rectangle,t.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),e[0]instanceof t.Point){for(var i=[],n=0,r=e.length;n<r;n++)i.push(e[n].x,e[n].y);e=i}this.closed=!0,this.points=e},t.Polygon.prototype.clone=function(){var e=this.points.slice();return new t.Polygon(e)},t.Polygon.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,r=0,s=n-1;r<n;s=r++){var o=this.points[2*r],a=this.points[2*r+1],h=this.points[2*s],l=this.points[2*s+1];a>e!=l>e&&t<(h-o)*(e-a)/(l-a)+o&&(i=!i)}return i},t.Polygon.prototype.constructor=t.Polygon,t.Circle=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0},t.Circle.prototype.clone=function(){return new t.Circle(this.x,this.y,this.radius)},t.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,n=this.y-e;return(i*=i)+(n*=n)<=this.radius*this.radius},t.Circle.prototype.getBounds=function(){return new t.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t.Circle.prototype.constructor=t.Circle,t.Ellipse=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},t.Ellipse.prototype.clone=function(){return new t.Ellipse(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return(i*=i)+(n*=n)<=1},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},t.Ellipse.prototype.constructor=t.Ellipse,t.RoundedRectangle=function(t,e,i,n,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.radius=r||20},t.RoundedRectangle.prototype.clone=function(){return new t.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},t.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1},t.RoundedRectangle.prototype.constructor=t.RoundedRectangle,t.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},t.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.Matrix.prototype.toArray=function(e){this.array||(this.array=new t.Float32Array(9));var i=this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},t.Matrix.prototype.apply=function(e,i){return(i=i||new t.Point).x=this.a*e.x+this.c*e.y+this.tx,i.y=this.b*e.x+this.d*e.y+this.ty,i},t.Matrix.prototype.applyInverse=function(e,i){i=i||new t.Point;var n=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*n*e.x+-this.c*n*e.y+(this.ty*this.c-this.tx*this.d)*n,i.y=this.a*n*e.y+-this.b*n*e.x+(-this.ty*this.a+this.tx*this.b)*n,i},t.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this},t.Matrix.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},t.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.identityMatrix=new t.Matrix,t.DisplayObject=function(){this.position=new t.Point,this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new t.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],i=0;i<t.length;i++)for(var n=t[i].passes,r=0;r<n.length;r++)e.push(n[r]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),t.DisplayObject.prototype.updateTransform=function(){var e,i,n,r,s,o,a=this.parent.worldTransform,h=this.worldTransform;this.rotation%t.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,i=this._sr*this.scale.x,n=-this._sr*this.scale.y,r=this._cr*this.scale.y,s=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*e+this.pivot.y*n,o-=this.pivot.x*i+this.pivot.y*r),h.a=e*a.a+i*a.c,h.b=e*a.b+i*a.d,h.c=n*a.a+r*a.c,h.d=n*a.b+r*a.d,h.tx=s*a.a+o*a.c+a.tx,h.ty=s*a.b+o*a.d+a.ty):(e=this.scale.x,r=this.scale.y,s=this.position.x-this.pivot.x*e,o=this.position.y-this.pivot.y*r,h.a=e*a.a,h.b=e*a.b,h.c=r*a.c,h.d=r*a.d,h.tx=s*a.a+o*a.c+a.tx,h.ty=s*a.b+o*a.d+a.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.DisplayObject.prototype.displayObjectUpdateTransform=t.DisplayObject.prototype.updateTransform,t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0)},t.DisplayObject.prototype.generateTexture=function(e,i,n){var r=this.getLocalBounds(),s=new t.RenderTexture(0|r.width,0|r.height,n,i,e);return t.DisplayObject._tempMatrix.tx=-r.x,t.DisplayObject._tempMatrix.ty=-r.y,s.render(this,t.DisplayObject._tempMatrix),s},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},t.DisplayObject.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|e.width,0|e.height);else{var i=new t.RenderTexture(0|e.width,0|e.height);this._cachedSprite=new t.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var n=this._filters;this._filters=null,this._cachedSprite.filters=n,t.DisplayObject._tempMatrix.tx=-e.x,t.DisplayObject._tempMatrix.ty=-e.y,this._cachedSprite.texture.render(this,t.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._filters=n,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},t.DisplayObject.prototype._renderWebGL=function(t){t=t},t.DisplayObject.prototype._renderCanvas=function(t){t=t},t.DisplayObject._tempMatrix=new t.Matrix,Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),t.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(i<0||n<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},t.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},t.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},t.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},t.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},t.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},t.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,n="number"==typeof e?e:this.children.length,r=n-i;if(r>0&&r<=n){for(var s=this.children.splice(i,r),o=0;o<s.length;o++){var a=s[o];this.stage&&a.removeStageReference(),a.parent=void 0}return s}if(0===r&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},t.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=t.DisplayObjectContainer.prototype.updateTransform,t.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return t.EmptyRectangle;for(var e,i,n,r=1/0,s=1/0,o=-1/0,a=-1/0,h=!1,l=0,c=this.children.length;l<c;l++)this.children[l].visible&&(h=!0,r=r<(e=this.children[l].getBounds()).x?r:e.x,s=s<e.y?s:e.y,o=o>(i=e.width+e.x)?o:i,a=a>(n=e.height+e.y)?a:n);if(!h)return t.EmptyRectangle;var u=this._bounds;return u.x=r,u.y=s,u.width=o-r,u.height=a-s,u},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var i=0,n=this.children.length;i<n;i++)this.children[i].updateTransform();var r=this.getBounds();return this.worldTransform=e,r},t.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0);for(var e=0,i=this.children.length;e<i;e++)this.children[e].setStageReference(t)},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;t<e;t++)this.children[t].removeStageReference();this._interactive&&(this.stage.dirty=!0),this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t)},t.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;e<i;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e||t.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),t.Sprite.prototype.setTexture=function(t){this.texture=t,this.cachedTint=16777215},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,s=i*(1-this.anchor.y),o=i*-this.anchor.y,a=t||this.worldTransform,h=a.a,l=a.b,c=a.c,u=a.d,f=a.tx,d=a.ty,p=-1/0,g=-1/0,v=1/0,m=1/0;if(0===l&&0===c)h<0&&(h*=-1),u<0&&(u*=-1),v=h*r+f,p=h*n+f,m=u*o+d,g=u*s+d;else{var _=h*r+c*o+f,y=u*o+l*r+d,x=h*n+c*o+f,b=u*o+l*n+d,w=h*n+c*s+f,S=u*s+l*n+d,C=h*r+c*s+f,T=u*s+l*r+d;v=C<(v=w<(v=x<(v=_<v?_:v)?x:v)?w:v)?C:v,m=T<(m=S<(m=b<(m=y<m?y:m)?b:m)?S:m)?T:m,p=C>(p=w>(p=x>(p=_>p?_:p)?x:p)?w:p)?C:p,g=T>(g=S>(g=b>(g=y>g?y:g)?b:g)?S:g)?T:g}var k=this._bounds;return k.x=v,k.width=p-v,k.y=m,k.height=g-m,this._currentBounds=k,k},t.Sprite.prototype._renderWebGL=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){var n=t.spriteBatch;for(this._filters&&(n.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.stop(),t.maskManager.pushMask(this.mask,t),n.start()),n.render(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);n.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),n.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t)},t.Sprite.prototype._renderCanvas=function(e){if(!(!1===this.visible||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e),this.texture.valid){var i=this.texture.baseTexture.resolution/e.resolution;e.context.globalAlpha=this.worldAlpha,e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;e.roundPixels?(e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution|0,this.worldTransform.ty*e.resolution|0),n|=0,r|=0):e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution,this.worldTransform.ty*e.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,n/i,r/i,this.texture.crop.width/i,this.texture.crop.height/i)):e.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n/i,r/i,this.texture.crop.width/i,this.texture.crop.height/i)}for(var s=0,o=this.children.length;s<o;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Sprite.fromFrame=function(e){var i=t.TextureCache[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(i)},t.Sprite.fromImage=function(e,i,n){var r=t.Texture.fromImage(e,i,n);return new t.Sprite(r)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},t.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},t.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,n=!0,r=0;r<this.children.length;r++){var s=this.children[r];if(s.visible){var o=s.texture,a=o.frame;if(e.globalAlpha=this.worldAlpha*s.alpha,s.rotation%(2*Math.PI)==0)n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),e.drawImage(o.baseTexture.source,a.x,a.y,a.width,a.height,s.anchor.x*(-a.width*s.scale.x)+s.position.x+.5|0,s.anchor.y*(-a.height*s.scale.y)+s.position.y+.5|0,a.width*s.scale.x,a.height*s.scale.y);else{n||(n=!0),s.displayObjectUpdateTransform();var h=s.worldTransform;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,0|h.tx,0|h.ty):e.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty),e.drawImage(o.baseTexture.source,a.x,a.y,a.width,a.height,s.anchor.x*-a.width+.5|0,s.anchor.y*-a.height+.5|0,a.width,a.height)}}}}},t.MovieClip=function(e){t.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},t.MovieClip.prototype=Object.create(t.Sprite.prototype),t.MovieClip.prototype.constructor=t.MovieClip,Object.defineProperty(t.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),t.MovieClip.prototype.stop=function(){this.playing=!1},t.MovieClip.prototype.play=function(){this.playing=!0},t.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])},t.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},t.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},t.MovieClip.fromFrames=function(e){for(var i=[],n=0;n<e.length;n++)i.push(new t.Texture.fromFrame(e[n]));return new t.MovieClip(i)},t.MovieClip.fromImages=function(e){for(var i=[],n=0;n<e.length;n++)i.push(new t.Texture.fromImage(e[n]));return new t.MovieClip(i)},t.FilterBlock=function(){this.visible=!0,this.renderable=!0},t.FilterBlock.prototype.constructor=t.FilterBlock,t.Text=function(e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(i)},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),t.Text.prototype.setStyle=function(t){(t=t||{}).font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black",t.lineJoin=t.lineJoin||"miter",this.style=t,this.dirty=!0},t.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,r=this.determineFontProperties(this.style.font),s=0;s<e.length;s++){var o=this.context.measureText(e[s]).width;i[s]=o,n=Math.max(n,o)}var a=n+this.style.strokeThickness;this.style.dropShadow&&(a+=this.style.dropShadowDistance),this.canvas.width=(a+this.context.lineWidth)*this.resolution;var h,l,c=r.fontSize+this.style.strokeThickness,u=c*e.length;if(this.style.dropShadow&&(u+=this.style.dropShadowDistance),this.canvas.height=u*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin=this.style.lineJoin,this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var f=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,d=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(s=0;s<e.length;s++)h=this.style.strokeThickness/2,l=this.style.strokeThickness/2+s*c+r.ascent,"right"===this.style.align?h+=n-i[s]:"center"===this.style.align&&(h+=(n-i[s])/2),this.style.fill&&this.context.fillText(e[s],h+f,l+d)}for(this.context.fillStyle=this.style.fill,s=0;s<e.length;s++)h=this.style.strokeThickness/2,l=this.style.strokeThickness/2+s*c+r.ascent,"right"===this.style.align?h+=n-i[s]:"center"===this.style.align&&(h+=(n-i[s])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[s],h,l),this.style.fill&&this.context.fillText(e[s],h,l);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},t.Text.prototype._renderWebGL=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype._renderCanvas=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderCanvas.call(this,e)},t.Text.prototype.determineFontProperties=function(e){var i=t.Text.fontPropertiesCache[e];if(!i){i={};var n=t.Text.fontPropertiesCanvas,r=t.Text.fontPropertiesContext;r.font=e;var s=Math.ceil(r.measureText("|Mq").width),o=Math.ceil(r.measureText("M").width),a=2*o;o=1.4*o|0,n.width=s,n.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|Mq",0,o);var h,l,c=r.getImageData(0,0,s,a).data,u=c.length,f=4*s,d=0,p=!1;for(h=0;h<o;h++){for(l=0;l<f;l+=4)if(255!==c[d+l]){p=!0;break}if(p)break;d+=f}for(i.ascent=o-h,d=u-f,p=!1,h=a;h>o;h--){for(l=0;l<f;l+=4)if(255!==c[d+l]){p=!0;break}if(p)break;d-=f}i.descent=h-o,i.descent+=6,i.fontSize=i.ascent+i.descent,t.Text.fontPropertiesCache[e]=i}return i},t.Text.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var r=this.style.wordWrapWidth,s=i[n].split(" "),o=0;o<s.length;o++){var a=this.context.measureText(s[o]).width,h=a+this.context.measureText(" ").width;0===o||h>r?(o>0&&(e+="\n"),e+=s[o],r=this.style.wordWrapWidth-a):(r-=h,e+=" "+s[o])}n<i.length-1&&(e+="\n")}return e},t.Text.prototype.getBounds=function(e){return this.dirty&&(this.updateText(),this.dirty=!1),t.Sprite.prototype.getBounds.call(this,e)},t.Text.prototype.destroy=function(t){this.context=null,this.canvas=null,this.texture.destroy(void 0===t||t)},t.Text.fontPropertiesCache={},t.Text.fontPropertiesCanvas=document.createElement("canvas"),t.Text.fontPropertiesContext=t.Text.fontPropertiesCanvas.getContext("2d"),t.BitmapText=function(e,i){t.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(e),this.setStyle(i),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){(e=e||{}).align=e.align||"left",this.style=e;var i=e.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){for(var e=t.BitmapText.fonts[this.fontName],i=new t.Point,n=null,r=[],s=0,o=[],a=0,h=this.fontSize/e.size,l=0;l<this.text.length;l++){var c=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))o.push(i.x),s=Math.max(s,i.x),a++,i.x=0,i.y+=e.lineHeight,n=null;else{var u=e.chars[c];u&&(n&&u.kerning[n]&&(i.x+=u.kerning[n]),r.push({texture:u.texture,line:a,charCode:c,position:new t.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,n=c)}}o.push(i.x),s=Math.max(s,i.x);var f=[];for(l=0;l<=a;l++){var d=0;"right"===this.style.align?d=s-o[l]:"center"===this.style.align&&(d=(s-o[l])/2),f.push(d)}var p=this.children.length,g=r.length,v=this.tint||16777215;for(l=0;l<g;l++){var m=l<p?this.children[l]:this._pool.pop();m?m.setTexture(r[l].texture):m=new t.Sprite(r[l].texture),m.position.x=(r[l].position.x+f[r[l].line])*h,m.position.y=r[l].position.y*h,m.scale.x=m.scale.y=h,m.tint=v,m.parent||this.addChild(m)}for(;this.children.length>g;){var _=this.getChildAt(this.children.length-1);this._pool.push(_),this.removeChild(_)}this.textWidth=s*h,this.textHeight=(i.y+e.lineHeight)*h},t.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.InteractionData=function(){this.global=new t.Point,this.target=null,this.originalEvent=null},t.InteractionData.prototype.getLocalPosition=function(e,i,n){var r=e.worldTransform,s=n||this.global,o=r.a,a=r.c,h=r.tx,l=r.b,c=r.d,u=r.ty,f=1/(o*c+a*-l);return(i=i||new t.Point).x=c*f*s.x+-a*f*s.y+(u*a-h*c)*f,i.y=o*f*s.y+-l*f*s.x+(-u*o+h*l)*f,i},t.InteractionData.prototype.constructor=t.InteractionData,t.InteractionManager=function(e){this.stage=e,this.mouse=new t.InteractionData,this.touches={},this.tempPoint=new t.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new t.Point},t.InteractionManager.prototype.constructor=t.InteractionManager,t.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,n=i.length-1;n>=0;n--){var r=i[n];r._interactive?(e.interactiveChildren=!0,this.interactiveItems.push(r),r.children.length>0&&this.collectInteractiveSprite(r,r)):(r.__iParent=null,r.children.length>0&&this.collectInteractiveSprite(r,e))}},t.InteractionManager.prototype.setTarget=function(t){this.target=t,this.resolution=t.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(t.view)},t.InteractionManager.prototype.setTargetDomElement=function(t){this.removeEvents(),window.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none"),this.interactionDOMElement=t,t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseout",this.onMouseOut,!0),t.addEventListener("touchstart",this.onTouchStart,!0),t.addEventListener("touchend",this.onTouchEnd,!0),t.addEventListener("touchleave",this.onTouchCancel,!0),t.addEventListener("touchcancel",this.onTouchCancel,!0),t.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},t.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchleave",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},t.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),i=e-this.last;if(!((i=i*t.INTERACTION_FREQUENCY/1e3)<1)){this.last=e;var n=0;this.dirty&&this.rebuildInteractiveGraph();var r=this.interactiveItems.length,s="inherit",o=!1;for(n=0;n<r;n++){var a=this.interactiveItems[n];a.__hit=this.hitTest(a,this.mouse),this.mouse.target=a,a.__hit&&!o?(a.buttonMode&&(s=a.defaultCursor),a.interactiveChildren||(o=!0),a.__isOver||(a.mouseover&&a.mouseover(this.mouse),a.__isOver=!0)):a.__isOver&&(a.mouseout&&a.mouseout(this.mouse),a.__isOver=!1)}this.currentCursorStyle!==s&&(this.currentCursorStyle=s,this.interactionDOMElement.style.cursor=s)}}},t.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,e=0;e<t;e++)this.interactiveItems[e].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},t.InteractionManager.prototype.onMouseMove=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width)/this.resolution,this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height)/this.resolution;for(var i=this.interactiveItems.length,n=0;n<i;n++){var r=this.interactiveItems[n];r.mousemove&&r.mousemove(this.mouse)}},t.InteractionManager.prototype.onMouseDown=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e,t.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var i=this.interactiveItems.length,n=this.mouse.originalEvent,r=2===n.button||3===n.which,s=r?"rightdown":"mousedown",o=r?"rightclick":"click",a=r?"__rightIsDown":"__mouseIsDown",h=r?"__isRightDown":"__isDown",l=0;l<i;l++){var c=this.interactiveItems[l];if((c[s]||c[o])&&(c[a]=!0,c.__hit=this.hitTest(c,this.mouse),c.__hit&&(c[s]&&c[s](this.mouse),c[h]=!0,!c.interactiveChildren)))break}},t.InteractionManager.prototype.onMouseOut=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var i=0;i<e;i++){var n=this.interactiveItems[i];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},t.InteractionManager.prototype.onMouseUp=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;for(var e=this.interactiveItems.length,i=!1,n=this.mouse.originalEvent,r=2===n.button||3===n.which,s=r?"rightup":"mouseup",o=r?"rightclick":"click",a=r?"rightupoutside":"mouseupoutside",h=r?"__isRightDown":"__isDown",l=0;l<e;l++){var c=this.interactiveItems[l];(c[o]||c[s]||c[a])&&(c.__hit=this.hitTest(c,this.mouse),c.__hit&&!i?(c[s]&&c[s](this.mouse),c[h]&&c[o]&&c[o](this.mouse),c.interactiveChildren||(i=!0)):c[h]&&c[a]&&c[a](this.mouse),c[h]=!1)}},t.InteractionManager.prototype.hitTest=function(e,i){var n=i.global;if(!e.worldVisible)return!1;e.worldTransform.applyInverse(n,this._tempPoint);var r,s=this._tempPoint.x,o=this._tempPoint.y;if(i.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(s,o);if(e instanceof t.Sprite){var a,h=e.texture.frame.width,l=e.texture.frame.height,c=-h*e.anchor.x;if(s>c&&s<c+h&&o>(a=-l*e.anchor.y)&&o<a+l)return!0}else if(e instanceof t.Graphics){var u=e.graphicsData;for(r=0;r<u.length;r++){var f=u[r];if(f.fill&&f.shape&&f.shape.contains(s,o))return!0}}var d=e.children.length;for(r=0;r<d;r++){var p=e.children[r];if(this.hitTest(p,i))return i.target=e,!0}return!1},t.InteractionManager.prototype.onTouchMove=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i,n=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,s=r.length,o=this.target.width/n.width,a=this.target.height/n.height,h=navigator.isCocoonJS&&!n.left&&!n.top&&!t.target.style.width&&!t.target.style.height,l=0;l<s;l++)i=r[l],h?(i.globalX=i.clientX,i.globalY=i.clientY):(i.globalX=(i.clientX-n.left)*o/this.resolution,i.globalY=(i.clientY-n.top)*a/this.resolution);for(var c=0;c<s;c++){i=r[c],(e=this.touches[i.identifier]).originalEvent=t,h?(e.global.x=i.clientX,e.global.y=i.clientY):(i.globalX=e.global.x=(i.clientX-n.left)*o/this.resolution,i.globalY=e.global.y=(i.clientY-n.top)*a/this.resolution);for(var u=0;u<this.interactiveItems.length;u++){var f=this.interactiveItems[u];f.touchmove&&f.__touchData&&f.__touchData[i.identifier]&&f.touchmove(e)}}},t.InteractionManager.prototype.onTouchStart=function(e){this.dirty&&this.rebuildInteractiveGraph();var i=this.interactionDOMElement.getBoundingClientRect();t.AUTO_PREVENT_DEFAULT&&e.preventDefault();for(var n,r=e.changedTouches,s=r.length,o=this.target.width/i.width,a=this.target.height/i.height,h=navigator.isCocoonJS&&!i.left&&!i.top&&!e.target.style.width&&!e.target.style.height,l=0;l<s;l++)n=r[l],h?(n.globalX=n.clientX,n.globalY=n.clientY):(n.globalX=(n.clientX-i.left)*o/this.resolution,n.globalY=(n.clientY-i.top)*a/this.resolution);for(var c=0;c<s;c++){n=r[c];var u=this.pool.pop();u||(u=new t.InteractionData),u.originalEvent=e,this.touches[n.identifier]=u,h?(u.global.x=n.clientX,u.global.y=n.clientY):(u.global.x=(n.clientX-i.left)*o/this.resolution,u.global.y=(n.clientY-i.top)*a/this.resolution);for(var f=this.interactiveItems.length,d=0;d<f;d++){var p=this.interactiveItems[d];if((p.touchstart||p.tap)&&(p.__hit=this.hitTest(p,u),p.__hit&&(p.touchstart&&p.touchstart(u),p.__isDown=!0,p.__touchData=p.__touchData||{},p.__touchData[n.identifier]=u,!p.interactiveChildren)))break}}},t.InteractionManager.prototype.onTouchEnd=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=n.length,s=this.target.width/i.width,o=this.target.height/i.height,a=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,h=0;h<r;h++)e=n[h],a?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-i.left)*s/this.resolution,e.globalY=(e.clientY-i.top)*o/this.resolution);for(var l=0;l<r;l++){e=n[l];var c=this.touches[e.identifier],u=!1;a?(c.global.x=e.clientX,c.global.y=e.clientY):(c.global.x=(e.clientX-i.left)*s/this.resolution,c.global.y=(e.clientY-i.top)*o/this.resolution);for(var f=this.interactiveItems.length,d=0;d<f;d++){var p=this.interactiveItems[d];p.__touchData&&p.__touchData[e.identifier]&&(p.__hit=this.hitTest(p,p.__touchData[e.identifier]),c.originalEvent=t,(p.touchend||p.tap)&&(p.__hit&&!u?(p.touchend&&p.touchend(c),p.__isDown&&p.tap&&p.tap(c),p.interactiveChildren||(u=!0)):p.__isDown&&p.touchendoutside&&p.touchendoutside(c),p.__isDown=!1),p.__touchData[e.identifier]=null)}this.pool.push(c),this.touches[e.identifier]=null}},t.InteractionManager.prototype.onTouchCancel=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=n.length,s=this.target.width/i.width,o=this.target.height/i.height,a=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,h=0;h<r;h++)e=n[h],a?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-i.left)*s/this.resolution,e.globalY=(e.clientY-i.top)*o/this.resolution);for(var l=0;l<r;l++){e=n[l];var c=this.touches[e.identifier],u=!1;a?(c.global.x=e.clientX,c.global.y=e.clientY):(c.global.x=(e.clientX-i.left)*s/this.resolution,c.global.y=(e.clientY-i.top)*o/this.resolution);for(var f=this.interactiveItems.length,d=0;d<f;d++){var p=this.interactiveItems[d];p.__touchData&&p.__touchData[e.identifier]&&(p.__hit=this.hitTest(p,p.__touchData[e.identifier]),c.originalEvent=t,p.touchcancel&&!u&&(p.touchcancel(c),p.interactiveChildren||(u=!0)),p.__isDown=!1,p.__touchData[e.identifier]=null)}this.pool.push(c),this.touches[e.identifier]=null}},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.interactive=!0,this.interactionManager=new t.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(t){for(var e=0,i=["ms","moz","webkit","o"],n=0;n<i.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[i[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[n]+"CancelAnimationFrame"]||t[i[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),s=t.setTimeout(function(){i(n+r)},r);return e=n+r,s}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),t.requestAnimFrame=t.requestAnimationFrame}(this),t.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},t.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(t){var e=this,i=arguments.length-1,n=[];if(i>0)for(n.length=i;i--;)n[i]=arguments[i+1];if("function"!=typeof e)throw new TypeError;function r(){for(var i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return s=n.concat(s),e.apply(this instanceof r?this:t,s)}return r.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(e.prototype),r}),t.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return!!window.XMLHttpRequest&&new window.XMLHttpRequest;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(t){}},t.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),0===e.getImageData(0,0,1,1).data[0]},t.getNextPowerOfTwo=function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},t.isPowerOfTwo=function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},t.EventTarget={call:function(e){e&&(e=e.prototype||e,t.EventTarget.mixin(e))},mixin:function(e){e.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},e.emit=e.dispatchEvent=function(e,i){if(this._listeners=this._listeners||{},"object"==typeof e&&(i=e,e=e.type),i&&!0===i.__isEventObject||(i=new t.Event(this,e,i)),this._listeners&&this._listeners[e]){var n,r=this._listeners[e].slice(0),s=r.length,o=r[0];for(n=0;n<s;o=r[++n])if(o.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,e,i),this},e.on=e.addEventListener=function(t,e){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(e),this},e.once=function(t,e){this._listeners=this._listeners||{};var i=this;function n(){e.apply(i.off(t,n),arguments)}return n._originalHandler=e,this.on(t,n)},e.off=e.removeEventListener=function(t,e){if(this._listeners=this._listeners||{},!this._listeners[t])return this;for(var i=this._listeners[t],n=e?i.length:0;n-- >0;)i[n]!==e&&i[n]._originalHandler!==e||i.splice(n,1);return 0===i.length&&delete this._listeners[t],this},e.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},t.Event=function(t,e,i){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=t,this.type=e,this.data=i,this.content=i,this.timeStamp=Date.now()},t.Event.prototype.stopPropagation=function(){this.stopped=!0},t.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},t.autoDetectRenderer=function(e,i,n){return e||(e=800),i||(i=600),function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}()?new t.WebGLRenderer(e,i,n):new t.CanvasRenderer(e,i,n)},t.autoDetectRecommendedRenderer=function(e,i,n){e||(e=800),i||(i=600);var r=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),s=/Android/i.test(navigator.userAgent);return r&&!s?new t.WebGLRenderer(e,i,n):new t.CanvasRenderer(e,i,n)},t.PolyK={},t.PolyK.Triangulate=function(e){var i=!0,n=e.length>>1;if(n<3)return[];for(var r=[],s=[],o=0;o<n;o++)s.push(o);o=0;for(var a=n;a>3;){var h=s[(o+0)%a],l=s[(o+1)%a],c=s[(o+2)%a],u=e[2*h],f=e[2*h+1],d=e[2*l],p=e[2*l+1],g=e[2*c],v=e[2*c+1],m=!1;if(t.PolyK._convex(u,f,d,p,g,v,i)){m=!0;for(var _=0;_<a;_++){var y=s[_];if(y!==h&&y!==l&&y!==c&&t.PolyK._PointInTriangle(e[2*y],e[2*y+1],u,f,d,p,g,v)){m=!1;break}}}if(m)r.push(h,l,c),s.splice((o+1)%a,1),a--,o=0;else if(o++>3*a){if(!i)return null;for(r=[],s=[],o=0;o<n;o++)s.push(o);o=0,a=n,i=!1}}return r.push(s[0],s[1],s[2]),r},t.PolyK._PointInTriangle=function(t,e,i,n,r,s,o,a){var h=o-i,l=a-n,c=r-i,u=s-n,f=t-i,d=e-n,p=h*h+l*l,g=h*c+l*u,v=h*f+l*d,m=c*c+u*u,_=c*f+u*d,y=1/(p*m-g*g),x=(m*v-g*_)*y,b=(p*_-g*v)*y;return x>=0&&b>=0&&x+b<1},t.PolyK._convex=function(t,e,i,n,r,s,o){return(e-n)*(r-i)+(i-t)*(s-n)>=0===o},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,i){return t._CompileShader(e,i,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,i){return t._CompileShader(e,i,e.FRAGMENT_SHADER)},t._CompileShader=function(t,e,i){var n=e.join("\n"),r=t.createShader(i);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(window.console.log(t.getShaderInfoLog(r)),null)},t.compileProgram=function(e,i,n){var r=t.CompileFragmentShader(e,n),s=t.CompileVertexShader(e,i),o=e.createProgram();return e.attachShader(o,s),e.attachShader(o,r),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),o},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},t.PixiShader.prototype.constructor=t.PixiShader,t.PixiShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);for(var n in e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[n].uniformLocation=e.getUniformLocation(i,n);this.initUniforms(),this.program=i},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){var n=(t=this.uniforms[i]).type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=e.uniformMatrix2fv:"mat3"===n?t.glFunc=e.uniformMatrix3fv:"mat4"===n&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)}},t.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,n=i.magFilter?i.magFilter:e.LINEAR,r=i.minFilter?i.minFilter:e.LINEAR,s=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,o=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,a=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(s=e.REPEAT,o=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,l=i.height?i.height:2,c=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,a,h,l,c,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){var e;this.textureCount=1;var i=this.gl;for(var n in this.uniforms)1===(e=this.uniforms[n]).glValueLength?!0===e.glMatrix?e.glFunc.call(i,e.uniformLocation,e.transpose,e.value):e.glFunc.call(i,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty.length<=i.id||e.value.baseTexture._dirty[i.id]?t.instances[i.id].updateTexture(e.value.baseTexture):i.bindTexture(i.TEXTURE_2D,e.value.baseTexture._glTextures[i.id]),i.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.constructor=t.PixiFastShader,t.PixiFastShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.uMatrix=e.getUniformLocation(i,"uMatrix"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(i,"aPositionCoord"),this.aScale=e.getAttribLocation(i,"aScale"),this.aRotation=e.getAttribLocation(i,"aRotation"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.constructor=t.StripShader,t.StripShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.colorAttribute=e.getAttribLocation(i,"aColor"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.constructor=t.PrimitiveShader,t.PrimitiveShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.tintColor=e.getUniformLocation(i,"tint"),this.flipY=e.getUniformLocation(i,"flipY"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.constructor=t.ComplexPrimitiveShader,t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.tintColor=e.getUniformLocation(i,"tint"),this.color=e.getUniformLocation(i,"color"),this.flipY=e.getUniformLocation(i,"flipY"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,i){var n,r=i.gl,s=i.projection,o=i.offset,a=i.shaderManager.primitiveShader;e.dirty&&t.WebGLGraphics.updateGraphics(e,r);for(var h=e._webGL[r.id],l=0;l<h.data.length;l++)1===h.data[l].mode?(n=h.data[l],i.stencilManager.pushStencil(e,n,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(n.indices.length-4)),i.stencilManager.popStencil(e,n,i)):(n=h.data[l],i.shaderManager.setShader(a),a=i.shaderManager.primitiveShader,r.uniformMatrix3fv(a.translationMatrix,!1,e.worldTransform.toArray(!0)),r.uniform1f(a.flipY,1),r.uniform2f(a.projectionVector,s.x,-s.y),r.uniform2f(a.offsetVector,-o.x,-o.y),r.uniform3fv(a.tintColor,t.hex2rgb(e.tint)),r.uniform1f(a.alpha,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,n.buffer),r.vertexAttribPointer(a.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(a.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,n.indices.length,r.UNSIGNED_SHORT,0))},t.WebGLGraphics.updateGraphics=function(e,i){var n,r,s=e._webGL[i.id];if(s||(s=e._webGL[i.id]={lastIndex:0,data:[],gl:i}),e.dirty=!1,e.clearDirty){for(e.clearDirty=!1,n=0;n<s.data.length;n++){var o=s.data[n];o.reset(),t.WebGLGraphics.graphicsDataPool.push(o)}s.data=[],s.lastIndex=0}for(n=s.lastIndex;n<e.graphicsData.length;n++){var a=e.graphicsData[n];a.type===t.Graphics.POLY?(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]===a.points[a.points.length-2]&&a.points[1]===a.points[a.points.length-1]||a.points.push(a.points[0],a.points[1])),a.fill&&a.points.length>=6&&(a.points.length<12?(r=t.WebGLGraphics.switchMode(s,0),t.WebGLGraphics.buildPoly(a,r)||(r=t.WebGLGraphics.switchMode(s,1),t.WebGLGraphics.buildComplexPoly(a,r))):(r=t.WebGLGraphics.switchMode(s,1),t.WebGLGraphics.buildComplexPoly(a,r))),a.lineWidth>0&&(r=t.WebGLGraphics.switchMode(s,0),t.WebGLGraphics.buildLine(a,r))):(r=t.WebGLGraphics.switchMode(s,0),a.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(a,r):a.type===t.Graphics.CIRC||a.type===t.Graphics.ELIP?t.WebGLGraphics.buildCircle(a,r):a.type===t.Graphics.RREC&&t.WebGLGraphics.buildRoundedRectangle(a,r)),s.lastIndex++}for(n=0;n<s.data.length;n++)(r=s.data[n]).dirty&&r.upload()},t.WebGLGraphics.switchMode=function(e,i){var n;return e.data.length&&(n=e.data[e.data.length-1]).mode===i&&1!==i||((n=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl)).mode=i,e.data.push(n)),n.dirty=!0,n},t.WebGLGraphics.buildRectangle=function(e,i){var n=e.shape,r=n.x,s=n.y,o=n.width,a=n.height;if(e.fill){var h=t.hex2rgb(e.fillColor),l=e.fillAlpha,c=h[0]*l,u=h[1]*l,f=h[2]*l,d=i.points,p=i.indices,g=d.length/6;d.push(r,s),d.push(c,u,f,l),d.push(r+o,s),d.push(c,u,f,l),d.push(r,s+a),d.push(c,u,f,l),d.push(r+o,s+a),d.push(c,u,f,l),p.push(g,g,g+1,g+2,g+3,g+3)}if(e.lineWidth){var v=e.points;e.points=[r,s,r+o,s,r+o,s+a,r,s+a,r,s],t.WebGLGraphics.buildLine(e,i),e.points=v}},t.WebGLGraphics.buildRoundedRectangle=function(e,i){var n=e.shape,r=n.x,s=n.y,o=n.width,a=n.height,h=n.radius,l=[];if(l.push(r,s+h),l=(l=(l=(l=l.concat(t.WebGLGraphics.quadraticBezierCurve(r,s+a-h,r,s+a,r+h,s+a))).concat(t.WebGLGraphics.quadraticBezierCurve(r+o-h,s+a,r+o,s+a,r+o,s+a-h))).concat(t.WebGLGraphics.quadraticBezierCurve(r+o,s+h,r+o,s,r+o-h,s))).concat(t.WebGLGraphics.quadraticBezierCurve(r+h,s,r,s,r,s+h)),e.fill){var c=t.hex2rgb(e.fillColor),u=e.fillAlpha,f=c[0]*u,d=c[1]*u,p=c[2]*u,g=i.points,v=i.indices,m=g.length/6,_=t.PolyK.Triangulate(l),y=0;for(y=0;y<_.length;y+=3)v.push(_[y]+m),v.push(_[y]+m),v.push(_[y+1]+m),v.push(_[y+2]+m),v.push(_[y+2]+m);for(y=0;y<l.length;y++)g.push(l[y],l[++y],f,d,p,u)}if(e.lineWidth){var x=e.points;e.points=l,t.WebGLGraphics.buildLine(e,i),e.points=x}},t.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,r,s){var o,a,h,l,c,u,f=[];function d(t,e,i){return t+(e-t)*i}for(var p=0,g=0;g<=20;g++)o=d(t,i,p=g/20),a=d(e,n,p),h=d(i,r,p),l=d(n,s,p),c=d(o,h,p),u=d(a,l,p),f.push(c,u);return f},t.WebGLGraphics.buildCircle=function(e,i){var n,r,s=e.shape,o=s.x,a=s.y;e.type===t.Graphics.CIRC?(n=s.radius,r=s.radius):(n=s.width,r=s.height);var h=2*Math.PI/40,l=0;if(e.fill){var c=t.hex2rgb(e.fillColor),u=e.fillAlpha,f=c[0]*u,d=c[1]*u,p=c[2]*u,g=i.points,v=i.indices,m=g.length/6;for(v.push(m),l=0;l<41;l++)g.push(o,a,f,d,p,u),g.push(o+Math.sin(h*l)*n,a+Math.cos(h*l)*r,f,d,p,u),v.push(m++,m++);v.push(m-1)}if(e.lineWidth){var _=e.points;for(e.points=[],l=0;l<41;l++)e.points.push(o+Math.sin(h*l)*n,a+Math.cos(h*l)*r);t.WebGLGraphics.buildLine(e,i),e.points=_}},t.WebGLGraphics.buildLine=function(e,i){var n=0,r=e.points;if(0!==r.length){if(e.lineWidth%2)for(n=0;n<r.length;n++)r[n]+=.5;var s=new t.Point(r[0],r[1]),o=new t.Point(r[r.length-2],r[r.length-1]);if(s.x===o.x&&s.y===o.y){(r=r.slice()).pop(),r.pop();var a=(o=new t.Point(r[r.length-2],r[r.length-1])).x+.5*(s.x-o.x),h=o.y+.5*(s.y-o.y);r.unshift(a,h),r.push(a,h)}var l,c,u,f,d,p,g,v,m,_,y,x,b,w,S,C,T,k,E,A,M,D,O=i.points,L=i.indices,P=r.length/2,B=r.length,I=O.length/6,R=e.lineWidth/2,F=t.hex2rgb(e.lineColor),U=e.lineAlpha,N=F[0]*U,z=F[1]*U,G=F[2]*U;for(u=r[0],f=r[1],d=r[2],m=-(f-(p=r[3])),_=u-d,m/=D=Math.sqrt(m*m+_*_),_/=D,m*=R,_*=R,O.push(u-m,f-_,N,z,G,U),O.push(u+m,f+_,N,z,G,U),n=1;n<P-1;n++)u=r[2*(n-1)],f=r[2*(n-1)+1],d=r[2*n],p=r[2*n+1],g=r[2*(n+1)],v=r[2*(n+1)+1],m=-(f-p),_=u-d,m/=D=Math.sqrt(m*m+_*_),_/=D,m*=R,_*=R,y=-(p-v),x=d-g,y/=D=Math.sqrt(y*y+x*x),x/=D,T=(-m+u)*(-_+p)-(-m+d)*(-_+f),A=(-(y*=R)+g)*(-(x*=R)+p)-(-y+d)*(-x+v),M=(S=-_+f-(-_+p))*(E=-y+d-(-y+g))-(k=-x+v-(-x+p))*(C=-m+d-(-m+u)),Math.abs(M)<.1?(M+=10.1,O.push(d-m,p-_,N,z,G,U),O.push(d+m,p+_,N,z,G,U)):((l=(C*A-E*T)/M)-d)*(l-d)+((c=(k*T-S*A)/M)-p)+(c-p)>19600?(b=m-y,w=_-x,b/=D=Math.sqrt(b*b+w*w),w/=D,b*=R,w*=R,O.push(d-b,p-w),O.push(N,z,G,U),O.push(d+b,p+w),O.push(N,z,G,U),O.push(d-b,p-w),O.push(N,z,G,U),B++):(O.push(l,c),O.push(N,z,G,U),O.push(d-(l-d),p-(c-p)),O.push(N,z,G,U));for(u=r[2*(P-2)],f=r[2*(P-2)+1],d=r[2*(P-1)],m=-(f-(p=r[2*(P-1)+1])),_=u-d,m/=D=Math.sqrt(m*m+_*_),_/=D,m*=R,_*=R,O.push(d-m,p-_),O.push(N,z,G,U),O.push(d+m,p+_),O.push(N,z,G,U),L.push(I),n=0;n<B;n++)L.push(I++);L.push(I-1)}},t.WebGLGraphics.buildComplexPoly=function(e,i){var n=e.points.slice();if(!(n.length<6)){var r=i.indices;i.points=n,i.alpha=e.fillAlpha,i.color=t.hex2rgb(e.fillColor);for(var s,o,a=1/0,h=-1/0,l=1/0,c=-1/0,u=0;u<n.length;u+=2)a=(s=n[u])<a?s:a,h=s>h?s:h,l=(o=n[u+1])<l?o:l,c=o>c?o:c;n.push(a,l,h,l,h,c,a,c);var f=n.length/2;for(u=0;u<f;u++)r.push(u)}},t.WebGLGraphics.buildPoly=function(e,i){var n=e.points;if(!(n.length<6)){var r=i.points,s=i.indices,o=n.length/2,a=t.hex2rgb(e.fillColor),h=e.fillAlpha,l=a[0]*h,c=a[1]*h,u=a[2]*h,f=t.PolyK.Triangulate(n);if(!f)return!1;var d=r.length/6,p=0;for(p=0;p<f.length;p+=3)s.push(f[p]+d),s.push(f[p]+d),s.push(f[p+1]+d),s.push(f[p+2]+d),s.push(f[p+2]+d);for(p=0;p<o;p++)r.push(n[2*p],n[2*p+1],l,c,u,h);return!0}},t.WebGLGraphics.graphicsDataPool=[],t.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},t.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},t.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new t.Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new t.Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},t.glContexts=[],t.instances=[],t.WebGLRenderer=function(e,i,n){if(n)for(var r in t.defaultRenderOptions)void 0===n[r]&&(n[r]=t.defaultRenderOptions[r]);else n=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("webGL"),t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.resolution=n.resolution,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this.width=e||800,this.height=i||600,this.view=n.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},this.projection=new t.Point,this.offset=new t.Point(0,0),this.shaderManager=new t.WebGLShaderManager,this.spriteBatch=new t.WebGLSpriteBatch,this.maskManager=new t.WebGLMaskManager,this.filterManager=new t.WebGLFilterManager,this.stencilManager=new t.WebGLStencilManager,this.blendModeManager=new t.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.initContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=e,!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=e.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=e,t.instances[this.glContextId]=this,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.shaderManager.setContext(e),this.spriteBatch.setContext(e),this.maskManager.setContext(e),this.filterManager.setContext(e),this.blendModeManager.setContext(e),this.stencilManager.setContext(e),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},t.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},t.WebGLRenderer.prototype.renderDisplayObject=function(e,i,n){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=n?-1:1,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,n),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},t.WebGLRenderer.prototype.updateTexture=function(e){if(e.hasLoaded){var i=this.gl;return e._glTextures[i.id]||(e._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),e.mipmap&&t.isPowerOfTwo(e.width,e.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),e._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),e._dirty[i.id]=!1,e._glTextures[i.id]}},t.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){for(var e in this.initContext(),t.TextureCache)t.TextureCache[e].baseTexture._glTextures=[];this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null,this.renderSession=null},t.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[e.SRC_ALPHA,e.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA])},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(){this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.constructor=t.WebGLBlendModeManager,t.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var i=t.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(){},t.WebGLMaskManager.prototype.constructor=t.WebGLMaskManager,t.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},t.WebGLMaskManager.prototype.pushMask=function(e,i){var n=i.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,n),e._webGL[n.id].data.length&&i.stencilManager.pushStencil(e,e._webGL[n.id].data[0],i)},t.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},t.WebGLMaskManager.prototype.destroy=function(){this.gl=null},t.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},t.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var r=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(r+1),255):n.stencilFunc(n.EQUAL,r+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r+1,255):n.stencilFunc(n.EQUAL,255-(r+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,i,n){this._currentGraphics=e;var r,s=this.gl,o=n.projection,a=n.offset;1===i.mode?(r=n.shaderManager.complexPrimitiveShader,n.shaderManager.setShader(r),s.uniform1f(r.flipY,n.flipY),s.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform2f(r.projectionVector,o.x,-o.y),s.uniform2f(r.offsetVector,-a.x,-a.y),s.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),s.uniform3fv(r.color,i.color),s.uniform1f(r.alpha,e.worldAlpha*i.alpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(r=n.shaderManager.primitiveShader,n.shaderManager.setShader(r),s.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform1f(r.flipY,n.flipY),s.uniform2f(r.projectionVector,o.x,-o.y),s.uniform2f(r.offsetVector,-a.x,-a.y),s.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),s.uniform1f(r.alpha,e.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(r.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)n.disable(n.STENCIL_TEST);else{var r=this.count;this.bindGraphics(t,e,i),n.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)):(this.reverse?(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},t.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},t.WebGLShaderManager.prototype.constructor=t.WebGLShaderManager,t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimitiveShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},t.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var e=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new t.ArrayBuffer(e),this.positions=new t.Float32Array(this.vertices),this.colors=new t.Uint32Array(this.vertices),this.indices=new t.Uint16Array(i),this.lastIndexCount=0;for(var n=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new t.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new t.PixiShader(e);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[e.id]=i},t.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var i=e._uvs;if(i){var n,r,s,o,a=t.anchor.x,h=t.anchor.y;if(e.trim){var l=e.trim;n=(r=l.x-a*l.width)+e.crop.width,s=(o=l.y-h*l.height)+e.crop.height}else n=e.frame.width*(1-a),r=e.frame.width*-a,s=e.frame.height*(1-h),o=e.frame.height*-h;var c=4*this.currentBatchSize*this.vertSize,u=e.baseTexture.resolution,f=t.worldTransform,d=f.a/u,p=f.b/u,g=f.c/u,v=f.d/u,m=f.tx,_=f.ty,y=this.colors,x=this.positions;this.renderSession.roundPixels?(x[c]=d*r+g*o+m|0,x[c+1]=v*o+p*r+_|0,x[c+5]=d*n+g*o+m|0,x[c+6]=v*o+p*n+_|0,x[c+10]=d*n+g*s+m|0,x[c+11]=v*s+p*n+_|0,x[c+15]=d*r+g*s+m|0,x[c+16]=v*s+p*r+_|0):(x[c]=d*r+g*o+m,x[c+1]=v*o+p*r+_,x[c+5]=d*n+g*o+m,x[c+6]=v*o+p*n+_,x[c+10]=d*n+g*s+m,x[c+11]=v*s+p*n+_,x[c+15]=d*r+g*s+m,x[c+16]=v*s+p*r+_),x[c+2]=i.x0,x[c+3]=i.y0,x[c+7]=i.x1,x[c+8]=i.y1,x[c+12]=i.x2,x[c+13]=i.y2,x[c+17]=i.x3,x[c+18]=i.y3;var b=t.tint;y[c+4]=y[c+9]=y[c+14]=y[c+19]=(b>>16)+(65280&b)+((255&b)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var i=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var n=e._uvs;e.tilePosition.x%=i.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=i.baseTexture.height*e.tileScaleOffset.y;var r=e.tilePosition.x/(i.baseTexture.width*e.tileScaleOffset.x),s=e.tilePosition.y/(i.baseTexture.height*e.tileScaleOffset.y),o=e.width/i.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),a=e.height/i.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);n.x0=0-r,n.y0=0-s,n.x1=1*o-r,n.y1=0-s,n.x2=1*o-r,n.y2=1*a-s,n.x3=0-r,n.y3=1*a-s;var h=e.tint,l=(h>>16)+(65280&h)+((255&h)<<16)+(255*e.alpha<<24),c=this.positions,u=this.colors,f=e.width,d=e.height,p=e.anchor.x,g=e.anchor.y,v=f*(1-p),m=f*-p,_=d*(1-g),y=d*-g,x=4*this.currentBatchSize*this.vertSize,b=i.baseTexture.resolution,w=e.worldTransform,S=w.a/b,C=w.b/b,T=w.c/b,k=w.d/b,E=w.tx,A=w.ty;c[x++]=S*m+T*y+E,c[x++]=k*y+C*m+A,c[x++]=n.x0,c[x++]=n.y0,u[x++]=l,c[x++]=S*v+T*y+E,c[x++]=k*y+C*v+A,c[x++]=n.x1,c[x++]=n.y1,u[x++]=l,c[x++]=S*v+T*_+E,c[x++]=k*_+C*v+A,c[x++]=n.x2,c[x++]=n.y2,u[x++]=l,c[x++]=S*m+T*_+E,c[x++]=k*_+C*m+A,c[x++]=n.x3,c[x++]=n.y3,u[x++]=l,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e,i,n,r,s=this.gl;if(this.dirty){this.dirty=!1,s.activeTexture(s.TEXTURE0),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e=this.defaultShader.shaders[s.id];var o=4*this.vertSize;s.vertexAttribPointer(e.aVertexPosition,2,s.FLOAT,!1,o,0),s.vertexAttribPointer(e.aTextureCoord,2,s.FLOAT,!1,o,8),s.vertexAttribPointer(e.colorAttribute,4,s.UNSIGNED_BYTE,!0,o,16)}if(this.currentBatchSize>.5*this.size)s.bufferSubData(s.ARRAY_BUFFER,0,this.vertices);else{var a=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);s.bufferSubData(s.ARRAY_BUFFER,0,a)}for(var h,l=0,c=0,u=null,f=this.renderSession.blendModeManager.currentBlendMode,d=null,p=!1,g=!1,v=0,m=this.currentBatchSize;v<m;v++){if(i=(h=this.sprites[v]).texture.baseTexture,p=f!==(n=h.blendMode),g=d!==(r=h.shader||this.defaultShader),(u!==i||p||g)&&(this.renderBatch(u,l,c),c=v,l=0,u=i,p&&(f=n,this.renderSession.blendModeManager.setBlendMode(f)),g)){(e=(d=r).shaders[s.id])||((e=new t.PixiShader(s)).fragmentSrc=d.fragmentSrc,e.uniforms=d.uniforms,e.init(),d.shaders[s.id]=e),this.renderSession.shaderManager.setShader(e),e.dirty&&e.syncUniforms();var _=this.renderSession.projection;s.uniform2f(e.projectionVector,_.x,_.y);var y=this.renderSession.offset;s.uniform2f(e.offsetVector,y.x,y.y)}l++}this.renderBatch(u,l,c),this.currentBatchSize=0}},t.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;n.id>=t._dirty.length||t._dirty[n.id]?this.renderSession.renderer.updateTexture(t):n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]),n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},t.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var i=4*this.size*this.vertSize,n=6*this.maxSize;this.vertices=new t.Float32Array(i),this.indices=new t.Uint16Array(n),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,s=0;r<n;r+=6,s+=4)this.indices[r+0]=s+0,this.indices[r+1]=s+1,this.indices[r+2]=s+2,this.indices[r+3]=s+0,this.indices[r+4]=s+2,this.indices[r+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.constructor=t.WebGLFastSpriteBatch,t.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var n=0,r=e.length;n<r;n++)this.renderSprite(e[n]);this.flush()}},t.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,n,r,s,o,a=this.vertices;if(e=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim){var h=t.texture.trim;i=(n=h.x-t.anchor.x*h.width)+t.texture.crop.width,r=(s=h.y-t.anchor.y*h.height)+t.texture.crop.height}else i=t.texture.frame.width*(1-t.anchor.x),n=t.texture.frame.width*-t.anchor.x,r=t.texture.frame.height*(1-t.anchor.y),s=t.texture.frame.height*-t.anchor.y;o=4*this.currentBatchSize*this.vertSize,a[o++]=n,a[o++]=s,a[o++]=t.position.x,a[o++]=t.position.y,a[o++]=t.scale.x,a[o++]=t.scale.y,a[o++]=t.rotation,a[o++]=e.x0,a[o++]=e.y1,a[o++]=t.alpha,a[o++]=i,a[o++]=s,a[o++]=t.position.x,a[o++]=t.position.y,a[o++]=t.scale.x,a[o++]=t.scale.y,a[o++]=t.rotation,a[o++]=e.x1,a[o++]=e.y1,a[o++]=t.alpha,a[o++]=i,a[o++]=r,a[o++]=t.position.x,a[o++]=t.position.y,a[o++]=t.scale.x,a[o++]=t.scale.y,a[o++]=t.rotation,a[o++]=e.x2,a[o++]=e.y2,a[o++]=t.alpha,a[o++]=n,a[o++]=r,a[o++]=t.position.x,a[o++]=t.position.y,a[o++]=t.scale.x,a[o++]=t.scale.y,a[o++]=t.rotation,a[o++]=e.x3,a[o++]=e.y3,a[o++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},t.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},t.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},t.WebGLFilterManager.prototype.constructor=t.WebGLFilterManager,t.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},t.WebGLFilterManager.prototype.pushFilter=function(e){var i=this.gl,n=this.renderSession.projection,r=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var s=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width,this.height):o=new t.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,o.texture);var a=e._filterArea,h=s.padding;a.x-=h,a.y-=h,a.width+=2*h,a.height+=2*h,a.x<0&&(a.x=0),a.width>this.width&&(a.width=this.width),a.y<0&&(a.y=0),a.height>this.height&&(a.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,o.frameBuffer),i.viewport(0,0,a.width,a.height),n.x=a.width/2,n.y=-a.height/2,r.x=-a.x,r.y=-a.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),e._glFilterTexture=o},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,i=this.filterStack.pop(),n=i._filterArea,r=i._glFilterTexture,s=this.renderSession.projection,o=this.renderSession.offset;if(i.filterPasses.length>1){e.viewport(0,0,n.width,n.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=n.height,this.vertexArray[2]=n.width,this.vertexArray[3]=n.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=n.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var a=r,h=this.texturePool.pop();h||(h=new t.FilterTexture(this.gl,this.width,this.height)),h.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,h.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var l=0;l<i.filterPasses.length-1;l++){var c=i.filterPasses[l];e.bindFramebuffer(e.FRAMEBUFFER,h.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a.texture),this.applyFilterPass(c,n,n.width,n.height);var u=a;a=h,h=u}e.enable(e.BLEND),r=a,this.texturePool.push(h)}var f=i.filterPasses[i.filterPasses.length-1];this.offsetX-=n.x,this.offsetY-=n.y;var d=this.width,p=this.height,g=0,v=0,m=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,!0);else{var _=this.filterStack[this.filterStack.length-1];d=(n=_._filterArea).width,p=n.height,g=n.x,v=n.y,m=_._glFilterTexture.frameBuffer}s.x=d/2,s.y=-p/2,o.x=g,o.y=v;var y=(n=i._filterArea).x-g,x=n.y-v;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=y,this.vertexArray[1]=x+n.height,this.vertexArray[2]=y+n.width,this.vertexArray[3]=x+n.height,this.vertexArray[4]=y,this.vertexArray[5]=x,this.vertexArray[6]=y+n.width,this.vertexArray[7]=x,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,d*this.renderSession.resolution,p*this.renderSession.resolution),e.bindFramebuffer(e.FRAMEBUFFER,m),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r.texture),this.applyFilterPass(f,n,d,p),this.texturePool.push(r),i._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,i,n,r){var s=this.gl,o=e.shaders[s.id];o||((o=new t.PixiShader(s)).fragmentSrc=e.fragmentSrc,o.uniforms=e.uniforms,o.init(),e.shaders[s.id]=o),this.renderSession.shaderManager.setShader(o),s.uniform2f(o.projectionVector,n/2,-r/2),s.uniform2f(o.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(o.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(o.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new t.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,i,n,r){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),r=r||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(i,n)},t.FilterTexture.prototype.constructor=t.FilterTexture,t.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},t.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},t.CanvasBuffer.prototype.constructor=t.CanvasBuffer,t.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.constructor=t.CanvasMaskManager,t.CanvasMaskManager.prototype.pushMask=function(e,i){var n=i.context;n.save();var r=e.alpha,s=e.worldTransform,o=i.resolution;n.setTransform(s.a*o,s.b*o,s.c*o,s.d*o,s.tx*o,s.ty*o),t.CanvasGraphics.renderGraphicsMask(e,n),n.clip(),e.worldAlpha=r},t.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,i){var n=e.texture,r="#"+("00000"+(0|(i=t.CanvasTinter.roundColor(i))).toString(16)).substr(-6);if(n.tintCache=n.tintCache||{},n.tintCache[r])return n.tintCache[r];var s=t.CanvasTinter.canvas||document.createElement("canvas");if(t.CanvasTinter.tintMethod(n,i,s),t.CanvasTinter.convertTintToImage){var o=new Image;o.src=s.toDataURL(),n.tintCache[r]=o}else n.tintCache[r]=s,t.CanvasTinter.canvas=null;return s},t.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},t.CanvasTinter.tintWithOverlay=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},t.CanvasTinter.tintWithPerPixel=function(e,i,n){var r=n.getContext("2d"),s=e.crop;n.width=s.width,n.height=s.height,r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var o=t.hex2rgb(i),a=o[0],h=o[1],l=o[2],c=r.getImageData(0,0,s.width,s.height),u=c.data,f=0;f<u.length;f+=4)u[f+0]*=a,u[f+1]*=h,u[f+2]*=l;r.putImageData(c,0,0)},t.CanvasTinter.roundColor=function(e){var i=t.CanvasTinter.cacheStepsPerColorChannel,n=t.hex2rgb(e);return n[0]=Math.min(255,n[0]/i*i),n[1]=Math.min(255,n[1]/i*i),n[2]=Math.min(255,n[2]/i*i),t.rgb2hex(n)},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,i,n){if(n)for(var r in t.defaultRenderOptions)void 0===n[r]&&(n[r]=t.defaultRenderOptions[r]);else n=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("Canvas"),t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.resolution=n.resolution,this.clearBeforeRender=n.clearBeforeRender,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.width=e||800,this.height=i||600,this.width*=this.resolution,this.height*=this.resolution,this.view=n.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(e,i),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=t.blendModes.NORMAL,this.context.globalCompositeOperation=t.blendModesCanvas[t.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)))},t.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},t.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},t.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.mapBlendModes=function(){t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over"))},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,i){var n=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var r=0;r<e.graphicsData.length;r++){var s=e.graphicsData[r],o=s.shape,a=s._fillTint,h=s._lineTint;if(i.lineWidth=s.lineWidth,s.type===t.Graphics.POLY){i.beginPath();var l=o.points;i.moveTo(l[0],l[1]);for(var c=1;c<l.length/2;c++)i.lineTo(l[2*c],l[2*c+1]);o.closed&&i.lineTo(l[0],l[1]),l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&i.closePath(),s.fill&&(i.globalAlpha=s.fillAlpha*n,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke())}else if(s.type===t.Graphics.RECT)(s.fillColor||0===s.fillColor)&&(i.globalAlpha=s.fillAlpha*n,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fillRect(o.x,o.y,o.width,o.height)),s.lineWidth&&(i.globalAlpha=s.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.strokeRect(o.x,o.y,o.width,o.height));else if(s.type===t.Graphics.CIRC)i.beginPath(),i.arc(o.x,o.y,o.radius,0,2*Math.PI),i.closePath(),s.fill&&(i.globalAlpha=s.fillAlpha*n,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke());else if(s.type===t.Graphics.ELIP){var u=2*o.width,f=2*o.height,d=o.x-u/2,p=o.y-f/2;i.beginPath();var g=u/2*.5522848,v=f/2*.5522848,m=d+u,_=p+f,y=d+u/2,x=p+f/2;i.moveTo(d,x),i.bezierCurveTo(d,x-v,y-g,p,y,p),i.bezierCurveTo(y+g,p,m,x-v,m,x),i.bezierCurveTo(m,x+v,y+g,_,y,_),i.bezierCurveTo(y-g,_,d,x+v,d,x),i.closePath(),s.fill&&(i.globalAlpha=s.fillAlpha*n,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke())}else if(s.type===t.Graphics.RREC){var b=o.x,w=o.y,S=o.width,C=o.height,T=o.radius,k=Math.min(S,C)/2|0;T=T>k?k:T,i.beginPath(),i.moveTo(b,w+T),i.lineTo(b,w+C-T),i.quadraticCurveTo(b,w+C,b+T,w+C),i.lineTo(b+S-T,w+C),i.quadraticCurveTo(b+S,w+C,b+S,w+C-T),i.lineTo(b+S,w+T),i.quadraticCurveTo(b+S,w,b+S-T,w),i.lineTo(b+T,w),i.quadraticCurveTo(b,w,b,w+T),i.closePath(),(s.fillColor||0===s.fillColor)&&(i.globalAlpha=s.fillAlpha*n,i.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),i.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,i){var n=e.graphicsData.length;if(0!==n){n>1&&(n=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;r<1;r++){var s=e.graphicsData[r],o=s.shape;if(s.type===t.Graphics.POLY){i.beginPath();var a=o.points;i.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)i.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&i.closePath()}else if(s.type===t.Graphics.RECT)i.beginPath(),i.rect(o.x,o.y,o.width,o.height),i.closePath();else if(s.type===t.Graphics.CIRC)i.beginPath(),i.arc(o.x,o.y,o.radius,0,2*Math.PI),i.closePath();else if(s.type===t.Graphics.ELIP){var l=2*o.width,c=2*o.height,u=o.x-l/2,f=o.y-c/2;i.beginPath();var d=l/2*.5522848,p=c/2*.5522848,g=u+l,v=f+c,m=u+l/2,_=f+c/2;i.moveTo(u,_),i.bezierCurveTo(u,_-p,m-d,f,m,f),i.bezierCurveTo(m+d,f,g,_-p,g,_),i.bezierCurveTo(g,_+p,m+d,v,m,v),i.bezierCurveTo(m-d,v,u,_+p,u,_),i.closePath()}else if(s.type===t.Graphics.RREC){var y=o.points,x=y[0],b=y[1],w=y[2],S=y[3],C=y[4],T=Math.min(w,S)/2|0;C=C>T?T:C,i.beginPath(),i.moveTo(x,b+C),i.lineTo(x,b+S-C),i.quadraticCurveTo(x,b+S,x+C,b+S),i.lineTo(x+w-C,b+S),i.quadraticCurveTo(x+w,b+S,x+w,b+S-C),i.lineTo(x+w,b+C),i.quadraticCurveTo(x+w,b,x+w-C,b),i.lineTo(x+C,b),i.quadraticCurveTo(x,b,x,b+C),i.closePath()}}}},t.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],o=0|s.fillColor,a=0|s.lineColor;s._fillTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*n*255,s._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*n*255}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new t.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.Graphics.prototype.lineStyle=function(e,i,n){if(this.lineWidth=e||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:n,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new t.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},t.Graphics.prototype.moveTo=function(e,i){return this.drawShape(new t.Polygon([e,i])),this},t.Graphics.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},t.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,s,o=this.currentPath.shape.points;0===o.length&&this.moveTo(0,0);for(var a=o[o.length-2],h=o[o.length-1],l=0,c=1;c<=20;c++)r=a+(t-a)*(l=c/20),s=h+(e-h)*l,o.push(r+(t+(i-t)*l-r)*l,s+(e+(n-e)*l-s)*l);return this.dirty=!0,this},t.Graphics.prototype.bezierCurveTo=function(t,e,i,n,r,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,a,h,l,c,u=this.currentPath.shape.points,f=u[u.length-2],d=u[u.length-1],p=0,g=1;g<=20;g++)h=(a=(o=1-(p=g/20))*o)*o,c=(l=p*p)*p,u.push(h*f+3*a*p*t+3*o*l*i+c*r,h*d+3*a*p*e+3*o*l*n+c*s);return this.dirty=!0,this},t.Graphics.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s=this.currentPath.shape.points,o=s[s.length-2],a=s[s.length-1]-e,h=o-t,l=n-e,c=i-t,u=Math.abs(a*c-h*l);if(u<1e-8||0===r)s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e);else{var f=a*a+h*h,d=l*l+c*c,p=a*l+h*c,g=r*Math.sqrt(f)/u,v=r*Math.sqrt(d)/u,m=g*p/f,_=v*p/d,y=g*c+v*h,x=g*l+v*a,b=h*(v+m),w=a*(v+m),S=c*(g+_),C=l*(g+_),T=Math.atan2(w-x,b-y),k=Math.atan2(C-x,S-y);this.arc(y+t,x+e,r,T,k,h*l>c*a)}return this.dirty=!0,this},t.Graphics.prototype.arc=function(t,e,i,n,r,s){var o,a=t+Math.cos(n)*i,h=e+Math.sin(n)*i;if(this.currentPath?0===(o=this.currentPath.shape.points).length?o.push(a,h):o[o.length-2]===a&&o[o.length-1]===h||o.push(a,h):(this.moveTo(a,h),o=this.currentPath.shape.points),n===r)return this;!s&&r<=n?r+=2*Math.PI:s&&n<=r&&(n+=2*Math.PI);var l=s?-1*(n-r):r-n,c=Math.abs(l)/(2*Math.PI)*40;if(0===l)return this;for(var u=l/(2*c),f=2*u,d=Math.cos(u),p=Math.sin(u),g=c-1,v=g%1/g,m=0;m<=g;m++){var _=u+n+f*(m+v*m),y=Math.cos(_),x=-Math.sin(_);o.push((d*y+p*x)*i+t,(d*-x+p*y)*i+e)}return this.dirty=!0,this},t.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,i,n,r){return this.drawShape(new t.Rectangle(e,i,n,r)),this},t.Graphics.prototype.drawRoundedRect=function(e,i,n,r,s){return this.drawShape(new t.RoundedRectangle(e,i,n,r,s)),this},t.Graphics.prototype.drawCircle=function(e,i,n){return this.drawShape(new t.Circle(e,i,n)),this},t.Graphics.prototype.drawEllipse=function(e,i,n,r){return this.drawShape(new t.Ellipse(e,i,n,r)),this},t.Graphics.prototype.drawPolygon=function(e){return e instanceof Array||(e=Array.prototype.slice.call(arguments)),this.drawShape(new t.Polygon(e)),this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},t.Graphics.prototype.generateTexture=function(e,i){e=e||1;var n=this.getBounds(),r=new t.CanvasBuffer(n.width*e,n.height*e),s=t.Texture.fromCanvas(r.canvas,i);return s.baseTexture.resolution=e,r.context.scale(e,e),r.context.translate(-n.x,-n.y),t.CanvasGraphics.renderGraphics(this,r.context),s},t.Graphics.prototype._renderWebGL=function(e){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var i=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(i[0],i[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),t.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var n=0,r=this.children.length;n<r;n++)this.children[n]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()}},t.Graphics.prototype._renderCanvas=function(e){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e);var i=e.context,n=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,i.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);var r=e.resolution;i.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r),t.CanvasGraphics.renderGraphics(this,i);for(var s=0,o=this.children.length;s<o;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Graphics.prototype.getBounds=function(e){if(this.isMask)return t.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var i=this._localBounds,n=i.x,r=i.width+i.x,s=i.y,o=i.height+i.y,a=e||this.worldTransform,h=a.a,l=a.b,c=a.c,u=a.d,f=a.tx,d=a.ty,p=h*r+c*o+f,g=u*o+l*r+d,v=h*n+c*o+f,m=u*o+l*n+d,_=h*n+c*s+f,y=u*s+l*n+d,x=h*r+c*s+f,b=u*s+l*r+d,w=p,S=g,C=p,T=g;return C=x<(C=_<(C=v<C?v:C)?_:C)?x:C,T=b<(T=y<(T=m<T?m:T)?y:T)?b:T,w=x>(w=_>(w=v>w?v:w)?_:w)?x:w,S=b>(S=y>(S=m>S?m:S)?y:S)?b:S,this._bounds.x=C,this._bounds.width=w-C,this._bounds.y=T,this._bounds.height=S-T,this._bounds},t.Graphics.prototype.updateLocalBounds=function(){var e=1/0,i=-1/0,n=1/0,r=-1/0;if(this.graphicsData.length)for(var s,o,a,h,l,c,u=0;u<this.graphicsData.length;u++){var f=this.graphicsData[u],d=f.type,p=f.lineWidth;if(s=f.shape,d===t.Graphics.RECT||d===t.Graphics.RREC)a=s.x-p/2,h=s.y-p/2,e=a<e?a:e,i=a+(l=s.width+p)>i?a+l:i,n=h<n?h:n,r=h+(c=s.height+p)>r?h+c:r;else if(d===t.Graphics.CIRC)a=s.x,h=s.y,e=a-(l=s.radius+p/2)<e?a-l:e,i=a+l>i?a+l:i,n=h-(c=s.radius+p/2)<n?h-c:n,r=h+c>r?h+c:r;else if(d===t.Graphics.ELIP)a=s.x,h=s.y,e=a-(l=s.width+p/2)<e?a-l:e,i=a+l>i?a+l:i,n=h-(c=s.height+p/2)<n?h-c:n,r=h+c>r?h+c:r;else{o=s.points;for(var g=0;g<o.length;g+=2)e=(a=o[g])-p<e?a-p:e,i=a+p>i?a+p:i,n=(h=o[g+1])-p<n?h-p:n,r=h+p>r?h+p:r}}else e=0,i=0,n=0,r=0;var v=this.boundsPadding;this._localBounds.x=e-v,this._localBounds.width=i-e+2*v,this._localBounds.y=n-v,this._localBounds.height=r-n+2*v},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var i=new t.CanvasBuffer(e.width,e.height),n=t.Texture.fromCanvas(i.canvas);this._cachedSprite=new t.Sprite(n),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var i=new t.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(i),i.type===t.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i},t.GraphicsData=function(t,e,i,n,r,s,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=s,this.shape=o,this.type=o.type},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.Graphics.RREC=4,t.Polygon.prototype.type=t.Graphics.POLY,t.Rectangle.prototype.type=t.Graphics.RECT,t.Circle.prototype.type=t.Graphics.CIRC,t.Ellipse.prototype.type=t.Graphics.ELIP,t.RoundedRectangle.prototype.type=t.Graphics.RREC,t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=t.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=t.Strip.DrawModes.TRIANGLE_STRIP},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},t.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var i=e.gl,n=e.projection,r=e.offset,s=e.shaderManager.stripShader,o=this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;e.blendModeManager.setBlendMode(this.blendMode),i.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(s.projectionVector,n.x,-n.y),i.uniform2f(s.offsetVector,-r.x,-r.y),i.uniform1f(s.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(s.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(s.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?e.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(s.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(s.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?e.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(o,this.indices.length,i.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var i=e.context,n=this.worldTransform;e.roundPixels?i.setTransform(n.a,n.b,n.c,n.d,0|n.tx,0|n.ty):i.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(i):this._renderCanvasTriangles(i)},t.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,n=e.length/2;this.count++;for(var r=0;r<n-2;r++){var s=2*r;this._renderCanvasDrawTriangle(t,e,i,s,s+2,s+4)}},t.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,n=this.indices,r=n.length;this.count++;for(var s=0;s<r;s+=3){var o=2*n[s],a=2*n[s+1],h=2*n[s+2];this._renderCanvasDrawTriangle(t,e,i,o,a,h)}},t.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,s){var o=this.texture.baseTexture.source,a=this.texture.width,h=this.texture.height,l=e[n],c=e[r],u=e[s],f=e[n+1],d=e[r+1],p=e[s+1],g=i[n]*a,v=i[r]*a,m=i[s]*a,_=i[n+1]*h,y=i[r+1]*h,x=i[s+1]*h;if(this.canvasPadding>0){var b=this.canvasPadding/this.worldTransform.a,w=this.canvasPadding/this.worldTransform.d,S=(l+c+u)/3,C=(f+d+p)/3,T=l-S,k=f-C,E=Math.sqrt(T*T+k*k);l=S+T/E*(E+b),f=C+k/E*(E+w),k=d-C,c=S+(T=c-S)/(E=Math.sqrt(T*T+k*k))*(E+b),d=C+k/E*(E+w),k=p-C,u=S+(T=u-S)/(E=Math.sqrt(T*T+k*k))*(E+b),p=C+k/E*(E+w)}t.save(),t.beginPath(),t.moveTo(l,f),t.lineTo(c,d),t.lineTo(u,p),t.closePath(),t.clip();var A=g*y+_*m+v*x-y*m-_*v-g*x,M=l*y+_*u+c*x-y*u-_*c-l*x,D=g*c+l*m+v*u-c*m-l*v-g*u,O=g*y*u+_*c*m+l*v*x-l*y*m-_*v*u-g*c*x,L=f*y+_*p+d*x-y*p-_*d-f*x,P=g*d+f*m+v*p-d*m-f*v-g*p,B=g*y*p+_*d*m+f*v*x-f*y*m-_*v*p-g*d*x;t.transform(M/A,L/A,D/A,P/A,O/A,B/A),t.drawImage(o,0,0),t.restore()},t.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;this.count++,e.beginPath();for(var r=1;r<n-2;r++){var s=2*r,o=i[s],a=i[s+2],h=i[s+4],l=i[s+1],c=i[s+3],u=i[s+5];e.moveTo(o,l),e.lineTo(a,c),e.lineTo(h,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Strip.prototype.getBounds=function(e){for(var i=e||this.worldTransform,n=i.a,r=i.b,s=i.c,o=i.d,a=i.tx,h=i.ty,l=-1/0,c=-1/0,u=1/0,f=1/0,d=this.vertices,p=0,g=d.length;p<g;p+=2){var v=d[p],m=d[p+1],_=n*v+s*m+a,y=o*m+r*v+h;u=_<u?_:u,f=y<f?y:f,l=_>l?_:l,c=y>c?y:c}if(u===-1/0||c===1/0)return t.EmptyRectangle;var x=this._bounds;return x.x=u,x.width=l-u,x.y=f,x.height=c-f,this._currentBounds=x,x},t.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},t.Rope=function(e,i){t.Strip.call(this,e),this.points=i,this.vertices=new t.Float32Array(4*i.length),this.uvs=new t.Float32Array(4*i.length),this.colors=new t.Float32Array(2*i.length),this.indices=new t.Uint16Array(2*i.length),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=(t[0],this.indices),n=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var r,s,o=t.length,a=1;a<o;a++)t[a],s=a/(o-1),e[r=4*a]=s,e[r+1]=0,e[r+2]=s,e[r+3]=1,n[r=2*a]=1,n[r+1]=1,i[r=2*a]=r,i[r+1]=r+1}},t.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var i,n=e[0],r={x:0,y:0};this.count-=.2;for(var s,o,a,h,l=this.vertices,c=e.length,u=0;u<c;u++)s=e[u],o=4*u,i=u<e.length-1?e[u+1]:s,r.y=-(i.x-n.x),r.x=i.y-n.y,a=Math.sqrt(r.x*r.x+r.y*r.y),h=this.texture.height/2,r.x/=a,r.y/=a,r.x*=h,r.y*=h,l[o]=s.x+r.x,l[o+1]=s.y+r.y,l[o+2]=s.x-r.x,l[o+3]=s.y-r.y,n=s;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(t){this.texture=t},t.TilingSprite=function(e,i,n){t.Sprite.call(this,e),this._width=i||100,this._height=n||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),t.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha){var e,i;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},t.TilingSprite.prototype._renderCanvas=function(e){if(!1!==this.visible&&0!==this.alpha){var i=e.context;this._mask&&e.maskManager.pushMask(this._mask,e),i.globalAlpha=this.worldAlpha;var n,r,s=this.worldTransform,o=e.resolution;if(i.setTransform(s.a*o,s.b*o,s.c*o,s.d*o,s.tx*o,s.ty*o),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,i.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var a=this.tilePosition,h=this.tileScale;for(a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,i.scale(h.x,h.y),i.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-a.x,-a.y,this._width/h.x,this._height/h.y),i.scale(1/h.x,1/h.y),i.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height),this._mask&&e.maskManager.popMask(e),n=0,r=this.children.length;n<r;n++)this.children[n]._renderCanvas(e)}},t.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,r=e*(1-this.anchor.y),s=e*-this.anchor.y,o=this.worldTransform,a=o.a,h=o.b,l=o.c,c=o.d,u=o.tx,f=o.ty,d=a*n+l*s+u,p=c*s+h*n+f,g=a*i+l*s+u,v=c*s+h*i+f,m=a*i+l*r+u,_=c*r+h*i+f,y=a*n+l*r+u,x=c*r+h*n+f,b=-1/0,w=-1/0,S=1/0,C=1/0;S=y<(S=m<(S=g<(S=d<S?d:S)?g:S)?m:S)?y:S,C=x<(C=_<(C=v<(C=p<C?p:C)?v:C)?_:C)?x:C,b=y>(b=m>(b=g>(b=d>b?d:b)?g:b)?m:b)?y:b,w=x>(w=_>(w=v>(w=p>w?p:w)?v:w)?_:w)?x:w;var T=this._bounds;return T.x=S,T.width=b-S,T.y=C,T.height=w-C,this._currentBounds=T,T},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e){if(this.texture.baseTexture.hasLoaded){var i,n,r,s=this.originalTexture||this.texture,o=s.frame,a=o.width!==s.baseTexture.width||o.height!==s.baseTexture.height,h=!1;e?(i=t.getNextPowerOfTwo(o.width),n=t.getNextPowerOfTwo(o.height),(o.width!==i||o.height!==n||s.baseTexture.width!==i||s.baseTexture.height||n)&&(h=!0)):a&&(s.trim?(i=s.trim.width,n=s.trim.height):(i=o.width,n=o.height),h=!0),h?(this.tilingTexture&&this.tilingTexture.isTiling?((r=this.tilingTexture.canvasBuffer).resize(i,n),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=n,this.tilingTexture.needsUpdate=!0):(r=new t.CanvasBuffer(i,n),this.tilingTexture=t.Texture.fromCanvas(r.canvas),this.tilingTexture.canvasBuffer=r,this.tilingTexture.isTiling=!0),r.context.drawImage(s.baseTexture.source,s.crop.x,s.crop.y,s.crop.width,s.crop.height,0,0,i,n),this.tileScaleOffset.x=o.width/i,this.tileScaleOffset.y=o.height/n):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=s),this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},t.TilingSprite.prototype.destroy=function(){t.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};var e={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array,BoneData:function(t,e){this.name=t,this.parent=e}};e.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},e.SlotData=function(t,e){this.name=t,this.boneData=e},e.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},e.IkConstraintData=function(t){this.name=t,this.bones=[]},e.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},e.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},e.Bone.yDown=!1,e.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var i=this.skeleton.flipX,n=this.skeleton.flipY;this.worldX=i?-this.x:this.x,this.worldY=n!=e.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=i!=this.flipX,this.worldFlipY=n!=this.flipY}var r=this.worldRotation*e.degRad,s=Math.cos(r),o=Math.sin(r);this.worldFlipX?(this.m00=-s*this.worldScaleX,this.m01=o*this.worldScaleY):(this.m00=s*this.worldScaleX,this.m01=-o*this.worldScaleY),this.worldFlipY!=e.Bone.yDown?(this.m10=-o*this.worldScaleX,this.m11=-s*this.worldScaleY):(this.m10=o*this.worldScaleX,this.m11=s*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var i=t[0]-this.worldX,n=t[1]-this.worldY,r=this.m00,s=this.m10,o=this.m01,a=this.m11;this.worldFlipX!=(this.worldFlipY!=e.Bone.yDown)&&(r=-r,a=-a);var h=1/(r*a-o*s);t[0]=i*r*h-n*o*h,t[1]=n*a*h-i*s*h},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},e.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},e.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;i<n;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},e.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},e.IkConstraint.prototype={apply:function(){var t=this.target,i=this.bones;switch(i.length){case 1:e.IkConstraint.apply1(i[0],t.worldX,t.worldY,this.mix);break;case 2:e.IkConstraint.apply2(i[0],i[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},e.IkConstraint.apply1=function(t,i,n,r){var s=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,o=t.rotation,a=Math.atan2(n-t.worldY,i-t.worldX)*e.radDeg-s;t.rotationIK=o+(a-o)*r},e.IkConstraint.apply2=function(t,i,n,r,s,o){var a=i.rotation,h=t.rotation;if(!o)return i.rotationIK=a,void(t.rotationIK=h);var l,c,u=e.temp,f=t.parent;f?(u[0]=n,u[1]=r,f.worldToLocal(u),n=(u[0]-t.x)*f.worldScaleX,r=(u[1]-t.y)*f.worldScaleY):(n-=t.x,r-=t.y),i.parent==t?(l=i.x,c=i.y):(u[0]=i.x,u[1]=i.y,i.parent.localToWorld(u),t.worldToLocal(u),l=u[0],c=u[1]);var d=l*t.worldScaleX,p=c*t.worldScaleY,g=Math.atan2(p,d),v=Math.sqrt(d*d+p*p),m=i.data.length*i.worldScaleX,_=2*v*m;if(_<1e-4)i.rotationIK=a+(Math.atan2(r,n)*e.radDeg-h-a)*o;else{var y=(n*n+r*r-v*v-m*m)/_;y<-1?y=-1:y>1&&(y=1);var x=Math.acos(y)*s,b=v+m*y,w=m*Math.sin(x),S=(Math.atan2(r*b-n*w,n*b+r*w)-g)*e.radDeg-h;S>180?S-=360:S<-180&&(S+=360),t.rotationIK=h+S*o,(S=(x+g)*e.radDeg-a)>180?S-=360:S<-180&&(S+=360),i.rotationIK=a+(S+t.worldRotation-i.parent.worldRotation)*o}},e.Skin=function(t){this.name=t,this.attachments={}},e.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),s=i.substring(n+1),o=t.slots[r];if(o.attachment&&o.attachment.name==s){var a=this.getAttachment(r,s);a&&o.setAttachment(a)}}}},e.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},e.Animation.prototype={apply:function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var s=this.timelines,o=0,a=s.length;o<a;o++)s[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,s){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var o=this.timelines,a=0,h=o.length;a<h;a++)o[a].apply(t,e,i,r,s)}},e.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e?n=s+1:r=s,n==r)return(n+1)*i;s=n+r>>>1}},e.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}},e.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1},e.Curves=function(t){this.curves=[]},e.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var s=.1*.1*.1*6,o=2*-e+n,a=2*-i+r,h=3*(e-n)+1,l=3*(i-r)+1,c=e*(3*.1)+o*(.1*.1*3)+h*(.1*.1*.1),u=i*(3*.1)+a*(.1*.1*3)+l*(.1*.1*.1),f=o*(.1*.1*6)+h*s,d=a*(.1*.1*6)+l*s,p=h*s,g=l*s,v=19*t,m=this.curves;m[v++]=2;for(var _=c,y=u,x=v+19-1;v<x;v+=2)m[v]=_,m[v+1]=y,c+=f,u+=d,f+=p,d+=g,_+=c,y+=u},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;for(var s=0,o=++n,a=n+19-1;n<a;n+=2){var h,l;if((s=i[n])>=e)return n==o?(h=0,l=0):(h=i[n-2],l=i[n-1]),l+(i[n+1]-l)*(e-h)/(s-h)}var c=i[n-1];return c+(1-c)*(e-s)/(1-s)}},e.RotateTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,i,n,r,s){var o=this.frames;if(!(n<o[0])){var a=t.bones[this.boneIndex];if(n>=o[o.length-2]){for(var h=a.data.rotation+o[o.length-1]-a.rotation;h>180;)h-=360;for(;h<-180;)h+=360;a.rotation+=h*s}else{var l=e.Animation.binarySearch(o,n,2),c=o[l-1],u=o[l],f=1-(n-u)/(o[l-2]-u);for(f=this.curves.getCurvePercent(l/2-1,f),h=o[l+1]-c;h>180;)h-=360;for(;h<-180;)h+=360;for(h=a.data.rotation+(c+h*f)-a.rotation;h>180;)h-=360;for(;h<-180;)h+=360;a.rotation+=h*s}}}},e.TranslateTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,i,n,r,s){var o=this.frames;if(!(n<o[0])){var a=t.bones[this.boneIndex];if(n>=o[o.length-3])return a.x+=(a.data.x+o[o.length-2]-a.x)*s,void(a.y+=(a.data.y+o[o.length-1]-a.y)*s);var h=e.Animation.binarySearch(o,n,3),l=o[h-2],c=o[h-1],u=o[h],f=1-(n-u)/(o[h+-3]-u);f=this.curves.getCurvePercent(h/3-1,f),a.x+=(a.data.x+l+(o[h+1]-l)*f-a.x)*s,a.y+=(a.data.y+c+(o[h+2]-c)*f-a.y)*s}}},e.ScaleTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,i,n,r,s){var o=this.frames;if(!(n<o[0])){var a=t.bones[this.boneIndex];if(n>=o[o.length-3])return a.scaleX+=(a.data.scaleX*o[o.length-2]-a.scaleX)*s,void(a.scaleY+=(a.data.scaleY*o[o.length-1]-a.scaleY)*s);var h=e.Animation.binarySearch(o,n,3),l=o[h-2],c=o[h-1],u=o[h],f=1-(n-u)/(o[h+-3]-u);f=this.curves.getCurvePercent(h/3-1,f),a.scaleX+=(a.data.scaleX*(l+(o[h+1]-l)*f)-a.scaleX)*s,a.scaleY+=(a.data.scaleY*(c+(o[h+2]-c)*f)-a.scaleY)*s}}},e.ColorTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=5*t},e.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=s},apply:function(t,i,n,r,s){var o=this.frames;if(!(n<o[0])){var a,h,l,c;if(n>=o[o.length-5]){var u=o.length-1;a=o[u-3],h=o[u-2],l=o[u-1],c=o[u]}else{var f=e.Animation.binarySearch(o,n,5),d=o[f-4],p=o[f-3],g=o[f-2],v=o[f-1],m=o[f],_=1-(n-m)/(o[f-5]-m);_=this.curves.getCurvePercent(f/5-1,_),a=d+(o[f+1]-d)*_,h=p+(o[f+2]-p)*_,l=g+(o[f+3]-g)*_,c=v+(o[f+4]-v)*_}var y=t.slots[this.slotIndex];s<1?(y.r+=(a-y.r)*s,y.g+=(h-y.g)*s,y.b+=(l-y.b)*s,y.a+=(c-y.a)*s):(y.r=a,y.g=h,y.b=l,y.a=c)}}},e.AttachmentTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},e.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,i,n,r,s){var o=this.frames;if(n<o[0])i>n&&this.apply(t,i,Number.MAX_VALUE,null,0);else{i>n&&(i=-1);var a=n>=o[o.length-1]?o.length-1:e.Animation.binarySearch1(o,n)-1;if(!(o[a]<i)){var h=this.attachmentNames[a];t.slots[this.slotIndex].setAttachment(h?t.getAttachmentBySlotIndex(this.slotIndex,h):null)}}}},e.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},e.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,i,n,r,s){if(r){var o=this.frames,a=o.length;if(i>n)this.apply(t,i,Number.MAX_VALUE,r,s),i=-1;else if(i>=o[a-1])return;if(!(n<o[0])){var h;if(i<o[0])h=0;else for(var l=o[h=e.Animation.binarySearch1(o,i)];h>0&&o[h-1]==l;)h--;for(var c=this.events;h<a&&n>=o[h];h++)r.push(c[h])}}}},e.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},e.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,i,n,r,s){var o=this.frames;if(!(n<o[0])){var a;a=n>=o[o.length-1]?o.length-1:e.Animation.binarySearch1(o,n)-1;var h=t.drawOrder,l=(t.slots,this.drawOrders[a]);if(l)for(var c=0,u=l.length;c<u;c++)h[c]=l[c]}}},e.FfdTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},e.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,i,n,r,s){var o=t.slots[this.slotIndex];if(o.attachment==this.attachment){var a=this.frames;if(!(n<a[0])){var h=this.frameVertices,l=h[0].length,c=o.attachmentVertices;if(c.length!=l&&(s=1),c.length=l,n>=a[a.length-1]){var u=h[a.length-1];if(s<1)for(var f=0;f<l;f++)c[f]+=(u[f]-c[f])*s;else for(f=0;f<l;f++)c[f]=u[f]}else{var d=e.Animation.binarySearch1(a,n),p=a[d],g=1-(n-p)/(a[d-1]-p);g=this.curves.getCurvePercent(d-1,g<0?0:g>1?1:g);var v=h[d-1],m=h[d];if(s<1)for(f=0;f<l;f++){var _=v[f];c[f]+=(_+(m[f]-_)*g-c[f])*s}else for(f=0;f<l;f++)_=v[f],c[f]=_+(m[f]-_)*g}}}}},e.IkConstraintTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,i,n,r,s){var o=this.frames;if(!(n<o[0])){var a=t.ikConstraints[this.ikConstraintIndex];if(n>=o[o.length-3])return a.mix+=(o[o.length-2]-a.mix)*s,void(a.bendDirection=o[o.length-1]);var h=e.Animation.binarySearch(o,n,3),l=o[h+-2],c=o[h],u=1-(n-c)/(o[h+-3]-c);u=this.curves.getCurvePercent(h/3-1,u);var f=l+(o[h+1]-l)*u;a.mix+=(f-a.mix)*s,a.bendDirection=o[h+-1]}}},e.FlipXTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,i,n,r,s){var o=this.frames;if(n<o[0])i>n&&this.apply(t,i,Number.MAX_VALUE,null,0);else{i>n&&(i=-1);var a=(n>=o[o.length-2]?o.length:e.Animation.binarySearch(o,n,2))-2;o[a]<i||(t.bones[boneIndex].flipX=0!=o[a+1])}}},e.FlipYTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,i,n,r,s){var o=this.frames;if(n<o[0])i>n&&this.apply(t,i,Number.MAX_VALUE,null,0);else{i>n&&(i=-1);var a=(n>=o[o.length-2]?o.length:e.Animation.binarySearch(o,n,2))-2;o[a]<i||(t.bones[boneIndex].flipY=0!=o[a+1])}}},e.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},e.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}},e.Skeleton=function(t){this.data=t,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++){var r=t.bones[i],s=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new e.Bone(r,this,s))}for(this.slots=[],this.drawOrder=[],i=0,n=t.slots.length;i<n;i++){var o=t.slots[i],a=this.bones[t.bones.indexOf(o.boneData)],h=new e.Slot(o,a);this.slots.push(h),this.drawOrder.push(i)}for(this.ikConstraints=[],i=0,n=t.ikConstraints.length;i<n;i++)this.ikConstraints.push(new e.IkConstraint(t.ikConstraints[i],this));this.boneCache=[],this.updateCache()},e.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;n.length>i&&(n.length=i);for(var r=0,s=n.length;r<s;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var o=n[0],a=this.bones;t:for(r=0,s=a.length;r<s;r++){var h=a[r],l=h;do{for(var c=0;c<e;c++)for(var u=t[c],f=u.bones[0],d=u.bones[u.bones.length-1];;){if(l==d){n[c].push(h),n[c+1].push(h);continue t}if(d==f)break;d=d.parent}l=l.parent}while(l);o[o.length]=h}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}e=0;for(var r=this.boneCache.length-1;;){for(var s=this.boneCache[e],o=0,a=s.length;o<a;o++)s[o].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,i=t.length;e<i;e++)t[e].setToSetupPose(e);this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],s=r.data.attachmentName;if(s){var o=t.getAttachment(i,s);o&&r.setAttachment(o)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;n<r;n++){var s=i[n];if(s.data.name==t){var o=null;if(e&&!(o=this.getAttachmentBySlotIndex(n,e)))throw"Attachment not found: "+e+", for slot: "+t;return void s.setAttachment(o)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t},resetDrawOrder:function(){for(var t=0,e=this.drawOrder.length;t<e;t++)this.drawOrder[t]=t}},e.EventData=function(t){this.name=t},e.EventData.prototype={intValue:0,floatValue:0,stringValue:null},e.Event=function(t){this.data=t},e.Event.prototype={intValue:0,floatValue:0,stringValue:null},e.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},e.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},e.RegionAttachment.prototype={type:e.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var s=this.uvs;r?(s[2]=t,s[3]=n,s[4]=t,s[5]=e,s[6]=i,s[7]=e,s[0]=i,s[1]=n):(s[0]=t,s[1]=n,s[2]=t,s[3]=e,s[4]=i,s[5]=e,s[6]=i,s[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,i=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*i,s=n+this.regionWidth*t,o=r+this.regionHeight*i,a=this.rotation*e.degRad,h=Math.cos(a),l=Math.sin(a),c=n*h+this.x,u=n*l,f=r*h+this.y,d=r*l,p=s*h+this.x,g=s*l,v=o*h+this.y,m=o*l,_=this.offset;_[0]=c-d,_[1]=f+u,_[2]=c-m,_[3]=v+u,_[4]=p-m,_[5]=v+g,_[6]=p-d,_[7]=f+g},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,s=i.m01,o=i.m10,a=i.m11,h=this.offset;n[0]=h[0]*r+h[1]*s+t,n[1]=h[0]*o+h[1]*a+e,n[2]=h[2]*r+h[3]*s+t,n[3]=h[2]*o+h[3]*a+e,n[4]=h[4]*r+h[5]*s+t,n[5]=h[4]*o+h[5]*a+e,n[6]=h[6]*r+h[7]*s+t,n[7]=h[6]*o+h[7]*a+e}},e.MeshAttachment=function(t){this.name=t},e.MeshAttachment.prototype={type:e.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,i=this.regionV2-this.regionV,n=this.regionUVs.length;if(this.uvs&&this.uvs.length==n||(this.uvs=new e.Float32Array(n)),this.regionRotate)for(var r=0;r<n;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r+1]*t,this.uvs[r+1]=this.regionV+i-this.regionUVs[r]*i;else for(r=0;r<n;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r]*t,this.uvs[r+1]=this.regionV+this.regionUVs[r+1]*i},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var s=r.m00,o=r.m01,a=r.m10,h=r.m11,l=this.vertices,c=l.length;i.attachmentVertices.length==c&&(l=i.attachmentVertices);for(var u=0;u<c;u+=2){var f=l[u],d=l[u+1];n[u]=f*s+d*o+t,n[u+1]=f*a+d*h+e}}},e.SkinnedMeshAttachment=function(t){this.name=t},e.SkinnedMeshAttachment.prototype={type:e.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,i,n,r,s){var o=this.regionU2-this.regionU,a=this.regionV2-this.regionV,h=this.regionUVs.length;if(this.uvs&&this.uvs.length==h||(this.uvs=new e.Float32Array(h)),this.regionRotate)for(var l=0;l<h;l+=2)this.uvs[l]=this.regionU+this.regionUVs[l+1]*o,this.uvs[l+1]=this.regionV+a-this.regionUVs[l]*a;else for(l=0;l<h;l+=2)this.uvs[l]=this.regionU+this.regionUVs[l]*o,this.uvs[l+1]=this.regionV+this.regionUVs[l+1]*a},computeWorldVertices:function(t,e,i,n){var r,s,o,a,h,l,c,u=i.bone.skeleton.bones,f=this.weights,d=this.bones,p=0,g=0,v=0,m=0,_=d.length;if(i.attachmentVertices.length)for(var y=i.attachmentVertices;g<_;p+=2){for(s=0,o=0,r=d[g++]+g;g<r;g++,v+=3,m+=2)a=u[d[g]],h=f[v]+y[m],l=f[v+1]+y[m+1],c=f[v+2],s+=(h*a.m00+l*a.m01+a.worldX)*c,o+=(h*a.m10+l*a.m11+a.worldY)*c;n[p]=s+t,n[p+1]=o+e}else for(;g<_;p+=2){for(s=0,o=0,r=d[g++]+g;g<r;g++,v+=3)a=u[d[g]],h=f[v],l=f[v+1],c=f[v+2],s+=(h*a.m00+l*a.m01+a.worldX)*c,o+=(h*a.m10+l*a.m11+a.worldY)*c;n[p]=s+t,n[p+1]=o+e}}},e.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},e.BoundingBoxAttachment.prototype={type:e.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;for(var r=i.m00,s=i.m01,o=i.m10,a=i.m11,h=this.vertices,l=0,c=h.length;l<c;l+=2){var u=h[l],f=h[l+1];n[l]=u*r+f*s+t,n[l+1]=u*o+f*a+e}}},e.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},e.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},e.TrackEntry=function(){},e.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},e.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},e.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;r?(r.time=i.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){t.resetDrawOrder();for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,s=i.endTime,o=i.loop;!o&&n>s&&(n=s);var a=i.previous;if(a){var h=a.time;!a.loop&&h>a.endTime&&(h=a.endTime),a.animation.apply(t,h,h,a.loop,null);var l=i.mixTime/i.mixDuration*i.mix;l>=1&&(l=1,i.previous=null),i.animation.mix(t,i.lastTime,n,o,this.events,l)}else 1==i.mix?i.animation.apply(t,i.lastTime,n,o,this.events):i.animation.mix(t,i.lastTime,n,o,this.events,i.mix);for(var c=0,u=this.events.length;c<u;c++){var f=this.events[c];i.onEvent&&i.onEvent(e,f),this.onEvent&&this.onEvent(e,f)}if(o?r%s>n%s:r<s&&n>=s){var d=Math.floor(n/s);i.onComplete&&i.onComplete(e,d),this.onComplete&&this.onComplete(e,d)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,n&&i.mixTime/i.mixDuration<.5?e.previous=n:e.previous=i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,i,n){var r=new e.TrackEntry;return r.animation=i,r.loop=n,r.endTime=i.duration,this.setCurrent(t,r),r},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,i,n,r){var s=new e.TrackEntry;s.animation=i,s.loop=n,s.endTime=i.duration;var o=this._expandToIndex(t);if(o){for(;o.next;)o=o.next;o.next=s}else this.tracks[t]=s;return r<=0&&(o?r+=o.endTime-this.data.getMix(o.animation,i):r=0),s.delay=r,s},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},e.SkeletonJson=function(t){this.attachmentLoader=t},e.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,i){var n=new e.SkeletonData;n.name=i;var r=t.skeleton;r&&(n.hash=r.hash,n.version=r.spine,n.width=r.width||0,n.height=r.height||0);for(var s=0,o=(c=t.bones).length;s<o;s++){var a=c[s],h=null;if(a.parent&&!(h=n.findBone(a.parent)))throw"Parent bone not found: "+a.parent;(m=new e.BoneData(a.name,h)).length=(a.length||0)*this.scale,m.x=(a.x||0)*this.scale,m.y=(a.y||0)*this.scale,m.rotation=a.rotation||0,m.scaleX=a.hasOwnProperty("scaleX")?a.scaleX:1,m.scaleY=a.hasOwnProperty("scaleY")?a.scaleY:1,m.inheritScale=!a.hasOwnProperty("inheritScale")||a.inheritScale,m.inheritRotation=!a.hasOwnProperty("inheritRotation")||a.inheritRotation,n.bones.push(m)}var l=t.ik;if(l)for(s=0,o=l.length;s<o;s++){for(var c,u=l[s],f=new e.IkConstraintData(u.name),d=0,p=(c=u.bones).length;d<p;d++){var g=n.findBone(c[d]);if(!g)throw"IK bone not found: "+c[d];f.bones.push(g)}if(f.target=n.findBone(u.target),!f.target)throw"Target bone not found: "+u.target;f.bendDirection=!u.hasOwnProperty("bendPositive")||u.bendPositive?1:-1,f.mix=u.hasOwnProperty("mix")?u.mix:1,n.ikConstraints.push(f)}var v=t.slots;for(s=0,o=v.length;s<o;s++){var m,_=v[s];if(!(m=n.findBone(_.bone)))throw"Slot bone not found: "+_.bone;var y=new e.SlotData(_.name,m),x=_.color;x&&(y.r=this.toColor(x,0),y.g=this.toColor(x,1),y.b=this.toColor(x,2),y.a=this.toColor(x,3)),y.attachmentName=_.attachment,y.additiveBlending=_.additive&&"true"==_.additive,n.slots.push(y)}var b=t.skins;for(var w in b)if(b.hasOwnProperty(w)){var S=b[w],C=new e.Skin(w);for(var T in S)if(S.hasOwnProperty(T)){var k=n.findSlotIndex(T),E=S[T];for(var A in E)if(E.hasOwnProperty(A)){var M=this.readAttachment(C,A,E[A]);M&&C.addAttachment(k,A,M)}}n.skins.push(C),"default"==C.name&&(n.defaultSkin=C)}var D=t.events;for(var O in D)if(D.hasOwnProperty(O)){var L=D[O],P=new e.EventData(O);P.intValue=L.int||0,P.floatValue=L.float||0,P.stringValue=L.string||null,n.events.push(P)}var B=t.animations;for(var I in B)B.hasOwnProperty(I)&&this.readAnimation(I,B[I],n);return n},readAttachment:function(t,i,n){i=n.name||i;var r=e.AttachmentType[n.type||"region"],s=n.path||i,o=this.scale;if(r==e.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,i,s);if(!a)return null;a.path=s,a.x=(n.x||0)*o,a.y=(n.y||0)*o,a.scaleX=n.hasOwnProperty("scaleX")?n.scaleX:1,a.scaleY=n.hasOwnProperty("scaleY")?n.scaleY:1,a.rotation=n.rotation||0,a.width=(n.width||0)*o,a.height=(n.height||0)*o;var h=n.color;return h&&(a.r=this.toColor(h,0),a.g=this.toColor(h,1),a.b=this.toColor(h,2),a.a=this.toColor(h,3)),a.updateOffset(),a}if(r==e.AttachmentType.mesh)return(l=this.attachmentLoader.newMeshAttachment(t,i,s))?(l.path=s,l.vertices=this.getFloatArray(n,"vertices",o),l.triangles=this.getIntArray(n,"triangles"),l.regionUVs=this.getFloatArray(n,"uvs",1),l.updateUVs(),(h=n.color)&&(l.r=this.toColor(h,0),l.g=this.toColor(h,1),l.b=this.toColor(h,2),l.a=this.toColor(h,3)),l.hullLength=2*(n.hull||0),n.edges&&(l.edges=this.getIntArray(n,"edges")),l.width=(n.width||0)*o,l.height=(n.height||0)*o,l):null;if(r==e.AttachmentType.skinnedmesh){var l;if(!(l=this.attachmentLoader.newSkinnedMeshAttachment(t,i,s)))return null;l.path=s;for(var c=this.getFloatArray(n,"uvs",1),u=[],f=[],d=0,p=(m=this.getFloatArray(n,"vertices",1)).length;d<p;){var g=0|m[d++];f[f.length]=g;for(var v=d+4*g;d<v;)f[f.length]=m[d],u[u.length]=m[d+1]*o,u[u.length]=m[d+2]*o,u[u.length]=m[d+3],d+=4}return l.bones=f,l.weights=u,l.triangles=this.getIntArray(n,"triangles"),l.regionUVs=c,l.updateUVs(),(h=n.color)&&(l.r=this.toColor(h,0),l.g=this.toColor(h,1),l.b=this.toColor(h,2),l.a=this.toColor(h,3)),l.hullLength=2*(n.hull||0),n.edges&&(l.edges=this.getIntArray(n,"edges")),l.width=(n.width||0)*o,l.height=(n.height||0)*o,l}if(r==e.AttachmentType.boundingbox){var m,_=this.attachmentLoader.newBoundingBoxAttachment(t,i);for(d=0,p=(m=n.vertices).length;d<p;d++)_.vertices.push(m[d]*o);return _}throw"Unknown attachment type: "+r},readAnimation:function(t,i,n){var r=[],s=0,o=i.slots;for(var a in o)if(o.hasOwnProperty(a)){var h=o[a],l=n.findSlotIndex(a);for(var c in h)if(h.hasOwnProperty(c)){var u=h[c];if("color"==c){(N=new e.ColorTimeline(u.length)).slotIndex=l;for(var f=0,d=0,p=u.length;d<p;d++){var g=(x=u[d]).color,v=this.toColor(g,0),m=this.toColor(g,1),_=this.toColor(g,2),y=this.toColor(g,3);N.setFrame(f,x.time,v,m,_,y),this.readCurve(N,f,x),f++}r.push(N),s=Math.max(s,N.frames[5*N.getFrameCount()-5])}else{if("attachment"!=c)throw"Invalid timeline type for a slot: "+c+" ("+a+")";for((N=new e.AttachmentTimeline(u.length)).slotIndex=l,f=0,d=0,p=u.length;d<p;d++){var x=u[d];N.setFrame(f++,x.time,x.name)}r.push(N),s=Math.max(s,N.frames[N.getFrameCount()-1])}}}var b=i.bones;for(var w in b)if(b.hasOwnProperty(w)){var S=n.findBoneIndex(w);if(-1==S)throw"Bone not found: "+w;var C=b[w];for(var c in C)if(C.hasOwnProperty(c))if(u=C[c],"rotate"==c){for((N=new e.RotateTimeline(u.length)).boneIndex=S,f=0,d=0,p=u.length;d<p;d++)x=u[d],N.setFrame(f,x.time,x.angle),this.readCurve(N,f,x),f++;r.push(N),s=Math.max(s,N.frames[2*N.getFrameCount()-2])}else if("translate"==c||"scale"==c){var T=1;for("scale"==c?N=new e.ScaleTimeline(u.length):(N=new e.TranslateTimeline(u.length),T=this.scale),N.boneIndex=S,f=0,d=0,p=u.length;d<p;d++){var k=((x=u[d]).x||0)*T,E=(x.y||0)*T;N.setFrame(f,x.time,k,E),this.readCurve(N,f,x),f++}r.push(N),s=Math.max(s,N.frames[3*N.getFrameCount()-3])}else{if("flipX"!=c&&"flipY"!=c)throw"Invalid timeline type for a bone: "+c+" ("+w+")";(N=(k="flipX"==c)?new e.FlipXTimeline(u.length):new e.FlipYTimeline(u.length)).boneIndex=S;var A=k?"x":"y";for(f=0,d=0,p=u.length;d<p;d++)x=u[d],N.setFrame(f,x.time,x[A]||!1),f++;r.push(N),s=Math.max(s,N.frames[2*N.getFrameCount()-2])}}var M=i.ik;for(var D in M)if(M.hasOwnProperty(D)){var O=n.findIkConstraint(D);for(u=M[D],(N=new e.IkConstraintTimeline(u.length)).ikConstraintIndex=n.ikConstraints.indexOf(O),f=0,d=0,p=u.length;d<p;d++){var L=(x=u[d]).hasOwnProperty("mix")?x.mix:1,P=!x.hasOwnProperty("bendPositive")||x.bendPositive?1:-1;N.setFrame(f,x.time,L,P),this.readCurve(N,f,x),f++}r.push(N),s=Math.max(s,N.frames[3*N.frameCount-3])}var B=i.ffd;for(var I in B){var R=n.findSkin(I);for(a in h=B[I]){l=n.findSlotIndex(a);var F=h[a];for(var U in F){u=F[U];var N=new e.FfdTimeline(u.length),z=R.getAttachment(l,U);if(!z)throw"FFD attachment not found: "+U;N.slotIndex=l,N.attachment=z;var G,X=z.type==e.AttachmentType.mesh;for(G=X?z.vertices.length:z.weights.length/3*2,f=0,d=0,p=u.length;d<p;d++){if((x=u[d]).vertices){var Y,W=x.vertices;(Y=[]).length=G;var j=x.offset||0,Z=W.length;if(1==this.scale)for(var H=0;H<Z;H++)Y[H+j]=W[H];else for(H=0;H<Z;H++)Y[H+j]=W[H]*this.scale;if(X){var V=z.vertices;for(H=0,Z=Y.length;H<Z;H++)Y[H]+=V[H]}}else X?Y=z.vertices:(Y=[]).length=G;N.setFrame(f,x.time,Y),this.readCurve(N,f,x),f++}r[r.length]=N,s=Math.max(s,N.frames[N.frameCount-1])}}}var q=i.drawOrder;if(q||(q=i.draworder),q){N=new e.DrawOrderTimeline(q.length);var K=n.slots.length;for(f=0,d=0,p=q.length;d<p;d++){var J=q[d],Q=null;if(J.offsets){for((Q=[]).length=K,H=K-1;H>=0;H--)Q[H]=-1;var $=J.offsets,tt=[];tt.length=K-$.length;var et=0,it=0;for(H=0,Z=$.length;H<Z;H++){var nt=$[H];if(-1==(l=n.findSlotIndex(nt.slot)))throw"Slot not found: "+nt.slot;for(;et!=l;)tt[it++]=et++;Q[et+nt.offset]=et++}for(;et<K;)tt[it++]=et++;for(H=K-1;H>=0;H--)-1==Q[H]&&(Q[H]=tt[--it])}N.setFrame(f++,J.time,Q)}r.push(N),s=Math.max(s,N.frames[N.getFrameCount()-1])}var rt=i.events;if(rt){for(N=new e.EventTimeline(rt.length),f=0,d=0,p=rt.length;d<p;d++){var st=rt[d],ot=n.findEvent(st.name);if(!ot)throw"Event not found: "+st.name;var at=new e.Event(ot);at.intValue=st.hasOwnProperty("int")?st.int:ot.intValue,at.floatValue=st.hasOwnProperty("float")?st.float:ot.floatValue,at.stringValue=st.hasOwnProperty("string")?st.string:ot.stringValue,N.setFrame(f++,st.time,at)}r.push(N),s=Math.max(s,N.frames[N.getFrameCount()-1])}n.animations.push(new e.Animation(t,r,s))},readCurve:function(t,e,i){var n=i.curve;n?"stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,i,n){var r=t[i],s=new e.Float32Array(r.length),o=0,a=r.length;if(1==n)for(;o<a;o++)s[o]=r[o];else for(;o<a;o++)s[o]=r[o]*n;return s},getIntArray:function(t,i){for(var n=t[i],r=new e.Uint16Array(n.length),s=0,o=n.length;s<o;s++)r[s]=0|n[s];return r}},e.Atlas=function(t,i){this.textureLoader=i,this.pages=[],this.regions=[];var n=new e.AtlasReader(t),r=[];r.length=4;for(var s=null;;){var o=n.readLine();if(null===o)break;if((o=n.trim(o)).length)if(s){var a=new e.AtlasRegion;a.name=o,a.page=s,a.rotate="true"==n.readValue(),n.readTuple(r);var h=parseInt(r[0]),l=parseInt(r[1]);n.readTuple(r);var c=parseInt(r[0]),u=parseInt(r[1]);a.u=h/s.width,a.v=l/s.height,a.rotate?(a.u2=(h+u)/s.width,a.v2=(l+c)/s.height):(a.u2=(h+c)/s.width,a.v2=(l+u)/s.height),a.x=h,a.y=l,a.width=Math.abs(c),a.height=Math.abs(u),4==n.readTuple(r)&&(a.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(a.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),a.originalWidth=parseInt(r[0]),a.originalHeight=parseInt(r[1]),n.readTuple(r),a.offsetX=parseInt(r[0]),a.offsetY=parseInt(r[1]),a.index=parseInt(n.readValue()),this.regions.push(a)}else{(s=new e.AtlasPage).name=o,2==n.readTuple(r)&&(s.width=parseInt(r[0]),s.height=parseInt(r[1]),n.readTuple(r)),s.format=e.Atlas.Format[r[0]],n.readTuple(r),s.minFilter=e.Atlas.TextureFilter[r[0]],s.magFilter=e.Atlas.TextureFilter[r[1]];var f=n.readValue();s.uWrap=e.Atlas.TextureWrap.clampToEdge,s.vWrap=e.Atlas.TextureWrap.clampToEdge,"x"==f?s.uWrap=e.Atlas.TextureWrap.repeat:"y"==f?s.vWrap=e.Atlas.TextureWrap.repeat:"xy"==f&&(s.uWrap=s.vWrap=e.Atlas.TextureWrap.repeat),i.load(s,o,this),this.pages.push(s)}else s=null}},e.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;e<i;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++){var r=e[i];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},e.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},e.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},e.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},e.AtlasPage=function(){},e.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},e.AtlasRegion=function(){},e.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},e.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},e.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var n=0,r=i+1;n<3;n++){var s=e.indexOf(",",r);if(-1==s)break;t[n]=this.trim(e.substr(r,s-r)),r=s+1}return t[n]=this.trim(e.substring(r)),n+1}},e.AtlasAttachmentLoader=function(t){this.atlas=t},e.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,i,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (region attachment: "+i+")";var s=new e.RegionAttachment(i);return s.rendererObject=r,s.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newMeshAttachment:function(t,i,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (mesh attachment: "+i+")";var s=new e.MeshAttachment(i);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newSkinnedMeshAttachment:function(t,i,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (skinned mesh attachment: "+i+")";var s=new e.SkinnedMeshAttachment(i);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newBoundingBoxAttachment:function(t,i){return new e.BoundingBoxAttachment(i)}},e.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},e.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,i){var n=t.slots,r=n.length,s=t.x,o=t.y,a=this.boundingBoxes,h=this.polygonPool,l=this.polygons;a.length=0;for(var c=0,u=l.length;c<u;c++)h.push(l[c]);for(l.length=0,c=0;c<r;c++){var f=n[c],d=f.attachment;if(d.type==e.AttachmentType.boundingbox){a.push(d);var p,g=h.length;g>0?(p=h[g-1],h.splice(g-1,1)):p=[],l.push(p),p.length=d.vertices.length,d.computeWorldVertices(s,o,f.bone,p)}}i&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,s=0,o=t.length;s<o;s++)for(var a=t[s],h=0,l=a.length;h<l;h+=2){var c=a[h],u=a[h+1];e=Math.min(e,c),i=Math.min(i,u),n=Math.max(n,c),r=Math.max(r,u)}this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(t<=r&&i<=r||e<=s&&n<=s||t>=o&&i>=o||e>=a&&n>=a)return!1;var h=(n-e)/(i-t),l=h*(r-t)+e;if(l>s&&l<a)return!0;if((l=h*(o-t)+e)>s&&l<a)return!0;var c=(s-e)/h+t;return c>r&&c<o||(c=(a-e)/h+t)>r&&c<o},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,s=0,o=r.length;s<o;s++)if(r[s].intersectsSegment(t,e,i,n))return this.boundingBoxes[s];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,s=!1,o=0;o<n;o+=2){var a=t[o+1],h=t[r+1];if(a<i&&h>=i||h<i&&a>=i){var l=t[o];l+(i-a)/(h-a)*(t[r]-l)<e&&(s=!s)}r=o}return s},polygonIntersectsSegment:function(t,e,i,n,r){for(var s=t.length,o=e-n,a=i-r,h=e*r-i*n,l=t[s-2],c=t[s-1],u=0;u<s;u+=2){var f=t[u],d=t[u+1],p=l*d-c*f,g=l-f,v=c-d,m=o*v-a*g,_=(h*g-o*p)/m;if((_>=l&&_<=f||_>=f&&_<=l)&&(_>=e&&_<=n||_>=n&&_<=e)){var y=(h*v-a*p)/m;if((y>=c&&y<=d||y>=d&&y<=c)&&(y>=i&&y<=r||y>=r&&y<=i))return!0}l=f,c=d}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},e.Bone.yDown=!0,t.AnimCache={},t.SpineTextureLoader=function(e,i){t.EventTarget.call(this),this.basePath=e,this.crossorigin=i,this.loadingCount=0},t.SpineTextureLoader.prototype=t.SpineTextureLoader,t.SpineTextureLoader.prototype.load=function(e,i){if(e.rendererObject=t.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin),!e.rendererObject.hasLoaded){var n=this;++n.loadingCount,e.rendererObject.addEventListener("loaded",function(){--n.loadingCount,n.dispatchEvent({type:"loadedBaseTexture",content:n})})}},t.SpineTextureLoader.prototype.unload=function(t){t.destroy(!0)},t.Spine=function(i){if(t.DisplayObjectContainer.call(this),this.spineData=t.AnimCache[i],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+i);this.skeleton=new e.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new e.AnimationStateData(this.spineData),this.state=new e.AnimationState(this.stateData),this.slotContainers=[];for(var n=0,r=this.skeleton.slots.length;n<r;n++){var s=this.skeleton.slots[n],o=s.attachment,a=new t.DisplayObjectContainer;if(this.slotContainers.push(a),this.addChild(a),o instanceof e.RegionAttachment){var h=o.rendererObject.name,l=this.createSprite(s,o);s.currentSprite=l,s.currentSpriteName=h,a.addChild(l)}else{if(!(o instanceof e.MeshAttachment))continue;var c=this.createMesh(s,o);s.currentMesh=c,s.currentMeshName=o.name,a.addChild(c)}}this.autoUpdate=!0},t.Spine.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Spine.prototype.constructor=t.Spine,Object.defineProperty(t.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===t.Spine.prototype.autoUpdateTransform},set:function(e){this.updateTransform=e?t.Spine.prototype.autoUpdateTransform:t.DisplayObjectContainer.prototype.updateTransform}}),t.Spine.prototype.update=function(i){this.state.update(i),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var n=this.skeleton.drawOrder,r=this.skeleton.slots,s=0,o=n.length;s<o;s++)this.children[s]=this.slotContainers[n[s]];for(s=0,o=r.length;s<o;s++){var a=r[s],h=a.attachment,l=this.slotContainers[s];if(h){var c=h.type;if(c===e.AttachmentType.region){if(h.rendererObject&&(!a.currentSpriteName||a.currentSpriteName!==h.name)){var u=h.rendererObject.name;if(void 0!==a.currentSprite&&(a.currentSprite.visible=!1),a.sprites=a.sprites||{},void 0!==a.sprites[u])a.sprites[u].visible=!0;else{var f=this.createSprite(a,h);l.addChild(f)}a.currentSprite=a.sprites[u],a.currentSpriteName=u}var d=a.bone;l.position.x=d.worldX+h.x*d.m00+h.y*d.m01,l.position.y=d.worldY+h.x*d.m10+h.y*d.m11,l.scale.x=d.worldScaleX,l.scale.y=d.worldScaleY,l.rotation=-a.bone.worldRotation*e.degRad,a.currentSprite.tint=t.rgb2hex([a.r,a.g,a.b])}else{if(c!==e.AttachmentType.skinnedmesh){l.visible=!1;continue}if(!a.currentMeshName||a.currentMeshName!==h.name){var p=h.name;if(void 0!==a.currentMesh&&(a.currentMesh.visible=!1),a.meshes=a.meshes||{},void 0!==a.meshes[p])a.meshes[p].visible=!0;else{var g=this.createMesh(a,h);l.addChild(g)}a.currentMesh=a.meshes[p],a.currentMeshName=p}h.computeWorldVertices(a.bone.skeleton.x,a.bone.skeleton.y,a,a.currentMesh.vertices)}l.visible=!0,l.alpha=a.a}else l.visible=!1}},t.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(e),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Spine.prototype.createSprite=function(i,n){var r=n.rendererObject,s=r.page.rendererObject,o=new t.Rectangle(r.x,r.y,r.rotate?r.height:r.width,r.rotate?r.width:r.height),a=new t.Texture(s,o),h=new t.Sprite(a),l=r.rotate?.5*Math.PI:0;return h.scale.set(r.width/r.originalWidth,r.height/r.originalHeight),h.rotation=l-n.rotation*e.degRad,h.anchor.x=h.anchor.y=.5,i.sprites=i.sprites||{},i.sprites[r.name]=h,h},t.Spine.prototype.createMesh=function(e,i){var n=i.rendererObject.page.rendererObject,r=new t.Texture(n),s=new t.Strip(r);return s.drawMode=t.Strip.DrawModes.TRIANGLES,s.canvasPadding=1.5,s.vertices=new t.Float32Array(i.uvs.length),s.uvs=i.uvs,s.indices=i.triangles,e.meshes=e.meshes||{},e.meshes[i.name]=s,s},t.BaseTextureCache={},t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this._UID=t._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],e){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var n=this;this.source.onload=function(){n.hasLoaded=!0,n.width=n.source.naturalWidth||n.source.width,n.height=n.source.naturalHeight||n.source.height,n.dirty(),n.dispatchEvent({type:"loaded",content:n})},this.source.onerror=function(){n.dispatchEvent({type:"error",content:n})}}this.imageUrl=null,this._powerOf2=!1}},t.BaseTexture.prototype.constructor=t.BaseTexture,t.EventTarget.mixin(t.BaseTexture.prototype),t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},t.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1,this.source.src=null,this.source.src=t},t.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},t.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var e=this._glTextures.length-1;e>=0;e--){var i=this._glTextures[e],n=t.glContexts[e];n&&i&&n.deleteTexture(i)}this._glTextures.length=0,this.dirty()},t.BaseTexture.fromImage=function(e,i,n){var r=t.BaseTextureCache[e];if(void 0===i&&-1===e.indexOf("data:")&&(i=!0),!r){var s=new Image;i&&(s.crossOrigin=""),s.src=e,(r=new t.BaseTexture(s,n)).imageUrl=e,t.BaseTextureCache[e]=r,-1!==e.indexOf(t.RETINA_PREFIX+".")&&(r.resolution=2)}return r},t.BaseTexture.fromCanvas=function(e,i){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var n=t.BaseTextureCache[e._pixiId];return n||(n=new t.BaseTexture(e,i),t.BaseTextureCache[e._pixiId]=n),n},t.TextureCache={},t.FrameCache={},t.TextureCacheIdGenerator=0,t.Texture=function(e,i,n,r){this.noFrame=!1,i||(this.noFrame=!0,i=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=i,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=n||new t.Rectangle(0,0,1,1),e.hasLoaded?(this.noFrame&&(i=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(i)):e.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},t.Texture.prototype.constructor=t.Texture,t.EventTarget.mixin(t.Texture.prototype),t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},t.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,i=this.baseTexture.width,n=this.baseTexture.height;this._uvs.x0=e.x/i,this._uvs.y0=e.y/n,this._uvs.x1=(e.x+e.width)/i,this._uvs.y1=e.y/n,this._uvs.x2=(e.x+e.width)/i,this._uvs.y2=(e.y+e.height)/n,this._uvs.x3=e.x/i,this._uvs.y3=(e.y+e.height)/n},t.Texture.fromImage=function(e,i,n){var r=t.TextureCache[e];return r||(r=new t.Texture(t.BaseTexture.fromImage(e,i,n)),t.TextureCache[e]=r),r},t.Texture.fromFrame=function(e){var i=t.TextureCache[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return i},t.Texture.fromCanvas=function(e,i){var n=t.BaseTexture.fromCanvas(e,i);return new t.Texture(n)},t.Texture.addTextureToCache=function(e,i){t.TextureCache[i]=e},t.Texture.removeTextureFromCache=function(e){var i=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],i},t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.Texture.emptyTexture=new t.Texture(new t.BaseTexture),t.RenderTexture=function(e,i,n,r,s){if(this.width=e||100,this.height=i||100,this.resolution=s||1,this.frame=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=r||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,t.Texture.call(this,this.baseTexture,new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=n||t.defaultRenderer,this.renderer.type===t.WEBGL_RENDERER){var o=this.renderer.gl;this.baseTexture._dirty[o.id]=!1,this.textureBuffer=new t.FilterTexture(o,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[o.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,i,n){e===this.width&&i===this.height||(this.valid=e>0&&i>0,this.width=e,this.height=i,this.frame.width=this.crop.width=e*this.resolution,this.frame.height=this.crop.height=i*this.resolution,n&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},t.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},t.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1),t.worldAlpha=1;for(var r=t.children,s=0,o=r.length;s<o;s++)r[s].updateTransform();var a=this.renderer.gl;a.viewport(0,0,this.width*this.resolution,this.height*this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},t.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),e&&n.append(e),t.worldAlpha=1;for(var r=t.children,s=0,o=r.length;s<o;s++)r[s].updateTransform();i&&this.textureBuffer.clear();var a=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,a),this.renderer.resolution=h}},t.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},t.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},t.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===t.WEBGL_RENDERER){var e=this.renderer.gl,i=this.textureBuffer.width,n=this.textureBuffer.height,r=new Uint8Array(4*i*n);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var s=new t.CanvasBuffer(i,n),o=s.context.getImageData(0,0,i,n);return o.data.set(r),s.context.putImageData(o,0,0),s.canvas}return this.textureBuffer.canvas},t.RenderTexture.tempMatrix=new t.Matrix,t.VideoTexture=function(e,i){if(!e)throw new Error("No video source element specified.");(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),t.BaseTexture.call(this,e,i),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),e.complete||(this._onCanPlay=this.onCanPlay.bind(this),e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("play",this.onPlayStart.bind(this)),e.addEventListener("pause",this.onPlayStop.bind(this)))},t.VideoTexture.prototype=Object.create(t.BaseTexture.prototype),t.VideoTexture.constructor=t.VideoTexture,t.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},t.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},t.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},t.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))},t.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(t.BaseTextureCache[this.source._pixiId]=null,delete t.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),t.BaseTexture.prototype.destroy.call(this)},t.VideoTexture.baseTextureFromVideo=function(e,i){e._pixiId||(e._pixiId="video_"+t.TextureCacheIdGenerator++);var n=t.BaseTextureCache[e._pixiId];return n||(n=new t.VideoTexture(e,i),t.BaseTextureCache[e._pixiId]=n),n},t.VideoTexture.textureFromVideo=function(e,i){var n=t.VideoTexture.baseTextureFromVideo(e,i);return new t.Texture(n)},t.VideoTexture.fromUrl=function(e,i){var n=document.createElement("video");return n.src=e,n.autoPlay=!0,n.play(),t.VideoTexture.textureFromVideo(n,i)},t.AssetLoader=function(e,i){this.assetURLs=e,this.crossorigin=i,this.loadersByType={jpg:t.ImageLoader,jpeg:t.ImageLoader,png:t.ImageLoader,gif:t.ImageLoader,webp:t.ImageLoader,json:t.JsonLoader,atlas:t.AtlasLoader,anim:t.SpineLoader,xml:t.BitmapFontLoader,fnt:t.BitmapFontLoader}},t.EventTarget.mixin(t.AssetLoader.prototype),t.AssetLoader.prototype.constructor=t.AssetLoader,t.AssetLoader.prototype._getDataType=function(t){if("data:"===t.slice(0,"data:".length).toLowerCase()){var e=t.slice("data:".length),i=e.indexOf(",");if(-1===i)return null;var n=e.slice(0,i).split(";")[0];return n&&"text/plain"!==n.toLowerCase()?n.split("/").pop().toLowerCase():"txt"}return null},t.AssetLoader.prototype.load=function(){var t=this;function e(e){t.onAssetLoaded(e.data.content)}this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var n=this.assetURLs[i],r=this._getDataType(n);r||(r=n.split("?").shift().split(".").pop().toLowerCase());var s=this.loadersByType[r];if(!s)throw new Error(r+" is an unsupported file type");var o=new s(n,this.crossorigin);o.on("loaded",e),o.load()}},t.AssetLoader.prototype.onAssetLoaded=function(t){this.loadCount--,this.emit("onProgress",{content:this,loader:t,loaded:this.assetURLs.length-this.loadCount,total:this.assetURLs.length}),this.onProgress&&this.onProgress(t),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},t.JsonLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},t.JsonLoader.prototype.constructor=t.JsonLoader,t.EventTarget.mixin(t.JsonLoader.prototype),t.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},t.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},t.JsonLoader.prototype.onJSONLoaded=function(){if(this.ajaxRequest.responseText)if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames&&this.json.meta&&this.json.meta.image){var i=this.json.meta.image;-1===i.indexOf("data:")&&(i=this.baseUrl+i);var n=new t.ImageLoader(i,this.crossorigin),r=this.json.frames;for(var s in this.texture=n.texture.baseTexture,n.addEventListener("loaded",this.onLoaded.bind(this)),r){var o=r[s].frame;if(o){var a=new t.Rectangle(o.x,o.y,o.w,o.h),h=a.clone(),l=null;if(r[s].trimmed){var c=r[s].sourceSize,u=r[s].spriteSourceSize;l=new t.Rectangle(u.x,u.y,c.w,c.h)}t.TextureCache[s]=new t.Texture(this.texture,a,h,l)}}n.load()}else if(this.json.bones)if(t.AnimCache[this.url])this.onLoaded();else{var f=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",d=new t.JsonLoader(f,this.crossorigin),p=this;d.onJSONLoaded=function(){if(this.ajaxRequest.responseText){var i=new t.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),n=new e.Atlas(this.ajaxRequest.responseText,i),r=new e.AtlasAttachmentLoader(n),s=new e.SkeletonJson(r).readSkeletonData(p.json);t.AnimCache[p.url]=s,p.spine=s,p.spineAtlas=n,p.spineAtlasLoader=d,i.loadingCount>0?i.addEventListener("loadedBaseTexture",function(t){t.content.content.loadingCount<=0&&p.onLoaded()}):p.onLoaded()}else this.onError()},d.load()}else this.onLoaded();else this.onError()},t.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},t.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},t.AtlasLoader=function(t,e){this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},t.AtlasLoader.constructor=t.AtlasLoader,t.EventTarget.mixin(t.AtlasLoader.prototype),t.AtlasLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},t.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var e=this.ajaxRequest.responseText.split(/\r?\n/),i=-3,n=0,r=null,s=!1,o=0,a=0,h=this.onLoaded.bind(this);for(o=0;o<e.length;o++)if(e[o]=e[o].replace(/^\s+|\s+$/g,""),""===e[o]&&(s=o+1),e[o].length>0){if(s===o)this.atlas.meta.image.push(e[o]),n=this.atlas.meta.image.length-1,this.atlas.frames.push({}),i=-3;else if(i>0)if(i%7==1)null!=r&&(this.atlas.frames[n][r.name]=r),r={name:e[o],frame:{}};else{var l=e[o].split(" ");if(i%7==3)r.frame.x=Number(l[1].replace(",","")),r.frame.y=Number(l[2]);else if(i%7==4)r.frame.w=Number(l[1].replace(",","")),r.frame.h=Number(l[2]);else if(i%7==5){var c={x:0,y:0,w:Number(l[1].replace(",","")),h:Number(l[2])};c.w>r.frame.w||c.h>r.frame.h?(r.trimmed=!0,r.realSize=c):r.trimmed=!1}}i++}if(null!=r&&(this.atlas.frames[n][r.name]=r),this.atlas.meta.image.length>0){for(this.images=[],a=0;a<this.atlas.meta.image.length;a++){var u=this.baseUrl+this.atlas.meta.image[a],f=this.atlas.frames[a];for(o in this.images.push(new t.ImageLoader(u,this.crossorigin)),f){var d=f[o].frame;d&&(t.TextureCache[o]=new t.Texture(this.images[a].texture.baseTexture,{x:d.x,y:d.y,width:d.w,height:d.h}),f[o].trimmed&&(t.TextureCache[o].realSize=f[o].realSize,t.TextureCache[o].trim.x=0,t.TextureCache[o].trim.y=0))}}for(this.currentImageId=0,a=0;a<this.images.length;a++)this.images[a].on("loaded",h);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},t.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},t.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},t.SpriteSheetLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},t.SpriteSheetLoader.prototype.constructor=t.SpriteSheetLoader,t.EventTarget.mixin(t.SpriteSheetLoader.prototype),t.SpriteSheetLoader.prototype.load=function(){var e=this,i=new t.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),i.load()},t.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader=function(e,i){this.texture=t.Texture.fromImage(e,i),this.frames=[]},t.ImageLoader.prototype.constructor=t.ImageLoader,t.EventTarget.mixin(t.ImageLoader.prototype),t.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},t.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader.prototype.loadFramedSpriteSheet=function(e,i,n){this.frames=[];for(var r=Math.floor(this.texture.width/e),s=Math.floor(this.texture.height/i),o=0,a=0;a<s;a++)for(var h=0;h<r;h++,o++){var l=new t.Texture(this.texture.baseTexture,{x:h*e,y:a*i,width:e,height:i});this.frames.push(l),n&&(t.TextureCache[n+"-"+o]=l)}this.load()},t.BitmapFontLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},t.BitmapFontLoader.prototype.constructor=t.BitmapFontLoader,t.EventTarget.mixin(t.BitmapFontLoader.prototype),t.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},t.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var e=this.ajaxRequest.responseXML;if(!e||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser)e=(new DOMParser).parseFromString(this.ajaxRequest.responseText,"text/xml");else{var i=document.createElement("div");i.innerHTML=this.ajaxRequest.responseText,e=i}var n=this.baseUrl+e.getElementsByTagName("page")[0].getAttribute("file"),r=new t.ImageLoader(n,this.crossorigin);this.texture=r.texture.baseTexture;var s={},o=e.getElementsByTagName("info")[0],a=e.getElementsByTagName("common")[0];s.font=o.getAttribute("face"),s.size=parseInt(o.getAttribute("size"),10),s.lineHeight=parseInt(a.getAttribute("lineHeight"),10),s.chars={};for(var h=e.getElementsByTagName("char"),l=0;l<h.length;l++){var c=parseInt(h[l].getAttribute("id"),10),u=new t.Rectangle(parseInt(h[l].getAttribute("x"),10),parseInt(h[l].getAttribute("y"),10),parseInt(h[l].getAttribute("width"),10),parseInt(h[l].getAttribute("height"),10));s.chars[c]={xOffset:parseInt(h[l].getAttribute("xoffset"),10),yOffset:parseInt(h[l].getAttribute("yoffset"),10),xAdvance:parseInt(h[l].getAttribute("xadvance"),10),kerning:{},texture:t.TextureCache[c]=new t.Texture(this.texture,u)}}var f=e.getElementsByTagName("kerning");for(l=0;l<f.length;l++){var d=parseInt(f[l].getAttribute("first"),10),p=parseInt(f[l].getAttribute("second"),10),g=parseInt(f[l].getAttribute("amount"),10);s.chars[p].kerning[d]=g}t.BitmapText.fonts[s.font]=s,r.addEventListener("loaded",this.onLoaded.bind(this)),r.load()}},t.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.SpineLoader=function(t,e){this.url=t,this.crossorigin=e,this.loaded=!1},t.SpineLoader.prototype.constructor=t.SpineLoader,t.EventTarget.mixin(t.SpineLoader.prototype),t.SpineLoader.prototype.load=function(){var e=this,i=new t.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),i.load()},t.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},t.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},t.AbstractFilter.prototype.constructor=t.AbstractFilter,t.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},t.AlphaMaskFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:e},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mask.value.x=e.width,this.uniforms.mask.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},t.AlphaMaskFilter.prototype=Object.create(t.AbstractFilter.prototype),t.AlphaMaskFilter.prototype.constructor=t.AlphaMaskFilter,t.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}}),t.ColorMatrixFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},t.ColorMatrixFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorMatrixFilter.prototype.constructor=t.ColorMatrixFilter,Object.defineProperty(t.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}}),t.GrayFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},t.GrayFilter.prototype=Object.create(t.AbstractFilter.prototype),t.GrayFilter.prototype.constructor=t.GrayFilter,Object.defineProperty(t.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}),t.DisplacementFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:e},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=e.width,this.uniforms.mapDimensions.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},t.DisplacementFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DisplacementFilter.prototype.constructor=t.DisplacementFilter,t.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(t.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(t.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),t.PixelateFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new t.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},t.PixelateFilter.prototype=Object.create(t.AbstractFilter.prototype),t.PixelateFilter.prototype.constructor=t.PixelateFilter,Object.defineProperty(t.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.dirty=!0,this.uniforms.pixelSize.value=t}}),t.BlurXFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurXFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurXFilter.prototype.constructor=t.BlurXFilter,Object.defineProperty(t.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),t.BlurYFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurYFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurYFilter.prototype.constructor=t.BlurYFilter,Object.defineProperty(t.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),t.BlurFilter=function(){this.blurXFilter=new t.BlurXFilter,this.blurYFilter=new t.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},t.BlurFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurFilter.prototype.constructor=t.BlurFilter,Object.defineProperty(t.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}}),Object.defineProperty(t.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}}),Object.defineProperty(t.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}),t.InvertFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},t.InvertFilter.prototype=Object.create(t.AbstractFilter.prototype),t.InvertFilter.prototype.constructor=t.InvertFilter,Object.defineProperty(t.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}),t.SepiaFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},t.SepiaFilter.prototype=Object.create(t.AbstractFilter.prototype),t.SepiaFilter.prototype.constructor=t.SepiaFilter,Object.defineProperty(t.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}),t.TwistFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},t.TwistFilter.prototype=Object.create(t.AbstractFilter.prototype),t.TwistFilter.prototype.constructor=t.TwistFilter,Object.defineProperty(t.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.dirty=!0,this.uniforms.offset.value=t}}),Object.defineProperty(t.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(t){this.dirty=!0,this.uniforms.radius.value=t}}),Object.defineProperty(t.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),t.ColorStepFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},t.ColorStepFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorStepFilter.prototype.constructor=t.ColorStepFilter,Object.defineProperty(t.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}}),t.DotScreenFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},t.DotScreenFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DotScreenFilter.prototype.constructor=t.DotScreenFilter,Object.defineProperty(t.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.dirty=!0,this.uniforms.scale.value=t}}),Object.defineProperty(t.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),t.CrossHatchFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},t.CrossHatchFilter.prototype=Object.create(t.AbstractFilter.prototype),t.CrossHatchFilter.prototype.constructor=t.CrossHatchFilter,Object.defineProperty(t.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),t.RGBSplitFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},t.RGBSplitFilter.prototype=Object.create(t.AbstractFilter.prototype),t.RGBSplitFilter.prototype.constructor=t.RGBSplitFilter,Object.defineProperty(t.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}}),Object.defineProperty(t.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}}),Object.defineProperty(t.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.PIXI=t):"undefined"!=typeof define&&define.amd?define(t):this.PIXI=t}.call(this),function(){function t(t){if(t=t||{},this.method=t.method||2,this.colors=t.colors||256,this.initColors=t.initColors||4096,this.initDist=t.initDist||.01,this.distIncr=t.distIncr||.005,this.hueGroups=t.hueGroups||10,this.satGroups=t.satGroups||10,this.lumGroups=t.lumGroups||10,this.minHueCols=t.minHueCols||0,this.hueStats=this.minHueCols?new e(this.hueGroups,this.minHueCols):null,this.boxSize=t.boxSize||[64,64],this.boxPxls=t.boxPxls||2,this.palLocked=!1,this.dithKern=t.dithKern||null,this.dithSerp=t.dithSerp||!1,this.dithDelta=t.dithDelta||0,this.histogram={},this.idxrgb=t.palette?t.palette.slice(0):[],this.idxi32=[],this.i32idx={},this.i32rgb={},this.idxrgbRep=t.palette&&t.paletteRep&&t.palette.length==t.paletteRep.length?t.paletteRep.slice(0):[],this.idxi32Rep=[],this.i32idxRep={},this.i32rgbRep={},this.useCache=!1!==t.useCache,this.cacheFreq=t.cacheFreq||10,this.reIndex=t.reIndex||0==this.idxrgb.length,this.colorDist="manhattan"==t.colorDist?l:a,this.idxrgb.length>0){var i=this;this.idxrgb.forEach(function(t,e){var n=(255<<24|t[2]<<16|t[1]<<8|t[0])>>>0;i.idxi32[e]=n,i.i32idx[n]=e,i.i32rgb[n]=t}),this.idxrgbRep.forEach(function(t,e){var n=null!=t?(255<<24|t[2]<<16|t[1]<<8|t[0])>>>0:0;i.idxi32Rep[e]=n,i.i32idxRep[n]=e,i.i32rgbRep[n]=t})}}function e(t,e){this.numGroups=t,this.minCols=e,this.stats={};for(var i=-1;i<t;i++)this.stats[i]={num:0,cols:[]};this.groupsFull=0}t.prototype.sample=function(t,e){if(this.palLocked)throw"Cannot sample additional images, palette already assembled.";var i=m(t,e);switch(this.method){case 1:this.colorStats1D(i.buf32);break;case 2:this.colorStats2D(i.buf32,i.width)}},t.prototype.reduce=function(t,e,i,n){if(this.palLocked||this.buildPal(),i=i||this.dithKern,n=void 0!==n?n:this.dithSerp,e=e||1,i)var r=this.dither(t,i,n);else for(var s=(w=(x=m(t)).buf32).length,o=(r=new Uint32Array(s),0);o<s;o++){var a=w[o],h=this.nearestColor(a),l=(4278190080&a)>>24,c=255&h,u=(65280&h)>>8,f=(16711680&h)>>16;a2=(4278190080&h)>>24;var d=null!=this.i32rgbRep&&0==a2?a2:l;r[o]=d<<24|f<<16|u<<8|c}if(1==e)return new Uint8Array(r.buffer);if(2==e){var g=[];for(s=r.length,o=0;o<s;o++)a=r[o],g[o]=this.i32idx[a];return g}if(3==e){var v=document.createElement("canvas");v.width=x.width,v.height=x.height;var _=v.getContext("2d"),y=_.createImageData(v.width,v.height);if("CanvasPixelArray"==p(y.data)){var x,b=new Uint8Array(r.buffer);for(o=0,s=(x=y.data).length;o<s;++o)x[o]=b[o]}else{var w,S=new Uint32Array(r.buffer);(w=new Uint32Array(y.data.buffer)).set(S)}_.putImageData(y,0,0);var C=v.toDataURL("image/png");return this.dataURItoBlob(C)}},t.prototype.dataURItoBlob=function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new Blob([n],{type:i})},t.prototype.dither=function(t,e,i){var n={FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]],Jarvis:[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]],Burkes:[[.25,1,0],[.125,2,0],[2/32,-2,1],[.125,-1,1],[.25,0,1],[.125,1,1],[2/32,2,1]],Sierra:[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[.125,-1,1],[5/32,0,1],[.125,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]],TwoSierra:[[.25,1,0],[3/16,2,0],[1/16,-2,1],[.125,-1,1],[3/16,0,1],[.125,1,1],[1/16,2,1]],SierraLite:[[.5,1,0],[.25,-1,1],[.25,0,1]]};if(!e||!n[e])throw"Unknown dithering kernel: "+e;for(var r=n[e],s=m(t),o=s.buf32,a=s.width,h=s.height,l=(o.length,i?-1:1),c=0;c<h;c++){i&&(l*=-1);for(var u=c*a,f=1==l?0:a-1,d=1==l?a:0;f!==d;f+=l){var p=u+f,g=o[p],v=255&g,_=(65280&g)>>8,y=(16711680&g)>>16,x=(4278190080&g)>>24,b=this.nearestColor(g),w=255&b,S=(65280&b)>>8,C=(16711680&b)>>16;if(o[p]=x<<24|C<<16|S<<8|w,!(this.dithDelta&&this.colorDist([v,_,y],[w,S,C])<this.dithDelta))for(var T=v-w,k=_-S,E=y-C,A=1==l?0:r.length-1,M=1==l?r.length:0;A!==M;A+=l){var D=r[A][1]*l,O=r[A][2],L=O*a;if(D+f>=0&&D+f<a&&O+c>=0&&O+c<h){var P=r[A][0],B=p+(L+D),I=255&o[B],R=(65280&o[B])>>8,F=(16711680&o[B])>>16,U=Math.max(0,Math.min(255,I+T*P)),N=Math.max(0,Math.min(255,R+k*P)),z=Math.max(0,Math.min(255,F+E*P));o[B]=255<<24|z<<16|N<<8|U}}}}return o},t.prototype.buildPal=function(t){if(!(this.palLocked||this.idxrgb.length>0&&this.idxrgb.length<=this.colors)){var e=this.histogram,i=function(t,e){var i=[];for(var n in t)i.push(n);return v.call(i,function(e,i){return t[i]-t[e]})}(e);if(0==i.length)throw"Nothing has been sampled, palette cannot be built.";switch(this.method){case 1:for(var n=this.initColors,r=e[i[n-1]],s=i.slice(0,n),o=n,a=i.length;o<a&&e[i[o]]==r;)s.push(i[o++]);this.hueStats&&this.hueStats.inject(s);break;case 2:s=i}s=s.map(function(t){return+t}),this.reducePal(s),!t&&this.reIndex&&this.sortPal(),this.useCache&&this.cacheHistogram(s),this.palLocked=!0}},t.prototype.palette=function(t,e){return this.buildPal(e),t?this.idxrgb:new Uint8Array(new Uint32Array(this.idxi32).buffer)},t.prototype.prunePal=function(t){for(var e,i=0;i<this.idxrgb.length;i++)t[i]||(e=this.idxi32[i],this.idxrgb[i]=null,this.idxi32[i]=null,delete this.i32idx[e]);if(this.reIndex){for(var n=[],r=[],s={},o=(i=0,0);i<this.idxrgb.length;i++)this.idxrgb[i]&&(e=this.idxi32[i],n[o]=this.idxrgb[i],s[e]=o,r[o]=e,o++);this.idxrgb=n,this.idxi32=r,this.i32idx=s}},t.prototype.reducePal=function(t){if(this.idxrgb.length>this.colors){for(var e,i=t.length,n={},r=0,s=!1,o=0;o<i;o++)r!=this.colors||s||(this.prunePal(n),s=!0),e=this.nearestIndex(t[o]),r<this.colors&&!n[e]&&(n[e]=!0,r++);s||(this.prunePal(n),s=!0)}else{var a=t.map(function(t){return[255&t,(65280&t)>>8,(16711680&t)>>16]}),h=i=a.length,l=this.initDist;if(h>this.colors){for(;h>this.colors;){var c=[];for(o=0;o<i;o++){var u=a[o];if(t[o],u)for(var f=o+1;f<i;f++){var d=a[f],p=t[f];if(d){var g=this.colorDist(u,d);g<l&&(c.push([f,d,p,g]),delete a[f],h--)}}}l+=h>3*this.colors?this.initDist:this.distIncr}if(h<this.colors){v.call(c,function(t,e){return e[3]-t[3]});for(var m=0;h<this.colors;)a[c[m][0]]=c[m][1],h++,m++}}for(i=a.length,o=0;o<i;o++)a[o]&&(this.idxrgb.push(a[o]),this.idxi32.push(t[o]),this.i32idx[t[o]]=this.idxi32.length-1,this.i32rgb[t[o]]=a[o])}},t.prototype.colorStats1D=function(t){for(var e,i=this.histogram,n=t.length,r=0;r<n;r++)(4278190080&(e=t[r]))>>24!=0&&(this.hueStats&&this.hueStats.check(e),e in i?i[e]++:i[e]=1)},t.prototype.colorStats2D=function(t,e){var i=this.boxSize[0],n=this.boxSize[1],r=i*n,s=function(t,e,i,n){for(var r=t%i,s=e%n,o=t-r,a=e-s,h=[],l=0;l<e;l+=n)for(var c=0;c<t;c+=i)h.push({x:c,y:l,w:c==o?r:i,h:l==a?s:n});return h}(e,t.length/e,i,n),o=this.histogram,a=this;s.forEach(function(i){var n,s=Math.max(Math.round(i.w*i.h/r)*a.boxPxls,2),h={};!function(t,e,i){var n=t,r=n.y*e+n.x,s=(n.y+n.h-1)*e+(n.x+n.w-1),o=0,a=e-n.w+1,h=r;do{i.call(this,h),h+=++o%n.w==0?a:1}while(h<=s)}(i,e,function(e){(4278190080&(n=t[e]))>>24!=0&&(a.hueStats&&a.hueStats.check(n),n in o?o[n]++:n in h?++h[n]>=s&&(o[n]=h[n]):h[n]=1)})}),this.hueStats&&this.hueStats.inject(o)},t.prototype.sortPal=function(){var t=this;this.idxi32.sort(function(e,i){var n=t.i32idx[e],r=t.i32idx[i],s=t.idxrgb[n],o=t.idxrgb[r],a=c(s[0],s[1],s[2]),h=c(o[0],o[1],o[2]),l=s[0]==s[1]&&s[1]==s[2]?-1:u(a.h,t.hueGroups),p=(o[0]==o[1]&&o[1]==o[2]?-1:u(h.h,t.hueGroups))-l;if(p)return-p;var g=d(+h.l.toFixed(2))-d(+a.l.toFixed(2));if(g)return-g;var v=f(+h.s.toFixed(2))-f(+a.s.toFixed(2));return v?-v:void 0}),this.idxi32.forEach(function(e,i){t.idxrgb[i]=t.i32rgb[e],t.i32idx[e]=i})},t.prototype.nearestColor=function(t){var e=this.nearestIndex(t);return this.idxrgbRep&&this.idxrgbRep.length>0?null==e?0:this.idxi32Rep[e]:null===e?0:this.idxi32[e]},t.prototype.nearestIndex=function(t){if((4278190080&t)>>24==0)return null;if(this.useCache&&""+t in this.i32idx)return this.i32idx[t];for(var e,i=1e3,n=[255&t,(65280&t)>>8,(16711680&t)>>16],r=this.idxrgb.length,s=0;s<r;s++)if(this.idxrgb[s]){var o=this.colorDist(n,this.idxrgb[s]);o<i&&(i=o,e=s)}return e},t.prototype.cacheHistogram=function(t){for(var e=0,i=t[e];e<t.length&&this.histogram[i]>=this.cacheFreq;i=t[e++])this.i32idx[i]=this.nearestIndex(i)},e.prototype.check=function(t){this.groupsFull==this.numGroups+1&&(this.check=function(){});var e=255&t,i=(65280&t)>>8,n=(16711680&t)>>16,r=e==i&&i==n?-1:u(c(e,i,n).h,this.numGroups),s=this.stats[r],o=this.minCols;s.num++,s.num>o||(s.num==o&&this.groupsFull++,s.num<=o&&this.stats[r].cols.push(t))},e.prototype.inject=function(t){for(var e=-1;e<this.numGroups;e++)if(this.stats[e].num<=this.minCols)switch(p(t)){case"Array":this.stats[e].cols.forEach(function(e){-1==t.indexOf(e)&&t.push(e)});break;case"Object":this.stats[e].cols.forEach(function(e){t[e]?t[e]++:t[e]=1})}};var i=.2126,n=.7152,r=.0722;function s(t,e,s){return Math.sqrt(i*t*t+n*e*e+r*s*s)}var o=Math.sqrt(255*i*255+255*n*255+255*r*255);function a(t,e){var s=e[0]-t[0],a=e[1]-t[1],h=e[2]-t[2];return Math.sqrt(i*s*s+n*a*a+r*h*h)/o}var h=255*i+255*n+255*r;function l(t,e){var s=Math.abs(e[0]-t[0]),o=Math.abs(e[1]-t[1]),a=Math.abs(e[2]-t[2]);return(i*s+n*o+r*a)/h}function c(t,e,i){var n,r,o,a,h;if(t/=255,e/=255,i/=255,(n=Math.max(t,e,i))==(r=Math.min(t,e,i)))o=a=0;else{switch(h=n-r,a=(n+r)/2>.5?h/(2-n-r):h/(n+r),n){case t:o=(e-i)/h+(e<i?6:0);break;case e:o=(i-t)/h+2;break;case i:o=(t-e)/h+4}o/=6}return{h:o,s:a,l:s(t,e,i)}}function u(t,e){var i=1/e,n=i/2;if(t>=1-n||t<=n)return 0;for(var r=1;r<e;r++){var s=r*i;if(t>=s-n&&t<=s+n)return r}}function f(t){return t}function d(t){return t}function p(t){return Object.prototype.toString.call(t).slice(8,-1)}var g,v="xyzvwtursopqmnklhijfgdeabc"==(g="abcdefghijklmnopqrstuvwxyz").split("").sort(function(t,e){return~~(g.indexOf(e)/2.3)-~~(g.indexOf(t)/2.3)}).join("")?Array.prototype.sort:function(t){var e=p(this[0]);if("Number"==e||"String"==e){for(var i,n={},r=this.length,s=0;s<r;s++)i=this[s],n[i]||0===n[i]||(n[i]=s);return this.sort(function(e,i){return t(e,i)||n[e]-n[i]})}n=this.map(function(t){return t});return this.sort(function(e,i){return t(e,i)||n.indexOf(e)-n.indexOf(i)})};function m(t,e){var i,n,r,s,o,a,h=typeof t;switch("object"===h&&(h=t.constructor.name),h){case"HTMLImageElement":(i=document.createElement("canvas")).width=t.naturalWidth,i.height=t.naturalHeight,(n=i.getContext("2d")).drawImage(t,0,0);case"Canvas":case"HTMLCanvasElement":i=i||t,n=n||i.getContext("2d");case"CanvasRenderingContext2D":n=n||t,i=i||n.canvas,r=n.getImageData(0,0,i.width,i.height);case"ImageData":e=(r=r||t).width,s="CanvasPixelArray"==p(r.data)?new Uint8Array(r.data):r.data;case"Array":case"CanvasPixelArray":s=s||new Uint8Array(t);case"Uint8Array":case"Uint8ClampedArray":s=s||t,o=new Uint32Array(s.buffer);case"Uint32Array":o=o||t,s=s||new Uint8Array(o.buffer),e=e||o.length,a=o.length/e}return{can:i,ctx:n,imgd:r,buf8:s,buf32:o,width:e,height:a}}this.RgbQuant=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}.call(this),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rgbAsterLib=e():t.rgbAsterLib=e()}(self,()=>(()=>{var t={"./node_modules/rgbaster/dist/rgbaster.umd.js":function(t){var e;t.exports=(e={ignore:[],scale:1},function(t,i){void 0===i&&(i=e);try{var n=(i=Object.assign({},e,i)).ignore,r=i.scale;return(r>1||r<=0)&&console.warn("You set scale to "+r+", which isn't between 0-1. This is either pointless (> 1) or a no-op ( 0)"),Promise.resolve(function(t,e){void 0===e&&(e=1);var i=new Image;return t.startsWith("data")||(i.crossOrigin="Anonymous"),new Promise(function(n,r){i.onload=function(){var t=i.width*e,r=i.height*e,s=function(t,e){var i=document.createElement("canvas");return i.setAttribute("width",t),i.setAttribute("height",e),i.getContext("2d")}(t,r);s.drawImage(i,0,0,t,r);var o=s.getImageData(0,0,t,r);n(o.data)};var s=function(){return r(new Error("An error occurred attempting to load image"))};i.onerror=s,i.onabort=s,i.src=t})}(t,r)).then(function(t){return function(t,e){for(var i={},n=0;n<t.length;n+=4){var r=t[n+3];if(0!==r){var s=Array.from(t.subarray(n,n+3));if(-1===s.indexOf(void 0)){var o=r&&255!==r?"rgba("+s.concat([r]).join(",")+")":"rgb("+s.join(",")+")";-1===e.indexOf(o)&&(i[o]?i[o].count++:i[o]={color:o,count:1})}}}return Object.values(i).sort(function(t,e){return e.count-t.count})}(t,n)})}catch(t){return Promise.reject(t)}})}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,i),s.exports}i.n=(t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e}),i.d=((t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}),i.o=((t,e)=>Object.prototype.hasOwnProperty.call(t,e)),i.r=(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})});var n={};return(()=>{"use strict";i.r(n),i.d(n,{rgbAster:()=>e});var t=i("./node_modules/rgbaster/dist/rgbaster.umd.js"),e=i.n(t)()})(),n})()),BABYLON.Tmp=BABYLON.TmpColors;var Zakeke,org,_0xc101=["setPrototypeOf","__proto__","hasOwnProperty","constructor","prototype","create","length","getOwnPropertyDescriptor","object","decorate","function","defineProperty","Tools","Init","SetupCustomShaders","IncludesShadersStore","Effect","ShadersStore","DefinePBRMaterial","call","p7H5BeNo","Gs62Hcg4","a9ERn52W","Ex48Hyb7","Zn2m8STd","Xy5f3FMb","Nz52Qcg9","Ta63Acf7","Hp4m2BWf","Qs3b9W2T","o6GAc9s7","o6PJw98D","a2SBj8y3","Pn4m8W9E","n7D3EjXm","Gf4i3Y8S","o3JZj2y8","Yj98FwZn","w9C3Yen4","t7PWe2w6","j2WBy59Z","r6YWy23J","d5Q8Nsw9","Pa6s3WGq","j5AHb8g6","Qt36CfDy","Ec42CdYz","INSTANCES","b8W4Fyq9","Da9i4ZXt","Bs27JiWq","NUM_BONE_INFLUENCERS","BonesPerMesh","rebuild","_albedoColor","_reflectionColor","_specularColor","_glossiness","_ambientLight","_reflectivity","_microsurface","_aoPower","_rimColor","_rimPower","_rimBias","_aoExposure","_cameraContrast","_cameraExposure","_enableEnvCap","_useAOTextureAsLightmap","_useAlphaFromAlbedoTexture","_disableLighting","_maxSimultaneousLights","_renderTargets","_grayWeights","_lumCoeff","_renderMatrix","enableMatCap","apply","_markAllSubMeshesAsTexturesDirty","_markAllSubMeshesAsLightsDirty","enableEnvCap","_shouldUseAlphaFromAlbedoTexture","_albedoTexture","hasAlpha","_buildLightUniformLayout","_pbrUniformBuffer","getEngine","Qn65Tbq4","addUniform","Yp32BjTy","f3JFn69D","_prepareDefinesForLights","_lightSources","d2EKz65X","getTypeID","Go89WqCn","Tx62Nto7","Gf78Toj6","Xf36Cge2","Qr8j3M7B","Wn9y8EQr","Po32Jtb9","Hj6m7P5D","LINEARDEPTH","receiveShadows","shadowsEnabled","shadowEnabled","getShadowGenerator","DirectionalLight","getCaps","textureFloatRender","textureFloatLinearFiltering","textureHalfFloatRender","textureHalfFloatLinearFiltering","_prepareUniformsAndSamplersList","Gw84QdRo","t6M8KsPq","g2ASa4p9","z2J8Dek4","f6T5RbLa","Ja84RmPc","x9R4Dcn7","d8A9QxLe","Kd6a5DEk","push","i5PBq6d4","d3T8Meb7","Ez2g9L3K","q6E4ZmWa","_bindLightShadow","getTransformMatrix","setMatrix","getShadowMap","setTexture","","info","_bindLightProperties","PointLight","computeTransformedInformation","x","transformedPosition","y","z","updateFloat3","position","transformedDirection","direction","PBRMaterial: Attempt to bind light properties for an unhandled light type. PBR only supports Pointlight and DirectionalLight.","_bindLights","bindToEffect","intensity","Color3","Tmp","scaleToRef","diffuse","updateColor3","specular","update","_doNothing","getClassName","Zakeke.PBRMaterial","getRenderTargetTextures","reset","_reflectionTexture","isRenderTarget","needAlphaBlending","alpha","_opacityTexture","_opacityFresnelParameters","isEnabled","needAlphaTesting","getAlphaTestTexture","isReadyForSubMesh","isFrozen","_wasPreviouslyReady","effect","_materialDefines","getScene","checkReadyOnEveryCall","_renderId","getRenderId","_areLightsDirty","lightsEnabled","_needNormals","_areTexturesDirty","_needUVs","texturesEnabled","textureLOD","isReadyOrNotBlocking","standardDerivatives","_bumpTexture","_reflectivityTexture","_microsurfaceTexture","_parallaxReflectionCenter","_parallaxReflectionBBoxMin","_parallaxReflectionBBoxMax","getAlphaFromRGB","_aoTexture","_ambientTexture","_matCapReflectionTexture","_backFaceCulling","_areFresnelDirty","_areMiscDirty","_areAttributesDirty","_normals","_uvs","VertexBuffer","isVerticesDataPresent","useBones","computeBonesUsingShaders","numBoneInfluencers","bones","skeleton","markAsUnprocessed","isDirty","markAsProcessed","resetCachedMaterial","EffectFallbacks","MaterialHelper","PositionKind","zk_pbr","_cachedDefines","name","world","view","viewProjection","vEyePositionW","Lk8x5T3G","Ji23KzMd","Xo8q4A2R","Wr5i8R3S","Lj7q8H2K","Gr2p3S4T","q4A5Diy8","f8E2Wxc3","i5LEp3e8","Ez4g6PHc","t3GQn4m8","r8TLa3t5","f2THw8s5","n5J8Afy2","Lr45JbEi","c9F4XmDi","x4S6Ljt2","Dy84Brw6","Xm86Bye7","He9c4X2M","Em94Zxs7","j2N4DfKp","z9E8Dre3","o9EDt87H","Ew46Kes3","b4M3HcSi","Gk97Wqd5","Bt52Znx8","z9LGq35P","Ji6x8KYz","b6B9Wjf2","Ge69Pir7","mBones","Wq6t4DBe","g8G2Wfc4","z9C8Bsn3","g3BZx5e9","q6KWt97C","Hw43Jya6","Ei5b7ADy","Nz2n3DZs","Nd7m3WXn","Dg68CpMb","Fw64Rni2","m7MHk3b4","Material","Scene","onCompiled","onError","createEffect","setEffect","buildUniformLayout","isReady","_uniformBuffer","unbind","_activeEffect","bindForSubMesh","bindOnlyWorldMatrix","visibility","bindViewProjection","useUbo","isSync","toLuminance","leftColor","rightColor","bias","power","updateColor4","coordinatesIndex","level","updateFloat2","getTextureMatrix","updateMatrix","updateFloat","width","getSize","log","LOG2E","round","updateVector3","activeCamera","setVector3","bindView","dispose","getActiveTextures","hasTexture","clone","SerializationHelper","id","createPBRBlendMaterial","serialize","customType","Parse","albedoColor","serializeAsColor3","expandToProperty","reflectionColor","specularColor","glossiness","ambientLight","indirectLightPower","rimColor","rimBias","albedoTexture","serializeAsTexture","bumpTexture","reflectivityTexture","reflectivity","microsurfaceTexture","microsurface","reflectionTexture","parallaxReflectionCenter","serializeAsVector3","parallaxReflectionBBoxMin","parallaxReflectionBBoxMax","opacityTexture","aoTexture","AOTexture","aoPower","AOPower","aoExposure","AOExposure","matCapAmbientTexture","ambientTexture","matCapReflectionTexture","useAOTextureAsLightmap","useAlphaFromAlbedoTexture","opacityFresnelParameters","serializeAsFresnelParameters","_markAllSubMeshesAsFresnelDirty","rimPower","_markAllSubMeshesAsMiscDirty","cameraContrast","cameraExposure","disableLighting","maxSimultaneousLights","PBRMaterial","PBRMaterialDefines","DefineCustomMaterials","#ifdef Hp4m2BWf\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef Nz52Qcg9\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__zk_pbrFragment>\n\nconst float PI=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale = 0.1;\nconst float kRougnhessToAlphaOffset = 0.29248125;\nconst float kMinimumVariance = 0.0005;\nconst float fact_1=1.0;\nconst float fact_2=0.0;\n\n#ifdef p7H5BeNo\n#include<__decl__zk_pbrLightFragment>[0..maxSimultaneousLights]\n#endif\n\n#ifdef Ta63Acf7\nuniform sampler2D g3BZx5e9;\n#endif\n#ifdef Hp4m2BWf\nuniform sampler2D q6KWt97C;\n#endif\n#ifdef Qs3b9W2T\nuniform sampler2D Hw43Jya6;\n#endif\n#ifdef o6GAc9s7\nuniform sampler2D Ei5b7ADy;\n#endif\n#ifdef o6PJw98D\nuniform samplerCube Nd7m3WXn;\n#endif\n#ifdef Pn4m8W9E\nuniform sampler2D Fw64Rni2;\n#endif\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\nuniform sampler2D m7MHk3b4;\n#endif\n#ifdef t7PWe2w6\nuniform sampler2D Dg68CpMb;\n#endif\n#ifdef j2WBy59Z\nuniform sampler2D Nz2n3DZs;\n#endif\n\nconst float lf_1 = 1.0;\nconst float lf_2 = 0.0;\n\nuniform vec3 vEyePositionW;\nvarying vec3 vPositionW;\n\n#ifdef b8W4Fyq9\nvarying vec3 vNormalW;\n#endif\n#ifdef Ta63Acf7\nvarying vec2 j9F5Mmw7;\n#endif\n#ifdef Hp4m2BWf\nvarying vec2 Hg32Nkz6;\n#else\n#ifdef w9C3Yen4\nvarying vec2 a3X4SpHq;\n#endif\n#endif\n#ifdef Qs3b9W2T\nvarying vec2 Ho7e5M6N;\n#endif\n#ifdef o6GAc9s7\nvarying vec2 Bp4q3S8E;\n#endif\n#ifdef Pn4m8W9E\nvarying vec2 Zj26Aby4;\n#endif\n#ifdef Gf4i3Y8S\nvarying vec2 Za9r4XMn;\n#endif\n#ifdef Yj98FwZn\nvarying vec3 n9RMw7b2;\n#endif\n\n#include<zk_w8NZg34MyJx59GeB>\n#include<zk_g9X4Qdz2LJb67MyT>\n#include<zk_Ar2w4FRs58Jpc3W6>\n#include<zk_n8Q2Bzi9LXc5p6RG>\n\nvoid main(void)\n{\nvec3 finalColor=vec3(1.0,1.0,1.0);\nvec3 V=normalize(vEyePositionW-vPositionW);\nfloat alpha=Lk8x5T3G.a;\nvec3 albedoBlend=Lk8x5T3G.rgb;\n#ifdef Ta63Acf7\nvec4 albedoTextureColor=texture2D(g3BZx5e9,j9F5Mmw7);\n#ifdef Ec42CdYz\nif (albedoTextureColor.a<z9C8Bsn3[3][1]){discard;}\n#endif\n\n#ifdef r6YWy23J\nalpha*=albedoTextureColor.a;\n#endif\nalbedoBlend*=albedoTextureColor.rgb*Ji23KzMd.y;\n#endif\n\n#ifdef Pn4m8W9E\n#ifdef n7D3EjXm\nvec3 opColor = texture2D(Fw64Rni2,Zj26Aby4).rgb;\nfloat luminance=dot(Wq6t4DBe,opColor);\nalpha*=luminance*x4S6Ljt2.y;\n#else\nfloat opacity=texture2D(Fw64Rni2,Zj26Aby4).a;\nalpha*=opacity*x4S6Ljt2.y;\n#endif\n#endif\n\n#ifdef b8W4Fyq9\nvec3 N=normalize(vNormalW);\nfloat NdotV=dot(N,V);\n#ifdef Hp4m2BWf\nvec2 vv_1 = vec2(fact_1, fact_1);\nvec2 vv_2 = vec2(fact_2, fact_2);\nN=perturbNormal(V,vNormalW, vv_1, vv_2);\n#endif\n#else\n\nvec3 N=normalize(vec3(1.0));\n#endif\n\n#ifdef d5Q8Nsw9\nN=gl_FrontFacing ? N : -N;\n#endif\n\n#ifdef Pa6s3WGq\nfloat opacityFresnelTerm=clamp(pow(Ji6x8KYz.z+abs(NdotV),Ji6x8KYz.w),0.0,1.0);\nalpha+=Ji6x8KYz.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*Ji6x8KYz.y;\n#endif\n\nfloat reflectivityBlend=Gr2p3S4T;\n#ifdef Qs3b9W2T\nfloat reflectivityValue=texture2D(Hw43Jya6,Ho7e5M6N).r*q4A5Diy8.y;\nreflectivityBlend*=reflectivityValue;\n#endif\n\nvec3 specularBlend=b6B9Wjf2;\n#ifdef Qs3b9W2T\nspecularBlend*=reflectivityValue;\n#endif\n\nfloat microsurfaceBlend=i5LEp3e8;\n#ifdef o6GAc9s7\nmicrosurfaceBlend*=texture2D(Ei5b7ADy,Bp4q3S8E).r*Ez4g6PHc.y;\n#endif\n\n#if defined(j2WBy59Z) || defined(o6PJw98D)\n// Go mat -> ...\n#ifdef Nz52Qcg9\n// Adapt ...\nmicrosurfaceBlend=clamp(microsurfaceBlend,0.,1.)*0.98;\n// Compute ...\nfloat roughness=clamp(1.-microsurfaceBlend, 0.000001, 1.0);\nfloat alphaG=microsurfaceBlend*microsurfaceBlend+kMinimumVariance;\n//Beckamm roughness to Blinn exponent\nfloat maxMipLevel=Ge69Pir7;\nfloat lodReflection=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alphaG));\nlodReflection = clamp(lodReflection, 0., maxMipLevel);\n#else\nfloat biasReflection=(Ge69Pir7+2.0)*microsurfaceBlend;\n#endif\n#endif\n\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\nfloat AOShadowTexel=1.0;\n#ifdef Gf4i3Y8S\nvec3 AOValue=texture2D(m7MHk3b4,Za9r4XMn).rgb*He9c4X2M.y;\n#ifdef o3JZj2y8\nfloat aoGrayLevel=dot(g8G2Wfc4,AOValue);\nif (aoGrayLevel<Xm86Bye7){AOValue/=Xm86Bye7;}else{AOValue-=Xm86Bye7;AOValue/=1.0-Xm86Bye7;}\n#endif\nvec3 AOLightTexel=mix(vec3(1.0),AOValue,He9c4X2M.z);\n#endif\n#ifdef Yj98FwZn\nvec2 screenCoordinates=vec2(0.0);\nscreenCoordinates=n9RMw7b2.xy/n9RMw7b2.z/2.0+vec2(0.5);\nAOShadowTexel=mix(1.0,texture2D(m7MHk3b4,screenCoordinates).r,j2N4DfKp);\nfloat AOLightTexel=mix(1.0,texture2D(m7MHk3b4,screenCoordinates).g,j2N4DfKp);\n#endif\n#endif\n#ifdef w9C3Yen4\n#ifdef Hp4m2BWf\nvec2 a3X4SpHq=vec2(view*vec4(N,0.0))*0.5+vec2(0.5,0.5);\n#endif\nfinalColor=albedoBlend;\n#ifdef j2WBy59Z\n// For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n// For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\nfloat reflectance0=reflectivityBlend; // normal\nfloat reflectance90=clamp(reflectivityBlend*25.0,0.0,1.0); // grazing\nfloat schlick=reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-NdotV,0.,1.), 5.0);\n#ifdef Nz52Qcg9\nvec3 reflection=texture2DLodEXT(Nz2n3DZs,a3X4SpHq,lodReflection).rgb*r8TLa3t5*o9EDt87H;\n#else\nvec3 reflection=texture2D(Nz2n3DZs,a3X4SpHq,biasReflection).rgb*r8TLa3t5*o9EDt87H;\n#endif\nfinalColor*=1.0-schlick;\nfinalColor+=reflection*schlick;\n#endif\n#ifdef t7PWe2w6\nvec3 ambient=texture2D(Dg68CpMb,a3X4SpHq).rgb*z9E8Dre3;\nfloat albedoLevel=g8G2Wfc4.r*Lk8x5T3G.r+g8G2Wfc4.g*Lk8x5T3G.g+g8G2Wfc4.b*Lk8x5T3G.b;\nfloat lightExposure=mix(0.85,0.99,pow(albedoLevel,2.0));\nfloat ambientGreyLevel=g8G2Wfc4.r*ambient.r+g8G2Wfc4.g*ambient.g+g8G2Wfc4.b*ambient.b;\nif (ambientGreyLevel<lightExposure){finalColor*=ambient/lightExposure;}\nelse{\nambient-=lightExposure;ambient/=1.0-lightExposure;ambientGreyLevel-=lightExposure;ambientGreyLevel/=1.0-lightExposure;\nvec3 desatAmbient=mix(vec3(ambientGreyLevel),ambient,1.1-lightExposure);\nfinalColor+=desatAmbient*clamp(3.0*(1.0-lightExposure),0.0,1.0);\n}\n#endif\n#ifdef Gf4i3Y8S\nfinalColor*=AOLightTexel;\n#endif\n#ifdef Yj98FwZn\nfinalColor*=AOShadowTexel;\n#endif\n#else\n\n#ifdef o6PJw98D\nvec3 vReflectionUVW=2.0*NdotV*N-V; \n#ifdef a2SBj8y3\nvec3 firstPlaneIntersect=(c9F4XmDi-vPositionW)/vReflectionUVW;\nvec3 secondPlaneIntersect=(Lr45JbEi-vPositionW)/vReflectionUVW;\nvec3 furthestPlane=max(firstPlaneIntersect,secondPlaneIntersect);\nfloat distance=min(min(furthestPlane.x,furthestPlane.y),furthestPlane.z);\nvec3 intersectPositionW=vPositionW+vReflectionUVW*distance;\nvReflectionUVW=intersectPositionW-n5J8Afy2;\nvReflectionUVW.y=-vReflectionUVW.y;\n#endif\n#ifdef Nz52Qcg9\nvec3 environmentRadiance=textureCubeLodEXT(Nd7m3WXn,vReflectionUVW,lodReflection).rgb*r8TLa3t5*f2THw8s5;\n#else\nvec3 environmentRadiance=textureCube(Nd7m3WXn,vReflectionUVW,biasReflection).rgb*r8TLa3t5*f2THw8s5;\n#endif\n#endif\n\nvec3 directSpecularFactor=vec3(0.0);\nvec3 directDiffuseFactor=vec3(0.0);\n#ifdef p7H5BeNo\n#ifdef Gs62Hcg4\nfloat shadowTotal=1.0;\n#endif\n#include<zk_Dp84Pxj2MTr7q6FW>[0..maxSimultaneousLights]\n#endif\nvec3 finalDiffuse=albedoBlend;\nvec3 energy=vec3(0.0);\n#ifdef o6PJw98D\nfloat reflectionPower=clamp(reflectivityBlend*2.0-NdotV,0.0,1.0);\nenergy=vec3(reflectionPower);\n#endif\nenergy+=(directSpecularFactor*specularBlend).r;\nenergy=clamp(energy,0.0,1.0);\nfinalDiffuse*=vec3(1.0)-energy;\nfinalColor=finalDiffuse;\nvec3 finalSpecular=directSpecularFactor*specularBlend;\n#ifdef o6PJw98D\nfinalSpecular+=environmentRadiance*reflectionPower;\n#endif\nfinalColor+=finalSpecular;\nvec3 finalLighting=directDiffuseFactor;\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\n#ifdef Gs62Hcg4\nfinalLighting+=z9LGq35P*mix(1.0,AOShadowTexel,1.0-shadowTotal);\n#else\nfinalLighting+=z9LGq35P;\n#endif\nfinalLighting*=AOLightTexel;\n#else\nfinalLighting+=z9LGq35P;\n#endif\n#ifdef Qt36CfDy\nfinalLighting=pow(finalLighting,vec3(Gk97Wqd5.x));\nfinalLighting+=Gk97Wqd5.y-1.0;\nfinalLighting=clamp(finalLighting,0.0,2.0);\n#endif\n#ifdef o3JZj2y8\nif (aoGrayLevel<Xm86Bye7){finalColor*=finalLighting;}\nelse {finalColor+=finalLighting*clamp(3.0*(1.0-Xm86Bye7),0.0,1.0);}\n#else\nfinalColor*=finalLighting;\n#endif\n#endif\n\n#ifdef j5AHb8g6\nfloat rimPower=b4M3HcSi.x;\nfloat rimBias=b4M3HcSi.y;\nfloat rimFactor=clamp(rimBias*2.0-NdotV,0.0,1.0);\n#ifdef Qs3b9W2T\nrimFactor*=reflectivityValue;\n#endif\nfinalColor+=Ew46Kes3*rimFactor*rimPower;\n#endif\n\ngl_FragColor=vec4(vec3(finalColor),alpha);\n}","precision highp float;\n#include<__decl__zk_pbrVertex>\n\nattribute vec3 position;\n#ifdef b8W4Fyq9\nattribute vec3 normal;\n#endif\n#ifdef Da9i4ZXt\nattribute vec2 uv;\n#endif\n#ifdef Bs27JiWq\nattribute vec2 uv2;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n\n#ifdef p7H5BeNo\n#include<__decl__zk_pbrLightFragment>[0..maxSimultaneousLights]\n#endif\n\nvarying vec3 vPositionW;\n#ifdef b8W4Fyq9\nvarying vec3 vNormalW;\n#endif\n#ifdef Ta63Acf7\nvarying vec2 j9F5Mmw7;\n#endif\n#ifdef Hp4m2BWf\nvarying vec2 Hg32Nkz6;\n#else\n#ifdef w9C3Yen4\nvarying vec2 a3X4SpHq;\n#endif\n#endif\n#ifdef Qs3b9W2T\nvarying vec2 Ho7e5M6N;\n#endif\n#ifdef o6GAc9s7\nvarying vec2 Bp4q3S8E;\n#endif\n#ifdef Pn4m8W9E\nvarying vec2 Zj26Aby4;\n#endif\n#ifdef Gf4i3Y8S\nvarying vec2 Za9r4XMn;\n#endif\n#ifdef Yj98FwZn\nvarying vec3 n9RMw7b2;\n#endif\n\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef b8W4Fyq9\nvec3 normalUpdated=normal;\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPosition=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=worldPosition.xyz;\nvec4 finalPosition=viewProjection*worldPosition;\n#ifdef Yj98FwZn\nn9RMw7b2=finalPosition.xyw;\n#endif\ngl_Position=finalPosition;\n#ifdef b8W4Fyq9\nvec4 worldNormal=finalWorld*vec4(normalUpdated,0.0);\nvNormalW=normalize(worldNormal.xyz);\n#endif\n\n#ifndef Da9i4ZXt\nvec2 uv=vec2(0.0,0.0);\n#endif\n#ifndef Bs27JiWq\nvec2 uv2=vec2(0.0,0.0);\n#endif\n#ifdef Ta63Acf7\nif (Ji23KzMd.x == 0.0)\n{\nj9F5Mmw7=vec2(Xo8q4A2R*vec4(uv,1.0,0.0));\n}\nelse\n{\nj9F5Mmw7=vec2(Xo8q4A2R*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Hp4m2BWf\nif (Wr5i8R3S.x == 0.0)\n{\nHg32Nkz6=vec2(Lj7q8H2K*vec4(uv,1.0,0.0));\n}\nelse\n{\nHg32Nkz6=vec2(Lj7q8H2K*vec4(uv2,1.0,0.0));\n}\n#else\n#ifdef w9C3Yen4\na3X4SpHq=vec2(view*vec4(vNormalW,0.0))*0.5+vec2(0.5,0.5);\n#endif\n#endif\n#ifdef Qs3b9W2T\nif (q4A5Diy8.x == 0.0)\n{\nHo7e5M6N=vec2(f8E2Wxc3*vec4(uv,1.0,0.0));\n}\nelse\n{\nHo7e5M6N=vec2(f8E2Wxc3*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef o6GAc9s7\nif (Ez4g6PHc.x == 0.0)\n{\nBp4q3S8E=vec2(t3GQn4m8*vec4(uv,1.0,0.0));\n}\nelse\n{\nBp4q3S8E=vec2(t3GQn4m8*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Pn4m8W9E\nif (x4S6Ljt2.x == 0.0)\n{\nZj26Aby4=vec2(Dy84Brw6*vec4(uv,1.0,0.0));\n}\nelse\n{\nZj26Aby4=vec2(Dy84Brw6*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Gf4i3Y8S\nif (He9c4X2M.x == 0.0)\n{\nZa9r4XMn=vec2(Em94Zxs7*vec4(uv,1.0,0.0));\n}\nelse\n{\nZa9r4XMn=vec2(Em94Zxs7*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#ifdef Gs62Hcg4\n#include<zk_Gi39AdTg7y5B2JfL>[0..maxSimultaneousLights]\n#endif\n}","#ifdef Hp4m2BWf\nmat3 cotangent_frame(vec3 norm,vec3 poss,vec2 uvmapping, float coeff_1, float coeff_2)\n{\nvec3 dp1=coeff_1*dFdx(poss);\nvec3 dp2=coeff_1*dFdy(poss);\nvec2 duv1=dFdx(uvmapping)+vec2(coeff_2, coeff_2);\nvec2 duv2=dFdy(uvmapping)+vec2(coeff_2, coeff_2);\nvec3 dp2perp=cross(dp2,norm);\nvec3 dp1perp=cross(norm,dp1);\nvec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\nfloat invmax=inversesqrt(max(dot(T,T),dot(B,B)));\nreturn mat3(T * invmax, B * invmax, norm);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 vNormalW, vec2 vv1, vec2 vv2)\n{\nvec3 map=texture2D(q6KWt97C,Hg32Nkz6).xyz*Wr5i8R3S.y;\nmap = (map*(255.0/127.0))-(128.0/127.0);\nmat3 TBN=cotangent_frame(vNormalW,viewDir,Hg32Nkz6, vv1.x, vv2.y);\nreturn normalize(TBN*map);\n}\n#endif","#if defined(w9C3Yen4) && defined(Hp4m2BWf)\nuniform mat4 view;\n#endif\nuniform vec4 Lk8x5T3G;\nuniform vec3 r8TLa3t5;\nuniform vec3 b6B9Wjf2;\nuniform float Gr2p3S4T;\nuniform float i5LEp3e8;\nuniform float Bt52Znx8;\nuniform float z9LGq35P;\n\n#ifdef Ta63Acf7\nuniform vec2 Ji23KzMd;\n#endif\n#ifdef Hp4m2BWf\nuniform vec2 Wr5i8R3S;\n#endif\n#ifdef o6GAc9s7\nuniform vec2 Ez4g6PHc;\n#endif\n#ifdef o6PJw98D\nuniform float f2THw8s5;\nuniform float Ge69Pir7;\n#ifdef a2SBj8y3\nuniform vec3 n5J8Afy2;\nuniform vec3 Lr45JbEi;\nuniform vec3 c9F4XmDi;\n#endif\n#endif\n#ifdef Qs3b9W2T\nuniform vec2 q4A5Diy8;\n#endif\n#ifdef Gf4i3Y8S\nuniform vec3 He9c4X2M;\n#ifdef o3JZj2y8\nuniform float Xm86Bye7;\n#endif\n#endif\n#ifdef Yj98FwZn\nuniform float j2N4DfKp;\n#endif\n#ifdef t7PWe2w6\nuniform float z9E8Dre3;\n#endif\n#ifdef j2WBy59Z\nuniform float o9EDt87H;\nuniform float Ge69Pir7;\n#endif\n#ifdef Pn4m8W9E\nuniform vec2 x4S6Ljt2;\n#endif\n\n#ifdef Pa6s3WGq\nuniform vec4 Ji6x8KYz;\n#endif\n\nuniform vec3 Wq6t4DBe;\nuniform vec3 g8G2Wfc4;\nuniform mat4 z9C8Bsn3;\n\n#ifdef j5AHb8g6\nuniform vec3 Ew46Kes3;\nuniform vec2 b4M3HcSi;\n#endif\n#ifdef Qt36CfDy\nuniform vec2 Gk97Wqd5;\n#endif\n","#ifdef d2EKz65X{X}\nuniform vec3 Qn65Tbq4{X};\nuniform vec3 Yp32BjTy{X};\nuniform vec3 f3JFn69D{X};\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\nuniform float z2J8Dek4{X};\n#ifdef Wn9y8EQr{X}\nuniform mat4 t6M8KsPq{X};\nuniform samplerCube q6E4ZmWa{X};\nuniform vec2 g2ASa4p9{X};\nvarying vec3 q2ENg8n9{X};\n#else\nuniform mat4 Gw84QdRo{X};\nuniform sampler2D q6E4ZmWa{X};\nvarying vec4 a3WFm87R{X};\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n\n#else\nuniform sampler2D d3T8Meb7{X};\nuniform sampler2D q6E4ZmWa{X};\n#ifndef Po32Jtb9{X}\nuniform sampler2D Ez2g9L3K{X};\n#endif\n#endif\nuniform mat4 Gw84QdRo{X};\nuniform mat4 t6M8KsPq{X};\nuniform vec2 g2ASa4p9{X};\nuniform vec2 x9R4Dcn7{X};\nuniform vec2 d8A9QxLe{X};\nuniform float Ja84RmPc{X};\nuniform float f6T5RbLa{X};\nuniform float z2J8Dek4{X};\nvarying vec4 a3WFm87R{X};\nvarying vec3 q2ENg8n9{X};\n#else\n#ifdef Tx62Nto7{X}\nuniform sampler2D d3T8Meb7{X};\nuniform mat4 Kd6a5DEk{X};\nvarying vec4 a3WFm87R{X};\nvarying float q8NLm2b4{X};\n#endif\n#endif\n#endif\n#endif\n#endif\n","#ifdef p7H5BeNo\nstruct lightingInfo {\nvec3 diffuse;\nvec3 specular;\n};\nlightingInfo getPointLighting(vec3 worldPosition,vec3 lightPosition,vec3 N,vec3 V,vec3 lightDiffuse,vec3 lightSpecular,float Bt52Znx8, float plight1, float plight2)\n{\nlightingInfo result;\nvec3 lightDir=lightPosition-worldPosition;\nvec3 L=normalize(lightDir);\nfloat distance=length(lightDir);\nfloat lightAttenuation=sqrt(1.0/distance + (plight1*plight2));\nvec3 diffuse=vec3(0.0);\nfloat NdotL = dot(N,L);\nfloat lightPower=clamp(NdotL, 0.0, 1.0);\ndiffuse=lightPower*lightPower*lightAttenuation*lightDiffuse;\nresult.diffuse=diffuse;\nvec3 specular=vec3(0.0);\nvec3 H=normalize(V+L);\nfloat NdotH=max(dot(N,H),0.0);\nspecular=(pow(NdotH,max(1.0 ,Bt52Znx8))*2.0)*lightAttenuation*lightSpecular;\nresult.specular=specular;\nreturn result;\n}\nlightingInfo getDirectionalLighting(vec3 lightDir,vec3 N,vec3 V,vec3 lightDiffuse,vec3 lightSpecular,float Bt52Znx8, float dlight1, float dlight2)\n{\nlightingInfo result;\nvec3 L=normalize(lightDir);\nvec3 diffuse=vec3(0.0);\nfloat NdotL = dot(N,L);\nfloat lightPower=clamp(NdotL, 0.0, 1.0);\ndiffuse=(lightPower*lightDiffuse)+(dlight1*dlight2);\nresult.diffuse=diffuse;\nvec3 specular=vec3(0.0);\nvec3 H=normalize(V+L);\nfloat NdotH=max(dot(N,H),0.0);\nspecular=(pow(NdotH,max(1.0 ,Bt52Znx8))*2.0)*lightSpecular;\nresult.specular=specular;\nreturn result;\n}\n#endif\n","#ifdef d2EKz65X{X}\nfloat coef_dynb_3{X}=1.0;\n#ifdef Tx62Nto7{X}\nvec3 L{X}=normalize(-light{X}.Qn65Tbq4);\n#else\nvec3 L{X}=normalize(light{X}.Qn65Tbq4-vPositionW);\n#endif\nvec3 H{X}=normalize(V+L{X});\n#ifdef Go89WqCn{X}\nlightingInfo Qb46TxBo{X}=getPointLighting(vPositionW,light{X}.Qn65Tbq4,N,V,light{X}.Yp32BjTy,light{X}.f3JFn69D,Bt52Znx8,lf_1,lf_2);\n#else\n#ifdef Tx62Nto7{X}\nlightingInfo Qb46TxBo{X}=getDirectionalLighting(L{X},N,V,light{X}.Yp32BjTy,light{X}.f3JFn69D,Bt52Znx8,lf_1,lf_2);\n#else\nlightingInfo Qb46TxBo{X};\nQb46TxBo{X}.diffuse=vec3(0.0);\nQb46TxBo{X}.specular=vec3(0.0);\n#endif\n#endif\n#ifdef Gf78Toj6{X}\nfloat shadow{X}=1.0;\nfloat coef_dynb_2{X}=0.0;\nfloat dynamicBias{X}=computeDynamicBias(z2J8Dek4{X},shadow{X},coef_dynb_2{X},coef_dynb_3{X},N,L{X});\n#ifdef Hj6m7P5D{X}\nfloat outsideLuminance{X}=0.0;\n#else\nfloat outsideLuminance{X}=1.0;\n#endif\nfloat depth{X};\n#ifdef LINEARDEPTH{X}\n\ndepth{X}=length(vPositionW-light{X}.Qn65Tbq4);\ndepth{X}=(depth{X}-g2ASa4p9{X}.x)/(g2ASa4p9{X}.y-g2ASa4p9{X}.x);\n#else\ndepth{X}=0.5*(a3WFm87R{X}.z/a3WFm87R{X}.w)+0.5;\n#endif\n#ifdef Xf36Cge2{X}\n#ifdef Wn9y8EQr{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadowFromPrecomputedPCSS_FFCube(light{X}.Qn65Tbq4,q6E4ZmWa{X},-L{X},g2ASa4p9{X},dynamicBias{X});\n\n#else\nshadow{X}=0.0;\n\n#endif\n#else\nvec2 uv{X}=a3WFm87R{X}.xy/a3WFm87R{X}.w;\nuv{X}=0.5*uv{X}+vec2(0.5);\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadowFromPrecomputedPCSS(depth{X},uv{X},\nq6E4ZmWa{X},\ndynamicBias{X},\noutsideLuminance{X},\ntrue);\n#else\nshadow{X}=getShadowFromPrecomputedPCSS(depth{X},uv{X},\nq6E4ZmWa{X},\ndynamicBias{X},\noutsideLuminance{X},\nfalse);\n#endif\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=0.0;\n\n#else\nshadow{X}=0.0;\n\n#endif\n#else\nvec2 uv{X}=a3WFm87R{X}.xy/a3WFm87R{X}.w;\nuv{X}=0.5*uv{X}+vec2(0.5);\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadow(f6T5RbLa{X},\ndepth{X},uv{X},q2ENg8n9{X},\nx9R4Dcn7{X},d8A9QxLe{X},g2ASa4p9{X},Ja84RmPc{X},\nd3T8Meb7{X},d3T8Meb7{X},q6E4ZmWa{X},\ndynamicBias{X},outsideLuminance{X},\ntrue);\n#else\nshadow{X}=getShadow(f6T5RbLa{X},\ndepth{X},uv{X},q2ENg8n9{X},\nx9R4Dcn7{X},d8A9QxLe{X},g2ASa4p9{X},Ja84RmPc{X},\nd3T8Meb7{X},Ez2g9L3K{X},q6E4ZmWa{X},\ndynamicBias{X},outsideLuminance{X},\nfalse);\n#endif\n#endif\n#else\n#ifdef Tx62Nto7{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=computeShadow(a3WFm87R{X},\nq8NLm2b4{X},\nd3T8Meb7{X},dynamicBias{X},true);\n#else\nshadow{X}=computeShadow(a3WFm87R{X},\nq8NLm2b4{X},\nd3T8Meb7{X},dynamicBias{X},false);\n#endif\n#endif\n#endif\n#endif\nQb46TxBo{X}.diffuse*=shadow{X};\nQb46TxBo{X}.specular*=shadow{X};\nshadowTotal*=shadow{X};\n#endif\ndirectDiffuseFactor+=Qb46TxBo{X}.diffuse;\ndirectSpecularFactor+=Qb46TxBo{X}.specular;\n#endif\n","#ifdef d2EKz65X{X}\nuniform i5PBq6d4{X}\n{\nvec3 Qn65Tbq4;\nvec3 Yp32BjTy;\nvec3 f3JFn69D;\n} light{X};\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\nuniform float z2J8Dek4{X};\n#ifdef Wn9y8EQr{X}\nuniform mat4 t6M8KsPq{X};\nuniform samplerCube q6E4ZmWa{X};\nuniform vec2 g2ASa4p9{X};\nvarying vec3 q2ENg8n9{X};\n#else\nuniform sampler2D q6E4ZmWa{X};\nuniform mat4 Gw84QdRo{X};\nvarying vec4 a3WFm87R{X};\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n\n\n\n\n\n\n#else\nuniform sampler2D d3T8Meb7{X};\nuniform sampler2D q6E4ZmWa{X};\n#ifndef Po32Jtb9{X}\nuniform sampler2D Ez2g9L3K{X};\n#endif\n#endif\nuniform mat4 Gw84QdRo{X};\nuniform mat4 t6M8KsPq{X};\nuniform vec2 g2ASa4p9{X};\nuniform vec2 x9R4Dcn7{X};\nuniform vec2 d8A9QxLe{X};\nuniform float Ja84RmPc{X};\nuniform float f6T5RbLa{X};\nuniform float z2J8Dek4{X};\nvarying vec4 a3WFm87R{X};\nvarying vec3 q2ENg8n9{X};\n#else\n#ifdef Tx62Nto7{X}\nuniform sampler2D d3T8Meb7{X};\nuniform mat4 Kd6a5DEk{X};\nvarying vec4 a3WFm87R{X};\nvarying float q8NLm2b4{X};\n#endif\n#endif\n#endif\n#endif\n#endif\n","#ifdef Gs62Hcg4\n\n#if defined(a9ERn52W)\nconst int poissonDiskSize=4;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.94201624,-0.39906216 );\npoissonDisk[1]=vec2(0.94558609,-0.76890725 );\npoissonDisk[2]=vec2(-0.094184101,-0.92938870 );\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#elif defined(Ex48Hyb7)\nconst int poissonDiskSize=16;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.94201624,-0.39906216 );\npoissonDisk[1]=vec2(0.94558609,-0.76890725 );\npoissonDisk[2]=vec2(-0.094184101,-0.92938870 );\npoissonDisk[3]=vec2(0.34495938,0.29387760 );\npoissonDisk[4]=vec2(-0.91588581,0.45771432 );\npoissonDisk[5]=vec2(-0.81544232,-0.87912464 );\npoissonDisk[6]=vec2(-0.38277543,0.27676845 );\npoissonDisk[7]=vec2(0.97484398,0.75648379 );\npoissonDisk[8]=vec2(0.44323325,-0.97511554 );\npoissonDisk[9]=vec2(0.53742981,-0.47373420 );\npoissonDisk[10]=vec2(-0.26496911,-0.41893023 );\npoissonDisk[11]=vec2(0.79197514,0.19090188 );\npoissonDisk[12]=vec2(-0.24188840,0.99706507 );\npoissonDisk[13]=vec2(-0.81409955,0.91437590 );\npoissonDisk[14]=vec2(0.19984126,0.78641367 );\npoissonDisk[15]=vec2(0.14383161,-0.14100790 );\n\n#elif defined(Zn2m8STd) \nconst int poissonDiskSize=25;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.978698,-0.0884121);\npoissonDisk[1]=vec2(-0.841121,0.521165);\npoissonDisk[2]=vec2(-0.71746,-0.50322);\npoissonDisk[3]=vec2(-0.702933,0.903134);\npoissonDisk[4]=vec2(-0.663198,0.15482);\npoissonDisk[5]=vec2(-0.495102,-0.232887);\npoissonDisk[6]=vec2(-0.364238,-0.961791);\npoissonDisk[7]=vec2(-0.345866,-0.564379);\npoissonDisk[8]=vec2(-0.325663,0.64037);\npoissonDisk[9]=vec2(-0.182714,0.321329);\npoissonDisk[10]=vec2(-0.142613,-0.0227363);\npoissonDisk[11]=vec2(-0.0564287,-0.36729);\npoissonDisk[12]=vec2(-0.0185858,0.918882);\npoissonDisk[13]=vec2(0.0381787,-0.728996);\npoissonDisk[14]=vec2(0.16599,0.093112);\npoissonDisk[15]=vec2(0.253639,0.719535);\npoissonDisk[16]=vec2(0.369549,-0.655019);\npoissonDisk[17]=vec2(0.423627,0.429975);\npoissonDisk[18]=vec2(0.530747,-0.364971);\npoissonDisk[19]=vec2(0.566027,-0.940489);\npoissonDisk[20]=vec2(0.639332,0.0284127);\npoissonDisk[21]=vec2(0.652089,0.669668);\npoissonDisk[22]=vec2(0.773797,0.345012);\npoissonDisk[23]=vec2(0.968871,0.840449);\npoissonDisk[24]=vec2(0.991882,-0.657338);\n\n#elif defined(Xy5f3FMb)\nconst int poissonDiskSize=64;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0] = vec2(-0.613392, 0.617481);\npoissonDisk[1] = vec2(0.170019, -0.040254);\npoissonDisk[2] = vec2(-0.299417, 0.791925);\npoissonDisk[3] = vec2(0.645680, 0.493210);\npoissonDisk[4] = vec2(-0.651784, 0.717887);\npoissonDisk[5] = vec2(0.421003, 0.027070);\npoissonDisk[6] = vec2(-0.817194, -0.271096);\npoissonDisk[7] = vec2(-0.705374, -0.668203);\npoissonDisk[8] = vec2(0.977050, -0.108615);\npoissonDisk[9] = vec2(0.063326, 0.142369);\npoissonDisk[10] = vec2(0.203528, 0.214331);\npoissonDisk[11] = vec2(-0.667531, 0.326090);\npoissonDisk[12] = vec2(-0.098422, -0.295755);\npoissonDisk[13] = vec2(-0.885922, 0.215369);\npoissonDisk[14] = vec2(0.566637, 0.605213);\npoissonDisk[15] = vec2(0.039766, -0.396100);\npoissonDisk[16] = vec2(0.751946, 0.453352);\npoissonDisk[17] = vec2(0.078707, -0.715323);\npoissonDisk[18] = vec2(-0.075838, -0.529344);\npoissonDisk[19] = vec2(0.724479, -0.580798);\npoissonDisk[20] = vec2(0.222999, -0.215125);\npoissonDisk[21] = vec2(-0.467574, -0.405438);\npoissonDisk[22] = vec2(-0.248268, -0.814753);\npoissonDisk[23] = vec2(0.354411, -0.887570);\npoissonDisk[24] = vec2(0.175817, 0.382366);\npoissonDisk[25] = vec2(0.487472, -0.063082);\npoissonDisk[26] = vec2(-0.084078, 0.898312);\npoissonDisk[27] = vec2(0.488876, -0.783441);\npoissonDisk[28] = vec2(0.470016, 0.217933);\npoissonDisk[29] = vec2(-0.696890, -0.549791);\npoissonDisk[30] = vec2(-0.149693, 0.605762);\npoissonDisk[31] = vec2(0.034211, 0.979980);\npoissonDisk[32] = vec2(0.503098, -0.308878);\npoissonDisk[33] = vec2(-0.016205, -0.872921);\npoissonDisk[34] = vec2(0.385784, -0.393902);\npoissonDisk[35] = vec2(-0.146886, -0.859249);\npoissonDisk[36] = vec2(0.643361, 0.164098);\npoissonDisk[37] = vec2(0.634388, -0.049471);\npoissonDisk[38] = vec2(-0.688894, 0.007843);\npoissonDisk[39] = vec2(0.464034, -0.188818);\npoissonDisk[40] = vec2(-0.440840, 0.137486);\npoissonDisk[41] = vec2(0.364483, 0.511704);\npoissonDisk[42] = vec2(0.034028, 0.325968);\npoissonDisk[43] = vec2(0.099094, -0.308023);\npoissonDisk[44] = vec2(0.693960, -0.366253);\npoissonDisk[45] = vec2(0.678884, -0.204688);\npoissonDisk[46] = vec2(0.001801, 0.780328);\npoissonDisk[47] = vec2(0.145177, -0.898984);\npoissonDisk[48] = vec2(0.062655, -0.611866);\npoissonDisk[49] = vec2(0.315226, -0.604297);\npoissonDisk[50] = vec2(-0.780145, 0.486251);\npoissonDisk[51] = vec2(-0.371868, 0.882138);\npoissonDisk[52] = vec2(0.200476, 0.494430);\npoissonDisk[53] = vec2(-0.494552, -0.711051);\npoissonDisk[54] = vec2(0.612476, 0.705252);\npoissonDisk[55] = vec2(-0.578845, -0.768792);\npoissonDisk[56] = vec2(-0.772454, -0.090976);\npoissonDisk[57] = vec2(0.504440, 0.372295);\npoissonDisk[58] = vec2(0.155736, 0.065157);\npoissonDisk[59] = vec2(0.391522, 0.849605);\npoissonDisk[60] = vec2(-0.620106, -0.328104);\npoissonDisk[61] = vec2(0.789239, -0.419965);\npoissonDisk[62] = vec2(-0.545396, 0.538133);\npoissonDisk[63] = vec2(-0.178564, -0.596057);\n#else\n\nconst int poissonDiskSize=25;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.978698,-0.0884121);\npoissonDisk[1]=vec2(-0.841121,0.521165);\npoissonDisk[2]=vec2(-0.71746,-0.50322);\npoissonDisk[3]=vec2(-0.702933,0.903134);\npoissonDisk[4]=vec2(-0.663198,0.15482);\npoissonDisk[5]=vec2(-0.495102,-0.232887);\npoissonDisk[6]=vec2(-0.364238,-0.961791);\npoissonDisk[7]=vec2(-0.345866,-0.564379);\npoissonDisk[8]=vec2(-0.325663,0.64037);\npoissonDisk[9]=vec2(-0.182714,0.321329);\npoissonDisk[10]=vec2(-0.142613,-0.0227363);\npoissonDisk[11]=vec2(-0.0564287,-0.36729);\npoissonDisk[12]=vec2(-0.0185858,0.918882);\npoissonDisk[13]=vec2(0.0381787,-0.728996);\npoissonDisk[14]=vec2(0.16599,0.093112);\npoissonDisk[15]=vec2(0.253639,0.719535);\npoissonDisk[16]=vec2(0.369549,-0.655019);\npoissonDisk[17]=vec2(0.423627,0.429975);\npoissonDisk[18]=vec2(0.530747,-0.364971);\npoissonDisk[19]=vec2(0.566027,-0.940489);\npoissonDisk[20]=vec2(0.639332,0.0284127);\npoissonDisk[21]=vec2(0.652089,0.669668);\npoissonDisk[22]=vec2(0.773797,0.345012);\npoissonDisk[23]=vec2(0.968871,0.840449);\npoissonDisk[24]=vec2(0.991882,-0.657338);\n#endif\n\n#endif","#ifdef Gs62Hcg4\nfloat getRandomNumber(vec3 seed, int inputI){\nvec4 seed4 = vec4(seed,inputI);\nfloat dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\nreturn fract(sin(dot_product) * 43758.5453);\n}\nbool isOutLimits(vec2 uv, float receiverDepth) {return (uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0 || receiverDepth<0.0);}\nbool isUVOutLimits(vec2 uv) {return (uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0);}\nfloat computeDynamicBias(float bias,float dynb_1,float dynb_2,float dynb_3,vec3 N,vec3 L) \n{\nvec3 N_1 = dynb_1*N;\nfloat cosTheta=clamp(dot(N,L)+dynb_2,0.0,1.0);\nfloat dynamicBias=bias*tan(acos(cosTheta));\nreturn dynamicBias*dynb_3;\n}\nfloat convertFromScreenToViewSpace(float depthS,vec2 g2ASa4p9)\n{\nfloat depthNDC=depthS*2.0-1.0;\nreturn -2.0*g2ASa4p9.x*g2ASa4p9.y/(depthNDC*(g2ASa4p9.y-g2ASa4p9.x)-(g2ASa4p9.y+g2ASa4p9.x));\n}\nfloat unpack24Bits(vec3 color)\n{\nconst vec3 bit_shift=vec3(1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nfloat linstep(float low,float high,float v) {return clamp((v-low)/(high-low),0.0,1.0);}\nfloat texture2DCompare(sampler2D depths, vec2 uv, float compare)\n{\nfloat depth = texture2D(depths, uv).r;\nreturn step(compare, depth);\n}\nfloat texture2DShadowLerp(sampler2D depths, vec2 size, vec2 uv, float compare)\n{\nvec2 texelSize = vec2(1.0)/size;\nvec2 f = fract(uv*size+0.5);\nvec2 centroidUV = floor(uv*size+0.5)/size;\nfloat lb = texture2DCompare(depths, centroidUV+texelSize*vec2(0.0, 0.0), compare);\nfloat lt = texture2DCompare(depths, centroidUV+texelSize*vec2(0.0, 1.0), compare);\nfloat rb = texture2DCompare(depths, centroidUV+texelSize*vec2(1.0, 0.0), compare);\nfloat rt = texture2DCompare(depths, centroidUV+texelSize*vec2(1.0, 1.0), compare);\nfloat a = mix(lb, lt, f.y);\nfloat b = mix(rb, rt, f.y);\nfloat c = mix(a, b, f.x);\nreturn c;\n}\nfloat PercentageCloserFiltering(sampler2D depths, vec2 size, vec2 uv, float compare){\nfloat result = 0.0;\nfor(int x=-2; x<=2; x++){\nfor(int y=-2; y<=2; y++){\nvec2 off = vec2(x,y)/size;\nresult += texture2DCompare(depths, uv+off, compare);\n}\n}\nreturn result/25.0;\n}\nfloat InterpolatedPercentageCloserFiltering(sampler2D depths, vec2 size, vec2 uv, float compare){\nfloat result = 0.0;\nfor(int x=-1; x<=1; x++){\nfor(int y=-1; y<=1; y++){\nvec2 off = vec2(x,y)/size;\nresult += texture2DShadowLerp(depths, size, uv+off, compare);\n}\n}\nreturn result/9.0;\n}\nfloat VSM(sampler2D depths, vec2 uv, float compare){\nvec2 moments = texture2D(depths, uv).xy;\nfloat p = smoothstep(compare-0.02, compare, moments.x);\nfloat variance = max(moments.y - moments.x*moments.x, -0.001);\nfloat d = compare - moments.x;\nfloat p_max = linstep(0.2, 1.0, variance / (variance + d*d));\nreturn clamp(max(p, p_max), 0.0, 1.0);\n}\nfloat chebyshev(vec2 moments,float depth)\n{\nfloat d=depth; float p=0.0;\np=smoothstep(d-0.02,d,moments.x);\nfloat variance=max(moments.y-(moments.x*moments.x), 0.000001);\nfloat diff=(d-moments.x);\nfloat p_max=variance/(variance+diff*diff);\np_max=linstep(0.1,1.0,p_max);\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat exponential(float Ja84RmPc,float moment,float depth) {return clamp(exp(Ja84RmPc*(moment-depth)),0.0,1.0);}\nvec4 getTexel(vec2 uv,sampler2D sampler) {return texture2D(sampler,uv);}\nvec2 getMoments(vec2 uv,sampler2D sampler,sampler2D secondSampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler);if(isFullFloat) {return texel.xy;} else {vec4 secondTexel=getTexel(uv,secondSampler); return vec2(unpack(texel),unpack(secondTexel));}\n}\nfloat getPCSSVisibility(vec2 uv,sampler2D sampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler); if(isFullFloat) {return texel.g;} else {return texel.a;}\n}\nfloat getBlockerDepth(vec2 uv,sampler2D sampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler); if(isFullFloat) {return texel.r;} else {return unpack24Bits(texel.rgb);}\n}\nfloat getShadowFromPrecomputedPCSS(float receiverDepth,vec2 uv,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif(isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat visibility=getPCSSVisibility(uv,shadowSampler,isFullFloat);\nfloat blockerDepth=getBlockerDepth(uv,shadowSampler,isFullFloat);\nif (blockerDepth+dynamicBias>receiverDepth) {return 1.0;}\nreturn visibility;\n}\nfloat getShadowFromPCSS(float receiverDepth,vec2 uv,vec3 positionFromLightV,vec2 x9R4Dcn7,vec2 d8A9QxLe,vec2 g2ASa4p9,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif(isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat blockerDepth=getBlockerDepth(uv,shadowSampler,isFullFloat);\nfloat avgBlockerDepthV=0.0;\nfloat numBlockers=0.0;\nfloat blockerSum=0.0;\nvec2 lightSizeUV=x9R4Dcn7/d8A9QxLe;\nvec2 searchRegionRadiusUV=lightSizeUV*(positionFromLightV.z-g2ASa4p9.x)/positionFromLightV.z;\nfor (int i=0; i<poissonDiskSize; i++) {\nfloat otherBlockerDepth=getBlockerDepth(uv+poissonDisk[i]*searchRegionRadiusUV,shadowSampler,isFullFloat);\nfloat otherBlockerDepthV=convertFromScreenToViewSpace(otherBlockerDepth,g2ASa4p9);\nif (otherBlockerDepthV<positionFromLightV.z) {\nblockerSum+=otherBlockerDepthV;\nnumBlockers++;\n}\n}\navgBlockerDepthV=blockerSum/numBlockers;\nif (numBlockers<1.0) {return 1.0;}\nelse\n{\nfloat penumbraRatio=(positionFromLightV.z-avgBlockerDepthV)/avgBlockerDepthV;\nvec2 filterRadiusUV=penumbraRatio*lightSizeUV*g2ASa4p9.x/positionFromLightV.z;\nfloat sum=0.0;\nfor (int i=0; i<poissonDiskSize; i++) {\nvec2 offset=poissonDisk[i]*filterRadiusUV;\nfloat otherBlockerDepth=getBlockerDepth(uv+offset,shadowSampler,isFullFloat);\nif (otherBlockerDepth<receiverDepth) {\nsum+=1.0;\n}\n}\nfloat darkness=sum/float(poissonDiskSize);\nfloat visibility=1.0-darkness;\nreturn visibility;\n}\n}\nfloat getShadowFromExponential(float receiverDepth,vec2 uv,float Ja84RmPc,sampler2D shadowSampler,sampler2D secondShadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat moment=getMoments(uv,shadowSampler,secondShadowSampler,isFullFloat).x;\nreturn exponential(Ja84RmPc,moment,receiverDepth);\n}\nfloat getShadowFromVSM(float receiverDepth,vec2 uv,sampler2D shadowSampler,sampler2D secondShadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)){return outsideLuminance;}\nvec2 moments=getMoments(uv,shadowSampler,secondShadowSampler,isFullFloat);\nreturn chebyshev(moments,receiverDepth);\n}\nfloat getHardShadow(float receiverDepth,vec2 uv,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat blockerDepth=getMoments(uv,shadowSampler,shadowSampler,isFullFloat).x;\nif(blockerDepth+dynamicBias>receiverDepth) return 1.0; else return 0.0;\n}\nfloat getShadow(float f6T5RbLa,float receiverDepth,vec2 uv,vec3 positionFromLightV,vec2 x9R4Dcn7,vec2 d8A9QxLe,vec2 g2ASa4p9,float Ja84RmPc,\nsampler2D d3T8Meb7,sampler2D Ez2g9L3K,sampler2D q6E4ZmWa,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nfloat visibility=1.0;\nif(f6T5RbLa<1.0) {visibility=getHardShadow(receiverDepth,uv,d3T8Meb7,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<2.0) {visibility=getShadowFromExponential(receiverDepth,uv,Ja84RmPc,d3T8Meb7,Ez2g9L3K,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<3.0) {visibility=getShadowFromVSM(receiverDepth,uv,d3T8Meb7,Ez2g9L3K,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<4.0) {visibility=getShadowFromPrecomputedPCSS(receiverDepth,uv,q6E4ZmWa,dynamicBias,outsideLuminance,isFullFloat);}\nelse {visibility=getShadowFromPCSS(receiverDepth,uv,positionFromLightV,x9R4Dcn7,d8A9QxLe,g2ASa4p9,d3T8Meb7,dynamicBias,outsideLuminance,isFullFloat);}\nreturn visibility;\n}\nfloat computeShadow(vec4 positionFromLight,float depthMetric,sampler2D shadowSampler,float dynamicBias,bool isFullFloat) \n{\nvec3 depth=positionFromLight.xyz/positionFromLight.w;\nvec2 uv=0.5*depth.xy+vec2(0.5);\nif (isUVOutLimits(uv)) {return 1.0;}\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nfloat shadow=0;\nif (isFullFloat) {shadow=texture2D(shadowSampler,uv).r;} else {shadow=unpack(texture2D(shadowSampler,uv));}\nif (shadowPixelDepth>shadow+dynamicBias){return 0.0;} \nreturn 1.0;\n}\n#endif\n","#ifdef d2EKz65X{X}\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\n#ifdef Wn9y8EQr{X}\nq2ENg8n9{X}=vec3(t6M8KsPq{X}*worldPosition);\n#else\na3WFm87R{X}=Gw84QdRo{X}*worldPosition;\n#endif\n#else\n#ifdef Qr8j3M7B{X}\na3WFm87R{X}=Gw84QdRo{X}*worldPosition;\nq2ENg8n9{X}=vec3(t6M8KsPq{X}*worldPosition);\n#else\n#ifdef Tx62Nto7{X}\na3WFm87R{X}=Kd6a5DEk{X}*worldPosition;\nq8NLm2b4{X}=a3WFm87R{X}.z*0.5+0.5;\n#endif\n#endif\n#endif\n#endif\n#endif\n","uniform mat4 viewProjection;\n#ifdef w9C3Yen4\n#ifndef Hp4m2BWf\nuniform mat4 view;\n#endif\n#endif\n#ifdef Ta63Acf7\nuniform mat4 Xo8q4A2R;\nuniform vec2 Ji23KzMd;\n#endif\n#ifdef Hp4m2BWf\nuniform mat4 Lj7q8H2K;\nuniform vec2 Wr5i8R3S;\n#endif\n#ifdef Qs3b9W2T\nuniform mat4 f8E2Wxc3;\nuniform vec2 q4A5Diy8;\n#endif\n#ifdef o6GAc9s7\nuniform mat4 t3GQn4m8;\nuniform vec2 Ez4g6PHc;\n#endif\n#ifdef Pn4m8W9E\nuniform mat4 Dy84Brw6;\nuniform vec2 x4S6Ljt2;\n#endif\n#ifdef Gf4i3Y8S\nuniform mat4 Em94Zxs7;\nuniform vec3 He9c4X2M;\n#endif\n","layout(std140,column_major) uniform;\nuniform Material {\nvec2 Ji23KzMd;\nvec2 Wr5i8R3S;\nvec2 q4A5Diy8;\nvec2 Ez4g6PHc;\nfloat f2THw8s5;\nvec2 x4S6Ljt2;\nvec3 He9c4X2M;\nfloat j2N4DfKp;\nfloat z9E8Dre3;\nfloat o9EDt87H;\nmat4 Xo8q4A2R;\nmat4 Lj7q8H2K;\nmat4 f8E2Wxc3;\nmat4 t3GQn4m8;\nmat4 Dy84Brw6;\nmat4 Em94Zxs7;\nvec4 Lk8x5T3G;\nvec3 r8TLa3t5;\nvec3 b6B9Wjf2;\nfloat Gr2p3S4T;\nfloat i5LEp3e8;\nfloat Bt52Znx8;\nfloat z9LGq35P;\nfloat Xm86Bye7;\nfloat Ge69Pir7;\nvec3 Ew46Kes3;\nvec2 b4M3HcSi;\nvec2 Gk97Wqd5;\nvec3 n5J8Afy2;\nvec3 Lr45JbEi;\nvec3 c9F4XmDi;\nvec4 Ji6x8KYz;\nvec3 Wq6t4DBe;\nvec3 g8G2Wfc4;\nmat4 z9C8Bsn3;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};"],extendStatics=function(t,e){return(extendStatics=Object[_0xc101[0]]||{__proto__:[]}instanceof Array&&function(t,e){t[_0xc101[1]]=e}||function(t,e){for(var i in e)e[_0xc101[2]](i)&&(t[i]=e[i])})(t,e)};function __extends(t,e){function i(){this[_0xc101[3]]=t}extendStatics(t,e),t[_0xc101[4]]=null===e?Object[_0xc101[5]](e):(i[_0xc101[4]]=e[_0xc101[4]],new i)}function __decorate(t,e,i,n){var r,s=arguments[_0xc101[6]],o=s<3?e:null===n?n=Object[_0xc101[7]](e,i):n;if(typeof Reflect===_0xc101[8]&&typeof Reflect[_0xc101[9]]===_0xc101[10])o=Reflect[_0xc101[9]](t,e,i,n);else for(var a=t[_0xc101[6]]-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,i,o):r(e,i))||o);return s>3&&o&&Object[_0xc101[11]](e,i,o),o}(Zakeke=Zakeke||{})[_0xc101[12]]={},Zakeke[_0xc101[12]][_0xc101[13]]=function(){Zakeke[_0xc101[12]].SetupCustomShaders(),Zakeke[_0xc101[12]].DefineCustomMaterials()},Zakeke[_0xc101[12]][_0xc101[14]]=function(){if(Zakeke[_0xc101[15]])for(var t in Zakeke[_0xc101[15]])BABYLON[_0xc101[16]][_0xc101[15]][t]=Zakeke[_0xc101[15]][t];if(Zakeke[_0xc101[17]])for(var t in Zakeke[_0xc101[17]])BABYLON[_0xc101[16]][_0xc101[17]][t]=Zakeke[_0xc101[17]][t]},function(t){t[_0xc101[12]][_0xc101[18]]=function(){var e=function(t){function e(){var e=t[_0xc101[19]](this)||this;return e[_0xc101[20]]=!1,e[_0xc101[21]]=!1,e[_0xc101[22]]=!1,e[_0xc101[23]]=!1,e[_0xc101[24]]=!0,e[_0xc101[25]]=!1,e[_0xc101[26]]=!1,e[_0xc101[27]]=!1,e[_0xc101[28]]=!1,e[_0xc101[29]]=!1,e[_0xc101[30]]=!1,e[_0xc101[31]]=!1,e[_0xc101[32]]=!1,e[_0xc101[33]]=!1,e[_0xc101[34]]=!1,e[_0xc101[35]]=!1,e[_0xc101[36]]=!1,e[_0xc101[37]]=!1,e[_0xc101[38]]=!1,e[_0xc101[39]]=!1,e[_0xc101[40]]=!1,e[_0xc101[41]]=!1,e[_0xc101[42]]=!1,e[_0xc101[43]]=!1,e[_0xc101[44]]=!1,e[_0xc101[45]]=!1,e[_0xc101[46]]=!1,e[_0xc101[47]]=!1,e[_0xc101[48]]=!1,e[_0xc101[49]]=!1,e[_0xc101[50]]=!1,e[_0xc101[51]]=0,e[_0xc101[52]]=0,e[_0xc101[53]](),e}return __extends(e,t),e}(BABYLON.MaterialDefines),i=function(i){function n(t,e){var n=i[_0xc101[19]](this,t,e)||this;return n[_0xc101[54]]=new BABYLON.Color3(1,1,1),n[_0xc101[55]]=new BABYLON.Color3(1,1,1),n[_0xc101[56]]=new BABYLON.Color3(0,0,0),n[_0xc101[57]]=50,n[_0xc101[58]]=.6,n[_0xc101[59]]=.5,n[_0xc101[60]]=0,n[_0xc101[61]]=1,n[_0xc101[62]]=new BABYLON.Color3(1,1,1),n[_0xc101[63]]=0,n[_0xc101[64]]=.5,n[_0xc101[65]]=0,n[_0xc101[66]]=1,n[_0xc101[67]]=1,n[_0xc101[68]]=!1,n[_0xc101[69]]=!1,n[_0xc101[70]]=!1,n[_0xc101[71]]=!1,n[_0xc101[72]]=4,n[_0xc101[73]]=new BABYLON.SmartArray(16),n[_0xc101[74]]=new BABYLON.Vector3(.3,.59,.11),n[_0xc101[75]]=new BABYLON.Vector3(.2125,.7154,.0721),n[_0xc101[76]]=new BABYLON.Matrix(.3,.59,.11,.4,.2125,.7154,.0721,0,0,0,0,0,0,0,0,0),n}return __extends(n,i),Object[_0xc101[11]](n[_0xc101[4]],_0xc101[77],{get:function(){return this[_0xc101[68]]},set:function(t){this[_0xc101[68]]!==t&&(this[_0xc101[68]]=t,this[_0xc101[79]][_0xc101[78]](this),this[_0xc101[80]][_0xc101[78]](this))},enumerable:!0,configurable:!0}),Object[_0xc101[11]](n[_0xc101[4]],_0xc101[81],{get:function(){return this[_0xc101[68]]},set:function(t){this[_0xc101[68]]!==t&&(this[_0xc101[68]]=t,this[_0xc101[79]][_0xc101[78]](this),this[_0xc101[80]][_0xc101[78]](this))},enumerable:!0,configurable:!0}),n[_0xc101[4]][_0xc101[82]]=function(){return this[_0xc101[83]]&&this[_0xc101[83]][_0xc101[84]]&&this[_0xc101[70]]},n[_0xc101[4]][_0xc101[85]]=function(t,e){t[_0xc101[86]]||(t[_0xc101[86]]=new BABYLON.UniformBuffer(e[_0xc101[87]]())),t[_0xc101[86]][_0xc101[89]](_0xc101[88],3),t[_0xc101[86]][_0xc101[89]](_0xc101[90],3),t[_0xc101[86]][_0xc101[89]](_0xc101[91],3),t[_0xc101[86]][_0xc101[5]]()},n[_0xc101[4]][_0xc101[92]]=function(t,e,i,n){void 0===n&&(n=4);for(var r=0,s=!1,o=!1,a=!1,h=0,l=e[_0xc101[93]];h<l[_0xc101[6]];h++){var c=l[h];if(void 0===i[_0xc101[94]+r]&&(s=!0),!(c[_0xc101[95]]()>1)){switch(o=!0,i[_0xc101[94]+r]=!0,i[_0xc101[96]+r]=!1,i[_0xc101[97]+r]=!1,c[_0xc101[95]]()){case 0:i[_0xc101[96]+r]=!0;break;case 1:i[_0xc101[97]+r]=!0}if(i[_0xc101[98]+r]=!1,i[_0xc101[99]+r]=!1,i[_0xc101[100]+r]=!1,i[_0xc101[101]+r]=!1,i[_0xc101[102]+r]=!1,i[_0xc101[103]+r]=!1,i[_0xc101[104]+r]=!1,e&&e[_0xc101[105]]&&t[_0xc101[106]]&&c[_0xc101[107]]&&c[_0xc101[108]]()&&c instanceof BABYLON[_0xc101[109]]){var u=t[_0xc101[87]]()[_0xc101[110]]();i[_0xc101[98]+r]=!0,i[_0xc101[102]+r]=!(!u[_0xc101[111]]||!u[_0xc101[112]])||!(!u[_0xc101[113]]||!u[_0xc101[114]]),a=!0}if(this._buildLightUniformLayout(c,t),++r===n)break}}i[_0xc101[20]]=o,i[_0xc101[21]]=a;for(var f=r;n>f;f++)void 0!==i[_0xc101[94]+f]&&(i[_0xc101[94]+f]=!1);s&&i[_0xc101[53]]()},n[_0xc101[4]][_0xc101[115]]=function(t,e,i,n,r){void 0===r&&(r=4);for(var s=0;r>s&&n[_0xc101[94]+s];s++)t[_0xc101[125]](_0xc101[88]+s,_0xc101[90]+s,_0xc101[91]+s,_0xc101[116]+s,_0xc101[117]+s,_0xc101[118]+s,_0xc101[119]+s,_0xc101[120]+s,_0xc101[121]+s,_0xc101[122]+s,_0xc101[123]+s,_0xc101[124]+s),e&&e[_0xc101[125]](_0xc101[126]+s),i[_0xc101[125]](_0xc101[127]+s),i[_0xc101[125]](_0xc101[128]+s),i[_0xc101[125]](_0xc101[129]+s)},n[_0xc101[4]][_0xc101[130]]=function(t,e,i,n,r){if(i[_0xc101[105]]&&t[_0xc101[107]]){var s=t[_0xc101[108]]();s&&(t instanceof BABYLON[_0xc101[109]]?(r[_0xc101[132]](_0xc101[124]+n,s[_0xc101[131]]()),r[_0xc101[134]](_0xc101[127]+n,s[_0xc101[133]]())):Logger[_0xc101[136]](_0xc101[135]))}},n[_0xc101[4]][_0xc101[137]]=function(t,e,i){t instanceof BABYLON[_0xc101[138]]?t[_0xc101[139]]()?t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[141]][_0xc101[140]],t[_0xc101[141]][_0xc101[142]],t[_0xc101[141]][_0xc101[143]],i):t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[145]][_0xc101[140]],t[_0xc101[145]][_0xc101[142]],t[_0xc101[145]][_0xc101[143]],i):t instanceof BABYLON[_0xc101[109]]?t[_0xc101[139]]()?t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[146]][_0xc101[140]],t[_0xc101[146]][_0xc101[142]],t[_0xc101[146]][_0xc101[143]],i):t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[147]][_0xc101[140]],t[_0xc101[147]][_0xc101[142]],t[_0xc101[147]][_0xc101[143]],i):Logger[_0xc101[136]](_0xc101[148])},n[_0xc101[4]][_0xc101[149]]=function(t,e,i,n,r){void 0===n&&(n=4);for(var s=0,o=0,a=e[_0xc101[93]];o<a[_0xc101[6]];o++){var h=a[o];if(!(h[_0xc101[95]]()>1)&&(h[_0xc101[86]][_0xc101[150]](i,_0xc101[126]+s),this._bindLightProperties(h,i,s),h[_0xc101[155]][_0xc101[154]](h[_0xc101[151]],BABYLON[_0xc101[153]][_0xc101[152]][0]),h[_0xc101[86]][_0xc101[156]](_0xc101[90],BABYLON[_0xc101[153]][_0xc101[152]][0],s+_0xc101[135]),h[_0xc101[157]][_0xc101[154]](h[_0xc101[151]],BABYLON[_0xc101[153]][_0xc101[152]][1]),h[_0xc101[86]][_0xc101[156]](_0xc101[91],BABYLON[_0xc101[153]][_0xc101[152]][1],s+_0xc101[135]),r[_0xc101[21]]&&r[_0xc101[98]+s]&&this._bindLightShadow(h,t,e,s+_0xc101[135],i),h[_0xc101[86]][_0xc101[158]](),++s===n))break}},n[_0xc101[4]][_0xc101[159]]=function(){},n[_0xc101[4]][_0xc101[160]]=function(){return _0xc101[161]},n[_0xc101[4]][_0xc101[162]]=function(){return this[_0xc101[73]][_0xc101[163]](),this[_0xc101[164]]&&this[_0xc101[164]][_0xc101[165]]&&this[_0xc101[73]][_0xc101[125]](this._reflectionTexture),this[_0xc101[73]]},n[_0xc101[4]][_0xc101[166]]=function(){return this[_0xc101[167]]<1||this[_0xc101[168]]||this._shouldUseAlphaFromAlbedoTexture()||this[_0xc101[169]]&&this[_0xc101[169]][_0xc101[170]]},n[_0xc101[4]][_0xc101[171]]=function(){return this[_0xc101[83]]&&this[_0xc101[83]][_0xc101[84]]},n[_0xc101[4]][_0xc101[172]]=function(){return this[_0xc101[83]]},n[_0xc101[4]][_0xc101[173]]=function(t,i,n){if(this[_0xc101[174]]&&this[_0xc101[175]]&&i[_0xc101[176]])return!0;i[_0xc101[177]]?i[_0xc101[177]]instanceof e||(Logger[_0xc101[136]](_0xc101[135]),i[_0xc101[177]]=new e):i[_0xc101[177]]=new e;var r=this[_0xc101[178]](),s=i[_0xc101[177]],o=r[_0xc101[87]]();if(!this[_0xc101[179]]&&i[_0xc101[176]]&&s[_0xc101[180]]===r[_0xc101[181]]())return!0;if(s[_0xc101[182]])if(!r[_0xc101[183]]||this[_0xc101[71]]||this[_0xc101[68]]){s[_0xc101[20]]=!1,s[_0xc101[21]]=!1;for(var a=0;a<this[_0xc101[72]];a++)void 0!==s[_0xc101[94]+a]&&(s[_0xc101[94]+a]=!1)}else s[_0xc101[184]]=!0,this._prepareDefinesForLights(r,t,s,this._maxSimultaneousLights);if(s[_0xc101[185]])if(s[_0xc101[186]]=!1,r[_0xc101[187]]){if(s[_0xc101[26]]=!!o[_0xc101[110]]()[_0xc101[188]],this[_0xc101[83]]){if(!this[_0xc101[83]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[27]]=!0}else s[_0xc101[27]]=!1;if(o[_0xc101[110]]()[_0xc101[190]]&&this[_0xc101[191]]){if(!this[_0xc101[191]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[184]]=!0,s[_0xc101[28]]=!0}else s[_0xc101[28]]=!1;if(this[_0xc101[192]]&&this[_0xc101[59]]){if(!this[_0xc101[192]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[29]]=!0}else s[_0xc101[29]]=!1;if(this[_0xc101[193]]&&this[_0xc101[60]]){if(!this[_0xc101[193]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[30]]=!0}else s[_0xc101[30]]=!1;if(this[_0xc101[164]]&&!this[_0xc101[68]]&&this[_0xc101[59]]){if(!this[_0xc101[164]][_0xc101[189]]())return!1;s[_0xc101[184]]=!0,s[_0xc101[31]]=!0,s[_0xc101[32]]=this[_0xc101[194]]&&this[_0xc101[195]]&&this[_0xc101[196]]}else s[_0xc101[31]]=!1,s[_0xc101[32]]=!1;if(this[_0xc101[168]]){if(!this[_0xc101[168]][_0xc101[189]]())return!1;s[_0xc101[186]]=!0,s[_0xc101[33]]=!0,s[_0xc101[34]]=this[_0xc101[168]][_0xc101[197]]}else s[_0xc101[33]]=!1,s[_0xc101[34]]=!1;if(this[_0xc101[198]]&&this[_0xc101[61]]){if(!this[_0xc101[198]][_0xc101[189]]())return!1;this[_0xc101[69]]?(s[_0xc101[186]]=!0,s[_0xc101[35]]=!0,s[_0xc101[37]]=!1,s[_0xc101[36]]=!!(this[_0xc101[65]]&&this[_0xc101[65]]-1)):(s[_0xc101[37]]=!0,s[_0xc101[35]]=!1,s[_0xc101[36]]=!1)}else s[_0xc101[35]]=!1,s[_0xc101[37]]=!1,s[_0xc101[36]]=!1;if(this[_0xc101[68]]){if(s[_0xc101[38]]=!0,s[_0xc101[184]]=!0,this[_0xc101[199]]){if(!this[_0xc101[199]][_0xc101[189]]())return!1;s[_0xc101[39]]=!0}else s[_0xc101[39]]=!1;if(this[_0xc101[200]]){if(!this[_0xc101[200]][_0xc101[189]]())return!1;s[_0xc101[40]]=!0}else s[_0xc101[40]]=!1}else s[_0xc101[38]]=!1,s[_0xc101[39]]=!1,s[_0xc101[40]]=!1;s[_0xc101[41]]=this._shouldUseAlphaFromAlbedoTexture(),s[_0xc101[42]]=!this[_0xc101[201]]}else s[_0xc101[26]]=!1,s[_0xc101[27]]=!1,s[_0xc101[28]]=!1,s[_0xc101[29]]=!1,s[_0xc101[30]]=!1,s[_0xc101[31]]=!1,s[_0xc101[32]]=!1,s[_0xc101[33]]=!1,s[_0xc101[34]]=!1,s[_0xc101[35]]=!1,s[_0xc101[37]]=!1,s[_0xc101[36]]=!1,s[_0xc101[38]]=!1,s[_0xc101[39]]=!1,s[_0xc101[40]]=!1,s[_0xc101[41]]=!1,s[_0xc101[42]]=!1;if(s[_0xc101[202]]&&(this[_0xc101[169]]&&this[_0xc101[169]][_0xc101[170]]?(s[_0xc101[184]]=!0,s[_0xc101[43]]=!0):s[_0xc101[43]]=!1),s[_0xc101[203]]&&(this[_0xc101[63]]?(s[_0xc101[44]]=!0,s[_0xc101[184]]=!0):s[_0xc101[44]]=!1,s[_0xc101[45]]=1!==this[_0xc101[66]]||1!==this[_0xc101[67]]),(s[_0xc101[204]]||s[_0xc101[184]]===s[_0xc101[205]]||s[_0xc101[186]]===s[_0xc101[206]])&&(s[_0xc101[205]]=s[_0xc101[184]],s[_0xc101[206]]=s[_0xc101[186]],s[_0xc101[184]]?(s[_0xc101[48]]=t[_0xc101[208]](BABYLON[_0xc101[207]].NormalKind))||(Logger[_0xc101[136]](_0xc101[135]),s[_0xc101[28]]=!1,s[_0xc101[31]]=!1,s[_0xc101[32]]=!1,s[_0xc101[38]]=!1,s[_0xc101[39]]=!1,s[_0xc101[43]]=!1,s[_0xc101[44]]=!1,s[_0xc101[20]]=!1,s[_0xc101[21]]=!1):s[_0xc101[48]]=!1,s[_0xc101[186]]?(s[_0xc101[49]]=t[_0xc101[208]](BABYLON[_0xc101[207]].UVKind),s[_0xc101[50]]=t[_0xc101[208]](BABYLON[_0xc101[207]].UV2Kind)):(s[_0xc101[49]]=!1,s[_0xc101[50]]=!1),t[_0xc101[209]]&&t[_0xc101[210]]?(s[_0xc101[51]]=t[_0xc101[211]],s[_0xc101[52]]=t[_0xc101[213]][_0xc101[212]][_0xc101[6]]+1):(s[_0xc101[51]]=0,s[_0xc101[52]]=0)),!1!==s[_0xc101[46]]&&(s[_0xc101[46]]=!s[_0xc101[46]],s[_0xc101[214]]()),s[_0xc101[47]]!==n&&(s[_0xc101[47]]=n,s[_0xc101[214]]()),s[_0xc101[215]]){s[_0xc101[216]](),r[_0xc101[217]]();var h=new BABYLON[_0xc101[218]];BABYLON[_0xc101[219]].HandleFallbacksForShadows(s,h,this._maxSimultaneousLights);var l=[BABYLON[_0xc101[207]][_0xc101[220]]];s[_0xc101[48]]&&l[_0xc101[125]](BABYLON[_0xc101[207]].NormalKind),s[_0xc101[49]]&&l[_0xc101[125]](BABYLON[_0xc101[207]].UVKind),s[_0xc101[50]]&&l[_0xc101[125]](BABYLON[_0xc101[207]].UV2Kind),BABYLON[_0xc101[219]].PrepareAttributesForBones(l,t,s,h),BABYLON[_0xc101[219]].PrepareAttributesForInstances(l,s);var c=_0xc101[221],u=s.toString();if(i[_0xc101[222]]!==u+this[_0xc101[223]]||!i[_0xc101[176]]){i[_0xc101[222]]=u+this[_0xc101[223]];var f=[_0xc101[224],_0xc101[225],_0xc101[226],_0xc101[227],_0xc101[228],_0xc101[229],_0xc101[230],_0xc101[231],_0xc101[232],_0xc101[233],_0xc101[234],_0xc101[235],_0xc101[236],_0xc101[237],_0xc101[238],_0xc101[239],_0xc101[240],_0xc101[241],_0xc101[242],_0xc101[243],_0xc101[244],_0xc101[245],_0xc101[246],_0xc101[247],_0xc101[248],_0xc101[249],_0xc101[250],_0xc101[251],_0xc101[252],_0xc101[253],_0xc101[254],_0xc101[255],_0xc101[256],_0xc101[257],_0xc101[258],_0xc101[259],_0xc101[260],_0xc101[261],_0xc101[262],_0xc101[263]],d=[_0xc101[264],_0xc101[265],_0xc101[266],_0xc101[267],_0xc101[268],_0xc101[269],_0xc101[270],_0xc101[271],_0xc101[272]],p=[_0xc101[273],_0xc101[274]];this._prepareUniformsAndSamplersList(f,p,d,s,this._maxSimultaneousLights),i[_0xc101[278]](r[_0xc101[87]]()[_0xc101[277]](c,{attributes:l,uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:u,fallbacks:h,onCompiled:this[_0xc101[275]],onError:this[_0xc101[276]],indexParameters:{maxSimultaneousLights:this[_0xc101[72]]}},o),s),this[_0xc101[279]]()}}return!!i[_0xc101[176]][_0xc101[280]]()&&(s[_0xc101[180]]=r[_0xc101[181]](),this[_0xc101[175]]=!0,!0)},n[_0xc101[4]][_0xc101[279]]=function(){this[_0xc101[281]][_0xc101[89]](_0xc101[229],2),this[_0xc101[281]][_0xc101[89]](_0xc101[231],2),this[_0xc101[281]][_0xc101[89]](_0xc101[234],2),this[_0xc101[281]][_0xc101[89]](_0xc101[237],2),this[_0xc101[281]][_0xc101[89]](_0xc101[240],1),this[_0xc101[281]][_0xc101[89]](_0xc101[244],2),this[_0xc101[281]][_0xc101[89]](_0xc101[247],3),this[_0xc101[281]][_0xc101[89]](_0xc101[249],1),this[_0xc101[281]][_0xc101[89]](_0xc101[250],1),this[_0xc101[281]][_0xc101[89]](_0xc101[251],1),this[_0xc101[281]][_0xc101[89]](_0xc101[230],16),this[_0xc101[281]][_0xc101[89]](_0xc101[232],16),this[_0xc101[281]][_0xc101[89]](_0xc101[235],16),this[_0xc101[281]][_0xc101[89]](_0xc101[238],16),this[_0xc101[281]][_0xc101[89]](_0xc101[245],16),this[_0xc101[281]][_0xc101[89]](_0xc101[248],16),this[_0xc101[281]][_0xc101[89]](_0xc101[228],4),this[_0xc101[281]][_0xc101[89]](_0xc101[239],3),this[_0xc101[281]][_0xc101[89]](_0xc101[258],3),this[_0xc101[281]][_0xc101[89]](_0xc101[233],1),this[_0xc101[281]][_0xc101[89]](_0xc101[236],1),this[_0xc101[281]][_0xc101[89]](_0xc101[255],1),this[_0xc101[281]][_0xc101[89]](_0xc101[256],1),this[_0xc101[281]][_0xc101[89]](_0xc101[246],1),this[_0xc101[281]][_0xc101[89]](_0xc101[259],1),this[_0xc101[281]][_0xc101[89]](_0xc101[252],3),this[_0xc101[281]][_0xc101[89]](_0xc101[253],2),this[_0xc101[281]][_0xc101[89]](_0xc101[254],2),this[_0xc101[281]][_0xc101[89]](_0xc101[241],3),this[_0xc101[281]][_0xc101[89]](_0xc101[242],3),this[_0xc101[281]][_0xc101[89]](_0xc101[243],3),this[_0xc101[281]][_0xc101[89]](_0xc101[257],4),this[_0xc101[281]][_0xc101[89]](_0xc101[261],3),this[_0xc101[281]][_0xc101[89]](_0xc101[262],3),this[_0xc101[281]][_0xc101[89]](_0xc101[263],16),this[_0xc101[281]][_0xc101[5]]()},n[_0xc101[4]][_0xc101[282]]=function(){this[_0xc101[283]]&&this[_0xc101[164]]&&this[_0xc101[164]][_0xc101[165]]&&this[_0xc101[283]][_0xc101[134]](_0xc101[269],null),i[_0xc101[4]][_0xc101[282]][_0xc101[19]](this)},n[_0xc101[4]][_0xc101[284]]=function(t,e,i){var n=this[_0xc101[178]](),r=i[_0xc101[176]],s=i[_0xc101[177]];s&&(this[_0xc101[283]]=r,this[_0xc101[285]](t),BABYLON[_0xc101[219]].BindBonesParameters(e,r),this._mustRebind(n,r,e[_0xc101[286]])&&(this[_0xc101[281]][_0xc101[150]](r,_0xc101[273]),this[_0xc101[287]](r),this[_0xc101[281]][_0xc101[288]]&&this[_0xc101[174]]&&this[_0xc101[281]][_0xc101[289]]||(s[_0xc101[43]]&&this[_0xc101[281]][_0xc101[295]](_0xc101[257],new BABYLON.Color3(this[_0xc101[169]][_0xc101[291]][_0xc101[290]](),this[_0xc101[169]][_0xc101[292]][_0xc101[290]](),this[_0xc101[169]][_0xc101[293]]),this[_0xc101[169]][_0xc101[294]]),n[_0xc101[187]]&&(s[_0xc101[27]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[229],this[_0xc101[83]][_0xc101[296]],this[_0xc101[83]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[230],this[_0xc101[83]][_0xc101[299]]())),s[_0xc101[28]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[231],this[_0xc101[191]][_0xc101[296]],1/this[_0xc101[191]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[232],this[_0xc101[191]][_0xc101[299]]())),s[_0xc101[29]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[234],this[_0xc101[192]][_0xc101[296]],this[_0xc101[192]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[235],this[_0xc101[192]][_0xc101[299]]())),s[_0xc101[30]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[237],this[_0xc101[193]][_0xc101[296]],this[_0xc101[193]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[238],this[_0xc101[193]][_0xc101[299]]())),s[_0xc101[31]]&&(this[_0xc101[281]][_0xc101[301]](_0xc101[240],this[_0xc101[164]][_0xc101[297]]),this[_0xc101[281]][_0xc101[301]](_0xc101[259],Math[_0xc101[306]](Math[_0xc101[304]](this[_0xc101[164]][_0xc101[303]]()[_0xc101[302]])*Math[_0xc101[305]])),s[_0xc101[32]]&&(this[_0xc101[281]][_0xc101[307]](_0xc101[241],this._parallaxReflectionCenter),this[_0xc101[281]][_0xc101[307]](_0xc101[242],this._parallaxReflectionBBoxMin),this[_0xc101[281]][_0xc101[307]](_0xc101[243],this._parallaxReflectionBBoxMax))),s[_0xc101[33]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[244],this[_0xc101[168]][_0xc101[296]],this[_0xc101[168]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[245],this[_0xc101[168]][_0xc101[299]]())),s[_0xc101[35]]?(this[_0xc101[281]][_0xc101[144]](_0xc101[247],this[_0xc101[198]][_0xc101[296]],this[_0xc101[198]][_0xc101[297]],this._aoPower),this[_0xc101[281]][_0xc101[300]](_0xc101[248],this[_0xc101[198]][_0xc101[299]]()),s[_0xc101[36]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[246],1-this[_0xc101[65]])):s[_0xc101[37]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[249],this._aoPower),s[_0xc101[39]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[250],this[_0xc101[199]][_0xc101[297]]),s[_0xc101[40]]&&(this[_0xc101[281]][_0xc101[301]](_0xc101[251],this[_0xc101[200]][_0xc101[297]]),this[_0xc101[281]][_0xc101[301]](_0xc101[259],Math[_0xc101[306]](Math[_0xc101[304]](this[_0xc101[200]][_0xc101[303]]()[_0xc101[302]])*Math[_0xc101[305]])))),s[_0xc101[44]]&&(this[_0xc101[281]][_0xc101[156]](_0xc101[252],this._rimColor),this[_0xc101[281]][_0xc101[298]](_0xc101[253],this._rimPower,this[_0xc101[64]]||0)),s[_0xc101[45]]&&this[_0xc101[281]][_0xc101[298]](_0xc101[254],this[_0xc101[66]]||1,this[_0xc101[67]]||1),this[_0xc101[281]][_0xc101[295]](_0xc101[228],this._albedoColor,this[_0xc101[167]]*e[_0xc101[286]]),this[_0xc101[281]][_0xc101[156]](_0xc101[239],this._reflectionColor),this[_0xc101[281]][_0xc101[156]](_0xc101[258],this._specularColor),this[_0xc101[281]][_0xc101[301]](_0xc101[233],this._reflectivity),this[_0xc101[281]][_0xc101[301]](_0xc101[236],this._microsurface),this[_0xc101[281]][_0xc101[301]](_0xc101[255],this._glossiness),this[_0xc101[281]][_0xc101[301]](_0xc101[256],this._ambientLight)),this[_0xc101[281]][_0xc101[307]](_0xc101[261],this._grayWeights),this[_0xc101[281]][_0xc101[307]](_0xc101[262],this._lumCoeff),this[_0xc101[281]][_0xc101[300]](_0xc101[263],this._renderMatrix),n[_0xc101[187]]&&(s[_0xc101[27]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[264],this._albedoTexture),s[_0xc101[28]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[265],this._bumpTexture),s[_0xc101[29]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[266],this._reflectivityTexture),s[_0xc101[30]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[267],this._microsurfaceTexture),s[_0xc101[31]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[269],this._reflectionTexture),s[_0xc101[33]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[271],this._opacityTexture),(s[_0xc101[35]]||s[_0xc101[37]])&&this[_0xc101[281]][_0xc101[134]](_0xc101[272],this._aoTexture),s[_0xc101[38]]&&(s[_0xc101[39]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[270],this._ambientTexture),s[_0xc101[40]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[268],this._matCapReflectionTexture))),r[_0xc101[309]](_0xc101[227],n[_0xc101[308]][_0xc101[145]])),(this._mustRebind(n,r)||!this[_0xc101[174]])&&(s[_0xc101[20]]&&this._bindLights(n,e,r,this._maxSimultaneousLights,s),s[_0xc101[38]]&&this[_0xc101[310]](r)),this[_0xc101[281]][_0xc101[158]](),this._afterBind(e,this._activeEffect))},n[_0xc101[4]][_0xc101[311]]=function(t,e){e&&(this[_0xc101[83]]&&(this[_0xc101[83]][_0xc101[311]](),this[_0xc101[83]]=null),this[_0xc101[191]]&&(this[_0xc101[191]][_0xc101[311]](),this[_0xc101[191]]=null),this[_0xc101[192]]&&(this[_0xc101[192]][_0xc101[311]](),this[_0xc101[192]]=null),this[_0xc101[193]]&&(this[_0xc101[193]][_0xc101[311]](),this[_0xc101[193]]=null),this[_0xc101[164]]&&(this[_0xc101[164]][_0xc101[311]](),this[_0xc101[164]]=null),this[_0xc101[168]]&&(this[_0xc101[168]][_0xc101[311]](),this[_0xc101[168]]=null),this[_0xc101[198]]&&(this[_0xc101[198]][_0xc101[311]](),this[_0xc101[198]]=null),this[_0xc101[199]]&&(this[_0xc101[199]][_0xc101[311]](),this[_0xc101[199]]=null),this[_0xc101[200]]&&(this[_0xc101[200]][_0xc101[311]](),this[_0xc101[200]]=null)),i[_0xc101[4]][_0xc101[311]][_0xc101[19]](this,t,e)},n[_0xc101[4]][_0xc101[312]]=function(){var t=i[_0xc101[4]][_0xc101[312]][_0xc101[19]](this);return this[_0xc101[83]]&&t[_0xc101[125]](this._albedoTexture),this[_0xc101[191]]&&t[_0xc101[125]](this._bumpTexture),this[_0xc101[192]]&&t[_0xc101[125]](this._reflectivityTexture),this[_0xc101[193]]&&t[_0xc101[125]](this._microsurfaceTexture),this[_0xc101[164]]&&t[_0xc101[125]](this._reflectionTexture),this[_0xc101[168]]&&t[_0xc101[125]](this._opacityTexture),this[_0xc101[198]]&&t[_0xc101[125]](this._aoTexture),this[_0xc101[199]]&&t[_0xc101[125]](this._ambientTexture),this[_0xc101[200]]&&t[_0xc101[125]](this._matCapReflectionTexture),t},n[_0xc101[4]][_0xc101[313]]=function(t){return!!i[_0xc101[4]][_0xc101[313]][_0xc101[19]](this,t)||this[_0xc101[83]]===t||this[_0xc101[191]]===t||this[_0xc101[192]]===t||this[_0xc101[193]]===t||this[_0xc101[164]]===t||this[_0xc101[168]]===t||this[_0xc101[198]]===t||this[_0xc101[199]]===t||this[_0xc101[200]]===t},n[_0xc101[4]][_0xc101[314]]=function(t){var e=this,i=BABYLON[_0xc101[315]].Clone(function(){return new Zakeke.PBRMaterial(t,e[_0xc101[178]]())},this);return i[_0xc101[316]]=t,i[_0xc101[223]]=t,i},n[_0xc101[4]][_0xc101[317]]=function(e){var i=this,n=BABYLON[_0xc101[315]].Clone(function(){return new t.PBRBlendMaterial(e,i[_0xc101[178]]())},this);return n[_0xc101[223]]=e,n[_0xc101[316]]=e,n},n[_0xc101[4]][_0xc101[318]]=function(){var t=BABYLON[_0xc101[315]].Serialize(this);return t[_0xc101[319]]=_0xc101[161],t},n[_0xc101[320]]=function(t,e,i){return BABYLON[_0xc101[315]].Parse(function(){return new Zakeke.PBRMaterial(t[_0xc101[223]],e)},t,e,i)},n}(BABYLON.PushMaterial);__decorate([BABYLON[_0xc101[322]](_0xc101[321])],i[_0xc101[4]],_0xc101[54],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[54])],i[_0xc101[4]],_0xc101[321],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[324])],i[_0xc101[4]],_0xc101[55],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[55])],i[_0xc101[4]],_0xc101[324],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[325])],i[_0xc101[4]],_0xc101[56],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[56])],i[_0xc101[4]],_0xc101[325],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[326])],i[_0xc101[4]],_0xc101[57],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[57])],i[_0xc101[4]],_0xc101[326],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[327])],i[_0xc101[4]],_0xc101[58],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[58])],i[_0xc101[4]],_0xc101[327],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[58])],i[_0xc101[4]],_0xc101[328],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[329])],i[_0xc101[4]],_0xc101[62],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[62])],i[_0xc101[4]],_0xc101[329],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[330])],i[_0xc101[4]],_0xc101[64],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[64])],i[_0xc101[4]],_0xc101[330],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[81])],i[_0xc101[4]],_0xc101[68],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[331])],i[_0xc101[4]],_0xc101[83],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[83])],i[_0xc101[4]],_0xc101[331],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[333])],i[_0xc101[4]],_0xc101[191],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[191])],i[_0xc101[4]],_0xc101[333],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[334])],i[_0xc101[4]],_0xc101[192],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[192])],i[_0xc101[4]],_0xc101[334],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[335])],i[_0xc101[4]],_0xc101[59],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[59])],i[_0xc101[4]],_0xc101[335],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[336])],i[_0xc101[4]],_0xc101[193],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[193])],i[_0xc101[4]],_0xc101[336],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[337])],i[_0xc101[4]],_0xc101[60],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[60])],i[_0xc101[4]],_0xc101[337],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[338])],i[_0xc101[4]],_0xc101[164],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[164])],i[_0xc101[4]],_0xc101[338],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[339])],i[_0xc101[4]],_0xc101[194],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[194])],i[_0xc101[4]],_0xc101[339],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[341])],i[_0xc101[4]],_0xc101[195],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[195])],i[_0xc101[4]],_0xc101[341],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[342])],i[_0xc101[4]],_0xc101[196],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[196])],i[_0xc101[4]],_0xc101[342],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[343])],i[_0xc101[4]],_0xc101[168],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[168])],i[_0xc101[4]],_0xc101[343],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[344])],i[_0xc101[4]],_0xc101[198],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[198])],i[_0xc101[4]],_0xc101[344],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[198])],i[_0xc101[4]],_0xc101[345],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[346])],i[_0xc101[4]],_0xc101[61],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[61])],i[_0xc101[4]],_0xc101[346],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[61])],i[_0xc101[4]],_0xc101[347],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[348])],i[_0xc101[4]],_0xc101[65],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[65])],i[_0xc101[4]],_0xc101[348],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[65])],i[_0xc101[4]],_0xc101[349],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[350])],i[_0xc101[4]],_0xc101[199],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[199])],i[_0xc101[4]],_0xc101[351],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[199])],i[_0xc101[4]],_0xc101[350],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[352])],i[_0xc101[4]],_0xc101[200],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[200])],i[_0xc101[4]],_0xc101[352],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[353])],i[_0xc101[4]],_0xc101[69],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[69])],i[_0xc101[4]],_0xc101[353],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[354])],i[_0xc101[4]],_0xc101[70],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[70])],i[_0xc101[4]],_0xc101[354],void 0),__decorate([BABYLON[_0xc101[356]](_0xc101[355])],i[_0xc101[4]],_0xc101[169],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[357],_0xc101[169])],i[_0xc101[4]],_0xc101[355],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[358])],i[_0xc101[4]],_0xc101[63],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[63])],i[_0xc101[4]],_0xc101[358],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[360])],i[_0xc101[4]],_0xc101[66],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[66])],i[_0xc101[4]],_0xc101[360],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[361])],i[_0xc101[4]],_0xc101[67],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[67])],i[_0xc101[4]],_0xc101[361],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[362])],i[_0xc101[4]],_0xc101[71],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[80],_0xc101[71])],i[_0xc101[4]],_0xc101[362],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[363])],i[_0xc101[4]],_0xc101[72],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[80],_0xc101[72])],i[_0xc101[4]],_0xc101[363],void 0),t[_0xc101[364]]=i,t[_0xc101[365]]=e}}(Zakeke||(Zakeke={})),function(t){t[_0xc101[12]][_0xc101[366]]=function(){t[_0xc101[12]].DefinePBRMaterial()}}(Zakeke||(Zakeke={})),Zakeke[_0xc101[17]]={zk_pbrPixelShader:_0xc101[367],zk_pbrVertexShader:_0xc101[368]},Zakeke[_0xc101[15]]={zk_n8Q2Bzi9LXc5p6RG:_0xc101[369],zk_pbrFragmentDeclaration:_0xc101[370],zk_pbrLightFragmentDeclaration:_0xc101[371],zk_w8NZg34MyJx59GeB:_0xc101[372],zk_Dp84Pxj2MTr7q6FW:_0xc101[373],zk_pbrLightUboDeclaration:_0xc101[374],zk_g9X4Qdz2LJb67MyT:_0xc101[375],zk_Ar2w4FRs58Jpc3W6:_0xc101[376],zk_Gi39AdTg7y5B2JfL:_0xc101[377],zk_pbrVertexDeclaration:_0xc101[378],zk_pbrUboDeclaration:_0xc101[379]},function(t){!function(t){!function(t){!function(t){var e,i=BABYLON.Axis,n=BABYLON.Color3,r=BABYLON.Matrix,s=BABYLON.Mesh,o=BABYLON.MeshBuilder,a=BABYLON.Path2,h=BABYLON.Quaternion,l=BABYLON.Space,c=BABYLON.StandardMaterial,u=BABYLON.Vector3;!function(t){t[t.TRANS=0]="TRANS",t[t.ROT=1]="ROT",t[t.SCALE=2]="SCALE"}(e||(e={}));var f=function(){function t(t,e,i,n,o,a){var l=this;this._local=!0,this._snapT=!1,this._snapR=!1,this._transSnap=1,this._rotSnap=Math.PI/18,this._axesLen=.4,this._axesScale=1,this._pickWidth=.02,this._visibility=.75,this._ecMatrix=new r,this._ecTOcamera=new u(0,0,0),this._distFromCamera=2,this._cameraTOec=new u(0,0,0),this._cameraNormal=new u(0,0,0),this._prevState="",this._hidden=!1,this._actionListener=null,this._actionStartListener=null,this._actionEndListener=null,this._pDown=!1,this._pointerIsOver=!1,this._editing=!1,this._rotate2=!1,this._transBy=new u(0,0,0),this._snapTV=new u(0,0,0),this._snapS=!1,this._snapSV=new u(0,0,0),this._scaleSnap=.25,this._scale=new u(0,0,0),this._localX=new u(0,0,0),this._localY=new u(0,0,0),this._localZ=new u(0,0,0),this._eulerian=!1,this._snapRA=0,this._transEnabled=!1,this._rotEnabled=!1,this._scaleEnabled=!1,this._guideSize=180,this._tSnap=new u(this._transSnap,this._transSnap,this._transSnap),this._tv1=new u(0,0,0),this._tv2=new u(0,0,0),this._tv3=new u(0,0,0),this._tm=new r,this._mesh=t,this._mainCamera=e,this._canvas=i,null!=n&&(this._axesScale=n),this._eulerian=null!==o&&o,this._checkQuaternion(),null!=a&&(this._pickWidth=a),this._scene=t.getScene(),this._actHist=new d(t,10),t.computeWorldMatrix(!0),this._boundingDimesion=this._getBoundingDimension(t),this._setLocalAxes(t),this._ecRoot=new s("EditControl",this._scene),this._ecRoot.metadata={isEditControl:!0,isRealMesh:!1},this._ecRoot.rotationQuaternion=h.Identity(),this._ecRoot.visibility=0,this._ecRoot.isPickable=!1,this._createMaterials(this._scene);var c=this._createCommonAxes();c.parent=this._ecRoot,c.metadata={isEditControl:!0,isRealMesh:!1};var f=this._createPickPlanes();f.parent=this._ecRoot,f.metadata={isEditControl:!0,isRealMesh:!1},this._pointerdown=function(t){return l._onPointerDown(t)},this._pointerup=function(t){return l._onPointerUp(t)},this._pointermove=function(t){return l._onPointerMove(t)},i.addEventListener("pointerdown",this._pointerdown,!1),i.addEventListener("pointerup",this._pointerup,!1),i.addEventListener("pointermove",this._pointermove,!1),this._renderer=function(){return l._renderLoopProcess()},this._scene.registerBeforeRender(this._renderer)}return t.prototype._centerMeshPivot=function(t){var e=this._getMeshHierarchyCenter(t);if(e){var i=e.clone(),n=t.position.subtract(i);t.setPivotMatrix(BABYLON.Matrix.Translation(n.x,n.y,n.z))}},t.prototype._getMeshHierarchyCenter=function(t){if(t){var e=t.getHierarchyBoundingVectors(!0),i=e.max.subtract(e.min);return e.min.add(i.scale(.5))}return null},t.prototype._checkQuaternion=function(){if(!this._eulerian&&(null==this._mesh.rotationQuaternion||null==this._mesh.rotationQuaternion))throw"Error: Eulerian is set to false but the mesh's rotationQuaternion is not set."},t.prototype._renderLoopProcess=function(){this._ecRoot.position=this._mesh.getAbsolutePivotPoint(),this._setECRotation(),this._setECScale(),this._local?(this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera),this._pALL.lookAt(this._ecTOcamera,0,0,0,l.LOCAL)):(this._mainCamera.position.subtractToRef(this._ecRoot.position,this._ecTOcamera),this._pALL.lookAt(this._mainCamera.position,0,0,0,l.WORLD)),this._rotEnabled?this._rotRotGuides():this._transEnabled?this._rotPlanarGuides(this._tXZ,this._tZY,this._tYX):this._scaleEnabled&&this._rotPlanarGuides(this._sXZ,this._sZY,this._sYX)},t.prototype._setECRotation=function(){if(this._local)if(null==this._mesh.parent)if(this._eulerian){var t=this._mesh.rotation;h.RotationYawPitchRollToRef(t.y,t.x,t.z,this._ecRoot.rotationQuaternion)}else this._ecRoot.rotationQuaternion.copyFrom(this._mesh.rotationQuaternion);else{if(this._isScaleUnEqual(this._mesh))return;this._mesh.getWorldMatrix().getRotationMatrixToRef(this._tm),h.FromRotationMatrixToRef(this._tm,this._ecRoot.rotationQuaternion)}},t.prototype._isScaleUnEqual=function(t){if(null==t.parent)return!1;for(;null!=t.parent;){if(t.parent.scaling.x!=t.parent.scaling.y||t.parent.scaling.y!=t.parent.scaling.z)return!0;t=t.parent}return!1},t.prototype._setECScale=function(){this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),u.FromFloatArrayToRef(this._mainCamera.getWorldMatrix().asArray(),8,this._cameraNormal);var t=u.Dot(this._cameraTOec,this._cameraNormal)/this._cameraNormal.length(),e=Math.abs(t/this._distFromCamera);u.FromFloatsToRef(e,e,e,this._ecRoot.scaling)},t.prototype._rotRotGuides=function(){var t=Math.atan(this._ecTOcamera.y/this._ecTOcamera.z);this._ecTOcamera.z>=0?this._rX.rotation.x=-t:this._rX.rotation.x=-t-Math.PI;var e=Math.atan(this._ecTOcamera.x/this._ecTOcamera.z);this._ecTOcamera.z>=0?this._rY.rotation.y=e:this._rY.rotation.y=e+Math.PI;var i=Math.atan(this._ecTOcamera.x/this._ecTOcamera.y);this._ecTOcamera.y>=0?this._rZ.rotation.z=-i:this._rZ.rotation.z=-i-Math.PI},t.prototype._rotPlanarGuides=function(t,e,i){var n=this._ecTOcamera;t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,e.rotation.x=0,e.rotation.y=0,e.rotation.z=0,i.rotation.x=0,i.rotation.y=0,i.rotation.z=0,n.x<=0&&n.y>=0&&n.z>=0?(t.rotation.z=3.14,i.rotation.y=3.14):n.x<=0&&n.y>=0&&n.z<=0?(t.rotation.y=3.14,e.rotation.y=3.14,i.rotation.y=3.14):n.x>=0&&n.y>=0&&n.z<=0?(t.rotation.x=3.14,e.rotation.y=3.14):n.x>=0&&n.y<=0&&n.z>=0?(e.rotation.z=3.14,i.rotation.x=3.14):n.x<=0&&n.y<=0&&n.z>=0?(t.rotation.z=3.14,e.rotation.z=3.14,i.rotation.z=3.14):n.x<=0&&n.y<=0&&n.z<=0?(t.rotation.y=3.14,e.rotation.x=3.14,i.rotation.z=3.14):n.x>=0&&n.y<=0&&n.z<=0&&(t.rotation.x=3.14,e.rotation.x=3.14,i.rotation.x=3.14)},t.prototype.switchTo=function(t,e){t.computeWorldMatrix(!0),this._mesh=t,null!=e&&(this._eulerian=e),this._checkQuaternion(),this._setLocalAxes(t),this._actHist=new d(t,10),this.refreshBoundingInfo()},t.prototype.setUndoCount=function(t){this._actHist.setCapacity(t)},t.prototype.undo=function(){var t=this._actHist.undo();this._mesh.computeWorldMatrix(!0),this._setLocalAxes(this._mesh),this._callActionStartListener(t),this._callActionListener(t),this._callActionEndListener(t)},t.prototype.redo=function(){var t=this._actHist.redo();this._mesh.computeWorldMatrix(!0),this._setLocalAxes(this._mesh),this._callActionStartListener(t),this._callActionListener(t),this._callActionEndListener(t)},t.prototype.detach=function(){this._canvas.removeEventListener("pointerdown",this._pointerdown,!1),this._canvas.removeEventListener("pointerup",this._pointerup,!1),this._canvas.removeEventListener("pointermove",this._pointermove,!1),this._scene.unregisterBeforeRender(this._renderer),this.removeAllActionListeners(),this._disposeAll()},t.prototype.hide=function(){this._hidden=!0,this._transEnabled?(this._prevState="T",this.disableTranslation()):this._rotEnabled?(this._prevState="R",this.disableRotation()):this._scaleEnabled&&(this._prevState="S",this.disableScaling()),this._hideCommonAxes()},t.prototype._hideCommonAxes=function(){this._xaxis.visibility=0,this._yaxis.visibility=0,this._zaxis.visibility=0},t.prototype._showCommonAxes=function(){this._xaxis.visibility=this._visibility,this._yaxis.visibility=this._visibility,this._zaxis.visibility=this._visibility},t.prototype.show=function(){this._hidden=!1,this._showCommonAxes(),"T"==this._prevState?this.enableTranslation():"R"==this._prevState?this.enableRotation():"S"==this._prevState&&this.enableScaling()},t.prototype.isHidden=function(){return this._hidden},t.prototype._disposeAll=function(){this._ecRoot.dispose(),this._disposeMaterials(),this._actHist=null},t.prototype.addActionListener=function(t){this._actionListener=t},t.prototype.removeActionListener=function(){this._actionListener=null},t.prototype.addActionStartListener=function(t){this._actionStartListener=t},t.prototype.removeActionStartListener=function(){this._actionStartListener=null},t.prototype.addActionEndListener=function(t){this._actionEndListener=t},t.prototype.removeActionEndListener=function(){this._actionEndListener=null},t.prototype.removeAllActionListeners=function(){this._actionListener=null,this._actionStartListener=null,this._actionEndListener=null},t.prototype._onPointerDown=function(t){var e=this;if(t.preventDefault(),this._pDown=!0,0==t.button){var i=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(t){if(e._transEnabled){if(t==e._tX||t==e._tY||t==e._tZ||t==e._tXZ||t==e._tZY||t==e._tYX||t==e._tAll)return!0}else if(e._rotEnabled){if(t==e._rX||t==e._rY||t==e._rZ||t==e._rAll)return!0}else if(e._scaleEnabled&&(t==e._sX||t==e._sY||t==e._sZ||t==e._sXZ||t==e._sZY||t==e._sYX||t==e._sAll))return!0;return!1},null,this._mainCamera);if(i.hit){this._axisPicked=i.pickedMesh;var n=this._axisPicked.getChildren();n.length>0?n[0].visibility=this._visibility:this._axisPicked.visibility=this._visibility;var r=this._axisPicked.name;"X"==r?this._bXaxis.visibility=1:"Y"==r?this._bYaxis.visibility=1:"Z"==r?this._bZaxis.visibility=1:"XZ"==r?(this._bXaxis.visibility=1,this._bZaxis.visibility=1):"ZY"==r?(this._bZaxis.visibility=1,this._bYaxis.visibility=1):"YX"==r?(this._bYaxis.visibility=1,this._bXaxis.visibility=1):"ALL"==r&&(this._bXaxis.visibility=1,this._bYaxis.visibility=1,this._bZaxis.visibility=1),this._setEditing(!0),this._pickedPlane=this._getPickPlane(this._axisPicked),null!=this._pickedPlane?this._prevPos=this._getPosOnPickPlane():this._prevPos=null,window.setTimeout(function(t,i){return e._detachCamera(t,i)},0,this._mainCamera,this._canvas)}}},t.prototype._setEditing=function(t){this._editing=t,t?(this._setActionType(),this._actionType==e.ROT&&(this._snapRA=0),this._callActionStartListener(this._actionType)):this._callActionEndListener(this._actionType)},t.prototype.isEditing=function(){return this._editing},t.prototype._detachCamera=function(t,e){var i=e;t.detachControl(i)},t.prototype.isPointerOver=function(){return this._pointerIsOver},t.prototype._onPointerOver=function(){var t=this,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(e){if(t._transEnabled){if(e==t._tX||e==t._tY||e==t._tZ||e==t._tXZ||e==t._tZY||e==t._tYX||e==t._tAll)return!0}else if(t._rotEnabled){if(e==t._rX||e==t._rY||e==t._rZ||e==t._rAll)return!0}else if(t._scaleEnabled&&(e==t._sX||e==t._sY||e==t._sZ||e==t._sXZ||e==t._sZY||e==t._sYX||e==t._sAll))return!0;return!1},null,this._mainCamera);if(e.hit){if(e.pickedMesh!=this._prevOverMesh){if(this._pointerIsOver=!0,this._clearPrevOverMesh(),this._prevOverMesh=e.pickedMesh,this._rotEnabled)this._savedCol=this._prevOverMesh.getChildren()[0].color,this._prevOverMesh.getChildren()[0].color=n.White();else{var i=this._prevOverMesh.getChildren();i.length>0?(this._savedMat=i[0].material,i[0].material=this._whiteMat):(this._savedMat=this._prevOverMesh.material,this._prevOverMesh.material=this._whiteMat)}"X"==this._prevOverMesh.name?this._xaxis.color=n.White():"Y"==this._prevOverMesh.name?this._yaxis.color=n.White():"Z"==this._prevOverMesh.name&&(this._zaxis.color=n.White())}}else this._pointerIsOver=!1,null!=this._prevOverMesh&&(this._restoreColor(this._prevOverMesh),this._prevOverMesh=null)},t.prototype._clearPrevOverMesh=function(){null!=this._prevOverMesh&&(this._prevOverMesh.visibility=0,this._restoreColor(this._prevOverMesh))},t.prototype._restoreColor=function(t){switch(t.name){case"X":this._xaxis.color=n.Red();break;case"Y":this._yaxis.color=n.Green();break;case"Z":this._zaxis.color=n.Blue()}if(this._rotEnabled)t.getChildren()[0].color=this._savedCol;else{var e=t.getChildren();e.length>0?e[0].material=this._savedMat:t.material=this._savedMat}},t.prototype._onPointerUp=function(t){this._pDown=!1,this._editing&&(this._mainCamera.attachControl(this._canvas),this._setEditing(!1),this._hideBaxis(),null!=this._prevOverMesh&&(this._restoreColor(this._prevOverMesh),this._prevOverMesh=null),this._actHist.add(this._actionType))},t.prototype._setActionType=function(){this._transEnabled?this._actionType=e.TRANS:this._rotEnabled?this._actionType=e.ROT:this._scaleEnabled&&(this._actionType=e.SCALE)},t.prototype._callActionListener=function(t){null!=this._actionListener&&this._actionListener(t)},t.prototype._callActionStartListener=function(t){null!=this._actionStartListener&&this._actionStartListener(t)},t.prototype._callActionEndListener=function(t){null!=this._actionEndListener&&this._actionEndListener(t)},t.prototype._onPointerMove=function(t){if(this._pDown){if(this._editing&&null!=this._prevPos){var e=this._getPosOnPickPlane();if(null!=e){if(this._rotEnabled)this._doRotation(this._mesh,this._axisPicked,e,this._prevPos);else{var i=e.subtract(this._prevPos);if(0==i.x&&0==i.y&&0==i.z)return;this._transEnabled?this._doTranslation(i):this._scaleEnabled&&this._local&&this._doScaling(i)}this._prevPos=e,this._callActionListener(this._actionType)}}}else this._onPointerOver()},t.prototype._getPickPlane=function(t){var e=t.name;if(this._transEnabled||this._scaleEnabled){if("XZ"==e)return this._pXZ;if("ZY"==e)return this._pZY;if("YX"==e)return this._pYX;if("ALL"==e)return this._pALL;this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera);var i=this._ecTOcamera;if("X"===e)return Math.abs(i.y)>Math.abs(i.z)?this._pXZ:this._pYX;if("Z"===e)return Math.abs(i.y)>Math.abs(i.x)?this._pXZ:this._pZY;if("Y"===e)return Math.abs(i.z)>Math.abs(i.x)?this._pYX:this._pZY}else{if(!this._rotEnabled)return null;switch(this._rotate2=!1,this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera),i=this._ecTOcamera,e){case"X":return Math.abs(i.x)<.2?(this._rotate2=!0,this._pALL):this._pZY;case"Y":return Math.abs(i.y)<.2?(this._rotate2=!0,this._pALL):this._pXZ;case"Z":return Math.abs(i.z)<.2?(this._rotate2=!0,this._pALL):this._pYX;default:return this._pALL}}},t.prototype._doTranslation=function(t){null!=this._mesh.parent&&this._isScaleUnEqual(this._mesh)?this._setLocalAxes(this._ecRoot):this._setLocalAxes(this._mesh);var e=this._axisPicked.name;"ALL"==e?this._transBy=t:(this._transBy.x=0,this._transBy.y=0,this._transBy.z=0,"X"!=e&&"XZ"!=e&&"YX"!=e||(this._local?this._transBy.x=u.Dot(t,this._localX)/this._localX.length():this._transBy.x=t.x),"Y"!=e&&"ZY"!=e&&"YX"!=e||(this._local?this._transBy.y=u.Dot(t,this._localY)/this._localY.length():this._transBy.y=t.y),"Z"!=e&&"XZ"!=e&&"ZY"!=e||(this._local?this._transBy.z=u.Dot(t,this._localZ)/this._localZ.length():this._transBy.z=t.z)),this._transWithSnap(this._mesh,this._transBy,this._local),this._transBoundsMin&&(this._mesh.position.x=Math.max(this._mesh.position.x,this._transBoundsMin.x),this._mesh.position.y=Math.max(this._mesh.position.y,this._transBoundsMin.y),this._mesh.position.z=Math.max(this._mesh.position.z,this._transBoundsMin.z)),this._transBoundsMax&&(this._mesh.position.x=Math.min(this._mesh.position.x,this._transBoundsMax.x),this._mesh.position.y=Math.min(this._mesh.position.y,this._transBoundsMax.y),this._mesh.position.z=Math.min(this._mesh.position.z,this._transBoundsMax.z)),this._mesh.computeWorldMatrix(!0)},t.prototype._transWithSnap=function(t,e,i){if(this._snapT){var n=!1;if(this._snapTV.addInPlace(e),Math.abs(this._snapTV.x)>this._tSnap.x&&(this._snapTV.x>0?e.x=this._tSnap.x:e.x=-this._tSnap.x,n=!0),Math.abs(this._snapTV.y)>this._tSnap.y&&(this._snapTV.y>0?e.y=this._tSnap.y:e.y=-this._tSnap.y,n=!0),Math.abs(this._snapTV.z)>this._tSnap.z&&(this._snapTV.z>0?e.z=this._tSnap.z:e.z=-this._tSnap.z,n=!0),!n)return;Math.abs(e.x)!==this._tSnap.x&&(e.x=0),Math.abs(e.y)!==this._tSnap.y&&(e.y=0),Math.abs(e.z)!==this._tSnap.z&&(e.z=0),u.FromFloatsToRef(0,0,0,this._snapTV),n=!1}i?(this._localX.normalizeToRef(this._tv1),this._localY.normalizeToRef(this._tv2),this._localZ.normalizeToRef(this._tv3),this._mesh.translate(this._tv1,e.x,l.WORLD),this._mesh.translate(this._tv2,e.y,l.WORLD),this._mesh.translate(this._tv3,e.z,l.WORLD)):null==this._mesh.parent?this._mesh.position.addInPlace(e):this._mesh.setAbsolutePosition(e.addInPlace(this._mesh.absolutePosition))},t.prototype._doScaling=function(t){this._setLocalAxes(this._mesh),this._scale.x=0,this._scale.y=0,this._scale.z=0;var e=this._axisPicked.name;"X"!=e&&"XZ"!=e&&"YX"!=e||(this._scale.x=u.Dot(t,this._localX)/this._localX.length(),this._mesh.scaling.x<0&&(this._scale.x=-this._scale.x)),"Y"!=e&&"ZY"!=e&&"YX"!=e||(this._scale.y=u.Dot(t,this._localY)/this._localY.length(),this._mesh.scaling.y<0&&(this._scale.y=-this._scale.y)),"Z"!=e&&"XZ"!=e&&"ZY"!=e||(this._scale.z=u.Dot(t,this._localZ)/this._localZ.length(),this._mesh.scaling.z<0&&(this._scale.z=-this._scale.z));var i=this._boundingDimesion;if(this._scale.x=this._scale.x/i.x,this._scale.y=this._scale.y/i.y,this._scale.z=this._scale.z/i.z,"ALL"==e){var n=u.Dot(t,this._mainCamera.upVector);n/=Math.max(i.x,i.y,i.z),this._scale.copyFromFloats(n,n,n)}else{var r=!1;"XZ"==e?(r=!0,Math.abs(this._scale.x)>Math.abs(this._scale.z)?this._scale.z=this._scale.x:this._scale.x=this._scale.z):"ZY"==e?(r=!0,Math.abs(this._scale.z)>Math.abs(this._scale.y)?this._scale.y=this._scale.z:this._scale.z=this._scale.y):"YX"==e&&(r=!0,Math.abs(this._scale.y)>Math.abs(this._scale.x)?this._scale.x=this._scale.y:this._scale.y=this._scale.x),r&&(this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),n=u.Dot(t,this._cameraTOec),this._scale.x=Math.abs(this._scale.x),this._scale.y=Math.abs(this._scale.y),this._scale.z=Math.abs(this._scale.z),n>0?(this._mesh.scaling.x>0&&(this._scale.x=-this._scale.x),this._mesh.scaling.y>0&&(this._scale.y=-this._scale.y),this._mesh.scaling.z>0&&(this._scale.z=-this._scale.z)):(this._mesh.scaling.x<0&&(this._scale.x=-this._scale.x),this._mesh.scaling.y<0&&(this._scale.y=-this._scale.y),this._mesh.scaling.z<0&&(this._scale.z=-this._scale.z)))}this._scaleWithSnap(this._mesh,this._scale),this._scaleBoundsMin&&(this._mesh.scaling.x=Math.max(this._mesh.scaling.x,this._scaleBoundsMin.x),this._mesh.scaling.y=Math.max(this._mesh.scaling.y,this._scaleBoundsMin.y),this._mesh.scaling.z=Math.max(this._mesh.scaling.z,this._scaleBoundsMin.z)),this._scaleBoundsMax&&(this._mesh.scaling.x=Math.min(this._mesh.scaling.x,this._scaleBoundsMax.x),this._mesh.scaling.y=Math.min(this._mesh.scaling.y,this._scaleBoundsMax.y),this._mesh.scaling.z=Math.min(this._mesh.scaling.z,this._scaleBoundsMax.z))},t.prototype._scaleWithSnap=function(t,e){if(this._snapS){var i=!1;if(this._snapSV.addInPlace(e),Math.abs(this._snapSV.x)>this._scaleSnap&&(e.x>0?e.x=this._scaleSnap:e.x=-this._scaleSnap,i=!0),Math.abs(this._snapSV.y)>this._scaleSnap&&(e.y>0?e.y=this._scaleSnap:e.y=-this._scaleSnap,i=!0),Math.abs(this._snapSV.z)>this._scaleSnap&&(e.z>0?e.z=this._scaleSnap:e.z=-this._scaleSnap,i=!0),!i)return;Math.abs(e.x)!==this._scaleSnap&&0!==e.x&&(e.x=0),Math.abs(e.y)!==this._scaleSnap&&0!==e.y&&(e.y=0),Math.abs(e.z)!==this._scaleSnap&&0!==e.z&&(e.z=0),u.FromFloatsToRef(0,0,0,this._snapSV),i=!1}t.scaling.addInPlace(e)},t.prototype._setLocalAxes=function(t){var e=t.getWorldMatrix();u.FromFloatArrayToRef(e.m,0,this._localX),u.FromFloatArrayToRef(e.m,4,this._localY),u.FromFloatArrayToRef(e.m,8,this._localZ)},t.prototype._getBoundingDimension=function(t){var e=t.getBoundingInfo().boundingBox,i=e.maximum.subtract(e.minimum);return 0==i.x&&(i.x=1),0==i.y&&(i.y=1),0==i.z&&(i.z=1),i},t.prototype.refreshBoundingInfo=function(){this._boundingDimesion=this._getBoundingDimension(this._mesh)},t.prototype._doRotation=function(t,e,n,r){this._local&&null!=this._mesh.parent&&this._isScaleUnEqual(t)?this._setLocalAxes(this._ecRoot):this._setLocalAxes(t);var s,o=0;e==this._rX?s=this._local?this._localX:i.X:e==this._rY?s=this._local?this._localY:i.Y:e==this._rZ&&(s=this._local?this._localZ:i.Z),this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),this._rotate2?(o=this._getAngle2(r,n,this._mainCamera.position,this._cameraTOec,s),this._scene.useRightHandedSystem&&(o=-o)):o=this._getAngle(r,n,t.getAbsolutePivotPoint(),this._cameraTOec),this._snapR&&(this._snapRA+=o,o=0,Math.abs(this._snapRA)>=this._rotSnap&&(o=this._snapRA>0?this._rotSnap:-this._rotSnap,this._snapRA=0)),0!==o&&(this._cameraTOec.normalize(),e==this._rAll?t.rotate(this._cameraTOec,-o,l.WORLD):(u.Dot(s,this._cameraTOec)>=0&&(o=-o),t.rotate(s,o,l.WORLD)),this._eulerian&&(t.rotation=t.rotationQuaternion.toEulerAngles(),t.rotationQuaternion=null),this._local&&null!=this._mesh.parent&&this._isScaleUnEqual(t)&&(e==this._rAll?this._ecRoot.rotate(this._cameraTOec,-o,l.WORLD):this._ecRoot.rotate(s,o,l.WORLD)))},t.prototype._getPosOnPickPlane=function(){var t=this,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(e){return e==t._pickedPlane},null,this._mainCamera);return e.hit?e.pickedPoint:null},t.prototype._hideBaxis=function(){this._bXaxis.visibility=0,this._bYaxis.visibility=0,this._bZaxis.visibility=0},t.prototype._setAxesVisiblity=function(t){this._transEnabled&&(this._tEndX.visibility=t,this._tEndY.visibility=t,this._tEndZ.visibility=t,this._tEndXZ.visibility=t,this._tEndZY.visibility=t,this._tEndYX.visibility=t,this._tEndAll.visibility=t),this._rotEnabled&&(this._rEndX.visibility=t,this._rEndY.visibility=t,this._rEndZ.visibility=t,this._rEndAll.visibility=t),this._scaleEnabled&&(this._sEndX.visibility=t,this._sEndY.visibility=t,this._sEndZ.visibility=t,this._sEndXZ.visibility=t,this._sEndZY.visibility=t,this._sEndYX.visibility=t,this._sEndAll.visibility=t)},t.prototype.getRotationQuaternion=function(){return this._ecRoot.rotationQuaternion},t.prototype.getPosition=function(){return this._ecRoot.position},t.prototype.isTranslationEnabled=function(){return this._transEnabled},t.prototype.enableTranslation=function(){null==this._tX&&(this._createTransAxes(),this._tCtl.parent=this._ecRoot,this._tCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._transEnabled||(this._tEndX.visibility=this._visibility,this._tEndY.visibility=this._visibility,this._tEndZ.visibility=this._visibility,this._tEndXZ.visibility=this._visibility,this._tEndZY.visibility=this._visibility,this._tEndYX.visibility=this._visibility,this._tEndAll.visibility=this._visibility,this._transEnabled=!0,this.disableRotation(),this.disableScaling())},t.prototype.disableTranslation=function(){this._transEnabled&&(this._tEndX.visibility=0,this._tEndY.visibility=0,this._tEndZ.visibility=0,this._tEndXZ.visibility=0,this._tEndZY.visibility=0,this._tEndYX.visibility=0,this._tEndAll.visibility=0,this._transEnabled=!1)},t.prototype.isRotationEnabled=function(){return this._rotEnabled},t.prototype.returnEuler=function(t){this._eulerian=t},t.prototype.enableRotation=function(){null==this._rCtl&&(this._createRotAxes(),this._rCtl.parent=this._ecRoot,this._rCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._rotEnabled||(this._rEndX.visibility=this._visibility,this._rEndY.visibility=this._visibility,this._rEndZ.visibility=this._visibility,this._rEndAll.visibility=this._visibility,this._rEndAll2.visibility=this._visibility,this._rotEnabled=!0,this.disableTranslation(),this.disableScaling())},t.prototype.disableRotation=function(){this._rotEnabled&&(this._rEndX.visibility=0,this._rEndY.visibility=0,this._rEndZ.visibility=0,this._rEndAll.visibility=0,this._rEndAll2.visibility=0,this._rotEnabled=!1)},t.prototype.isScalingEnabled=function(){return this._scaleEnabled},t.prototype.enableScaling=function(){null==this._sX&&(this._createScaleAxes(),this._sCtl.parent=this._ecRoot,this._sCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._scaleEnabled||(this._sEndX.visibility=this._visibility,this._sEndY.visibility=this._visibility,this._sEndZ.visibility=this._visibility,this._sEndXZ.visibility=this._visibility,this._sEndZY.visibility=this._visibility,this._sEndYX.visibility=this._visibility,this._sEndAll.visibility=this._visibility,this._scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},t.prototype.disableScaling=function(){this._scaleEnabled&&(this._sEndX.visibility=0,this._sEndY.visibility=0,this._sEndZ.visibility=0,this._sEndXZ.visibility=0,this._sEndZY.visibility=0,this._sEndYX.visibility=0,this._sEndAll.visibility=0,this._scaleEnabled=!1)},t.prototype.setScaleBounds=function(t,e){this._scaleBoundsMin=t||null,this._scaleBoundsMax=e||null,null!=this._scaleBoundsMin&&(0==this._scaleBoundsMin.x&&(this._scaleBoundsMin.x=1e-8),0==this._scaleBoundsMin.y&&(this._scaleBoundsMin.y=1e-8),0==this._scaleBoundsMin.z&&(this._scaleBoundsMin.z=1e-8))},t.prototype.removeScaleBounds=function(){this._scaleBoundsMin=null,this._scaleBoundsMax=null},t.prototype.setTransBounds=function(t,e){this._transBoundsMin=t||null,this._transBoundsMax=e||null},t.prototype.removeTransBounds=function(){this._transBoundsMin=null,this._transBoundsMax=null},t.prototype.setRotBounds=function(t,e){this._rotBoundsMin=t||null,this._rotBoundsMax=e||null},t.prototype.removeRotBounds=function(){this._rotBoundsMin=null,this._rotBoundsMax=null},t.prototype._createCommonAxes=function(){var t=new s("guideCtl",this._scene);this._bXaxis=s.CreateLines("bxAxis",[new u(-100,0,0),new u(100,0,0)],this._scene),this._bYaxis=s.CreateLines("byAxis",[new u(0,-100,0),new u(0,100,0)],this._scene),this._bZaxis=s.CreateLines("bzAxis",[new u(0,0,-100),new u(0,0,100)],this._scene),this._bXaxis.isPickable=!1,this._bYaxis.isPickable=!1,this._bZaxis.isPickable=!1,this._bXaxis.parent=t,this._bYaxis.parent=t,this._bZaxis.parent=t,this._bXaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bYaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bZaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bXaxis.color=n.Red(),this._bYaxis.color=n.Green(),this._bZaxis.color=n.Blue(),this._hideBaxis();var e=this._axesLen*this._axesScale*.75;return this._xaxis=s.CreateLines("xAxis",[new u(0,0,0),new u(e,0,0)],this._scene),this._yaxis=s.CreateLines("yAxis",[new u(0,0,0),new u(0,e,0)],this._scene),this._zaxis=s.CreateLines("zAxis",[new u(0,0,0),new u(0,0,e)],this._scene),this._xaxis.isPickable=!1,this._yaxis.isPickable=!1,this._zaxis.isPickable=!1,this._xaxis.parent=t,this._yaxis.parent=t,this._zaxis.parent=t,this._xaxis.metadata={isEditControl:!0,isRealMesh:!1},this._yaxis.metadata={isEditControl:!0,isRealMesh:!1},this._zaxis.metadata={isEditControl:!0,isRealMesh:!1},this._xaxis.color=n.Red(),this._yaxis.color=n.Green(),this._zaxis.color=n.Blue(),this._xaxis.renderingGroupId=1,this._yaxis.renderingGroupId=1,this._zaxis.renderingGroupId=1,t},t.prototype._createPickPlanes=function(){this._pALL=s.CreatePlane("pALL",5,this._scene),this._pXZ=s.CreatePlane("pXZ",5,this._scene),this._pZY=s.CreatePlane("pZY",5,this._scene),this._pYX=s.CreatePlane("pYX",5,this._scene),this._pALL.isPickable=!1,this._pXZ.isPickable=!1,this._pZY.isPickable=!1,this._pYX.isPickable=!1,this._pALL.visibility=0,this._pXZ.visibility=0,this._pZY.visibility=0,this._pYX.visibility=0,this._pALL.renderingGroupId=1,this._pXZ.renderingGroupId=1,this._pZY.renderingGroupId=1,this._pYX.renderingGroupId=1,this._pALL.lookAt(this._mainCamera.position),this._pXZ.rotate(i.X,1.57),this._pZY.rotate(i.Y,1.57);var t=new s("pickPlanes",this._scene);return this._pALL.parent=t,this._pALL.metadata={isEditControl:!0,isRealMesh:!1},this._pXZ.parent=t,this._pXZ.metadata={isEditControl:!0,isRealMesh:!1},this._pZY.parent=t,this._pZY.metadata={isEditControl:!0,isRealMesh:!1},this._pYX.parent=t,this._pYX.metadata={isEditControl:!0,isRealMesh:!1},t},t.prototype._createTransAxes=function(){var t=2*this._pickWidth*this._axesScale,e=this._axesLen*this._axesScale;this._tCtl=new s("tarnsCtl",this._scene),this._tX=this._extrudeBox(t/2,e),this._tX.name="X",this._tY=this._tX.clone("Y"),this._tZ=this._tX.clone("Z"),this._tXZ=o.CreatePlane("XZ",{size:2*t},this._scene),this._tZY=o.CreatePlane("ZY",{size:2*t},this._scene),this._tYX=o.CreatePlane("YX",{size:2*t},this._scene),this._tXZ.rotation.x=1.57,this._tZY.rotation.y=-1.57,this._tXZ.position.x=t,this._tXZ.position.z=t,this._tZY.position.z=t,this._tZY.position.y=t,this._tYX.position.y=t,this._tYX.position.x=t,this._tXZ.bakeCurrentTransformIntoVertices(),this._tZY.bakeCurrentTransformIntoVertices(),this._tYX.bakeCurrentTransformIntoVertices(),this._tAll=s.CreateBox("ALL",2*t,this._scene),this._tX.parent=this._tCtl,this._tX.metadata={isEditControl:!0,isRealMesh:!1},this._tY.parent=this._tCtl,this._tY.metadata={isEditControl:!0,isRealMesh:!1},this._tZ.parent=this._tCtl,this._tZ.metadata={isEditControl:!0,isRealMesh:!1},this._tXZ.parent=this._tCtl,this._tXZ.metadata={isEditControl:!0,isRealMesh:!1},this._tZY.parent=this._tCtl,this._tZY.metadata={isEditControl:!0,isRealMesh:!1},this._tYX.parent=this._tCtl,this._tYX.metadata={isEditControl:!0,isRealMesh:!1},this._tAll.parent=this._tCtl,this._tAll.metadata={isEditControl:!0,isRealMesh:!1},this._tX.rotation.y=1.57,this._tY.rotation.x-=1.57,this._tX.visibility=0,this._tY.visibility=0,this._tZ.visibility=0,this._tXZ.visibility=0,this._tZY.visibility=0,this._tYX.visibility=0,this._tAll.visibility=0,this._tX.isPickable=!1,this._tY.isPickable=!1,this._tZ.isPickable=!1,this._tXZ.isPickable=!1,this._tZY.isPickable=!1,this._tYX.isPickable=!1,this._tAll.isPickable=!1;var i=e/5,n=t;this._tEndX=s.CreateCylinder("tEndX",i,0,n,6,1,this._scene),this._tEndY=this._tEndX.clone("tEndY"),this._tEndZ=this._tEndX.clone("tEndZ"),this._tEndXZ=this._createTriangle("XZ",1.75*n,this._scene),this._tEndZY=this._tEndXZ.clone("ZY"),this._tEndYX=this._tEndXZ.clone("YX"),this._tEndAll=o.CreatePolyhedron("tEndAll",{type:1,size:n/2},this._scene),this._tEndX.rotation.x=1.57,this._tEndY.rotation.x=1.57,this._tEndZ.rotation.x=1.57,this._tEndZY.rotation.z=1.57,this._tEndYX.rotation.x=-1.57,this._tEndXZ.position.x=t,this._tEndXZ.position.z=t,this._tEndZY.position.z=t,this._tEndZY.position.y=t,this._tEndYX.position.y=t,this._tEndYX.position.x=t,this._tEndX.parent=this._tX,this._tEndX.metadata={isEditControl:!0,isRealMesh:!1},this._tEndY.parent=this._tY,this._tEndY.metadata={isEditControl:!0,isRealMesh:!1},this._tEndZ.parent=this._tZ,this._tEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._tEndXZ.parent=this._tXZ,this._tEndXZ.metadata={isEditControl:!0,isRealMesh:!1},this._tEndZY.parent=this._tZY,this._tEndZY.metadata={isEditControl:!0,isRealMesh:!1},this._tEndYX.parent=this._tYX,this._tEndYX.metadata={isEditControl:!0,isRealMesh:!1},this._tEndAll.parent=this._tAll,this._tEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._tEndX.position.z=e-i/2,this._tEndY.position.z=e-i/2,this._tEndZ.position.z=e-i/2,this._tEndX.material=this._redMat,this._tEndY.material=this._greenMat,this._tEndZ.material=this._blueMat,this._tEndXZ.material=this._greenMat,this._tEndZY.material=this._redMat,this._tEndYX.material=this._blueMat,this._tEndAll.material=this._yellowMat,this._tEndX.renderingGroupId=2,this._tEndY.renderingGroupId=2,this._tEndZ.renderingGroupId=2,this._tEndXZ.renderingGroupId=2,this._tEndZY.renderingGroupId=2,this._tEndYX.renderingGroupId=2,this._tEndAll.renderingGroupId=2,this._tEndX.isPickable=!1,this._tEndY.isPickable=!1,this._tEndZ.isPickable=!1,this._tEndXZ.isPickable=!1,this._tEndZY.isPickable=!1,this._tEndYX.isPickable=!1,this._tEndAll.isPickable=!1},t.prototype._createTriangle=function(t,e,i){console.log("_createTriangle "+e);var n=new a(e/2,-e/2).addLineTo(e/2,e/2).addLineTo(-e/2,e/2).addLineTo(e/2,-e/2);return new BABYLON.PolygonMeshBuilder(t,n,i).build()},t.prototype.setRotGuideFull=function(t){this._guideSize=t?360:180,null!=this._rCtl&&(this._rCtl.dispose(),this._rAll.dispose(),this._rCtl=null,this.enableRotation())},t.prototype._createRotAxes=function(){var t=this._axesLen*this._axesScale*2;this._rCtl=new s("rotCtl",this._scene),this._rX=this._createTube(t/2,this._guideSize),this._rX.name="X",this._rY=this._createTube(t/2,this._guideSize),this._rY.name="Y",this._rZ=this._createTube(t/2,this._guideSize),this._rZ.name="Z",this._rAll=this._createTube(t/1.75,360),this._rAll.name="ALL",this._rX.rotation.z=1.57,this._rZ.rotation.x=-1.57,this._rX.bakeCurrentTransformIntoVertices(),this._rZ.bakeCurrentTransformIntoVertices(),this._rAll.rotation.x=1.57,this._rX.parent=this._rCtl,this._rX.metadata={isEditControl:!0,isRealMesh:!1},this._rY.parent=this._rCtl,this._rY.metadata={isEditControl:!0,isRealMesh:!1},this._rZ.parent=this._rCtl,this._rZ.metadata={isEditControl:!0,isRealMesh:!1},this._rAll.parent=this._pALL,this._rAll.metadata={isEditControl:!0,isRealMesh:!1},this._rX.visibility=0,this._rY.visibility=0,this._rZ.visibility=0,this._rAll.visibility=0,this._rX.isPickable=!1,this._rY.isPickable=!1,this._rZ.isPickable=!1,this._rAll.isPickable=!1;var e=t;this._rEndX=this._createCircle(e/2,this._guideSize,!1),this._rEndY=this._rEndX.clone(""),this._rEndZ=this._rEndX.clone(""),this._rEndAll=this._createCircle(e/1.75,360,!1),this._rEndAll2=this._createCircle(e/2,360,!1),this._rEndX.parent=this._rX,this._rEndX.metadata={isEditControl:!0,isRealMesh:!1},this._rEndY.parent=this._rY,this._rEndY.metadata={isEditControl:!0,isRealMesh:!1},this._rEndZ.parent=this._rZ,this._rEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._rEndX.rotation.z=1.57,this._rEndZ.rotation.x=-1.57,this._rEndAll.parent=this._rAll,this._rEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._rEndAll2.parent=this._rAll,this._rEndAll2.metadata={isEditControl:!0,isRealMesh:!1},this._rEndX.color=n.Red(),this._rEndY.color=n.Green(),this._rEndZ.color=n.Blue(),this._rEndAll.color=n.Yellow(),this._rEndAll2.color=n.Gray(),this._rEndX.renderingGroupId=2,this._rEndY.renderingGroupId=2,this._rEndZ.renderingGroupId=2,this._rEndAll.renderingGroupId=2,this._rEndAll2.renderingGroupId=2,this._rEndX.isPickable=!1,this._rEndY.isPickable=!1,this._rEndZ.isPickable=!1,this._rEndAll.isPickable=!1,this._rEndAll2.isPickable=!1},t.prototype._extrudeBox=function(t,e){var i=[new u(t,t,0),new u(-t,t,0),new u(-t,-t,0),new u(t,-t,0),new u(t,t,0)],n=[new u(0,0,0),new u(0,0,e)];return s.ExtrudeShape("",i,n,1,0,2,this._scene)},t.prototype._createCircle=function(t,e,i){null===e&&(e=360);for(var n,r,o=[],a=3.14/180,h=0,l=0;l<=e;l+=5)n=t*Math.cos(l*a),r=90==l?t:270==l?-t:t*Math.sin(l*a),o[h]=new u(n,0,r),h++;if(i)for(t-=.04,l=0;l<=e;l+=5)n=t*Math.cos(l*a),r=90==l?t:270==l?-t:t*Math.sin(l*a),o[h]=new u(n,0,r),h++;return s.CreateLines("",o,this._scene)},t.prototype._createTube=function(t,e){null===e&&(e=360);for(var i,n,r=[],o=3.14/180,a=0,h=0;h<=e;h+=30)i=t*Math.cos(h*o),n=90==h?t:270==h?-t:t*Math.sin(h*o),r[a]=new u(i,0,n),a++;return s.CreateTube("",r,this._pickWidth*this._axesScale*2,3,null,BABYLON.Mesh.NO_CAP,this._scene)},t.prototype._createScaleAxes=function(){var t=2*this._pickWidth*this._axesScale,e=this._axesLen*this._axesScale;this._sCtl=new s("sCtl",this._scene),this._sX=this._extrudeBox(t/2,e),this._sX.name="X",this._sY=this._sX.clone("Y"),this._sZ=this._sX.clone("Z"),this._sXZ=o.CreatePlane("XZ",{size:2*t},this._scene),this._sZY=o.CreatePlane("ZY",{size:2*t},this._scene),this._sYX=o.CreatePlane("YX",{size:2*t},this._scene),this._sXZ.rotation.x=1.57,this._sZY.rotation.y=-1.57,this._sXZ.position.x=t,this._sXZ.position.z=t,this._sZY.position.z=t,this._sZY.position.y=t,this._sYX.position.y=t,this._sYX.position.x=t,this._sXZ.bakeCurrentTransformIntoVertices(),this._sZY.bakeCurrentTransformIntoVertices(),this._sYX.bakeCurrentTransformIntoVertices(),this._sAll=s.CreateBox("ALL",2*t,this._scene),this._sX.parent=this._sCtl,this._sX.metadata={isEditControl:!0,isRealMesh:!1},this._sY.parent=this._sCtl,this._sY.metadata={isEditControl:!0,isRealMesh:!1},this._sZ.parent=this._sCtl,this._sZ.metadata={isEditControl:!0,isRealMesh:!1},this._sAll.parent=this._sCtl,this._sAll.metadata={isEditControl:!0,isRealMesh:!1},this._sXZ.parent=this._sCtl,this._sXZ.metadata={isEditControl:!0,isRealMesh:!1},this._sZY.parent=this._sCtl,this._sZY.metadata={isEditControl:!0,isRealMesh:!1},this._sYX.parent=this._sCtl,this._sYX.metadata={isEditControl:!0,isRealMesh:!1},this._sX.rotation.y=1.57,this._sY.rotation.x-=1.57,this._sX.visibility=0,this._sY.visibility=0,this._sZ.visibility=0,this._sXZ.visibility=0,this._sZY.visibility=0,this._sYX.visibility=0,this._sAll.visibility=0,this._sX.isPickable=!1,this._sY.isPickable=!1,this._sZ.isPickable=!1,this._sXZ.isPickable=!1,this._sZY.isPickable=!1,this._sYX.isPickable=!1,this._sAll.isPickable=!1;var i=t;this._sEndX=s.CreateBox("",i,this._scene),this._sEndY=this._sEndX.clone(""),this._sEndZ=this._sEndX.clone(""),this._sEndXZ=this._createTriangle("XZ",1.75*i,this._scene),this._sEndZY=this._sEndXZ.clone("ZY"),this._sEndYX=this._sEndXZ.clone("YX"),this._sEndAll=o.CreatePolyhedron("sEndAll",{type:1,size:i/2},this._scene),this._sEndZY.rotation.z=1.57,this._sEndYX.rotation.x=-1.57,this._sEndXZ.position.x=t,this._sEndXZ.position.z=t,this._sEndZY.position.z=t,this._sEndZY.position.y=t,this._sEndYX.position.y=t,this._sEndYX.position.x=t,this._sEndX.parent=this._sX,this._sEndX.metadata={isEditControl:!0,isRealMesh:!1},this._sEndY.parent=this._sY,this._sEndY.metadata={isEditControl:!0,isRealMesh:!1},this._sEndZ.parent=this._sZ,this._sEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._sEndXZ.parent=this._sXZ,this._sEndXZ.metadata={isEditControl:!0,isRealMesh:!1},this._sEndZY.parent=this._sZY,this._sEndZY.metadata={isEditControl:!0,isRealMesh:!1},this._sEndYX.parent=this._sYX,this._sEndYX.metadata={isEditControl:!0,isRealMesh:!1},this._sEndAll.parent=this._sAll,this._sEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._sEndX.position.z=e-i/2,this._sEndY.position.z=e-i/2,this._sEndZ.position.z=e-i/2,this._sEndX.material=this._redMat,this._sEndY.material=this._greenMat,this._sEndZ.material=this._blueMat,this._sEndXZ.material=this._greenMat,this._sEndZY.material=this._redMat,this._sEndYX.material=this._blueMat,this._sEndAll.material=this._yellowMat,this._sEndX.renderingGroupId=2,this._sEndY.renderingGroupId=2,this._sEndZ.renderingGroupId=2,this._sEndXZ.renderingGroupId=2,this._sEndZY.renderingGroupId=2,this._sEndYX.renderingGroupId=2,this._sEndAll.renderingGroupId=2,this._sEndX.isPickable=!1,this._sEndY.isPickable=!1,this._sEndZ.isPickable=!1,this._sEndXZ.isPickable=!1,this._sEndZY.isPickable=!1,this._sEndYX.isPickable=!1,this._sEndAll.isPickable=!1},t.prototype._check_LHS_RHS=function(t){var e=u.Cross(this._localX,this._localY);return u.Dot(e,this._localZ)<0},t.prototype.setVisibility=function(t){this._visibility=t},t.prototype.setLocal=function(t){this._local!=t&&(this._local=t,t||(this._ecRoot.rotationQuaternion=h.Identity()))},t.prototype.isLocal=function(){return this._local},t.prototype.setTransSnap=function(t){this._snapT=t},t.prototype.setRotSnap=function(t){this._snapR=t},t.prototype.setScaleSnap=function(t){this._snapS=t},t.prototype.setTransSnapValue=function(t){this._tSnap.copyFromFloats(t,t,t),this._transSnap=t},t.prototype.setRotSnapValue=function(t){this._rotSnap=t},t.prototype.setScaleSnapValue=function(t){this._scaleSnap=t},t.prototype._getAngle2=function(t,e,i,n,r){var s=u.Dot(n,r);r.scaleToRef(s,this._tv1),i.addToRef(this._tv1,this._tv2);var o=this._tv2;this._mainCamera.getWorldMatrix().invertToRef(this._tm),u.TransformCoordinatesToRef(this._tv2,this._tm,this._tv2);var a=0;o.x>=0&&o.y>=0?a=1:o.x<=0&&o.y>=0?a=2:o.x<=0&&o.y<=0?a=3:o.x>=0&&o.y<=0&&(a=4),u.TransformCoordinatesToRef(t,this._tm,this._tv1),u.TransformCoordinatesToRef(e,this._tm,this._tv2),this._tv2.subtractInPlace(this._tv1);var h=this._tv2,l=h.length(),c="";h.x>=0&&h.y>=0?c=h.x>=h.y?"r":"u":h.x<=0&&h.y>=0?c=-h.x>=h.y?"l":"u":h.x<=0&&h.y<=0?c=-h.x>=-h.y?"l":"d":h.x>=0&&h.y<=0&&(c=h.x>=-h.y?"r":"d");var f=0;return"d"==c?f=1==a||4==a?1:-1:"u"==c?f=1==a||4==a?-1:1:"r"==c?f=2==a||1==a?1:-1:"l"==c&&(f=2==a||1==a?-1:1),f*l},t.prototype._getAngle=function(t,e,i,n){t.subtractToRef(i,this._tv1),e.subtractToRef(i,this._tv2),u.CrossToRef(this._tv1,this._tv2,this._tv3);var r=Math.asin(this._tv3.length()/(this._tv1.length()*this._tv2.length()));return u.Dot(this._tv3,n)>0&&(r*=-1),r},t.prototype._createMaterials=function(e){this._redMat=t._getStandardMaterial("redMat",n.Red(),e),this._greenMat=t._getStandardMaterial("greenMat",n.Green(),e),this._blueMat=t._getStandardMaterial("blueMat",n.Blue(),e),this._whiteMat=t._getStandardMaterial("whiteMat",n.White(),e),this._yellowMat=t._getStandardMaterial("whiteMat",n.Yellow(),e)},t.prototype._disposeMaterials=function(){this._redMat.dispose(),this._greenMat.dispose(),this._blueMat.dispose(),this._whiteMat.dispose(),this._yellowMat.dispose()},t._getStandardMaterial=function(t,e,i){var r=new c(t,i);return r.emissiveColor=e,r.diffuseColor=n.Black(),r.specularColor=n.Black(),r.backFaceCulling=!1,r},t}();t.EditControl=f;var d=function(){function t(t,e){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=e-1,this.add()}return t.prototype.setCapacity=function(t){0!=t?(this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()):console.error("capacity should be more than zero")},t.prototype.add=function(t){void 0===t&&(t=null);var e=new p(this.mesh,t);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(e)):(this.acts.push(e),this.last++,this.current++)},t.prototype.undo=function(){if(this.current>0){var t=this.acts[this.current].getActionType();return this.current--,this.acts[this.current].perform(this.mesh),t}},t.prototype.redo=function(){if(this.current<this.last)return this.current++,this.acts[this.current].perform(this.mesh),this.acts[this.current].getActionType()},t}();t.ActHist=d;var p=function(){function t(t,e){this._p=t.position.clone(),null==t.rotationQuaternion?(this._rQ=null,this._rE=t.rotation.clone()):(this._rQ=t.rotationQuaternion.clone(),this._rE=null),this._s=t.scaling.clone(),this._at=e}return t.prototype.getActionType=function(){return this._at},t.prototype.perform=function(t){t.position.copyFrom(this._p),null==t.rotationQuaternion?null!=this._rE?t.rotation.copyFrom(this._rE):t.rotation.copyFrom(this._rQ.toEulerAngles()):null!=this._rQ?t.rotationQuaternion.copyFrom(this._rQ):t.rotationQuaternion.copyFrom(h.RotationYawPitchRoll(this._rE.y,this._rE.x,this._rE.z)),t.scaling.copyFrom(this._s)},t}();t.Act=p}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),function(t){var e=BABYLON.Color3,i=BABYLON.StandardMaterial,n=BABYLON.Matrix,r=BABYLON.Mesh,s=BABYLON.Vector3,o=BABYLON.Quaternion,a=BABYLON.VertexData,h=BABYLON.LinesMesh,l=function(){function t(n,s,o,a,h,l){void 0===s&&(s=1911),this._scene=n,this._arrowLength=o||1,this._coneLength=a||.2,this._coneRadius=h||.1,this._planeSelectionLength=l||this._arrowLength/5,this._wireSelectionThreshold=.05,this._light1=new BABYLON.PointLight("ManipulatorLight",new BABYLON.Vector3(50,50,70),this._scene),this._light1.id="***SceneManipulatorLight***",this._light2=new BABYLON.PointLight("ManipulatorLight",new BABYLON.Vector3(-50,-50,-70),this._scene),this._light2.id="***SceneManipulatorLight***",this._xArrowColor=new e(t.pc,t.sc/2,t.sc),this._yArrowColor=new e(t.sc,t.pc,t.sc/2),this._zArrowColor=new e(t.sc/2,t.sc,t.pc),this._xyPlaneSelectionColor=new e(t.pc/1.1,t.pc/1.3,t.sc),this._xzPlaneSelectionColor=new e(t.pc/1.1,t.sc,t.pc/1.3),this._yzPlaneSelectionColor=new e(t.sc,t.pc/1.3,t.pc/1.1);var c=[];c.push({name:"arrowX",color:this.xArrowColor}),c.push({name:"arrowY",color:this.yArrowColor}),c.push({name:"arrowZ",color:this.zArrowColor}),c.push({name:"planeXY",color:this.xyPlaneSelectionColor}),c.push({name:"planeXZ",color:this.xzPlaneSelectionColor}),c.push({name:"planeYZ",color:this.yzPlaneSelectionColor}),c.push({name:"rotationX",color:this.xArrowColor.clone()}),c.push({name:"rotationY",color:this.yArrowColor.clone()}),c.push({name:"rotationZ",color:this.zArrowColor.clone()}),this._materials=[];for(var u=0,f=c;u<f.length;u++){var d=f[u],p=new i(d.name+"RadixMaterial",this._scene);p.diffuseColor=d.color,this._materials[d.name]=p}this._features=s,this._rootMesh=new r("radixRoot",this._scene),this._rootMesh.renderingGroupId=1,this.constructGraphicalObjects()}return Object.defineProperty(t.prototype,"wireSelectionThreshold",{get:function(){return this._wireSelectionThreshold},set:function(t){this._wireSelectionThreshold=t;for(var e=0,i=this._rootMesh.getChildMeshes(!0,function(t){return t instanceof h});e<i.length;e++){var n=i[e];n&&(n.intersectionThreshold=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xArrowColor",{get:function(){return this._xArrowColor},set:function(t){this._xArrowColor=t,this.updateMaterial("arrowX",t),this.updateMaterial("rotationX",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yArrowColor",{get:function(){return this._yArrowColor},set:function(t){this._yArrowColor=t,this.updateMaterial("arrowY",t),this.updateMaterial("rotationY",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zArrowColor",{get:function(){return this._zArrowColor},set:function(t){this._zArrowColor=t,this.updateMaterial("arrowZ",t),this.updateMaterial("rotationZ",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyPlaneSelectionColor",{get:function(){return this._xyPlaneSelectionColor},set:function(t){this._xyPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xzPlaneSelectionColor",{get:function(){return this._xzPlaneSelectionColor},set:function(t){this._xzPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yzPlaneSelectionColor",{get:function(){return this._yzPlaneSelectionColor},set:function(t){this._yzPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlighted",{get:function(){return this._highlighted},set:function(t){this.updateMaterialFromHighlighted(1,t,"arrowX"),this.updateMaterialFromHighlighted(2,t,"arrowY"),this.updateMaterialFromHighlighted(4,t,"arrowZ"),this.updateMaterialFromHighlighted(16,t,"planeXY"),this.updateMaterialFromHighlighted(32,t,"planeXZ"),this.updateMaterialFromHighlighted(64,t,"planeYZ"),this.updateMaterialFromHighlighted(256,t,"rotationX"),this.updateMaterialFromHighlighted(512,t,"rotationY"),this.updateMaterialFromHighlighted(1024,t,"rotationZ"),this._highlighted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),t.prototype.intersect=function(t){var e,i=0,n=Number.MAX_VALUE;return this.hasFeature(1)&&(e=this.intersectMeshes(t,"arrowX",n))<n&&(n=e,i=1),this.hasFeature(2)&&(e=this.intersectMeshes(t,"arrowY",n))<n&&(n=e,i=2),this.hasFeature(4)&&(e=this.intersectMeshes(t,"arrowZ",n))<n&&(n=e,i=4),this.hasFeature(16)&&(e=this.intersectMeshes(t,"planeXY",n))<n&&(n=e,i=16),this.hasFeature(32)&&(e=this.intersectMeshes(t,"planeXZ",n))<n&&(n=e,i=32),this.hasFeature(64)&&(e=this.intersectMeshes(t,"planeYZ",n))<n&&(n=e,i=64),this.hasFeature(256)&&(e=this.intersectMeshes(t,"rotationX",n))<n&&(n=e,i=256),this.hasFeature(512)&&(e=this.intersectMeshes(t,"rotationY",n))<n&&(n=e,i=512),this.hasFeature(1024)&&(e=this.intersectMeshes(t,"rotationZ",n))<n&&(n=e,i=1024),i},t.prototype.setWorld=function(t,e,i){this._rootMesh.position=t,this._rootMesh.rotationQuaternion=e,this._rootMesh.scaling=i},t.prototype.show=function(){this.setVisibleState(this._rootMesh,!0)},t.prototype.hide=function(){this.setVisibleState(this._rootMesh,!1)},t.prototype.setVisibleState=function(t,e){var i=this;t.isVisible=e,t.getChildMeshes(!0).forEach(function(t){return i.setVisibleState(t,e)})},t.prototype.intersectMeshes=function(t,e,i){for(var n=0,r=this._rootMesh.getChildMeshes(!0,function(t){return 0===t.name.indexOf(e)});n<r.length;n++){var s=r[n],o=this._scene.createPickingRay(t.x,t.y,s.getWorldMatrix(),this._scene.activeCamera),a=s.intersects(o,!1);a.hit&&a.distance<i&&(i=a.distance)}return i},t.prototype.constructGraphicalObjects=function(){var t=Math.PI/2;this.hasFeature(1)&&this.constructArrow(1,"arrowX",n.RotationZ(-t)),this.hasFeature(2)&&this.constructArrow(2,"arrowY",n.Identity()),this.hasFeature(4)&&this.constructArrow(4,"arrowZ",n.RotationX(t)),this.hasFeature(16)&&this.constructPlaneSelection(16,"planeXY",n.Identity()),this.hasFeature(32)&&this.constructPlaneSelection(32,"planeXZ",n.RotationX(t)),this.hasFeature(64)&&this.constructPlaneSelection(64,"planeYZ",n.RotationY(-t)),this.hasFeature(256)&&this.constructRotation(256,"rotationX",n.RotationZ(-t)),this.hasFeature(512)&&this.constructRotation(512,"rotationY",n.Identity()),this.hasFeature(1024)&&this.constructRotation(1024,"rotationZ",n.RotationX(t))},t.prototype.constructArrow=function(t,e,i){var n,l=this.getMaterial(e);switch(t){case 1:n=this.hasFeature(256);break;case 2:n=this.hasFeature(512);break;case 4:n=this.hasFeature(1024)}var c=o.FromRotationMatrix(i),u=new Array;u.push(0,n?this._coneLength:0,0),u.push(0,this._arrowLength-this._coneLength,0);var f=new h(e+"Wire",this._scene);f.rotationQuaternion=c,f.parent=this._rootMesh,f.color=l.diffuseColor,f.renderingGroupId=1,f.intersectionThreshold=this.wireSelectionThreshold,f.isPickable=!1;var d=new a;d.positions=u,d.indices=[0,1],d.applyToMesh(f);var p=r.CreateCylinder(e+"Cone",this._coneLength,0,this._coneRadius,18,1,this._scene,!1);p.position=s.TransformCoordinates(new s(0,this._arrowLength-this._coneLength/2,0),i),p.rotationQuaternion=c,p.material=l,p.parent=this._rootMesh,p.renderingGroupId=1,p.isPickable=!1,this.addSymbolicMeshToLit(p)},t.prototype.constructPlaneSelection=function(t,e,i){var n=this.getMaterial(e),a=new Array;a.push(new s(this._arrowLength-this._planeSelectionLength,this._arrowLength,0)),a.push(new s(this._arrowLength,this._arrowLength,0)),a.push(new s(this._arrowLength,this._arrowLength-this._planeSelectionLength,0));var h=r.CreateLines(e+"Plane",a,this._scene);h.parent=this._rootMesh,h.color=n.diffuseColor,h.rotationQuaternion=o.FromRotationMatrix(i),h.renderingGroupId=1,h.intersectionThreshold=this.wireSelectionThreshold,h.isPickable=!1},t.prototype.constructRotation=function(t,e,i){var n=this.getMaterial(e),a=r.CreateCylinder(e+"Cylinder",this._coneLength,this._coneRadius,this._coneRadius,18,1,this._scene,!1);a.material=n,a.position=s.TransformCoordinates(new s(0,this._coneLength/2,0),i),a.rotationQuaternion=o.FromRotationMatrix(i),a.parent=this._rootMesh,a.renderingGroupId=1,a.isPickable=!1,this.addSymbolicMeshToLit(a)},t.prototype.addSymbolicMeshToLit=function(t){var e=this;this._light1.includedOnlyMeshes.push(t),this._light2.includedOnlyMeshes.push(t),this._scene.lights.map(function(i){i!==e._light1&&i!==e._light2&&i.excludedMeshes.push(t)})},t.prototype.hasFeature=function(t){return 0!=(this._features&t)},t.prototype.hasHighlightedFeature=function(t){return 0!=(this._highlighted&t)},t.prototype.updateMaterial=function(t,e){var i=this.getMaterial(t);i&&(i.diffuseColor=e)},t.prototype.updateMaterialFromHighlighted=function(t,e,i){if(this.hasFeature(t)&&(this._highlighted&t)!=(e&t)){var n=this.getMaterial(i);0!=(e&t)?(n.diffuseColor.r*=1.8,n.diffuseColor.g*=1.8,n.diffuseColor.b*=1.8):(n.diffuseColor.r/=1.8,n.diffuseColor.g/=1.8,n.diffuseColor.b/=1.8)}},t.prototype.getMaterial=function(t){return this._materials[t]},t.pc=.6,t.sc=.2,t}();t.Radix=l}(ManipulationHelpers||(ManipulationHelpers={}));var ManipulationHelpers,Vector4=BABYLON.Vector2;!function(t){var e=BABYLON.Vector2,i=BABYLON.Vector3,n=BABYLON.Matrix,r=BABYLON.Plane,s=BABYLON.AbstractMesh,o=BABYLON.Quaternion,a=BABYLON.PointerEventTypes,h=function(){function h(e){var i=this;this.noPreventContextMenu=!1,this._flags=0,this._rotationFactor=1,this._scene=e,this._radix=new t.Radix(e),this._shiftKeyState=!1,this._scene.onBeforeRenderObservable.add(function(t,e){return i.onBeforeRender(t,e)}),this._scene.onPointerObservable.add(function(t,e){return i.onPointer(t,e)},-1,!0),window.oncontextmenu=function(t){i.noPreventContextMenu||t.preventDefault()}}return h.prototype.attachManipulatedNode=function(t){this._manipulatedNode=t,this._radix.show()},h.prototype.detachManipulatedNode=function(t){this._manipulatedNode=null,this._radix.hide()},h.prototype.onBeforeRender=function(t,e){this.renderManipulator()},h.prototype.onPointer=function(t,e){if(this._manipulatedNode){var i=this.getRayPosition(t.event),n=t.event.shiftKey;this.hasManFlags(1)&&n!==this._shiftKeyState&&this.beginDrag(i,t.event),t.type===a.POINTERMOVE?this.noPreventContextMenu||2!==t.event.button||1!==t.event.buttons?this.hasManFlags(1)&&!this.hasManFlags(8)?(e.skipNextObservers=!0,n||this.hasManipulatedMode(1792)?this.doRot(i):this.doPos(i)):this._radix.highlighted=this._radix.intersect(i):(this.setManipulatedNodeWorldMatrix(this._firstTransform),this.setManFlags(8)):t.type===a.POINTERDOWN&&0===t.event.button?(this._manipulatedMode=this._radix.intersect(i),0!==this._manipulatedMode&&(e.skipNextObservers=!0,this.beginDrag(i,t.event),this.hasManipulatedMode(1792)?this.doRot(i):this.doPos(i))):t.type===a.POINTERUP&&(this.hasManFlags(1)&&(e.skipNextObservers=!0),this._radix.highlighted=this._radix.intersect(i),0===t.event.button&&this.endDragMode())}},h.prototype.beginDrag=function(t,e){this._firstMousePos=t,this._prevMousePos=this._firstMousePos.clone(),this._shiftKeyState=e.shiftKey;var i=this.getManipulatedNodeWorldMatrix();this._pos=i.getTranslation(),this._right=i.getRow(0).toVector3(),this._up=i.getRow(1).toVector3(),this._view=i.getRow(2).toVector3(),this._oldPos=this._pos.clone(),this._firstTransform=i.clone(),this._flags|=3},h.prototype.endDragMode=function(){this.clearManFlags(9)},h.prototype.doRot=function(t){if(this.hasManFlags(2))this.clearManFlags(2);else{var e=t.x-this._prevMousePos.x,i=t.y-this._prevMousePos.y,r=this._scene.getEngine().getRenderingCanvasClientRect(),s=e/r.width*Math.PI*2*this._rotationFactor,o=i/r.height*Math.PI*2*this._rotationFactor;if(this.rotationStep){var a=s%this.rotationStep;s-=a,o-=a=o%this.rotationStep}var h=n.Identity();this.hasManipulatedMode(257)?h=n.RotationX(o):this.hasManipulatedMode(514)?h=n.RotationY(o):this.hasManipulatedMode(1028)?h=n.RotationZ(o):(this.hasManipulatedMode(48)&&(h=h.multiply(n.RotationX(o))),this.hasManipulatedMode(80)&&(h=h.multiply(n.RotationY(s))),this.hasManipulatedMode(32)&&(h=h.multiply(n.RotationZ(o))),this.hasManipulatedMode(32)&&(h=h.multiply(n.RotationZ(s))));var l=h.multiply(this._firstTransform);this.setManipulatedNodeWorldMatrix(l)}},h.prototype.doPos=function(t){var e=i.Zero(),s=this._scene.createPickingRay(t.x,t.y,n.Identity(),this._scene.activeCamera);if(this.hasManipulatedMode(112)){if(this.hasManipulatedMode(16)?a=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._up)):this.hasManipulatedMode(32)?a=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._view)):this.hasManipulatedMode(64)&&(a=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._view))),Math.abs(i.Dot(a.normal,s.direction))<.06)return;var o=s.intersectsPlane(a);if(c=h.ComputeRayHit(s,o),this.hasManFlags(2))return this._flags&=-3,void(this._prevHit=c);e=c.subtract(this._prevHit)}else if(0!=(7&this._manipulatedMode)){var a,l,c,u,f,d;if(this.hasManFlags(2))return a=(d=this.setupIntersectionPlanes(this._manipulatedMode)).p0,l=d.p1,Math.abs(i.Dot(a.normal,s.direction))>Math.abs(i.Dot(l.normal,s.direction))?(o=s.intersectsPlane(a),c=h.ComputeRayHit(s,o),this._flags&=-5):(o=s.intersectsPlane(l),c=h.ComputeRayHit(s,o),this._flags|=4),this._flags&=-3,void(this._prevHit=c);a=(d=this.setupIntersectionPlane(this._manipulatedMode,this.hasManFlags(4))).plane,f=d.axis,o=s.intersectsPlane(a),e=(c=h.ComputeRayHit(s,o)).subtract(this._prevHit),u=i.Dot(f,e),e=f.multiplyByFloats(u,u,u)}this.translationStep&&(e.x-=e.x%this.translationStep,e.y-=e.y%this.translationStep,e.z-=e.z%this.translationStep);var p=this._firstTransform.clone();p.setTranslation(p.getTranslation().add(e)),this._pos=p.getTranslation(),this.setManipulatedNodeWorldMatrix(p)},h.prototype.hasManipulatedMode=function(t){return 0!=(this._manipulatedMode&t)},h.prototype.hasManFlags=function(t){return 0!=(this._flags&t)},h.prototype.clearManFlags=function(t){return this._flags&=~t,this._flags},h.prototype.setManFlags=function(t){return this._flags|=t,this._flags},h.ComputeRayHit=function(t,e){return t.origin.add(t.direction.multiplyByFloats(e,e,e))},h.prototype.setManipulatedNodeWorldMatrix=function(t){if(this._manipulatedNode&&this._manipulatedNode instanceof s){var e=this._manipulatedNode;e.parent&&(t=t.multiply(e.parent.getWorldMatrix().clone().invert()));var n=i.Zero(),r=i.Zero(),a=new o;t.decompose(r,a,n),e.position=n,e.rotationQuaternion=a,e.scaling=r}},h.prototype.getManipulatedNodeWorldMatrix=function(){return this._manipulatedNode?this._manipulatedNode instanceof s?this._manipulatedNode.getWorldMatrix():void 0:null},h.prototype.setupIntersectionPlane=function(t,e){var n,r=this.setupIntersectionPlanes(t),s=e?r.p1:r.p0;switch(t){case 1:n=this._right;break;case 2:n=this._up;break;case 4:n=this._view;break;default:n=i.Zero()}return{plane:s,axis:n}},h.prototype.setupIntersectionPlanes=function(t){var e,i;switch(t){case 1:e=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._right)),i=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._up));break;case 2:e=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._right)),i=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._view));break;case 4:e=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._right)),i=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._up))}return{p0:e,p1:i}},h.prototype.getRayPosition=function(t){var i=this._scene.getEngine().getRenderingCanvasClientRect(),n=t.clientX-i.left,r=t.clientY-i.top;return new e(n,r)},h.prototype.renderManipulator=function(){if(this._manipulatedNode&&this._manipulatedNode instanceof s){var t=this._manipulatedNode.getWorldMatrix(),e=i.Distance(this._scene.activeCamera.position,t.getTranslation()),r=this._scene.getEngine().getRenderWidth(),a=20*this.fromScreenToWorld(r/100,e),h=i.Zero(),l=i.Zero(),c=o.Identity();n.Scaling(a,a,a).multiply(t).decompose(h,c,l),this._radix.setWorld(l,c,h)}},h.prototype.fromScreenToWorld=function(t,e){var i=this._scene.activeCamera,r=this._scene.createPickingRay(0,0,n.Identity(),i,!0),s=this._scene.createPickingRay(t,0,n.Identity(),i,!0),o=h.evalPosition(r,e);return h.evalPosition(s,e).x-o.x},h.evalPosition=function(t,e){return t.origin.add(t.direction.multiplyByFloats(e,e,e))},h}();t.ManipulatorInteractionHelper=h}(ManipulationHelpers||(ManipulationHelpers={})),function(t){var e=BABYLON.PointerEventTypes,i=BABYLON.AbstractMesh,n=function(){function n(t){var e=this;this._actionStack=new Array,this._scene=t,this._pointerObserver=this._scene.onPointerObservable.add(function(t,i){return e.pointerCallback(t,i)},-1,!0)}return Object.defineProperty(n.prototype,"currentAction",{get:function(){return 0===this._actionStack.length?1:this._actionStack[this._actionStack.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manipulator",{get:function(){return this._manipulator||(this._manipulator=new t.ManipulatorInteractionHelper(this._scene)),this._manipulator},enumerable:!0,configurable:!0}),n.prototype.pointerCallback=function(t,i){switch(this.detectActionChanged(t,i),this.currentAction){case 1:this.doSelectorInteraction(t,i);break;case 2:t.type&(e.POINTERUP|e.POINTERWHEEL)&&this._actionStack.pop()}},n.prototype.doSelectorInteraction=function(t,n){if(n.skipNextObservers=!0,t.type===e.POINTERUP&&0===t.event.button){var r;if(t.pickInfo.hit&&(r=t.pickInfo.pickedMesh),this._pickedNode===r)return r.showBoundingBox=!r.showBoundingBox,void(!1===r.showBoundingBox&&(this.manipulator.detachManipulatedNode(this._pickedNode),this._pickedNode=null));this._pickedNode&&(this._pickedNode instanceof i&&(this._pickedNode.showBoundingBox=!1),this.manipulator.detachManipulatedNode(this._pickedNode),this._pickedNode=null),r&&(this._pickedNode=r,r.showBoundingBox=!0,this.manipulator.attachManipulatedNode(this._pickedNode))}},n.prototype.detectActionChanged=function(t,i){if(1===this.currentAction){if(t.type===e.POINTERDOWN&&!t.pickInfo.hit)return void this._actionStack.push(2);if(t.type===e.POINTERWHEEL)return void this._actionStack.push(2)}},n.CameratorSwitchThreshold=4,n}();t.SimpleInteractionHelper=n}(ManipulationHelpers||(ManipulationHelpers={})),function(t){var e=function(){function t(){}return t.prototype.render=function(){this.renderLight,this.renderManipulator},t}();t.SymbolicVisualHelper=e}(ManipulationHelpers||(ManipulationHelpers={}));