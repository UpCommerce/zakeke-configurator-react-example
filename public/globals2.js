function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var org;!function(t){!function(t){!function(t){!function(t){var e,i=BABYLON.Axis,n=BABYLON.Color3,r=BABYLON.Matrix,a=BABYLON.Mesh,s=BABYLON.MeshBuilder,o=BABYLON.Path2,l=BABYLON.Quaternion,h=BABYLON.Space,c=BABYLON.StandardMaterial,u=BABYLON.Vector3;!function(t){t[t.TRANS=0]="TRANS",t[t.ROT=1]="ROT",t[t.SCALE=2]="SCALE"}(e||(e={}));var d=function(){function t(t,e,i,n,s,o){var h=this;this._local=!0,this._snapT=!1,this._snapR=!1,this._transSnap=1,this._rotSnap=Math.PI/18,this._axesLen=.4,this._axesScale=1,this._pickWidth=.02,this._visibility=.75,this._ecMatrix=new r,this._ecTOcamera=new u(0,0,0),this._distFromCamera=2,this._cameraTOec=new u(0,0,0),this._cameraNormal=new u(0,0,0),this._prevState="",this._hidden=!1,this._actionListener=null,this._actionStartListener=null,this._actionEndListener=null,this._pDown=!1,this._pointerIsOver=!1,this._editing=!1,this._rotate2=!1,this._transBy=new u(0,0,0),this._snapTV=new u(0,0,0),this._snapS=!1,this._snapSV=new u(0,0,0),this._scaleSnap=.25,this._scale=new u(0,0,0),this._localX=new u(0,0,0),this._localY=new u(0,0,0),this._localZ=new u(0,0,0),this._eulerian=!1,this._snapRA=0,this._transEnabled=!1,this._rotEnabled=!1,this._scaleEnabled=!1,this._guideSize=180,this._tSnap=new u(this._transSnap,this._transSnap,this._transSnap),this._tv1=new u(0,0,0),this._tv2=new u(0,0,0),this._tv3=new u(0,0,0),this._tm=new r,this._mesh=t,this._mainCamera=e,this._canvas=i,null!=n&&(this._axesScale=n),this._eulerian=null!==s&&s,this._checkQuaternion(),null!=o&&(this._pickWidth=o),this._scene=t.getScene(),this._actHist=new f(t,10),t.computeWorldMatrix(!0),this._boundingDimesion=this._getBoundingDimension(t),this._setLocalAxes(t),this._ecRoot=new a("EditControl",this._scene),this._ecRoot.metadata={isEditControl:!0,isRealMesh:!1},this._ecRoot.rotationQuaternion=l.Identity(),this._ecRoot.visibility=0,this._ecRoot.isPickable=!1,this._createMaterials(this._scene);var c=this._createCommonAxes();c.parent=this._ecRoot,c.metadata={isEditControl:!0,isRealMesh:!1};var d=this._createPickPlanes();d.parent=this._ecRoot,d.metadata={isEditControl:!0,isRealMesh:!1},this._pointerdown=function(t){return h._onPointerDown(t)},this._pointerup=function(t){return h._onPointerUp(t)},this._pointermove=function(t){return h._onPointerMove(t)},i.addEventListener("pointerdown",this._pointerdown,!1),i.addEventListener("pointerup",this._pointerup,!1),i.addEventListener("pointermove",this._pointermove,!1),this._renderer=function(){return h._renderLoopProcess()},this._scene.registerBeforeRender(this._renderer)}return t.prototype._centerMeshPivot=function(t){var e=this._getMeshHierarchyCenter(t);if(e){var i=e.clone(),n=t.position.subtract(i);t.setPivotMatrix(BABYLON.Matrix.Translation(n.x,n.y,n.z))}},t.prototype._getMeshHierarchyCenter=function(t){if(t){var e=t.getHierarchyBoundingVectors(!0),i=e.max.subtract(e.min);return e.min.add(i.scale(.5))}return null},t.prototype._checkQuaternion=function(){if(!this._eulerian&&(null==this._mesh.rotationQuaternion||null==this._mesh.rotationQuaternion))throw"Error: Eulerian is set to false but the mesh's rotationQuaternion is not set."},t.prototype._renderLoopProcess=function(){this._ecRoot.position=this._mesh.getAbsolutePivotPoint(),this._setECRotation(),this._setECScale(),this._local?(this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera),this._pALL.lookAt(this._ecTOcamera,0,0,0,h.LOCAL)):(this._mainCamera.position.subtractToRef(this._ecRoot.position,this._ecTOcamera),this._pALL.lookAt(this._mainCamera.position,0,0,0,h.WORLD)),this._rotEnabled?this._rotRotGuides():this._transEnabled?this._rotPlanarGuides(this._tXZ,this._tZY,this._tYX):this._scaleEnabled&&this._rotPlanarGuides(this._sXZ,this._sZY,this._sYX)},t.prototype._setECRotation=function(){if(this._local)if(null==this._mesh.parent)if(this._eulerian){var t=this._mesh.rotation;l.RotationYawPitchRollToRef(t.y,t.x,t.z,this._ecRoot.rotationQuaternion)}else this._ecRoot.rotationQuaternion.copyFrom(this._mesh.rotationQuaternion);else{if(this._isScaleUnEqual(this._mesh))return;this._mesh.getWorldMatrix().getRotationMatrixToRef(this._tm),l.FromRotationMatrixToRef(this._tm,this._ecRoot.rotationQuaternion)}},t.prototype._isScaleUnEqual=function(t){if(null==t.parent)return!1;for(;null!=t.parent;){if(t.parent.scaling.x!=t.parent.scaling.y||t.parent.scaling.y!=t.parent.scaling.z)return!0;t=t.parent}return!1},t.prototype._setECScale=function(){this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),u.FromFloatArrayToRef(this._mainCamera.getWorldMatrix().asArray(),8,this._cameraNormal);var t=u.Dot(this._cameraTOec,this._cameraNormal)/this._cameraNormal.length(),e=Math.abs(t/this._distFromCamera);u.FromFloatsToRef(e,e,e,this._ecRoot.scaling)},t.prototype._rotRotGuides=function(){var t=Math.atan(this._ecTOcamera.y/this._ecTOcamera.z);this._ecTOcamera.z>=0?this._rX.rotation.x=-t:this._rX.rotation.x=-t-Math.PI;var e=Math.atan(this._ecTOcamera.x/this._ecTOcamera.z);this._ecTOcamera.z>=0?this._rY.rotation.y=e:this._rY.rotation.y=e+Math.PI;var i=Math.atan(this._ecTOcamera.x/this._ecTOcamera.y);this._ecTOcamera.y>=0?this._rZ.rotation.z=-i:this._rZ.rotation.z=-i-Math.PI},t.prototype._rotPlanarGuides=function(t,e,i){var n=this._ecTOcamera;t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,e.rotation.x=0,e.rotation.y=0,e.rotation.z=0,i.rotation.x=0,i.rotation.y=0,i.rotation.z=0,n.x<=0&&n.y>=0&&n.z>=0?(t.rotation.z=3.14,i.rotation.y=3.14):n.x<=0&&n.y>=0&&n.z<=0?(t.rotation.y=3.14,e.rotation.y=3.14,i.rotation.y=3.14):n.x>=0&&n.y>=0&&n.z<=0?(t.rotation.x=3.14,e.rotation.y=3.14):n.x>=0&&n.y<=0&&n.z>=0?(e.rotation.z=3.14,i.rotation.x=3.14):n.x<=0&&n.y<=0&&n.z>=0?(t.rotation.z=3.14,e.rotation.z=3.14,i.rotation.z=3.14):n.x<=0&&n.y<=0&&n.z<=0?(t.rotation.y=3.14,e.rotation.x=3.14,i.rotation.z=3.14):n.x>=0&&n.y<=0&&n.z<=0&&(t.rotation.x=3.14,e.rotation.x=3.14,i.rotation.x=3.14)},t.prototype.switchTo=function(t,e){t.computeWorldMatrix(!0),this._mesh=t,null!=e&&(this._eulerian=e),this._checkQuaternion(),this._setLocalAxes(t),this._actHist=new f(t,10),this.refreshBoundingInfo()},t.prototype.setUndoCount=function(t){this._actHist.setCapacity(t)},t.prototype.undo=function(){var t=this._actHist.undo();this._mesh.computeWorldMatrix(!0),this._setLocalAxes(this._mesh),this._callActionStartListener(t),this._callActionListener(t),this._callActionEndListener(t)},t.prototype.redo=function(){var t=this._actHist.redo();this._mesh.computeWorldMatrix(!0),this._setLocalAxes(this._mesh),this._callActionStartListener(t),this._callActionListener(t),this._callActionEndListener(t)},t.prototype.detach=function(){this._canvas.removeEventListener("pointerdown",this._pointerdown,!1),this._canvas.removeEventListener("pointerup",this._pointerup,!1),this._canvas.removeEventListener("pointermove",this._pointermove,!1),this._scene.unregisterBeforeRender(this._renderer),this.removeAllActionListeners(),this._disposeAll()},t.prototype.hide=function(){this._hidden=!0,this._transEnabled?(this._prevState="T",this.disableTranslation()):this._rotEnabled?(this._prevState="R",this.disableRotation()):this._scaleEnabled&&(this._prevState="S",this.disableScaling()),this._hideCommonAxes()},t.prototype._hideCommonAxes=function(){this._xaxis.visibility=0,this._yaxis.visibility=0,this._zaxis.visibility=0},t.prototype._showCommonAxes=function(){this._xaxis.visibility=this._visibility,this._yaxis.visibility=this._visibility,this._zaxis.visibility=this._visibility},t.prototype.show=function(){this._hidden=!1,this._showCommonAxes(),"T"==this._prevState?this.enableTranslation():"R"==this._prevState?this.enableRotation():"S"==this._prevState&&this.enableScaling()},t.prototype.isHidden=function(){return this._hidden},t.prototype._disposeAll=function(){this._ecRoot.dispose(),this._disposeMaterials(),this._actHist=null},t.prototype.addActionListener=function(t){this._actionListener=t},t.prototype.removeActionListener=function(){this._actionListener=null},t.prototype.addActionStartListener=function(t){this._actionStartListener=t},t.prototype.removeActionStartListener=function(){this._actionStartListener=null},t.prototype.addActionEndListener=function(t){this._actionEndListener=t},t.prototype.removeActionEndListener=function(){this._actionEndListener=null},t.prototype.removeAllActionListeners=function(){this._actionListener=null,this._actionStartListener=null,this._actionEndListener=null},t.prototype._onPointerDown=function(t){var e=this;if(t.preventDefault(),this._pDown=!0,0==t.button){var i=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(t){if(e._transEnabled){if(t==e._tX||t==e._tY||t==e._tZ||t==e._tXZ||t==e._tZY||t==e._tYX||t==e._tAll)return!0}else if(e._rotEnabled){if(t==e._rX||t==e._rY||t==e._rZ||t==e._rAll)return!0}else if(e._scaleEnabled&&(t==e._sX||t==e._sY||t==e._sZ||t==e._sXZ||t==e._sZY||t==e._sYX||t==e._sAll))return!0;return!1},null,this._mainCamera);if(i.hit){this._axisPicked=i.pickedMesh;var n=this._axisPicked.getChildren();n.length>0?n[0].visibility=this._visibility:this._axisPicked.visibility=this._visibility;var r=this._axisPicked.name;"X"==r?this._bXaxis.visibility=1:"Y"==r?this._bYaxis.visibility=1:"Z"==r?this._bZaxis.visibility=1:"XZ"==r?(this._bXaxis.visibility=1,this._bZaxis.visibility=1):"ZY"==r?(this._bZaxis.visibility=1,this._bYaxis.visibility=1):"YX"==r?(this._bYaxis.visibility=1,this._bXaxis.visibility=1):"ALL"==r&&(this._bXaxis.visibility=1,this._bYaxis.visibility=1,this._bZaxis.visibility=1),this._setEditing(!0),this._pickedPlane=this._getPickPlane(this._axisPicked),null!=this._pickedPlane?this._prevPos=this._getPosOnPickPlane():this._prevPos=null,window.setTimeout(function(t,i){return e._detachCamera(t,i)},0,this._mainCamera,this._canvas)}}},t.prototype._setEditing=function(t){this._editing=t,t?(this._setActionType(),this._actionType==e.ROT&&(this._snapRA=0),this._callActionStartListener(this._actionType)):this._callActionEndListener(this._actionType)},t.prototype.isEditing=function(){return this._editing},t.prototype._detachCamera=function(t,e){var i=e;t.detachControl(i)},t.prototype.isPointerOver=function(){return this._pointerIsOver},t.prototype._onPointerOver=function(){var t=this,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(e){if(t._transEnabled){if(e==t._tX||e==t._tY||e==t._tZ||e==t._tXZ||e==t._tZY||e==t._tYX||e==t._tAll)return!0}else if(t._rotEnabled){if(e==t._rX||e==t._rY||e==t._rZ||e==t._rAll)return!0}else if(t._scaleEnabled&&(e==t._sX||e==t._sY||e==t._sZ||e==t._sXZ||e==t._sZY||e==t._sYX||e==t._sAll))return!0;return!1},null,this._mainCamera);if(e.hit){if(e.pickedMesh!=this._prevOverMesh){if(this._pointerIsOver=!0,this._clearPrevOverMesh(),this._prevOverMesh=e.pickedMesh,this._rotEnabled)this._savedCol=this._prevOverMesh.getChildren()[0].color,this._prevOverMesh.getChildren()[0].color=n.White();else{var i=this._prevOverMesh.getChildren();i.length>0?(this._savedMat=i[0].material,i[0].material=this._whiteMat):(this._savedMat=this._prevOverMesh.material,this._prevOverMesh.material=this._whiteMat)}"X"==this._prevOverMesh.name?this._xaxis.color=n.White():"Y"==this._prevOverMesh.name?this._yaxis.color=n.White():"Z"==this._prevOverMesh.name&&(this._zaxis.color=n.White())}}else this._pointerIsOver=!1,null!=this._prevOverMesh&&(this._restoreColor(this._prevOverMesh),this._prevOverMesh=null)},t.prototype._clearPrevOverMesh=function(){null!=this._prevOverMesh&&(this._prevOverMesh.visibility=0,this._restoreColor(this._prevOverMesh))},t.prototype._restoreColor=function(t){switch(t.name){case"X":this._xaxis.color=n.Red();break;case"Y":this._yaxis.color=n.Green();break;case"Z":this._zaxis.color=n.Blue()}if(this._rotEnabled)t.getChildren()[0].color=this._savedCol;else{var e=t.getChildren();e.length>0?e[0].material=this._savedMat:t.material=this._savedMat}},t.prototype._onPointerUp=function(t){this._pDown=!1,this._editing&&(this._mainCamera.attachControl(this._canvas),this._setEditing(!1),this._hideBaxis(),null!=this._prevOverMesh&&(this._restoreColor(this._prevOverMesh),this._prevOverMesh=null),this._actHist.add(this._actionType))},t.prototype._setActionType=function(){this._transEnabled?this._actionType=e.TRANS:this._rotEnabled?this._actionType=e.ROT:this._scaleEnabled&&(this._actionType=e.SCALE)},t.prototype._callActionListener=function(t){null!=this._actionListener&&this._actionListener(t)},t.prototype._callActionStartListener=function(t){null!=this._actionStartListener&&this._actionStartListener(t)},t.prototype._callActionEndListener=function(t){null!=this._actionEndListener&&this._actionEndListener(t)},t.prototype._onPointerMove=function(t){if(this._pDown){if(this._editing&&null!=this._prevPos){var e=this._getPosOnPickPlane();if(null!=e){if(this._rotEnabled)this._doRotation(this._mesh,this._axisPicked,e,this._prevPos);else{var i=e.subtract(this._prevPos);if(0==i.x&&0==i.y&&0==i.z)return;this._transEnabled?this._doTranslation(i):this._scaleEnabled&&this._local&&this._doScaling(i)}this._prevPos=e,this._callActionListener(this._actionType)}}}else this._onPointerOver()},t.prototype._getPickPlane=function(t){var e=t.name;if(this._transEnabled||this._scaleEnabled){if("XZ"==e)return this._pXZ;if("ZY"==e)return this._pZY;if("YX"==e)return this._pYX;if("ALL"==e)return this._pALL;this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera);var i=this._ecTOcamera;if("X"===e)return Math.abs(i.y)>Math.abs(i.z)?this._pXZ:this._pYX;if("Z"===e)return Math.abs(i.y)>Math.abs(i.x)?this._pXZ:this._pZY;if("Y"===e)return Math.abs(i.z)>Math.abs(i.x)?this._pYX:this._pZY}else{if(!this._rotEnabled)return null;this._rotate2=!1,this._ecRoot.getWorldMatrix().invertToRef(this._ecMatrix),u.TransformCoordinatesToRef(this._mainCamera.position,this._ecMatrix,this._ecTOcamera);i=this._ecTOcamera;switch(e){case"X":return Math.abs(i.x)<.2?(this._rotate2=!0,this._pALL):this._pZY;case"Y":return Math.abs(i.y)<.2?(this._rotate2=!0,this._pALL):this._pXZ;case"Z":return Math.abs(i.z)<.2?(this._rotate2=!0,this._pALL):this._pYX;default:return this._pALL}}},t.prototype._doTranslation=function(t){null!=this._mesh.parent&&this._isScaleUnEqual(this._mesh)?this._setLocalAxes(this._ecRoot):this._setLocalAxes(this._mesh);var e=this._axisPicked.name;"ALL"==e?this._transBy=t:(this._transBy.x=0,this._transBy.y=0,this._transBy.z=0,"X"!=e&&"XZ"!=e&&"YX"!=e||(this._local?this._transBy.x=u.Dot(t,this._localX)/this._localX.length():this._transBy.x=t.x),"Y"!=e&&"ZY"!=e&&"YX"!=e||(this._local?this._transBy.y=u.Dot(t,this._localY)/this._localY.length():this._transBy.y=t.y),"Z"!=e&&"XZ"!=e&&"ZY"!=e||(this._local?this._transBy.z=u.Dot(t,this._localZ)/this._localZ.length():this._transBy.z=t.z)),this._transWithSnap(this._mesh,this._transBy,this._local),this._transBoundsMin&&(this._mesh.position.x=Math.max(this._mesh.position.x,this._transBoundsMin.x),this._mesh.position.y=Math.max(this._mesh.position.y,this._transBoundsMin.y),this._mesh.position.z=Math.max(this._mesh.position.z,this._transBoundsMin.z)),this._transBoundsMax&&(this._mesh.position.x=Math.min(this._mesh.position.x,this._transBoundsMax.x),this._mesh.position.y=Math.min(this._mesh.position.y,this._transBoundsMax.y),this._mesh.position.z=Math.min(this._mesh.position.z,this._transBoundsMax.z)),this._mesh.computeWorldMatrix(!0)},t.prototype._transWithSnap=function(t,e,i){if(this._snapT){var n=!1;if(this._snapTV.addInPlace(e),Math.abs(this._snapTV.x)>this._tSnap.x&&(this._snapTV.x>0?e.x=this._tSnap.x:e.x=-this._tSnap.x,n=!0),Math.abs(this._snapTV.y)>this._tSnap.y&&(this._snapTV.y>0?e.y=this._tSnap.y:e.y=-this._tSnap.y,n=!0),Math.abs(this._snapTV.z)>this._tSnap.z&&(this._snapTV.z>0?e.z=this._tSnap.z:e.z=-this._tSnap.z,n=!0),!n)return;Math.abs(e.x)!==this._tSnap.x&&(e.x=0),Math.abs(e.y)!==this._tSnap.y&&(e.y=0),Math.abs(e.z)!==this._tSnap.z&&(e.z=0),u.FromFloatsToRef(0,0,0,this._snapTV),n=!1}i?(this._localX.normalizeToRef(this._tv1),this._localY.normalizeToRef(this._tv2),this._localZ.normalizeToRef(this._tv3),this._mesh.translate(this._tv1,e.x,h.WORLD),this._mesh.translate(this._tv2,e.y,h.WORLD),this._mesh.translate(this._tv3,e.z,h.WORLD)):null==this._mesh.parent?this._mesh.position.addInPlace(e):this._mesh.setAbsolutePosition(e.addInPlace(this._mesh.absolutePosition))},t.prototype._doScaling=function(t){this._setLocalAxes(this._mesh),this._scale.x=0,this._scale.y=0,this._scale.z=0;var e=this._axisPicked.name;"X"!=e&&"XZ"!=e&&"YX"!=e||(this._scale.x=u.Dot(t,this._localX)/this._localX.length(),this._mesh.scaling.x<0&&(this._scale.x=-this._scale.x)),"Y"!=e&&"ZY"!=e&&"YX"!=e||(this._scale.y=u.Dot(t,this._localY)/this._localY.length(),this._mesh.scaling.y<0&&(this._scale.y=-this._scale.y)),"Z"!=e&&"XZ"!=e&&"ZY"!=e||(this._scale.z=u.Dot(t,this._localZ)/this._localZ.length(),this._mesh.scaling.z<0&&(this._scale.z=-this._scale.z));var i=this._boundingDimesion;if(this._scale.x=this._scale.x/i.x,this._scale.y=this._scale.y/i.y,this._scale.z=this._scale.z/i.z,"ALL"==e){var n=u.Dot(t,this._mainCamera.upVector);n/=Math.max(i.x,i.y,i.z),this._scale.copyFromFloats(n,n,n)}else{var r=!1;if("XZ"==e?(r=!0,Math.abs(this._scale.x)>Math.abs(this._scale.z)?this._scale.z=this._scale.x:this._scale.x=this._scale.z):"ZY"==e?(r=!0,Math.abs(this._scale.z)>Math.abs(this._scale.y)?this._scale.y=this._scale.z:this._scale.z=this._scale.y):"YX"==e&&(r=!0,Math.abs(this._scale.y)>Math.abs(this._scale.x)?this._scale.x=this._scale.y:this._scale.y=this._scale.x),r){this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec);n=u.Dot(t,this._cameraTOec);this._scale.x=Math.abs(this._scale.x),this._scale.y=Math.abs(this._scale.y),this._scale.z=Math.abs(this._scale.z),n>0?(this._mesh.scaling.x>0&&(this._scale.x=-this._scale.x),this._mesh.scaling.y>0&&(this._scale.y=-this._scale.y),this._mesh.scaling.z>0&&(this._scale.z=-this._scale.z)):(this._mesh.scaling.x<0&&(this._scale.x=-this._scale.x),this._mesh.scaling.y<0&&(this._scale.y=-this._scale.y),this._mesh.scaling.z<0&&(this._scale.z=-this._scale.z))}}this._scaleWithSnap(this._mesh,this._scale),this._scaleBoundsMin&&(this._mesh.scaling.x=Math.max(this._mesh.scaling.x,this._scaleBoundsMin.x),this._mesh.scaling.y=Math.max(this._mesh.scaling.y,this._scaleBoundsMin.y),this._mesh.scaling.z=Math.max(this._mesh.scaling.z,this._scaleBoundsMin.z)),this._scaleBoundsMax&&(this._mesh.scaling.x=Math.min(this._mesh.scaling.x,this._scaleBoundsMax.x),this._mesh.scaling.y=Math.min(this._mesh.scaling.y,this._scaleBoundsMax.y),this._mesh.scaling.z=Math.min(this._mesh.scaling.z,this._scaleBoundsMax.z))},t.prototype._scaleWithSnap=function(t,e){if(this._snapS){var i=!1;if(this._snapSV.addInPlace(e),Math.abs(this._snapSV.x)>this._scaleSnap&&(e.x>0?e.x=this._scaleSnap:e.x=-this._scaleSnap,i=!0),Math.abs(this._snapSV.y)>this._scaleSnap&&(e.y>0?e.y=this._scaleSnap:e.y=-this._scaleSnap,i=!0),Math.abs(this._snapSV.z)>this._scaleSnap&&(e.z>0?e.z=this._scaleSnap:e.z=-this._scaleSnap,i=!0),!i)return;Math.abs(e.x)!==this._scaleSnap&&0!==e.x&&(e.x=0),Math.abs(e.y)!==this._scaleSnap&&0!==e.y&&(e.y=0),Math.abs(e.z)!==this._scaleSnap&&0!==e.z&&(e.z=0),u.FromFloatsToRef(0,0,0,this._snapSV),i=!1}t.scaling.addInPlace(e)},t.prototype._setLocalAxes=function(t){var e=t.getWorldMatrix();u.FromFloatArrayToRef(e.m,0,this._localX),u.FromFloatArrayToRef(e.m,4,this._localY),u.FromFloatArrayToRef(e.m,8,this._localZ)},t.prototype._getBoundingDimension=function(t){var e=t.getBoundingInfo().boundingBox,i=e.maximum.subtract(e.minimum);return 0==i.x&&(i.x=1),0==i.y&&(i.y=1),0==i.z&&(i.z=1),i},t.prototype.refreshBoundingInfo=function(){this._boundingDimesion=this._getBoundingDimension(this._mesh)},t.prototype._doRotation=function(t,e,n,r){this._local&&null!=this._mesh.parent&&this._isScaleUnEqual(t)?this._setLocalAxes(this._ecRoot):this._setLocalAxes(t);var a,s=0;e==this._rX?a=this._local?this._localX:i.X:e==this._rY?a=this._local?this._localY:i.Y:e==this._rZ&&(a=this._local?this._localZ:i.Z),this._ecRoot.position.subtractToRef(this._mainCamera.position,this._cameraTOec),this._rotate2?(s=this._getAngle2(r,n,this._mainCamera.position,this._cameraTOec,a),this._scene.useRightHandedSystem&&(s=-s)):s=this._getAngle(r,n,t.getAbsolutePivotPoint(),this._cameraTOec),this._snapR&&(this._snapRA+=s,s=0,Math.abs(this._snapRA)>=this._rotSnap&&(s=this._snapRA>0?this._rotSnap:-this._rotSnap,this._snapRA=0)),0!==s&&(this._cameraTOec.normalize(),e==this._rAll?t.rotate(this._cameraTOec,-s,h.WORLD):(u.Dot(a,this._cameraTOec)>=0&&(s=-s),t.rotate(a,s,h.WORLD)),this._eulerian&&(t.rotation=t.rotationQuaternion.toEulerAngles(),t.rotationQuaternion=null),this._local&&null!=this._mesh.parent&&this._isScaleUnEqual(t)&&(e==this._rAll?this._ecRoot.rotate(this._cameraTOec,-s,h.WORLD):this._ecRoot.rotate(a,s,h.WORLD)))},t.prototype._getPosOnPickPlane=function(){var t=this,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(e){return e==t._pickedPlane},null,this._mainCamera);return e.hit?e.pickedPoint:null},t.prototype._hideBaxis=function(){this._bXaxis.visibility=0,this._bYaxis.visibility=0,this._bZaxis.visibility=0},t.prototype._setAxesVisiblity=function(t){this._transEnabled&&(this._tEndX.visibility=t,this._tEndY.visibility=t,this._tEndZ.visibility=t,this._tEndXZ.visibility=t,this._tEndZY.visibility=t,this._tEndYX.visibility=t,this._tEndAll.visibility=t),this._rotEnabled&&(this._rEndX.visibility=t,this._rEndY.visibility=t,this._rEndZ.visibility=t,this._rEndAll.visibility=t),this._scaleEnabled&&(this._sEndX.visibility=t,this._sEndY.visibility=t,this._sEndZ.visibility=t,this._sEndXZ.visibility=t,this._sEndZY.visibility=t,this._sEndYX.visibility=t,this._sEndAll.visibility=t)},t.prototype.getRotationQuaternion=function(){return this._ecRoot.rotationQuaternion},t.prototype.getPosition=function(){return this._ecRoot.position},t.prototype.isTranslationEnabled=function(){return this._transEnabled},t.prototype.enableTranslation=function(){null==this._tX&&(this._createTransAxes(),this._tCtl.parent=this._ecRoot,this._tCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._transEnabled||(this._tEndX.visibility=this._visibility,this._tEndY.visibility=this._visibility,this._tEndZ.visibility=this._visibility,this._tEndXZ.visibility=this._visibility,this._tEndZY.visibility=this._visibility,this._tEndYX.visibility=this._visibility,this._tEndAll.visibility=this._visibility,this._transEnabled=!0,this.disableRotation(),this.disableScaling())},t.prototype.disableTranslation=function(){this._transEnabled&&(this._tEndX.visibility=0,this._tEndY.visibility=0,this._tEndZ.visibility=0,this._tEndXZ.visibility=0,this._tEndZY.visibility=0,this._tEndYX.visibility=0,this._tEndAll.visibility=0,this._transEnabled=!1)},t.prototype.isRotationEnabled=function(){return this._rotEnabled},t.prototype.returnEuler=function(t){this._eulerian=t},t.prototype.enableRotation=function(){null==this._rCtl&&(this._createRotAxes(),this._rCtl.parent=this._ecRoot,this._rCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._rotEnabled||(this._rEndX.visibility=this._visibility,this._rEndY.visibility=this._visibility,this._rEndZ.visibility=this._visibility,this._rEndAll.visibility=this._visibility,this._rEndAll2.visibility=this._visibility,this._rotEnabled=!0,this.disableTranslation(),this.disableScaling())},t.prototype.disableRotation=function(){this._rotEnabled&&(this._rEndX.visibility=0,this._rEndY.visibility=0,this._rEndZ.visibility=0,this._rEndAll.visibility=0,this._rEndAll2.visibility=0,this._rotEnabled=!1)},t.prototype.isScalingEnabled=function(){return this._scaleEnabled},t.prototype.enableScaling=function(){null==this._sX&&(this._createScaleAxes(),this._sCtl.parent=this._ecRoot,this._sCtl.metadata={isEditControl:!0,isRealMesh:!1}),this._clearPrevOverMesh(),this._scaleEnabled||(this._sEndX.visibility=this._visibility,this._sEndY.visibility=this._visibility,this._sEndZ.visibility=this._visibility,this._sEndXZ.visibility=this._visibility,this._sEndZY.visibility=this._visibility,this._sEndYX.visibility=this._visibility,this._sEndAll.visibility=this._visibility,this._scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},t.prototype.disableScaling=function(){this._scaleEnabled&&(this._sEndX.visibility=0,this._sEndY.visibility=0,this._sEndZ.visibility=0,this._sEndXZ.visibility=0,this._sEndZY.visibility=0,this._sEndYX.visibility=0,this._sEndAll.visibility=0,this._scaleEnabled=!1)},t.prototype.setScaleBounds=function(t,e){this._scaleBoundsMin=t||null,this._scaleBoundsMax=e||null,null!=this._scaleBoundsMin&&(0==this._scaleBoundsMin.x&&(this._scaleBoundsMin.x=1e-8),0==this._scaleBoundsMin.y&&(this._scaleBoundsMin.y=1e-8),0==this._scaleBoundsMin.z&&(this._scaleBoundsMin.z=1e-8))},t.prototype.removeScaleBounds=function(){this._scaleBoundsMin=null,this._scaleBoundsMax=null},t.prototype.setTransBounds=function(t,e){this._transBoundsMin=t||null,this._transBoundsMax=e||null},t.prototype.removeTransBounds=function(){this._transBoundsMin=null,this._transBoundsMax=null},t.prototype.setRotBounds=function(t,e){this._rotBoundsMin=t||null,this._rotBoundsMax=e||null},t.prototype.removeRotBounds=function(){this._rotBoundsMin=null,this._rotBoundsMax=null},t.prototype._createCommonAxes=function(){var t=new a("guideCtl",this._scene);this._bXaxis=a.CreateLines("bxAxis",[new u(-100,0,0),new u(100,0,0)],this._scene),this._bYaxis=a.CreateLines("byAxis",[new u(0,-100,0),new u(0,100,0)],this._scene),this._bZaxis=a.CreateLines("bzAxis",[new u(0,0,-100),new u(0,0,100)],this._scene),this._bXaxis.isPickable=!1,this._bYaxis.isPickable=!1,this._bZaxis.isPickable=!1,this._bXaxis.parent=t,this._bYaxis.parent=t,this._bZaxis.parent=t,this._bXaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bYaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bZaxis.metadata={isEditControl:!0,isRealMesh:!1},this._bXaxis.color=n.Red(),this._bYaxis.color=n.Green(),this._bZaxis.color=n.Blue(),this._hideBaxis();var e=this._axesLen*this._axesScale*.75;return this._xaxis=a.CreateLines("xAxis",[new u(0,0,0),new u(e,0,0)],this._scene),this._yaxis=a.CreateLines("yAxis",[new u(0,0,0),new u(0,e,0)],this._scene),this._zaxis=a.CreateLines("zAxis",[new u(0,0,0),new u(0,0,e)],this._scene),this._xaxis.isPickable=!1,this._yaxis.isPickable=!1,this._zaxis.isPickable=!1,this._xaxis.parent=t,this._yaxis.parent=t,this._zaxis.parent=t,this._xaxis.metadata={isEditControl:!0,isRealMesh:!1},this._yaxis.metadata={isEditControl:!0,isRealMesh:!1},this._zaxis.metadata={isEditControl:!0,isRealMesh:!1},this._xaxis.color=n.Red(),this._yaxis.color=n.Green(),this._zaxis.color=n.Blue(),this._xaxis.renderingGroupId=1,this._yaxis.renderingGroupId=1,this._zaxis.renderingGroupId=1,t},t.prototype._createPickPlanes=function(){this._pALL=a.CreatePlane("pALL",5,this._scene),this._pXZ=a.CreatePlane("pXZ",5,this._scene),this._pZY=a.CreatePlane("pZY",5,this._scene),this._pYX=a.CreatePlane("pYX",5,this._scene),this._pALL.isPickable=!1,this._pXZ.isPickable=!1,this._pZY.isPickable=!1,this._pYX.isPickable=!1,this._pALL.visibility=0,this._pXZ.visibility=0,this._pZY.visibility=0,this._pYX.visibility=0,this._pALL.renderingGroupId=1,this._pXZ.renderingGroupId=1,this._pZY.renderingGroupId=1,this._pYX.renderingGroupId=1,this._pALL.lookAt(this._mainCamera.position),this._pXZ.rotate(i.X,1.57),this._pZY.rotate(i.Y,1.57);var t=new a("pickPlanes",this._scene);return this._pALL.parent=t,this._pALL.metadata={isEditControl:!0,isRealMesh:!1},this._pXZ.parent=t,this._pXZ.metadata={isEditControl:!0,isRealMesh:!1},this._pZY.parent=t,this._pZY.metadata={isEditControl:!0,isRealMesh:!1},this._pYX.parent=t,this._pYX.metadata={isEditControl:!0,isRealMesh:!1},t},t.prototype._createTransAxes=function(){var t=2*this._pickWidth*this._axesScale,e=this._axesLen*this._axesScale;this._tCtl=new a("tarnsCtl",this._scene),this._tX=this._extrudeBox(t/2,e),this._tX.name="X",this._tY=this._tX.clone("Y"),this._tZ=this._tX.clone("Z"),this._tXZ=s.CreatePlane("XZ",{size:2*t},this._scene),this._tZY=s.CreatePlane("ZY",{size:2*t},this._scene),this._tYX=s.CreatePlane("YX",{size:2*t},this._scene),this._tXZ.rotation.x=1.57,this._tZY.rotation.y=-1.57,this._tXZ.position.x=t,this._tXZ.position.z=t,this._tZY.position.z=t,this._tZY.position.y=t,this._tYX.position.y=t,this._tYX.position.x=t,this._tXZ.bakeCurrentTransformIntoVertices(),this._tZY.bakeCurrentTransformIntoVertices(),this._tYX.bakeCurrentTransformIntoVertices(),this._tAll=a.CreateBox("ALL",2*t,this._scene),this._tX.parent=this._tCtl,this._tX.metadata={isEditControl:!0,isRealMesh:!1},this._tY.parent=this._tCtl,this._tY.metadata={isEditControl:!0,isRealMesh:!1},this._tZ.parent=this._tCtl,this._tZ.metadata={isEditControl:!0,isRealMesh:!1},this._tXZ.parent=this._tCtl,this._tXZ.metadata={isEditControl:!0,isRealMesh:!1},this._tZY.parent=this._tCtl,this._tZY.metadata={isEditControl:!0,isRealMesh:!1},this._tYX.parent=this._tCtl,this._tYX.metadata={isEditControl:!0,isRealMesh:!1},this._tAll.parent=this._tCtl,this._tAll.metadata={isEditControl:!0,isRealMesh:!1},this._tX.rotation.y=1.57,this._tY.rotation.x-=1.57,this._tX.visibility=0,this._tY.visibility=0,this._tZ.visibility=0,this._tXZ.visibility=0,this._tZY.visibility=0,this._tYX.visibility=0,this._tAll.visibility=0,this._tX.isPickable=!1,this._tY.isPickable=!1,this._tZ.isPickable=!1,this._tXZ.isPickable=!1,this._tZY.isPickable=!1,this._tYX.isPickable=!1,this._tAll.isPickable=!1;var i=e/5,n=t;this._tEndX=a.CreateCylinder("tEndX",i,0,n,6,1,this._scene),this._tEndY=this._tEndX.clone("tEndY"),this._tEndZ=this._tEndX.clone("tEndZ"),this._tEndXZ=this._createTriangle("XZ",1.75*n,this._scene),this._tEndZY=this._tEndXZ.clone("ZY"),this._tEndYX=this._tEndXZ.clone("YX"),this._tEndAll=s.CreatePolyhedron("tEndAll",{type:1,size:n/2},this._scene),this._tEndX.rotation.x=1.57,this._tEndY.rotation.x=1.57,this._tEndZ.rotation.x=1.57,this._tEndZY.rotation.z=1.57,this._tEndYX.rotation.x=-1.57,this._tEndXZ.position.x=t,this._tEndXZ.position.z=t,this._tEndZY.position.z=t,this._tEndZY.position.y=t,this._tEndYX.position.y=t,this._tEndYX.position.x=t,this._tEndX.parent=this._tX,this._tEndX.metadata={isEditControl:!0,isRealMesh:!1},this._tEndY.parent=this._tY,this._tEndY.metadata={isEditControl:!0,isRealMesh:!1},this._tEndZ.parent=this._tZ,this._tEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._tEndXZ.parent=this._tXZ,this._tEndXZ.metadata={isEditControl:!0,isRealMesh:!1},this._tEndZY.parent=this._tZY,this._tEndZY.metadata={isEditControl:!0,isRealMesh:!1},this._tEndYX.parent=this._tYX,this._tEndYX.metadata={isEditControl:!0,isRealMesh:!1},this._tEndAll.parent=this._tAll,this._tEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._tEndX.position.z=e-i/2,this._tEndY.position.z=e-i/2,this._tEndZ.position.z=e-i/2,this._tEndX.material=this._redMat,this._tEndY.material=this._greenMat,this._tEndZ.material=this._blueMat,this._tEndXZ.material=this._greenMat,this._tEndZY.material=this._redMat,this._tEndYX.material=this._blueMat,this._tEndAll.material=this._yellowMat,this._tEndX.renderingGroupId=2,this._tEndY.renderingGroupId=2,this._tEndZ.renderingGroupId=2,this._tEndXZ.renderingGroupId=2,this._tEndZY.renderingGroupId=2,this._tEndYX.renderingGroupId=2,this._tEndAll.renderingGroupId=2,this._tEndX.isPickable=!1,this._tEndY.isPickable=!1,this._tEndZ.isPickable=!1,this._tEndXZ.isPickable=!1,this._tEndZY.isPickable=!1,this._tEndYX.isPickable=!1,this._tEndAll.isPickable=!1},t.prototype._createTriangle=function(t,e,i){console.log("_createTriangle "+e);var n=new o(e/2,-e/2).addLineTo(e/2,e/2).addLineTo(-e/2,e/2).addLineTo(e/2,-e/2);return new BABYLON.PolygonMeshBuilder(t,n,i).build()},t.prototype.setRotGuideFull=function(t){this._guideSize=t?360:180,null!=this._rCtl&&(this._rCtl.dispose(),this._rAll.dispose(),this._rCtl=null,this.enableRotation())},t.prototype._createRotAxes=function(){var t=this._axesLen*this._axesScale*2;this._rCtl=new a("rotCtl",this._scene),this._rX=this._createTube(t/2,this._guideSize),this._rX.name="X",this._rY=this._createTube(t/2,this._guideSize),this._rY.name="Y",this._rZ=this._createTube(t/2,this._guideSize),this._rZ.name="Z",this._rAll=this._createTube(t/1.75,360),this._rAll.name="ALL",this._rX.rotation.z=1.57,this._rZ.rotation.x=-1.57,this._rX.bakeCurrentTransformIntoVertices(),this._rZ.bakeCurrentTransformIntoVertices(),this._rAll.rotation.x=1.57,this._rX.parent=this._rCtl,this._rX.metadata={isEditControl:!0,isRealMesh:!1},this._rY.parent=this._rCtl,this._rY.metadata={isEditControl:!0,isRealMesh:!1},this._rZ.parent=this._rCtl,this._rZ.metadata={isEditControl:!0,isRealMesh:!1},this._rAll.parent=this._pALL,this._rAll.metadata={isEditControl:!0,isRealMesh:!1},this._rX.visibility=0,this._rY.visibility=0,this._rZ.visibility=0,this._rAll.visibility=0,this._rX.isPickable=!1,this._rY.isPickable=!1,this._rZ.isPickable=!1,this._rAll.isPickable=!1;var e=t;this._rEndX=this._createCircle(e/2,this._guideSize,!1),this._rEndY=this._rEndX.clone(""),this._rEndZ=this._rEndX.clone(""),this._rEndAll=this._createCircle(e/1.75,360,!1),this._rEndAll2=this._createCircle(e/2,360,!1),this._rEndX.parent=this._rX,this._rEndX.metadata={isEditControl:!0,isRealMesh:!1},this._rEndY.parent=this._rY,this._rEndY.metadata={isEditControl:!0,isRealMesh:!1},this._rEndZ.parent=this._rZ,this._rEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._rEndX.rotation.z=1.57,this._rEndZ.rotation.x=-1.57,this._rEndAll.parent=this._rAll,this._rEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._rEndAll2.parent=this._rAll,this._rEndAll2.metadata={isEditControl:!0,isRealMesh:!1},this._rEndX.color=n.Red(),this._rEndY.color=n.Green(),this._rEndZ.color=n.Blue(),this._rEndAll.color=n.Yellow(),this._rEndAll2.color=n.Gray(),this._rEndX.renderingGroupId=2,this._rEndY.renderingGroupId=2,this._rEndZ.renderingGroupId=2,this._rEndAll.renderingGroupId=2,this._rEndAll2.renderingGroupId=2,this._rEndX.isPickable=!1,this._rEndY.isPickable=!1,this._rEndZ.isPickable=!1,this._rEndAll.isPickable=!1,this._rEndAll2.isPickable=!1},t.prototype._extrudeBox=function(t,e){var i=[new u(t,t,0),new u(-t,t,0),new u(-t,-t,0),new u(t,-t,0),new u(t,t,0)],n=[new u(0,0,0),new u(0,0,e)];return a.ExtrudeShape("",i,n,1,0,2,this._scene)},t.prototype._createCircle=function(t,e,i){null===e&&(e=360);for(var n,r,s=[],o=3.14/180,l=0,h=0;h<=e;h+=5)n=t*Math.cos(h*o),r=90==h?t:270==h?-t:t*Math.sin(h*o),s[l]=new u(n,0,r),l++;if(i){t-=.04;for(h=0;h<=e;h+=5)n=t*Math.cos(h*o),r=90==h?t:270==h?-t:t*Math.sin(h*o),s[l]=new u(n,0,r),l++}return a.CreateLines("",s,this._scene)},t.prototype._createTube=function(t,e){null===e&&(e=360);for(var i,n,r=[],s=3.14/180,o=0,l=0;l<=e;l+=30)i=t*Math.cos(l*s),n=90==l?t:270==l?-t:t*Math.sin(l*s),r[o]=new u(i,0,n),o++;return a.CreateTube("",r,this._pickWidth*this._axesScale*2,3,null,BABYLON.Mesh.NO_CAP,this._scene)},t.prototype._createScaleAxes=function(){var t=2*this._pickWidth*this._axesScale,e=this._axesLen*this._axesScale;this._sCtl=new a("sCtl",this._scene),this._sX=this._extrudeBox(t/2,e),this._sX.name="X",this._sY=this._sX.clone("Y"),this._sZ=this._sX.clone("Z"),this._sXZ=s.CreatePlane("XZ",{size:2*t},this._scene),this._sZY=s.CreatePlane("ZY",{size:2*t},this._scene),this._sYX=s.CreatePlane("YX",{size:2*t},this._scene),this._sXZ.rotation.x=1.57,this._sZY.rotation.y=-1.57,this._sXZ.position.x=t,this._sXZ.position.z=t,this._sZY.position.z=t,this._sZY.position.y=t,this._sYX.position.y=t,this._sYX.position.x=t,this._sXZ.bakeCurrentTransformIntoVertices(),this._sZY.bakeCurrentTransformIntoVertices(),this._sYX.bakeCurrentTransformIntoVertices(),this._sAll=a.CreateBox("ALL",2*t,this._scene),this._sX.parent=this._sCtl,this._sX.metadata={isEditControl:!0,isRealMesh:!1},this._sY.parent=this._sCtl,this._sY.metadata={isEditControl:!0,isRealMesh:!1},this._sZ.parent=this._sCtl,this._sZ.metadata={isEditControl:!0,isRealMesh:!1},this._sAll.parent=this._sCtl,this._sAll.metadata={isEditControl:!0,isRealMesh:!1},this._sXZ.parent=this._sCtl,this._sXZ.metadata={isEditControl:!0,isRealMesh:!1},this._sZY.parent=this._sCtl,this._sZY.metadata={isEditControl:!0,isRealMesh:!1},this._sYX.parent=this._sCtl,this._sYX.metadata={isEditControl:!0,isRealMesh:!1},this._sX.rotation.y=1.57,this._sY.rotation.x-=1.57,this._sX.visibility=0,this._sY.visibility=0,this._sZ.visibility=0,this._sXZ.visibility=0,this._sZY.visibility=0,this._sYX.visibility=0,this._sAll.visibility=0,this._sX.isPickable=!1,this._sY.isPickable=!1,this._sZ.isPickable=!1,this._sXZ.isPickable=!1,this._sZY.isPickable=!1,this._sYX.isPickable=!1,this._sAll.isPickable=!1;var i=t;this._sEndX=a.CreateBox("",i,this._scene),this._sEndY=this._sEndX.clone(""),this._sEndZ=this._sEndX.clone(""),this._sEndXZ=this._createTriangle("XZ",1.75*i,this._scene),this._sEndZY=this._sEndXZ.clone("ZY"),this._sEndYX=this._sEndXZ.clone("YX"),this._sEndAll=s.CreatePolyhedron("sEndAll",{type:1,size:i/2},this._scene),this._sEndZY.rotation.z=1.57,this._sEndYX.rotation.x=-1.57,this._sEndXZ.position.x=t,this._sEndXZ.position.z=t,this._sEndZY.position.z=t,this._sEndZY.position.y=t,this._sEndYX.position.y=t,this._sEndYX.position.x=t,this._sEndX.parent=this._sX,this._sEndX.metadata={isEditControl:!0,isRealMesh:!1},this._sEndY.parent=this._sY,this._sEndY.metadata={isEditControl:!0,isRealMesh:!1},this._sEndZ.parent=this._sZ,this._sEndZ.metadata={isEditControl:!0,isRealMesh:!1},this._sEndXZ.parent=this._sXZ,this._sEndXZ.metadata={isEditControl:!0,isRealMesh:!1},this._sEndZY.parent=this._sZY,this._sEndZY.metadata={isEditControl:!0,isRealMesh:!1},this._sEndYX.parent=this._sYX,this._sEndYX.metadata={isEditControl:!0,isRealMesh:!1},this._sEndAll.parent=this._sAll,this._sEndAll.metadata={isEditControl:!0,isRealMesh:!1},this._sEndX.position.z=e-i/2,this._sEndY.position.z=e-i/2,this._sEndZ.position.z=e-i/2,this._sEndX.material=this._redMat,this._sEndY.material=this._greenMat,this._sEndZ.material=this._blueMat,this._sEndXZ.material=this._greenMat,this._sEndZY.material=this._redMat,this._sEndYX.material=this._blueMat,this._sEndAll.material=this._yellowMat,this._sEndX.renderingGroupId=2,this._sEndY.renderingGroupId=2,this._sEndZ.renderingGroupId=2,this._sEndXZ.renderingGroupId=2,this._sEndZY.renderingGroupId=2,this._sEndYX.renderingGroupId=2,this._sEndAll.renderingGroupId=2,this._sEndX.isPickable=!1,this._sEndY.isPickable=!1,this._sEndZ.isPickable=!1,this._sEndXZ.isPickable=!1,this._sEndZY.isPickable=!1,this._sEndYX.isPickable=!1,this._sEndAll.isPickable=!1},t.prototype._check_LHS_RHS=function(t){var e=u.Cross(this._localX,this._localY);return u.Dot(e,this._localZ)<0},t.prototype.setVisibility=function(t){this._visibility=t},t.prototype.setLocal=function(t){this._local!=t&&(this._local=t,t||(this._ecRoot.rotationQuaternion=l.Identity()))},t.prototype.isLocal=function(){return this._local},t.prototype.setTransSnap=function(t){this._snapT=t},t.prototype.setRotSnap=function(t){this._snapR=t},t.prototype.setScaleSnap=function(t){this._snapS=t},t.prototype.setTransSnapValue=function(t){this._tSnap.copyFromFloats(t,t,t),this._transSnap=t},t.prototype.setRotSnapValue=function(t){this._rotSnap=t},t.prototype.setScaleSnapValue=function(t){this._scaleSnap=t},t.prototype._getAngle2=function(t,e,i,n,r){var a=u.Dot(n,r);r.scaleToRef(a,this._tv1),i.addToRef(this._tv1,this._tv2);var s=this._tv2;this._mainCamera.getWorldMatrix().invertToRef(this._tm),u.TransformCoordinatesToRef(this._tv2,this._tm,this._tv2);var o=0;s.x>=0&&s.y>=0?o=1:s.x<=0&&s.y>=0?o=2:s.x<=0&&s.y<=0?o=3:s.x>=0&&s.y<=0&&(o=4),u.TransformCoordinatesToRef(t,this._tm,this._tv1),u.TransformCoordinatesToRef(e,this._tm,this._tv2),this._tv2.subtractInPlace(this._tv1);var l=this._tv2,h=l.length(),c="";l.x>=0&&l.y>=0?c=l.x>=l.y?"r":"u":l.x<=0&&l.y>=0?c=-l.x>=l.y?"l":"u":l.x<=0&&l.y<=0?c=-l.x>=-l.y?"l":"d":l.x>=0&&l.y<=0&&(c=l.x>=-l.y?"r":"d");var d=0;return"d"==c?d=1==o||4==o?1:-1:"u"==c?d=1==o||4==o?-1:1:"r"==c?d=2==o||1==o?1:-1:"l"==c&&(d=2==o||1==o?-1:1),d*h},t.prototype._getAngle=function(t,e,i,n){t.subtractToRef(i,this._tv1),e.subtractToRef(i,this._tv2),u.CrossToRef(this._tv1,this._tv2,this._tv3);var r=Math.asin(this._tv3.length()/(this._tv1.length()*this._tv2.length()));return u.Dot(this._tv3,n)>0&&(r*=-1),r},t.prototype._createMaterials=function(e){this._redMat=t._getStandardMaterial("redMat",n.Red(),e),this._greenMat=t._getStandardMaterial("greenMat",n.Green(),e),this._blueMat=t._getStandardMaterial("blueMat",n.Blue(),e),this._whiteMat=t._getStandardMaterial("whiteMat",n.White(),e),this._yellowMat=t._getStandardMaterial("whiteMat",n.Yellow(),e)},t.prototype._disposeMaterials=function(){this._redMat.dispose(),this._greenMat.dispose(),this._blueMat.dispose(),this._whiteMat.dispose(),this._yellowMat.dispose()},t._getStandardMaterial=function(t,e,i){var r=new c(t,i);return r.emissiveColor=e,r.diffuseColor=n.Black(),r.specularColor=n.Black(),r.backFaceCulling=!1,r},t}();t.EditControl=d;var f=function(){function t(t,e){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=e-1,this.add()}return t.prototype.setCapacity=function(t){0!=t?(this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()):console.error("capacity should be more than zero")},t.prototype.add=function(t){void 0===t&&(t=null);var e=new g(this.mesh,t);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(e)):(this.acts.push(e),this.last++,this.current++)},t.prototype.undo=function(){if(this.current>0){var t=this.acts[this.current].getActionType();return this.current--,this.acts[this.current].perform(this.mesh),t}},t.prototype.redo=function(){if(this.current<this.last)return this.current++,this.acts[this.current].perform(this.mesh),this.acts[this.current].getActionType()},t}();t.ActHist=f;var g=function(){function t(t,e){this._p=t.position.clone(),null==t.rotationQuaternion?(this._rQ=null,this._rE=t.rotation.clone()):(this._rQ=t.rotationQuaternion.clone(),this._rE=null),this._s=t.scaling.clone(),this._at=e}return t.prototype.getActionType=function(){return this._at},t.prototype.perform=function(t){t.position.copyFrom(this._p),null==t.rotationQuaternion?null!=this._rE?t.rotation.copyFrom(this._rE):t.rotation.copyFrom(this._rQ.toEulerAngles()):null!=this._rQ?t.rotationQuaternion.copyFrom(this._rQ):t.rotationQuaternion.copyFrom(l.RotationYawPitchRoll(this._rE.y,this._rE.x,this._rE.z)),t.scaling.copyFrom(this._s)},t}();t.Act=g}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),function(t){var e=BABYLON.Color3,i=BABYLON.StandardMaterial,n=BABYLON.Matrix,r=BABYLON.Mesh,a=BABYLON.Vector3,s=BABYLON.Quaternion,o=BABYLON.VertexData,l=BABYLON.LinesMesh,h=function(){function t(n,a,s,o,l,h){void 0===a&&(a=1911),this._scene=n,this._arrowLength=s||1,this._coneLength=o||.2,this._coneRadius=l||.1,this._planeSelectionLength=h||this._arrowLength/5,this._wireSelectionThreshold=.05,this._light1=new BABYLON.PointLight("ManipulatorLight",new BABYLON.Vector3(50,50,70),this._scene),this._light1.id="***SceneManipulatorLight***",this._light2=new BABYLON.PointLight("ManipulatorLight",new BABYLON.Vector3(-50,-50,-70),this._scene),this._light2.id="***SceneManipulatorLight***",this._xArrowColor=new e(t.pc,t.sc/2,t.sc),this._yArrowColor=new e(t.sc,t.pc,t.sc/2),this._zArrowColor=new e(t.sc/2,t.sc,t.pc),this._xyPlaneSelectionColor=new e(t.pc/1.1,t.pc/1.3,t.sc),this._xzPlaneSelectionColor=new e(t.pc/1.1,t.sc,t.pc/1.3),this._yzPlaneSelectionColor=new e(t.sc,t.pc/1.3,t.pc/1.1);var c=[];c.push({name:"arrowX",color:this.xArrowColor}),c.push({name:"arrowY",color:this.yArrowColor}),c.push({name:"arrowZ",color:this.zArrowColor}),c.push({name:"planeXY",color:this.xyPlaneSelectionColor}),c.push({name:"planeXZ",color:this.xzPlaneSelectionColor}),c.push({name:"planeYZ",color:this.yzPlaneSelectionColor}),c.push({name:"rotationX",color:this.xArrowColor.clone()}),c.push({name:"rotationY",color:this.yArrowColor.clone()}),c.push({name:"rotationZ",color:this.zArrowColor.clone()}),this._materials=[];for(var u=0,d=c;u<d.length;u++){var f=d[u],g=new i(f.name+"RadixMaterial",this._scene);g.diffuseColor=f.color,this._materials[f.name]=g}this._features=a,this._rootMesh=new r("radixRoot",this._scene),this._rootMesh.renderingGroupId=1,this.constructGraphicalObjects()}return Object.defineProperty(t.prototype,"wireSelectionThreshold",{get:function(){return this._wireSelectionThreshold},set:function(t){this._wireSelectionThreshold=t;for(var e=0,i=this._rootMesh.getChildMeshes(!0,function(t){return t instanceof l});e<i.length;e++){var n=i[e];n&&(n.intersectionThreshold=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xArrowColor",{get:function(){return this._xArrowColor},set:function(t){this._xArrowColor=t,this.updateMaterial("arrowX",t),this.updateMaterial("rotationX",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yArrowColor",{get:function(){return this._yArrowColor},set:function(t){this._yArrowColor=t,this.updateMaterial("arrowY",t),this.updateMaterial("rotationY",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zArrowColor",{get:function(){return this._zArrowColor},set:function(t){this._zArrowColor=t,this.updateMaterial("arrowZ",t),this.updateMaterial("rotationZ",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyPlaneSelectionColor",{get:function(){return this._xyPlaneSelectionColor},set:function(t){this._xyPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xzPlaneSelectionColor",{get:function(){return this._xzPlaneSelectionColor},set:function(t){this._xzPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yzPlaneSelectionColor",{get:function(){return this._yzPlaneSelectionColor},set:function(t){this._yzPlaneSelectionColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlighted",{get:function(){return this._highlighted},set:function(t){this.updateMaterialFromHighlighted(1,t,"arrowX"),this.updateMaterialFromHighlighted(2,t,"arrowY"),this.updateMaterialFromHighlighted(4,t,"arrowZ"),this.updateMaterialFromHighlighted(16,t,"planeXY"),this.updateMaterialFromHighlighted(32,t,"planeXZ"),this.updateMaterialFromHighlighted(64,t,"planeYZ"),this.updateMaterialFromHighlighted(256,t,"rotationX"),this.updateMaterialFromHighlighted(512,t,"rotationY"),this.updateMaterialFromHighlighted(1024,t,"rotationZ"),this._highlighted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),t.prototype.intersect=function(t){var e,i=0,n=Number.MAX_VALUE;this.hasFeature(1)&&((e=this.intersectMeshes(t,"arrowX",n))<n&&(n=e,i=1));this.hasFeature(2)&&((e=this.intersectMeshes(t,"arrowY",n))<n&&(n=e,i=2));this.hasFeature(4)&&((e=this.intersectMeshes(t,"arrowZ",n))<n&&(n=e,i=4));this.hasFeature(16)&&((e=this.intersectMeshes(t,"planeXY",n))<n&&(n=e,i=16));this.hasFeature(32)&&((e=this.intersectMeshes(t,"planeXZ",n))<n&&(n=e,i=32));this.hasFeature(64)&&((e=this.intersectMeshes(t,"planeYZ",n))<n&&(n=e,i=64));this.hasFeature(256)&&((e=this.intersectMeshes(t,"rotationX",n))<n&&(n=e,i=256));this.hasFeature(512)&&((e=this.intersectMeshes(t,"rotationY",n))<n&&(n=e,i=512));this.hasFeature(1024)&&((e=this.intersectMeshes(t,"rotationZ",n))<n&&(n=e,i=1024));return i},t.prototype.setWorld=function(t,e,i){this._rootMesh.position=t,this._rootMesh.rotationQuaternion=e,this._rootMesh.scaling=i},t.prototype.show=function(){this.setVisibleState(this._rootMesh,!0)},t.prototype.hide=function(){this.setVisibleState(this._rootMesh,!1)},t.prototype.setVisibleState=function(t,e){var i=this;t.isVisible=e,t.getChildMeshes(!0).forEach(function(t){return i.setVisibleState(t,e)})},t.prototype.intersectMeshes=function(t,e,i){for(var n=0,r=this._rootMesh.getChildMeshes(!0,function(t){return 0===t.name.indexOf(e)});n<r.length;n++){var a=r[n],s=this._scene.createPickingRay(t.x,t.y,a.getWorldMatrix(),this._scene.activeCamera),o=a.intersects(s,!1);o.hit&&o.distance<i&&(i=o.distance)}return i},t.prototype.constructGraphicalObjects=function(){var t=Math.PI/2;this.hasFeature(1)&&this.constructArrow(1,"arrowX",n.RotationZ(-t)),this.hasFeature(2)&&this.constructArrow(2,"arrowY",n.Identity()),this.hasFeature(4)&&this.constructArrow(4,"arrowZ",n.RotationX(t)),this.hasFeature(16)&&this.constructPlaneSelection(16,"planeXY",n.Identity()),this.hasFeature(32)&&this.constructPlaneSelection(32,"planeXZ",n.RotationX(t)),this.hasFeature(64)&&this.constructPlaneSelection(64,"planeYZ",n.RotationY(-t)),this.hasFeature(256)&&this.constructRotation(256,"rotationX",n.RotationZ(-t)),this.hasFeature(512)&&this.constructRotation(512,"rotationY",n.Identity()),this.hasFeature(1024)&&this.constructRotation(1024,"rotationZ",n.RotationX(t))},t.prototype.constructArrow=function(t,e,i){var n,h=this.getMaterial(e);switch(t){case 1:n=this.hasFeature(256);break;case 2:n=this.hasFeature(512);break;case 4:n=this.hasFeature(1024)}var c=s.FromRotationMatrix(i),u=new Array;u.push(0,n?this._coneLength:0,0),u.push(0,this._arrowLength-this._coneLength,0);var d=new l(e+"Wire",this._scene);d.rotationQuaternion=c,d.parent=this._rootMesh,d.color=h.diffuseColor,d.renderingGroupId=1,d.intersectionThreshold=this.wireSelectionThreshold,d.isPickable=!1;var f=new o;f.positions=u,f.indices=[0,1],f.applyToMesh(d);var g=r.CreateCylinder(e+"Cone",this._coneLength,0,this._coneRadius,18,1,this._scene,!1);g.position=a.TransformCoordinates(new a(0,this._arrowLength-this._coneLength/2,0),i),g.rotationQuaternion=c,g.material=h,g.parent=this._rootMesh,g.renderingGroupId=1,g.isPickable=!1,this.addSymbolicMeshToLit(g)},t.prototype.constructPlaneSelection=function(t,e,i){var n=this.getMaterial(e),o=new Array;o.push(new a(this._arrowLength-this._planeSelectionLength,this._arrowLength,0)),o.push(new a(this._arrowLength,this._arrowLength,0)),o.push(new a(this._arrowLength,this._arrowLength-this._planeSelectionLength,0));var l=r.CreateLines(e+"Plane",o,this._scene);l.parent=this._rootMesh,l.color=n.diffuseColor,l.rotationQuaternion=s.FromRotationMatrix(i),l.renderingGroupId=1,l.intersectionThreshold=this.wireSelectionThreshold,l.isPickable=!1},t.prototype.constructRotation=function(t,e,i){var n=this.getMaterial(e),o=r.CreateCylinder(e+"Cylinder",this._coneLength,this._coneRadius,this._coneRadius,18,1,this._scene,!1);o.material=n,o.position=a.TransformCoordinates(new a(0,this._coneLength/2,0),i),o.rotationQuaternion=s.FromRotationMatrix(i),o.parent=this._rootMesh,o.renderingGroupId=1,o.isPickable=!1,this.addSymbolicMeshToLit(o)},t.prototype.addSymbolicMeshToLit=function(t){var e=this;this._light1.includedOnlyMeshes.push(t),this._light2.includedOnlyMeshes.push(t),this._scene.lights.map(function(i){i!==e._light1&&i!==e._light2&&i.excludedMeshes.push(t)})},t.prototype.hasFeature=function(t){return 0!=(this._features&t)},t.prototype.hasHighlightedFeature=function(t){return 0!=(this._highlighted&t)},t.prototype.updateMaterial=function(t,e){var i=this.getMaterial(t);i&&(i.diffuseColor=e)},t.prototype.updateMaterialFromHighlighted=function(t,e,i){if(this.hasFeature(t)&&(this._highlighted&t)!=(e&t)){var n=this.getMaterial(i);0!=(e&t)?(n.diffuseColor.r*=1.8,n.diffuseColor.g*=1.8,n.diffuseColor.b*=1.8):(n.diffuseColor.r/=1.8,n.diffuseColor.g/=1.8,n.diffuseColor.b/=1.8)}},t.prototype.getMaterial=function(t){return this._materials[t]},t.pc=.6,t.sc=.2,t}();t.Radix=h}(ManipulationHelpers||(ManipulationHelpers={}));var ManipulationHelpers,Vector4=BABYLON.Vector2;!function(t){var e=BABYLON.Vector2,i=BABYLON.Vector3,n=BABYLON.Matrix,r=BABYLON.Plane,a=BABYLON.AbstractMesh,s=BABYLON.Quaternion,o=BABYLON.PointerEventTypes,l=function(){function l(e){var i=this;this.noPreventContextMenu=!1,this._flags=0,this._rotationFactor=1,this._scene=e,this._radix=new t.Radix(e),this._shiftKeyState=!1,this._scene.onBeforeRenderObservable.add(function(t,e){return i.onBeforeRender(t,e)}),this._scene.onPointerObservable.add(function(t,e){return i.onPointer(t,e)},-1,!0),window.oncontextmenu=function(t){i.noPreventContextMenu||t.preventDefault()}}return l.prototype.attachManipulatedNode=function(t){this._manipulatedNode=t,this._radix.show()},l.prototype.detachManipulatedNode=function(t){this._manipulatedNode=null,this._radix.hide()},l.prototype.onBeforeRender=function(t,e){this.renderManipulator()},l.prototype.onPointer=function(t,e){if(this._manipulatedNode){var i=this.getRayPosition(t.event),n=t.event.shiftKey;this.hasManFlags(1)&&n!==this._shiftKeyState&&this.beginDrag(i,t.event),t.type===o.POINTERMOVE?this.noPreventContextMenu||2!==t.event.button||1!==t.event.buttons?this.hasManFlags(1)&&!this.hasManFlags(8)?(e.skipNextObservers=!0,n||this.hasManipulatedMode(1792)?this.doRot(i):this.doPos(i)):this._radix.highlighted=this._radix.intersect(i):(this.setManipulatedNodeWorldMatrix(this._firstTransform),this.setManFlags(8)):t.type===o.POINTERDOWN&&0===t.event.button?(this._manipulatedMode=this._radix.intersect(i),0!==this._manipulatedMode&&(e.skipNextObservers=!0,this.beginDrag(i,t.event),this.hasManipulatedMode(1792)?this.doRot(i):this.doPos(i))):t.type===o.POINTERUP&&(this.hasManFlags(1)&&(e.skipNextObservers=!0),this._radix.highlighted=this._radix.intersect(i),0===t.event.button&&this.endDragMode())}},l.prototype.beginDrag=function(t,e){this._firstMousePos=t,this._prevMousePos=this._firstMousePos.clone(),this._shiftKeyState=e.shiftKey;var i=this.getManipulatedNodeWorldMatrix();this._pos=i.getTranslation(),this._right=i.getRow(0).toVector3(),this._up=i.getRow(1).toVector3(),this._view=i.getRow(2).toVector3(),this._oldPos=this._pos.clone(),this._firstTransform=i.clone(),this._flags|=3},l.prototype.endDragMode=function(){this.clearManFlags(9)},l.prototype.doRot=function(t){if(this.hasManFlags(2))this.clearManFlags(2);else{var e=t.x-this._prevMousePos.x,i=t.y-this._prevMousePos.y,r=this._scene.getEngine().getRenderingCanvasClientRect(),a=e/r.width*Math.PI*2*this._rotationFactor,s=i/r.height*Math.PI*2*this._rotationFactor;if(this.rotationStep){var o=a%this.rotationStep;a-=o,s-=o=s%this.rotationStep}var l=n.Identity();this.hasManipulatedMode(257)?l=n.RotationX(s):this.hasManipulatedMode(514)?l=n.RotationY(s):this.hasManipulatedMode(1028)?l=n.RotationZ(s):(this.hasManipulatedMode(48)&&(l=l.multiply(n.RotationX(s))),this.hasManipulatedMode(80)&&(l=l.multiply(n.RotationY(a))),this.hasManipulatedMode(32)&&(l=l.multiply(n.RotationZ(s))),this.hasManipulatedMode(32)&&(l=l.multiply(n.RotationZ(a))));var h=l.multiply(this._firstTransform);this.setManipulatedNodeWorldMatrix(h)}},l.prototype.doPos=function(t){var e=i.Zero(),a=this._scene.createPickingRay(t.x,t.y,n.Identity(),this._scene.activeCamera);if(this.hasManipulatedMode(112)){this.hasManipulatedMode(16)?o=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._up)):this.hasManipulatedMode(32)?o=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._view)):this.hasManipulatedMode(64)&&(o=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._view)));if(Math.abs(i.Dot(o.normal,a.direction))<.06)return;var s=a.intersectsPlane(o);if(c=l.ComputeRayHit(a,s),this.hasManFlags(2))return this._flags&=-3,void(this._prevHit=c);e=c.subtract(this._prevHit)}else if(0!=(7&this._manipulatedMode)){var o,h,c,u,d;if(this.hasManFlags(2)){var f;if(o=(f=this.setupIntersectionPlanes(this._manipulatedMode)).p0,h=f.p1,Math.abs(i.Dot(o.normal,a.direction))>Math.abs(i.Dot(h.normal,a.direction))){s=a.intersectsPlane(o);c=l.ComputeRayHit(a,s);this._flags&=-5}else{s=a.intersectsPlane(h);c=l.ComputeRayHit(a,s),this._flags|=4}return this._flags&=-3,void(this._prevHit=c)}o=(f=this.setupIntersectionPlane(this._manipulatedMode,this.hasManFlags(4))).plane,d=f.axis;s=a.intersectsPlane(o);e=(c=l.ComputeRayHit(a,s)).subtract(this._prevHit),u=i.Dot(d,e),e=d.multiplyByFloats(u,u,u)}this.translationStep&&(e.x-=e.x%this.translationStep,e.y-=e.y%this.translationStep,e.z-=e.z%this.translationStep);var g=this._firstTransform.clone();g.setTranslation(g.getTranslation().add(e)),this._pos=g.getTranslation(),this.setManipulatedNodeWorldMatrix(g)},l.prototype.hasManipulatedMode=function(t){return 0!=(this._manipulatedMode&t)},l.prototype.hasManFlags=function(t){return 0!=(this._flags&t)},l.prototype.clearManFlags=function(t){return this._flags&=~t,this._flags},l.prototype.setManFlags=function(t){return this._flags|=t,this._flags},l.ComputeRayHit=function(t,e){return t.origin.add(t.direction.multiplyByFloats(e,e,e))},l.prototype.setManipulatedNodeWorldMatrix=function(t){if(this._manipulatedNode&&this._manipulatedNode instanceof a){var e=this._manipulatedNode;e.parent&&(t=t.multiply(e.parent.getWorldMatrix().clone().invert()));var n=i.Zero(),r=i.Zero(),o=new s;t.decompose(r,o,n),e.position=n,e.rotationQuaternion=o,e.scaling=r}},l.prototype.getManipulatedNodeWorldMatrix=function(){return this._manipulatedNode?this._manipulatedNode instanceof a?this._manipulatedNode.getWorldMatrix():void 0:null},l.prototype.setupIntersectionPlane=function(t,e){var n,r=this.setupIntersectionPlanes(t),a=e?r.p1:r.p0;switch(t){case 1:n=this._right;break;case 2:n=this._up;break;case 4:n=this._view;break;default:n=i.Zero()}return{plane:a,axis:n}},l.prototype.setupIntersectionPlanes=function(t){var e,i;switch(t){case 1:e=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._right)),i=r.FromPoints(this._pos,this._pos.add(this._right),this._pos.add(this._up));break;case 2:e=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._right)),i=r.FromPoints(this._pos,this._pos.add(this._up),this._pos.add(this._view));break;case 4:e=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._right)),i=r.FromPoints(this._pos,this._pos.add(this._view),this._pos.add(this._up))}return{p0:e,p1:i}},l.prototype.getRayPosition=function(t){var i=this._scene.getEngine().getRenderingCanvasClientRect(),n=t.clientX-i.left,r=t.clientY-i.top;return new e(n,r)},l.prototype.renderManipulator=function(){if(this._manipulatedNode&&this._manipulatedNode instanceof a){var t=this._manipulatedNode.getWorldMatrix(),e=i.Distance(this._scene.activeCamera.position,t.getTranslation()),r=this._scene.getEngine().getRenderWidth(),o=20*this.fromScreenToWorld(r/100,e),l=i.Zero(),h=i.Zero(),c=s.Identity();n.Scaling(o,o,o).multiply(t).decompose(l,c,h),this._radix.setWorld(h,c,l)}},l.prototype.fromScreenToWorld=function(t,e){var i=this._scene.activeCamera,r=this._scene.createPickingRay(0,0,n.Identity(),i,!0),a=this._scene.createPickingRay(t,0,n.Identity(),i,!0),s=l.evalPosition(r,e);return l.evalPosition(a,e).x-s.x},l.evalPosition=function(t,e){return t.origin.add(t.direction.multiplyByFloats(e,e,e))},l}();t.ManipulatorInteractionHelper=l}(ManipulationHelpers||(ManipulationHelpers={})),function(t){var e=BABYLON.PointerEventTypes,i=BABYLON.AbstractMesh,n=function(){function n(t){var e=this;this._actionStack=new Array,this._scene=t,this._pointerObserver=this._scene.onPointerObservable.add(function(t,i){return e.pointerCallback(t,i)},-1,!0)}return Object.defineProperty(n.prototype,"currentAction",{get:function(){return 0===this._actionStack.length?1:this._actionStack[this._actionStack.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manipulator",{get:function(){return this._manipulator||(this._manipulator=new t.ManipulatorInteractionHelper(this._scene)),this._manipulator},enumerable:!0,configurable:!0}),n.prototype.pointerCallback=function(t,i){switch(this.detectActionChanged(t,i),this.currentAction){case 1:this.doSelectorInteraction(t,i);break;case 2:t.type&(e.POINTERUP|e.POINTERWHEEL)&&this._actionStack.pop()}},n.prototype.doSelectorInteraction=function(t,n){if(n.skipNextObservers=!0,t.type===e.POINTERUP&&0===t.event.button){var r;if(t.pickInfo.hit&&(r=t.pickInfo.pickedMesh),this._pickedNode===r)return r.showBoundingBox=!r.showBoundingBox,void(!1===r.showBoundingBox&&(this.manipulator.detachManipulatedNode(this._pickedNode),this._pickedNode=null));if(this._pickedNode){if(this._pickedNode instanceof i)this._pickedNode.showBoundingBox=!1;this.manipulator.detachManipulatedNode(this._pickedNode),this._pickedNode=null}r&&(this._pickedNode=r,r.showBoundingBox=!0,this.manipulator.attachManipulatedNode(this._pickedNode))}},n.prototype.detectActionChanged=function(t,i){if(1===this.currentAction){if(t.type===e.POINTERDOWN&&!t.pickInfo.hit)return void this._actionStack.push(2);if(t.type===e.POINTERWHEEL)return void this._actionStack.push(2)}},n.CameratorSwitchThreshold=4,n}();t.SimpleInteractionHelper=n}(ManipulationHelpers||(ManipulationHelpers={})),function(t){var e=function(){function t(){}return t.prototype.render=function(){this.renderLight,this.renderManipulator},t}();t.SymbolicVisualHelper=e}(ManipulationHelpers||(ManipulationHelpers={})),function(){"use strict";var t=function(e){if(!(this instanceof t))return new t(e);if(this.version=1,this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),!this.support)return!1;var i=this;i.files=[],i.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",chunkNumberParameterName:"resumableChunkNumber",chunkSizeParameterName:"resumableChunkSize",currentChunkSizeParameterName:"resumableCurrentChunkSize",totalSizeParameterName:"resumableTotalSize",typeParameterName:"resumableType",identifierParameterName:"resumableIdentifier",fileNameParameterName:"resumableFilename",relativePathParameterName:"resumableRelativePath",totalChunksParameterName:"resumableTotalChunks",dragOverClass:"dragover",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,preprocessFile:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",testTarget:null,parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:100,chunkRetryInterval:void 0,permanentErrors:[400,401,403,404,409,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,clearInput:!0,chunkFormat:"blob",setChunkTypeFromFile:!1,maxFilesErrorCallback:function(t,e){var n=i.getOpt("maxFiles");alert("Please upload no more than "+n+" file"+(1===n?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(t,e){alert(t.fileName||t.name+"is too small, please upload files larger than "+n.formatSize(i.getOpt("minFileSize"))+".File size:"+t.size+" - File type:"+t.type+" - File object type:"+typeof t)},maxFileSize:void 0,maxFileSizeErrorCallback:function(t,e){alert(t.fileName||t.name+" is too large, please upload files less than "+n.formatSize(i.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(t,e){alert(t.fileName||t.name+" has type not allowed, please upload files of type "+i.getOpt("fileType")+".")}},i.opts=e||{},i.getOpt=function(e){var i=this;if(e instanceof Array){var r={};return n.each(e,function(t){r[t]=i.getOpt(t)}),r}if(i instanceof d){if(void 0!==i.opts[e])return i.opts[e];i=i.fileObj}if(i instanceof u){if(void 0!==i.opts[e])return i.opts[e];i=i.resumableObj}if(i instanceof t)return void 0!==i.opts[e]?i.opts[e]:i.defaults[e]},i.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},i.events=[],i.on=function(t,e){i.events.push(t.toLowerCase(),e)},i.fire=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var n=t[0].toLowerCase();for(e=0;e<=i.events.length;e+=2)i.events[e]==n&&i.events[e+1].apply(i,t.slice(1)),"catchall"==i.events[e]&&i.events[e+1].apply(null,t);"fileerror"==n&&i.fire("error",t[2],t[1]),"fileprogress"==n&&i.fire("progress")};var n={stopEvent:function(t){t.stopPropagation(),t.preventDefault()},each:function(t,e){if(void 0!==t.length){for(var i=0;i<t.length;i++)if(!1===e(t[i]))return}else for(i in t)if(!1===e(i,t[i]))return},generateUniqueIdentifier:function(t,e){var n=i.getOpt("generateUniqueIdentifier");if("function"==typeof n)return n(t,e);var r=t.webkitRelativePath||t.relativePath||t.fileName||t.name;return t.size+"-"+r.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(t,e){var i=!1;return n.each(t,function(t){return t!=e||(i=!0,!1)}),i},formatSize:function(t){return t<1024?t+" bytes":t<1048576?(t/1024).toFixed(0)+" KB":t<1073741824?(t/1024/1024).toFixed(1)+" MB":(t/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(t,e){var n=i.getOpt("target");if("test"===t&&i.getOpt("testTarget")&&(n="/"===i.getOpt("testTarget")?i.getOpt("target"):i.getOpt("testTarget")),"function"==typeof n)return n(e);var r=n.indexOf("?")<0?"?":"&",a=e.join("&");return a&&(n=n+r+a),n}},r=function(t){t.currentTarget.classList.remove(i.getOpt("dragOverClass")),n.stopEvent(t),t.dataTransfer&&t.dataTransfer.items?h(t.dataTransfer.items,t):t.dataTransfer&&t.dataTransfer.files&&h(t.dataTransfer.files,t)},a=function(t){t.currentTarget.classList.remove(i.getOpt("dragOverClass"))},s=function(t){t.preventDefault();var e=t.dataTransfer;i.indexOf(e.types,"Files")>=0?(t.stopPropagation(),e.dropEffect="copy",e.effectAllowed="copy",t.currentTarget.classList.add(i.getOpt("dragOverClass"))):(e.dropEffect="none",e.effectAllowed="none")};function o(t,e,i,n){var r;return t.isFile?t.file(function(t){t.relativePath=e+t.name,i.push(t),n()}):(t.isDirectory?r=t:t instanceof File&&i.push(t),"function"==typeof t.webkitGetAsEntry&&(r=t.webkitGetAsEntry()),r&&r.isDirectory?function(t,e,i,n){var r=t.createReader(),a=[];!function t(){r.readEntries(function(r){if(r.length)return a=a.concat(r),t();l(a.map(function(t){return o.bind(null,t,e,i)}),n)})}()}(r,e+r.name+"/",i,n):("function"==typeof t.getAsFile&&(t=t.getAsFile())instanceof File&&(t.relativePath=e+t.name,i.push(t)),void n()))}function l(t,e){if(!t||0===t.length)return e();t[0](function(){l(t.slice(1),e)})}function h(t,e){if(t.length){i.fire("beforeAdd");var n=[];l(Array.prototype.map.call(t,function(t){var e=t;return"function"==typeof t.webkitGetAsEntry&&(e=t.webkitGetAsEntry()),o.bind(null,e,"",n)}),function(){n.length&&c(n,e)})}}var c=function(t,e){var r=0,a=i.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(void 0!==a.maxFiles&&a.maxFiles<t.length+i.files.length){if(1!==a.maxFiles||1!==i.files.length||1!==t.length)return a.maxFilesErrorCallback(t,r++),!1;i.removeFile(i.files[0])}var s=[],o=[],l=t.length,h=function(){if(!--l){if(!s.length&&!o.length)return;window.setTimeout(function(){i.fire("filesAdded",s,o)},0)}};n.each(t,function(t){var l=t.name,c=t.type;if(a.fileType.length>0){var d=!1;for(var f in a.fileType){a.fileType[f]=a.fileType[f].replace(/\s/g,"").toLowerCase();var g=(a.fileType[f].match(/^[^.][^/]+$/)?".":"")+a.fileType[f];if(l.substr(-1*g.length).toLowerCase()===g||-1!==g.indexOf("/")&&(-1!==g.indexOf("*")&&c.substr(0,g.indexOf("*"))===g.substr(0,g.indexOf("*"))||c===g)){d=!0;break}}if(!d)return a.fileTypeErrorCallback(t,r++),!0}if(void 0!==a.minFileSize&&t.size<a.minFileSize)return a.minFileSizeErrorCallback(t,r++),!0;if(void 0!==a.maxFileSize&&t.size>a.maxFileSize)return a.maxFileSizeErrorCallback(t,r++),!0;function p(n){i.getFromUniqueIdentifier(n)?o.push(t):function(){t.uniqueIdentifier=n;var r=new u(i,t,n);i.files.push(r),s.push(r),r.container=void 0!==e?e.srcElement:null,window.setTimeout(function(){i.fire("fileAdded",r,e)},0)}(),h()}var m=n.generateUniqueIdentifier(t,e);m&&"function"==typeof m.then?m.then(function(t){p(t)},function(){h()}):p(m)})};function u(t,e,i){var r=this;r.opts={},r.getOpt=t.getOpt,r._prevProgress=0,r.resumableObj=t,r.file=e,r.fileName=e.fileName||e.name,r.size=e.size,r.relativePath=e.relativePath||e.webkitRelativePath||r.fileName,r.uniqueIdentifier=i,r._pause=!1,r.container="",r.preprocessState=0;var a=void 0!==i,s=function(t,e){switch(t){case"progress":r.resumableObj.fire("fileProgress",r,e);break;case"error":r.abort(),a=!0,r.chunks=[],r.resumableObj.fire("fileError",r,e);break;case"success":if(a)return;r.resumableObj.fire("fileProgress",r,e),r.isComplete()&&r.resumableObj.fire("fileSuccess",r,e);break;case"retry":r.resumableObj.fire("fileRetry",r)}};return r.chunks=[],r.abort=function(){var t=0;n.each(r.chunks,function(e){"uploading"==e.status()&&(e.abort(),t++)}),t>0&&r.resumableObj.fire("fileProgress",r)},r.cancel=function(){var t=r.chunks;r.chunks=[],n.each(t,function(t){"uploading"==t.status()&&(t.abort(),r.resumableObj.uploadNextChunk())}),r.resumableObj.removeFile(r),r.resumableObj.fire("fileProgress",r)},r.retry=function(){r.bootstrap();var t=!1;r.resumableObj.on("chunkingComplete",function(){t||r.resumableObj.upload(),t=!0})},r.bootstrap=function(){r.abort(),a=!1,r.chunks=[],r._prevProgress=0;for(var t=r.getOpt("forceChunkSize")?Math.ceil:Math.floor,e=Math.max(t(r.file.size/r.getOpt("chunkSize")),1),i=0;i<e;i++)!function(t){window.setTimeout(function(){r.chunks.push(new d(r.resumableObj,r,t,s)),r.resumableObj.fire("chunkingProgress",r,t/e)},0)}(i);window.setTimeout(function(){r.resumableObj.fire("chunkingComplete",r)},0)},r.progress=function(){if(a)return 1;var t=0,e=!1;return n.each(r.chunks,function(i){"error"==i.status()&&(e=!0),t+=i.progress(!0)}),t=e?1:t>.99999?1:t,t=Math.max(r._prevProgress,t),r._prevProgress=t,t},r.isUploading=function(){var t=!1;return n.each(r.chunks,function(e){if("uploading"==e.status())return t=!0,!1}),t},r.isComplete=function(){var t=!1;return 1!==r.preprocessState&&(n.each(r.chunks,function(e){var i=e.status();if("pending"==i||"uploading"==i||1===e.preprocessState)return t=!0,!1}),!t)},r.pause=function(t){r._pause=void 0===t?!r._pause:t},r.isPaused=function(){return r._pause},r.preprocessFinished=function(){r.preprocessState=2,r.upload()},r.upload=function(){var t=!1;if(!1===r.isPaused()){var e=r.getOpt("preprocessFile");if("function"==typeof e)switch(r.preprocessState){case 0:return r.preprocessState=1,e(r),!0;case 1:return!0}n.each(r.chunks,function(e){if("pending"==e.status()&&1!==e.preprocessState)return e.send(),t=!0,!1})}return t},r.markChunksCompleted=function(t){if(r.chunks&&!(r.chunks.length<=t))for(var e=0;e<t;e++)r.chunks[e].markComplete=!0},r.resumableObj.fire("chunkingStart",r),r.bootstrap(),this}function d(t,e,i,r){var a=this;a.opts={},a.getOpt=t.getOpt,a.resumableObj=t,a.fileObj=e,a.fileObjSize=e.size,a.fileObjType=e.file.type,a.offset=i,a.callback=r,a.lastProgressCallback=new Date,a.tested=!1,a.retries=0,a.pendingRetry=!1,a.preprocessState=0,a.markComplete=!1;var s=a.getOpt("chunkSize");return a.loaded=0,a.startByte=a.offset*s,a.endByte=Math.min(a.fileObjSize,(a.offset+1)*s),a.fileObjSize-a.endByte<s&&!a.getOpt("forceChunkSize")&&(a.endByte=a.fileObjSize),a.xhr=null,a.test=function(){a.xhr=new XMLHttpRequest;var t=function(t){a.tested=!0;var e=a.status();"success"==e?(a.callback(e,a.message()),a.resumableObj.uploadNextChunk()):a.send()};a.xhr.addEventListener("load",t,!1),a.xhr.addEventListener("error",t,!1),a.xhr.addEventListener("timeout",t,!1);var e=[],i=a.getOpt("parameterNamespace"),r=a.getOpt("query");"function"==typeof r&&(r=r(a.fileObj,a)),n.each(r,function(t,n){e.push([encodeURIComponent(i+t),encodeURIComponent(n)].join("="))}),e=e.concat([["chunkNumberParameterName",a.offset+1],["chunkSizeParameterName",a.getOpt("chunkSize")],["currentChunkSizeParameterName",a.endByte-a.startByte],["totalSizeParameterName",a.fileObjSize],["typeParameterName",a.fileObjType],["identifierParameterName",a.fileObj.uniqueIdentifier],["fileNameParameterName",a.fileObj.fileName],["relativePathParameterName",a.fileObj.relativePath],["totalChunksParameterName",a.fileObj.chunks.length]].filter(function(t){return a.getOpt(t[0])}).map(function(t){return[i+a.getOpt(t[0]),encodeURIComponent(t[1])].join("=")})),a.xhr.open(a.getOpt("testMethod"),n.getTarget("test",e)),a.xhr.timeout=a.getOpt("xhrTimeout"),a.xhr.withCredentials=a.getOpt("withCredentials");var s=a.getOpt("headers");"function"==typeof s&&(s=s(a.fileObj,a)),n.each(s,function(t,e){a.xhr.setRequestHeader(t,e)}),a.xhr.send(null)},a.preprocessFinished=function(){a.preprocessState=2,a.send()},a.send=function(){var t=a.getOpt("preprocess");if("function"==typeof t)switch(a.preprocessState){case 0:return a.preprocessState=1,void t(a);case 1:return}if(!a.getOpt("testChunks")||a.tested){a.xhr=new XMLHttpRequest,a.xhr.upload.addEventListener("progress",function(t){new Date-a.lastProgressCallback>1e3*a.getOpt("throttleProgressCallbacks")&&(a.callback("progress"),a.lastProgressCallback=new Date),a.loaded=t.loaded||0},!1),a.loaded=0,a.pendingRetry=!1,a.callback("progress");var e=function(t){var e=a.status();if("success"==e||"error"==e)a.callback(e,a.message()),a.resumableObj.uploadNextChunk();else{a.callback("retry",a.message()),a.abort(),a.retries++;var i=a.getOpt("chunkRetryInterval");void 0!==i?(a.pendingRetry=!0,setTimeout(a.send,i)):a.send()}};a.xhr.addEventListener("load",e,!1),a.xhr.addEventListener("error",e,!1),a.xhr.addEventListener("timeout",e,!1);var i=[["chunkNumberParameterName",a.offset+1],["chunkSizeParameterName",a.getOpt("chunkSize")],["currentChunkSizeParameterName",a.endByte-a.startByte],["totalSizeParameterName",a.fileObjSize],["typeParameterName",a.fileObjType],["identifierParameterName",a.fileObj.uniqueIdentifier],["fileNameParameterName",a.fileObj.fileName],["relativePathParameterName",a.fileObj.relativePath],["totalChunksParameterName",a.fileObj.chunks.length]].filter(function(t){return a.getOpt(t[0])}).reduce(function(t,e){return t[a.getOpt(e[0])]=e[1],t},{}),r=a.getOpt("query");"function"==typeof r&&(r=r(a.fileObj,a)),n.each(r,function(t,e){i[t]=e});var s=a.fileObj.file.slice?"slice":a.fileObj.file.mozSlice?"mozSlice":a.fileObj.file.webkitSlice?"webkitSlice":"slice",o=a.fileObj.file[s](a.startByte,a.endByte,a.getOpt("setChunkTypeFromFile")?a.fileObj.file.type:""),l=null,h=[],c=a.getOpt("parameterNamespace");if("octet"===a.getOpt("method"))l=o,n.each(i,function(t,e){h.push([encodeURIComponent(c+t),encodeURIComponent(e)].join("="))});else if(l=new FormData,n.each(i,function(t,e){l.append(c+t,e),h.push([encodeURIComponent(c+t),encodeURIComponent(e)].join("="))}),"blob"==a.getOpt("chunkFormat"))l.append(c+a.getOpt("fileParameterName"),o,a.fileObj.fileName);else if("base64"==a.getOpt("chunkFormat")){var u=new FileReader;u.onload=function(t){l.append(c+a.getOpt("fileParameterName"),u.result),a.xhr.send(l)},u.readAsDataURL(o)}var d=n.getTarget("upload",h),f=a.getOpt("uploadMethod");a.xhr.open(f,d),"octet"===a.getOpt("method")&&a.xhr.setRequestHeader("Content-Type","application/octet-stream"),a.xhr.timeout=a.getOpt("xhrTimeout"),a.xhr.withCredentials=a.getOpt("withCredentials");var g=a.getOpt("headers");"function"==typeof g&&(g=g(a.fileObj,a)),n.each(g,function(t,e){a.xhr.setRequestHeader(t,e)}),"blob"==a.getOpt("chunkFormat")&&a.xhr.send(l)}else a.test()},a.abort=function(){a.xhr&&a.xhr.abort(),a.xhr=null},a.status=function(){return a.pendingRetry?"uploading":a.markComplete?"success":a.xhr?a.xhr.readyState<4?"uploading":200==a.xhr.status||201==a.xhr.status?"success":n.contains(a.getOpt("permanentErrors"),a.xhr.status)||a.retries>=a.getOpt("maxChunkRetries")?"error":(a.abort(),"pending"):"pending"},a.message=function(){return a.xhr?a.xhr.responseText:""},a.progress=function(t){void 0===t&&(t=!1);var e=t?(a.endByte-a.startByte)/a.fileObjSize:1;if(a.pendingRetry)return 0;switch(a.xhr&&a.xhr.status||a.markComplete||(e*=.95),a.status()){case"success":case"error":return 1*e;case"pending":return 0*e;default:return a.loaded/(a.endByte-a.startByte)*e}},this}return i.uploadNextChunk=function(){var t=!1;if(i.getOpt("prioritizeFirstAndLastChunk")&&(n.each(i.files,function(e){return e.chunks.length&&"pending"==e.chunks[0].status()&&0===e.chunks[0].preprocessState?(e.chunks[0].send(),t=!0,!1):e.chunks.length>1&&"pending"==e.chunks[e.chunks.length-1].status()&&0===e.chunks[e.chunks.length-1].preprocessState?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return!0;if(n.each(i.files,function(e){if(t=e.upload())return!1}),t)return!0;var e=!1;return n.each(i.files,function(t){if(!t.isComplete())return e=!0,!1}),e||i.fire("complete"),!1},i.assignBrowse=function(t,e){void 0===t.length&&(t=[t]),n.each(t,function(t){var n;"INPUT"===t.tagName&&"file"===t.type?n=t:((n=document.createElement("input")).setAttribute("type","file"),n.style.display="none",t.addEventListener("click",function(){n.style.opacity=0,n.style.display="block",n.focus(),n.click(),n.style.display="none"},!1),t.appendChild(n));var r=i.getOpt("maxFiles");void 0===r||1!=r?n.setAttribute("multiple","multiple"):n.removeAttribute("multiple"),e?n.setAttribute("webkitdirectory","webkitdirectory"):n.removeAttribute("webkitdirectory");var a=i.getOpt("fileType");void 0!==a&&a.length>=1?n.setAttribute("accept",a.map(function(t){return(t=t.replace(/\s/g,"").toLowerCase()).match(/^[^.][^/]+$/)&&(t="."+t),t}).join(",")):n.removeAttribute("accept"),n.addEventListener("change",function(t){c(t.target.files,t),i.getOpt("clearInput")&&(t.target.value="")},!1)})},i.assignDrop=function(t){void 0===t.length&&(t=[t]),n.each(t,function(t){t.addEventListener("dragover",s,!1),t.addEventListener("dragenter",s,!1),t.addEventListener("dragleave",a,!1),t.addEventListener("drop",r,!1)})},i.unAssignDrop=function(t){void 0===t.length&&(t=[t]),n.each(t,function(t){t.removeEventListener("dragover",s),t.removeEventListener("dragenter",s),t.removeEventListener("dragleave",a),t.removeEventListener("drop",r)})},i.isUploading=function(){var t=!1;return n.each(i.files,function(e){if(e.isUploading())return t=!0,!1}),t},i.upload=function(){if(!i.isUploading()){i.fire("uploadStart");for(var t=1;t<=i.getOpt("simultaneousUploads");t++)i.uploadNextChunk()}},i.pause=function(){n.each(i.files,function(t){t.abort()}),i.fire("pause")},i.cancel=function(){i.fire("beforeCancel");for(var t=i.files.length-1;t>=0;t--)i.files[t].cancel();i.fire("cancel")},i.progress=function(){var t=0,e=0;return n.each(i.files,function(i){t+=i.progress()*i.size,e+=i.size}),e>0?t/e:0},i.addFile=function(t,e){c([t],e)},i.addFiles=function(t,e){c(t,e)},i.removeFile=function(t){for(var e=i.files.length-1;e>=0;e--)i.files[e]===t&&i.files.splice(e,1)},i.getFromUniqueIdentifier=function(t){var e=!1;return n.each(i.files,function(i){i.uniqueIdentifier==t&&(e=i)}),e},i.getSize=function(){var t=0;return n.each(i.files,function(e){t+=e.size}),t},i.handleDropEvent=function(t){r(t)},i.handleChangeEvent=function(t){c(t.target.files,t),t.target.value=""},i.updateQuery=function(t){i.opts.query=t},this};"undefined"!=typeof module?(module.exports=t,module.exports.Resumable=t):"function"==typeof define&&define.amd?define(function(){return t}):window.Resumable=t}(),function(){var t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v2.2.8",t.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},t.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},t._UID=0,"undefined"!=typeof Float32Array?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array,t.Uint32Array=Uint32Array,t.ArrayBuffer=ArrayBuffer):(t.Float32Array=Array,t.Uint16Array=Array),t.INTERACTION_FREQUENCY=30,t.AUTO_PREVENT_DEFAULT=!0,t.PI_2=2*Math.PI,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RETINA_PREFIX="@2x",t.dontSayHello=!1,t.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},t.sayHello=function(e){if(!t.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+t.VERSION+" - "+e+"  %c  %c  http://www.pixijs.com/  %c %c %c%c ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+t.VERSION+" - http://www.pixijs.com/");t.dontSayHello=!0}},t.Point=function(t,e){this.x=t||0,this.y=e||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},t.Point.prototype.constructor=t.Point,t.Rectangle=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1},t.Rectangle.prototype.constructor=t.Rectangle,t.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),e[0]instanceof t.Point){for(var i=[],n=0,r=e.length;n<r;n++)i.push(e[n].x,e[n].y);e=i}this.closed=!0,this.points=e},t.Polygon.prototype.clone=function(){var e=this.points.slice();return new t.Polygon(e)},t.Polygon.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,r=0,a=n-1;r<n;a=r++){var s=this.points[2*r],o=this.points[2*r+1],l=this.points[2*a],h=this.points[2*a+1];o>e!=h>e&&t<(l-s)*(e-o)/(h-o)+s&&(i=!i)}return i},t.Polygon.prototype.constructor=t.Polygon,t.Circle=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0},t.Circle.prototype.clone=function(){return new t.Circle(this.x,this.y,this.radius)},t.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,n=this.y-e;return(i*=i)+(n*=n)<=this.radius*this.radius},t.Circle.prototype.getBounds=function(){return new t.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t.Circle.prototype.constructor=t.Circle,t.Ellipse=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},t.Ellipse.prototype.clone=function(){return new t.Ellipse(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return(i*=i)+(n*=n)<=1},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},t.Ellipse.prototype.constructor=t.Ellipse,t.RoundedRectangle=function(t,e,i,n,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.radius=r||20},t.RoundedRectangle.prototype.clone=function(){return new t.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},t.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1},t.RoundedRectangle.prototype.constructor=t.RoundedRectangle,t.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},t.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.Matrix.prototype.toArray=function(e){this.array||(this.array=new t.Float32Array(9));var i=this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},t.Matrix.prototype.apply=function(e,i){return(i=i||new t.Point).x=this.a*e.x+this.c*e.y+this.tx,i.y=this.b*e.x+this.d*e.y+this.ty,i},t.Matrix.prototype.applyInverse=function(e,i){i=i||new t.Point;var n=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*n*e.x+-this.c*n*e.y+(this.ty*this.c-this.tx*this.d)*n,i.y=this.a*n*e.y+-this.b*n*e.x+(-this.ty*this.a+this.tx*this.b)*n,i},t.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,a=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this},t.Matrix.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},t.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.identityMatrix=new t.Matrix,t.DisplayObject=function(){this.position=new t.Point,this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new t.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],i=0;i<t.length;i++)for(var n=t[i].passes,r=0;r<n.length;r++)e.push(n[r]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),t.DisplayObject.prototype.updateTransform=function(){var e,i,n,r,a,s,o=this.parent.worldTransform,l=this.worldTransform;this.rotation%t.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,i=this._sr*this.scale.x,n=-this._sr*this.scale.y,r=this._cr*this.scale.y,a=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(a-=this.pivot.x*e+this.pivot.y*n,s-=this.pivot.x*i+this.pivot.y*r),l.a=e*o.a+i*o.c,l.b=e*o.b+i*o.d,l.c=n*o.a+r*o.c,l.d=n*o.b+r*o.d,l.tx=a*o.a+s*o.c+o.tx,l.ty=a*o.b+s*o.d+o.ty):(e=this.scale.x,r=this.scale.y,a=this.position.x-this.pivot.x*e,s=this.position.y-this.pivot.y*r,l.a=e*o.a,l.b=e*o.b,l.c=r*o.c,l.d=r*o.d,l.tx=a*o.a+s*o.c+o.tx,l.ty=a*o.b+s*o.d+o.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.DisplayObject.prototype.displayObjectUpdateTransform=t.DisplayObject.prototype.updateTransform,t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0)},t.DisplayObject.prototype.generateTexture=function(e,i,n){var r=this.getLocalBounds(),a=new t.RenderTexture(0|r.width,0|r.height,n,i,e);return t.DisplayObject._tempMatrix.tx=-r.x,t.DisplayObject._tempMatrix.ty=-r.y,a.render(this,t.DisplayObject._tempMatrix),a},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},t.DisplayObject.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|e.width,0|e.height);else{var i=new t.RenderTexture(0|e.width,0|e.height);this._cachedSprite=new t.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var n=this._filters;this._filters=null,this._cachedSprite.filters=n,t.DisplayObject._tempMatrix.tx=-e.x,t.DisplayObject._tempMatrix.ty=-e.y,this._cachedSprite.texture.render(this,t.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._filters=n,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},t.DisplayObject.prototype._renderWebGL=function(t){t=t},t.DisplayObject.prototype._renderCanvas=function(t){t=t},t.DisplayObject._tempMatrix=new t.Matrix,Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),t.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(i<0||n<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},t.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},t.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},t.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},t.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},t.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},t.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,n="number"==typeof e?e:this.children.length,r=n-i;if(r>0&&r<=n){for(var a=this.children.splice(i,r),s=0;s<a.length;s++){var o=a[s];this.stage&&o.removeStageReference(),o.parent=void 0}return a}if(0===r&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},t.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=t.DisplayObjectContainer.prototype.updateTransform,t.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return t.EmptyRectangle;for(var e,i,n,r=1/0,a=1/0,s=-1/0,o=-1/0,l=!1,h=0,c=this.children.length;h<c;h++){this.children[h].visible&&(l=!0,r=r<(e=this.children[h].getBounds()).x?r:e.x,a=a<e.y?a:e.y,s=s>(i=e.width+e.x)?s:i,o=o>(n=e.height+e.y)?o:n)}if(!l)return t.EmptyRectangle;var u=this._bounds;return u.x=r,u.y=a,u.width=s-r,u.height=o-a,u},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var i=0,n=this.children.length;i<n;i++)this.children[i].updateTransform();var r=this.getBounds();return this.worldTransform=e,r},t.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0);for(var e=0,i=this.children.length;e<i;e++){this.children[e].setStageReference(t)}},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;t<e;t++){this.children[t].removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t)},t.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;e<i;e++){this.children[e]._renderCanvas(t)}this._mask&&t.maskManager.popMask(t)}},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e||t.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),t.Sprite.prototype.setTexture=function(t){this.texture=t,this.cachedTint=16777215},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,a=i*(1-this.anchor.y),s=i*-this.anchor.y,o=t||this.worldTransform,l=o.a,h=o.b,c=o.c,u=o.d,d=o.tx,f=o.ty,g=-1/0,p=-1/0,m=1/0,v=1/0;if(0===h&&0===c)l<0&&(l*=-1),u<0&&(u*=-1),m=l*r+d,g=l*n+d,v=u*s+f,p=u*a+f;else{var _=l*r+c*s+d,y=u*s+h*r+f,x=l*n+c*s+d,b=u*s+h*n+f,I=l*n+c*a+d,C=u*a+h*n+f,w=l*r+c*a+d,S=u*a+h*r+f;m=w<(m=I<(m=x<(m=_<m?_:m)?x:m)?I:m)?w:m,v=S<(v=C<(v=b<(v=y<v?y:v)?b:v)?C:v)?S:v,g=w>(g=I>(g=x>(g=_>g?_:g)?x:g)?I:g)?w:g,p=S>(p=C>(p=b>(p=y>p?y:p)?b:p)?C:p)?S:p}var M=this._bounds;return M.x=m,M.width=g-m,M.y=v,M.height=p-v,this._currentBounds=M,M},t.Sprite.prototype._renderWebGL=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){var n=t.spriteBatch;for(this._filters&&(n.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.stop(),t.maskManager.pushMask(this.mask,t),n.start()),n.render(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);n.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),n.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t)},t.Sprite.prototype._renderCanvas=function(e){if(!(!1===this.visible||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e),this.texture.valid){var i=this.texture.baseTexture.resolution/e.resolution;e.context.globalAlpha=this.worldAlpha,e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;e.roundPixels?(e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution|0,this.worldTransform.ty*e.resolution|0),n|=0,r|=0):e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution,this.worldTransform.ty*e.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,n/i,r/i,this.texture.crop.width/i,this.texture.crop.height/i)):e.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n/i,r/i,this.texture.crop.width/i,this.texture.crop.height/i)}for(var a=0,s=this.children.length;a<s;a++)this.children[a]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Sprite.fromFrame=function(e){var i=t.TextureCache[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(i)},t.Sprite.fromImage=function(e,i,n){var r=t.Texture.fromImage(e,i,n);return new t.Sprite(r)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},t.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},t.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,n=!0,r=0;r<this.children.length;r++){var a=this.children[r];if(a.visible){var s=a.texture,o=s.frame;if(e.globalAlpha=this.worldAlpha*a.alpha,a.rotation%(2*Math.PI)==0)n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),e.drawImage(s.baseTexture.source,o.x,o.y,o.width,o.height,a.anchor.x*(-o.width*a.scale.x)+a.position.x+.5|0,a.anchor.y*(-o.height*a.scale.y)+a.position.y+.5|0,o.width*a.scale.x,o.height*a.scale.y);else{n||(n=!0),a.displayObjectUpdateTransform();var l=a.worldTransform;t.roundPixels?e.setTransform(l.a,l.b,l.c,l.d,0|l.tx,0|l.ty):e.setTransform(l.a,l.b,l.c,l.d,l.tx,l.ty),e.drawImage(s.baseTexture.source,o.x,o.y,o.width,o.height,a.anchor.x*-o.width+.5|0,a.anchor.y*-o.height+.5|0,o.width,o.height)}}}}},t.MovieClip=function(e){t.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},t.MovieClip.prototype=Object.create(t.Sprite.prototype),t.MovieClip.prototype.constructor=t.MovieClip,Object.defineProperty(t.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),t.MovieClip.prototype.stop=function(){this.playing=!1},t.MovieClip.prototype.play=function(){this.playing=!0},t.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])},t.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},t.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},t.MovieClip.fromFrames=function(e){for(var i=[],n=0;n<e.length;n++)i.push(new t.Texture.fromFrame(e[n]));return new t.MovieClip(i)},t.MovieClip.fromImages=function(e){for(var i=[],n=0;n<e.length;n++)i.push(new t.Texture.fromImage(e[n]));return new t.MovieClip(i)},t.FilterBlock=function(){this.visible=!0,this.renderable=!0},t.FilterBlock.prototype.constructor=t.FilterBlock,t.Text=function(e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(i)},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),t.Text.prototype.setStyle=function(t){(t=t||{}).font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black",t.lineJoin=t.lineJoin||"miter",this.style=t,this.dirty=!0},t.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,r=this.determineFontProperties(this.style.font),a=0;a<e.length;a++){var s=this.context.measureText(e[a]).width;i[a]=s,n=Math.max(n,s)}var o=n+this.style.strokeThickness;this.style.dropShadow&&(o+=this.style.dropShadowDistance),this.canvas.width=(o+this.context.lineWidth)*this.resolution;var l,h,c=r.fontSize+this.style.strokeThickness,u=c*e.length;if(this.style.dropShadow&&(u+=this.style.dropShadowDistance),this.canvas.height=u*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin=this.style.lineJoin,this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,f=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(a=0;a<e.length;a++)l=this.style.strokeThickness/2,h=this.style.strokeThickness/2+a*c+r.ascent,"right"===this.style.align?l+=n-i[a]:"center"===this.style.align&&(l+=(n-i[a])/2),this.style.fill&&this.context.fillText(e[a],l+d,h+f)}for(this.context.fillStyle=this.style.fill,a=0;a<e.length;a++)l=this.style.strokeThickness/2,h=this.style.strokeThickness/2+a*c+r.ascent,"right"===this.style.align?l+=n-i[a]:"center"===this.style.align&&(l+=(n-i[a])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[a],l,h),this.style.fill&&this.context.fillText(e[a],l,h);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},t.Text.prototype._renderWebGL=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype._renderCanvas=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderCanvas.call(this,e)},t.Text.prototype.determineFontProperties=function(e){var i=t.Text.fontPropertiesCache[e];if(!i){i={};var n=t.Text.fontPropertiesCanvas,r=t.Text.fontPropertiesContext;r.font=e;var a=Math.ceil(r.measureText("|Mq").width),s=Math.ceil(r.measureText("M").width),o=2*s;s=1.4*s|0,n.width=a,n.height=o,r.fillStyle="#f00",r.fillRect(0,0,a,o),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|Mq",0,s);var l,h,c=r.getImageData(0,0,a,o).data,u=c.length,d=4*a,f=0,g=!1;for(l=0;l<s;l++){for(h=0;h<d;h+=4)if(255!==c[f+h]){g=!0;break}if(g)break;f+=d}for(i.ascent=s-l,f=u-d,g=!1,l=o;l>s;l--){for(h=0;h<d;h+=4)if(255!==c[f+h]){g=!0;break}if(g)break;f-=d}i.descent=l-s,i.descent+=6,i.fontSize=i.ascent+i.descent,t.Text.fontPropertiesCache[e]=i}return i},t.Text.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var r=this.style.wordWrapWidth,a=i[n].split(" "),s=0;s<a.length;s++){var o=this.context.measureText(a[s]).width,l=o+this.context.measureText(" ").width;0===s||l>r?(s>0&&(e+="\n"),e+=a[s],r=this.style.wordWrapWidth-o):(r-=l,e+=" "+a[s])}n<i.length-1&&(e+="\n")}return e},t.Text.prototype.getBounds=function(e){return this.dirty&&(this.updateText(),this.dirty=!1),t.Sprite.prototype.getBounds.call(this,e)},t.Text.prototype.destroy=function(t){this.context=null,this.canvas=null,this.texture.destroy(void 0===t||t)},t.Text.fontPropertiesCache={},t.Text.fontPropertiesCanvas=document.createElement("canvas"),t.Text.fontPropertiesContext=t.Text.fontPropertiesCanvas.getContext("2d"),t.BitmapText=function(e,i){t.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(e),this.setStyle(i),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){(e=e||{}).align=e.align||"left",this.style=e;var i=e.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){for(var e=t.BitmapText.fonts[this.fontName],i=new t.Point,n=null,r=[],a=0,s=[],o=0,l=this.fontSize/e.size,h=0;h<this.text.length;h++){var c=this.text.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(h)))s.push(i.x),a=Math.max(a,i.x),o++,i.x=0,i.y+=e.lineHeight,n=null;else{var u=e.chars[c];u&&(n&&u.kerning[n]&&(i.x+=u.kerning[n]),r.push({texture:u.texture,line:o,charCode:c,position:new t.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,n=c)}}s.push(i.x),a=Math.max(a,i.x);var d=[];for(h=0;h<=o;h++){var f=0;"right"===this.style.align?f=a-s[h]:"center"===this.style.align&&(f=(a-s[h])/2),d.push(f)}var g=this.children.length,p=r.length,m=this.tint||16777215;for(h=0;h<p;h++){var v=h<g?this.children[h]:this._pool.pop();v?v.setTexture(r[h].texture):v=new t.Sprite(r[h].texture),v.position.x=(r[h].position.x+d[r[h].line])*l,v.position.y=r[h].position.y*l,v.scale.x=v.scale.y=l,v.tint=m,v.parent||this.addChild(v)}for(;this.children.length>p;){var _=this.getChildAt(this.children.length-1);this._pool.push(_),this.removeChild(_)}this.textWidth=a*l,this.textHeight=(i.y+e.lineHeight)*l},t.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.InteractionData=function(){this.global=new t.Point,this.target=null,this.originalEvent=null},t.InteractionData.prototype.getLocalPosition=function(e,i,n){var r=e.worldTransform,a=n||this.global,s=r.a,o=r.c,l=r.tx,h=r.b,c=r.d,u=r.ty,d=1/(s*c+o*-h);return(i=i||new t.Point).x=c*d*a.x+-o*d*a.y+(u*o-l*c)*d,i.y=s*d*a.y+-h*d*a.x+(-u*s+l*h)*d,i},t.InteractionData.prototype.constructor=t.InteractionData,t.InteractionManager=function(e){this.stage=e,this.mouse=new t.InteractionData,this.touches={},this.tempPoint=new t.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new t.Point},t.InteractionManager.prototype.constructor=t.InteractionManager,t.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,n=i.length-1;n>=0;n--){var r=i[n];r._interactive?(e.interactiveChildren=!0,this.interactiveItems.push(r),r.children.length>0&&this.collectInteractiveSprite(r,r)):(r.__iParent=null,r.children.length>0&&this.collectInteractiveSprite(r,e))}},t.InteractionManager.prototype.setTarget=function(t){this.target=t,this.resolution=t.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(t.view)},t.InteractionManager.prototype.setTargetDomElement=function(t){this.removeEvents(),window.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none"),this.interactionDOMElement=t,t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseout",this.onMouseOut,!0),t.addEventListener("touchstart",this.onTouchStart,!0),t.addEventListener("touchend",this.onTouchEnd,!0),t.addEventListener("touchleave",this.onTouchCancel,!0),t.addEventListener("touchcancel",this.onTouchCancel,!0),t.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},t.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchleave",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},t.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),i=e-this.last;if(!((i=i*t.INTERACTION_FREQUENCY/1e3)<1)){this.last=e;var n=0;this.dirty&&this.rebuildInteractiveGraph();var r=this.interactiveItems.length,a="inherit",s=!1;for(n=0;n<r;n++){var o=this.interactiveItems[n];o.__hit=this.hitTest(o,this.mouse),this.mouse.target=o,o.__hit&&!s?(o.buttonMode&&(a=o.defaultCursor),o.interactiveChildren||(s=!0),o.__isOver||(o.mouseover&&o.mouseover(this.mouse),o.__isOver=!0)):o.__isOver&&(o.mouseout&&o.mouseout(this.mouse),o.__isOver=!1)}this.currentCursorStyle!==a&&(this.currentCursorStyle=a,this.interactionDOMElement.style.cursor=a)}}},t.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,e=0;e<t;e++)this.interactiveItems[e].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},t.InteractionManager.prototype.onMouseMove=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width)/this.resolution,this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height)/this.resolution;for(var i=this.interactiveItems.length,n=0;n<i;n++){var r=this.interactiveItems[n];r.mousemove&&r.mousemove(this.mouse)}},t.InteractionManager.prototype.onMouseDown=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e,t.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var i=this.interactiveItems.length,n=this.mouse.originalEvent,r=2===n.button||3===n.which,a=r?"rightdown":"mousedown",s=r?"rightclick":"click",o=r?"__rightIsDown":"__mouseIsDown",l=r?"__isRightDown":"__isDown",h=0;h<i;h++){var c=this.interactiveItems[h];if((c[a]||c[s])&&(c[o]=!0,c.__hit=this.hitTest(c,this.mouse),c.__hit&&(c[a]&&c[a](this.mouse),c[l]=!0,!c.interactiveChildren)))break}},t.InteractionManager.prototype.onMouseOut=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var i=0;i<e;i++){var n=this.interactiveItems[i];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},t.InteractionManager.prototype.onMouseUp=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;for(var e=this.interactiveItems.length,i=!1,n=this.mouse.originalEvent,r=2===n.button||3===n.which,a=r?"rightup":"mouseup",s=r?"rightclick":"click",o=r?"rightupoutside":"mouseupoutside",l=r?"__isRightDown":"__isDown",h=0;h<e;h++){var c=this.interactiveItems[h];(c[s]||c[a]||c[o])&&(c.__hit=this.hitTest(c,this.mouse),c.__hit&&!i?(c[a]&&c[a](this.mouse),c[l]&&c[s]&&c[s](this.mouse),c.interactiveChildren||(i=!0)):c[l]&&c[o]&&c[o](this.mouse),c[l]=!1)}},t.InteractionManager.prototype.hitTest=function(e,i){var n=i.global;if(!e.worldVisible)return!1;e.worldTransform.applyInverse(n,this._tempPoint);var r,a=this._tempPoint.x,s=this._tempPoint.y;if(i.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(a,s);if(e instanceof t.Sprite){var o,l=e.texture.frame.width,h=e.texture.frame.height,c=-l*e.anchor.x;if(a>c&&a<c+l&&s>(o=-h*e.anchor.y)&&s<o+h)return!0}else if(e instanceof t.Graphics){var u=e.graphicsData;for(r=0;r<u.length;r++){var d=u[r];if(d.fill&&(d.shape&&d.shape.contains(a,s)))return!0}}var f=e.children.length;for(r=0;r<f;r++){var g=e.children[r];if(this.hitTest(g,i))return i.target=e,!0}return!1},t.InteractionManager.prototype.onTouchMove=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i,n=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,a=r.length,s=this.target.width/n.width,o=this.target.height/n.height,l=navigator.isCocoonJS&&!n.left&&!n.top&&!t.target.style.width&&!t.target.style.height,h=0;h<a;h++)i=r[h],l?(i.globalX=i.clientX,i.globalY=i.clientY):(i.globalX=(i.clientX-n.left)*s/this.resolution,i.globalY=(i.clientY-n.top)*o/this.resolution);for(var c=0;c<a;c++){i=r[c],(e=this.touches[i.identifier]).originalEvent=t,l?(e.global.x=i.clientX,e.global.y=i.clientY):(i.globalX=e.global.x=(i.clientX-n.left)*s/this.resolution,i.globalY=e.global.y=(i.clientY-n.top)*o/this.resolution);for(var u=0;u<this.interactiveItems.length;u++){var d=this.interactiveItems[u];d.touchmove&&d.__touchData&&d.__touchData[i.identifier]&&d.touchmove(e)}}},t.InteractionManager.prototype.onTouchStart=function(e){this.dirty&&this.rebuildInteractiveGraph();var i=this.interactionDOMElement.getBoundingClientRect();t.AUTO_PREVENT_DEFAULT&&e.preventDefault();for(var n,r=e.changedTouches,a=r.length,s=this.target.width/i.width,o=this.target.height/i.height,l=navigator.isCocoonJS&&!i.left&&!i.top&&!e.target.style.width&&!e.target.style.height,h=0;h<a;h++)n=r[h],l?(n.globalX=n.clientX,n.globalY=n.clientY):(n.globalX=(n.clientX-i.left)*s/this.resolution,n.globalY=(n.clientY-i.top)*o/this.resolution);for(var c=0;c<a;c++){n=r[c];var u=this.pool.pop();u||(u=new t.InteractionData),u.originalEvent=e,this.touches[n.identifier]=u,l?(u.global.x=n.clientX,u.global.y=n.clientY):(u.global.x=(n.clientX-i.left)*s/this.resolution,u.global.y=(n.clientY-i.top)*o/this.resolution);for(var d=this.interactiveItems.length,f=0;f<d;f++){var g=this.interactiveItems[f];if((g.touchstart||g.tap)&&(g.__hit=this.hitTest(g,u),g.__hit&&(g.touchstart&&g.touchstart(u),g.__isDown=!0,g.__touchData=g.__touchData||{},g.__touchData[n.identifier]=u,!g.interactiveChildren)))break}}},t.InteractionManager.prototype.onTouchEnd=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=n.length,a=this.target.width/i.width,s=this.target.height/i.height,o=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,l=0;l<r;l++)e=n[l],o?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-i.left)*a/this.resolution,e.globalY=(e.clientY-i.top)*s/this.resolution);for(var h=0;h<r;h++){e=n[h];var c=this.touches[e.identifier],u=!1;o?(c.global.x=e.clientX,c.global.y=e.clientY):(c.global.x=(e.clientX-i.left)*a/this.resolution,c.global.y=(e.clientY-i.top)*s/this.resolution);for(var d=this.interactiveItems.length,f=0;f<d;f++){var g=this.interactiveItems[f];g.__touchData&&g.__touchData[e.identifier]&&(g.__hit=this.hitTest(g,g.__touchData[e.identifier]),c.originalEvent=t,(g.touchend||g.tap)&&(g.__hit&&!u?(g.touchend&&g.touchend(c),g.__isDown&&g.tap&&g.tap(c),g.interactiveChildren||(u=!0)):g.__isDown&&g.touchendoutside&&g.touchendoutside(c),g.__isDown=!1),g.__touchData[e.identifier]=null)}this.pool.push(c),this.touches[e.identifier]=null}},t.InteractionManager.prototype.onTouchCancel=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=n.length,a=this.target.width/i.width,s=this.target.height/i.height,o=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,l=0;l<r;l++)e=n[l],o?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-i.left)*a/this.resolution,e.globalY=(e.clientY-i.top)*s/this.resolution);for(var h=0;h<r;h++){e=n[h];var c=this.touches[e.identifier],u=!1;o?(c.global.x=e.clientX,c.global.y=e.clientY):(c.global.x=(e.clientX-i.left)*a/this.resolution,c.global.y=(e.clientY-i.top)*s/this.resolution);for(var d=this.interactiveItems.length,f=0;f<d;f++){var g=this.interactiveItems[f];g.__touchData&&g.__touchData[e.identifier]&&(g.__hit=this.hitTest(g,g.__touchData[e.identifier]),c.originalEvent=t,g.touchcancel&&!u&&(g.touchcancel(c),g.interactiveChildren||(u=!0)),g.__isDown=!1,g.__touchData[e.identifier]=null)}this.pool.push(c),this.touches[e.identifier]=null}},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.interactive=!0,this.interactionManager=new t.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(t){for(var e=0,i=["ms","moz","webkit","o"],n=0;n<i.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[i[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[n]+"CancelAnimationFrame"]||t[i[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),a=t.setTimeout(function(){i(n+r)},r);return e=n+r,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),t.requestAnimFrame=t.requestAnimationFrame}(this),t.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},t.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(t){var e=this,i=arguments.length-1,n=[];if(i>0)for(n.length=i;i--;)n[i]=arguments[i+1];if("function"!=typeof e)throw new TypeError;function r(){for(var i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return a=n.concat(a),e.apply(this instanceof r?this:t,a)}return r.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(e.prototype),r}),t.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return!!window.XMLHttpRequest&&new window.XMLHttpRequest;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(t){}},t.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),0===e.getImageData(0,0,1,1).data[0]},t.getNextPowerOfTwo=function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},t.isPowerOfTwo=function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},t.EventTarget={call:function(e){e&&(e=e.prototype||e,t.EventTarget.mixin(e))},mixin:function(e){e.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},e.emit=e.dispatchEvent=function(e,i){if(this._listeners=this._listeners||{},"object"==typeof e&&(i=e,e=e.type),i&&!0===i.__isEventObject||(i=new t.Event(this,e,i)),this._listeners&&this._listeners[e]){var n,r=this._listeners[e].slice(0),a=r.length,s=r[0];for(n=0;n<a;s=r[++n])if(s.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,e,i),this},e.on=e.addEventListener=function(t,e){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(e),this},e.once=function(t,e){this._listeners=this._listeners||{};var i=this;function n(){e.apply(i.off(t,n),arguments)}return n._originalHandler=e,this.on(t,n)},e.off=e.removeEventListener=function(t,e){if(this._listeners=this._listeners||{},!this._listeners[t])return this;for(var i=this._listeners[t],n=e?i.length:0;n-- >0;)i[n]!==e&&i[n]._originalHandler!==e||i.splice(n,1);return 0===i.length&&delete this._listeners[t],this},e.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},t.Event=function(t,e,i){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=t,this.type=e,this.data=i,this.content=i,this.timeStamp=Date.now()},t.Event.prototype.stopPropagation=function(){this.stopped=!0},t.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},t.autoDetectRenderer=function(e,i,n){return e||(e=800),i||(i=600),function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}()?new t.WebGLRenderer(e,i,n):new t.CanvasRenderer(e,i,n)},t.autoDetectRecommendedRenderer=function(e,i,n){e||(e=800),i||(i=600);var r=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),a=/Android/i.test(navigator.userAgent);return r&&!a?new t.WebGLRenderer(e,i,n):new t.CanvasRenderer(e,i,n)},t.PolyK={},t.PolyK.Triangulate=function(e){var i=!0,n=e.length>>1;if(n<3)return[];for(var r=[],a=[],s=0;s<n;s++)a.push(s);s=0;for(var o=n;o>3;){var l=a[(s+0)%o],h=a[(s+1)%o],c=a[(s+2)%o],u=e[2*l],d=e[2*l+1],f=e[2*h],g=e[2*h+1],p=e[2*c],m=e[2*c+1],v=!1;if(t.PolyK._convex(u,d,f,g,p,m,i)){v=!0;for(var _=0;_<o;_++){var y=a[_];if(y!==l&&y!==h&&y!==c&&t.PolyK._PointInTriangle(e[2*y],e[2*y+1],u,d,f,g,p,m)){v=!1;break}}}if(v)r.push(l,h,c),a.splice((s+1)%o,1),o--,s=0;else if(s++>3*o){if(!i)return null;for(r=[],a=[],s=0;s<n;s++)a.push(s);s=0,o=n,i=!1}}return r.push(a[0],a[1],a[2]),r},t.PolyK._PointInTriangle=function(t,e,i,n,r,a,s,o){var l=s-i,h=o-n,c=r-i,u=a-n,d=t-i,f=e-n,g=l*l+h*h,p=l*c+h*u,m=l*d+h*f,v=c*c+u*u,_=c*d+u*f,y=1/(g*v-p*p),x=(v*m-p*_)*y,b=(g*_-p*m)*y;return x>=0&&b>=0&&x+b<1},t.PolyK._convex=function(t,e,i,n,r,a,s){return(e-n)*(r-i)+(i-t)*(a-n)>=0===s},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,i){return t._CompileShader(e,i,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,i){return t._CompileShader(e,i,e.FRAGMENT_SHADER)},t._CompileShader=function(t,e,i){var n=e.join("\n"),r=t.createShader(i);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(window.console.log(t.getShaderInfoLog(r)),null)},t.compileProgram=function(e,i,n){var r=t.CompileFragmentShader(e,n),a=t.CompileVertexShader(e,i),s=e.createProgram();return e.attachShader(s,a),e.attachShader(s,r),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),s},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},t.PixiShader.prototype.constructor=t.PixiShader,t.PixiShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);for(var n in e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[n].uniformLocation=e.getUniformLocation(i,n);this.initUniforms(),this.program=i},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){var n=(t=this.uniforms[i]).type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=e.uniformMatrix2fv:"mat3"===n?t.glFunc=e.uniformMatrix3fv:"mat4"===n&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)}},t.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,n=i.magFilter?i.magFilter:e.LINEAR,r=i.minFilter?i.minFilter:e.LINEAR,a=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,s=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,o=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(a=e.REPEAT,s=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var l=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,o,l,h,c,o,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){var e;this.textureCount=1;var i=this.gl;for(var n in this.uniforms)1===(e=this.uniforms[n]).glValueLength?!0===e.glMatrix?e.glFunc.call(i,e.uniformLocation,e.transpose,e.value):e.glFunc.call(i,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty.length<=i.id||e.value.baseTexture._dirty[i.id]?t.instances[i.id].updateTexture(e.value.baseTexture):i.bindTexture(i.TEXTURE_2D,e.value.baseTexture._glTextures[i.id]),i.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.constructor=t.PixiFastShader,t.PixiFastShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.uMatrix=e.getUniformLocation(i,"uMatrix"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(i,"aPositionCoord"),this.aScale=e.getAttribLocation(i,"aScale"),this.aRotation=e.getAttribLocation(i,"aRotation"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.constructor=t.StripShader,t.StripShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.colorAttribute=e.getAttribLocation(i,"aColor"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.constructor=t.PrimitiveShader,t.PrimitiveShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.tintColor=e.getUniformLocation(i,"tint"),this.flipY=e.getUniformLocation(i,"flipY"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.constructor=t.ComplexPrimitiveShader,t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.tintColor=e.getUniformLocation(i,"tint"),this.color=e.getUniformLocation(i,"color"),this.flipY=e.getUniformLocation(i,"flipY"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,i){var n,r=i.gl,a=i.projection,s=i.offset,o=i.shaderManager.primitiveShader;e.dirty&&t.WebGLGraphics.updateGraphics(e,r);for(var l=e._webGL[r.id],h=0;h<l.data.length;h++)1===l.data[h].mode?(n=l.data[h],i.stencilManager.pushStencil(e,n,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(n.indices.length-4)),i.stencilManager.popStencil(e,n,i)):(n=l.data[h],i.shaderManager.setShader(o),o=i.shaderManager.primitiveShader,r.uniformMatrix3fv(o.translationMatrix,!1,e.worldTransform.toArray(!0)),r.uniform1f(o.flipY,1),r.uniform2f(o.projectionVector,a.x,-a.y),r.uniform2f(o.offsetVector,-s.x,-s.y),r.uniform3fv(o.tintColor,t.hex2rgb(e.tint)),r.uniform1f(o.alpha,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,n.buffer),r.vertexAttribPointer(o.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(o.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,n.indices.length,r.UNSIGNED_SHORT,0))},t.WebGLGraphics.updateGraphics=function(e,i){var n,r,a=e._webGL[i.id];if(a||(a=e._webGL[i.id]={lastIndex:0,data:[],gl:i}),e.dirty=!1,e.clearDirty){for(e.clearDirty=!1,n=0;n<a.data.length;n++){var s=a.data[n];s.reset(),t.WebGLGraphics.graphicsDataPool.push(s)}a.data=[],a.lastIndex=0}for(n=a.lastIndex;n<e.graphicsData.length;n++){var o=e.graphicsData[n];if(o.type===t.Graphics.POLY){if(o.points=o.shape.points.slice(),o.shape.closed&&(o.points[0]===o.points[o.points.length-2]&&o.points[1]===o.points[o.points.length-1]||o.points.push(o.points[0],o.points[1])),o.fill)if(o.points.length>=6)if(o.points.length<12)r=t.WebGLGraphics.switchMode(a,0),t.WebGLGraphics.buildPoly(o,r)||(r=t.WebGLGraphics.switchMode(a,1),t.WebGLGraphics.buildComplexPoly(o,r));else r=t.WebGLGraphics.switchMode(a,1),t.WebGLGraphics.buildComplexPoly(o,r);o.lineWidth>0&&(r=t.WebGLGraphics.switchMode(a,0),t.WebGLGraphics.buildLine(o,r))}else r=t.WebGLGraphics.switchMode(a,0),o.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(o,r):o.type===t.Graphics.CIRC||o.type===t.Graphics.ELIP?t.WebGLGraphics.buildCircle(o,r):o.type===t.Graphics.RREC&&t.WebGLGraphics.buildRoundedRectangle(o,r);a.lastIndex++}for(n=0;n<a.data.length;n++)(r=a.data[n]).dirty&&r.upload()},t.WebGLGraphics.switchMode=function(e,i){var n;return e.data.length&&(n=e.data[e.data.length-1]).mode===i&&1!==i||((n=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl)).mode=i,e.data.push(n)),n.dirty=!0,n},t.WebGLGraphics.buildRectangle=function(e,i){var n=e.shape,r=n.x,a=n.y,s=n.width,o=n.height;if(e.fill){var l=t.hex2rgb(e.fillColor),h=e.fillAlpha,c=l[0]*h,u=l[1]*h,d=l[2]*h,f=i.points,g=i.indices,p=f.length/6;f.push(r,a),f.push(c,u,d,h),f.push(r+s,a),f.push(c,u,d,h),f.push(r,a+o),f.push(c,u,d,h),f.push(r+s,a+o),f.push(c,u,d,h),g.push(p,p,p+1,p+2,p+3,p+3)}if(e.lineWidth){var m=e.points;e.points=[r,a,r+s,a,r+s,a+o,r,a+o,r,a],t.WebGLGraphics.buildLine(e,i),e.points=m}},t.WebGLGraphics.buildRoundedRectangle=function(e,i){var n=e.shape,r=n.x,a=n.y,s=n.width,o=n.height,l=n.radius,h=[];if(h.push(r,a+l),h=(h=(h=(h=h.concat(t.WebGLGraphics.quadraticBezierCurve(r,a+o-l,r,a+o,r+l,a+o))).concat(t.WebGLGraphics.quadraticBezierCurve(r+s-l,a+o,r+s,a+o,r+s,a+o-l))).concat(t.WebGLGraphics.quadraticBezierCurve(r+s,a+l,r+s,a,r+s-l,a))).concat(t.WebGLGraphics.quadraticBezierCurve(r+l,a,r,a,r,a+l)),e.fill){var c=t.hex2rgb(e.fillColor),u=e.fillAlpha,d=c[0]*u,f=c[1]*u,g=c[2]*u,p=i.points,m=i.indices,v=p.length/6,_=t.PolyK.Triangulate(h),y=0;for(y=0;y<_.length;y+=3)m.push(_[y]+v),m.push(_[y]+v),m.push(_[y+1]+v),m.push(_[y+2]+v),m.push(_[y+2]+v);for(y=0;y<h.length;y++)p.push(h[y],h[++y],d,f,g,u)}if(e.lineWidth){var x=e.points;e.points=h,t.WebGLGraphics.buildLine(e,i),e.points=x}},t.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,r,a){var s,o,l,h,c,u,d=[];function f(t,e,i){return t+(e-t)*i}for(var g=0,p=0;p<=20;p++)s=f(t,i,g=p/20),o=f(e,n,g),l=f(i,r,g),h=f(n,a,g),c=f(s,l,g),u=f(o,h,g),d.push(c,u);return d},t.WebGLGraphics.buildCircle=function(e,i){var n,r,a=e.shape,s=a.x,o=a.y;e.type===t.Graphics.CIRC?(n=a.radius,r=a.radius):(n=a.width,r=a.height);var l=2*Math.PI/40,h=0;if(e.fill){var c=t.hex2rgb(e.fillColor),u=e.fillAlpha,d=c[0]*u,f=c[1]*u,g=c[2]*u,p=i.points,m=i.indices,v=p.length/6;for(m.push(v),h=0;h<41;h++)p.push(s,o,d,f,g,u),p.push(s+Math.sin(l*h)*n,o+Math.cos(l*h)*r,d,f,g,u),m.push(v++,v++);m.push(v-1)}if(e.lineWidth){var _=e.points;for(e.points=[],h=0;h<41;h++)e.points.push(s+Math.sin(l*h)*n,o+Math.cos(l*h)*r);t.WebGLGraphics.buildLine(e,i),e.points=_}},t.WebGLGraphics.buildLine=function(e,i){var n=0,r=e.points;if(0!==r.length){if(e.lineWidth%2)for(n=0;n<r.length;n++)r[n]+=.5;var a=new t.Point(r[0],r[1]),s=new t.Point(r[r.length-2],r[r.length-1]);if(a.x===s.x&&a.y===s.y){(r=r.slice()).pop(),r.pop();var o=(s=new t.Point(r[r.length-2],r[r.length-1])).x+.5*(a.x-s.x),l=s.y+.5*(a.y-s.y);r.unshift(o,l),r.push(o,l)}var h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S,M,A,T,k,D,P=i.points,E=i.indices,z=r.length/2,O=r.length,B=P.length/6,R=e.lineWidth/2,L=t.hex2rgb(e.lineColor),F=e.lineAlpha,G=L[0]*F,N=L[1]*F,U=L[2]*F;for(u=r[0],d=r[1],f=r[2],v=-(d-(g=r[3])),_=u-f,v/=D=Math.sqrt(v*v+_*_),_/=D,v*=R,_*=R,P.push(u-v,d-_,G,N,U,F),P.push(u+v,d+_,G,N,U,F),n=1;n<z-1;n++)u=r[2*(n-1)],d=r[2*(n-1)+1],f=r[2*n],g=r[2*n+1],p=r[2*(n+1)],m=r[2*(n+1)+1],v=-(d-g),_=u-f,v/=D=Math.sqrt(v*v+_*_),_/=D,v*=R,_*=R,y=-(g-m),x=f-p,y/=D=Math.sqrt(y*y+x*x),x/=D,S=(-v+u)*(-_+g)-(-v+f)*(-_+d),T=(-(y*=R)+p)*(-(x*=R)+g)-(-y+f)*(-x+m),k=(C=-_+d-(-_+g))*(A=-y+f-(-y+p))-(M=-x+m-(-x+g))*(w=-v+f-(-v+u)),Math.abs(k)<.1?(k+=10.1,P.push(f-v,g-_,G,N,U,F),P.push(f+v,g+_,G,N,U,F)):((h=(w*T-A*S)/k)-f)*(h-f)+((c=(M*S-C*T)/k)-g)+(c-g)>19600?(b=v-y,I=_-x,b/=D=Math.sqrt(b*b+I*I),I/=D,b*=R,I*=R,P.push(f-b,g-I),P.push(G,N,U,F),P.push(f+b,g+I),P.push(G,N,U,F),P.push(f-b,g-I),P.push(G,N,U,F),O++):(P.push(h,c),P.push(G,N,U,F),P.push(f-(h-f),g-(c-g)),P.push(G,N,U,F));for(u=r[2*(z-2)],d=r[2*(z-2)+1],f=r[2*(z-1)],v=-(d-(g=r[2*(z-1)+1])),_=u-f,v/=D=Math.sqrt(v*v+_*_),_/=D,v*=R,_*=R,P.push(f-v,g-_),P.push(G,N,U,F),P.push(f+v,g+_),P.push(G,N,U,F),E.push(B),n=0;n<O;n++)E.push(B++);E.push(B-1)}},t.WebGLGraphics.buildComplexPoly=function(e,i){var n=e.points.slice();if(!(n.length<6)){var r=i.indices;i.points=n,i.alpha=e.fillAlpha,i.color=t.hex2rgb(e.fillColor);for(var a,s,o=1/0,l=-1/0,h=1/0,c=-1/0,u=0;u<n.length;u+=2)o=(a=n[u])<o?a:o,l=a>l?a:l,h=(s=n[u+1])<h?s:h,c=s>c?s:c;n.push(o,h,l,h,l,c,o,c);var d=n.length/2;for(u=0;u<d;u++)r.push(u)}},t.WebGLGraphics.buildPoly=function(e,i){var n=e.points;if(!(n.length<6)){var r=i.points,a=i.indices,s=n.length/2,o=t.hex2rgb(e.fillColor),l=e.fillAlpha,h=o[0]*l,c=o[1]*l,u=o[2]*l,d=t.PolyK.Triangulate(n);if(!d)return!1;var f=r.length/6,g=0;for(g=0;g<d.length;g+=3)a.push(d[g]+f),a.push(d[g]+f),a.push(d[g+1]+f),a.push(d[g+2]+f),a.push(d[g+2]+f);for(g=0;g<s;g++)r.push(n[2*g],n[2*g+1],h,c,u,l);return!0}},t.WebGLGraphics.graphicsDataPool=[],t.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},t.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},t.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new t.Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new t.Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},t.glContexts=[],t.instances=[],t.WebGLRenderer=function(e,i,n){if(n)for(var r in t.defaultRenderOptions)void 0===n[r]&&(n[r]=t.defaultRenderOptions[r]);else n=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("webGL"),t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.resolution=n.resolution,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this.width=e||800,this.height=i||600,this.view=n.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},this.projection=new t.Point,this.offset=new t.Point(0,0),this.shaderManager=new t.WebGLShaderManager,this.spriteBatch=new t.WebGLSpriteBatch,this.maskManager=new t.WebGLMaskManager,this.filterManager=new t.WebGLFilterManager,this.stencilManager=new t.WebGLStencilManager,this.blendModeManager=new t.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.initContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=e,!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=e.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=e,t.instances[this.glContextId]=this,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.shaderManager.setContext(e),this.spriteBatch.setContext(e),this.maskManager.setContext(e),this.filterManager.setContext(e),this.blendModeManager.setContext(e),this.stencilManager.setContext(e),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},t.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},t.WebGLRenderer.prototype.renderDisplayObject=function(e,i,n){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=n?-1:1,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,n),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},t.WebGLRenderer.prototype.updateTexture=function(e){if(e.hasLoaded){var i=this.gl;return e._glTextures[i.id]||(e._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),e.mipmap&&t.isPowerOfTwo(e.width,e.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),e._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),e._dirty[i.id]=!1,e._glTextures[i.id]}},t.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){for(var e in this.initContext(),t.TextureCache){t.TextureCache[e].baseTexture._glTextures=[]}this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null,this.renderSession=null},t.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[e.SRC_ALPHA,e.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA])},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(){this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.constructor=t.WebGLBlendModeManager,t.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var i=t.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(){},t.WebGLMaskManager.prototype.constructor=t.WebGLMaskManager,t.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},t.WebGLMaskManager.prototype.pushMask=function(e,i){var n=i.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,n),e._webGL[n.id].data.length&&i.stencilManager.pushStencil(e,e._webGL[n.id].data[0],i)},t.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},t.WebGLMaskManager.prototype.destroy=function(){this.gl=null},t.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},t.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var r=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(r+1),255):n.stencilFunc(n.EQUAL,r+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r+1,255):n.stencilFunc(n.EQUAL,255-(r+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,i,n){this._currentGraphics=e;var r,a=this.gl,s=n.projection,o=n.offset;1===i.mode?(r=n.shaderManager.complexPrimitiveShader,n.shaderManager.setShader(r),a.uniform1f(r.flipY,n.flipY),a.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),a.uniform2f(r.projectionVector,s.x,-s.y),a.uniform2f(r.offsetVector,-o.x,-o.y),a.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),a.uniform3fv(r.color,i.color),a.uniform1f(r.alpha,e.worldAlpha*i.alpha),a.bindBuffer(a.ARRAY_BUFFER,i.buffer),a.vertexAttribPointer(r.aVertexPosition,2,a.FLOAT,!1,8,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(r=n.shaderManager.primitiveShader,n.shaderManager.setShader(r),a.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),a.uniform1f(r.flipY,n.flipY),a.uniform2f(r.projectionVector,s.x,-s.y),a.uniform2f(r.offsetVector,-o.x,-o.y),a.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),a.uniform1f(r.alpha,e.worldAlpha),a.bindBuffer(a.ARRAY_BUFFER,i.buffer),a.vertexAttribPointer(r.aVertexPosition,2,a.FLOAT,!1,24,0),a.vertexAttribPointer(r.colorAttribute,4,a.FLOAT,!1,24,8),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)n.disable(n.STENCIL_TEST);else{var r=this.count;this.bindGraphics(t,e,i),n.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)):(this.reverse?(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},t.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},t.WebGLShaderManager.prototype.constructor=t.WebGLShaderManager,t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimitiveShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},t.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var e=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new t.ArrayBuffer(e),this.positions=new t.Float32Array(this.vertices),this.colors=new t.Uint32Array(this.vertices),this.indices=new t.Uint16Array(i),this.lastIndexCount=0;for(var n=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new t.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new t.PixiShader(e);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[e.id]=i},t.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var i=e._uvs;if(i){var n,r,a,s,o=t.anchor.x,l=t.anchor.y;if(e.trim){var h=e.trim;n=(r=h.x-o*h.width)+e.crop.width,a=(s=h.y-l*h.height)+e.crop.height}else n=e.frame.width*(1-o),r=e.frame.width*-o,a=e.frame.height*(1-l),s=e.frame.height*-l;var c=4*this.currentBatchSize*this.vertSize,u=e.baseTexture.resolution,d=t.worldTransform,f=d.a/u,g=d.b/u,p=d.c/u,m=d.d/u,v=d.tx,_=d.ty,y=this.colors,x=this.positions;this.renderSession.roundPixels?(x[c]=f*r+p*s+v|0,x[c+1]=m*s+g*r+_|0,x[c+5]=f*n+p*s+v|0,x[c+6]=m*s+g*n+_|0,x[c+10]=f*n+p*a+v|0,x[c+11]=m*a+g*n+_|0,x[c+15]=f*r+p*a+v|0,x[c+16]=m*a+g*r+_|0):(x[c]=f*r+p*s+v,x[c+1]=m*s+g*r+_,x[c+5]=f*n+p*s+v,x[c+6]=m*s+g*n+_,x[c+10]=f*n+p*a+v,x[c+11]=m*a+g*n+_,x[c+15]=f*r+p*a+v,x[c+16]=m*a+g*r+_),x[c+2]=i.x0,x[c+3]=i.y0,x[c+7]=i.x1,x[c+8]=i.y1,x[c+12]=i.x2,x[c+13]=i.y2,x[c+17]=i.x3,x[c+18]=i.y3;var b=t.tint;y[c+4]=y[c+9]=y[c+14]=y[c+19]=(b>>16)+(65280&b)+((255&b)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var i=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var n=e._uvs;e.tilePosition.x%=i.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=i.baseTexture.height*e.tileScaleOffset.y;var r=e.tilePosition.x/(i.baseTexture.width*e.tileScaleOffset.x),a=e.tilePosition.y/(i.baseTexture.height*e.tileScaleOffset.y),s=e.width/i.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),o=e.height/i.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);n.x0=0-r,n.y0=0-a,n.x1=1*s-r,n.y1=0-a,n.x2=1*s-r,n.y2=1*o-a,n.x3=0-r,n.y3=1*o-a;var l=e.tint,h=(l>>16)+(65280&l)+((255&l)<<16)+(255*e.alpha<<24),c=this.positions,u=this.colors,d=e.width,f=e.height,g=e.anchor.x,p=e.anchor.y,m=d*(1-g),v=d*-g,_=f*(1-p),y=f*-p,x=4*this.currentBatchSize*this.vertSize,b=i.baseTexture.resolution,I=e.worldTransform,C=I.a/b,w=I.b/b,S=I.c/b,M=I.d/b,A=I.tx,T=I.ty;c[x++]=C*v+S*y+A,c[x++]=M*y+w*v+T,c[x++]=n.x0,c[x++]=n.y0,u[x++]=h,c[x++]=C*m+S*y+A,c[x++]=M*y+w*m+T,c[x++]=n.x1,c[x++]=n.y1,u[x++]=h,c[x++]=C*m+S*_+A,c[x++]=M*_+w*m+T,c[x++]=n.x2,c[x++]=n.y2,u[x++]=h,c[x++]=C*v+S*_+A,c[x++]=M*_+w*v+T,c[x++]=n.x3,c[x++]=n.y3,u[x++]=h,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e,i,n,r,a=this.gl;if(this.dirty){this.dirty=!1,a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e=this.defaultShader.shaders[a.id];var s=4*this.vertSize;a.vertexAttribPointer(e.aVertexPosition,2,a.FLOAT,!1,s,0),a.vertexAttribPointer(e.aTextureCoord,2,a.FLOAT,!1,s,8),a.vertexAttribPointer(e.colorAttribute,4,a.UNSIGNED_BYTE,!0,s,16)}if(this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var o=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,o)}for(var l,h=0,c=0,u=null,d=this.renderSession.blendModeManager.currentBlendMode,f=null,g=!1,p=!1,m=0,v=this.currentBatchSize;m<v;m++){if(i=(l=this.sprites[m]).texture.baseTexture,g=d!==(n=l.blendMode),p=f!==(r=l.shader||this.defaultShader),(u!==i||g||p)&&(this.renderBatch(u,h,c),c=m,h=0,u=i,g&&(d=n,this.renderSession.blendModeManager.setBlendMode(d)),p)){(e=(f=r).shaders[a.id])||((e=new t.PixiShader(a)).fragmentSrc=f.fragmentSrc,e.uniforms=f.uniforms,e.init(),f.shaders[a.id]=e),this.renderSession.shaderManager.setShader(e),e.dirty&&e.syncUniforms();var _=this.renderSession.projection;a.uniform2f(e.projectionVector,_.x,_.y);var y=this.renderSession.offset;a.uniform2f(e.offsetVector,y.x,y.y)}h++}this.renderBatch(u,h,c),this.currentBatchSize=0}},t.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;n.id>=t._dirty.length||t._dirty[n.id]?this.renderSession.renderer.updateTexture(t):n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]),n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},t.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var i=4*this.size*this.vertSize,n=6*this.maxSize;this.vertices=new t.Float32Array(i),this.indices=new t.Uint16Array(n),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,a=0;r<n;r+=6,a+=4)this.indices[r+0]=a+0,this.indices[r+1]=a+1,this.indices[r+2]=a+2,this.indices[r+3]=a+0,this.indices[r+4]=a+2,this.indices[r+5]=a+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.constructor=t.WebGLFastSpriteBatch,t.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var n=0,r=e.length;n<r;n++)this.renderSprite(e[n]);this.flush()}},t.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,n,r,a,s,o=this.vertices;if(e=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim){var l=t.texture.trim;i=(n=l.x-t.anchor.x*l.width)+t.texture.crop.width,r=(a=l.y-t.anchor.y*l.height)+t.texture.crop.height}else i=t.texture.frame.width*(1-t.anchor.x),n=t.texture.frame.width*-t.anchor.x,r=t.texture.frame.height*(1-t.anchor.y),a=t.texture.frame.height*-t.anchor.y;s=4*this.currentBatchSize*this.vertSize,o[s++]=n,o[s++]=a,o[s++]=t.position.x,o[s++]=t.position.y,o[s++]=t.scale.x,o[s++]=t.scale.y,o[s++]=t.rotation,o[s++]=e.x0,o[s++]=e.y1,o[s++]=t.alpha,o[s++]=i,o[s++]=a,o[s++]=t.position.x,o[s++]=t.position.y,o[s++]=t.scale.x,o[s++]=t.scale.y,o[s++]=t.rotation,o[s++]=e.x1,o[s++]=e.y1,o[s++]=t.alpha,o[s++]=i,o[s++]=r,o[s++]=t.position.x,o[s++]=t.position.y,o[s++]=t.scale.x,o[s++]=t.scale.y,o[s++]=t.rotation,o[s++]=e.x2,o[s++]=e.y2,o[s++]=t.alpha,o[s++]=n,o[s++]=r,o[s++]=t.position.x,o[s++]=t.position.y,o[s++]=t.scale.x,o[s++]=t.scale.y,o[s++]=t.rotation,o[s++]=e.x3,o[s++]=e.y3,o[s++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},t.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},t.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},t.WebGLFilterManager.prototype.constructor=t.WebGLFilterManager,t.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},t.WebGLFilterManager.prototype.pushFilter=function(e){var i=this.gl,n=this.renderSession.projection,r=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var a=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var s=this.texturePool.pop();s?s.resize(this.width,this.height):s=new t.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,s.texture);var o=e._filterArea,l=a.padding;o.x-=l,o.y-=l,o.width+=2*l,o.height+=2*l,o.x<0&&(o.x=0),o.width>this.width&&(o.width=this.width),o.y<0&&(o.y=0),o.height>this.height&&(o.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,s.frameBuffer),i.viewport(0,0,o.width,o.height),n.x=o.width/2,n.y=-o.height/2,r.x=-o.x,r.y=-o.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),e._glFilterTexture=s},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,i=this.filterStack.pop(),n=i._filterArea,r=i._glFilterTexture,a=this.renderSession.projection,s=this.renderSession.offset;if(i.filterPasses.length>1){e.viewport(0,0,n.width,n.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=n.height,this.vertexArray[2]=n.width,this.vertexArray[3]=n.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=n.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var o=r,l=this.texturePool.pop();l||(l=new t.FilterTexture(this.gl,this.width,this.height)),l.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,l.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var h=0;h<i.filterPasses.length-1;h++){var c=i.filterPasses[h];e.bindFramebuffer(e.FRAMEBUFFER,l.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o.texture),this.applyFilterPass(c,n,n.width,n.height);var u=o;o=l,l=u}e.enable(e.BLEND),r=o,this.texturePool.push(l)}var d=i.filterPasses[i.filterPasses.length-1];this.offsetX-=n.x,this.offsetY-=n.y;var f=this.width,g=this.height,p=0,m=0,v=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,!0);else{var _=this.filterStack[this.filterStack.length-1];f=(n=_._filterArea).width,g=n.height,p=n.x,m=n.y,v=_._glFilterTexture.frameBuffer}a.x=f/2,a.y=-g/2,s.x=p,s.y=m;var y=(n=i._filterArea).x-p,x=n.y-m;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=y,this.vertexArray[1]=x+n.height,this.vertexArray[2]=y+n.width,this.vertexArray[3]=x+n.height,this.vertexArray[4]=y,this.vertexArray[5]=x,this.vertexArray[6]=y+n.width,this.vertexArray[7]=x,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,f*this.renderSession.resolution,g*this.renderSession.resolution),e.bindFramebuffer(e.FRAMEBUFFER,v),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r.texture),this.applyFilterPass(d,n,f,g),this.texturePool.push(r),i._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,i,n,r){var a=this.gl,s=e.shaders[a.id];s||((s=new t.PixiShader(a)).fragmentSrc=e.fragmentSrc,s.uniforms=e.uniforms,s.init(),e.shaders[a.id]=s),this.renderSession.shaderManager.setShader(s),a.uniform2f(s.projectionVector,n/2,-r/2),a.uniform2f(s.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),s.syncUniforms(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.vertexAttribPointer(s.aVertexPosition,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.vertexAttribPointer(s.aTextureCoord,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.vertexAttribPointer(s.colorAttribute,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new t.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,i,n,r){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),r=r||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(i,n)},t.FilterTexture.prototype.constructor=t.FilterTexture,t.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},t.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},t.CanvasBuffer.prototype.constructor=t.CanvasBuffer,t.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.constructor=t.CanvasMaskManager,t.CanvasMaskManager.prototype.pushMask=function(e,i){var n=i.context;n.save();var r=e.alpha,a=e.worldTransform,s=i.resolution;n.setTransform(a.a*s,a.b*s,a.c*s,a.d*s,a.tx*s,a.ty*s),t.CanvasGraphics.renderGraphicsMask(e,n),n.clip(),e.worldAlpha=r},t.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,i){var n=e.texture,r="#"+("00000"+(0|(i=t.CanvasTinter.roundColor(i))).toString(16)).substr(-6);if(n.tintCache=n.tintCache||{},n.tintCache[r])return n.tintCache[r];var a=t.CanvasTinter.canvas||document.createElement("canvas");if(t.CanvasTinter.tintMethod(n,i,a),t.CanvasTinter.convertTintToImage){var s=new Image;s.src=a.toDataURL(),n.tintCache[r]=s}else n.tintCache[r]=a,t.CanvasTinter.canvas=null;return a},t.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},t.CanvasTinter.tintWithOverlay=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},t.CanvasTinter.tintWithPerPixel=function(e,i,n){var r=n.getContext("2d"),a=e.crop;n.width=a.width,n.height=a.height,r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height);for(var s=t.hex2rgb(i),o=s[0],l=s[1],h=s[2],c=r.getImageData(0,0,a.width,a.height),u=c.data,d=0;d<u.length;d+=4)u[d+0]*=o,u[d+1]*=l,u[d+2]*=h;r.putImageData(c,0,0)},t.CanvasTinter.roundColor=function(e){var i=t.CanvasTinter.cacheStepsPerColorChannel,n=t.hex2rgb(e);return n[0]=Math.min(255,n[0]/i*i),n[1]=Math.min(255,n[1]/i*i),n[2]=Math.min(255,n[2]/i*i),t.rgb2hex(n)},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,i,n){if(n)for(var r in t.defaultRenderOptions)void 0===n[r]&&(n[r]=t.defaultRenderOptions[r]);else n=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("Canvas"),t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.resolution=n.resolution,this.clearBeforeRender=n.clearBeforeRender,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.width=e||800,this.height=i||600,this.width*=this.resolution,this.height*=this.resolution,this.view=n.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(e,i),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=t.blendModes.NORMAL,this.context.globalCompositeOperation=t.blendModesCanvas[t.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)))},t.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},t.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},t.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.mapBlendModes=function(){t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over"))},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,i){var n=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var r=0;r<e.graphicsData.length;r++){var a=e.graphicsData[r],s=a.shape,o=a._fillTint,l=a._lineTint;if(i.lineWidth=a.lineWidth,a.type===t.Graphics.POLY){i.beginPath();var h=s.points;i.moveTo(h[0],h[1]);for(var c=1;c<h.length/2;c++)i.lineTo(h[2*c],h[2*c+1]);s.closed&&i.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&i.closePath(),a.fill&&(i.globalAlpha=a.fillAlpha*n,i.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),i.fill()),a.lineWidth&&(i.globalAlpha=a.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke())}else if(a.type===t.Graphics.RECT)(a.fillColor||0===a.fillColor)&&(i.globalAlpha=a.fillAlpha*n,i.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),i.fillRect(s.x,s.y,s.width,s.height)),a.lineWidth&&(i.globalAlpha=a.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.strokeRect(s.x,s.y,s.width,s.height));else if(a.type===t.Graphics.CIRC)i.beginPath(),i.arc(s.x,s.y,s.radius,0,2*Math.PI),i.closePath(),a.fill&&(i.globalAlpha=a.fillAlpha*n,i.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),i.fill()),a.lineWidth&&(i.globalAlpha=a.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke());else if(a.type===t.Graphics.ELIP){var u=2*s.width,d=2*s.height,f=s.x-u/2,g=s.y-d/2;i.beginPath();var p=u/2*.5522848,m=d/2*.5522848,v=f+u,_=g+d,y=f+u/2,x=g+d/2;i.moveTo(f,x),i.bezierCurveTo(f,x-m,y-p,g,y,g),i.bezierCurveTo(y+p,g,v,x-m,v,x),i.bezierCurveTo(v,x+m,y+p,_,y,_),i.bezierCurveTo(y-p,_,f,x+m,f,x),i.closePath(),a.fill&&(i.globalAlpha=a.fillAlpha*n,i.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),i.fill()),a.lineWidth&&(i.globalAlpha=a.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke())}else if(a.type===t.Graphics.RREC){var b=s.x,I=s.y,C=s.width,w=s.height,S=s.radius,M=Math.min(C,w)/2|0;S=S>M?M:S,i.beginPath(),i.moveTo(b,I+S),i.lineTo(b,I+w-S),i.quadraticCurveTo(b,I+w,b+S,I+w),i.lineTo(b+C-S,I+w),i.quadraticCurveTo(b+C,I+w,b+C,I+w-S),i.lineTo(b+C,I+S),i.quadraticCurveTo(b+C,I,b+C-S,I),i.lineTo(b+S,I),i.quadraticCurveTo(b,I,b,I+S),i.closePath(),(a.fillColor||0===a.fillColor)&&(i.globalAlpha=a.fillAlpha*n,i.fillStyle="#"+("00000"+(0|o).toString(16)).substr(-6),i.fill()),a.lineWidth&&(i.globalAlpha=a.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,i){var n=e.graphicsData.length;if(0!==n){n>1&&(n=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;r<1;r++){var a=e.graphicsData[r],s=a.shape;if(a.type===t.Graphics.POLY){i.beginPath();var o=s.points;i.moveTo(o[0],o[1]);for(var l=1;l<o.length/2;l++)i.lineTo(o[2*l],o[2*l+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&i.closePath()}else if(a.type===t.Graphics.RECT)i.beginPath(),i.rect(s.x,s.y,s.width,s.height),i.closePath();else if(a.type===t.Graphics.CIRC)i.beginPath(),i.arc(s.x,s.y,s.radius,0,2*Math.PI),i.closePath();else if(a.type===t.Graphics.ELIP){var h=2*s.width,c=2*s.height,u=s.x-h/2,d=s.y-c/2;i.beginPath();var f=h/2*.5522848,g=c/2*.5522848,p=u+h,m=d+c,v=u+h/2,_=d+c/2;i.moveTo(u,_),i.bezierCurveTo(u,_-g,v-f,d,v,d),i.bezierCurveTo(v+f,d,p,_-g,p,_),i.bezierCurveTo(p,_+g,v+f,m,v,m),i.bezierCurveTo(v-f,m,u,_+g,u,_),i.closePath()}else if(a.type===t.Graphics.RREC){var y=s.points,x=y[0],b=y[1],I=y[2],C=y[3],w=y[4],S=Math.min(I,C)/2|0;w=w>S?S:w,i.beginPath(),i.moveTo(x,b+w),i.lineTo(x,b+C-w),i.quadraticCurveTo(x,b+C,x+w,b+C),i.lineTo(x+I-w,b+C),i.quadraticCurveTo(x+I,b+C,x+I,b+C-w),i.lineTo(x+I,b+w),i.quadraticCurveTo(x+I,b,x+I-w,b),i.lineTo(x+w,b),i.quadraticCurveTo(x,b,x,b+w),i.closePath()}}}},t.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var a=t.graphicsData[r],s=0|a.fillColor,o=0|a.lineColor;a._fillTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*i*255<<8)+(255&s)/255*n*255,a._lineTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*n*255}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new t.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.Graphics.prototype.lineStyle=function(e,i,n){if(this.lineWidth=e||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:n,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new t.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},t.Graphics.prototype.moveTo=function(e,i){return this.drawShape(new t.Polygon([e,i])),this},t.Graphics.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},t.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,a,s=this.currentPath.shape.points;0===s.length&&this.moveTo(0,0);for(var o=s[s.length-2],l=s[s.length-1],h=0,c=1;c<=20;c++)r=o+(t-o)*(h=c/20),a=l+(e-l)*h,s.push(r+(t+(i-t)*h-r)*h,a+(e+(n-e)*h-a)*h);return this.dirty=!0,this},t.Graphics.prototype.bezierCurveTo=function(t,e,i,n,r,a){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var s,o,l,h,c,u=this.currentPath.shape.points,d=u[u.length-2],f=u[u.length-1],g=0,p=1;p<=20;p++)l=(o=(s=1-(g=p/20))*s)*s,c=(h=g*g)*g,u.push(l*d+3*o*g*t+3*s*h*i+c*r,l*f+3*o*g*e+3*s*h*n+c*a);return this.dirty=!0,this},t.Graphics.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var a=this.currentPath.shape.points,s=a[a.length-2],o=a[a.length-1]-e,l=s-t,h=n-e,c=i-t,u=Math.abs(o*c-l*h);if(u<1e-8||0===r)a[a.length-2]===t&&a[a.length-1]===e||a.push(t,e);else{var d=o*o+l*l,f=h*h+c*c,g=o*h+l*c,p=r*Math.sqrt(d)/u,m=r*Math.sqrt(f)/u,v=p*g/d,_=m*g/f,y=p*c+m*l,x=p*h+m*o,b=l*(m+v),I=o*(m+v),C=c*(p+_),w=h*(p+_),S=Math.atan2(I-x,b-y),M=Math.atan2(w-x,C-y);this.arc(y+t,x+e,r,S,M,l*h>c*o)}return this.dirty=!0,this},t.Graphics.prototype.arc=function(t,e,i,n,r,a){var s,o=t+Math.cos(n)*i,l=e+Math.sin(n)*i;if(this.currentPath?0===(s=this.currentPath.shape.points).length?s.push(o,l):s[s.length-2]===o&&s[s.length-1]===l||s.push(o,l):(this.moveTo(o,l),s=this.currentPath.shape.points),n===r)return this;!a&&r<=n?r+=2*Math.PI:a&&n<=r&&(n+=2*Math.PI);var h=a?-1*(n-r):r-n,c=Math.abs(h)/(2*Math.PI)*40;if(0===h)return this;for(var u=h/(2*c),d=2*u,f=Math.cos(u),g=Math.sin(u),p=c-1,m=p%1/p,v=0;v<=p;v++){var _=u+n+d*(v+m*v),y=Math.cos(_),x=-Math.sin(_);s.push((f*y+g*x)*i+t,(f*-x+g*y)*i+e)}return this.dirty=!0,this},t.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,i,n,r){return this.drawShape(new t.Rectangle(e,i,n,r)),this},t.Graphics.prototype.drawRoundedRect=function(e,i,n,r,a){return this.drawShape(new t.RoundedRectangle(e,i,n,r,a)),this},t.Graphics.prototype.drawCircle=function(e,i,n){return this.drawShape(new t.Circle(e,i,n)),this},t.Graphics.prototype.drawEllipse=function(e,i,n,r){return this.drawShape(new t.Ellipse(e,i,n,r)),this},t.Graphics.prototype.drawPolygon=function(e){return e instanceof Array||(e=Array.prototype.slice.call(arguments)),this.drawShape(new t.Polygon(e)),this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},t.Graphics.prototype.generateTexture=function(e,i){e=e||1;var n=this.getBounds(),r=new t.CanvasBuffer(n.width*e,n.height*e),a=t.Texture.fromCanvas(r.canvas,i);return a.baseTexture.resolution=e,r.context.scale(e,e),r.context.translate(-n.x,-n.y),t.CanvasGraphics.renderGraphics(this,r.context),a},t.Graphics.prototype._renderWebGL=function(e){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var i=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(i[0],i[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),t.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var n=0,r=this.children.length;n<r;n++)this.children[n]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()}},t.Graphics.prototype._renderCanvas=function(e){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e);var i=e.context,n=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,i.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);var r=e.resolution;i.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r),t.CanvasGraphics.renderGraphics(this,i);for(var a=0,s=this.children.length;a<s;a++)this.children[a]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Graphics.prototype.getBounds=function(e){if(this.isMask)return t.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var i=this._localBounds,n=i.x,r=i.width+i.x,a=i.y,s=i.height+i.y,o=e||this.worldTransform,l=o.a,h=o.b,c=o.c,u=o.d,d=o.tx,f=o.ty,g=l*r+c*s+d,p=u*s+h*r+f,m=l*n+c*s+d,v=u*s+h*n+f,_=l*n+c*a+d,y=u*a+h*n+f,x=l*r+c*a+d,b=u*a+h*r+f,I=g,C=p,w=g,S=p;return w=x<(w=_<(w=m<w?m:w)?_:w)?x:w,S=b<(S=y<(S=v<S?v:S)?y:S)?b:S,I=x>(I=_>(I=m>I?m:I)?_:I)?x:I,C=b>(C=y>(C=v>C?v:C)?y:C)?b:C,this._bounds.x=w,this._bounds.width=I-w,this._bounds.y=S,this._bounds.height=C-S,this._bounds},t.Graphics.prototype.updateLocalBounds=function(){var e=1/0,i=-1/0,n=1/0,r=-1/0;if(this.graphicsData.length)for(var a,s,o,l,h,c,u=0;u<this.graphicsData.length;u++){var d=this.graphicsData[u],f=d.type,g=d.lineWidth;if(a=d.shape,f===t.Graphics.RECT||f===t.Graphics.RREC)o=a.x-g/2,l=a.y-g/2,e=o<e?o:e,i=o+(h=a.width+g)>i?o+h:i,n=l<n?l:n,r=l+(c=a.height+g)>r?l+c:r;else if(f===t.Graphics.CIRC)o=a.x,l=a.y,e=o-(h=a.radius+g/2)<e?o-h:e,i=o+h>i?o+h:i,n=l-(c=a.radius+g/2)<n?l-c:n,r=l+c>r?l+c:r;else if(f===t.Graphics.ELIP)o=a.x,l=a.y,e=o-(h=a.width+g/2)<e?o-h:e,i=o+h>i?o+h:i,n=l-(c=a.height+g/2)<n?l-c:n,r=l+c>r?l+c:r;else{s=a.points;for(var p=0;p<s.length;p+=2)e=(o=s[p])-g<e?o-g:e,i=o+g>i?o+g:i,n=(l=s[p+1])-g<n?l-g:n,r=l+g>r?l+g:r}}else e=0,i=0,n=0,r=0;var m=this.boundsPadding;this._localBounds.x=e-m,this._localBounds.width=i-e+2*m,this._localBounds.y=n-m,this._localBounds.height=r-n+2*m},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var i=new t.CanvasBuffer(e.width,e.height),n=t.Texture.fromCanvas(i.canvas);this._cachedSprite=new t.Sprite(n),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var i=new t.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(i),i.type===t.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i},t.GraphicsData=function(t,e,i,n,r,a,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=a,this.shape=s,this.type=s.type},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.Graphics.RREC=4,t.Polygon.prototype.type=t.Graphics.POLY,t.Rectangle.prototype.type=t.Graphics.RECT,t.Circle.prototype.type=t.Graphics.CIRC,t.Ellipse.prototype.type=t.Graphics.ELIP,t.RoundedRectangle.prototype.type=t.Graphics.RREC,t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=t.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=t.Strip.DrawModes.TRIANGLE_STRIP},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},t.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var i=e.gl,n=e.projection,r=e.offset,a=e.shaderManager.stripShader,s=this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;e.blendModeManager.setBlendMode(this.blendMode),i.uniformMatrix3fv(a.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(a.projectionVector,n.x,-n.y),i.uniform2f(a.offsetVector,-r.x,-r.y),i.uniform1f(a.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(a.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(a.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?e.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(a.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(a.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?e.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(s,this.indices.length,i.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var i=e.context,n=this.worldTransform;e.roundPixels?i.setTransform(n.a,n.b,n.c,n.d,0|n.tx,0|n.ty):i.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(i):this._renderCanvasTriangles(i)},t.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,n=e.length/2;this.count++;for(var r=0;r<n-2;r++){var a=2*r;this._renderCanvasDrawTriangle(t,e,i,a,a+2,a+4)}},t.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,n=this.indices,r=n.length;this.count++;for(var a=0;a<r;a+=3){var s=2*n[a],o=2*n[a+1],l=2*n[a+2];this._renderCanvasDrawTriangle(t,e,i,s,o,l)}},t.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,a){var s=this.texture.baseTexture.source,o=this.texture.width,l=this.texture.height,h=e[n],c=e[r],u=e[a],d=e[n+1],f=e[r+1],g=e[a+1],p=i[n]*o,m=i[r]*o,v=i[a]*o,_=i[n+1]*l,y=i[r+1]*l,x=i[a+1]*l;if(this.canvasPadding>0){var b=this.canvasPadding/this.worldTransform.a,I=this.canvasPadding/this.worldTransform.d,C=(h+c+u)/3,w=(d+f+g)/3,S=h-C,M=d-w,A=Math.sqrt(S*S+M*M);h=C+S/A*(A+b),d=w+M/A*(A+I),M=f-w,c=C+(S=c-C)/(A=Math.sqrt(S*S+M*M))*(A+b),f=w+M/A*(A+I),M=g-w,u=C+(S=u-C)/(A=Math.sqrt(S*S+M*M))*(A+b),g=w+M/A*(A+I)}t.save(),t.beginPath(),t.moveTo(h,d),t.lineTo(c,f),t.lineTo(u,g),t.closePath(),t.clip();var T=p*y+_*v+m*x-y*v-_*m-p*x,k=h*y+_*u+c*x-y*u-_*c-h*x,D=p*c+h*v+m*u-c*v-h*m-p*u,P=p*y*u+_*c*v+h*m*x-h*y*v-_*m*u-p*c*x,E=d*y+_*g+f*x-y*g-_*f-d*x,z=p*f+d*v+m*g-f*v-d*m-p*g,O=p*y*g+_*f*v+d*m*x-d*y*v-_*m*g-p*f*x;t.transform(k/T,E/T,D/T,z/T,P/T,O/T),t.drawImage(s,0,0),t.restore()},t.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;this.count++,e.beginPath();for(var r=1;r<n-2;r++){var a=2*r,s=i[a],o=i[a+2],l=i[a+4],h=i[a+1],c=i[a+3],u=i[a+5];e.moveTo(s,h),e.lineTo(o,c),e.lineTo(l,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Strip.prototype.getBounds=function(e){for(var i=e||this.worldTransform,n=i.a,r=i.b,a=i.c,s=i.d,o=i.tx,l=i.ty,h=-1/0,c=-1/0,u=1/0,d=1/0,f=this.vertices,g=0,p=f.length;g<p;g+=2){var m=f[g],v=f[g+1],_=n*m+a*v+o,y=s*v+r*m+l;u=_<u?_:u,d=y<d?y:d,h=_>h?_:h,c=y>c?y:c}if(u===-1/0||c===1/0)return t.EmptyRectangle;var x=this._bounds;return x.x=u,x.width=h-u,x.y=d,x.height=c-d,this._currentBounds=x,x},t.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},t.Rope=function(e,i){t.Strip.call(this,e),this.points=i,this.vertices=new t.Float32Array(4*i.length),this.uvs=new t.Float32Array(4*i.length),this.colors=new t.Float32Array(2*i.length),this.indices=new t.Uint16Array(2*i.length),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=(t[0],this.indices),n=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var r,a,s,o=t.length,l=1;l<o;l++)r=t[l],s=l/(o-1),e[a=4*l]=s,e[a+1]=0,e[a+2]=s,e[a+3]=1,n[a=2*l]=1,n[a+1]=1,i[a=2*l]=a,i[a+1]=a+1,r}},t.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var i,n=e[0],r={x:0,y:0};this.count-=.2;for(var a,s,o,l,h=this.vertices,c=e.length,u=0;u<c;u++)a=e[u],s=4*u,i=u<e.length-1?e[u+1]:a,r.y=-(i.x-n.x),r.x=i.y-n.y,10*(1-u/(c-1))>1&&1,o=Math.sqrt(r.x*r.x+r.y*r.y),l=this.texture.height/2,r.x/=o,r.y/=o,r.x*=l,r.y*=l,h[s]=a.x+r.x,h[s+1]=a.y+r.y,h[s+2]=a.x-r.x,h[s+3]=a.y-r.y,n=a;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(t){this.texture=t},t.TilingSprite=function(e,i,n){t.Sprite.call(this,e),this._width=i||100,this._height=n||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),t.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha){var e,i;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},t.TilingSprite.prototype._renderCanvas=function(e){if(!1!==this.visible&&0!==this.alpha){var i=e.context;this._mask&&e.maskManager.pushMask(this._mask,e),i.globalAlpha=this.worldAlpha;var n,r,a=this.worldTransform,s=e.resolution;if(i.setTransform(a.a*s,a.b*s,a.c*s,a.d*s,a.tx*s,a.ty*s),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,i.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var o=this.tilePosition,l=this.tileScale;for(o.x%=this.tilingTexture.baseTexture.width,o.y%=this.tilingTexture.baseTexture.height,i.scale(l.x,l.y),i.translate(o.x+this.anchor.x*-this._width,o.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-o.x,-o.y,this._width/l.x,this._height/l.y),i.scale(1/l.x,1/l.y),i.translate(-o.x+this.anchor.x*this._width,-o.y+this.anchor.y*this._height),this._mask&&e.maskManager.popMask(e),n=0,r=this.children.length;n<r;n++)this.children[n]._renderCanvas(e)}},t.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,r=e*(1-this.anchor.y),a=e*-this.anchor.y,s=this.worldTransform,o=s.a,l=s.b,h=s.c,c=s.d,u=s.tx,d=s.ty,f=o*n+h*a+u,g=c*a+l*n+d,p=o*i+h*a+u,m=c*a+l*i+d,v=o*i+h*r+u,_=c*r+l*i+d,y=o*n+h*r+u,x=c*r+l*n+d,b=-1/0,I=-1/0,C=1/0,w=1/0;C=y<(C=v<(C=p<(C=f<C?f:C)?p:C)?v:C)?y:C,w=x<(w=_<(w=m<(w=g<w?g:w)?m:w)?_:w)?x:w,b=y>(b=v>(b=p>(b=f>b?f:b)?p:b)?v:b)?y:b,I=x>(I=_>(I=m>(I=g>I?g:I)?m:I)?_:I)?x:I;var S=this._bounds;return S.x=C,S.width=b-C,S.y=w,S.height=I-w,this._currentBounds=S,S},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e){if(this.texture.baseTexture.hasLoaded){var i,n,r,a=this.originalTexture||this.texture,s=a.frame,o=s.width!==a.baseTexture.width||s.height!==a.baseTexture.height,l=!1;if(e?(i=t.getNextPowerOfTwo(s.width),n=t.getNextPowerOfTwo(s.height),(s.width!==i||s.height!==n||a.baseTexture.width!==i||a.baseTexture.height||n)&&(l=!0)):o&&(a.trim?(i=a.trim.width,n=a.trim.height):(i=s.width,n=s.height),l=!0),l)this.tilingTexture&&this.tilingTexture.isTiling?((r=this.tilingTexture.canvasBuffer).resize(i,n),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=n,this.tilingTexture.needsUpdate=!0):(r=new t.CanvasBuffer(i,n),this.tilingTexture=t.Texture.fromCanvas(r.canvas),this.tilingTexture.canvasBuffer=r,this.tilingTexture.isTiling=!0),r.context.drawImage(a.baseTexture.source,a.crop.x,a.crop.y,a.crop.width,a.crop.height,0,0,i,n),this.tileScaleOffset.x=s.width/i,this.tileScaleOffset.y=s.height/n;else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=a;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},t.TilingSprite.prototype.destroy=function(){t.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};var e={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array,BoneData:function(t,e){this.name=t,this.parent=e}};e.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},e.SlotData=function(t,e){this.name=t,this.boneData=e},e.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},e.IkConstraintData=function(t){this.name=t,this.bones=[]},e.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},e.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},e.Bone.yDown=!1,e.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var i=this.skeleton.flipX,n=this.skeleton.flipY;this.worldX=i?-this.x:this.x,this.worldY=n!=e.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=i!=this.flipX,this.worldFlipY=n!=this.flipY}var r=this.worldRotation*e.degRad,a=Math.cos(r),s=Math.sin(r);this.worldFlipX?(this.m00=-a*this.worldScaleX,this.m01=s*this.worldScaleY):(this.m00=a*this.worldScaleX,this.m01=-s*this.worldScaleY),this.worldFlipY!=e.Bone.yDown?(this.m10=-s*this.worldScaleX,this.m11=-a*this.worldScaleY):(this.m10=s*this.worldScaleX,this.m11=a*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var i=t[0]-this.worldX,n=t[1]-this.worldY,r=this.m00,a=this.m10,s=this.m01,o=this.m11;this.worldFlipX!=(this.worldFlipY!=e.Bone.yDown)&&(r=-r,o=-o);var l=1/(r*o-s*a);t[0]=i*r*l-n*s*l,t[1]=n*o*l-i*a*l},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},e.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},e.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;i<n;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},e.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},e.IkConstraint.prototype={apply:function(){var t=this.target,i=this.bones;switch(i.length){case 1:e.IkConstraint.apply1(i[0],t.worldX,t.worldY,this.mix);break;case 2:e.IkConstraint.apply2(i[0],i[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},e.IkConstraint.apply1=function(t,i,n,r){var a=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,s=t.rotation,o=Math.atan2(n-t.worldY,i-t.worldX)*e.radDeg-a;t.rotationIK=s+(o-s)*r},e.IkConstraint.apply2=function(t,i,n,r,a,s){var o=i.rotation,l=t.rotation;if(!s)return i.rotationIK=o,void(t.rotationIK=l);var h,c,u=e.temp,d=t.parent;d?(u[0]=n,u[1]=r,d.worldToLocal(u),n=(u[0]-t.x)*d.worldScaleX,r=(u[1]-t.y)*d.worldScaleY):(n-=t.x,r-=t.y),i.parent==t?(h=i.x,c=i.y):(u[0]=i.x,u[1]=i.y,i.parent.localToWorld(u),t.worldToLocal(u),h=u[0],c=u[1]);var f=h*t.worldScaleX,g=c*t.worldScaleY,p=Math.atan2(g,f),m=Math.sqrt(f*f+g*g),v=i.data.length*i.worldScaleX,_=2*m*v;if(_<1e-4)i.rotationIK=o+(Math.atan2(r,n)*e.radDeg-l-o)*s;else{var y=(n*n+r*r-m*m-v*v)/_;y<-1?y=-1:y>1&&(y=1);var x=Math.acos(y)*a,b=m+v*y,I=v*Math.sin(x),C=(Math.atan2(r*b-n*I,n*b+r*I)-p)*e.radDeg-l;C>180?C-=360:C<-180&&(C+=360),t.rotationIK=l+C*s,(C=(x+p)*e.radDeg-o)>180?C-=360:C<-180&&(C+=360),i.rotationIK=o+(C+t.worldRotation-i.parent.worldRotation)*s}},e.Skin=function(t){this.name=t,this.attachments={}},e.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),a=i.substring(n+1),s=t.slots[r];if(s.attachment&&s.attachment.name==a){var o=this.getAttachment(r,a);o&&s.setAttachment(o)}}}},e.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},e.Animation.prototype={apply:function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var a=this.timelines,s=0,o=a.length;s<o;s++)a[s].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,a){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var s=this.timelines,o=0,l=s.length;o<l;o++)s[o].apply(t,e,i,r,a)}},e.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var a=r>>>1;;){if(t[(a+1)*i]<=e?n=a+1:r=a,n==r)return(n+1)*i;a=n+r>>>1}},e.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}},e.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1},e.Curves=function(t){this.curves=[]},e.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var a=.1*.1*.1*6,s=2*-e+n,o=2*-i+r,l=3*(e-n)+1,h=3*(i-r)+1,c=e*(3*.1)+s*(.1*.1*3)+l*(.1*.1*.1),u=i*(3*.1)+o*(.1*.1*3)+h*(.1*.1*.1),d=s*(.1*.1*6)+l*a,f=o*(.1*.1*6)+h*a,g=l*a,p=h*a,m=19*t,v=this.curves;v[m++]=2;for(var _=c,y=u,x=m+19-1;m<x;m+=2)v[m]=_,v[m+1]=y,c+=d,u+=f,d+=g,f+=p,_+=c,y+=u},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;for(var a=0,s=++n,o=n+19-1;n<o;n+=2){var l,h;if((a=i[n])>=e)return n==s?(l=0,h=0):(l=i[n-2],h=i[n-1]),h+(i[n+1]-h)*(e-l)/(a-l)}var c=i[n-1];return c+(1-c)*(e-a)/(1-a)}},e.RotateTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,i,n,r,a){var s=this.frames;if(!(n<s[0])){var o=t.bones[this.boneIndex];if(n>=s[s.length-2]){for(var l=o.data.rotation+s[s.length-1]-o.rotation;l>180;)l-=360;for(;l<-180;)l+=360;o.rotation+=l*a}else{var h=e.Animation.binarySearch(s,n,2),c=s[h-1],u=s[h],d=1-(n-u)/(s[h-2]-u);d=this.curves.getCurvePercent(h/2-1,d);for(l=s[h+1]-c;l>180;)l-=360;for(;l<-180;)l+=360;for(l=o.data.rotation+(c+l*d)-o.rotation;l>180;)l-=360;for(;l<-180;)l+=360;o.rotation+=l*a}}}},e.TranslateTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,i,n,r,a){var s=this.frames;if(!(n<s[0])){var o=t.bones[this.boneIndex];if(n>=s[s.length-3])return o.x+=(o.data.x+s[s.length-2]-o.x)*a,void(o.y+=(o.data.y+s[s.length-1]-o.y)*a);var l=e.Animation.binarySearch(s,n,3),h=s[l-2],c=s[l-1],u=s[l],d=1-(n-u)/(s[l+-3]-u);d=this.curves.getCurvePercent(l/3-1,d),o.x+=(o.data.x+h+(s[l+1]-h)*d-o.x)*a,o.y+=(o.data.y+c+(s[l+2]-c)*d-o.y)*a}}},e.ScaleTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,i,n,r,a){var s=this.frames;if(!(n<s[0])){var o=t.bones[this.boneIndex];if(n>=s[s.length-3])return o.scaleX+=(o.data.scaleX*s[s.length-2]-o.scaleX)*a,void(o.scaleY+=(o.data.scaleY*s[s.length-1]-o.scaleY)*a);var l=e.Animation.binarySearch(s,n,3),h=s[l-2],c=s[l-1],u=s[l],d=1-(n-u)/(s[l+-3]-u);d=this.curves.getCurvePercent(l/3-1,d),o.scaleX+=(o.data.scaleX*(h+(s[l+1]-h)*d)-o.scaleX)*a,o.scaleY+=(o.data.scaleY*(c+(s[l+2]-c)*d)-o.scaleY)*a}}},e.ColorTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=5*t},e.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,a){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=a},apply:function(t,i,n,r,a){var s=this.frames;if(!(n<s[0])){var o,l,h,c;if(n>=s[s.length-5]){var u=s.length-1;o=s[u-3],l=s[u-2],h=s[u-1],c=s[u]}else{var d=e.Animation.binarySearch(s,n,5),f=s[d-4],g=s[d-3],p=s[d-2],m=s[d-1],v=s[d],_=1-(n-v)/(s[d-5]-v);_=this.curves.getCurvePercent(d/5-1,_),o=f+(s[d+1]-f)*_,l=g+(s[d+2]-g)*_,h=p+(s[d+3]-p)*_,c=m+(s[d+4]-m)*_}var y=t.slots[this.slotIndex];a<1?(y.r+=(o-y.r)*a,y.g+=(l-y.g)*a,y.b+=(h-y.b)*a,y.a+=(c-y.a)*a):(y.r=o,y.g=l,y.b=h,y.a=c)}}},e.AttachmentTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},e.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,i,n,r,a){var s=this.frames;if(n<s[0])i>n&&this.apply(t,i,Number.MAX_VALUE,null,0);else{i>n&&(i=-1);var o=n>=s[s.length-1]?s.length-1:e.Animation.binarySearch1(s,n)-1;if(!(s[o]<i)){var l=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(l?t.getAttachmentBySlotIndex(this.slotIndex,l):null)}}}},e.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},e.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,i,n,r,a){if(r){var s=this.frames,o=s.length;if(i>n)this.apply(t,i,Number.MAX_VALUE,r,a),i=-1;else if(i>=s[o-1])return;if(!(n<s[0])){var l;if(i<s[0])l=0;else for(var h=s[l=e.Animation.binarySearch1(s,i)];l>0&&s[l-1]==h;)l--;for(var c=this.events;l<o&&n>=s[l];l++)r.push(c[l])}}}},e.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},e.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,i,n,r,a){var s=this.frames;if(!(n<s[0])){var o;o=n>=s[s.length-1]?s.length-1:e.Animation.binarySearch1(s,n)-1;var l=t.drawOrder,h=(t.slots,this.drawOrders[o]);if(h)for(var c=0,u=h.length;c<u;c++)l[c]=h[c]}}},e.FfdTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},e.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,i,n,r,a){var s=t.slots[this.slotIndex];if(s.attachment==this.attachment){var o=this.frames;if(!(n<o[0])){var l=this.frameVertices,h=l[0].length,c=s.attachmentVertices;if(c.length!=h&&(a=1),c.length=h,n>=o[o.length-1]){var u=l[o.length-1];if(a<1)for(var d=0;d<h;d++)c[d]+=(u[d]-c[d])*a;else for(d=0;d<h;d++)c[d]=u[d]}else{var f=e.Animation.binarySearch1(o,n),g=o[f],p=1-(n-g)/(o[f-1]-g);p=this.curves.getCurvePercent(f-1,p<0?0:p>1?1:p);var m=l[f-1],v=l[f];if(a<1)for(d=0;d<h;d++){var _=m[d];c[d]+=(_+(v[d]-_)*p-c[d])*a}else for(d=0;d<h;d++){_=m[d];c[d]=_+(v[d]-_)*p}}}}}},e.IkConstraintTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=3*t},e.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,i,n,r,a){var s=this.frames;if(!(n<s[0])){var o=t.ikConstraints[this.ikConstraintIndex];if(n>=s[s.length-3])return o.mix+=(s[s.length-2]-o.mix)*a,void(o.bendDirection=s[s.length-1]);var l=e.Animation.binarySearch(s,n,3),h=s[l+-2],c=s[l],u=1-(n-c)/(s[l+-3]-c);u=this.curves.getCurvePercent(l/3-1,u);var d=h+(s[l+1]-h)*u;o.mix+=(d-o.mix)*a,o.bendDirection=s[l+-1]}}},e.FlipXTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,i,n,r,a){var s=this.frames;if(n<s[0])i>n&&this.apply(t,i,Number.MAX_VALUE,null,0);else{i>n&&(i=-1);var o=(n>=s[s.length-2]?s.length:e.Animation.binarySearch(s,n,2))-2;s[o]<i||(t.bones[boneIndex].flipX=0!=s[o+1])}}},e.FlipYTimeline=function(t){this.curves=new e.Curves(t),this.frames=[],this.frames.length=2*t},e.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,i,n,r,a){var s=this.frames;if(n<s[0])i>n&&this.apply(t,i,Number.MAX_VALUE,null,0);else{i>n&&(i=-1);var o=(n>=s[s.length-2]?s.length:e.Animation.binarySearch(s,n,2))-2;s[o]<i||(t.bones[boneIndex].flipY=0!=s[o+1])}}},e.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},e.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}},e.Skeleton=function(t){this.data=t,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++){var r=t.bones[i],a=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new e.Bone(r,this,a))}this.slots=[],this.drawOrder=[];for(i=0,n=t.slots.length;i<n;i++){var s=t.slots[i],o=this.bones[t.bones.indexOf(s.boneData)],l=new e.Slot(s,o);this.slots.push(l),this.drawOrder.push(i)}this.ikConstraints=[];for(i=0,n=t.ikConstraints.length;i<n;i++)this.ikConstraints.push(new e.IkConstraint(t.ikConstraints[i],this));this.boneCache=[],this.updateCache()},e.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;n.length>i&&(n.length=i);for(var r=0,a=n.length;r<a;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var s=n[0],o=this.bones;t:for(r=0,a=o.length;r<a;r++){var l=o[r],h=l;do{for(var c=0;c<e;c++)for(var u=t[c],d=u.bones[0],f=u.bones[u.bones.length-1];;){if(h==f){n[c].push(l),n[c+1].push(l);continue t}if(f==d)break;f=f.parent}h=h.parent}while(h);s[s.length]=l}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}e=0;for(var r=this.boneCache.length-1;;){for(var a=this.boneCache[e],s=0,o=a.length;s<o;s++)a[s].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,i=t.length;e<i;e++)t[e].setToSetupPose(e);this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],a=r.data.attachmentName;if(a){var s=t.getAttachment(i,a);s&&r.setAttachment(s)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;n<r;n++){var a=i[n];if(a.data.name==t){var s=null;if(e&&!(s=this.getAttachmentBySlotIndex(n,e)))throw"Attachment not found: "+e+", for slot: "+t;return void a.setAttachment(s)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t},resetDrawOrder:function(){for(var t=0,e=this.drawOrder.length;t<e;t++)this.drawOrder[t]=t}},e.EventData=function(t){this.name=t},e.EventData.prototype={intValue:0,floatValue:0,stringValue:null},e.Event=function(t){this.data=t},e.Event.prototype={intValue:0,floatValue:0,stringValue:null},e.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},e.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},e.RegionAttachment.prototype={type:e.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var a=this.uvs;r?(a[2]=t,a[3]=n,a[4]=t,a[5]=e,a[6]=i,a[7]=e,a[0]=i,a[1]=n):(a[0]=t,a[1]=n,a[2]=t,a[3]=e,a[4]=i,a[5]=e,a[6]=i,a[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,i=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*i,a=n+this.regionWidth*t,s=r+this.regionHeight*i,o=this.rotation*e.degRad,l=Math.cos(o),h=Math.sin(o),c=n*l+this.x,u=n*h,d=r*l+this.y,f=r*h,g=a*l+this.x,p=a*h,m=s*l+this.y,v=s*h,_=this.offset;_[0]=c-f,_[1]=d+u,_[2]=c-v,_[3]=m+u,_[4]=g-v,_[5]=m+p,_[6]=g-f,_[7]=d+p},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,a=i.m01,s=i.m10,o=i.m11,l=this.offset;n[0]=l[0]*r+l[1]*a+t,n[1]=l[0]*s+l[1]*o+e,n[2]=l[2]*r+l[3]*a+t,n[3]=l[2]*s+l[3]*o+e,n[4]=l[4]*r+l[5]*a+t,n[5]=l[4]*s+l[5]*o+e,n[6]=l[6]*r+l[7]*a+t,n[7]=l[6]*s+l[7]*o+e}},e.MeshAttachment=function(t){this.name=t},e.MeshAttachment.prototype={type:e.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,i=this.regionV2-this.regionV,n=this.regionUVs.length;if(this.uvs&&this.uvs.length==n||(this.uvs=new e.Float32Array(n)),this.regionRotate)for(var r=0;r<n;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r+1]*t,this.uvs[r+1]=this.regionV+i-this.regionUVs[r]*i;else for(r=0;r<n;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r]*t,this.uvs[r+1]=this.regionV+this.regionUVs[r+1]*i},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var a=r.m00,s=r.m01,o=r.m10,l=r.m11,h=this.vertices,c=h.length;i.attachmentVertices.length==c&&(h=i.attachmentVertices);for(var u=0;u<c;u+=2){var d=h[u],f=h[u+1];n[u]=d*a+f*s+t,n[u+1]=d*o+f*l+e}}},e.SkinnedMeshAttachment=function(t){this.name=t},e.SkinnedMeshAttachment.prototype={type:e.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,i,n,r,a){var s=this.regionU2-this.regionU,o=this.regionV2-this.regionV,l=this.regionUVs.length;if(this.uvs&&this.uvs.length==l||(this.uvs=new e.Float32Array(l)),this.regionRotate)for(var h=0;h<l;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h+1]*s,this.uvs[h+1]=this.regionV+o-this.regionUVs[h]*o;else for(h=0;h<l;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h]*s,this.uvs[h+1]=this.regionV+this.regionUVs[h+1]*o},computeWorldVertices:function(t,e,i,n){var r,a,s,o,l,h,c,u=i.bone.skeleton.bones,d=this.weights,f=this.bones,g=0,p=0,m=0,v=0,_=f.length;if(i.attachmentVertices.length)for(var y=i.attachmentVertices;p<_;g+=2){for(a=0,s=0,r=f[p++]+p;p<r;p++,m+=3,v+=2)o=u[f[p]],l=d[m]+y[v],h=d[m+1]+y[v+1],c=d[m+2],a+=(l*o.m00+h*o.m01+o.worldX)*c,s+=(l*o.m10+h*o.m11+o.worldY)*c;n[g]=a+t,n[g+1]=s+e}else for(;p<_;g+=2){for(a=0,s=0,r=f[p++]+p;p<r;p++,m+=3)o=u[f[p]],l=d[m],h=d[m+1],c=d[m+2],a+=(l*o.m00+h*o.m01+o.worldX)*c,s+=(l*o.m10+h*o.m11+o.worldY)*c;n[g]=a+t,n[g+1]=s+e}}},e.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},e.BoundingBoxAttachment.prototype={type:e.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;for(var r=i.m00,a=i.m01,s=i.m10,o=i.m11,l=this.vertices,h=0,c=l.length;h<c;h+=2){var u=l[h],d=l[h+1];n[h]=u*r+d*a+t,n[h+1]=u*s+d*o+e}}},e.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},e.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},e.TrackEntry=function(){},e.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},e.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},e.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;r?(r.time=i.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){t.resetDrawOrder();for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,a=i.endTime,s=i.loop;!s&&n>a&&(n=a);var o=i.previous;if(o){var l=o.time;!o.loop&&l>o.endTime&&(l=o.endTime),o.animation.apply(t,l,l,o.loop,null);var h=i.mixTime/i.mixDuration*i.mix;h>=1&&(h=1,i.previous=null),i.animation.mix(t,i.lastTime,n,s,this.events,h)}else 1==i.mix?i.animation.apply(t,i.lastTime,n,s,this.events):i.animation.mix(t,i.lastTime,n,s,this.events,i.mix);for(var c=0,u=this.events.length;c<u;c++){var d=this.events[c];i.onEvent&&i.onEvent(e,d),this.onEvent&&this.onEvent(e,d)}if(s?r%a>n%a:r<a&&n>=a){var f=Math.floor(n/a);i.onComplete&&i.onComplete(e,f),this.onComplete&&this.onComplete(e,f)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,n&&i.mixTime/i.mixDuration<.5?e.previous=n:e.previous=i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,i,n){var r=new e.TrackEntry;return r.animation=i,r.loop=n,r.endTime=i.duration,this.setCurrent(t,r),r},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,i,n,r){var a=new e.TrackEntry;a.animation=i,a.loop=n,a.endTime=i.duration;var s=this._expandToIndex(t);if(s){for(;s.next;)s=s.next;s.next=a}else this.tracks[t]=a;return r<=0&&(s?r+=s.endTime-this.data.getMix(s.animation,i):r=0),a.delay=r,a},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},e.SkeletonJson=function(t){this.attachmentLoader=t},e.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,i){var n=new e.SkeletonData;n.name=i;var r=t.skeleton;r&&(n.hash=r.hash,n.version=r.spine,n.width=r.width||0,n.height=r.height||0);for(var a=0,s=(c=t.bones).length;a<s;a++){var o=c[a],l=null;if(o.parent&&!(l=n.findBone(o.parent)))throw"Parent bone not found: "+o.parent;(v=new e.BoneData(o.name,l)).length=(o.length||0)*this.scale,v.x=(o.x||0)*this.scale,v.y=(o.y||0)*this.scale,v.rotation=o.rotation||0,v.scaleX=o.hasOwnProperty("scaleX")?o.scaleX:1,v.scaleY=o.hasOwnProperty("scaleY")?o.scaleY:1,v.inheritScale=!o.hasOwnProperty("inheritScale")||o.inheritScale,v.inheritRotation=!o.hasOwnProperty("inheritRotation")||o.inheritRotation,n.bones.push(v)}var h=t.ik;if(h)for(a=0,s=h.length;a<s;a++){for(var c,u=h[a],d=new e.IkConstraintData(u.name),f=0,g=(c=u.bones).length;f<g;f++){var p=n.findBone(c[f]);if(!p)throw"IK bone not found: "+c[f];d.bones.push(p)}if(d.target=n.findBone(u.target),!d.target)throw"Target bone not found: "+u.target;d.bendDirection=!u.hasOwnProperty("bendPositive")||u.bendPositive?1:-1,d.mix=u.hasOwnProperty("mix")?u.mix:1,n.ikConstraints.push(d)}var m=t.slots;for(a=0,s=m.length;a<s;a++){var v,_=m[a];if(!(v=n.findBone(_.bone)))throw"Slot bone not found: "+_.bone;var y=new e.SlotData(_.name,v),x=_.color;x&&(y.r=this.toColor(x,0),y.g=this.toColor(x,1),y.b=this.toColor(x,2),y.a=this.toColor(x,3)),y.attachmentName=_.attachment,y.additiveBlending=_.additive&&"true"==_.additive,n.slots.push(y)}var b=t.skins;for(var I in b)if(b.hasOwnProperty(I)){var C=b[I],w=new e.Skin(I);for(var S in C)if(C.hasOwnProperty(S)){var M=n.findSlotIndex(S),A=C[S];for(var T in A)if(A.hasOwnProperty(T)){var k=this.readAttachment(w,T,A[T]);k&&w.addAttachment(M,T,k)}}n.skins.push(w),"default"==w.name&&(n.defaultSkin=w)}var D=t.events;for(var P in D)if(D.hasOwnProperty(P)){var E=D[P],z=new e.EventData(P);z.intValue=E.int||0,z.floatValue=E.float||0,z.stringValue=E.string||null,n.events.push(z)}var O=t.animations;for(var B in O)O.hasOwnProperty(B)&&this.readAnimation(B,O[B],n);return n},readAttachment:function(t,i,n){i=n.name||i;var r=e.AttachmentType[n.type||"region"],a=n.path||i,s=this.scale;if(r==e.AttachmentType.region){var o=this.attachmentLoader.newRegionAttachment(t,i,a);if(!o)return null;o.path=a,o.x=(n.x||0)*s,o.y=(n.y||0)*s,o.scaleX=n.hasOwnProperty("scaleX")?n.scaleX:1,o.scaleY=n.hasOwnProperty("scaleY")?n.scaleY:1,o.rotation=n.rotation||0,o.width=(n.width||0)*s,o.height=(n.height||0)*s;var l=n.color;return l&&(o.r=this.toColor(l,0),o.g=this.toColor(l,1),o.b=this.toColor(l,2),o.a=this.toColor(l,3)),o.updateOffset(),o}if(r==e.AttachmentType.mesh)return(h=this.attachmentLoader.newMeshAttachment(t,i,a))?(h.path=a,h.vertices=this.getFloatArray(n,"vertices",s),h.triangles=this.getIntArray(n,"triangles"),h.regionUVs=this.getFloatArray(n,"uvs",1),h.updateUVs(),(l=n.color)&&(h.r=this.toColor(l,0),h.g=this.toColor(l,1),h.b=this.toColor(l,2),h.a=this.toColor(l,3)),h.hullLength=2*(n.hull||0),n.edges&&(h.edges=this.getIntArray(n,"edges")),h.width=(n.width||0)*s,h.height=(n.height||0)*s,h):null;if(r==e.AttachmentType.skinnedmesh){var h;if(!(h=this.attachmentLoader.newSkinnedMeshAttachment(t,i,a)))return null;h.path=a;for(var c=this.getFloatArray(n,"uvs",1),u=[],d=[],f=0,g=(v=this.getFloatArray(n,"vertices",1)).length;f<g;){var p=0|v[f++];d[d.length]=p;for(var m=f+4*p;f<m;)d[d.length]=v[f],u[u.length]=v[f+1]*s,u[u.length]=v[f+2]*s,u[u.length]=v[f+3],f+=4}return h.bones=d,h.weights=u,h.triangles=this.getIntArray(n,"triangles"),h.regionUVs=c,h.updateUVs(),(l=n.color)&&(h.r=this.toColor(l,0),h.g=this.toColor(l,1),h.b=this.toColor(l,2),h.a=this.toColor(l,3)),h.hullLength=2*(n.hull||0),n.edges&&(h.edges=this.getIntArray(n,"edges")),h.width=(n.width||0)*s,h.height=(n.height||0)*s,h}if(r==e.AttachmentType.boundingbox){var v,_=this.attachmentLoader.newBoundingBoxAttachment(t,i);for(f=0,g=(v=n.vertices).length;f<g;f++)_.vertices.push(v[f]*s);return _}throw"Unknown attachment type: "+r},readAnimation:function(t,i,n){var r=[],a=0,s=i.slots;for(var o in s)if(s.hasOwnProperty(o)){var l=s[o],h=n.findSlotIndex(o);for(var c in l)if(l.hasOwnProperty(c)){var u=l[c];if("color"==c){(G=new e.ColorTimeline(u.length)).slotIndex=h;for(var d=0,f=0,g=u.length;f<g;f++){var p=(x=u[f]).color,m=this.toColor(p,0),v=this.toColor(p,1),_=this.toColor(p,2),y=this.toColor(p,3);G.setFrame(d,x.time,m,v,_,y),this.readCurve(G,d,x),d++}r.push(G),a=Math.max(a,G.frames[5*G.getFrameCount()-5])}else{if("attachment"!=c)throw"Invalid timeline type for a slot: "+c+" ("+o+")";(G=new e.AttachmentTimeline(u.length)).slotIndex=h;for(d=0,f=0,g=u.length;f<g;f++){var x=u[f];G.setFrame(d++,x.time,x.name)}r.push(G),a=Math.max(a,G.frames[G.getFrameCount()-1])}}}var b=i.bones;for(var I in b)if(b.hasOwnProperty(I)){var C=n.findBoneIndex(I);if(-1==C)throw"Bone not found: "+I;var w=b[I];for(var c in w)if(w.hasOwnProperty(c)){u=w[c];if("rotate"==c){(G=new e.RotateTimeline(u.length)).boneIndex=C;for(d=0,f=0,g=u.length;f<g;f++){x=u[f];G.setFrame(d,x.time,x.angle),this.readCurve(G,d,x),d++}r.push(G),a=Math.max(a,G.frames[2*G.getFrameCount()-2])}else if("translate"==c||"scale"==c){var S=1;"scale"==c?G=new e.ScaleTimeline(u.length):(G=new e.TranslateTimeline(u.length),S=this.scale),G.boneIndex=C;for(d=0,f=0,g=u.length;f<g;f++){var M=((x=u[f]).x||0)*S,A=(x.y||0)*S;G.setFrame(d,x.time,M,A),this.readCurve(G,d,x),d++}r.push(G),a=Math.max(a,G.frames[3*G.getFrameCount()-3])}else{if("flipX"!=c&&"flipY"!=c)throw"Invalid timeline type for a bone: "+c+" ("+I+")";(G=(M="flipX"==c)?new e.FlipXTimeline(u.length):new e.FlipYTimeline(u.length)).boneIndex=C;var T=M?"x":"y";for(d=0,f=0,g=u.length;f<g;f++){x=u[f];G.setFrame(d,x.time,x[T]||!1),d++}r.push(G),a=Math.max(a,G.frames[2*G.getFrameCount()-2])}}}var k=i.ik;for(var D in k)if(k.hasOwnProperty(D)){var P=n.findIkConstraint(D);u=k[D];(G=new e.IkConstraintTimeline(u.length)).ikConstraintIndex=n.ikConstraints.indexOf(P);for(d=0,f=0,g=u.length;f<g;f++){var E=(x=u[f]).hasOwnProperty("mix")?x.mix:1,z=!x.hasOwnProperty("bendPositive")||x.bendPositive?1:-1;G.setFrame(d,x.time,E,z),this.readCurve(G,d,x),d++}r.push(G),a=Math.max(a,G.frames[3*G.frameCount-3])}var O=i.ffd;for(var B in O){var R=n.findSkin(B);l=O[B];for(o in l){h=n.findSlotIndex(o);var L=l[o];for(var F in L){u=L[F];var G=new e.FfdTimeline(u.length),N=R.getAttachment(h,F);if(!N)throw"FFD attachment not found: "+F;G.slotIndex=h,G.attachment=N;var U,j=N.type==e.AttachmentType.mesh;U=j?N.vertices.length:N.weights.length/3*2;for(d=0,f=0,g=u.length;f<g;f++){if((x=u[f]).vertices){var Z,W=x.vertices;(Z=[]).length=U;var V=x.offset||0,X=W.length;if(1==this.scale)for(var Y=0;Y<X;Y++)Z[Y+V]=W[Y];else for(Y=0;Y<X;Y++)Z[Y+V]=W[Y]*this.scale;if(j){var H=N.vertices;for(Y=0,X=Z.length;Y<X;Y++)Z[Y]+=H[Y]}}else j?Z=N.vertices:(Z=[]).length=U;G.setFrame(d,x.time,Z),this.readCurve(G,d,x),d++}r[r.length]=G,a=Math.max(a,G.frames[G.frameCount-1])}}}var q=i.drawOrder;if(q||(q=i.draworder),q){G=new e.DrawOrderTimeline(q.length);var J=n.slots.length;for(d=0,f=0,g=q.length;f<g;f++){var Q=q[f],K=null;if(Q.offsets){(K=[]).length=J;for(Y=J-1;Y>=0;Y--)K[Y]=-1;var $=Q.offsets,tt=[];tt.length=J-$.length;var et=0,it=0;for(Y=0,X=$.length;Y<X;Y++){var nt=$[Y];if(-1==(h=n.findSlotIndex(nt.slot)))throw"Slot not found: "+nt.slot;for(;et!=h;)tt[it++]=et++;K[et+nt.offset]=et++}for(;et<J;)tt[it++]=et++;for(Y=J-1;Y>=0;Y--)-1==K[Y]&&(K[Y]=tt[--it])}G.setFrame(d++,Q.time,K)}r.push(G),a=Math.max(a,G.frames[G.getFrameCount()-1])}var rt=i.events;if(rt){for(G=new e.EventTimeline(rt.length),d=0,f=0,g=rt.length;f<g;f++){var at=rt[f],st=n.findEvent(at.name);if(!st)throw"Event not found: "+at.name;var ot=new e.Event(st);ot.intValue=at.hasOwnProperty("int")?at.int:st.intValue,ot.floatValue=at.hasOwnProperty("float")?at.float:st.floatValue,ot.stringValue=at.hasOwnProperty("string")?at.string:st.stringValue,G.setFrame(d++,at.time,ot)}r.push(G),a=Math.max(a,G.frames[G.getFrameCount()-1])}n.animations.push(new e.Animation(t,r,a))},readCurve:function(t,e,i){var n=i.curve;n?"stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,i,n){var r=t[i],a=new e.Float32Array(r.length),s=0,o=r.length;if(1==n)for(;s<o;s++)a[s]=r[s];else for(;s<o;s++)a[s]=r[s]*n;return a},getIntArray:function(t,i){for(var n=t[i],r=new e.Uint16Array(n.length),a=0,s=n.length;a<s;a++)r[a]=0|n[a];return r}},e.Atlas=function(t,i){this.textureLoader=i,this.pages=[],this.regions=[];var n=new e.AtlasReader(t),r=[];r.length=4;for(var a=null;;){var s=n.readLine();if(null===s)break;if((s=n.trim(s)).length)if(a){var o=new e.AtlasRegion;o.name=s,o.page=a,o.rotate="true"==n.readValue(),n.readTuple(r);var l=parseInt(r[0]),h=parseInt(r[1]);n.readTuple(r);var c=parseInt(r[0]),u=parseInt(r[1]);o.u=l/a.width,o.v=h/a.height,o.rotate?(o.u2=(l+u)/a.width,o.v2=(h+c)/a.height):(o.u2=(l+c)/a.width,o.v2=(h+u)/a.height),o.x=l,o.y=h,o.width=Math.abs(c),o.height=Math.abs(u),4==n.readTuple(r)&&(o.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(o.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),o.originalWidth=parseInt(r[0]),o.originalHeight=parseInt(r[1]),n.readTuple(r),o.offsetX=parseInt(r[0]),o.offsetY=parseInt(r[1]),o.index=parseInt(n.readValue()),this.regions.push(o)}else{(a=new e.AtlasPage).name=s,2==n.readTuple(r)&&(a.width=parseInt(r[0]),a.height=parseInt(r[1]),n.readTuple(r)),a.format=e.Atlas.Format[r[0]],n.readTuple(r),a.minFilter=e.Atlas.TextureFilter[r[0]],a.magFilter=e.Atlas.TextureFilter[r[1]];var d=n.readValue();a.uWrap=e.Atlas.TextureWrap.clampToEdge,a.vWrap=e.Atlas.TextureWrap.clampToEdge,"x"==d?a.uWrap=e.Atlas.TextureWrap.repeat:"y"==d?a.vWrap=e.Atlas.TextureWrap.repeat:"xy"==d&&(a.uWrap=a.vWrap=e.Atlas.TextureWrap.repeat),i.load(a,s,this),this.pages.push(a)}else a=null}},e.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;e<i;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++){var r=e[i];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},e.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},e.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},e.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},e.AtlasPage=function(){},e.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},e.AtlasRegion=function(){},e.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},e.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},e.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var n=0,r=i+1;n<3;n++){var a=e.indexOf(",",r);if(-1==a)break;t[n]=this.trim(e.substr(r,a-r)),r=a+1}return t[n]=this.trim(e.substring(r)),n+1}},e.AtlasAttachmentLoader=function(t){this.atlas=t},e.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,i,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (region attachment: "+i+")";var a=new e.RegionAttachment(i);return a.rendererObject=r,a.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),a.regionOffsetX=r.offsetX,a.regionOffsetY=r.offsetY,a.regionWidth=r.width,a.regionHeight=r.height,a.regionOriginalWidth=r.originalWidth,a.regionOriginalHeight=r.originalHeight,a},newMeshAttachment:function(t,i,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (mesh attachment: "+i+")";var a=new e.MeshAttachment(i);return a.rendererObject=r,a.regionU=r.u,a.regionV=r.v,a.regionU2=r.u2,a.regionV2=r.v2,a.regionRotate=r.rotate,a.regionOffsetX=r.offsetX,a.regionOffsetY=r.offsetY,a.regionWidth=r.width,a.regionHeight=r.height,a.regionOriginalWidth=r.originalWidth,a.regionOriginalHeight=r.originalHeight,a},newSkinnedMeshAttachment:function(t,i,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (skinned mesh attachment: "+i+")";var a=new e.SkinnedMeshAttachment(i);return a.rendererObject=r,a.regionU=r.u,a.regionV=r.v,a.regionU2=r.u2,a.regionV2=r.v2,a.regionRotate=r.rotate,a.regionOffsetX=r.offsetX,a.regionOffsetY=r.offsetY,a.regionWidth=r.width,a.regionHeight=r.height,a.regionOriginalWidth=r.originalWidth,a.regionOriginalHeight=r.originalHeight,a},newBoundingBoxAttachment:function(t,i){return new e.BoundingBoxAttachment(i)}},e.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},e.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,i){var n=t.slots,r=n.length,a=t.x,s=t.y,o=this.boundingBoxes,l=this.polygonPool,h=this.polygons;o.length=0;for(var c=0,u=h.length;c<u;c++)l.push(h[c]);h.length=0;for(c=0;c<r;c++){var d=n[c],f=d.attachment;if(f.type==e.AttachmentType.boundingbox){o.push(f);var g,p=l.length;p>0?(g=l[p-1],l.splice(p-1,1)):g=[],h.push(g),g.length=f.vertices.length,f.computeWorldVertices(a,s,d.bone,g)}}i&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,a=0,s=t.length;a<s;a++)for(var o=t[a],l=0,h=o.length;l<h;l+=2){var c=o[l],u=o[l+1];e=Math.min(e,c),i=Math.min(i,u),n=Math.max(n,c),r=Math.max(r,u)}this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,a=this.minY,s=this.maxX,o=this.maxY;if(t<=r&&i<=r||e<=a&&n<=a||t>=s&&i>=s||e>=o&&n>=o)return!1;var l=(n-e)/(i-t),h=l*(r-t)+e;if(h>a&&h<o)return!0;if((h=l*(s-t)+e)>a&&h<o)return!0;var c=(a-e)/l+t;return c>r&&c<s||(c=(o-e)/l+t)>r&&c<s},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,a=0,s=r.length;a<s;a++)if(r[a].intersectsSegment(t,e,i,n))return this.boundingBoxes[a];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,a=!1,s=0;s<n;s+=2){var o=t[s+1],l=t[r+1];if(o<i&&l>=i||l<i&&o>=i){var h=t[s];h+(i-o)/(l-o)*(t[r]-h)<e&&(a=!a)}r=s}return a},polygonIntersectsSegment:function(t,e,i,n,r){for(var a=t.length,s=e-n,o=i-r,l=e*r-i*n,h=t[a-2],c=t[a-1],u=0;u<a;u+=2){var d=t[u],f=t[u+1],g=h*f-c*d,p=h-d,m=c-f,v=s*m-o*p,_=(l*p-s*g)/v;if((_>=h&&_<=d||_>=d&&_<=h)&&(_>=e&&_<=n||_>=n&&_<=e)){var y=(l*m-o*g)/v;if((y>=c&&y<=f||y>=f&&y<=c)&&(y>=i&&y<=r||y>=r&&y<=i))return!0}h=d,c=f}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},e.Bone.yDown=!0,t.AnimCache={},t.SpineTextureLoader=function(e,i){t.EventTarget.call(this),this.basePath=e,this.crossorigin=i,this.loadingCount=0},t.SpineTextureLoader.prototype=t.SpineTextureLoader,t.SpineTextureLoader.prototype.load=function(e,i){if(e.rendererObject=t.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin),!e.rendererObject.hasLoaded){var n=this;++n.loadingCount,e.rendererObject.addEventListener("loaded",function(){--n.loadingCount,n.dispatchEvent({type:"loadedBaseTexture",content:n})})}},t.SpineTextureLoader.prototype.unload=function(t){t.destroy(!0)},t.Spine=function(i){if(t.DisplayObjectContainer.call(this),this.spineData=t.AnimCache[i],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+i);this.skeleton=new e.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new e.AnimationStateData(this.spineData),this.state=new e.AnimationState(this.stateData),this.slotContainers=[];for(var n=0,r=this.skeleton.slots.length;n<r;n++){var a=this.skeleton.slots[n],s=a.attachment,o=new t.DisplayObjectContainer;if(this.slotContainers.push(o),this.addChild(o),s instanceof e.RegionAttachment){var l=s.rendererObject.name,h=this.createSprite(a,s);a.currentSprite=h,a.currentSpriteName=l,o.addChild(h)}else{if(!(s instanceof e.MeshAttachment))continue;var c=this.createMesh(a,s);a.currentMesh=c,a.currentMeshName=s.name,o.addChild(c)}}this.autoUpdate=!0},t.Spine.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Spine.prototype.constructor=t.Spine,Object.defineProperty(t.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===t.Spine.prototype.autoUpdateTransform},set:function(e){this.updateTransform=e?t.Spine.prototype.autoUpdateTransform:t.DisplayObjectContainer.prototype.updateTransform}}),t.Spine.prototype.update=function(i){this.state.update(i),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var n=this.skeleton.drawOrder,r=this.skeleton.slots,a=0,s=n.length;a<s;a++)this.children[a]=this.slotContainers[n[a]];for(a=0,s=r.length;a<s;a++){var o=r[a],l=o.attachment,h=this.slotContainers[a];if(l){var c=l.type;if(c===e.AttachmentType.region){if(l.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!==l.name)){var u=l.rendererObject.name;if(void 0!==o.currentSprite&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{},void 0!==o.sprites[u])o.sprites[u].visible=!0;else{var d=this.createSprite(o,l);h.addChild(d)}o.currentSprite=o.sprites[u],o.currentSpriteName=u}var f=o.bone;h.position.x=f.worldX+l.x*f.m00+l.y*f.m01,h.position.y=f.worldY+l.x*f.m10+l.y*f.m11,h.scale.x=f.worldScaleX,h.scale.y=f.worldScaleY,h.rotation=-o.bone.worldRotation*e.degRad,o.currentSprite.tint=t.rgb2hex([o.r,o.g,o.b])}else{if(c!==e.AttachmentType.skinnedmesh){h.visible=!1;continue}if(!o.currentMeshName||o.currentMeshName!==l.name){var g=l.name;if(void 0!==o.currentMesh&&(o.currentMesh.visible=!1),o.meshes=o.meshes||{},void 0!==o.meshes[g])o.meshes[g].visible=!0;else{var p=this.createMesh(o,l);h.addChild(p)}o.currentMesh=o.meshes[g],o.currentMeshName=g}l.computeWorldVertices(o.bone.skeleton.x,o.bone.skeleton.y,o,o.currentMesh.vertices)}h.visible=!0,h.alpha=o.a}else h.visible=!1}},t.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(e),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Spine.prototype.createSprite=function(i,n){var r=n.rendererObject,a=r.page.rendererObject,s=new t.Rectangle(r.x,r.y,r.rotate?r.height:r.width,r.rotate?r.width:r.height),o=new t.Texture(a,s),l=new t.Sprite(o),h=r.rotate?.5*Math.PI:0;return l.scale.set(r.width/r.originalWidth,r.height/r.originalHeight),l.rotation=h-n.rotation*e.degRad,l.anchor.x=l.anchor.y=.5,i.sprites=i.sprites||{},i.sprites[r.name]=l,l},t.Spine.prototype.createMesh=function(e,i){var n=i.rendererObject.page.rendererObject,r=new t.Texture(n),a=new t.Strip(r);return a.drawMode=t.Strip.DrawModes.TRIANGLES,a.canvasPadding=1.5,a.vertices=new t.Float32Array(i.uvs.length),a.uvs=i.uvs,a.indices=i.triangles,e.meshes=e.meshes||{},e.meshes[i.name]=a,a},t.BaseTextureCache={},t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this._UID=t._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],e){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var n=this;this.source.onload=function(){n.hasLoaded=!0,n.width=n.source.naturalWidth||n.source.width,n.height=n.source.naturalHeight||n.source.height,n.dirty(),n.dispatchEvent({type:"loaded",content:n})},this.source.onerror=function(){n.dispatchEvent({type:"error",content:n})}}this.imageUrl=null,this._powerOf2=!1}},t.BaseTexture.prototype.constructor=t.BaseTexture,t.EventTarget.mixin(t.BaseTexture.prototype),t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},t.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1,this.source.src=null,this.source.src=t},t.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},t.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var e=this._glTextures.length-1;e>=0;e--){var i=this._glTextures[e],n=t.glContexts[e];n&&i&&n.deleteTexture(i)}this._glTextures.length=0,this.dirty()},t.BaseTexture.fromImage=function(e,i,n){var r=t.BaseTextureCache[e];if(void 0===i&&-1===e.indexOf("data:")&&(i=!0),!r){var a=new Image;i&&(a.crossOrigin=""),a.src=e,(r=new t.BaseTexture(a,n)).imageUrl=e,t.BaseTextureCache[e]=r,-1!==e.indexOf(t.RETINA_PREFIX+".")&&(r.resolution=2)}return r},t.BaseTexture.fromCanvas=function(e,i){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var n=t.BaseTextureCache[e._pixiId];return n||(n=new t.BaseTexture(e,i),t.BaseTextureCache[e._pixiId]=n),n},t.TextureCache={},t.FrameCache={},t.TextureCacheIdGenerator=0,t.Texture=function(e,i,n,r){this.noFrame=!1,i||(this.noFrame=!0,i=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=i,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=n||new t.Rectangle(0,0,1,1),e.hasLoaded?(this.noFrame&&(i=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(i)):e.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},t.Texture.prototype.constructor=t.Texture,t.EventTarget.mixin(t.Texture.prototype),t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},t.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,i=this.baseTexture.width,n=this.baseTexture.height;this._uvs.x0=e.x/i,this._uvs.y0=e.y/n,this._uvs.x1=(e.x+e.width)/i,this._uvs.y1=e.y/n,this._uvs.x2=(e.x+e.width)/i,this._uvs.y2=(e.y+e.height)/n,this._uvs.x3=e.x/i,this._uvs.y3=(e.y+e.height)/n},t.Texture.fromImage=function(e,i,n){var r=t.TextureCache[e];return r||(r=new t.Texture(t.BaseTexture.fromImage(e,i,n)),t.TextureCache[e]=r),r},t.Texture.fromFrame=function(e){var i=t.TextureCache[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return i},t.Texture.fromCanvas=function(e,i){var n=t.BaseTexture.fromCanvas(e,i);return new t.Texture(n)},t.Texture.addTextureToCache=function(e,i){t.TextureCache[i]=e},t.Texture.removeTextureFromCache=function(e){var i=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],i},t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.Texture.emptyTexture=new t.Texture(new t.BaseTexture),t.RenderTexture=function(e,i,n,r,a){if(this.width=e||100,this.height=i||100,this.resolution=a||1,this.frame=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=r||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,t.Texture.call(this,this.baseTexture,new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=n||t.defaultRenderer,this.renderer.type===t.WEBGL_RENDERER){var s=this.renderer.gl;this.baseTexture._dirty[s.id]=!1,this.textureBuffer=new t.FilterTexture(s,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[s.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,i,n){e===this.width&&i===this.height||(this.valid=e>0&&i>0,this.width=e,this.height=i,this.frame.width=this.crop.width=e*this.resolution,this.frame.height=this.crop.height=i*this.resolution,n&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},t.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},t.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1),t.worldAlpha=1;for(var r=t.children,a=0,s=r.length;a<s;a++)r[a].updateTransform();var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},t.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),e&&n.append(e),t.worldAlpha=1;for(var r=t.children,a=0,s=r.length;a<s;a++)r[a].updateTransform();i&&this.textureBuffer.clear();var o=this.textureBuffer.context,l=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,o),this.renderer.resolution=l}},t.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},t.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},t.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===t.WEBGL_RENDERER){var e=this.renderer.gl,i=this.textureBuffer.width,n=this.textureBuffer.height,r=new Uint8Array(4*i*n);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var a=new t.CanvasBuffer(i,n),s=a.context.getImageData(0,0,i,n);return s.data.set(r),a.context.putImageData(s,0,0),a.canvas}return this.textureBuffer.canvas},t.RenderTexture.tempMatrix=new t.Matrix,t.VideoTexture=function(e,i){if(!e)throw new Error("No video source element specified.");(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),t.BaseTexture.call(this,e,i),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),e.complete||(this._onCanPlay=this.onCanPlay.bind(this),e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("play",this.onPlayStart.bind(this)),e.addEventListener("pause",this.onPlayStop.bind(this)))},t.VideoTexture.prototype=Object.create(t.BaseTexture.prototype),t.VideoTexture.constructor=t.VideoTexture,t.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},t.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},t.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},t.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))},t.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(t.BaseTextureCache[this.source._pixiId]=null,delete t.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),t.BaseTexture.prototype.destroy.call(this)},t.VideoTexture.baseTextureFromVideo=function(e,i){e._pixiId||(e._pixiId="video_"+t.TextureCacheIdGenerator++);var n=t.BaseTextureCache[e._pixiId];return n||(n=new t.VideoTexture(e,i),t.BaseTextureCache[e._pixiId]=n),n},t.VideoTexture.textureFromVideo=function(e,i){var n=t.VideoTexture.baseTextureFromVideo(e,i);return new t.Texture(n)},t.VideoTexture.fromUrl=function(e,i){var n=document.createElement("video");return n.src=e,n.autoPlay=!0,n.play(),t.VideoTexture.textureFromVideo(n,i)},t.AssetLoader=function(e,i){this.assetURLs=e,this.crossorigin=i,this.loadersByType={jpg:t.ImageLoader,jpeg:t.ImageLoader,png:t.ImageLoader,gif:t.ImageLoader,webp:t.ImageLoader,json:t.JsonLoader,atlas:t.AtlasLoader,anim:t.SpineLoader,xml:t.BitmapFontLoader,fnt:t.BitmapFontLoader}},t.EventTarget.mixin(t.AssetLoader.prototype),t.AssetLoader.prototype.constructor=t.AssetLoader,t.AssetLoader.prototype._getDataType=function(t){if("data:"===t.slice(0,"data:".length).toLowerCase()){var e=t.slice("data:".length),i=e.indexOf(",");if(-1===i)return null;var n=e.slice(0,i).split(";")[0];return n&&"text/plain"!==n.toLowerCase()?n.split("/").pop().toLowerCase():"txt"}return null},t.AssetLoader.prototype.load=function(){var t=this;function e(e){t.onAssetLoaded(e.data.content)}this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var n=this.assetURLs[i],r=this._getDataType(n);r||(r=n.split("?").shift().split(".").pop().toLowerCase());var a=this.loadersByType[r];if(!a)throw new Error(r+" is an unsupported file type");var s=new a(n,this.crossorigin);s.on("loaded",e),s.load()}},t.AssetLoader.prototype.onAssetLoaded=function(t){this.loadCount--,this.emit("onProgress",{content:this,loader:t,loaded:this.assetURLs.length-this.loadCount,total:this.assetURLs.length}),this.onProgress&&this.onProgress(t),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},t.JsonLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},t.JsonLoader.prototype.constructor=t.JsonLoader,t.EventTarget.mixin(t.JsonLoader.prototype),t.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},t.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},t.JsonLoader.prototype.onJSONLoaded=function(){if(this.ajaxRequest.responseText)if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames&&this.json.meta&&this.json.meta.image){var i=this.json.meta.image;-1===i.indexOf("data:")&&(i=this.baseUrl+i);var n=new t.ImageLoader(i,this.crossorigin),r=this.json.frames;for(var a in this.texture=n.texture.baseTexture,n.addEventListener("loaded",this.onLoaded.bind(this)),r){var s=r[a].frame;if(s){var o=new t.Rectangle(s.x,s.y,s.w,s.h),l=o.clone(),h=null;if(r[a].trimmed){var c=r[a].sourceSize,u=r[a].spriteSourceSize;h=new t.Rectangle(u.x,u.y,c.w,c.h)}t.TextureCache[a]=new t.Texture(this.texture,o,l,h)}}n.load()}else if(this.json.bones)if(t.AnimCache[this.url])this.onLoaded();else{var d=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",f=new t.JsonLoader(d,this.crossorigin),g=this;f.onJSONLoaded=function(){if(this.ajaxRequest.responseText){var i=new t.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),n=new e.Atlas(this.ajaxRequest.responseText,i),r=new e.AtlasAttachmentLoader(n),a=new e.SkeletonJson(r).readSkeletonData(g.json);t.AnimCache[g.url]=a,g.spine=a,g.spineAtlas=n,g.spineAtlasLoader=f,i.loadingCount>0?i.addEventListener("loadedBaseTexture",function(t){t.content.content.loadingCount<=0&&g.onLoaded()}):g.onLoaded()}else this.onError()},f.load()}else this.onLoaded();else this.onError()},t.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},t.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},t.AtlasLoader=function(t,e){this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},t.AtlasLoader.constructor=t.AtlasLoader,t.EventTarget.mixin(t.AtlasLoader.prototype),t.AtlasLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},t.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var e=this.ajaxRequest.responseText.split(/\r?\n/),i=-3,n=0,r=null,a=!1,s=0,o=0,l=this.onLoaded.bind(this);for(s=0;s<e.length;s++)if(e[s]=e[s].replace(/^\s+|\s+$/g,""),""===e[s]&&(a=s+1),e[s].length>0){if(a===s)this.atlas.meta.image.push(e[s]),n=this.atlas.meta.image.length-1,this.atlas.frames.push({}),i=-3;else if(i>0)if(i%7==1)null!=r&&(this.atlas.frames[n][r.name]=r),r={name:e[s],frame:{}};else{var h=e[s].split(" ");if(i%7==3)r.frame.x=Number(h[1].replace(",","")),r.frame.y=Number(h[2]);else if(i%7==4)r.frame.w=Number(h[1].replace(",","")),r.frame.h=Number(h[2]);else if(i%7==5){var c={x:0,y:0,w:Number(h[1].replace(",","")),h:Number(h[2])};c.w>r.frame.w||c.h>r.frame.h?(r.trimmed=!0,r.realSize=c):r.trimmed=!1}}i++}if(null!=r&&(this.atlas.frames[n][r.name]=r),this.atlas.meta.image.length>0){for(this.images=[],o=0;o<this.atlas.meta.image.length;o++){var u=this.baseUrl+this.atlas.meta.image[o],d=this.atlas.frames[o];for(s in this.images.push(new t.ImageLoader(u,this.crossorigin)),d){var f=d[s].frame;f&&(t.TextureCache[s]=new t.Texture(this.images[o].texture.baseTexture,{x:f.x,y:f.y,width:f.w,height:f.h}),d[s].trimmed&&(t.TextureCache[s].realSize=d[s].realSize,t.TextureCache[s].trim.x=0,t.TextureCache[s].trim.y=0))}}for(this.currentImageId=0,o=0;o<this.images.length;o++)this.images[o].on("loaded",l);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},t.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},t.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},t.SpriteSheetLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},t.SpriteSheetLoader.prototype.constructor=t.SpriteSheetLoader,t.EventTarget.mixin(t.SpriteSheetLoader.prototype),t.SpriteSheetLoader.prototype.load=function(){var e=this,i=new t.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),i.load()},t.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader=function(e,i){this.texture=t.Texture.fromImage(e,i),this.frames=[]},t.ImageLoader.prototype.constructor=t.ImageLoader,t.EventTarget.mixin(t.ImageLoader.prototype),t.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},t.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader.prototype.loadFramedSpriteSheet=function(e,i,n){this.frames=[];for(var r=Math.floor(this.texture.width/e),a=Math.floor(this.texture.height/i),s=0,o=0;o<a;o++)for(var l=0;l<r;l++,s++){var h=new t.Texture(this.texture.baseTexture,{x:l*e,y:o*i,width:e,height:i});this.frames.push(h),n&&(t.TextureCache[n+"-"+s]=h)}this.load()},t.BitmapFontLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},t.BitmapFontLoader.prototype.constructor=t.BitmapFontLoader,t.EventTarget.mixin(t.BitmapFontLoader.prototype),t.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},t.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var e=this.ajaxRequest.responseXML;if(!e||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){e=(new DOMParser).parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var i=document.createElement("div");i.innerHTML=this.ajaxRequest.responseText,e=i}var n=this.baseUrl+e.getElementsByTagName("page")[0].getAttribute("file"),r=new t.ImageLoader(n,this.crossorigin);this.texture=r.texture.baseTexture;var a={},s=e.getElementsByTagName("info")[0],o=e.getElementsByTagName("common")[0];a.font=s.getAttribute("face"),a.size=parseInt(s.getAttribute("size"),10),a.lineHeight=parseInt(o.getAttribute("lineHeight"),10),a.chars={};for(var l=e.getElementsByTagName("char"),h=0;h<l.length;h++){var c=parseInt(l[h].getAttribute("id"),10),u=new t.Rectangle(parseInt(l[h].getAttribute("x"),10),parseInt(l[h].getAttribute("y"),10),parseInt(l[h].getAttribute("width"),10),parseInt(l[h].getAttribute("height"),10));a.chars[c]={xOffset:parseInt(l[h].getAttribute("xoffset"),10),yOffset:parseInt(l[h].getAttribute("yoffset"),10),xAdvance:parseInt(l[h].getAttribute("xadvance"),10),kerning:{},texture:t.TextureCache[c]=new t.Texture(this.texture,u)}}var d=e.getElementsByTagName("kerning");for(h=0;h<d.length;h++){var f=parseInt(d[h].getAttribute("first"),10),g=parseInt(d[h].getAttribute("second"),10),p=parseInt(d[h].getAttribute("amount"),10);a.chars[g].kerning[f]=p}t.BitmapText.fonts[a.font]=a,r.addEventListener("loaded",this.onLoaded.bind(this)),r.load()}},t.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.SpineLoader=function(t,e){this.url=t,this.crossorigin=e,this.loaded=!1},t.SpineLoader.prototype.constructor=t.SpineLoader,t.EventTarget.mixin(t.SpineLoader.prototype),t.SpineLoader.prototype.load=function(){var e=this,i=new t.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),i.load()},t.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},t.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},t.AbstractFilter.prototype.constructor=t.AbstractFilter,t.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},t.AlphaMaskFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:e},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mask.value.x=e.width,this.uniforms.mask.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},t.AlphaMaskFilter.prototype=Object.create(t.AbstractFilter.prototype),t.AlphaMaskFilter.prototype.constructor=t.AlphaMaskFilter,t.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}}),t.ColorMatrixFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},t.ColorMatrixFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorMatrixFilter.prototype.constructor=t.ColorMatrixFilter,Object.defineProperty(t.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}}),t.GrayFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},t.GrayFilter.prototype=Object.create(t.AbstractFilter.prototype),t.GrayFilter.prototype.constructor=t.GrayFilter,Object.defineProperty(t.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}),t.DisplacementFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:e},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=e.width,this.uniforms.mapDimensions.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},t.DisplacementFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DisplacementFilter.prototype.constructor=t.DisplacementFilter,t.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(t.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(t.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),t.PixelateFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new t.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},t.PixelateFilter.prototype=Object.create(t.AbstractFilter.prototype),t.PixelateFilter.prototype.constructor=t.PixelateFilter,Object.defineProperty(t.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.dirty=!0,this.uniforms.pixelSize.value=t}}),t.BlurXFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurXFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurXFilter.prototype.constructor=t.BlurXFilter,Object.defineProperty(t.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),t.BlurYFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurYFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurYFilter.prototype.constructor=t.BlurYFilter,Object.defineProperty(t.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),t.BlurFilter=function(){this.blurXFilter=new t.BlurXFilter,this.blurYFilter=new t.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},t.BlurFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurFilter.prototype.constructor=t.BlurFilter,Object.defineProperty(t.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}}),Object.defineProperty(t.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}}),Object.defineProperty(t.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}),t.InvertFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},t.InvertFilter.prototype=Object.create(t.AbstractFilter.prototype),t.InvertFilter.prototype.constructor=t.InvertFilter,Object.defineProperty(t.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}),t.SepiaFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},t.SepiaFilter.prototype=Object.create(t.AbstractFilter.prototype),t.SepiaFilter.prototype.constructor=t.SepiaFilter,Object.defineProperty(t.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}),t.TwistFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},t.TwistFilter.prototype=Object.create(t.AbstractFilter.prototype),t.TwistFilter.prototype.constructor=t.TwistFilter,Object.defineProperty(t.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.dirty=!0,this.uniforms.offset.value=t}}),Object.defineProperty(t.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(t){this.dirty=!0,this.uniforms.radius.value=t}}),Object.defineProperty(t.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),t.ColorStepFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},t.ColorStepFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorStepFilter.prototype.constructor=t.ColorStepFilter,Object.defineProperty(t.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}}),t.DotScreenFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},t.DotScreenFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DotScreenFilter.prototype.constructor=t.DotScreenFilter,Object.defineProperty(t.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.dirty=!0,this.uniforms.scale.value=t}}),Object.defineProperty(t.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),t.CrossHatchFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},t.CrossHatchFilter.prototype=Object.create(t.AbstractFilter.prototype),t.CrossHatchFilter.prototype.constructor=t.CrossHatchFilter,Object.defineProperty(t.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),t.RGBSplitFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},t.RGBSplitFilter.prototype=Object.create(t.AbstractFilter.prototype),t.RGBSplitFilter.prototype.constructor=t.RGBSplitFilter,Object.defineProperty(t.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}}),Object.defineProperty(t.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}}),Object.defineProperty(t.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.PIXI=t):"undefined"!=typeof define&&define.amd?define(t):this.PIXI=t}.call(this),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){var e,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],a=Array.prototype.slice;if(t.event.fixHooks)for(var s=n.length;s;)t.event.fixHooks[n[--s]]=t.event.mouseHooks;var o=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=r.length;e;)this.addEventListener(r[--e],l,!1);else this.onmousewheel=l;t.data(this,"mousewheel-line-height",o.getLineHeight(this)),t.data(this,"mousewheel-page-height",o.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=r.length;e;)this.removeEventListener(r[--e],l,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var i=t(e),n=i["offsetParent"in t.fn?"offsetParent":"parent"]();return n.length||(n=t("body")),parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function l(n){var r,s=n||window.event,l=a.call(arguments,1),u=0,d=0,f=0,g=0,p=0;if((n=t.event.fix(s)).type="mousewheel","detail"in s&&(f=-1*s.detail),"wheelDelta"in s&&(f=s.wheelDelta),"wheelDeltaY"in s&&(f=s.wheelDeltaY),"wheelDeltaX"in s&&(d=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(d=-1*f,f=0),u=0===f?d:f,"deltaY"in s&&(u=f=-1*s.deltaY),"deltaX"in s&&(d=s.deltaX,0===f&&(u=-1*d)),0!==f||0!==d){if(1===s.deltaMode){var m=t.data(this,"mousewheel-line-height");u*=m,f*=m,d*=m}else if(2===s.deltaMode){var v=t.data(this,"mousewheel-page-height");u*=v,f*=v,d*=v}if(r=Math.max(Math.abs(f),Math.abs(d)),(!i||r<i)&&(i=r,c(s,r)&&(i/=40)),c(s,r)&&(u/=40,d/=40,f/=40),u=Math[u>=1?"floor":"ceil"](u/i),d=Math[d>=1?"floor":"ceil"](d/i),f=Math[f>=1?"floor":"ceil"](f/i),o.settings.normalizeOffset&&this.getBoundingClientRect){var _=this.getBoundingClientRect();g=n.clientX-_.left,p=n.clientY-_.top}return n.deltaX=d,n.deltaY=f,n.deltaFactor=i,n.offsetX=g,n.offsetY=p,n.deltaMode=0,l.unshift(n,u,d,f),e&&clearTimeout(e),e=setTimeout(h,200),(t.event.dispatch||t.event.handle).apply(this,l)}}function h(){i=null}function c(t,e){return o.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(){var t,e,i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S,M,A,T,k,D={}.hasOwnProperty,P=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},E=[].slice;C=Array.prototype.slice,t=function(t,e){return null==e&&(e=document),"object"==typeof t||"undefined"!=typeof exports&&null!==exports?t:e.querySelector(t)},b=function(){function t(){}var e;return t.uniqid=(e=0,{get:function(){return e++}}),t.extend=function(t){var e,i,n,r,a,s;for(i=t,a=0,s=(r=C.call(arguments,1)).length;a<s;a++)for(n in e=r[a])D.call(e,n)&&(i[n]=e[n]);return i},t.clampRGB=function(t){return t<0?0:t>255?255:t},t.copyAttributes=function(t,e,i){var n,r,a,s,o,l;for(null==i&&(i={}),l=[],r=0,a=(s=t.attributes).length;r<a;r++)n=s[r],null!=i.except&&(o=n.nodeName,P.call(i.except,o)>=0)||l.push(e.setAttribute(n.nodeName,n.nodeValue));return l},t.dataArray=function(t){return null==t&&(t=0),r.NodeJS||null!=window.Uint8Array?new Uint8Array(t):new Array(t)},t}(),"undefined"!=typeof exports&&null!==exports?(y=exports,s=require("canvas"),d=s.Image,h=require("fibers"),I=require("fs")):y=window,y.Caman=r=function(){function i(){var t,n,r,a=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof i?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),t=arguments[0],i.NodeJS||(r=parseInt(i.getAttrId(t[0]),10),n="function"==typeof t[1]?t[1]:"function"==typeof t[2]?t[2]:function(){},isNaN(r)||!x.has(r))?(this.id=b.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new e(this),this.renderer=new _(this),this.domIsLoaded(function(){return a.parseArguments(t),a.setup()}),this):x.execute(r,n)):new i(arguments)}return i.version={release:"4.1.1",date:"4/8/2013"},i.DEBUG=!1,i.NodeJS="undefined"!=typeof exports&&null!==exports,i.autoload=!i.NodeJS,i.allowRevert=!0,i.crossOrigin="anonymous",i.toString=function(){return"Version "+i.version.release+", Released "+i.version.date},i.remoteProxy="",i.proxyParam="camanProxyUrl",i.getAttrId=function(e){return!!i.NodeJS||("string"==typeof e&&(e=t(e)),null==e||null==e.getAttribute?null:e.getAttribute("data-caman-id"))},i.prototype.domIsLoaded=function(t){var e,n=this;return i.NodeJS?setTimeout(function(){return t.call(n)},0):"complete"===document.readyState?(g.debug("DOM initialized"),setTimeout(function(){return t.call(n)},0)):(e=function(){if("complete"===document.readyState)return g.debug("DOM initialized"),t.call(n)},document.addEventListener("readystatechange",e,!1))},i.prototype.parseArguments=function(t){var e,i,n,r;if(0===t.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(t[0]),1!==t.length){switch(typeof t[1]){case"string":this.imageUrl=t[1];break;case"function":this.callback=t[1]}if(2!==t.length&&(this.callback=t[2],4===t.length)){for(e in r=[],n=t[4])D.call(n,e)&&(i=n[e],r.push(this.options[e]=i));return r}}},i.prototype.setInitObject=function(e){if(i.NodeJS)return this.initObj=e,void(this.initType="node");if(this.initObj="object"==typeof e?e:t(e),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},i.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},i.prototype.initNode=function(){var t=this;return g.debug("Initializing for NodeJS"),this.image=new d,this.image.onload=function(){return g.debug("Image loaded. Width = "+t.imageWidth()+", Height = "+t.imageHeight()),t.canvas=new s(t.imageWidth(),t.imageHeight()),t.finishInit()},this.image.onerror=function(t){throw t},this.image.src=this.initObj},i.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),b.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},i.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},i.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(g.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),u.isRemote(this.image))return this.image.src=u.proxyUrl(this.image.src),g.debug("Remote image detected, using URL = "+this.image.src)},i.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},i.prototype.isImageLoaded=function(){return!!this.image.complete&&(null==this.image.naturalWidth||0!==this.image.naturalWidth)},i.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},i.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},i.prototype.imageLoaded=function(){return g.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},i.prototype.finishInit=function(){var t,e,n,r,a;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.reloadCanvasData(),i.allowRevert)for(this.initializedPixelData=b.dataArray(this.pixelData.length),this.originalPixelData=b.dataArray(this.pixelData.length),t=n=0,r=(a=this.pixelData).length;n<r;t=++n)e=a[t],this.initializedPixelData[t]=e,this.originalPixelData[t]=e;return this.dimensions={width:this.canvas.width,height:this.canvas.height},x.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},i.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},i.prototype.resetOriginalPixelData=function(){var t,e,n,r,a;if(!i.allowRevert)throw"Revert disabled";for(this.originalPixelData=b.dataArray(this.pixelData.length),a=[],e=0,n=(r=this.pixelData).length;e<n;e++)t=r[e],a.push(this.originalPixelData.push(t));return a},i.prototype.hasId=function(){return null!=i.getAttrId(this.canvas)},i.prototype.assignId=function(){if(!i.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},i.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},i.prototype.hiDPIAdjustments=function(){var t;if(!i.NodeJS&&!this.hiDPIDisabled())return 1!==(t=this.hiDPIRatio())?(g.debug("HiDPI ratio = "+t),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*t,this.canvas.height=this.preScaledHeight*t,this.canvas.style.width=this.preScaledWidth+"px",this.canvas.style.height=this.preScaledHeight+"px",this.context.scale(t,t),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},i.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)},i.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},i.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},i.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},i.prototype.replaceCanvas=function(t){var e;return e=this.canvas,this.canvas=t,this.context=this.canvas.getContext("2d"),e.parentNode.replaceChild(this.canvas,e),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},i.prototype.render=function(t){var e=this;return null==t&&(t=function(){}),l.trigger(this,"renderStart"),this.renderer.execute(function(){return e.context.putImageData(e.imageData,0,0),t.call(e)})},i.prototype.revert=function(){var t,e,n,r,a;if(!i.allowRevert)throw"Revert disabled";for(t=n=0,r=(a=this.originalVisiblePixels()).length;n<r;t=++n)e=a[t],this.pixelData[t]=e;return this.context.putImageData(this.imageData,0,0)},i.prototype.reset=function(){var t,e,i,n,r,a,s,o,l;for(t=document.createElement("canvas"),b.copyAttributes(this.canvas,t),t.width=this.originalWidth,t.height=this.originalHeight,a=(n=(e=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,i=s=0,o=(l=this.initializedPixelData).length;s<o;i=++s)r=l[i],a[i]=r;return e.putImageData(n,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(t)},i.prototype.originalVisiblePixels=function(){var t,e,n,r,a,s,o,l,h,c,u,d,f,g,p,v,_,y,x,b,I;if(!i.allowRevert)throw"Revert disabled";if(c=[],r=(d=this.cropCoordinates.x)+this.width,a=(f=this.cropCoordinates.y)+this.height,this.resized){for((t=document.createElement("canvas")).width=this.originalWidth,t.height=this.originalHeight,h=(o=(n=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,s=p=0,_=(y=this.originalPixelData).length;p<_;s=++p)l=y[s],h[s]=l;n.putImageData(o,0,0),(u=document.createElement("canvas")).width=this.width,u.height=this.height,(n=u.getContext("2d")).drawImage(t,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),h=n.getImageData(0,0,this.width,this.height).data,g=this.width}else h=this.originalPixelData,g=this.originalWidth;for(s=v=0,x=h.length;v<x;s=v+=4)d<=(b=(e=m.locationToCoordinates(s,g)).x)&&b<r&&f<=(I=e.y)&&I<a&&c.push(h[s],h[s+1],h[s+2],h[s+3]);return c},i.prototype.process=function(t,e){return this.renderer.add({type:c.Type.Single,name:t,processFn:e}),this},i.prototype.processKernel=function(t,e,i,n){var r,a,s;if(!i)for(i=0,r=a=0,s=e.length;0<=s?a<s:a>s;r=0<=s?++a:--a)i+=e[r];return this.renderer.add({type:c.Type.Kernel,name:t,adjust:e,divisor:i,bias:n||0}),this},i.prototype.processPlugin=function(t,e){return this.renderer.add({type:c.Type.Plugin,plugin:t,args:e}),this},i.prototype.newLayer=function(t){var e;return e=new f(this),this.canvasQueue.push(e),this.renderer.add({type:c.Type.LayerDequeue}),t.call(e),this.renderer.add({type:c.Type.LayerFinished}),this},i.prototype.executeLayer=function(t){return this.pushContext(t)},i.prototype.pushContext=function(t){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData},i.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},i.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},i}(),e=function(){function t(t){this.c=t}return t.prototype.calculateLevels=function(){var t,e,i,n,r,a,s;for(e={r:{},g:{},b:{}},t=n=0;n<=255;t=++n)e.r[t]=0,e.g[t]=0,e.b[t]=0;for(t=r=0,s=this.c.pixelData.length;r<s;t=r+=4)e.r[this.c.pixelData[t]]++,e.g[this.c.pixelData[t+1]]++,e.b[this.c.pixelData[t+2]]++;for(i=this.c.pixelData.length/4,t=a=0;a<=255;t=++a)e.r[t]/=i,e.g[t]/=i,e.b[t]/=i;return e},t}(),r.DOMUpdated=function(){var t,e,i,n,r;if((e=document.querySelectorAll("img[data-caman]")).length>0){for(r=[],i=0,n=e.length;i<n;i++)t=e[i],r.push(new a(t,function(){return this.parse(),this.execute()}));return r}},r.autoload&&("complete"===document.readyState?r.DOMUpdated():document.addEventListener("DOMContentLoaded",r.DOMUpdated,!1)),a=function(){function t(t,e){this.dataStr=t.getAttribute("data-caman"),this.caman=r(t,e.bind(this))}return"(\\w+)\\((.*?)\\)",t.prototype.parse=function(){var t,e,i,n,r,a,s,o,l,h;if(this.ele=this.caman.canvas,r=new RegExp("(\\w+)\\((.*?)\\)","g"),(a=this.dataStr.match(r)).length>0){for(r=new RegExp("(\\w+)\\((.*?)\\)"),h=[],s=0,o=a.length;s<o;s++){(l=a[s].match(r))[0],e=l[1],t=l[2],n=new Function("return function() {        this."+e+"("+t+");      };");try{i=n(),h.push(i.call(this.caman))}catch(t){h.push(g.debug(t))}}return h}},t.prototype.execute=function(){var t;return t=this.ele,this.caman.render(function(){return t.parentNode.replaceChild(this.toImage(),t)})},t}(),r.Blender=i=function(){function t(){}return t.blenders={},t.register=function(t,e){return this.blenders[t]=e},t.execute=function(t,e,i){return this.blenders[t](e,i)},t}(),r.Calculate=n=function(){function t(){}return t.distance=function(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))},t.randomRange=function(t,e,i){var n;return null==i&&(i=!1),n=t+Math.random()*(e-t),i?n.toFixed(i):Math.round(n)},t.luminance=function(t){return.299*t.r+.587*t.g+.114*t.b},t.bezier=function(t,e,i,n,r,a){var s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S,M,A,T,k,D,P,E;for(x=t[0],w=t[1],b=e[0],S=e[1],I=i[0],M=i[1],C=n[0],A=n[1],d={},s=C-x-(c=parseInt(3*(b-x),10))-(l=3*(I-b)-c),o=A-w-(u=3*(S-w))-(h=3*(M-S)-u),p=T=0;T<1e3;p=++T)y=p/1e3,f=Math.round(s*Math.pow(y,3)+l*Math.pow(y,2)+c*y+x),g=Math.round(o*Math.pow(y,3)+h*Math.pow(y,2)+u*y+w),r&&g<r?g=r:a&&g>a&&(g=a),d[f]=g;if(d.length<n[0]+1)for(p=k=0,P=n[0];0<=P?k<=P:k>=P;p=0<=P?++k:--k)if(null==d[p]){for(v=[p-1,d[p-1]],m=D=p,E=n[0];p<=E?D<=E:D>=E;m=p<=E?++D:--D)if(null!=d[m]){_=[m,d[m]];break}d[p]=v[1]+(_[1]-v[1])/(_[0]-v[0])*(p-v[0])}return null==d[n[0]]&&(d[n[0]]=d[n[0]-1]),d},t}(),o=function(){function t(){}return t.hexToRGB=function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}},t.rgbToHSL=function(t,e,i){var n,r,a,s,o,l;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),t/=255,e/=255,i/=255,s=Math.max(t,e,i),o=Math.min(t,e,i),a=(s+o)/2,s===o?r=l=0:(n=s-o,l=a>.5?n/(2-s-o):n/(s+o),r=function(){switch(s){case t:return(e-i)/n+(e<i?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:l,l:a}},t.hslToRGB=function(t,e,i){var n,r,a,s,o;return"object"==typeof t&&(e=t.s,i=t.l,t=t.h),0===e?o=r=n=i:(a=2*i-(s=i<.5?i*(1+e):i+e-i*e),o=this.hueToRGB(a,s,t+1/3),r=this.hueToRGB(a,s,t),n=this.hueToRGB(a,s,t-1/3)),{r:255*o,g:255*r,b:255*n}},t.hueToRGB=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},t.rgbToHSV=function(t,e,i){var n,r,a,s,o,l;return t/=255,e/=255,i/=255,a=Math.max(t,e,i),s=Math.min(t,e,i),l=a,n=a-s,o=0===a?0:n/a,a===s?r=0:(r=function(){switch(a){case t:return(e-i)/n+(e<i?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:o,v:l}},t.hsvToRGB=function(t,e,i){var n,r,a,s,o,l,h,c;switch(o=i*(1-e),l=i*(1-(r=6*t-(s=Math.floor(6*t)))*e),c=i*(1-(1-r)*e),s%6){case 0:h=i,a=c,n=o;break;case 1:h=l,a=i,n=o;break;case 2:h=o,a=i,n=c;break;case 3:h=o,a=l,n=i;break;case 4:h=c,a=o,n=i;break;case 5:h=i,a=o,n=l}return{r:255*h,g:255*a,b:255*n}},t.rgbToXYZ=function(t,e,i){return e/=255,i/=255,(t/=255)>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:100*(.4124*t+.3576*e+.1805*i),y:100*(.2126*t+.7152*e+.0722*i),z:100*(.0193*t+.1192*e+.9505*i)}},t.xyzToRGB=function(t,e,i){var n,r,a;return r=-.9689*(t/=100)+1.8758*(e/=100)+.0415*(i/=100),n=.0557*t+-.204*e+1.057*i,(a=3.2406*t+-1.5372*e+-.4986*i)>.0031308?a=1.055*Math.pow(a,.4166666667)-.055:a*=12.92,r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,n>.0031308?n=1.055*Math.pow(n,.4166666667)-.055:n*=12.92,{r:255*a,g:255*r,b:255*n}},t.xyzToLab=function(t,e,i){return"object"==typeof t&&(e=t.y,i=t.z,t=t.x),95.047,100,108.883,e/=100,i/=108.883,t=(t/=95.047)>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345,{l:116*(e=e>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345)-16,a:500*(t-e),b:200*(e-(i=i>.008856451679?Math.pow(i,.3333333333):7.787037037*i+.1379310345))}},t.labToXYZ=function(t,e,i){var n,r,a;return"object"==typeof t&&(e=t.a,i=t.b,t=t.l),a=(r=(t+16)/116)-i/200,(n=r+e/500)>.2068965517?n*=n*n:n=.1284185493*(n-.1379310345),r>.2068965517?r*=r*r:r=.1284185493*(r-.1379310345),a>.2068965517?a*=a*a:a=.1284185493*(a-.1379310345),{x:95.047*n,y:100*r,z:108.883*a}},t.rgbToLab=function(t,e,i){var n;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),n=this.rgbToXYZ(t,e,i),this.xyzToLab(n)},t.labToRGB=function(t,e,i){},t}(),l=function(){function t(){}return t.events={},t.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],t.trigger=function(t,e,i){var n,r,a,s,o;if(this.events[e]&&this.events[e].length){for(o=[],r=0,a=(s=this.events[e]).length;r<a;r++)null===(n=s[r]).target||t.id===n.target.id?o.push(n.fn.call(t,i)):o.push(void 0);return o}},t.listen=function(t,e,i){var n,r;return"string"==typeof t&&(r=t,n=e,t=null,e=r,i=n),!(P.call(this.types,e)<0)&&(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:i}),!0)},t}(),r.Event=l,r.Filter=c=function(){function t(){}return t.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},t.register=function(t,e){return r.prototype[t]=e},t}(),r.IO=u=function(){function t(){}return t.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,t.isRemote=function(t){return null!=t&&(!this.corsEnabled(t)&&this.isURLRemote(t.src))},t.corsEnabled=function(t){var e;return null!=t.crossOrigin&&("anonymous"===(e=t.crossOrigin.toLowerCase())||"use-credentials"===e)},t.isURLRemote=function(t){var e;return!!(e=t.match(this.domainRegex))&&e[1]!==document.domain},t.remoteCheck=function(t){if(this.isURLRemote(t)){if(r.remoteProxy.length)return r.isURLRemote(r.remoteProxy)?void p.info("Cannot use a remote proxy for loading images."):r.remoteProxy+"?camanProxyUrl="+encodeURIComponent(t);p.info("Attempting to load a remote image without a configured proxy. URL: "+t)}},t.proxyUrl=function(t){return r.remoteProxy+"?"+r.proxyParam+"="+encodeURIComponent(t)},t.useProxy=function(t){var e;return null!=(e={ruby:"rb",python:"py",perl:"pl",javascript:"js"})[t=t.toLowerCase()]&&(t=e[t]),"proxies/caman_proxy."+t},t}(),r.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},r.prototype.browserSave=function(t){var e;return null==t&&(t="png"),t=t.toLowerCase(),e=this.toBase64(t).replace("image/"+t,"image/octet-stream"),document.location.href=e},r.prototype.nodeSave=function(t,e){null==e&&(e=!0);try{if(I.statSync(t).isFile()&&!e)return!1}catch(e){g.debug("Creating output file "+t)}return I.writeFile(t,this.canvas.toBuffer(),function(){return g.debug("Finished writing to "+t)})},r.prototype.toImage=function(t){var e;return(e=document.createElement("img")).src=this.toBase64(t),e.width=this.dimensions.width,e.height=this.dimensions.height,window.devicePixelRatio&&(e.width/=window.devicePixelRatio,e.height/=window.devicePixelRatio),e},r.prototype.toBase64=function(t){return null==t&&(t="png"),t=t.toLowerCase(),this.canvas.toDataURL("image/"+t)},f=function(){function e(t){this.c=t,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=b.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new s:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return e.prototype.newLayer=function(t){return this.c.newLayer.call(this.c,t)},e.prototype.setBlendingMode=function(t){return this.options.blendingMode=t,this},e.prototype.opacity=function(t){return this.options.opacity=t/100,this},e.prototype.copyParent=function(){var t,e,i,n;for(e=this.c.pixelData,t=i=0,n=this.c.pixelData.length;i<n;t=i+=4)this.pixelData[t]=e[t],this.pixelData[t+1]=e[t+1],this.pixelData[t+2]=e[t+2],this.pixelData[t+3]=e[t+3];return this},e.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},e.prototype.overlayImage=function(e){return"object"==typeof e?e=e.src:"string"==typeof e&&"#"===e[0]&&(e=t(e).src),e?(this.c.renderer.renderQueue.push({type:c.Type.LoadOverlay,src:e,layer:this}),this):this},e.prototype.applyToParent=function(){var t,e,n,r,a,s,o,l,h;for(n=this.c.pixelStack[this.c.pixelStack.length-1],h=[],t=o=0,l=(e=this.c.pixelData).length;o<l;t=o+=4)s={r:n[t],g:n[t+1],b:n[t+2],a:n[t+3]},a={r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]},(r=i.execute(this.options.blendingMode,a,s)).r=b.clampRGB(r.r),r.g=b.clampRGB(r.g),r.b=b.clampRGB(r.b),null==r.a&&(r.a=a.a),n[t]=s.r-(s.r-r.r)*(this.options.opacity*(r.a/255)),n[t+1]=s.g-(s.g-r.g)*(this.options.opacity*(r.a/255)),h.push(n[t+2]=s.b-(s.b-r.b)*(this.options.opacity*(r.a/255)));return h},e}(),p=function(){return function(){var t,e,i,n;for(e=0,i=(n=["log","info","warn","error"]).length;e<i;e++)this[t=n[e]]=function(t){return function(){var e;if(e=1<=arguments.length?E.call(arguments,0):[],r.DEBUG)try{return console[t].apply(console,e)}catch(i){return console[t](e)}}}(t);this.debug=this.log}}(),g=new p,m=function(){function t(t){this.c=t,this.loc=0}return t.coordinatesToLocation=function(t,e,i){return 4*(e*i+t)},t.locationToCoordinates=function(t,e){return{x:t%(4*e)/4,y:Math.floor(t/(4*e))}},t.prototype.locationXY=function(){var t;return t=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),{x:this.loc%(4*this.c.dimensions.width)/4,y:t}},t.prototype.getPixelRelative=function(t,e){var i;return(i=this.loc+4*this.c.dimensions.width*(-1*e)+4*t)>this.c.pixelData.length||i<0?{r:0,g:0,b:0,a:0}:{r:this.c.pixelData[i],g:this.c.pixelData[i+1],b:this.c.pixelData[i+2],a:this.c.pixelData[i+3]}},t.prototype.putPixelRelative=function(t,e,i){if(this.loc+4*this.c.dimensions.width*(-1*e)+4*t,!(newLoc>this.c.pixelData.length||newLoc<0))return this.c.pixelData[newLoc]=i.r,this.c.pixelData[newLoc+1]=i.g,this.c.pixelData[newLoc+2]=i.b,this.c.pixelData[newLoc+3]=i.a,!0},t.prototype.getPixel=function(t,e){var i;return i=this.coordinatesToLocation(t,e,this.width),{r:this.c.pixelData[i],g:this.c.pixelData[i+1],b:this.c.pixelData[i+2],a:this.c.pixelData[i+3]}},t.prototype.putPixel=function(t,e,i){var n;return n=this.coordinatesToLocation(t,e,this.width),this.c.pixelData[n]=i.r,this.c.pixelData[n+1]=i.g,this.c.pixelData[n+2]=i.b,this.c.pixelData[n+3]=i.a},t}(),v=function(){function t(){}return t.plugins={},t.register=function(t,e){return this.plugins[t]=e},t.execute=function(t,e,i){return this.plugins[e].apply(t,i)},t}(),r.Plugin=v,r.Renderer=_=function(){function t(e){var i=this;this.c=e,this.processNext=function(){return t.prototype.processNext.apply(i,arguments)},this.renderQueue=[],this.modPixelData=null}return t.Blocks=r.NodeJS?require("os").cpus().length:4,t.prototype.add=function(t){if(null!=t)return this.renderQueue.push(t)},t.prototype.processNext=function(){var t;if(0===this.renderQueue.length)return l.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case c.Type.LayerDequeue:return t=this.c.canvasQueue.shift(),this.c.executeLayer(t),this.processNext();case c.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case c.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case c.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},t.prototype.execute=function(t){return this.finishedFn=t,this.modPixelData=b.dataArray(this.c.pixelData.length),this.processNext()},t.prototype.eachBlock=function(e){var i,n,a,s,o,l,c,u,d,f,g=this;for(this.blocksDone=0,l=this.c.pixelData.length,o=(i=4*Math.floor(l/4/t.Blocks))+l/4%t.Blocks*4,f=[],s=u=0,d=t.Blocks;0<=d?u<d:u>d;s=0<=d?++u:--u)a=(c=s*i)+(s===t.Blocks-1?o:i),r.NodeJS?(n=h(function(){return e.call(g,s,c,a)}).run(),f.push(this.blockFinished(n))):f.push(setTimeout(function(t,i,n){return function(){return e.call(g,t,i,n)}}(s,c,a),0));return f},t.prototype.executeFilter=function(){return l.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===c.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},t.prototype.executePlugin=function(){return g.debug("Executing plugin "+this.currentJob.plugin),v.execute(this.c,this.currentJob.plugin,this.currentJob.args),g.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},t.prototype.renderBlock=function(e,i,n){var a,s,o,c,u;for(g.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+i+", End: "+n),l.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:t.Blocks,startPixel:i,endPixel:n}),a={r:0,g:0,b:0,a:0},o=new m(this.c),s=u=i;u<n;s=u+=4)o.loc=s,a.r=this.c.pixelData[s],a.g=this.c.pixelData[s+1],a.b=this.c.pixelData[s+2],a.a=this.c.pixelData[s+3],null==(c=this.currentJob.processFn.call(o,a)).a&&(c.a=a.a),this.c.pixelData[s]=b.clampRGB(c.r),this.c.pixelData[s+1]=b.clampRGB(c.g),this.c.pixelData[s+2]=b.clampRGB(c.b),this.c.pixelData[s+3]=b.clampRGB(c.a);return r.NodeJS?h.yield(e):this.blockFinished(e)},t.prototype.renderKernel=function(t,e,i){var n,a,s,o,l,c,u,d,f,p,v,_,y,x,I,C,w;for(this.currentJob.name,s=this.currentJob.bias,c=this.currentJob.divisor,v=this.c.pixelData.length,n=this.currentJob.adjust,a=Math.sqrt(n.length),p=[],g.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((a-1)/2)),i=Math.min(i,v-4*this.c.dimensions.width*((a-1)/2)),o=(a-1)/2,y=new m(this.c),u=I=e;I<i;u=I+=4){for(y.loc=u,l=0,d=C=-o;-o<=o?C<=o:C>=o;d=-o<=o?++C:--C)for(f=w=o;o<=-o?w<=-o:w>=-o;f=o<=-o?++w:--w)_=y.getPixelRelative(d,f),p[3*l]=_.r,p[3*l+1]=_.g,p[3*l+2]=_.b,l++;x=this.processKernel(n,p,c,s),this.modPixelData[u]=b.clampRGB(x.r),this.modPixelData[u+1]=b.clampRGB(x.g),this.modPixelData[u+2]=b.clampRGB(x.b),this.modPixelData[u+3]=this.c.pixelData[u+3]}return r.NodeJS?h.yield(t):this.blockFinished(t)},t.prototype.blockFinished=function(e){var i,n,r;if(e>=0&&g.debug("Block #"+e+" finished! Filter: "+this.currentJob.name),this.blocksDone++,l.trigger(this.c,"blockFinished",{blockNum:e,blocksFinished:this.blocksDone,totalBlocks:t.Blocks}),this.blocksDone===t.Blocks){if(this.currentJob.type===c.Type.Kernel)for(i=n=0,r=this.c.pixelData.length;0<=r?n<r:n>r;i=0<=r?++n:--n)this.c.pixelData[i]=this.modPixelData[i];return e>=0&&g.debug("Filter "+this.currentJob.name+" finished!"),l.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},t.prototype.processKernel=function(t,e,i,n){var r,a,s,o;for(a={r:0,g:0,b:0},r=s=0,o=t.length;0<=o?s<o:s>o;r=0<=o?++s:--s)a.r+=t[r]*e[3*r],a.g+=t[r]*e[3*r+1],a.b+=t[r]*e[3*r+2];return a.r=a.r/i+n,a.g=a.g/i+n,a.b=a.b/i+n,a},t.prototype.loadOverlay=function(t,e){var i,n,r=this;return(i=document.createElement("img")).onload=function(){return t.context.drawImage(i,0,0,r.c.dimensions.width,r.c.dimensions.height),t.imageData=t.context.getImageData(0,0,r.c.dimensions.width,r.c.dimensions.height),t.pixelData=t.imageData.data,r.c.pixelData=t.pixelData,r.processNext()},n=u.remoteCheck(e),i.src=null!=n?n:e},t}(),r.Store=x=function(){function t(){}return t.items={},t.has=function(t){return null!=this.items[t]},t.get=function(t){return this.items[t]},t.put=function(t,e){return this.items[t]=e},t.execute=function(t,e){var i=this;return setTimeout(function(){return e.call(i.get(t),i.get(t))},0),this.get(t)},t.flush=function(t){return null==t&&(t=!1),t?delete this.items[t]:this.items={}},t}(),i.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),i.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),i.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),i.register("overlay",function(t,e){var i;return(i={}).r=e.r>128?255-2*(255-t.r)*(255-e.r)/255:e.r*t.r*2/255,i.g=e.g>128?255-2*(255-t.g)*(255-e.g)/255:e.g*t.g*2/255,i.b=e.b>128?255-2*(255-t.b)*(255-e.b)/255:e.b*t.b*2/255,i}),i.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),i.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),i.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),i.register("softLight",function(t,e){var i;return(i={}).r=e.r>128?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,i.g=e.g>128?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,i.b=e.b>128?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,i}),i.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),i.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}}),c.register("fillColor",function(){var t;return t=1===arguments.length?o.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(e){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=255,e})}),c.register("brightness",function(t){return t=Math.floor(t/100*255),this.process("brightness",function(e){return e.r+=t,e.g+=t,e.b+=t,e})}),c.register("saturation",function(t){return t*=-.01,this.process("saturation",function(e){var i;return i=Math.max(e.r,e.g,e.b),e.r!==i&&(e.r+=(i-e.r)*t),e.g!==i&&(e.g+=(i-e.g)*t),e.b!==i&&(e.b+=(i-e.b)*t),e})}),c.register("vibrance",function(t){return t*=-1,this.process("vibrance",function(e){var i,n,r;return r=Math.max(e.r,e.g,e.b),n=(e.r+e.g+e.b)/3,i=2*Math.abs(r-n)/255*t/100,e.r!==r&&(e.r+=(r-e.r)*i),e.g!==r&&(e.g+=(r-e.g)*i),e.b!==r&&(e.b+=(r-e.b)*i),e})}),c.register("greyscale",function(t){return this.process("greyscale",function(t){var e;return e=n.luminance(t),t.r=e,t.g=e,t.b=e,t})}),c.register("contrast",function(t){return t=Math.pow((t+100)/100,2),this.process("contrast",function(e){return e.r/=255,e.r-=.5,e.r*=t,e.r+=.5,e.r*=255,e.g/=255,e.g-=.5,e.g*=t,e.g+=.5,e.g*=255,e.b/=255,e.b-=.5,e.b*=t,e.b+=.5,e.b*=255,e})}),c.register("hue",function(t){return this.process("hue",function(e){var i,n,r;return i=100*(n=o.rgbToHSV(e.r,e.g,e.b)).h,i+=Math.abs(t),i%=100,i/=100,n.h=i,(r=o.hsvToRGB(n.h,n.s,n.v)).a=e.a,r})}),c.register("colorize",function(){var t,e;return 2===arguments.length?(e=o.hexToRGB(arguments[0]),t=arguments[1]):4===arguments.length&&(e={r:arguments[0],g:arguments[1],b:arguments[2]},t=arguments[3]),this.process("colorize",function(i){return i.r-=(i.r-e.r)*(t/100),i.g-=(i.g-e.g)*(t/100),i.b-=(i.b-e.b)*(t/100),i})}),c.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),c.register("sepia",function(t){return null==t&&(t=100),t/=100,this.process("sepia",function(e){return e.r=Math.min(255,e.r*(1-.607*t)+e.g*(.769*t)+e.b*(.189*t)),e.g=Math.min(255,e.r*(.349*t)+e.g*(1-.314*t)+e.b*(.168*t)),e.b=Math.min(255,e.r*(.272*t)+e.g*(.534*t)+e.b*(1-.869*t)),e})}),c.register("gamma",function(t){return this.process("gamma",function(e){return e.r=255*Math.pow(e.r/255,t),e.g=255*Math.pow(e.g/255,t),e.b=255*Math.pow(e.b/255,t),e})}),c.register("noise",function(t){return t=2.55*Math.abs(t),this.process("noise",function(e){var i;return i=n.randomRange(-1*t,t),e.r+=i,e.g+=i,e.b+=i,e})}),c.register("clip",function(t){return t=2.55*Math.abs(t),this.process("clip",function(e){return e.r>255-t?e.r=255:e.r<t&&(e.r=0),e.g>255-t?e.g=255:e.g<t&&(e.g=0),e.b>255-t?e.b=255:e.b<t&&(e.b=0),e})}),c.register("channels",function(t){var e;if("object"!=typeof t)return this;for(e in t)D.call(t,e)&&(0!==t[e]?t[e]/=100:delete t[e]);return 0===t.length?this:this.process("channels",function(e){return null!=t.red&&(t.red>0?e.r+=(255-e.r)*t.red:e.r-=e.r*Math.abs(t.red)),null!=t.green&&(t.green>0?e.g+=(255-e.g)*t.green:e.g-=e.g*Math.abs(t.green)),null!=t.blue&&(t.blue>0?e.b+=(255-e.b)*t.blue:e.b-=e.b*Math.abs(t.blue)),e})}),c.register("curves",function(){var t,e,i,r,a,s,o,l,h,c,u,d;if(e=arguments[0],i=2<=arguments.length?E.call(arguments,1):[],"string"==typeof e&&(e=e.split("")),"v"===e[0]&&(e=["r","g","b"]),i.length<3||i.length>4)throw"Invalid number of arguments to curves filter";if(l=i[0],r=i[1],a=4===i.length?i[2]:i[1],s=i[i.length-1],t=n.bezier(l,r,a,s,0,255),l[0]>0)for(o=h=0,u=l[0];0<=u?h<u:h>u;o=0<=u?++h:--h)t[o]=l[1];if(s[0]<255)for(o=c=d=s[0];d<=255?c<=255:c>=255;o=d<=255?++c:--c)t[o]=s[1];return this.process("curves",function(i){var n,r;for(o=n=0,r=e.length;0<=r?n<r:n>r;o=0<=r?++n:--n)i[e[o]]=t[i[e[o]]];return i})}),c.register("exposure",function(t){var e,i,n;return e=[0,255*(n=Math.abs(t)/100)],i=[255-255*n,255],t<0&&(e=e.reverse(),i=i.reverse()),this.curves("rgb",[0,0],e,i,[255,255])}),r.Plugin.register("crop",function(t,e,i,n){var r;return null==i&&(i=0),null==n&&(n=0),"undefined"!=typeof exports&&null!==exports?r=new s(t,e):(r=document.createElement("canvas"),b.copyAttributes(this.canvas,r),r.width=t,r.height=e),r.getContext("2d").drawImage(this.canvas,i,n,t,e,0,0,t,e),this.cropCoordinates={x:i,y:n},this.cropped=!0,this.replaceCanvas(r)}),r.Plugin.register("resize",function(t){var e;if(null==t&&(t=null),null!==t&&(null!=t.width||null!=t.height))return null==t.width?t.width=this.canvas.width*t.height/this.canvas.height:null==t.height&&(t.height=this.canvas.height*t.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?e=new s(t.width,t.height):(e=document.createElement("canvas"),b.copyAttributes(this.canvas,e),e.width=t.width,e.height=t.height),e.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,t.width,t.height),this.resized=!0,this.replaceCanvas(e);g.error("Invalid or missing dimensions given for resize")}),r.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),r.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),r.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),r.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),r.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),r.Filter.register("motionBlur",function(t){var e;return e=0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:t>0&&t<90||t>180&&t<270?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",e)}),r.Filter.register("sharpen",function(t){return null==t&&(t=100),t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])}),w={brightness:function(t,e,i){return t.r=t.r-t.r*e*i.strength,t.g=t.g-t.g*e*i.strength,t.b=t.b-t.b*e*i.strength,t},gamma:function(t,e,i){return t.r=255*Math.pow(t.r/255,Math.max(10*e*i.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*i.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*i.strength,1)),t},colorize:function(t,e,i){return t.r-=(t.r-i.color.r)*e,t.g-=(t.g-i.color.g)*e,t.b-=(t.b-i.color.b)*e,t}},c.register("vignette",function(t,e){var i,r,a,s;return null==e&&(e=60),"string"==typeof t&&"%"===t.substr(-1)&&(t=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(t.substr(0,t.length-1),10)/100):this.dimensions.height*(parseInt(t.substr(0,t.length-1),10)/100)),e/=100,r=[this.dimensions.width/2,this.dimensions.height/2],s=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)),a=s-t,i=n.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(s){var o,l,h;return h=this.locationXY(),(o=n.distance(h.x,h.y,r[0],r[1]))>a&&(l=Math.max(1,i[Math.round((o-a)/t*100)]/10*e),s.r=255*Math.pow(s.r/255,l),s.g=255*Math.pow(s.g/255,l),s.b=255*Math.pow(s.b/255,l)),s})}),c.register("rectangularVignette",function(t){var e,i,a,s,l,h,c;if(e={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},!(t=b.extend(e,t)).size)return this;if("string"==typeof t.size)a=parseInt(t.size,10)/100,t.size={width:this.dimensions.width*a,height:this.dimensions.height*a};else if("object"==typeof t.size)for(l=0,h=(c=["width","height"]).length;l<h;l++)i=c[l],"string"==typeof t.size[i]&&(t.size[i]=this.dimensions[i]*(parseInt(t.size[i],10)/100));else"number"===t.size&&(s=t.size,t.size={width:s,height:s});return"string"==typeof t.cornerRadius&&(t.cornerRadius=t.size.width/2*(parseInt(t.cornerRadius,10)/100)),t.strength/=100,t.size.width=Math.floor(t.size.width),t.size.height=Math.floor(t.size.height),t.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===t.method&&"string"==typeof t.color&&(t.color=o.hexToRGB(t.color)),t.coords={left:(this.dimensions.width-t.size.width)/2,right:this.dimensions.width-t.coords.left,bottom:(this.dimensions.height-t.size.height)/2,top:this.dimensions.height-t.coords.bottom},t.corners=[{x:t.coords.left+t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.bottom+t.cornerRadius},{x:t.coords.left+t.cornerRadius,y:t.coords.bottom+t.cornerRadius}],t.maxDist=n.distance(0,0,t.corners[3].x,t.corners[3].y)-t.cornerRadius,this.process("rectangularVignette",function(e){var i,n;return(n=this.locationXY()).x>t.corners[0].x&&n.x<t.corners[1].x&&n.y>t.coords.bottom&&n.y<t.coords.top?e:n.x>t.coords.left&&n.x<t.coords.right&&n.y>t.corners[3].y&&n.y<t.corners[2].y?e:(n.x>t.corners[0].x&&n.x<t.corners[1].x&&n.y>t.coords.top?i=(n.y-t.coords.top)/t.maxDist:n.y>t.corners[2].y&&n.y<t.corners[1].y&&n.x>t.coords.right?i=(n.x-t.coords.right)/t.maxDist:n.x>t.corners[0].x&&n.x<t.corners[1].x&&n.y<t.coords.bottom?i=(t.coords.bottom-n.y)/t.maxDist:n.y>t.corners[2].y&&n.y<t.corners[1].y&&n.x<t.coords.left?i=(t.coords.left-n.x)/t.maxDist:n.x<=t.corners[0].x&&n.y>=t.corners[0].y?i=(r.distance(n.x,n.y,t.corners[0].x,t.corners[0].y)-t.cornerRadius)/t.maxDist:n.x>=t.corners[1].x&&n.y>=t.corners[1].y?i=(r.distance(n.x,n.y,t.corners[1].x,t.corners[1].y)-t.cornerRadius)/t.maxDist:n.x>=t.corners[2].x&&n.y<=t.corners[2].y?i=(r.distance(n.x,n.y,t.corners[2].x,t.corners[2].y)-t.cornerRadius)/t.maxDist:n.x<=t.corners[3].x&&n.y<=t.corners[3].y&&(i=(r.distance(n.x,n.y,t.corners[3].x,t.corners[3].y)-t.cornerRadius)/t.maxDist),i<0?e:w[t.method](e,i,t))})}),T=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],k=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],M=function(t,e,i,n,r,a,o){var l,h,c,u,d,f,g;return(l="undefined"!=typeof exports&&null!==exports?new s:document.createElement("canvas")).width=t,l.height=e,u=i+Math.cos(r)*a*.5,f=n+Math.sin(r)*a*.5,d=i-Math.cos(r)*a*.5,g=n-Math.sin(r)*a*.5,c=(h=l.getContext("2d")).createLinearGradient(u,f,d,g),o?(c.addColorStop(0,"white"),c.addColorStop(.5,"black"),c.addColorStop(1,"white")):(c.addColorStop(0,"white"),c.addColorStop(1,"black")),h.fillStyle=c,h.fillRect(0,0,t,e),h.getImageData(0,0,t,e)},A=function(t,e,i,n,r,a){var o,l,h;return(o="undefined"!=typeof exports&&null!==exports?new s:document.createElement("canvas")).width=t,o.height=e,(h=(l=o.getContext("2d")).createRadialGradient(i,n,r,i,n,a)).addColorStop(1,"white"),h.addColorStop(0,"black"),l.fillStyle=h,l.fillRect(0,0,t,e),l.getImageData(0,0,t,e)},S=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},r.Plugin.register("compoundBlur",function(t,e,i,n){var r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,M,A,D,P,E,z,O,B,R,L,F,G,N,U,j,Z,W,V,X,Y,H,q,J,Q,K,$,tt,et,it,nt,rt,at,st,ot,lt,ht;for(Y=this.dimensions.width,f=this.dimensions.height,_=this.pixelData,O=t.data,X=(V=Y*f)<<2,A=[],p=tt=0;0<=X?tt<X:tt>X;p=0<=X?++tt:--tt)A[p]=_[p];for(l=0,Z=n,n-=1;Z-- >=0;)if(0!=(x=e+.5|0)){for(x>256&&(x=256),h=x+x+1,H=Y-1,g=f-1,W=(B=x+1)*(B+1)/2,G=void 0,F=j=new S,p=et=1;1<=h?et<h:et>h;p=1<=h?++et:--et)F=F.next=new S,p===B&&(G=F);for(F.next=j,N=null,U=null,$=Q=0,I=T[x],L=k[x],J=it=0;0<=f?it<f:it>f;J=0<=f?++it:--it){for(P=c=r=z=d=s=0,E=B*(D=A[Q]),u=B*(M=A[Q+1]),a=B*(w=A[Q+2]),z+=W*D,d+=W*M,s+=W*w,F=j,p=nt=0;0<=B?nt<B:nt>B;p=0<=B?++nt:--nt)F.r=D,F.g=M,F.b=w,F=F.next;for(p=rt=1;1<=B?rt<B:rt>B;p=1<=B?++rt:--rt)C=Q+((H<p?H:p)<<2),z+=(F.r=D=A[C])*(R=B-p),d+=(F.g=M=A[C+1])*R,s+=(F.b=w=A[C+2])*R,P+=D,c+=M,r+=w,F=F.next;for(N=j,U=G,q=at=0;0<=Y?at<Y:at>Y;q=0<=Y?++at:--at)A[Q]=z*I>>L,A[Q+1]=d*I>>L,A[Q+2]=s*I>>L,z-=E,d-=u,s-=a,E-=N.r,u-=N.g,a-=N.b,C=$+((C=q+B)<H?C:H)<<2,z+=P+=N.r=A[C],d+=c+=N.g=A[C+1],s+=r+=N.b=A[C+2],N=N.next,E+=D=U.r,u+=M=U.g,a+=w=U.b,P-=D,c-=M,r-=w,U=U.next,Q+=4;$+=Y}for(q=st=0;0<=Y?st<Y:st>Y;q=0<=Y?++st:--st){for(c=r=P=d=s=z=0,E=B*(D=A[Q=q<<2]),u=B*(M=A[Q+1]),a=B*(w=A[Q+2]),z+=W*D,d+=W*M,s+=W*w,F=j,p=ot=0;0<=B?ot<B:ot>B;p=0<=B?++ot:--ot)F.r=D,F.g=M,F.b=w,F=F.next;for(K=Y,p=lt=1;1<=B?lt<B:lt>B;p=1<=B?++lt:--lt)Q=K+q<<2,z+=(F.r=D=A[Q])*(R=B-p),d+=(F.g=M=A[Q+1])*R,s+=(F.b=w=A[Q+2])*R,P+=D,c+=M,r+=w,F=F.next,p<g&&(K+=Y);for(Q=q,N=j,U=G,J=ht=0;0<=f?ht<f:ht>f;J=0<=f?++ht:--ht)A[C=Q<<2]=z*I>>L,A[C+1]=d*I>>L,A[C+2]=s*I>>L,z-=E,d-=u,s-=a,E-=N.r,u-=N.g,a-=N.b,C=q+((C=J+B)<g?C:g)*Y<<2,z+=P+=N.r=A[C],d+=c+=N.g=A[C+1],s+=r+=N.b=A[C+2],N=N.next,E+=D=U.r,u+=M=U.g,a+=w=U.b,P-=D,c-=M,r-=w,U=U.next,Q+=Y}for(e*=i,p=V;--p>-1;)(y=0|(b=(255&O[2+(v=p<<2)])/255*n))===l?(m=256-(o=256*(b-(0|b))),_[v]=_[v]*m+A[v]*o>>8,_[v+1]=_[v+1]*m+A[v+1]*o>>8,_[v+2]=_[v+2]*m+A[v+2]*o>>8):y===l+1&&(_[v]=A[v],_[v+1]=A[v+1],_[v+2]=A[v+2]);l++}return this}),r.Filter.register("tiltShift",function(t){var e,i;return e={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},(t=b.extend(e,t)).angle*=Math.PI/180,i=M(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.angle,t.focusWidth,!0),this.processPlugin("compoundBlur",[i,t.startRadius,t.radiusFactor,t.steps])}),r.Filter.register("radialBlur",function(t){var e,i,n,r;return e={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},(t=b.extend(e,t)).radius||(t.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),n=t.radius/2-t.size,r=t.radius/2,i=A(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,n,r),this.processPlugin("compoundBlur",[i,t.startRadius,t.radiusFactor,t.steps])}),r.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),r.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),r.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),r.Filter.register("posterize",function(t){var e,i;return e=256/t,i=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*i),t.g=Math.floor(Math.floor(t.g/e)*i),t.b=Math.floor(Math.floor(t.b/e)*i),t})}),r.Filter.register("vintage",function(t){if(null==t&&(t=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t)return this.vignette("40%",30)}),r.Filter.register("lomo",function(t){return null==t&&(t=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),r.Filter.register("clarity",function(t){return null==t&&(t=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),r.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),r.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),r.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),r.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),r.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),r.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),r.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),r.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),r.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),r.Filter.register("glowingSun",function(t){if(null==t&&(t=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t)return this.vignette("45%",20)}),r.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),r.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),r.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),r.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),r.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),function(){var t,e,i;e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],t=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},r.Plugin.register("stackBlur",function(n){var r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S,M,A,T,k,D,P,E,z,O,B,R,L,F,G,N,U,j,Z,W,V,X,Y;if(!(isNaN(n)||n<1)){for(n|=0,_=this.pixelData,o=n+n+1,(E=this.dimensions.width)<<2,z=E-1,d=(u=this.dimensions.height)-1,P=(C=n+1)*(C+1)/2,M=D=new t,f=G=1;1<=o?G<o:G>o;f=1<=o?++G:--G)M=M.next=new t,f===C&&(A=M);for(M.next=D,T=null,k=null,F=R=0,g=e[n],S=i[n],B=N=0;0<=u?N<u:N>u;B=0<=u?++N:--N){for(x=l=r=I=c=s=0,b=C*(y=_[R]),h=C*(v=_[R+1]),a=C*(m=_[R+2]),I+=P*y,c+=P*v,s+=P*m,M=D,f=U=0;0<=C?U<C:U>C;f=0<=C?++U:--U)M.r=y,M.g=v,M.b=m,M=M.next;for(f=j=1;1<=C?j<C:j>C;f=1<=C?++j:--j)p=R+((z<f?z:f)<<2),I+=(M.r=y=_[p])*(w=C-f),c+=(M.g=v=_[p+1])*w,s+=(M.b=m=_[p+2])*w,x+=y,l+=v,r+=m,M=M.next;for(T=D,k=A,O=Z=0;0<=E?Z<E:Z>E;O=0<=E?++Z:--Z)_[R]=I*g>>S,_[R+1]=c*g>>S,_[R+2]=s*g>>S,I-=b,c-=h,s-=a,b-=T.r,h-=T.g,a-=T.b,p=F+((p=O+n+1)<z?p:z)<<2,I+=x+=T.r=_[p],c+=l+=T.g=_[p+1],s+=r+=T.b=_[p+2],T=T.next,b+=y=k.r,h+=v=k.g,a+=m=k.b,x-=y,l-=v,r-=m,k=k.next,R+=4;F+=E}for(O=W=0;0<=E?W<E:W>E;O=0<=E?++W:--W){for(l=r=x=c=s=I=0,b=C*(y=_[R=O<<2]),h=C*(v=_[R+1]),a=C*(m=_[R+2]),I+=P*y,c+=P*v,s+=P*m,M=D,f=V=0;0<=C?V<C:V>C;f=0<=C?++V:--V)M.r=y,M.g=v,M.b=m,M=M.next;for(L=E,f=X=1;1<=n?X<=n:X>=n;f=1<=n?++X:--X)R=L+O<<2,I+=(M.r=y=_[R])*(w=C-f),c+=(M.g=v=_[R+1])*w,s+=(M.b=m=_[R+2])*w,x+=y,l+=v,r+=m,M=M.next,f<d&&(L+=E);for(R=O,T=D,k=A,B=Y=0;0<=u?Y<u:Y>u;B=0<=u?++Y:--Y)_[p=R<<2]=I*g>>S,_[p+1]=c*g>>S,_[p+2]=s*g>>S,I-=b,c-=h,s-=a,b-=T.r,h-=T.g,a-=T.b,p=O+((p=B+C)<d?p:d)*E<<2,I+=x+=T.r=_[p],c+=l+=T.g=_[p+1],s+=r+=T.b=_[p+2],T=T.next,b+=y=k.r,h+=v=k.g,a+=m=k.b,x-=y,l-=v,r-=m,k=k.next,R+=E}return this}}),r.Filter.register("stackBlur",function(t){return this.processPlugin("stackBlur",[t])})}(),r.Filter.register("threshold",function(t){return this.process("threshold",function(e){return.2126*e.r+.7152*e.g+.0722*e.b<t?(e.r=0,e.g=0,e.b=0):(e.r=255,e.g=255,e.b=255),e})})}.call(this),function(t,e,i,n){"use strict";function r(t,e){return t===n?e:t}var a=["","webkit","Moz","MS","ms","o"],s=e.createElement("div"),o="function",l=Math.round,h=Math.abs,c=Date.now;function u(t,e){for(var i=void 0,r=void 0,s=e[0].toUpperCase()+e.slice(1),o=0;o<a.length;){if((r=(i=a[o])?i+s:e)in t)return r;o++}return n}var d=u(s.style,"touchAction"),f=d!==n,g="auto",p="manipulation",m="none",v="pan-x",_="pan-y",y=function(){if(!f)return!1;var e={},i=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){return e[n]=!i||t.CSS.supports("touch-action",n)}),e}(),x="ontouchstart"in t,b=u(t,"PointerEvent")!==n,I=x&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),C=25,w=1,S=2,M=4,A=8,T=1,k=2,D=4,P=8,E=16,z=k|D,O=P|E,B=z|O,R=["x","y"],L=["clientX","clientY"],F=1,G=2,N=4,U=8,j=U,Z=16,W="function"!=typeof Object.assign?function(t){if(t===n||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==n&&null!==r)for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])}return e}:Object.assign,V=1;function X(t,e,i){var r=void 0;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==n)for(r=0;r<t.length;)e.call(i,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r,t)}function Y(t,e,i){return!!Array.isArray(t)&&(X(t,i[e],i),!0)}function H(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}var q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J=(function(){function t(t){this.value=t}function e(e){var i,r;function a(i,n){try{var r=e[i](n),o=r.value;o instanceof t?Promise.resolve(o.value).then(function(t){a("next",t)},function(t){a("throw",t)}):s(r.done?"return":"normal",r.value)}catch(t){s("throw",t)}}function s(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?a(i.key,i.arg):r=null}this._invoke=function(t,e){return new Promise(function(n,s){var o={key:t,arg:e,resolve:n,reject:s,next:null};r?r=r.next=o:(i=r=o,a(t,e))})},"function"!=typeof e.return&&(this.return=n)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),Q=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),K=function t(e,i,r){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,i);if(a===n){var s=Object.getPrototypeOf(e);return null===s?n:t(s,i,r)}if("value"in a)return a.value;var o=a.get;return o===n?n:o.call(r)},$=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},tt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},et=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],r=!0,a=!1,s=n;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){a=!0,s=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function it(t,e){return(void 0===t?"undefined":q(t))===o?t.apply(e&&e[0]||n,e):t}function nt(t,e){var i=e.manager;return i?i.get(t):t}function rt(t){return t&Z?"cancel":t&U?"end":t&N?"move":t&G?"start":""}var at=function(){function t(e){J(this,t),this.options=W({},this.defaults,e||{}),this.id=V++,this.manager=null,this.options.enable=r(this.options.enable,!0),this.state=F,this.simultaneous={},this.requireFail=[]}return Q(t,[{key:"set",value:function(t){return W(this.options,t),this.manager&&this.manager.touchAction.update(),this}},{key:"recognizeWith",value:function(t){if(Y(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=nt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this}},{key:"dropRecognizeWith",value:function(t){return Y(t,"dropRecognizeWith",this)?this:(t=nt(t,this),delete this.simultaneous[t.id],this)}},{key:"requireFailure",value:function(t){if(Y(t,"requireFailure",this))return this;var e=this.requireFail;return-1===H(e,t=nt(t,this))&&(e.push(t),t.requireFailure(this)),this}},{key:"dropRequireFailure",value:function(t){if(Y(t,"dropRequireFailure",this))return this;t=nt(t,this);var e=H(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this}},{key:"hasRequireFailures",value:function(){return this.requireFail.length>0}},{key:"canRecognizeWith",value:function(t){return!!this.simultaneous[t.id]}},{key:"emit",value:function(t){var e=this,i=this.state;function n(i){e.manager.emit(i,t)}i<U&&n(e.options.event+rt(i)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),i>=U&&n(e.options.event+rt(i))}},{key:"tryEmit",value:function(t){if(this.canEmit())return this.emit(t);this.state=32}},{key:"canEmit",value:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|F)))return!1;t++}return!0}},{key:"recognize",value:function(t){var e=W({},t);if(!it(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(j|Z|32)&&(this.state=F),this.state=this.process(e),this.state&(G|N|U|Z)&&this.tryEmit(e)}},{key:"process",value:function(t){}},{key:"getTouchAction",value:function(){}},{key:"reset",value:function(){}}]),t}();at.prototype.defaults={};var st=function(t){function e(){return J(this,e),tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return $(e,at),Q(e,[{key:"attrTest",value:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e}},{key:"process",value:function(t){var e=this.state,i=t.eventType,n=e&(G|N),r=this.attrTest(t);return n&&(i&A||!r)?e|Z:n||r?i&M?e|U:e&G?e|N:G:32}}]),e}();st.prototype.defaults={pointers:1};var ot=function(t){function e(){return J(this,e),tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return $(e,st),Q(e,[{key:"getTouchAction",value:function(){return[m]}},{key:"attrTest",value:function(t){return K(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"attrTest",this).call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&G)}}]),e}();ot.prototype.defaults={event:"rotate",threshold:0,pointers:2};var lt=function(t){function e(){return J(this,e),tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return $(e,st),Q(e,[{key:"getTouchAction",value:function(){return[m]}},{key:"attrTest",value:function(t){return K(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"attrTest",this).call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&G)}},{key:"emit",value:function(t){if(1!==t.scale){var i=t.scale<1?"in":"out";t.additionalEvent=this.options.event+i}K(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"emit",this).call(this,t)}}]),e}();function ht(t){return t===E?"down":t===P?"up":t===k?"left":t===D?"right":""}lt.prototype.defaults={event:"pinch",threshold:0,pointers:2};var ct=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.pX=null,t.pY=null,t}return $(e,st),Q(e,[{key:"getTouchAction",value:function(){var t=this.options.direction,e=[];return t&z&&e.push(_),t&O&&e.push(v),e}},{key:"directionTest",value:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,a=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&z?(r=0===a?T:a<0?k:D,i=a!==this.pX,n=Math.abs(t.deltaX)):(r=0===s?T:s<0?P:E,i=s!==this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction}},{key:"attrTest",value:function(t){return st.prototype.attrTest.call(this,t)&&(this.state&G||!(this.state&G)&&this.directionTest(t))}},{key:"emit",value:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var i=ht(t.direction);i&&(t.additionalEvent=this.options.event+i),K(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"emit",this).call(this,t)}}]),e}();ct.prototype.defaults={event:"pan",threshold:10,pointers:1,direction:B};var ut=function(t){function e(){return J(this,e),tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return $(e,st),Q(e,[{key:"getTouchAction",value:function(){return ct.prototype.getTouchAction.call(this)}},{key:"attrTest",value:function(t){var i=this.options.direction,n=void 0;return i&(z|O)?n=t.overallVelocity:i&z?n=t.overallVelocityX:i&O&&(n=t.overallVelocityY),K(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"attrTest",this).call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers===this.options.pointers&&h(n)>this.options.velocity&&t.eventType&M}},{key:"emit",value:function(t){var e=ht(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}]),e}();function dt(t,e){return function(){return t.apply(e,arguments)}}function ft(t,e,i){return setTimeout(dt(t,i),e)}function gt(t,e,i){i||(i=R);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}ut.prototype.defaults={event:"swipe",threshold:10,velocity:.3,direction:z|O,pointers:1};var pt=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.pTime=!1,t.pCenter=!1,t._timer=null,t._input=null,t.count=0,t}return $(e,at),Q(e,[{key:"getTouchAction",value:function(){return[p]}},{key:"process",value:function(t){var e=this,i=this.options,n=t.pointers.length===i.pointers,r=t.distance<i.threshold,a=t.deltaTime<i.time;if(this.reset(),t.eventType&w&&0===this.count)return this.failTimeout();if(r&&a&&n){if(t.eventType!==M)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<i.interval,o=!this.pCenter||gt(this.pCenter,t.center)<i.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%i.taps)return this.hasRequireFailures()?(this._timer=ft(function(){e.state=j,e.tryEmit()},i.interval,this),G):j}return 32}},{key:"failTimeout",value:function(){var t=this;return this._timer=ft(function(){t.state=32},this.options.interval,this),32}},{key:"reset",value:function(){clearTimeout(this._timer)}},{key:"emit",value:function(){this.state===j&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}]),e}();pt.prototype.defaults={event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10};var mt=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t._timer=null,t._input=null,t}return $(e,at),Q(e,[{key:"getTouchAction",value:function(){return[g]}},{key:"process",value:function(t){var e=this,i=this.options,n=t.pointers.length===i.pointers,r=t.distance<i.threshold,a=t.deltaTime>i.time;if(this._input=t,!r||!n||t.eventType&(M|A)&&!a)this.reset();else if(t.eventType&w)this.reset(),this._timer=ft(function(){e.state=j,e.tryEmit()},i.time,this);else if(t.eventType&M)return j;return 32}},{key:"reset",value:function(){clearTimeout(this._timer)}},{key:"emit",value:function(t){this.state===j&&(t&&t.eventType&M?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}}]),e}();function vt(t,e){return t.indexOf(e)>-1}mt.prototype.defaults={event:"press",pointers:1,time:251,threshold:9};var _t=function(){function t(e,i){J(this,t),this.manager=e,this.set(i)}return Q(t,[{key:"set",value:function(t){"compute"===t&&(t=this.compute()),f&&this.manager.element.style&&y[t]&&(this.manager.element.style[d]=t),this.actions=t.toLowerCase().trim()}},{key:"update",value:function(){this.set(this.manager.options.touchAction)}},{key:"compute",value:function(){var t=[];return X(this.manager.recognizers,function(e){it(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(vt(t,m))return m;var e=vt(t,v),i=vt(t,_);return e&&i?m:e||i?e?v:_:vt(t,p)?p:g}(t.join(" "))}},{key:"preventDefaults",value:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=vt(n,m)&&!y[m],a=vt(n,_)&&!y[_],s=vt(n,v)&&!y[v];if(r){var o=1===t.pointers.length,l=t.distance<2,h=t.deltaTime<250;if(o&&l&&h)return}if(!s||!a)return r||a&&i&z||s&&i&O?this.preventSrc(e):void 0}}},{key:"preventSrc",value:function(t){this.manager.session.prevented=!0,t.preventDefault()}}]),t}();function yt(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function xt(t){var e=t.length;if(1===e)return{x:l(t[0].clientX),y:l(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:l(i/e),y:l(n/e)}}function bt(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:l(t.pointers[i].clientX),clientY:l(t.pointers[i].clientY)},i++;return{timeStamp:c(),pointers:e,center:xt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function It(t,e,i){i||(i=R);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function Ct(t,e){return t===e?T:h(t)>=h(e)?t<0?k:D:e<0?P:E}function wt(t,e,i){return{x:e/t||0,y:i/t||0}}function St(t,e){var i=t.session,r=e.pointers,a=r.length;i.firstInput||(i.firstInput=bt(e)),a>1&&!i.firstMultiple?i.firstMultiple=bt(e):1===a&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,l=o?o.center:s.center,u=e.center=xt(r);e.timeStamp=c(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=It(l,u),e.distance=gt(l,u),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},a=t.prevInput||{};e.eventType!==w&&a.eventType!==M||(r=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=Ct(e.deltaX,e.deltaY);var d,f,g=wt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=h(g.x)>h(g.y)?g.x:g.y,e.scale=o?(d=o.pointers,gt((f=r)[0],f[1],L)/gt(d[0],d[1],L)):1,e.rotation=o?function(t,e){return It(e[1],e[0],L)+It(t[1],t[0],L)}(o.pointers,r):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,function(t,e){var i=t.lastInterval||e,r=e.timeStamp-i.timeStamp,a=void 0,s=void 0,o=void 0,l=void 0;if(e.eventType!==A&&(r>C||i.velocity===n)){var c=e.deltaX-i.deltaX,u=e.deltaY-i.deltaY,d=wt(r,c,u);s=d.x,o=d.y,a=h(d.x)>h(d.y)?d.x:d.y,l=Ct(c,u),t.lastInterval=e}else a=i.velocity,s=i.velocityX,o=i.velocityY,l=i.direction;e.velocity=a,e.velocityX=s,e.velocityY=o,e.direction=l}(i,e);var p=t.element;yt(e.srcEvent.target,p)&&(p=e.srcEvent.target),e.target=p}function Mt(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,a=e&w&&n-r==0,s=e&(M|A)&&n-r==0;i.isFirst=!!a,i.isFinal=!!s,a&&(t.session={}),i.eventType=e,St(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function At(t){return t.trim().split(/\s+/g)}function Tt(t,e,i){X(At(e),function(e){t.addEventListener(e,i,!1)})}function kt(t,e,i){X(At(e),function(e){t.removeEventListener(e,i,!1)})}function Dt(e){var i=e.ownerDocument||e;return i.defaultView||i.parentWindow||t}var Pt=function(){function t(e,i){J(this,t);var n=this;this.manager=e,this.callback=i,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){it(e.options.enable,[e])&&n.handler(t)},this.init()}return Q(t,[{key:"handler",value:function(){}},{key:"init",value:function(){this.evEl&&Tt(this.element,this.evEl,this.domHandler),this.evTarget&&Tt(this.target,this.evTarget,this.domHandler),this.evWin&&Tt(Dt(this.element),this.evWin,this.domHandler)}},{key:"destroy",value:function(){this.evEl&&kt(this.element,this.evEl,this.domHandler),this.evTarget&&kt(this.target,this.evTarget,this.domHandler),this.evWin&&kt(Dt(this.element),this.evWin,this.domHandler)}}]),t}(),Et={pointerdown:w,pointermove:S,pointerup:M,pointercancel:A,pointerout:A},zt={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ot="pointerdown",Bt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Ot="MSPointerDown",Bt="MSPointerMove MSPointerUp MSPointerCancel");var Rt=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.evEl=Ot,t.evWin=Bt,t.init(),t.store=t.manager.session.pointerEvents=[],t}return $(e,Pt),Q(e,[{key:"handler",value:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Et[n],a=zt[t.pointerType]||t.pointerType,s="touch"===a,o=H(e,t.pointerId,"pointerId");r&w&&(0===t.button||s)?o<0&&(e.push(t),o=e.length-1):r&(M|A)&&(i=!0),o<0||(e[o]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),i&&e.splice(o,1))}}]),e}();function Lt(t){return Array.prototype.slice.call(t,0)}function Ft(t,e,i){for(var n=[],r=[],a=0;a<t.length;){var s=e?t[a][e]:t[a];H(r,s)<0&&n.push(t[a]),r[a]=s,a++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}var Gt={touchstart:w,touchmove:S,touchend:M,touchcancel:A},Nt="touchstart touchmove touchend touchcancel",Ut=function(t){function e(){J(this,e),e.prototype.evTarget=Nt,e.prototype.targetIds={};var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.evTarget=Nt,t.targetIds={},t.init(),t}return $(e,Pt),Q(e,[{key:"handler",value:function(t){var e=Gt[t.type],i=function(t,e){var i=Lt(t.touches),n=this.targetIds;if(e&(w|S)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r=void 0,a=void 0,s=Lt(t.changedTouches),o=[],l=this.target;if(a=i.filter(function(t){return yt(t.target,l)}),e===w)for(r=0;r<a.length;)n[a[r].identifier]=!0,r++;r=0;for(;r<s.length;)n[s[r].identifier]&&o.push(s[r]),e&(M|A)&&delete n[s[r].identifier],r++;if(!o.length)return;return[Ft(a.concat(o),"identifier",!0),o]}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}]),e}();var jt={mousedown:w,mousemove:S,mouseup:M},Zt="mousedown",Wt="mousemove mouseup",Vt=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.evEl=Zt,t.evWin=Wt,t.pressed=!1,t}return $(e,Pt),Q(e,[{key:"handler",value:function(t){var e=jt[t.type];e&w&&0===t.button&&(this.pressed=!0),e&S&&1!==t.which&&(e=M),this.pressed&&(e&M&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}]),e}(),Xt=2500,Yt=25,Ht=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments)),i=dt(t.handler,t);return t.touch=new Ut(t.manager,i),t.mouse=new Vt(t.manager,i),t.primaryTouch=null,t.lastTouches=[],t}return $(e,Pt),Q(e,[{key:"handler",value:function(t,e,i){var n="touch"===i.pointerType,r="mouse"===i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&w?(this.primaryTouch=e.changedPointers[0].identifier,qt.call(this,e)):t&(M|A)&&qt.call(this,e)}).call(this,e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],a=Math.abs(e-r.x),s=Math.abs(i-r.y);if(a<=Yt&&s<=Yt)return!0}return!1}.call(this,i))return;this.callback(t,e,i)}}},{key:"destroy",value:function(){this.touch.destroy(),this.mouse.destroy()}}]),e}();function qt(t){var e=this,i=et(t.changedPointers,1)[0];i.identifier===this.primaryTouch&&function(){var t={x:i.clientX,y:i.clientY};e.lastTouches.push(t);var n=e.lastTouches;setTimeout(function(){var e=n.indexOf(t);e>-1&&n.splice(e,1)},Xt)}()}var Jt=function(){function t(e,i){var n,r=this;J(this,t),this.options=W({},Kt.defaults,i||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(I?Ut:b?Rt:x?Ht:Vt))(n,Mt),this.touchAction=new _t(this,this.options.touchAction),Qt(this,!0),X(this.options.recognizers,function(t){var e=r.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}return Q(t,[{key:"set",value:function(t){return W(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}},{key:"stop",value:function(t){this.session.stopped=t?2:1}},{key:"recognize",value:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i=void 0,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&j)&&(r=e.curRecognizer=null);for(var a=0;a<n.length;)i=n[a],2===e.stopped||r&&i!==r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(G|N|U)&&(r=e.curRecognizer=i),a++}}},{key:"get",value:function(t){if(t instanceof at)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event===t)return e[i];return null}},{key:"add",value:function(t){if(Y(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}},{key:"remove",value:function(t){if(Y(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=H(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this}},{key:"on",value:function(t,e){if(t!==n&&e!==n){var i=this.handlers;return X(At(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}}},{key:"off",value:function(t,e){if(t!==n){var i=this.handlers;return X(At(t),function(t){e?i[t]&&i[t].splice(H(i[t],e),1):delete i[t]}),this}}},{key:"emit",value:function(t,i){this.options.domEvents&&function(t,i){var n=e.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}(t,i);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){i.type=t,i.preventDefault=function(){i.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](i),r++}}},{key:"destroy",value:function(){this.element&&Qt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}}]),t}();function Qt(t,e){var i=t.element;if(i.style){var n=void 0;X(t.options.cssProps,function(r,a){n=u(i.style,a),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={})}}var Kt=function t(e,i){return J(this,t),(i=i||{}).recognizers=r(i.recognizers,t.defaults.preset),new Jt(e,i)};Kt.VERSION="2.0.8",Kt.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ot,{enable:!1}],[lt,{enable:!1},["rotate"]],[ut,{direction:z}],[ct,{direction:z},["swipe"]],[pt],[pt,{event:"doubletap",taps:2},["tap"]],[mt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $t={touchstart:w,touchmove:S,touchend:M,touchcancel:A},te="touchstart",ee="touchstart touchmove touchend touchcancel",ie=function(t){function e(){J(this,e);var t=tt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.evTarget=te,t.evWin=ee,t.started=!1,Pt.apply(t,arguments),t}return $(e,Pt),Q(e,[{key:"handler",value:function(t){var e=$t[t.type];if(e===w&&(this.started=!0),this.started){var i=function(t,e){var i=Lt(t.touches),n=Lt(t.changedTouches);e&(M|A)&&(i=Ft(i.concat(n),"identifier",!0));return[i,n]}.call(this,t,e);e&(M|A)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}}]),e}();function ne(e,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=t.console&&(t.console.warn||t.console.log);return a&&a.call(t.console,r,n),e.apply(this,arguments)}}var re=ne(function(t,e,i){for(var r=Object.keys(e),a=0;a<r.length;)(!i||i&&t[r[a]]===n)&&(t[r[a]]=e[r[a]]),a++;return t},"extend","Use `assign`."),ae=ne(function(t,e){return re(t,e,!0)},"merge","Use `assign`.");W(Kt,{INPUT_START:w,INPUT_MOVE:S,INPUT_END:M,INPUT_CANCEL:A,STATE_POSSIBLE:F,STATE_BEGAN:G,STATE_CHANGED:N,STATE_ENDED:U,STATE_RECOGNIZED:j,STATE_CANCELLED:Z,STATE_FAILED:32,DIRECTION_NONE:T,DIRECTION_LEFT:k,DIRECTION_RIGHT:D,DIRECTION_UP:P,DIRECTION_DOWN:E,DIRECTION_HORIZONTAL:z,DIRECTION_VERTICAL:O,DIRECTION_ALL:B,Manager:Jt,Input:Pt,TouchAction:_t,TouchInput:Ut,MouseInput:Vt,PointerEventInput:Rt,TouchMouseInput:Ht,SingleTouchInput:ie,Recognizer:at,AttrRecognizer:st,Tap:pt,Pan:ct,Swipe:ut,Pinch:lt,Rotate:ot,Press:mt,on:Tt,off:kt,each:X,merge:ae,extend:re,assign:W,inherit:function(t,e,i){var n=e.prototype,r=void 0;(r=t.prototype=Object.create(n)).constructor=t,r._super=n,i&&W(r,i)},bindFn:dt,prefixed:u,toArray:Lt,inArray:H,uniqueArray:Ft,splitStr:At,boolOrFn:it,hasParent:yt,addEventListeners:Tt,removeEventListeners:kt}),"function"==typeof define&&define.amd?define(function(){return Kt}):"undefined"!=typeof module&&module.exports?module.exports=Kt:t.Hammer=Kt}(window,document);var paper=function(t,e){var i=(t=t||require("./node/self.js")).window,n=t.document,r=new function(){var t=/^(statics|enumerable|beans|preserve)$/,i=[],n=i.slice,r=Object.create,a=Object.getOwnPropertyDescriptor,s=Object.defineProperty,o=i.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},l=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},h=function(t,e,i){if(t){var n=a(t,"length");(n&&"number"==typeof n.value?o:function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)}).call(t,e,i=i||t)}return i};function c(e,i,n,r,o){var l={};function h(t,h){"string"==typeof(h=h||(h=a(i,t))&&(h.get?h:h.value))&&"#"===h[0]&&(h=e[h.substring(1)]||h);var c,d="function"==typeof h,f=h,g=o||d&&!h.base?h&&h.get?t in e:e[t]:null;o&&g||(d&&g&&(h.base=g),d&&!1!==r&&(c=t.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),f&&!d&&f.get&&"function"==typeof f.get&&u.isPlainObject(f)||(f={value:f,writable:!0}),(a(e,t)||{configurable:!0}).configurable&&(f.configurable=!0,f.enumerable=null!=n?n:!c),s(e,t,f))}if(i){for(var c in i)i.hasOwnProperty(c)&&!t.test(c)&&h(c);for(var c in l){var d=l[c],f=e["set"+d],g=e["get"+d]||f&&e["is"+d];!g||!0!==r&&0!==g.length||h(c,{get:g,set:f})}}return e}function u(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&l(this,i)}return this}return c(u,{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,i=t.beans,n=t.preserve;e!==t&&c(this.prototype,t,t.enumerable,i,n),c(this,e,null,i,n)}for(var r=1,a=arguments.length;r<a;r++)this.inject(arguments[r]);return this},extend:function(){for(var t,e,i,n=this,a=0,o=arguments.length;a<o&&(!t||!e);a++)i=arguments[a],t=t||i.initialize,e=e||i.prototype;return e=(t=t||function(){n.apply(this,arguments)}).prototype=e||r(this.prototype),s(e,"constructor",{value:t,writable:!0,configurable:!0}),c(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=n,t}}).inject({enumerable:!1,initialize:u,set:u,inject:function(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&c(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var t=r(this);return t.inject.apply(t,arguments)},each:function(t,e){return h(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:l,each:h,create:r,define:s,describe:a,clone:function(t){return l(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===u||"Object"===e.name)},pick:function(t,i){return t!==e?t:i},slice:function(t,e,i){return n.call(t,e,i)}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?l.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),i=e.prototype._class;return i&&!r.exports[i]&&(r.exports[i]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((i=t.length)!==e.length)return!1;for(;i--;)if(!r.equals(t[i],e[i]))return!1}else{var i,n=Object.keys(t);if((i=n.length)!==Object.keys(e).length)return!1;for(;i--;){var a=n[i];if(!e.hasOwnProperty(a)||!r.equals(t[a],e[a]))return!1}}return!0}return!1},read:function(t,i,n,a){if(this===r){var s=this.peek(t,i);return t.__index++,s}var o=this.prototype,l=o._readIndex,h=i||l&&t.__index||0,c=t.length,u=t[h];if(a=a||c-h,u instanceof this||n&&n.readNull&&null==u&&a<=1)return l&&(t.__index=h+1),u&&n&&n.clone?u.clone():u;if(u=r.create(o),l&&(u.__read=!0),u=u.initialize.apply(u,h>0||h+a<c?r.slice(t,h,h+a):t)||u,l){t.__index=h+u.__read;var d=u.__filtered;d&&(t.__filtered=d,u.__filtered=e),u.__read=e}return u},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,i,n){for(var r,a=[],s=e||0,o=n?s+n:t.length,l=s;l<o;l++)a.push(Array.isArray(r=t[l])?this.read(r,0,i):this.read(t,l,i,1));return a},readNamed:function(t,i,n,a,s){var o=this.getNamed(t,i),l=o!==e;if(l){var h=t.__filtered;h||((h=t.__filtered=r.create(t[0])).__unfiltered=t[0]),h[i]=e}var c=l?[o]:t;return this.read(c,n,a,s)},getNamed:function(t,i){var n=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(n)),t._hasObject)return i?n[i]:t.__filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n,r){var a;function s(r){if(!(n&&r in n||a&&r in a)){var s=i[r];s!==e&&(t[r]=s)}}if(r){for(var o,l={},h=0,c=r.length;h<c;h++)(o=r[h])in i&&(s(o),l[o]=!0);a=l}return Object.keys(i.__unfiltered||i).forEach(s),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var a,s=!n;if(s&&(e.formatter=new l(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),a=t._class;a&&r[0]!==a&&r.unshift(a),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){a=t._serialize(e,n);var o=t._class;!o||t._compactSerialize||!s&&i||a[0]===o||a.unshift(o)}else if(Array.isArray(t)){a=[];for(var h=0,c=t.length;h<c;h++)a[h]=r.serialize(t[h],e,i,n)}else if(r.isPlainObject(t)){a={};var u=Object.keys(t);for(h=0,c=u.length;h<c;h++){var d=u[h];a[d]=r.serialize(t[d],e,i,n)}}else a="number"==typeof t?e.formatter.number(t,e.precision):t;return s&&n.length>0?[["dictionary",n.definitions],a]:a},deserialize:function(t,e,i,n,a){var s=t,o=!i,l=o&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var h=t[0],c="dictionary"===h;if(1==t.length&&/^#/.test(h))return i.dictionary[h];s=[];for(var u=(h=r.exports[h])?1:0,d=t.length;u<d;u++)s.push(r.deserialize(t[u],e,i,c,l));if(h){var f=s;e?s=e(h,f,o||a):(s=r.create(h.prototype),h.apply(s,f))}}else if(r.isPlainObject(t))for(var g in s={},n&&(i.dictionary=s),t)s[g]=r.deserialize(t[g],e,i);return l?s[1]:s},exportJSON:function(t,e){var i=r.serialize(t,e);return e&&0==e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var a=n&&e&&e.constructor===t,s=a?e:r.create(t.prototype);if(1===i.length&&s instanceof x&&(a||!(s instanceof I))){var o=i[0];r.isPlainObject(o)&&(o.insert=!1)}return(a?s.set:t).apply(s,i),a&&(e=null),s})},splice:function(t,i,n,r){var a=i&&i.length,s=n===e;(n=s?t.length:n)>t.length&&(n=t.length);for(var o=0;o<a;o++)i[o]._index=n+o;if(s)return t.push.apply(t,i),[];var l=[n,r];i&&l.push.apply(l,i);for(var h=t.splice.apply(t,l),c=(o=0,h.length);o<c;o++)h[o]._index=e;for(o=n+a,c=t.length;o<c;o++)t[o]._index=o;return h},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var a={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],a=this._callbacks=this._callbacks||{};-1===(a=a[t]=a[t]||[]).indexOf(e)&&(a.push(e),n&&n.install&&1===a.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var i,n=this._eventTypes,a=n&&n[t],s=this._callbacks&&this._callbacks[t];return s&&(!e||-1!==(i=s.indexOf(e))&&1===s.length?(a&&a.uninstall&&a.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&s.splice(i,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=r.slice(arguments,1),a=e&&e.target&&!e.currentTarget;i=i.slice(),a&&(e.currentTarget=this);for(var s=0,o=i.length;s<o;s++)if(0==i[s].apply(this,n)){e&&e.stop&&e.stop();break}return a&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var a=e[r],s=a&&a[n];s&&s.call(this,r)}},statics:{inject:function t(e){var i=e._events;if(i){var n={};r.each(i,function(t,i){var a="string"==typeof t,s=a?t:i,o=r.capitalize(s),l=s.substring(2).toLowerCase();n[l]=a?{}:t,s="_"+s,e["get"+o]=function(){return this[s]},e["set"+o]=function(t){var e=this[s];e&&this.off(l,e),t&&this.on(l,t),this[s]=t}}),e._eventTypes=n}return t.base.apply(this,arguments)}}},s=r.extend({_class:"PaperScope",initialize:function e(){paper=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var n=$.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:tt.nativeModes},$.release(n)}if(!this.agent){var a=t.navigator.userAgent.toLowerCase(),s=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(a)||[])[0],o="darwin"===s?"mac":s,l=i.agent=i.browser={platform:o};o&&(l[o]=!0),a.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!l.chrome){var a="opera"===e?n:/^(node|trident)$/.test(e)?r:i;l.version=a,l.versionNumber=parseFloat(a),e="trident"===e?"msie":e,l.name=e,l[e]=!0}}),l.chrome&&delete l.webkit,l.atom&&delete l.chrome}},version:"0.11.5",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),V.updateFocus()},install:function(t){var e=this;for(var i in r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})}),this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return paper=this,this.project=new y(t),this},createCanvas:function(t,e){return $.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,i=t.length-1;i>=0;i--)t[i].remove();for(i=e.length-1;i>=0;i--)e[i].remove()},remove:function(){this.clear(),delete s._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),o=r.extend(a,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),l=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});l.instance=new l;var h=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],i=Math.abs,n=Math.sqrt,r=Math.pow,a=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function s(t,e,i){return t<e?e:t>i?i:t}function o(t,e,n){function r(t){var e=134217729*t,i=t-e+e;return[i,t-i]}var a=e*e-t*n,s=e*e+t*n;if(3*i(a)<s){var o=r(t),l=r(e),h=r(n),c=e*e,u=t*n;a=c-u+(l[0]*l[0]-c+2*l[0]*l[1]+l[1]*l[1]-(o[0]*h[0]-u+o[0]*h[1]+o[1]*h[0]+o[1]*h[1]))}return a}function l(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?r(2,-Math.round(a(t))):0}return{EPSILON:1e-12,MACHINE_EPSILON:1.12e-16,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(n(2)-1)/3,isZero:function(t){return t>=-1e-12&&t<=1e-12},clamp:s,integrate:function(i,n,r,a){for(var s=t[a-2],o=e[a-2],l=.5*(r-n),h=l+n,c=0,u=a+1>>1,d=1&a?o[c++]*i(h):0;c<u;){var f=l*s[c];d+=o[c++]*(i(h+f)+i(h-f))}return l*d},findRoot:function(t,e,n,r,a,o,l){for(var h=0;h<o;h++){var c=t(n),u=c/e(n),d=n-u;if(i(u)<l){n=d;break}c>0?(a=n,n=d<=r?.5*(r+a):d):(r=n,n=d>=a?.5*(r+a):d)}return s(n,r,a)},solveQuadratic:function(t,e,r,a,h,c){var u,d=1/0;if(i(t)<1e-12){if(i(e)<1e-12)return i(r)<1e-12?-1:0;u=-r/e}else{var f=o(t,e*=-.5,r);if(f&&i(f)<1.12e-16){var g=l(i(t),i(e),i(r));g&&(f=o(t*=g,e*=g,r*=g))}if(f>=-1.12e-16){var p=f<0?0:n(f),m=e+(e<0?-p:p);0===m?d=-(u=r/t):(u=m/t,d=r/m)}}var v=0,_=null==h,y=h-1e-12,x=c+1e-12;return isFinite(u)&&(_||u>y&&u<x)&&(a[v++]=_?u:s(u,h,c)),d!==u&&isFinite(d)&&(_||d>y&&d<x)&&(a[v++]=_?d:s(d,h,c)),v},solveCubic:function(t,e,a,o,c,u,d){var f,g,p,m,v,_=l(i(t),i(e),i(a),i(o));function y(i){var n=t*(f=i);m=(n+(g=n+e))*f+(p=g*f+a),v=p*f+o}if(_&&(t*=_,e*=_,a*=_,o*=_),i(t)<1e-12)t=e,g=a,p=o,f=1/0;else if(i(o)<1e-12)g=e,p=a,f=0;else{y(-e/t/3);var x=v/t,b=r(i(x),1/3),I=x<0?-1:1,C=-m/t,w=C>0?1.324717957244746*Math.max(b,n(C)):b,S=f-I*w;if(S!==f){do{y(S),S=0===m?f:f-v/m/(1+1.12e-16)}while(I*S>I*f);i(t)*f*f>i(o/f)&&(g=((p=-o/f)-a)/f)}}var M=h.solveQuadratic(t,g,p,c,u,d),A=null==u;return isFinite(f)&&(0===M||M>0&&f!==c[0]&&f!==c[1])&&(A||f>u-1e-12&&f<d+1e-12)&&(c[M++]=A?f:s(f,u,d)),M}}},c={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},u=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var a="number"==typeof e;this._set(t,a?e:t),n&&(r=a?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var s="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(s)?this._set(+s[0],+(s.length>1?s[1]:s[0])):"x"in s?this._set(s.x||0,s.y||0):"width"in s?this._set(s.width||0,s.height||0):"angle"in s?(this._set(s.length||0,0),this.setAngle(s.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new u(this.x,this.y)},toString:function(){var t=l.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();h.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=u.read(arguments),e=this.getLength()*t.getLength();if(h.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=u.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=u.read(arguments),e=t.x-this.x,i=t.y-this.y,n=e*e+i*i;return r.read(arguments)?n:Math.sqrt(n)},normalize:function(t){t===e&&(t=1);var i=this.getLength(),n=0!==i?t/i:0,r=new u(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new u(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=u.read(arguments);return new u(this.x+t.x,this.y+t.y)},subtract:function(){var t=u.read(arguments);return new u(this.x-t.x,this.y-t.y)},multiply:function(){var t=u.read(arguments);return new u(this.x*t.x,this.y*t.y)},divide:function(){var t=u.read(arguments);return new u(this.x/t.x,this.y/t.y)},modulo:function(){var t=u.read(arguments);return new u(this.x%t.x,this.y%t.y)},negate:function(){return new u(-this.x,-this.y)},isInside:function(){return p.read(arguments).contains(this)},isClose:function(){var t=u.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=u.read(arguments);return u.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=u.read(arguments);return u.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=h.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=u.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=u.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=u.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new u(t.x*e,t.y*e)},statics:{min:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new u(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new u(e(this.x),e(this.y))}},{})),d=u.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),f=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var a="number"==typeof e;this._set(t,a?e:t),n&&(r=a?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var s="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(s)?this._set(+s[0],+(s.length>1?s[1]:s[0])):"width"in s?this._set(s.width||0,s.height||0):"x"in s?this._set(s.x||0,s.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new f(this.width,this.height)},toString:function(){var t=l.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=f.read(arguments);return new f(this.width+t.width,this.height+t.height)},subtract:function(){var t=f.read(arguments);return new f(this.width-t.width,this.height-t.height)},multiply:function(){var t=f.read(arguments);return new f(this.width*t.width,this.height*t.height)},divide:function(){var t=f.read(arguments);return new f(this.width/t.width,this.height/t.height)},modulo:function(){var t=f.read(arguments);return new f(this.width%t.width,this.height%t.height)},negate:function(){return new f(-this.width,-this.height)},isZero:function(){var t=h.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new f(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new f(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new f(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new f(e(this.width),e(this.height))}},{})),g=f.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),p=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,a){var s,o=typeof t;if("number"===o?(this._set(t,i,n,a),s=4):"undefined"===o||null===t?(this._set(0,0,0,0),s=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),s=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),s=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.filter(this,t),s=1)),s===e){var l,h,c=u.readNamed(arguments,"from"),d=r.peek(arguments),g=c.x,p=c.y;if(d&&d.x!==e||r.hasNamed(arguments,"to")){var m=u.readNamed(arguments,"to");l=m.x-g,h=m.y-p,l<0&&(g=m.x,l=-l),h<0&&(p=m.y,h=-h)}else{var v=f.read(arguments);l=v.width,h=v.height}this._set(g,p,l,h),s=arguments.__index;var _=arguments.__filtered;_&&(this.__filtered=_)}return this.__read&&(this.__read=s),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new p(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?p.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=l.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?u:d)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?f:g)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=f.read(arguments),e=this._sx,i=this._sy,n=t.width,r=t.height;e&&(this.x+=(this.width-n)*e),i&&(this.y+=(this.height-r)*i),this.width=n,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var e=t-this.x;this.width-=.5===this._sx?2*e:e}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var e=t-this.y;this.height-=.5===this._sy?2*e:e}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var e=t-this.x;this.width=.5===this._sx?2*e:e}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var e=t-this.y;this.height=.5===this._sy?2*e:e}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?u:d)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=u.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(p.read(arguments)):this._containsPoint(u.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=p.read(arguments),e=r.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=p.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new p(e,i,n-e,r-i)},unite:function(){var t=p.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new p(e,i,n-e,r-i)},include:function(){var t=u.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new p(e,i,n-e,r-i)},expand:function(){var t=f.read(arguments),e=t.width,i=t.height;return new p(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],a=t[n?1:0],s="get"+r,o="get"+a,l="set"+r,h="set"+a,c="set"+i;this["get"+i]=function(t){return new(t?u:d)(this[s](),this[o](),this,c)},this[c]=function(){var t=u.read(arguments);this[l](t.x),this[h](t.y)}},{beans:!0})),m=p.extend({initialize:function(t,e,i,n,r,a){this._set(t,e,i,n,!0),this._owner=r,this._setter=a},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=p.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),v=r.extend({_class:"Matrix",initialize:function t(e,i){var n=arguments.length,r=!0;if(n>=6?this._set.apply(this,arguments):1===n||2===n?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,i):Array.isArray(e)?this._set.apply(this,i?e.concat([i]):e):r=!1:n?r=!1:this.reset(),!r)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,a,s){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=a,s||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new v(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=l.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=u.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=u.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),a=Math.sin(t),s=i-i*r+n*a,o=n-i*a-n*r,l=this._a,h=this._b,c=this._c,d=this._d;return this._a=r*l+a*c,this._b=r*h+a*d,this._c=-a*l+r*c,this._d=-a*h+r*d,this._tx+=s*l+o*c,this._ty+=s*h+o*d,this._changed(),this},shear:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new u(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},append:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,a=this._d,s=t._a,o=t._c,l=t._b,h=t._d,c=t._tx,u=t._ty;this._a=s*i+l*r,this._c=o*i+h*r,this._b=s*n+l*a,this._d=o*n+h*a,this._tx+=c*i+u*r,this._ty+=c*n+u*a,e||this._changed()}return this},prepend:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,a=this._d,s=this._tx,o=this._ty,l=t._a,h=t._c,c=t._b,u=t._d,d=t._tx,f=t._ty;this._a=l*i+h*n,this._c=l*r+h*a,this._b=c*i+u*n,this._d=c*r+u*a,this._tx=l*s+h*o+d,this._ty=c*s+u*o+f,e||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,a=this._ty,s=t*n-e*i,o=null;return s&&!isNaN(s)&&isFinite(r)&&isFinite(a)&&(this._a=n/s,this._b=-e/s,this._c=-i/s,this._d=t/s,this._tx=(i*a-n*r)/s,this._ty=(e*r-t*a)/s,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new v(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(u.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new u),e._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var a=t[n],s=t[n+1];e[n]=a*this._a+s*this._c+this._tx,e[n+1]=a*this._b+s*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,a=[e,i,n,i,n,r,e,r];return this._transformCoordinates(a,a,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),a=r.slice(),s=2;s<8;s++){var o=n[s],l=1&s;o<r[l]?r[l]=o:o>a[l]&&(a[l]=o)}return e||(e=new p),e._set(r[0],r[1],a[0]-r[0],a[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(u.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,a=this._c,s=this._d,o=this._tx,l=this._ty,h=n*s-r*a,c=null;if(h&&!isNaN(h)&&isFinite(o)&&isFinite(l)){var d=t.x-this._tx,f=t.y-this._ty;e||(e=new u),c=e._set((d*s-f*a)/h,(f*n-d*r)/h,i)}return c},decompose:function(){var t,e,i,n=this._a,r=this._b,a=this._c,s=this._d,o=n*s-r*a,l=Math.sqrt,h=Math.atan2,c=180/Math.PI;if(0!==n||0!==r){var d=l(n*n+r*r);t=Math.acos(n/d)*(r>0?1:-1),e=[d,o/d],i=[h(n*a+r*s,d*d),0]}else if(0!==a||0!==s){var f=l(a*a+s*s);t=Math.asin(a/f)*(s>0?1:-1),e=[o/f,f],i=[0,h(n*a+r*s,f*f)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*c,scaling:new u(e),skewing:new u(i[0]*c,i[1]*c)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new u(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),_=r.extend({_class:"Line",initialize:function(t,e,i,n,r){var a=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,a=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,a=i),a||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new u(this._px,this._py)},getVector:function(){return new u(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return _.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return _.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return _.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return u.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return u.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,a,s,o,l,c){l||(i-=t,n-=e,s-=r,o-=a);var d=i*o-n*s;if(!h.isZero(d)){var f=t-r,g=e-a,p=(s*g-o*f)/d,m=(i*g-n*f)/d;if(c||-1e-12<p&&p<1+1e-12&&-1e-12<m&&m<1+1e-12)return c||(p=p<=0?0:p>=1?1:p),new u(t+p*i,e+p*n)}},getSide:function(t,e,i,n,r,a,s,o){s||(i-=t,n-=e);var l=r-t,c=l*n-(a-e)*i;return!o&&h.isZero(c)&&(c=(l*i+l*i)/(i*i+n*n))>=0&&c<=1&&(c=0),c<0?-1:c>0?1:0},getSignedDistance:function(t,e,i,n,r,a,s){return s||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?a-e:e-a:((r-t)*n-(a-e)*i)/Math.sqrt(i*i+n*n)},getDistance:function(t,e,i,n,r,a,s){return Math.abs(_.getSignedDistance(t,e,i,n,r,a,s))}}}),y=o.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){o.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new j(null,null,this),this._view=V.create(this,t||$.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,a=e._id,s=r[a];s?s.flags|=t:n.push(r[a]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new I({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:S,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof I){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,i,n){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new I(x.NO_INSERT),!0)).insertChild(t,i),n&&i.activate&&i.activate(),i},getItems:function(t){return x._getItems(this,t)},getItem:function(t){return x._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var a in e){var s=e[a];s&&s!=i&&delete s[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,a=new r({offset:new u(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new v],updateMatrix:!0}),s=0,o=n.length;s<o;s++)n[s].draw(t,a);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var l=this._selectionItems,h=this._scope.settings.handleSize,c=this._updateVersion;for(var d in l)l[d]._drawSelection(t,e,h,l,c);t.restore()}}}),x=r.extend(a,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=r.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_enhanceBlendMode:!1,_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new v,pivot:null,visible:!0,blendMode:"normal",enhanceBlendMode:!1,opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),a=n&&!0===t.internal,s=this._matrix=new v,o=n&&t.project||paper.project,l=paper.settings;return this._id=a?null:c.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&l.applyMatrix,i&&s.translate(i),s._owner=this,this._style=new j(o._currentStyle,this,o),a||n&&0==t.insert||!l.insertItems&&(!n||!0!==t.insert)?this._setProject(o):(n&&t.parent||o)._insertItem(e,this,!0),n&&t!==x.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){var i={},n=this;function a(a){for(var s in a){var o=n[s];r.equals(o,"leading"===s?1.2*a.fontSize:a[s])||(i[s]=r.serialize(o,t,"data"!==s,e))}}return a(this._serializeFields),this instanceof b||a(this._style._defaults),[this._class,i]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),n&&40&t&&x._clearBoundsCache(n),2&t&&x._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(t&&i){var n=i._children,r=i._namedChildren;(r[t]=r[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide","enhanceBlendMode"],function(t){var e=r.capitalize(t),i="_"+t,n={locked:128,visible:137};this["get"+e]=function(){return this[i]},this["set"+e]=function(e){e!=this[i]&&(this[i]=e,this._changed(n[t]||129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?u:d;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(u.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new d(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=u.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof v,n=r.set({},i?e:t,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var a=this._getCachedBounds(i&&t,n).rect;return arguments.length?a:new m(a.x,a.y,a.width,a.height,this,"setBounds")},setBounds:function(){var t=p.read(arguments),e=this.getBounds(),i=this._matrix,n=new v,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.set(i._backup||(new v).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(x._updateBoundsCache(this,e.cacheItem),x._getBounds(i,t,e)):new p},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,i){t=t&&t._orNullIfIdentity();var n=e.internal&&!i,r=e.cacheItem,a=n?null:this._matrix._orNullIfIdentity(),s=r&&(!t||t.equals(a))&&this._getBoundsCacheKey(e,n),o=this._bounds;if(x._updateBoundsCache(this._parent||this._symbol,r),s&&o&&s in o)return{rect:(d=o[s]).rect.clone(),nonscaling:d.nonscaling};var l=this._getBounds(t||a,e),h=l.rect||l,c=this._style,u=l.nonscaling||c.hasStroke()&&!c.getStrokeScaling();if(s){o||(this._bounds=o={});var d=o[s]={rect:h.clone(),nonscaling:u,internal:n}}return{rect:h,nonscaling:u}},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,a=r.length;n<a;n++){var s=r[n];s!==t&&(s._bounds=s._position=e,s._boundsCache&&x._clearBoundsCache(s))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,a=n,s=r,o=!1;i=i||{};for(var l=0,h=t.length;l<h;l++){var c=t[l];if(c._visible&&!c.isEmpty()){var u=c._getCachedBounds(e&&e.appended(c._matrix),i,!0),d=u.rect;n=Math.min(d.x,n),a=Math.min(d.y,a),r=Math.max(d.x+d.width,r),s=Math.max(d.y+d.height,s),u.nonscaling&&(o=!0)}}return{rect:isFinite(n)?new p(n,a,r-n,s-a):new p,nonscaling:o}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new d(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var i=this.getRotation(),n=this._decomposed,r=new v,a=this.getPosition(!0);r.translate(a),i&&r.rotate(i),r.scale(e.x/t.x,e.y/t.y),i&&r.rotate(-i),r.translate(a.negate()),this.transform(r),n&&(n.scaling=e,this._decomposed=n)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.prepend(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof I)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var i=new this.constructor(x.NO_INSERT),n=this._children,a=r.pick(t?t.insert:e,t===e||!0===t),s=r.pick(t?t.deep:e,!0);n&&i.copyAttributes(this),n&&!s||i.copyContent(this),n||i.copyAttributes(this),a&&i.insertAbove(this);var o=this._name,l=this._parent;if(o&&l){n=l._children;for(var h=o,c=1;n[o];)o=h+" "+c++;o!==h&&i.setName(o)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide","_enhanceBlendMode"],n=0,a=i.length;n<a;n++){var s=i[n];t.hasOwnProperty(s)&&(this[s]=t[s])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,l=t._name;this._data=o?r.clone(o):null,l&&this.setName(l)},rasterize:function(t,i){var n=this.getStrokeBounds(),a=(t||this.getView().getResolution())/72,s=n.getTopLeft().floor(),o=n.getBottomRight().ceil(),l=new f(o.subtract(s)),h=new w(x.NO_INSERT);if(!l.isZero()){var c=$.getCanvas(l.multiply(a)),u=c.getContext("2d"),d=(new v).scale(a).translate(s.negate());u.save(),d.applyToContext(u),this.draw(u,new r({matrices:[d]})),u.restore(),h.setCanvas(c)}return h.transform((new v).translate(s.add(l.divide(2))).scale(1/a)),(i===e||i)&&h.insertAbove(this),h},contains:function(){return!!this._contains(this._matrix._inverseTransform(u.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return p.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new z.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof x&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(u.read(arguments),A.getOptions(arguments))}function e(){var t=u.read(arguments),e=A.getOptions(arguments),i=[];return this._hitTest(t,r.set({all:i},e)),i}function i(t,e,i,n){var r=this._children;if(r)for(var a=r.length-1;a>=0;a--){var s=r[a],o=s!==n&&s._hitTest(t,e,i);if(o&&!e.all)return o}return null}return y.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var n=this._matrix,a=i?i.appended(n):this.getGlobalMatrix().prepend(this.getView()._matrix),s=Math.max(e.tolerance,1e-12),o=e._tolerancePadding=new f(z._getStrokePadding(s,n._shiftless().invert()));if(!(t=n._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(o.multiply(2))._containsPoint(t))return null;var l,h,c=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),u=e.match,d=this;function g(t){return t&&u&&!u(t)&&(t=null),t&&e.all&&e.all.push(t),t}function p(e,i){var n=i?l["get"+i]():d.getPosition();if(t.subtract(n).divide(o).length<=1)return new A(e,d,{name:i?r.hyphenate(i):e,point:n})}var m=e.position,v=e.center,_=e.bounds;if(c&&this._parent&&(m||v||_)){if((v||_)&&(l=this.getInternalBounds()),!(h=m&&p("position")||v&&p("center","Center"))&&_)for(var y=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],x=0;x<8&&!h;x++)h=p("bounds",y[x]);h=g(h)}return h||(h=this._hitTestChildren(t,e,a)||c&&g(this._hitTestSelf(t,e,a,this.getStrokeScaling()?null:a._shiftless().invert()))||null),h&&h.point&&(h.point=n.transform(h.point)),h},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new A("fill",this)},matches:function(t,e){var i=typeof t;if("object"===i){for(var n in t)if(t.hasOwnProperty(n)&&!this.matches(n,t[n]))return!1;return!0}if("function"===i)return t(this);if("match"===t)return e(this);var a=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;a=this._class}if("function"==typeof e)return!!e(a);if(e){if(e.test)return e.test(a);if(r.isPlainObject(e))return function t(e,i){for(var n in e)if(e.hasOwnProperty(n)){var a=e[n],s=i[n];if(r.isPlainObject(a)&&r.isPlainObject(s)){if(!t(a,s))return!1}else if(!r.equals(a,s))return!1}return!0}(e,a)}return r.equals(a,e)},getItems:function(t){return x._getItems(this,t,this._matrix)},getItem:function(t){return x._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,i,n,a,s){if(!a){var o="object"==typeof i&&i,l=o&&o.overlapping,h=o&&o.inside,c=(x=l||h)&&p.read([x]);a={items:[],recursive:o&&!1!==o.recursive,inside:!!h,overlapping:!!l,rect:c,path:l&&new z.Rectangle({rectangle:c,insert:!1})},o&&(i=r.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var u=e._children,d=a.items;n=(c=a.rect)&&(n||new v);for(var f=0,g=u&&u.length;f<g;f++){var m=u[f],_=n&&n.appended(m._matrix),y=!0;if(c){var x=m.getBounds(_);if(!c.intersects(x))continue;c.contains(x)||a.overlapping&&(x.contains(c)||a.path.intersects(m,_))||(y=!1)}if(y&&m.matches(i)&&(d.push(m),s))break;if(!1!==a.recursive&&t(m,i,_,a,s),s&&d.length>0)break}return d}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,e){var i=e?this.insertChildren(t,[e]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&e.length>0){for(var n={},a=(e=r.slice(e)).length-1;a>=0;a--){var s=(c=e[a])&&c._id;!c||n[s]?e.splice(a,1):(c._remove(!1,!0),n[s]=!0)}r.splice(i,e,t,0);for(var o=this._project,l=o._changes,h=(a=0,e.length);a<h;a++){var c,u=(c=e[a])._name;c._parent=this,c._setProject(o,!0),u&&c.setName(u),l&&c._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(e,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],a=r?r.indexOf(this):-1;-1!==a&&(e[n]==this&&delete e[n],r.splice(a,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,a=this._index;return!!i&&(this._name&&this._removeNamed(),null!=a&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,a,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,a=Math.min(i.length,n.length);r<a;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:u).read(arguments),n=u.read(arguments,0,{readNull:!0});return this.transform((new v)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new v;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i,n){var r=this._matrix,a=t&&!t.isIdentity(),s=(e||this._applyMatrix)&&(!r.isIdentity()||a||e&&i&&this._children);if(!a&&!s)return this;if(a){!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0);var o=this._style,l=o.getFillColor(!0),h=o.getStrokeColor(!0);l&&l.transform(t),h&&h.transform(t)}if(s&&(s=this._transformContent(r,i,n))){var c=this._pivot;c&&r._transformPoint(c,c,!0),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,d=this._position;(a||s)&&this._changed(9);var f=a&&u&&t.decompose();if(f&&f.skewing.isZero()&&f.rotation%90==0){for(var g in u){var p=u[g];if(p.nonscaling)delete u[g];else if(s||!p.internal){var m=p.rect;t._transformBounds(m,m)}}this._bounds=u;var v=u[this._getBoundsCacheKey(this._boundsOptions||{})];v&&(this._position=v.rect.getCenter(!0))}else a&&d&&this._pivot&&(this._position=t._transformPoint(d,d));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,a=n.length;r<a;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(u.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(u.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(u.read(arguments))},localToParent:function(){return this._matrix._transformPoint(u.read(arguments))},fitBounds:function(t,e){t=p.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,a=(e?n>r:n<r)?t.width/i.width:t.height/i.height,s=new p(new u,new f(i.width*a,i.height*a));s.setCenter(t.getCenter()),this.setBounds(s)}}),{_setStyles:function(t,e,i){var n=this._style,r=this._matrix;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t,r)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t,r),t.lineWidth=n.getStrokeWidth();var a=n.getStrokeJoin(),s=n.getStrokeCap(),o=n.getMiterLimit();if(a&&(t.lineJoin=a),s&&(t.lineCap=s),o&&(t.miterLimit=o),paper.support.nativeDash){var l=n.getDashArray(),h=n.getDashOffset();l&&l.length&&("setLineDash"in t?(t.setLineDash(l),t.lineDashOffset=h):(t.mozDash=l,t.mozDashOffset=h))}}if(n.hasShadow()){var c=e.pixelRatio||1,d=i._shiftless().prepend((new v).scale(c,c)),f=d.transform(new u(n.getShadowBlur(),0)),g=d.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=f.getLength(),t.shadowOffsetX=g.x,t.shadowOffsetY=g.y}},draw:function(t,e,i){var n=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,a=e.viewMatrix,s=this._matrix,o=r[r.length-1].appended(s);if(o.isInvertible()){a=a?a.appended(o):o,r.push(o),e.updateMatrix&&(o._updateVersion=n,this._globalMatrix=o);var l,h,c,u=this._enhanceBlendMode,d=this._blendMode,f=this._opacity,g="normal"===d,p=tt.nativeModes[d],m=g&&1===f||e.dontStart||e.clip||(p||g&&f<1)&&this._canComposite(),v=e.pixelRatio||1;if(!m){var _=this.getStrokeBounds(a);if(!_.width||!_.height)return;c=e.offset,h=e.offset=_.getTopLeft().floor(),l=t,t=$.getContext(_.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();var y=i?i.appended(s):this._canScaleStroke&&!this.getStrokeScaling(!0)&&a,x=!m&&e.clipItem,b=!y||x;if(m?(t.globalAlpha=f,p&&(t.globalCompositeOperation=d)):b&&t.translate(-h.x,-h.y),b&&(m?s:a).applyToContext(t),x&&e.clipItem.draw(t,e.extend({clip:!0})),y){t.setTransform(v,0,0,v,0,0);var I=e.offset;I&&t.translate(-I.x,-I.y)}this._draw(t,e,a,y),m&&"normal"!=d&&u&&this._draw(t,e,a,y),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),m||(tt.process(d,t,l,f,h.subtract(c).multiply(v)),"normal"!=d&&u&&tt.process(d,t,l,f,h.subtract(c).multiply(v)),$.release(t),e.offset=c)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof O)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var a=this._selection,s=1&a,o=2&a||s&&this._selectBounds,l=4&a;if(this._drawSelected||(s=!1),(s||o||l)&&this._isUpdated(r)){var h,c=this.getSelectedColor(!0)||(h=this.getLayer())&&h.getSelectedColor(!0),u=e.appended(this.getGlobalMatrix(!0)),d=i/2;if(t.strokeStyle=t.fillStyle=c?c.toCanvasStyle(t):"#009dec",s&&this._drawSelected(t,u,n),l){var f=this.getPosition(!0),g=f.x,p=f.y;t.beginPath(),t.arc(g,p,d,0,2*Math.PI,!0),t.stroke();for(var m=[[0,-1],[1,0],[0,1],[-1,0]],v=d,_=i+1,y=0;y<4;y++){var x=m[y],b=x[0],I=x[1];t.moveTo(g+b*v,p+I*v),t.lineTo(g+b*_,p+I*_),t.stroke()}}if(o){var C=u._transformCorners(this.getInternalBounds());t.beginPath();for(y=0;y<8;y++)t[y?"lineTo":"moveTo"](C[y],C[++y]);t.closePath(),t.stroke();for(y=0;y<8;y++)t.fillRect(C[y]-d,C[++y]-d,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),b=x.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(i){t.base.call(this,i),1026&i&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,i){var n=this._getClipItem();return n?n._getCachedBounds(e&&e.appended(n._matrix),r.set({},i,{stroke:!1})):t.base.call(this,e,i)},_hitTestChildren:function t(e,i,n){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,i,n,r)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,a=0,s=r.length;a<s;a++){var o=r[a];o!==n&&o.draw(t,e)}}}),I=b.extend({_class:"Layer",initialize:function(){b.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),C=x.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new g(t.width,t.height,this,"setSize")},setSize:function(){var t=f.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;"rectangle"===e?this._radius.set(f.min(this._radius,t.divide(2))):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new g(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size._set(i,i)}else if(t=f.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t),"rectangle"===e){i=f.max(this._size,t.multiply(2));this._size.set(i)}else"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new(z[r.capitalize(this._type)])({center:new u,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),paper.settings.applyMatrix&&i.setApplyMatrix(!0),(t===e||t)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,i,n){var r=this._style,a=r.hasFill(),s=r.hasStroke(),o=e.dontFinish||e.clip,l=!n;if(a||s||o){var h=this._type,c=this._radius,u="circle"===h;if(e.dontStart||t.beginPath(),l&&u)t.arc(0,0,c,0,2*Math.PI,!0);else{var d=u?c:c.width,f=u?c:c.height,g=this._size,p=g.width,m=g.height;if(l&&"rectangle"===h&&0===d&&0===f)t.rect(-p/2,-m/2,p,m);else{var v=p/2,_=m/2,y=.44771525016920644,x=d*y,b=f*y,I=[-v,-_+f,-v,-_+b,-v+x,-_,-v+d,-_,v-d,-_,v-x,-_,v,-_+b,v,-_+f,v,_-f,v,_-b,v-x,_,v-d,_,-v+d,_,-v+x,_,-v,_-b,-v,_-f];n&&n.transform(I,I,32),t.moveTo(I[0],I[1]),t.bezierCurveTo(I[2],I[3],I[4],I[5],I[6],I[7]),v!==d&&t.lineTo(I[8],I[9]),t.bezierCurveTo(I[10],I[11],I[12],I[13],I[14],I[15]),_!==f&&t.lineTo(I[16],I[17]),t.bezierCurveTo(I[18],I[19],I[20],I[21],I[22],I[23]),v!==d&&t.lineTo(I[24],I[25]),t.bezierCurveTo(I[26],I[27],I[28],I[29],I[30],I[31])}}t.closePath()}o||!a&&!s||(this._setStyles(t,e,i),a&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),s&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new p(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(z._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),a=1;a<=4;a++){var s=new u(a>1&&a<4?-1:1,a>2?-1:1),o=s.multiply(r),l=o.subtract(s.multiply(n));if(new p(i?o.add(s.multiply(i)):o,l).contains(e))return{point:l,quadrant:a}}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n.point).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,a,s){var o=!1,l=this._style,h=r.stroke&&l.hasStroke(),c=r.fill&&l.hasFill();if(h||c){var u=this._type,d=this._radius,f=h?l.getStrokeWidth()/2:0,g=r._tolerancePadding.add(z._getStrokePadding(f,!l.getStrokeScaling()&&s));if("rectangle"===u){var m=g.multiply(2),v=t(this,n,m);if(v)o=e(n.subtract(v.point),d,g,v.quadrant);else{var _=new p(this._size).setCenter(0,0),y=_.expand(m),x=_.expand(m.negate());o=y._containsPoint(n)&&!x._containsPoint(n)}}else o=e(n,d,g)}return o?new A(h?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,a){var s=new C(r.getNamed(a),e);return s._type=t,s._size=i,s._radius=n,s}return{Circle:function(){var e=u.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return t("circle",e,new f(2*i),i,arguments)},Rectangle:function(){var e=p.readNamed(arguments,"rectangle"),i=f.min(f.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=C._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;if(r.hasNamed(t,"radius"))e=u.readNamed(t,"center"),i=f.readNamed(t,"radius");else{var n=p.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),w=x.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],initialize:function(t,i){if(!this._initialize(t,i!==e&&u.read(arguments,1))){var r="string"==typeof t?n.getElementById(t):t;r?this.setImage(r):this.setSource(t)}this._size||(this._size=new f,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=$.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new g(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=f.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage($.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&$.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new u(0,0).transform(t),i=new u(1,0).transform(t).subtract(e),n=new u(0,1).transform(t).subtract(e);return new f(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var e=this;function i(t){var i=e.getView(),n=t&&t.type||"load";i&&e.responds(n)&&(paper=i._scope,e.emit(n,new Y(t)))}this._setImage(t),this._loaded?setTimeout(i,0):t&&W.add(t,{load:function(n){e._setImage(t),i(n)},error:i})},_setImage:function(t){this._canvas&&$.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new f(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=$.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){$.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var i=new t.Image,n=this._crossOrigin;n&&(i.crossOrigin=n),i.src=e,this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=p.read(arguments),e=$.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=p.read(arguments),e=new w(x.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=u.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof E?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new p(t):"x"in t&&(e=new p(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var n=Math.min(e.width,32),a=Math.min(e.height,32),s=w._sampleContext;s?s.clearRect(0,0,33,33):s=w._sampleContext=$.getContext(new f(32)),s.save();var o=(new v).scale(n/e.width,a/e.height).translate(-e.x,-e.y);o.applyToContext(s),i&&i.draw(s,new r({clip:!0,matrices:[o]})),this._matrix.applyToContext(s);var l=this.getElement(),h=this._size;l&&s.drawImage(l,-h.width/2,-h.height/2),s.restore();for(var c=s.getImageData(.5,.5,Math.ceil(n),Math.ceil(a)).data,u=[0,0,0],d=0,g=0,m=c.length;g<m;g+=4){var _=c[g+3];d+=_,_/=255,u[0]+=c[g]*_,u[1]+=c[g+1]*_,u[2]+=c[g+2]*_}for(g=0;g<3;g++)u[g]/=d;return d?G.read(u):null},getPixel:function(){var t=u.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new G("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=u.read(arguments),e=G.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),a=r.createImageData(1,1),s=a.data;s[0]=255*i[0],s[1]=255*i[1],s[2]=255*i[2],s[3]=null!=n?255*n:255,r.putImageData(a,t.x,t.y)},createImageData:function(){var t=f.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=p.read(arguments);return t.isEmpty()&&(t=new p(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=u.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new p(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new A("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),S=x.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&u.read(arguments,1))||this.setDefinition(t instanceof M?t:new M(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i){var n=this._definition._item._hitTest(t,e,i);return n&&(n.item=this),n},_draw:function(t,e){this._definition._item.draw(t,e)}}),M=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=c.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&x._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new u),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new S(this,t)},clone:function(){return new M(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),A=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&this.inject(i)},statics:{getOptions:function(t){var e=t&&r.read(t);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),T=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,a,s){var o,l,h,c,u=arguments.length;u>0&&(null==t||"object"==typeof t?1===u&&t&&"point"in t?(o=t.point,l=t.handleIn,h=t.handleOut,c=t.selection):(o=t,l=i,h=n,c=r):(o=[t,i],l=n!==e?[n,r]:null,h=a!==e?[a,s]:null)),new k(o,this,"_point"),new k(l,this,"_handleIn"),new k(h,this,"_handleOut"),c&&this.setSelection(c)},_serialize:function(t,e){var i=this._point,n=this._selection,a=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&a.push(n),r.serialize(a,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(u.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(u.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(u.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(129))},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new P(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,i,n){var r=t||{},a=r.type,s=r.factor,o=this.getPrevious(),l=this.getNext(),h=(o||this)._point,c=this._point,d=(l||this)._point,f=h.getDistance(c),g=c.getDistance(d);if(a&&"catmull-rom"!==a){if("geometric"!==a)throw new Error("Smoothing method '"+a+"' not supported.");if(o&&l){var p=h.subtract(d),m=s===e?.4:s,v=m*f/(f+g);i||this.setHandleIn(p.multiply(v)),n||this.setHandleOut(p.multiply(v-m))}}else{var _=s===e?.5:s,y=Math.pow(f,_),x=y*y,b=Math.pow(g,_),I=b*b;if(!i&&o){var C=2*I+3*b*y+x,w=3*b*(b+y);this.setHandleIn(0!==w?new u((I*h._x+C*c._x-x*d._x)/w-c._x,(I*h._y+C*c._y-x*d._y)/w-c._y):new u)}if(!n&&l){C=2*x+3*y*b+I,w=3*y*(y+b);this.setHandleOut(0!==w?new u((x*d._x+C*c._x-I*h._x)/w-c._x,(x*d._y+C*c._y-I*h._y)/w-c._y):new u)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new T(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new T(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,a=t._point,s=e._point,o=t._handleIn,l=e._handleIn,h=e._handleOut,c=t._handleOut;this._point._set(n*a._x+r*s._x,n*a._y+r*s._y,!0),this._handleIn._set(n*o._x+r*l._x,n*o._y+r*l._y,!0),this._handleOut._set(n*c._x+r*h._x,n*c._y+r*h._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,a=i&&this._handleOut.isZero()?null:this._handleOut,s=n._x,o=n._y,l=2;return e[0]=s,e[1]=o,r&&(e[l++]=r._x+s,e[l++]=r._y+o),a&&(e[l++]=a._x+s,e[l++]=a._y+o),t&&(t._transformCoordinates(e,e,l/2),s=e[0],o=e[1],i?(n._x=s,n._y=o,l=2,r&&(r._x=e[l++]-s,r._y=e[l++]-o),a&&(a._x=e[l++]-s,a._y=e[l++]-o)):(r||(e[l++]=s,e[l++]=o),a||(e[l++]=s,e[l++]=o))),e}}),k=u.extend({initialize:function(t,i,n){var r,a,s;if(t)if((r=t[0])!==e)a=t[1];else{var o=t;(r=o.x)===e&&(r=(o=u.read(arguments)).x),a=o.y,s=o.selected}else r=a=0;this._x=r,this._y=a,this._owner=i,i[n]=this,s&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=h.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),D=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,a,s,o){var l,h,c,u,d,f,g=arguments.length;3===g?(this._path=t,l=e,h=i):g?1===g?"segment1"in t?(l=new T(t.segment1),h=new T(t.segment2)):"point1"in t?(c=t.point1,d=t.handle1,f=t.handle2,u=t.point2):Array.isArray(t)&&(c=[t[0],t[1]],u=[t[6],t[7]],d=[t[2]-t[0],t[3]-t[1]],f=[t[4]-t[6],t[5]-t[7]]):2===g?(l=new T(t),h=new T(e)):4===g?(c=t,d=e,f=i,u=n):8===g&&(c=[t,e],u=[s,o],d=[i-t,n-e],f=[r-s,a-o]):(l=new T,h=new T),this._segment1=l||new T(c,null,d),this._segment2=h||new T(u,f,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new D(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return D.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(u.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(u.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(u.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(u.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return D.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new u(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=D.getLength(this.getValues(),0,1)),this._length},getArea:function(){return D.getArea(this.getValues())},getLine:function(){return new _(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new D(D.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return D.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var i=null;if(t>=1e-8&&t<=1-1e-8){var n=D.subdivide(this.getValues(),t),r=n[0],a=n[1],s=e||this.hasHandles(),o=this._segment1,l=this._segment2,h=this._path;s&&(o._handleOut._set(r[2]-r[0],r[3]-r[1]),l._handleIn._set(a[4]-a[6],a[5]-a[7]));var c=r[6],d=r[7],f=new T(new u(c,d),s&&new u(r[4]-c,r[5]-d),s&&new u(a[2]-c,a[3]-d));h?(h.insert(o._index+1,f),i=this.getNext()):(this._segment2=f,this._changed(),i=new D(f,l))}return i},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new D(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,i,n){var r=t._point,a=t._handleOut,s=e._handleIn,o=e._point,l=r.x,h=r.y,c=o.x,u=o.y,d=n?[l,h,l,h,c,u,c,u]:[l,h,l+a._x,h+a._y,c+s._x,u+s._y,c,u];return i&&i._transformCoordinates(d,d,4),d},subdivide:function(t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7];i===e&&(i=.5);var u=1-i,d=u*n+i*a,f=u*r+i*s,g=u*a+i*o,p=u*s+i*l,m=u*o+i*h,v=u*l+i*c,_=u*d+i*g,y=u*f+i*p,x=u*g+i*m,b=u*p+i*v,I=u*_+i*x,C=u*y+i*b;return[[n,r,d,f,_,y,I,C],[I,C,x,b,m,v,h,c]]},getMonoCurves:function(t,e){var i=[],n=e?0:1,r=t[n+0],a=t[n+2],s=t[n+4],o=t[n+6];if(r>=a==a>=s&&a>=s==s>=o||D.isStraight(t))i.push(t);else{var l=3*(a-s)-r+o,c=2*(r+s)-4*a,u=a-r,d=[],f=h.solveQuadratic(l,c,u,d,1e-8,1-1e-8);if(f){d.sort();var g=d[0],p=D.subdivide(t,g);i.push(p[0]),f>1&&(g=(d[1]-g)/(1-g),p=D.subdivide(p[1],g),i.push(p[0])),i.push(p[1])}else i.push(t)}return i},solveCubic:function(t,e,i,n,r,a){var s=t[e],o=t[e+2],l=t[e+4],c=t[e+6],u=0;if(!(s<i&&c<i&&o<i&&l<i||s>i&&c>i&&o>i&&l>i)){var d=3*(o-s),f=3*(l-o)-d,g=c-s-d-f;u=h.solveCubic(g,f,d,s-i,n,r,a)}return u},getTimeOf:function(t,e){var i=new u(t[0],t[1]),n=new u(t[6],t[7]);if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var r=[e.x,e.y],a=[],s=0;s<2;s++)for(var o=D.solveCubic(t,s,r[s],a,0,1),l=0;l<o;l++){var h=a[l];if(e.isClose(D.getPoint(t,h),1e-7))return h}return e.isClose(i,1e-7)?0:e.isClose(n,1e-7)?1:null},getNearestTime:function(t,e){if(D.isStraight(t)){var i=t[0],n=t[1],r=t[6]-i,a=t[7]-n,s=r*r+a*a;if(0===s)return 0;var o=((e.x-i)*r+(e.y-n)*a)/s;return o<1e-12?0:o>.999999999999?1:D.getTimeOf(t,new u(i+o*r,n+o*a))}var l=1/0,h=0;function c(i){if(i>=0&&i<=1){var n=e.getDistance(D.getPoint(t,i),!0);if(n<l)return l=n,h=i,!0}}for(var d=0;d<=100;d++)c(d/100);for(var f=.005;f>1e-8;)c(h-f)||c(h+f)||(f/=2);return h},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=D.subdivide(t,e)[1]),i<1&&(t=D.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=3*r-2*i-l,u=3*a-2*n-h,d=3*s-2*l-i,f=3*o-2*h-n;return Math.max(c*c,d*d)+Math.max(u*u,f*f)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7];return 3*((l-i)*(n+a)-(o-e)*(r+s)+r*(e-a)-n*(i-s)+l*(a+e/3)-o*(s+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)D._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new p(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,a,s,o,l){function c(t,e){var i=t-e,n=t+e;i<s[r]&&(s[r]=i),n>o[r]&&(o[r]=n)}a/=2;var u=s[r]-a,d=o[r]+a;if(t<u||e<u||i<u||n<u||t>d||e>d||i>d||n>d)if(e<t!=e<n&&i<t!=i<n)c(t,a),c(n,a);else{var f=3*(e-i)-t+n,g=2*(t+i)-4*e,p=e-t,m=h.solveQuadratic(f,g,p,l);c(n,0);for(var v=0;v<m;v++){var _=l[v],y=1-_;1e-8<=_&&_<=1-1e-8&&c(y*y*y*t+3*y*y*_*e+3*y*_*_*i+_*_*_*n,a)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=z[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,i,n){if(e.isZero()&&i.isZero())return!0;var r=n.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(i)){var a=new _(t,n);if(a.getDistance(t.add(e))<1e-7&&a.getDistance(n.add(i))<1e-7){var s=r.dot(r),o=r.dot(e)/s,l=r.dot(i)/s;return o>=0&&o<=1&&l<=0&&l>=-1}}return!1},isLinear:function(t,e,i,n){var r=n.subtract(t).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],a=e[6],s=e[7];return t(new u(n,r),new u(e[2]-n,e[3]-r),new u(e[4]-a,e[5]-s),new u(a,s),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new P(this,t):null},getTimeAt:function(t,e){return D.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(u.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return D.getTimeOf(this.getValues(),u.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=u.read(arguments),e=this.getValues(),i=D.getNearestTime(e,t),n=D.getPoint(e,i);return new P(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return D[t](n,i?e:D.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return D[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=9*(n-a)+3*(o-e),c=6*(e+a)-12*n,u=3*(n-e),d=9*(r-s)+3*(l-i),f=6*(i+s)-12*r,g=3*(r-i);return function(t){var e=(h*t+c)*t+u,i=(d*t+f)*t+g;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],a=t[1],s=t[2],o=t[3],l=t[4],c=t[5],d=t[6],f=t[7],g=h.isZero;g(s-r)&&g(o-a)&&(s=r,o=a),g(l-d)&&g(c-f)&&(l=d,c=f);var p,m,v=3*(s-r),_=3*(l-s)-v,y=d-r-v-_,x=3*(o-a),b=3*(c-o)-x,I=f-a-x-b;if(0===i)p=0===e?r:1===e?d:((y*e+_)*e+v)*e+r,m=0===e?a:1===e?f:((I*e+b)*e+x)*e+a;else{if(e<1e-8?(p=v,m=x):e>1-1e-8?(p=3*(d-l),m=3*(f-c)):(p=(3*y*e+2*_)*e+v,m=(3*I*e+2*b)*e+x),n){0===p&&0===m&&(e<1e-8||e>1-1e-8)&&(p=l-s,m=c-o);var C=Math.sqrt(p*p+m*m);C&&(p/=C,m/=C)}if(3===i){l=6*y*e+2*_,c=6*I*e+2*b;var w=Math.pow(p*p+m*m,1.5);p=0!==w?(p*c-m*l)/w:0,m=0}}return 2===i?new u(m,-p):new u(p,m)}return{statics:{classify:function(t){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=r*(n-c)+a*(l-i)+i*c-n*l,d=3*(s*(a-n)+o*(i-r)+r*n-a*i),f=d-u,g=f-u+(i*(c-o)+n*(s-l)+l*o-c*s),p=Math.sqrt(g*g+f*f+d*d),m=0!==p?1/p:0,v=h.isZero;function _(t,i,n){var r=i!==e,a=r&&i>0&&i<1,s=r&&n>0&&n<1;return!r||(a||s)&&("loop"!==t||a&&s)||(t="arch",a=s=!1),{type:t,roots:a||s?a&&s?i<n?[i,n]:[n,i]:[a?i:n]:null}}if(f*=m,d*=m,v(g*=m))return v(f)?_(v(d)?"line":"quadratic"):_("serpentine",d/(3*f));var y=3*f*f-4*g*d;if(v(y))return _("cusp",f/(2*g));var x=y>0?Math.sqrt(y/3):Math.sqrt(-y),b=2*g;return _(y>0?"serpentine":"loop",(f+x)/b,(f-x)/b)},getLength:function(n,r,a,s){if(r===e&&(r=0),a===e&&(a=1),D.isStraight(n)){var o=n;a<1&&(o=D.subdivide(o,a)[0],r/=a),r>0&&(o=D.subdivide(o,r)[1]);var l=o[6]-o[0],c=o[7]-o[1];return Math.sqrt(l*l+c*c)}return h.integrate(s||t(n),r,a,i(r,a))},getTimeAt:function(n,r,a){if(a===e&&(a=r<0?1:0),0===r)return a;var s=Math.abs,o=r>0,l=o?a:0,c=o?1:a,u=t(n),d=D.getLength(n,l,c,u),f=s(r)-d;if(s(f)<1e-12)return o?c:l;if(f>1e-12)return null;var g=r/d,p=0;return h.findRoot(function(t){return p+=h.integrate(u,a,t,i(a,t)),a=t,p-r},u,a+g,l,c,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=3*n-e-3*a+t[6],l=3*e-6*n+3*a,c=-3*e+3*n,u=3*r-i-3*s+t[7],d=3*i-6*r+3*s,f=-3*i+3*r,g=[];return h.solveCubic(9*(o*o+u*u),9*(o*l+d*u),2*(l*l+d*d)+3*(c*o+f*u),c*l+d*f,g,1e-8,1-1e-8),g.sort()}}}},new function(){function t(t,e,i,n,r,a,s){var o=!s&&i.getPrevious()===r,l=!s&&i!==r&&i.getNext()===r;if(null!==n&&n>=(o?1e-8:0)&&n<=(l?1-1e-8:1)&&null!==a&&a>=(l?1e-8:0)&&a<=(o?1-1e-8:1)){var h=new P(i,n,null,s),c=new P(r,a,null,s);h._intersection=c,c._intersection=h,e&&!e(h)||P.insert(t,h,!0)}}function e(t,e,n,r){return t[0][1]<n?i(t,!0,n):e[0][1]>r?i(e,!1,r):t[0][0]}function i(t,e,i){for(var n=t[0][0],r=t[0][1],a=1,s=t.length;a<s;a++){var o=t[a][0],l=t[a][1];if(e?l>=i:l<=i)return l===i?o:n+(i-r)*(o-n)/(l-r);n=o,r=l}return null}function n(t,e,i,n,r){var a=h.isZero;if(a(n)&&a(r)){var s=D.getTimeOf(t,new u(e,i));return null===s?[]:[s]}for(var o=Math.atan2(-r,n),l=Math.sin(o),c=Math.cos(o),d=[],f=[],g=0;g<8;g+=2){var p=t[g]-e,m=t[g+1]-i;d.push(p*c-m*l,p*l+m*c)}return D.solveCubic(d,1,0,f,0,1),f}function r(i,r,a,o,l,h){var c=Math.min,d=Math.max;if(d(i[0],i[2],i[4],i[6])+1e-12>c(r[0],r[2],r[4],r[6])&&c(i[0],i[2],i[4],i[6])-1e-12<d(r[0],r[2],r[4],r[6])&&d(i[1],i[3],i[5],i[7])+1e-12>c(r[1],r[3],r[5],r[7])&&c(i[1],i[3],i[5],i[7])-1e-12<d(r[1],r[3],r[5],r[7])){var f=s(i,r);if(f)for(var g=0;g<2;g++){var p=f[g];t(l,h,a,p[0],o,p[1],!0)}else{var m=D.isStraight(i),v=D.isStraight(r),y=m&&v,x=m&&!v,b=l.length;if((y?function(e,i,n,r,a,s){var o=_.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);o&&t(a,s,n,D.getTimeOf(e,o),r,D.getTimeOf(i,o))}:m||v?function(e,i,r,a,s,o,l){for(var h=i[0],c=i[1],u=n(e,h,c,i[6]-h,i[7]-c),d=0,f=u.length;d<f;d++){var g=u[d],p=D.getPoint(e,g),m=D.getTimeOf(i,p);null!==m&&t(s,o,l?a:r,l?m:g,l?r:a,l?g:m)}}:function i(n,r,a,s,o,l,h,c,u,d,f,g,p){if(++u>=4096||++c>=40)return u;var m,v,y=r[0],x=r[1],b=r[6],I=r[7],C=_.getSignedDistance,w=C(y,x,b,I,r[2],r[3]),S=C(y,x,b,I,r[4],r[5]),M=w*S>0?.75:4/9,A=M*Math.min(0,w,S),T=M*Math.max(0,w,S),k=C(y,x,b,I,n[0],n[1]),P=C(y,x,b,I,n[2],n[3]),E=C(y,x,b,I,n[4],n[5]),z=C(y,x,b,I,n[6],n[7]),O=function(t,e,i,n){var r,a=[0,t],s=[1/3,e],o=[2/3,i],l=[1,n],h=e-(2*t+n)/3,c=i-(t+2*n)/3;if(h*c<0)r=[[a,s,l],[a,o,l]];else{var u=h/c;r=[u>=2?[a,s,l]:u<=.5?[a,o,l]:[a,s,o,l],[a,l]]}return(h||c)<0?r.reverse():r}(k,P,E,z),B=O[0],R=O[1];if(0===w&&0===S&&0===k&&0===P&&0===E&&0===z||null==(m=e(B,R,A,T))||null==(v=e(B.reverse(),R.reverse(),A,T)))return u;var L=d+(f-d)*m,F=d+(f-d)*v;if(Math.max(p-g,F-L)<1e-9){var G=(L+F)/2,N=(g+p)/2;t(o,l,h?s:a,h?N:G,h?a:s,h?G:N)}else if(n=D.getPart(n,m,v),v-m>.8)if(F-L>p-g)G=(L+F)/2,u=i(r,(U=D.subdivide(n,.5))[0],s,a,o,l,!h,c,u,g,p,L,G),u=i(r,U[1],s,a,o,l,!h,c,u,g,p,G,F);else{var U;N=(g+p)/2,u=i((U=D.subdivide(r,.5))[0],n,s,a,o,l,!h,c,u,g,N,L,F),u=i(U[1],n,s,a,o,l,!h,c,u,N,p,L,F)}else u=p-g>=1e-9?i(r,n,s,a,o,l,!h,c,u,g,p,L,F):i(n,r,a,s,o,l,h,c,u,L,F,g,p);return u})(x?r:i,x?i:r,x?o:a,x?a:o,l,h,x,0,0,0,1,0,1),!y||l.length===b)for(g=0;g<4;g++){var I=g>>1,C=1&g,w=6*I,S=6*C,M=new u(i[w],i[w+1]),A=new u(r[S],r[S+1]);M.isClose(A,1e-12)&&t(l,h,a,I,o,C)}}}return l}function a(e,i,n,r){var a=D.classify(e);if("loop"===a.type){var s=a.roots;t(n,r,i,s[0],i,s[1])}return n}function s(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=_.getDistance,a=D.isStraight(t),s=D.isStraight(e),o=a&&s,l=i(t)<i(e),h=l?e:t,c=l?t:e,d=h[0],f=h[1],g=h[6]-d,p=h[7]-f;if(r(d,f,g,p,c[0],c[1],!0)<1e-7&&r(d,f,g,p,c[6],c[7],!0)<1e-7)!o&&r(d,f,g,p,h[2],h[3],!0)<1e-7&&r(d,f,g,p,h[4],h[5],!0)<1e-7&&r(d,f,g,p,c[2],c[3],!0)<1e-7&&r(d,f,g,p,c[4],c[5],!0)<1e-7&&(a=s=o=!0);else if(o)return null;if(a^s)return null;for(var m=[t,e],v=[],y=0;y<4&&v.length<2;y++){var x=1&y,b=1^x,I=y>>1,C=D.getTimeOf(m[x],new u(m[b][I?6:0],m[b][I?7:1]));if(null!=C){var w=x?[I,C]:[C,I];(!v.length||n(w[0]-v[0][0])>1e-8&&n(w[1]-v[0][1])>1e-8)&&v.push(w)}if(y>2&&!v.length)break}if(2!==v.length)v=null;else if(!o){var S=D.getPart(t,v[0][0],v[1][0]),M=D.getPart(e,v[0][1],v[1][1]);(n(M[2]-S[2])>1e-7||n(M[3]-S[3])>1e-7||n(M[4]-S[4])>1e-7||n(M[5]-S[5])>1e-7)&&(v=null)}return v}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?r(e,i,this,t,[]):a(e,this,[])},statics:{getOverlaps:s,getIntersections:function(t,e,i,n,s,o){var l=!e;l&&(e=t);for(var h,c,u=t.length,d=e.length,f=[],g=[],p=0;p<d;p++)f[p]=e[p].getValues(s);for(p=0;p<u;p++){var m=t[p],v=l?f[p]:m.getValues(n),_=m.getPath();_!==c&&(c=_,h=[],g.push(h)),l&&a(v,m,h,i);for(var y=l?p+1:0;y<d;y++){if(o&&h.length)return h;r(v,f[y],m,e[y],h,i)}}h=[],p=0;for(var x=g.length;p<x;p++)h.push.apply(h,g[p]);return h},getCurveLineIntersections:n}}}),P=r.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){if(e>=.99999999){var a=t.getNext();a&&(e=0,t=a)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),i=this.getTime();0===i?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){var t=this._path,e=this;function i(t){var i=t&&t.getCurve();if(i&&null!=(e._time=i.getTimeOf(e._point)))return e._setCurve(i),i}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||i(this._segment)||i(this._segment1)||i(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(t,e){var i=this===t;if(!i&&t instanceof P){var n=this.getCurve(),r=t.getCurve(),a=n._path;if(a===r._path){var s=Math.abs,o=s(this.getOffset()-t.getOffset()),l=!e&&this._intersection,h=!e&&t._intersection;i=(o<1e-7||a&&s(a.getLength()-o)<1e-7)&&(!l&&!h||l&&h&&l.equals(h,!0))}}return i},toString:function(){var t=[],e=this.getPoint(),i=l.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){var t=this._intersection;if(!t)return!1;var e=this.getTime(),i=t.getTime(),n=e>=1e-8&&e<=1-1e-8,r=i>=1e-8&&i<=1-1e-8;if(n&&r)return!this.isTouching();var a=this.getCurve(),s=e<1e-8?a.getPrevious():a,o=t.getCurve(),l=i<1e-8?o.getPrevious():o;if(e>1-1e-8&&(a=a.getNext()),i>1-1e-8&&(o=o.getNext()),!(s&&a&&l&&o))return!1;var h=[];function c(t,e){var i=t.getValues(),n=D.classify(i).roots||D.getPeaks(i),r=n.length,a=e&&r>1?n[r-1]:r>0?n[0]:.5;h.push(D.getLength(i,e?a:0,e?1:a)/2)}function u(t,e,i){return e<i?t>e&&t<i:t>e||t<i}n||(c(s,!0),c(a,!1)),r||(c(l,!0),c(o,!1));var d=this.getPoint(),f=Math.min.apply(Math,h),g=n?a.getTangentAtTime(e):a.getPointAt(f).subtract(d),p=n?g.negate():s.getPointAt(-f).subtract(d),m=r?o.getTangentAtTime(i):o.getPointAt(f).subtract(d),v=r?m.negate():l.getPointAt(-f).subtract(d),_=p.getAngle(),y=g.getAngle(),x=v.getAngle(),b=m.getAngle();return!!(n?u(_,x,b)^u(y,x,b)&&u(_,b,x)^u(y,b,x):u(x,_,y)^u(b,_,y)&&u(x,y,_)^u(b,y,_))},hasOverlap:function(){return!!this._overlap}},r.each(D._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){var n=t.length,r=0,a=n-1;function s(i,r){for(var a=i+r;a>=-1&&a<=n;a+=r){var s=t[(a%n+n)%n];if(!e.getPoint().isClose(s.getPoint(),1e-7))break;if(e.equals(s))return s}return null}for(;r<=a;){var o,l=r+a>>>1,h=t[l];if(i&&(o=e.equals(h)?h:s(l,-1)||s(l,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var c=e.getPath(),u=h.getPath();(c!==u?c._id-u._id:e.getIndex()+e.getTime()-(h.getIndex()+h.getTime()))<0?a=l-1:r=l+1}return t.splice(r,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),E=x.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;if(r.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i){var a=i[0];n=a&&Array.isArray(a[0])}else e&&(n=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(n?O:z)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var e,i,n,r=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),a=!1,s=new u,o=new u;function l(t,i){var n=+e[t];return a&&(n+=s[i]),n}function h(t){return new u(l(t,"x"),l(t+1,"y"))}this.clear();for(var c=0,d=r&&r.length;c<d;c++){var g=r[c],p=g[0],m=p.toLowerCase(),v=(e=g.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&e.length;switch(a=p===m,"z"!==i||/[mz]/.test(m)||this.moveTo(s),m){case"m":case"l":for(var _="m"===m,y=0;y<v;y+=2)this[_?"moveTo":"lineTo"](s=h(y)),_&&(o=s,_=!1);n=s;break;case"h":case"v":var x="h"===m?"x":"y";s=s.clone();for(y=0;y<v;y++)s[x]=l(y,x),this.lineTo(s);n=s;break;case"c":for(y=0;y<v;y+=6)this.cubicCurveTo(h(y),n=h(y+2),s=h(y+4));break;case"s":for(y=0;y<v;y+=4)this.cubicCurveTo(/[cs]/.test(i)?s.multiply(2).subtract(n):s,n=h(y),s=h(y+2)),i=m;break;case"q":for(y=0;y<v;y+=4)this.quadraticCurveTo(n=h(y),s=h(y+2));break;case"t":for(y=0;y<v;y+=2)this.quadraticCurveTo(n=/[qt]/.test(i)?s.multiply(2).subtract(n):s,s=h(y)),i=m;break;case"a":for(y=0;y<v;y+=7)this.arcTo(s=h(y+5),new f(+e[y],+e[y+1]),+e[y+2],+e[y+4],+e[y+3]);break;case"z":this.closePath(1e-12),s=o}i=m}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,i,n){var r=this===t||!t,a=this._matrix._orNullIfIdentity(),s=r?a:(i||t._matrix)._orNullIfIdentity();return r||this.getBounds(a).intersects(t.getBounds(s),1e-12)?D.getIntersections(this.getCurves(),!r&&t.getCurves(),e,a,s,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=u.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,a=e.length;r<a;r++){var s=e[r].getNearestLocation(t);s._distance<i&&(i=s._distance,n=s)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",a=t[r],s=e[r],o=this[r];if(!a||!s||a.length!==s.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var l=o.length,h=s.length;if(l<h)for(var c=n?T:z,u=l;u<h;u++)this.add(new c);else l>h&&this[n?"removeSegments":"removeChildren"](h,l);for(u=0;u<h;u++)o[u].interpolate(a[u],s[u],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var i=this._children||[this],n=t._children?t._children.slice():[t],r=i.length,a=n.length,s=[],o=0;e=!0;for(var l=r-1;l>=0&&e;l--){var h=i[l];e=!1;for(var c=a-1;c>=0&&!e;c--)h.compare(n[c])&&(s[c]||(s[c]=!0,o++),e=!0)}e=e&&o===a}return e}}),z=E.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=e,this._segmentSelection=0,i||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!i&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(i){if(t.base.call(this,i),8&i){if(this._length=this._area=e,16&i)this._version++;else if(this._curves)for(var n=0,r=this._curves.length;n<r;n++)this._curves[n]._changed()}else 32&i&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof O?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var i=this.isFullySelected(),n=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,n){var r=t[n-1];"boolean"==typeof r&&(this.setClosed(r),n--),this._add(T.readList(t,0,{},n))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new D(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new D(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){var i,n,r,a,s,o,h,c,u=this._segments,d=u.length,f=new l(e),g=new Array(6),p=!0,m=[];function v(e,l){if(e._transformCoordinates(t,g),i=g[0],n=g[1],p)m.push("M"+f.pair(i,n)),p=!1;else if(s=g[2],o=g[3],s===i&&o===n&&h===r&&c===a){if(!l){var u=i-r,d=n-a;m.push(0===u?"v"+f.number(d):0===d?"h"+f.number(u):"l"+f.pair(u,d))}}else m.push("c"+f.pair(h-r,c-a)+" "+f.pair(s-r,o-a)+" "+f.pair(i-r,n-a));r=i,a=n,h=g[4],c=g[5]}if(!d)return"";for(var _=0;_<d;_++)v(u[_]);return this._closed&&d>0&&(v(u[0],!0),m.push("z")),m.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,a=null==e,s=(e=a?i.length:e,0);s<r;s++){var o=t[s];o._path&&(o=t[s]=o.clone()),o._path=this,o._index=e+s,o._selection&&this._updateSelection(o,0,o._selection)}if(a)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));s=e+r;for(var l=i.length;s<l;s++)i[s]._index=s}if(n){var h=this._countCurves(),c=e>0&&e+r-1===h?e-1:e,u=c,d=Math.min(c+r,h);t._curves&&(n.splice.apply(n,[c,0].concat(t._curves)),u+=t._curves.length);for(s=u;s<d;s++)n.splice(s,0,new D(this,null,null));this._adjustCurves(c,d)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,a=t;a<e;a++)(i=r[a])._path=this,i._segment1=n[a],i._segment2=n[a+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(T.readList(arguments)):this._add([T.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(T.readList(arguments,1),t):this._add([T.read(arguments,1)],t)[0]},addSegment:function(){return this._add([T.read(arguments)])[0]},insertSegment:function(t){return this._add([T.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(T.readList(t))},insertSegments:function(t,e){return this._add(T.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=r.pick(e,this._segments.length);var n=this._segments,a=this._curves,s=n.length,o=n.splice(t,e-t),l=o.length;if(!l)return o;for(var h=0;h<l;h++){var c=o[h];c._selection&&this._updateSelection(c,c._selection,0),c._index=c._path=null}h=t;for(var u=n.length;h<u;h++)n[h]._index=h;if(a){var d=t>0&&e===s+(this._closed?1:0)?t-1:t;for(h=(a=a.splice(d,l)).length-1;h>=0;h--)a[h]._path=null;i&&(o._curves=a.slice(1)),this._adjustCurves(d,d)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,i=this._closed;t=0;for(var n=0,r=e.length;n<r;n++){var a=n+1===r;t+=D.getArea(D.getValues(e[n],e[a?0:n+1],null,a&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i,(this._segmentSelection+=i-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,i=this.getLocationAt(t);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),i=e&&e.index,n=e&&e.time;n>1-1e-8&&(i++,n=0);var r=this.getCurves();if(i>=0&&i<r.length){n>=1e-8&&r[i++].divideAtTime(n);var a,s=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),a=this):((a=new z(x.NO_INSERT)).insertAbove(this),a.copyAttributes(this)),a._add(s,0),this.addSegment(s[0]),a}return null},split:function(t,i){var n,r=i===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(i);return null!=r?this.splitAt(r):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),a=t.getLastSegment();if(!a)return this;r&&r._point.isClose(a._point,i)&&t.reverse();var s=t.getFirstSegment();if(r&&r._point.isClose(s._point,i))r.setHandleOut(s._handleOut),this._add(n.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(s._point,i)&&t.reverse(),a=t.getLastSegment(),o&&o._point.isClose(a._point,i)?(o.setHandleIn(a._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var l=this.getFirstSegment(),h=this.getLastSegment();return l!==h&&l._point.isClose(h._point,i)&&(l.setHandleIn(h._handleIn),h.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;r>=0;r--){var a=e[r];!a.hasHandles()&&(!a.hasLength(n)||i&&a.isCollinear(a.getNext()))&&a.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new B(this,t||.25,256,!0).parts,i=e.length,n=[],r=0;r<i;r++)n.push(new T(e[r].curve.slice(0,2)));!this._closed&&i>0&&n.push(new T(e[i-1].curve.slice(6))),this.setSegments(n)},simplify:function(t){var e=new R(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){var i=this,n=t||{},r=n.type||"asymmetric",a=this._segments,s=a.length,o=this._closed;function l(t,e){var n=t&&t.index;if(null!=n){var r=t.path;if(r&&r!==i)throw new Error(t._class+" "+n+" of "+r+" is not part of "+i);e&&t instanceof D&&n++}else n="number"==typeof t?t:e;return Math.min(n<0&&o?n%s:n<0?n+s:n,s-1)}var h=o&&n.from===e&&n.to===e,c=l(n.from,0),u=l(n.to,s-1);if(c>u)if(o)c-=s;else{var d=c;c=u,u=d}if(/^(?:asymmetric|continuous)$/.test(r)){var f="asymmetric"===r,g=Math.min,p=u-c+1,m=p-1,v=h?g(p,4):1,_=v,y=v,x=[];if(o||(_=g(1,c),y=g(1,s-u-1)),(m+=_+y)<=1)return;for(var b=0,I=c-_;b<=m;b++,I++)x[b]=a[(I<0?I+s:I)%s]._point;var C=x[0]._x+2*x[1]._x,w=x[0]._y+2*x[1]._y,S=2,M=m-1,A=[C],T=[w],k=[S],P=[],E=[];for(b=1;b<m;b++){var z=b<M,O=z?4:f?2:7,B=z?4:f?3:8,R=z?2:f?0:1,L=(z?1:f?1:2)/S;S=k[b]=O-L,C=A[b]=B*x[b]._x+R*x[b+1]._x-L*C,w=T[b]=B*x[b]._y+R*x[b+1]._y-L*w}P[M]=A[M]/k[M],E[M]=T[M]/k[M];for(b=m-2;b>=0;b--)P[b]=(A[b]-P[b+1])/k[b],E[b]=(T[b]-E[b+1])/k[b];P[m]=(3*x[m]._x-P[M])/2,E[m]=(3*x[m]._y-E[M])/2;b=_;var F=m-y;for(I=c;b<=F;b++,I++){var G=a[I<0?I+s:I],N=G._point,U=P[b]-N._x,j=E[b]-N._y;(h||b<F)&&G.setHandleOut(U,j),(h||b>_)&&G.setHandleIn(-U,-j)}}else for(b=c;b<=u;b++)a[b<0?b+s:b].smooth(n,!h&&b===c,!h&&b===u)},toShape:function(t){if(!this._closed)return null;var i,n,r,a,s,o,l,c=this._segments;function u(t,e){var i=c[t],n=i.getNext(),r=c[e],a=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&a._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(a._point.subtract(r._point))}function d(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn;if(n.isOrthogonal(r)){var a=e._point,s=i._point,o=new _(a,n,!0).intersect(new _(s,r,!0),!0);return o&&h.isZero(n.getLength()/o.subtract(a).getLength()-.5522847498307936)&&h.isZero(r.getLength()/o.subtract(s).getLength()-.5522847498307936)}return!1}function g(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this.hasHandles()&&4===c.length&&u(0,2)&&u(1,3)&&(s=c[1],o=s.getPrevious(),l=s.getNext(),o._handleOut.isZero()&&s._handleIn.isZero()&&s._handleOut.isZero()&&l._handleIn.isZero()&&s._point.subtract(o._point).isOrthogonal(l._point.subtract(s._point)))?(i=C.Rectangle,n=new f(g(0,3),g(0,1)),a=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&d(0)&&d(2)&&d(4)&&d(6)&&u(1,5)&&u(3,7)?(i=C.Rectangle,r=(n=new f(g(1,6),g(0,3))).subtract(new f(g(0,7),g(1,2))).divide(2),a=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&d(0)&&d(1)&&d(2)&&d(3)&&(h.isZero(g(0,2)-g(1,3))?(i=C.Circle,r=g(0,2)/2):(i=C.Ellipse,r=new f(g(2,0)/2,g(3,1)/2)),a=c[1]._point),i){var p=this.getPosition(!0),m=new i({center:p,size:n,radius:r,insert:!1});return m.copyAttributes(this,!0),m._matrix.prepend(this._matrix),m.rotate(a.subtract(p).getAngle()+90),(t===e||t)&&m.insertAbove(this),m}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof O)return t.base.call(this,e);var i=this.getCurves(),n=e.getCurves(),r=i.length,a=n.length;if(!r||!a)return r==a;for(var s,o,l=i[0].getValues(),h=[],c=0,u=0,d=0;d<a;d++){var f=n[d].getValues();if(h.push(f),m=D.getOverlaps(l,f)){s=!d&&m[0][0]>0?a-1:d,o=m[0][1];break}}var g,p=Math.abs;for(f=h[s];l&&f;){var m;if(m=D.getOverlaps(l,f))if(p(m[0][0]-u)<1e-8){1===(u=m[1][0])&&(l=++c<r?i[c].getValues():null,u=0);var v=m[0][1];if(p(v-o)<1e-8){if(g||(g=[s,v]),1===(o=m[1][1])&&(++s>=a&&(s=0),f=h[s]||n[s].getValues(),o=0),!l)return g[0]===s&&g[1]===o;continue}}break}return!1},_hitTestSelf:function(t,e,i,n){var r,a,s,o,l,h,c=this,u=this.getStyle(),d=this._segments,f=d.length,g=this._closed,p=e._tolerancePadding,m=p,v=e.stroke&&u.hasStroke(),_=e.fill&&u.hasFill(),y=e.curves,x=v?u.getStrokeWidth()/2:_&&e.tolerance>0||y?0:null;function b(e,i){return t.subtract(e).divide(i).length<=1}function I(t,i,n){if(!e.selected||i.isSelected()){var r=t._point;if(i!==r&&(i=i.add(r)),b(i,m))return new A(n,c,{segment:t,point:i})}}function C(t,i){return(i||e.segments)&&I(t,t._point,"segment")||!i&&e.handles&&(I(t,t._handleIn,"handle-in")||I(t,t._handleOut,"handle-out"))}function w(t){o.add(t)}function S(e){var i,l=g||e._index>0&&e._index<f-1;return"round"===(l?r:a)?b(e._point,m):(o=new z({internal:!0,closed:!0}),l?e.isSmooth()||z._addBevelJoin(e,r,x,s,null,n,w,!0):"square"===a&&z._addSquareCap(e,a,x,null,n,w,!0),o.isEmpty()?void 0:o.contains(t)||(i=o.getNearestLocation(t))&&b(i.getPoint(),p))}if(null!==x&&(x>0?(r=u.getStrokeJoin(),a=u.getStrokeCap(),s=u.getMiterLimit(),m=m.add(z._getStrokePadding(x,n))):r=a="round"),!e.ends||e.segments||g){if(e.segments||e.handles)for(var M=0;M<f;M++)if(h=C(d[M]))return h}else if(h=C(d[0],!0)||C(d[f-1],!0))return h;if(null!==x){if(l=this.getNearestLocation(t)){var T=l.getTime();0===T||1===T&&f>1?S(l.getSegment())||(l=null):b(l.getPoint(),m)||(l=null)}if(!l&&"miter"===r&&f>1)for(M=0;M<f;M++){var k=d[M];if(t.getDistance(k._point)<=s*x&&S(k)){l=k.getLocation();break}}}return!l&&_&&this._contains(t)||l&&!v&&!y?new A("fill",this):l?new A(v?"stroke":"curve",this,{location:l,point:l.getPoint()}):null}},r.each(D._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=u.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var a=i,s=e[n];if((i+=s.getLength())>t)return s.getLocationAt(t-a)}if(e.length>0&&t<=this.getLength())return new P(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null}}),new function(){function t(t,e,i){var n,r,a,s,o,l,h,c,u=e._segments,d=u.length,f=new Array(6),g=!0;function p(e){if(i)e._transformCoordinates(i,f),n=f[0],r=f[1];else{var u=e._point;n=u._x,r=u._y}if(g)t.moveTo(n,r),g=!1;else{if(i)o=f[2],l=f[3];else{var d=e._handleIn;o=n+d._x,l=r+d._y}o===n&&l===r&&h===a&&c===s?t.lineTo(n,r):t.bezierCurveTo(h,c,o,l,n,r)}if(a=n,s=r,i)h=f[4],c=f[5];else{d=e._handleOut;h=a+d._x,c=s+d._y}}for(var m=0;m<d;m++)p(u[m]);e._closed&&d>0&&p(u[0])}return{_draw:function(e,i,n,r){var a=i.dontStart,s=i.dontFinish||i.clip,o=this.getStyle(),l=o.hasFill(),h=o.hasStroke(),c=o.getDashArray(),u=!paper.support.nativeDash&&h&&c&&c.length;function d(t){return c[(t%u+u)%u]}if(a||e.beginPath(),(l||h&&!u||s)&&(t(e,this,r),this._closed&&e.closePath()),!s&&(l||h)&&(this._setStyles(e,i,n),l&&(e.fill(o.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),h)){if(u){a||e.beginPath();var f,g=new B(this,.25,32,!1,r),p=g.length,m=-o.getDashOffset(),v=0;for(m%=p;m>0;)m-=d(v--)+d(v--);for(;m<p;)f=m+d(v++),(m>0||f>0)&&g.drawPart(e,Math.max(m,0),Math.max(f,0)),m=f+d(v++)}e.stroke()}},_drawSelected:function(e,i){e.beginPath(),t(e,this,i),e.stroke(),function(t,e,i,n){var r,a,s=n/2,o=new Array(6);function l(e){var i=o[e],n=o[e+1];r==i&&a==n||(t.beginPath(),t.moveTo(r,a),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,s,0,2*Math.PI,!0),t.fill())}for(var h=0,c=e.length;h<c;h++){var u=e[h],d=u._selection;if(u._transformCoordinates(i,o),r=o[0],a=o[1],2&d&&l(2),4&d&&l(4),t.fillRect(r-s,a-s,n,n),!(1&d)){var f=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(r-s+1,a-s+1,n-2,n-2),t.fillStyle=f}}}(e,this._segments,i,paper.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new T(u.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new T(u.read(arguments))])},cubicCurveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=u.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new T(n,i.subtract(n))])},quadraticCurveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=r.pick(r.read(arguments),.5),a=1-n,s=t(this)._point,o=e.subtract(s.multiply(a*a)).subtract(i.multiply(n*n)).divide(2*n*a);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(o,i)},arcTo:function(){var e,i,n,a,s=Math.abs,o=Math.sqrt,l=t(this),c=l._point,d=u.read(arguments),g=r.peek(arguments);if("boolean"==typeof(b=r.pick(g,!0)))var p=(C=c.add(d).divide(2)).add(C.subtract(c).rotate(b?-90:90));else if(r.remain(arguments)<=2)p=d,d=u.read(arguments);else{var m=f.read(arguments),y=h.isZero;if(y(m.width)||y(m.height))return this.lineTo(d);var x=r.read(arguments),b=!!r.read(arguments),I=!!r.read(arguments),C=c.add(d).divide(2),w=(X=c.subtract(C).rotate(-x)).x,S=X.y,M=s(m.width),A=s(m.height),k=M*M,D=A*A,P=w*w,E=S*S,z=o(P/k+E/D);if(z>1&&(k=(M*=z)*M,D=(A*=z)*A),s(z=(k*D-k*E-D*P)/(k*E+D*P))<1e-12&&(z=0),z<0)throw new Error("Cannot create an arc with the given arguments");e=new u(M*S/A,-A*w/M).multiply((I===b?-1:1)*o(z)).rotate(x).add(C),i=(n=(a=(new v).translate(e).rotate(x).scale(M,A))._inverseTransform(c)).getDirectedAngle(a._inverseTransform(d)),!b&&i>0?i-=360:b&&i<0&&(i+=360)}if(p){var O=new _(c.add(p).divide(2),p.subtract(c).rotate(90),!0),B=new _(p.add(d).divide(2),d.subtract(p).rotate(90),!0),R=new _(c,d),L=R.getSide(p);if(!(e=O.intersect(B,!0))){if(!L)return this.lineTo(d);throw new Error("Cannot create an arc with the given arguments")}i=(n=c.subtract(e)).getDirectedAngle(d.subtract(e));var F=R.getSide(e);0===F?i=L*s(i):L===F&&(i+=i<0?360:-360)}for(var G=s(i),N=G>=360?4:Math.ceil((G-1e-7)/90),U=i/N,j=U*Math.PI/360,Z=4/3*Math.sin(j)/(1+Math.cos(j)),W=[],V=0;V<=N;V++){var X=d,Y=null;if(V<N&&(Y=n.rotate(90).multiply(Z),a?(X=a._transformPoint(n),Y=a._transformPoint(n.add(Y)).subtract(X)):X=e.add(n)),V){var H=n.rotate(-90).multiply(Z);a&&(H=a._transformPoint(n.add(H)).subtract(X)),W.push(new T(X,H,Y))}else l.setHandleOut(Y);n=n.rotate(U)}this._add(W)},lineBy:function(){var e=u.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=r.read(arguments),a=t(this)._point;this.curveTo(a.add(e),a.add(i),n)},cubicCurveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=u.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(u.read(arguments)),n=r.pick(r.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(u.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return z[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,a){var s=t[0];if(!s)return new p;var o=new Array(6),l=s._transformCoordinates(n,new Array(6)),h=l.slice(0,2),c=h.slice(),u=new Array(2);function d(t){t._transformCoordinates(n,o);for(var e=0;e<2;e++)D._addBounds(l[e],l[e+4],o[e+2],o[e],e,a?a[e]:0,h,c,u);var i=l;l=o,o=i}for(var f=1,g=t.length;f<g;f++)d(t[f]);return e&&d(s),new p(h[0],h[1],c[0]-h[0],c[1]-h[1])},getStrokeBounds:function(t,e,i,n,r){var a=i.getStyle(),s=a.hasStroke(),o=a.getStrokeWidth(),l=s&&i._getStrokeMatrix(n,r),h=s&&z._getStrokePadding(o,l),c=z.getBounds(t,e,i,n,r,h);if(!s)return c;var u=o/2,d=a.getStrokeJoin(),g=a.getStrokeCap(),m=a.getMiterLimit(),v=new p(new f(h));function _(t){c=c.include(t)}function y(t){c=c.unite(v.setCenter(t._point.transform(n)))}function x(t,e){"round"===e||t.isSmooth()?y(t):z._addBevelJoin(t,e,u,m,n,l,_)}function b(t,e){"round"===e?y(t):z._addSquareCap(t,e,u,n,l,_)}for(var I=t.length-(e?0:1),C=1;C<I;C++)x(t[C],d);return e?x(t[0],d):I>0&&(b(t[0],g),b(t[t.length-1],g)),c},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new u(t,0).transform(e),n=new u(0,t).transform(e),r=i.getAngleInRadians(),a=i.getLength(),s=n.getLength(),o=Math.sin(r),l=Math.cos(r),h=Math.tan(r),c=Math.atan2(s*h,a),d=Math.atan2(s,h*a);return[Math.abs(a*Math.cos(c)*l+s*Math.sin(c)*o),Math.abs(s*Math.sin(d)*l+a*Math.cos(d)*o)]},_addBevelJoin:function(t,e,i,n,r,a,s,o){var l=t.getCurve(),h=l.getPrevious(),c=l.getPoint1().transform(r),d=h.getNormalAtTime(1).multiply(i).transform(a),f=l.getNormalAtTime(0).multiply(i).transform(a);if(d.getDirectedAngle(f)<0&&(d=d.negate(),f=f.negate()),o&&s(c),s(c.add(d)),"miter"===e){var g=new _(c.add(d),new u(-d.y,d.x),!0).intersect(new _(c.add(f),new u(-f.y,f.x),!0),!0);g&&c.getDistance(g)<=n*i&&s(g)}s(c.add(f))},_addSquareCap:function(t,e,i,n,r,a,s){var o=t._point.transform(n),l=t.getLocation(),h=l.getNormal().multiply(0===l.getTime()?i:-i).transform(r);"square"===e&&(s&&(a(o.subtract(h)),a(o.add(h))),o=o.add(h.rotate(-90))),a(o.add(h)),a(o.subtract(h))},getHandleBounds:function(t,e,i,n,r){var a,s,o=i.getStyle();if(r.stroke&&o.hasStroke()){var l=i._getStrokeMatrix(n,r),h=o.getStrokeWidth()/2,c=h;"miter"===o.getStrokeJoin()&&(c=h*o.getMiterLimit()),"square"===o.getStrokeCap()&&(c=Math.max(c,h*Math.SQRT2)),a=z._getStrokePadding(h,l),s=z._getStrokePadding(c,l)}for(var u=new Array(6),d=1/0,f=-d,g=d,m=f,v=0,_=t.length;v<_;v++){t[v]._transformCoordinates(n,u);for(var y=0;y<6;y+=2){var x=y?a:s,b=x?x[0]:0,I=x?x[1]:0,C=u[y],w=u[y+1],S=C-b,M=C+b,A=w-I,T=w+I;S<d&&(d=S),M>f&&(f=M),A<g&&(g=A),T>m&&(m=T)}}return new p(d,g,f-d,m-g)}}});z.inject({statics:new function(){var t=.5522847498307936,e=[new T([-1,0],[0,t],[0,-t]),new T([0,-1],[-t,0],[t,0]),new T([1,0],[0,-t],[0,t]),new T([0,1],[t,0],[-t,0])];function i(t,e,i){var n=r.getNamed(i),a=new z(n&&0==n.insert&&x.NO_INSERT);return a._add(t),a._closed=e,a.set(n,{insert:!0})}function n(t,n,r){for(var a=new Array(4),s=0;s<4;s++){var o=e[s];a[s]=new T(o._point.multiply(n).add(t),o._handleIn.multiply(n),o._handleOut.multiply(n))}return i(a,!0,r)}return{Line:function(){return i([new T(u.readNamed(arguments,"from")),new T(u.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=u.readNamed(arguments,"center"),e=r.readNamed(arguments,"radius");return n(t,new f(e),arguments)},Rectangle:function(){var e,n=p.readNamed(arguments,"rectangle"),r=f.readNamed(arguments,"radius",0,{readNull:!0}),a=n.getBottomLeft(!0),s=n.getTopLeft(!0),o=n.getTopRight(!0),l=n.getBottomRight(!0);if(!r||r.isZero())e=[new T(a),new T(s),new T(o),new T(l)];else{var h=(r=f.min(r,n.getSize(!0).divide(2))).width,c=r.height,u=h*t,d=c*t;e=[new T(a.add(h,0),null,[-u,0]),new T(a.subtract(0,c),[0,d]),new T(s.add(0,c),null,[0,-d]),new T(s.add(h,0),[-u,0],null),new T(o.subtract(h,0),null,[u,0]),new T(o.add(0,c),[0,-d],null),new T(l.subtract(0,c),null,[0,d]),new T(l.subtract(h,0),[u,0])]}return i(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=C._readEllipse(arguments);return n(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=u.readNamed(arguments,"from"),e=u.readNamed(arguments,"through"),i=u.readNamed(arguments,"to"),n=r.getNamed(arguments),a=new z(n&&0==n.insert&&x.NO_INSERT);return a.moveTo(t),a.arcTo(e,i),a.set(n)},RegularPolygon:function(){for(var t=u.readNamed(arguments,"center"),e=r.readNamed(arguments,"sides"),n=r.readNamed(arguments,"radius"),a=360/e,s=e%3==0,o=new u(0,s?-n:n),l=s?-1:.5,h=new Array(e),c=0;c<e;c++)h[c]=new T(t.add(o.rotate((c+l)*a)));return i(h,!0,arguments)},Star:function(){for(var t=u.readNamed(arguments,"center"),e=2*r.readNamed(arguments,"points"),n=r.readNamed(arguments,"radius1"),a=r.readNamed(arguments,"radius2"),s=360/e,o=new u(0,-1),l=new Array(e),h=0;h<e;h++)l[h]=new T(t.add(o.rotate(s*h).multiply(h%2?a:n)));return i(l,!0,arguments)}}}});var O=E.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,i){var n=i,a=n[0];a&&"number"==typeof a[0]&&(n=[n]);for(var s=i.length-1;s>=0;s--){var o=n[s];n!==i||o instanceof z||(n=r.slice(n)),Array.isArray(o)?n[s]=new z({segments:o,insert:!1}):o instanceof O&&(n.splice.apply(n,[s,1].concat(o.removeChildren())),o.remove())}return t.base.call(this,e,n)},reduce:function t(e){for(var i=this._children,n=i.length-1;n>=0;n--){var r;(r=i[n].reduce(e)).isEmpty()&&r.remove()}return i.length?t.base.call(this):((r=new z(x.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,a=i.length;r<a;r++){var s=i[r],o=s._matrix;n.push(s.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join("")},_hitTestChildren:function t(e,i,n){return t.base.call(this,e,i.class===z||"path"===i.type?i:r.set({},i,{fill:!1}),n)},_draw:function(t,e,i,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var a=0,s=r.length;a<s;a++)r[a].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,a=n.length;r<a;r++){var s=n[r],o=s._matrix;i[s._id]||s._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var i=t._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new z(x.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=u.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,a=n.length;r<a;r++)i=n[r][t](e)||i;return i}},{}));E.inject(new function(){var t=Math.min,i=Math.max,n=Math.abs,a={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function s(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0):i}function o(t,e,i,n,r){var a=new O(x.NO_INSERT);return a.addChildren(t,!0),a=a.reduce({simplify:e}),r&&0==r.insert||a.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),a.copyAttributes(i,!0),a}function l(t,e,i,n){if(n&&(0==n.trace||n.stroke)&&/^(subtract|intersect)$/.test(i))return c(t,e,i);var r=s(t,!0),l=e&&t!==e&&s(e,!0),h=a[i];h[i]=!0,l&&(h.subtract||h.exclude)^l.isClockwise()^r.isClockwise()&&l.reverse();var u,d=g(P.expand(r.getCrossings(l))),p=r._children||[r],_=l&&(l._children||[l]),y=[],x=[];function b(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];y.push.apply(y,n._segments),x.push.apply(x,n.getCurves()),n._overlapsOnly=!0}}if(d.length){b(p),_&&b(_);for(var I=0,C=d.length;I<C;I++)m(d[I]._segment,r,l,x,h);for(I=0,C=y.length;I<C;I++){var w=y[I],S=w._intersection;w._winding||m(w,r,l,x,h),S&&S._overlap||(w._path._overlapsOnly=!1)}u=v(y,h)}else u=f(_?p.concat(_):p.slice(),function(t){return!!h[t]});return o(u,!0,t,e,n)}function c(t,e,i){var n=s(t),r=s(e),a=n.getCrossings(r),l="subtract"===i,h="divide"===i,c={},u=[];function d(t){if(!c[t._id]&&(h||r.contains(t.getPointAt(t.getLength()/2))^l))return u.unshift(t),c[t._id]=!0}for(var f=a.length-1;f>=0;f--){var g=a[f].split();g&&(d(g)&&g.getFirstSegment().setHandleIn(0,0),n.getLastSegment().setHandleOut(0,0))}return d(n),o(u,!1,t,e)}function u(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function d(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function f(t,e,i){var a=t&&t.length;if(a){var s=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),o=t.slice().sort(function(t,e){return n(e.getArea())-n(t.getArea())}),l=o[0];null==i&&(i=l.isClockwise());for(var h=0;h<a;h++){for(var c=o[h],u=s[c._id],d=c.getInteriorPoint(),f=0,g=h-1;g>=0;g--){var p=o[g];if(p.contains(d)){var m=s[p._id];f=m.winding,u.winding+=f,u.container=m.exclude?m.container:p;break}}if(e(u.winding)===e(f))u.exclude=!0,t[u.index]=null;else{var v=u.container;c.setClockwise(v?!v.isClockwise():i)}}}return t}function g(t,e,i){var n,r,a,s=e&&[],o=!1,l=i||[],h=i&&{};function c(t){return t._path._id+"."+t._segment1._index}for(var f=(i&&i.length)-1;f>=0;f--){(g=i[f])._path&&(h[c(g)]=!0)}for(f=t.length-1;f>=0;f--){var g,p,m=t[f],v=m._time,_=v,y=e&&!e(m);if((g=m._curve)&&(g!==r?(o=!g.hasHandles()||h&&h[c(g)],n=[],a=null,r=g):a>=1e-8&&(v/=a)),y)n&&n.push(m);else{if(e&&s.unshift(m),a=_,v<1e-8)p=g._segment1;else if(v>1-1e-8)p=g._segment2;else{var x=g.divideAtTime(v,!0);o&&l.push(g,x),p=x._segment1;for(var b=n.length-1;b>=0;b--){var I=n[b];I._time=(I._time-v)/(1-v)}}m._setSegment(p);var C=p._intersection,w=m._intersection;if(C){u(C,w);for(var S=C;S;)u(S._intersection,C),S=S._next}else p._intersection=w}}return i||d(l),s||t}function p(e,r,a,s,o){var l,h,c=a?1:0,u=1^c,d=[e.x,e.y],f=d[c],g=d[u],m=1e-6,v=f-1e-9,_=f+1e-9,y=0,x=0,b=0,I=0,C=!1,w=!1,S=1,M=[];function A(n){var h=n[u+0],d=n[u+6];if(!(g<t(h,d)||g>i(h,d))){var y=n[c+0],x=n[c+2],w=n[c+4],A=n[c+6];if(h!==d){var T=g===h?0:g===d?1:v>i(y,x,w,A)||_<t(y,x,w,A)?1:D.solveCubic(n,u,g,M,0,1)>0?M[0]:1,k=0===T?y:1===T?A:D.getPoint(n,T)[a?"y":"x"],P=h>d?1:-1,E=l[u]>l[u+6]?1:-1,z=l[c+6];return g!==h?(k<v?b+=P:k>_?I+=P:C=!0,k>f-m&&k<f+m&&(S/=2)):(P!==E?y<v?b+=P:y>_&&(I+=P):y!=z&&(z<_&&k>_?(I+=P,C=!0):z>v&&k<v&&(b+=P,C=!0)),S=0),l=n,!o&&k>v&&k<_&&0===D.getTangent(n,T)[a?"x":"y"]&&p(e,r,!a,s,!0)}(y<_&&A>v||A<_&&y>v)&&(C=!0)}}function T(e){var n=e[u+0],r=e[u+2],s=e[u+4],o=e[u+6];if(g<=i(n,r,s,o)&&g>=t(n,r,s,o))for(var l,h=e[c+0],d=e[c+2],f=e[c+4],p=e[c+6],m=v>i(h,d,f,p)||_<t(h,d,f,p)?[e]:D.getMonoCurves(e,a),y=0,x=m.length;y<x;y++)if(l=A(m[y]))return l}for(var k=0,P=r.length;k<P;k++){var E,z=r[k],O=z._path,B=z.getValues();if(!(k&&r[k-1]._path===O||(l=null,O._closed||(h=D.getValues(O.getLastCurve().getSegment2(),z.getSegment1(),null,!s))[u]!==h[u+6]&&(l=h),l))){l=B;for(var R=O.getLastCurve();R&&R!==z;){var L=R.getValues();if(L[u]!==L[u+6]){l=L;break}R=R.getPrevious()}}if(E=T(B))return E;if(k+1===P||r[k+1]._path!==O){if(h&&(E=T(h)))return E;!C||b||I||(b=I=O.isClockwise(s)^a?1:-1),y+=b,x+=I,b=I=0,C&&(w=!0,C=!1),h=null}}return y=n(y),x=n(x),{winding:i(y,x),windingL:y,windingR:x,quality:S,onPath:w}}function m(t,e,i,r,a){var s=[],o=t,l=0;do{var c=(y=t.getCurve()).getLength();s.push({segment:t,curve:y,length:c}),l+=c,t=t.getNext()}while(t&&!t._intersection&&t!==o);for(var u=[.5,.25,.75],d={winding:0,quality:-1},f=0;f<u.length&&d.quality<.5;f++){c=l*u[f];for(var g=0,m=s.length;g<m;g++){var v=s[g],_=v.length;if(c<=_){var y,x=(y=v.curve)._path,b=x._parent,I=b instanceof O?b:x,C=h.clamp(y.getTimeAt(c),1e-8,1-1e-8),w=y.getPointAtTime(C),S=n(y.getTangentAtTime(C).y)<Math.SQRT1_2,M=a.subtract&&i&&(I===e&&i._getWinding(w,S,!0).winding||I===i&&!e._getWinding(w,S,!0).winding)?{winding:0,quality:1}:p(w,r,S,!0);M.quality>d.quality&&(d=M);break}c-=_}}for(g=s.length-1;g>=0;g--)s[g].segment._winding=d}function v(t,e){var i,n=[];function r(t){var i;return!(!t||t._visited||e&&(!e[(i=t._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function a(t){if(t)for(var e=0,n=i.length;e<n;e++)if(t===i[e])return!0;return!1}function s(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}function o(t,e){var n=t._intersection,s=n,o=[];function l(n,s){for(;n&&n!==s;){var l=n._segment,h=l&&l._path;if(h){var c=l.getNext()||h.getFirstSegment(),u=c._intersection;l!==t&&(a(l)||a(c)||c&&r(l)&&(r(c)||u&&r(u._segment)))&&o.push(l),e&&i.push(l)}n=n._next}}if(e&&(i=[t]),n){for(l(n);n&&n._prev;)n=n._prev;l(n,s)}return o}t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),a=!(!n||!n._overlap),s=t._path,o=e._path;return r^a?r?1:-1:!i^!n?i?1:-1:s!==o?s._id-o._id:t._index-e._index});for(var l=0,h=t.length;l<h;l++){var c,u,d,f=t[l],g=r(f),p=null,m=!1,v=!0,_=[];if(g&&f._path._overlapsOnly){var y=f._path,b=f._intersection._segment._path;y.compare(b)&&(y.getArea()&&n.push(y.clone(!1)),s(y),s(b),g=!1)}for(;g;){var I=!p,C=o(f,I),w=C.shift(),S=!(m=!I&&(a(f)||a(w)))&&w;if(I&&(p=new z(x.NO_INSERT),c=null),m){(f.isFirst()||f.isLast())&&(v=f._path._closed),f._visited=!0;break}if(S&&c&&(_.push(c),c=null),c||(S&&C.push(f),c={start:p._segments.length,crossings:C,visited:u=[],handleIn:d}),S&&(f=w),!r(f)){p.removeSegments(c.start);for(var M=0,A=u.length;M<A;M++)u[M]._visited=!1;u.length=0;do{(f=c&&c.crossings.shift())&&f._path||(f=null,(c=_.pop())&&(u=c.visited,d=c.handleIn))}while(c&&!r(f));if(!f)break}var k=f.getNext();p.add(new T(f._point,d,k&&f._handleOut)),f._visited=!0,u.push(f),f=k||f._path.getFirstSegment(),d=k&&k._handleIn}m&&(v&&(p.getFirstSegment().setHandleIn(d),p.setClosed(v)),0!==p.getArea()&&n.push(p))}return n}return{_getWinding:function(t,e,i){return p(t,this.getCurves(),e,i)},unite:function(t,e){return l(this,t,"unite",e)},intersect:function(t,e){return l(this,t,"intersect",e)},subtract:function(t,e){return l(this,t,"subtract",e)},exclude:function(t,e){return l(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?c(this,t,"divide"):o([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function i(t,e){var i=t&&t._intersection;return i&&i._overlap&&i._path===e}var n=!1,a=!1,s=this.getIntersections(null,function(t){return t.hasOverlap()&&(n=!0)||t.isCrossing()&&(a=!0)}),o=n&&a&&[];if(s=P.expand(s),n)for(var l=g(s,function(t){return t.hasOverlap()},o),h=l.length-1;h>=0;h--){var c=l[h],u=c._path,f=c._segment,p=f.getPrevious(),m=f.getNext();i(p,u)&&i(m,u)&&(f.remove(),p._handleOut._set(0,0),m._handleIn._set(0,0),p===f||p.getCurve().hasLength()||(m._handleIn.set(p._handleIn),p.remove()))}a&&(g(s,n&&function(t){var e=t.getCurve(),i=t.getSegment(),n=t._intersection,r=n._curve,a=n._segment;if(e&&r&&e._path&&r._path)return!0;i&&(i._intersection=null),a&&(a._intersection=null)},o),o&&d(o),e=v(r.each(e,function(t){this.push.apply(this,t._segments)},[])));var _,y=e.length;return y>1&&t?(e!==t&&this.setChildren(e),_=this):1!==y||t||(e[0]!==this&&this.setSegments(e[0].removeSegments()),_=this),_||((_=new O(x.NO_INSERT)).addChildren(e),(_=_.reduce()).copyAttributes(this),this.replaceWith(_)),_},reorient:function(t,i){var n=this._children;return n&&n.length?this.setChildren(f(this.removeChildren(),function(e){return!!(t?e:1&e)},i)):i!==e&&this.setClockwise(i),this},getInteriorPoint:function(){var e=this.getBounds().getCenter(!0);if(!this.contains(e)){for(var n=this.getCurves(),r=e.y,a=[],s=[],o=0,l=n.length;o<l;o++){var h=n[o].getValues(),c=h[1],u=h[3],d=h[5],f=h[7];if(r>=t(c,u,d,f)&&r<=i(c,u,d,f))for(var g=D.getMonoCurves(h),p=0,m=g.length;p<m;p++){var v=g[p],_=v[1],y=v[7];if(_!==y&&(r>=_&&r<=y||r>=y&&r<=_)){var x=r===_?v[0]:r===y?v[6]:1===D.solveCubic(v,1,r,s,0,1)?D.getPoint(v,s[0]).x:(v[0]+v[6])/2;a.push(x)}}}a.length>1&&(a.sort(function(t,e){return t-e}),e.x=(a[0]+a[1])/2)}return e}}});var B=r.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){var a,s=[],o=[],l=0,h=1/(i||32),c=t._segments,u=c[0];function d(t,i){var a=D.getValues(t,i,r);s.push(a),function t(i,r,a,s){if(!(s-a>h)||n&&D.isStraight(i)||D.isFlatEnough(i,e||.25)){var c=i[6]-i[0],u=i[7]-i[1],d=Math.sqrt(c*c+u*u);d>0&&(l+=d,o.push({offset:l,curve:i,index:r,time:s}))}else{var f=D.subdivide(i,.5),g=(a+s)/2;t(f[0],r,a,g),t(f[1],r,g,s)}}(a,t._index,0,1)}for(var f=1,g=c.length;f<g;f++)d(u,a=c[f]),u=a;t._closed&&d(a,c[0]),this.curves=s,this.parts=o,this.length=l,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;e=r,r&&!(i[--r].offset<t););for(;e<n;e++){var a=i[e];if(a.offset>=t){this.index=e;var s=i[e-1],o=s&&s.index===a.index?s.time:0,l=s?s.offset:0;return{index:a.index,time:o+(a.time-o)*(t-l)/(a.offset-l)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),a=n.index,s=r.index;a<=s;a++){var o=D.getPart(this.curves[a],a===n.index?n.time:0,a===r.index?r.time:1);a===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(D._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return D[t](this.curves[i.index],i.time)}},{})),R=r.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,a=0,s=n.length;a<s;a++){var o=n[a].point;e&&e.equals(o)||i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new T(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,a){var s=this.points;if(n-i!=1){for(var o,l=this.chordLengthParameterize(i,n),h=Math.max(e,e*e),c=!0,u=0;u<=4;u++){var d=this.generateBezier(i,n,l,r,a),f=this.findMaxError(i,n,d,l);if(f.error<e&&c)return void this.addCurve(t,d);if(o=f.index,f.error>=h)break;c=this.reparameterize(i,n,l,d),h=f.error}var g=s[o-1].subtract(s[o+1]);this.fitCubic(t,e,i,o,r,g),this.fitCubic(t,e,o,n,g.negate(),a)}else{var p=s[i],m=s[n],v=p.getDistance(m)/3;this.addCurve(t,[p,p.add(r.normalize(v)),m.add(a.normalize(v)),m])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new T(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var a=Math.abs,s=this.points,o=s[t],l=s[e],h=[[0,0],[0,0]],c=[0,0],u=0,d=e-t+1;u<d;u++){var f=i[u],g=1-f,p=3*f*g,m=g*g*g,v=p*g,_=p*f,y=f*f*f,x=n.normalize(v),b=r.normalize(_),I=s[t+u].subtract(o.multiply(m+v)).subtract(l.multiply(_+y));h[0][0]+=x.dot(x),h[0][1]+=x.dot(b),h[1][0]=h[0][1],h[1][1]+=b.dot(b),c[0]+=x.dot(I),c[1]+=b.dot(I)}var C,w,S=h[0][0]*h[1][1]-h[1][0]*h[0][1];if(a(S)>1e-12){var M=h[0][0]*c[1]-h[1][0]*c[0];C=(c[0]*h[1][1]-c[1]*h[0][1])/S,w=M/S}else{var A=h[0][0]+h[0][1],T=h[1][0]+h[1][1];C=w=a(A)>1e-12?c[0]/A:a(T)>1e-12?c[1]/T:0}var k,D,P=l.getDistance(o),E=1e-12*P;if(C<E||w<E)C=w=P/3;else{var z=l.subtract(o);k=n.normalize(C),D=r.normalize(w),k.dot(z)-D.dot(z)>P*P&&(C=w=P/3,k=D=null)}return[o,o.add(k||n.normalize(C)),l.add(D||r.normalize(w)),l]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);r=1;for(var a=i.length;r<a;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],a=0;a<=2;a++)n[a]=t[a+1].subtract(t[a]).multiply(3);for(a=0;a<=1;a++)r[a]=n[a+1].subtract(n[a]).multiply(2);var s=this.evaluate(3,t,i),o=this.evaluate(2,n,i),l=this.evaluate(1,r,i),c=s.subtract(e),u=o.dot(o)+c.dot(l);return h.isZero(u)?i:i-c.dot(o)/u},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var a=0;a<=t-r;a++)n[a]=n[a].multiply(1-i).add(n[a+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);n=1;for(var r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),a=0,s=t+1;s<e;s++){var o=this.evaluate(3,i,n[s-t]).subtract(this.points[s]),l=o.x*o.x+o.y*o.y;l>=a&&(a=l,r=s)}return{error:a,index:r}}}),L=x.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&u.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),F=L.extend({_class:"PointText",initialize:function(){L.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new d(t.x,t.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,a=r.hasFill(),s=r.hasStroke(),o=r.getLeading(),l=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var h=0,c=n.length;h<c;h++){t.shadowColor=l;var u=n[h];a&&(t.fillText(u,0,0),t.shadowColor="rgba(0,0,0,0)"),s&&t.strokeText(u,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,a=i.getJustification(),s=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),l=0;"left"!==a&&(l-=o/("center"===a?2:1));var h=new p(l,r?-.75*s:0,o,r*s);return t?t._transformBounds(h,h):h}}),G=r.extend(new function(){var t,e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},n={},a={};var s=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],o={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=n-Math.min(t,e,i);return[0===r?0:60*(n==t?(e-i)/r+(e<i?6:0):n==e?(i-t)/r+2:(t-e)/r+4),0===n?0:r/n,n]},"hsb-rgb":function(t,e,i){var n,r=(t=(t/60%6+6)%6)-(n=Math.floor(t)),a=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[a[(n=s[n])[0]],a[n[1]],a[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),a=n-r,s=0===a,o=(n+r)/2;return[s?0:60*(n==t?(e-i)/a+(e<i?6:0):n==e?(i-t)/a+2:(t-e)/a+4),s?0:o<.5?a/(n+r):a/(2-n-r),o]},"hsl-rgb":function(t,e,i){if(0===e)return[i,i,i];for(var n=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,a=2*i-r,s=[],o=0;o<3;o++){var l=n[o];l<0&&(l+=1),l>1&&(l-=1),s[o]=6*l<1?a+6*(r-a)*l:2*l<1?r:3*l<2?a+(r-a)*(2/3-l)*6:a}return s},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(e,function(t,i){n[i]=[],r.each(t,function(t,a){var s=r.capitalize(t),o=/^(hue|saturation)$/.test(t),l=n[i][a]="gradient"===t?function(t){var e=this._components[0];return e!==(t=N.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===i?function(){return u.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+s]=function(){return this._type===i||o&&/^hs[bl]$/.test(this._type)?this._components[a]:this._convert(i)[a]},this["set"+s]=function(t){this._type===i||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(i),this._properties=e[i],this._type=i),this._components[a]=l.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function s(o){var l,h,c,u,d=arguments,f=this.__read,g=0;Array.isArray(o)&&(o=(d=o)[0]);var p=null!=o&&typeof o;if("string"===p&&o in e&&(l=o,o=d[1],Array.isArray(o)?(h=o,c=d[2]):(f&&(g=1),d=r.slice(d,1),p=typeof o)),!h){if(u="number"===p?d:"object"===p&&null!=o.length?o:null){l||(l=u.length>=3?"rgb":"gray");var m=e[l].length;c=u[m],f&&(g+=u===arguments?m+(null!=c?1:0):1),u.length>m&&(u=r.slice(u,0,m))}else if("string"===p)l="rgb",4===(h=function(e){var n,r=e.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r){n=[0,0,0];for(var s=0;s<3;s++){var o=r[s+1];n[s]=parseInt(1==o.length?o+o:o,16)/255}}else if(r=e.match(/^rgba?\((.*)\)$/)){s=0;for(var l=(n=r[1].split(",")).length;s<l;s++)o=+n[s],n[s]=s<3?o/255:o}else if(i){var h=a[e];if(!h){t||((t=$.getContext(1,1)).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=e,t.fillRect(0,0,1,1);var c=t.getImageData(0,0,1,1).data;h=a[e]=[c[0]/255,c[1]/255,c[2]/255]}n=h.slice()}else n=[0,0,0];return n}(o)).length&&(c=h[3],h.length--);else if("object"===p)if(o.constructor===s){if(l=o._type,h=o._components.slice(),c=o._alpha,"gradient"===l)for(var v=1,_=h.length;v<_;v++){var y=h[v];y&&(h[v]=y.clone())}}else if(o.constructor===N)l="gradient",u=d;else{var x=e[l="hue"in o?"lightness"in o?"hsl":"hsb":"gradient"in o||"stops"in o||"radial"in o?"gradient":"gray"in o?"gray":"rgb"],b=n[l];this._components=h=[];for(v=0,_=x.length;v<_;v++){null==(I=o[x[v]])&&!v&&"gradient"===l&&"stops"in o&&(I={stops:o.stops,radial:o.radial}),null!=(I=b[v].call(this,I))&&(h[v]=I)}c=o.alpha}f&&l&&(g=1)}if(this._type=l||"rgb",!h){this._components=h=[];for(v=0,_=(b=n[this._type]).length;v<_;v++){var I;null!=(I=b[v].call(this,u&&u[v]))&&(h[v]=I)}}return this._components=h,this._properties=e[this._type],this._alpha=c,f&&(this.__read=g),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=o[this._type+"-"+t])?e.apply(this,this._components):o["rgb-"+t].apply(this,o[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new G(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=e[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?G.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=l.instance,r=0,a=t.length;r<a;r++){var s=this._components[r];null!=s&&e.push(t[r]+": "+(i?s:n.number(s)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){var e=this._convert("rgb"),i=t||null==this._alpha?1:this._alpha;function n(t){return Math.round(255*(t<0?0:t>1?1:t))}return e=[n(e[0]),n(e[1]),n(e[2])],i<1&&e.push(i<0?0:i),t?"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):(4==e.length?"rgba(":"rgb(")+e.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,n=this._components,r=n[0],a=r._stops,s=n[1],o=n[2],l=n[3],h=e&&e.inverted();if(h&&(s=h._transformPoint(s),o=h._transformPoint(o),l&&(l=h._transformPoint(l))),r._radial){var c=o.getDistance(s);if(l){var u=l.subtract(s);u.getLength()>c&&(l=s.add(u.normalize(c-.1)))}var d=l||s;i=t.createRadialGradient(d.x,d.y,0,s.x,s.y,c)}else i=t.createLinearGradient(s.x,s.y,o.x,o.y);for(var f=0,g=a.length;f<g;f++){var p=a[f],m=p._offset;i.addColorStop(null==m?f/(g-1):m,p._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:e,random:function(){var t=Math.random;return new G(t(),t(),t())}}})},new function(){return r.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=G.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),a=0,s=n.length;a<s;a++)r[a]=t(n[a],r[a]);return new G(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),N=r.extend({_class:"Gradient",initialize:function(t,e){this._id=c.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var i=this._owners?this._owners.indexOf(t):-1;-1!=i&&(this._owners.splice(i,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new N(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;for(n=0,r=(i=this._stops=U.readList(t,0,{clone:!0})).length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),U=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new U(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=G.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),j=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new u,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontStretch:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new G}),a={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,fontStretch:9,font:9,leading:9,justification:9},s={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,a){this._values={},this._owner=r,this._project=r&&r._project||a||paper.project,this._defaults=!r||r instanceof b?i:r instanceof L?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),l="shadowOffset"===i,h=r.capitalize(i),c=a[i],d="set"+h,f="get"+h;o[d]=function(t){var r=this._owner,a=r&&r._children;if(a&&a.length>0&&!(r instanceof O))for(var s=0,o=a.length;s<o;s++)a[s]._style[d](t);else if(i in this._defaults){var l=this._values[i];l!==t&&(n&&(l&&l._owner!==e&&(l._owner=e),t&&t.constructor===G&&(t._owner&&(t=t.clone()),t._owner=r)),this._values[i]=t,r&&r._changed(c||65))}},o[f]=function(t){var a,s=this._owner,o=s&&s._children;if(i in this._defaults&&(!o||!o.length||t||s instanceof O))if((a=this._values[i])===e)(a=this._defaults[i])&&a.clone&&(a=a.clone());else{var h=n?G:l?u:null;!h||a&&a.constructor===h||(this._values[i]=a=h.read([a],0,{readNull:!0,clone:!0}),a&&n&&(a._owner=s))}else if(o)for(var c=0,d=o.length;c<d;c++){var g=o[c]._style[f]();if(c){if(!r.equals(a,g))return e}else a=g}return a},s[f]=function(t){return this._style[f](t)},s[d]=function(t){this._style[d](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;o[i]=s[i]="#get"+t,o[n]=s[n]="#set"+t}),x.inject(s),o},{set:function(t){var e=t instanceof j,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){function i(t,i,n){var a=t._values,s=i._values,o=i._defaults;for(var l in a){var h=a[l],c=s[l];if(!(n&&l in s||r.equals(h,c===e?o[l]:c)))return!1}return!0}return t===this||t&&this._class===t._class&&i(this,t)&&i(t,this,!0)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize(),e=this.getFontStretch();return this.getFontWeight()+" "+e+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),Z=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],a=e[0].toUpperCase()+e.substring(1),s=0;s<6;s++){var o=r[s],l=o?o+a:e;if(l in t){if(!i)return t[l];t[l]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,a=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var s=i.left-(a.clientLeft||r.clientLeft||0),o=i.top-(a.clientTop||r.clientTop||0);if(!e){var l=n.defaultView;s+=l.pageXOffset||a.scrollLeft||r.scrollLeft,o+=l.pageYOffset||a.scrollTop||r.scrollTop}return new p(s,o,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new p(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return Z.getBounds(t,e).getPoint()},getSize:function(t){return Z.getBounds(t,!0).getSize()},isInvisible:function(t){return Z.getSize(t).equals(new f(0,0))},isInView:function(t){return!Z.isInvisible(t)&&Z.getViewportBounds(t).intersects(Z.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},W={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),a=0,s=r.length;a<s;a++)t.addEventListener(r[a],n,!1)},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),a=0,s=r.length;a<s;a++)t.removeEventListener(r[a],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new u(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return W.getPoint(t).subtract(Z.getOffset(e||W.getTarget(t)))}};W.requestAnimationFrame=new function(){var t,e=Z.getPrefixed(i,"requestAnimationFrame"),n=!1,r=[];function a(){var t=r;r=[];for(var i=0,s=t.length;i<s;i++)t[i]();(n=e&&r.length)&&e(a)}return function(i){r.push(i),e?n||(e(a),n=!0):t||(t=setInterval(a,1e3/60))}};var V=r.extend(a,{_class:"View",initialize:function t(e,r){function a(t){return r[t]||parseInt(r.getAttribute(t),10)}function o(){var t=Z.getSize(r);return t.isNaN()||t.isZero()?new f(a("width"),a("height")):t}var l;if(i&&r){this._id=r.getAttribute("id"),null==this._id&&r.setAttribute("id",this._id="view-"+t._id++),W.add(r,this._viewEvents);if(Z.setPrefixed(r.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),s.hasAttribute(r,"resize")){var h=this;W.add(i,this._windowEvents={resize:function(){h.setViewSize(o())}})}if(l=o(),s.hasAttribute(r,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var c=this._stats.domElement,u=c.style,d=Z.getOffset(r);u.position="absolute",u.left=d.x+"px",u.top=d.y+"px",n.body.appendChild(c)}}else l=new f(r),r=null;this._project=e,this._scope=e._scope,this._element=r,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(l.width,l.height),this._viewSize=l,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new v)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;V._focused===this&&(V._focused=null),V._views.splice(V._views.indexOf(this),1),delete V._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),W.remove(this._element,this._viewEvents),W.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(x._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;W.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;Z.getPrefixed(n,"hidden")&&"true"!==s.getAttribute(e,"keepalive")||!Z.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new g(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=f.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new p(new u,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return Z.isInView(this._element)},isInserted:function(){return Z.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var r=i.parentNode,a=n.createElement("div");a.style.fontSize=t,r.appendChild(a),e=parseFloat(Z.getStyles(a).fontSize),r.removeChild(a)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:u).read(arguments),n=u.read(arguments,0,{readNull:!0});return this.transform((new v)[t](i,n||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new v;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=u.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose(),e=t&&t.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new v).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),i=t&&t.scaling;return i?new d(i.x,i.y,this,"setScaling"):e},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(u.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(u.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(u.read(arguments))},getEventPoint:function(t){return this.viewToProject(W.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return n&&"string"==typeof e&&(e=n.getElementById(e)),new(i?X:V)(t,e)}}},new function(){if(i){var t,e,r,a,s,o=!1,l=!1,h=i.navigator;h.pointerEnabled||h.msPointerEnabled?(r="pointerdown MSPointerDown",a="pointermove MSPointerMove",s="pointerup pointercancel MSPointerUp MSPointerCancel"):(r="touchstart",a="touchmove",s="touchend touchcancel","ontouchstart"in i&&h.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(r+=" mousedown",a+=" mousemove",s+=" mouseup"));var c={},u={mouseout:function(t){var e=V._focused,i=W.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=W.getOffset(t,e._element),r=n.x,a=Math.abs,s=a(r),o=s-(1<<25);n.x=a(o)<s?o*(r<0?-1:1):r,A(e,t,e.viewToProject(n))}},scroll:M};c[r]=function(t){var e=V._focused=S(t);o||(o=!0,e._handleMouseEvent("mousedown",t))},u[a]=function(i){var n=V._focused;if(!l){var r=S(i);r?n!==r&&(n&&A(n,i),t||(t=n),n=V._focused=e=r):e&&e===n&&(t&&!t.isInserted()&&(t=null),n=V._focused=t,t=null,M())}n&&A(n,i)},u[r]=function(){l=!0},u[s]=function(t){var e=V._focused;e&&o&&e._handleMouseEvent("mouseup",t),l=o=!1},W.add(n,u),W.add(i,{load:M});var d,f,g,p,m,v,_,y,x=!1,b=!1,I={doubleclick:"click",mousedrag:"mousemove"},C=!1,w={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:c,_handleMouseEvent:function(t,e,i){var n=this._itemEvents,r=n.native[t],a="mousemove"===t,s=this._scope.tool,l=this;function h(t){return n.virtual[t]||l.responds(t)||s&&s.responds(t)}a&&o&&h("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var c=this.getBounds().contains(i),u=r&&c&&l._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),I=u&&u.item||null,w=!1,S={};if(S[t.substr(5)]=!0,r&&I!==p&&(p&&T(p,null,"mouseleave",e,i),I&&T(I,null,"mouseenter",e,i),p=I),C^c&&(T(this,null,c?"mouseenter":"mouseleave",e,i),c?this:null,w=!0),!c&&!S.drag||i.equals(f)||(k(this,I,a?t:"mousemove",e,i,f),w=!0),C=c,S.down&&c||S.up&&d){if(k(this,I,t,e,i,d),S.down){if(y=I===v&&Date.now()-_<300,g=v=I,!b&&I){for(var M=I;M&&!M.responds("mousedrag");)M=M._parent;M&&(m=I)}d=i}else S.up&&(b||I!==g||(_=Date.now(),k(this,I,y?"doubleclick":"click",e,i,d),y=!1),g=m=null);C=!1,w=!0}f=i,w&&s&&(x=s._handleMouseEvent(t,e,i,S)||x),(x&&!S.move||S.down&&h("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){var r,a=this._scope,s=a.tool;function o(s){s.responds(t)&&(paper=a,s.emit(t,r=r||new H(t,e,i,n)))}this.isVisible()&&(o(this),s&&s.responds(t)&&o(s))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var a in w)n[a]=(n[a]||0)+(w[a][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:M}}}function S(t){var e=W.getTarget(t);return e.getAttribute&&V._viewsById[e.getAttribute("id")]}function M(){var t=V._focused;if(!t||!t.isVisible())for(var i=0,n=V._views.length;i<n;i++)if((t=V._views[i]).isVisible()){V._focused=e=t;break}}function A(t,e,i){t._handleMouseEvent("mousemove",e,i)}function T(t,e,i,n,r,a,s){var o,l=!1;function h(t,i){if(t.responds(i)){if(o||(o=new J(i,n,r,e||t,a?r.subtract(a):null)),t.emit(i,o)&&(x=!0,o.prevented&&(b=!0),o.stopped))return l=!0}else{var s=I[i];if(s)return h(t,s)}}for(;t&&t!==s&&!h(t,i);)t=t._parent;return l}function k(t,e,i,n,r,a){return t._project.removeOn(i),b=x=!1,m&&T(m,null,i,n,r,a)||e&&e!==m&&!e.isDescendant(m)&&T(e,null,i,n,r,a,m)||T(t,m||e||t,i,n,r,a)}}),X=V.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var n=f.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=$.getCanvas(n)}var a=this._context=e.getContext("2d");if(a.save(),this._pixelRatio=1,!/^off|false$/.test(s.getAttribute(e,"hidpi"))){var o=i.devicePixelRatio||1,l=Z.getPrefixed(a,"backingStorePixelRatio")||1;this._pixelRatio=o/l}V.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,i){var n=this._pixelRatio;if(t.base.call(this,e*n,i*n),1!==n){var r=this._element,a=this._context;if(!s.hasAttribute(r,"resize")){var o=r.style;o.width=e+"px",o.height=i+"px"}a.restore(),a.save(),a.scale(n,n)}},getPixelSize:function t(e){var i,n=paper.agent;if(n&&n.firefox)i=t.base.call(this,e);else{var r=this._context,a=r.font;r.font=e+" serif",i=parseFloat(r.font),r.font=a}return i},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var a=0,s=e.length;a<s;a++)r=Math.max(r,i.measureText(e[a]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),Y=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return q.modifiers}}),H=Y.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),q=new function(){var t,a,s={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},o={tab:"\t",space:" ",enter:"\r"},l={},h={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});function u(t){var i=t.key||t.keyIdentifier;return i=/^U\+/.test(i)?String.fromCharCode(parseInt(i.substr(2),16)):/^Arrow[A-Z]/.test(i)?i.substr(5):"Unidentified"===i||i===e?String.fromCharCode(t.keyCode):i,s[i]||(i.length>1?r.hyphenate(i):i.toLowerCase())}function d(e,i,n,a){var s,o=V._focused;if(l[i]=e,e?h[i]=n:delete h[i],i.length>1&&(s=r.camelize(i))in c){c[s]=e;var u=paper&&paper.agent;if("meta"===s&&u&&u.mac)if(e)t={};else{for(var f in t)f in h&&d(!1,f,t[f],a);t=null}}else e&&t&&(t[i]=n);o&&o._handleKeyEvent(e?"keydown":"keyup",a,i,n)}return W.add(n,{keydown:function(t){var e=u(t),i=paper&&paper.agent;e.length>1||i&&i.chrome&&(t.altKey||i.mac&&t.metaKey||!i.mac&&t.ctrlKey)?d(!0,e,o[e]||(e.length>1?"":e),t):a=e},keypress:function(t){if(a){var e=u(t),i=t.charCode,n=i>=32?String.fromCharCode(i):e.length>1?"":e;e!==a&&(e=n.toLowerCase()),d(!0,e,n,t),a=null}},keyup:function(t){var e=u(t);e in h&&d(!1,e,h[e],t)}}),W.add(i,{blur:function(t){for(var e in h)d(!1,e,h[e],t)}}),{modifiers:c,isDown:function(t){return!!l[t]}}},J=Y.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Q=Y.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),K=(o.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){o.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){paper=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var r=n.move||n.drag,a=this.responds(t),s=this.minDistance,o=this.maxDistance,l=!1,h=this;function c(t,e){var a=i,s=r?h._point:h._downPoint||a;if(r){if(h._moveCount&&a.equals(s))return!1;if(s&&(null!=t||null!=e)){var o=a.subtract(s),l=o.getLength();if(l<(t||0))return!1;e&&(a=s.add(o.normalize(Math.min(l,e))))}h._moveCount++}return h._point=a,h._lastPoint=s||a,n.down&&(h._moveCount=-1,h._downPoint=a,h._downCount++),!0}function u(){a&&(l=h.emit(t,new Q(h,t,e))||l)}if(n.down)c(),u();else if(n.up)c(null,o),u();else if(a)for(;c(s,o);)u();return l}}),{request:function(e){var i=new t.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var t=i.status;0===t||200===t?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,n='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(n);e.onError(n,t)},i.send(null)}}),$={canvases:[],getCanvas:function(t,e){if(!i)return null;var r,a=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=n.createElement("canvas"),a=!1);var s=r.getContext("2d");if(!s)throw new Error("Canvas "+r+" is unable to provide a 2D context.");return r.width===t&&r.height===e?a&&s.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),s.save(),r},getContext:function(t,e){var i=this.getCanvas(t,e);return i?i.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},tt=new function(){var t,e,i,n,a,s,o,l,h,c,u,d=Math.min,f=Math.max,g=Math.abs;function p(t,e,i){return.2989*t+.587*e+.114*i}function m(t,e,i,n){var r=n-p(t,e,i),a=(n=p(h=t+r,c=e+r,u=i+r),d(h,c,u)),s=f(h,c,u);if(a<0){var o=n-a;h=n+(h-n)*n/o,c=n+(c-n)*n/o,u=n+(u-n)*n/o}if(s>255){var l=255-n,g=s-n;h=n+(h-n)*l/g,c=n+(c-n)*l/g,u=n+(u-n)*l/g}}function v(t,e,i){return f(t,e,i)-d(t,e,i)}function _(t,e,i,n){var r,a=[t,e,i],s=f(t,e,i),o=d(t,e,i);r=0===d(o=o===t?0:o===e?1:2,s=s===t?0:s===e?1:2)?1===f(o,s)?2:1:0,a[s]>a[o]?(a[r]=(a[r]-a[o])*n/(a[s]-a[o]),a[s]=n):a[r]=a[s]=0,a[o]=0,h=a[0],c=a[1],u=a[2]}var y={multiply:function(){h=a*t/255,c=s*e/255,u=o*i/255},screen:function(){h=a+t-a*t/255,c=s+e-s*e/255,u=o+i-o*i/255},overlay:function(){h=a<128?2*a*t/255:255-2*(255-a)*(255-t)/255,c=s<128?2*s*e/255:255-2*(255-s)*(255-e)/255,u=o<128?2*o*i/255:255-2*(255-o)*(255-i)/255},"soft-light":function(){var n=t*a/255;h=n+a*(255-(255-a)*(255-t)/255-n)/255,c=(n=e*s/255)+s*(255-(255-s)*(255-e)/255-n)/255,u=(n=i*o/255)+o*(255-(255-o)*(255-i)/255-n)/255},"hard-light":function(){h=t<128?2*t*a/255:255-2*(255-t)*(255-a)/255,c=e<128?2*e*s/255:255-2*(255-e)*(255-s)/255,u=i<128?2*i*o/255:255-2*(255-i)*(255-o)/255},"color-dodge":function(){h=0===a?0:255===t?255:d(255,255*a/(255-t)),c=0===s?0:255===e?255:d(255,255*s/(255-e)),u=0===o?0:255===i?255:d(255,255*o/(255-i))},"color-burn":function(){h=255===a?255:0===t?0:f(0,255-255*(255-a)/t),c=255===s?255:0===e?0:f(0,255-255*(255-s)/e),u=255===o?255:0===i?0:f(0,255-255*(255-o)/i)},darken:function(){h=a<t?a:t,c=s<e?s:e,u=o<i?o:i},lighten:function(){h=a>t?a:t,c=s>e?s:e,u=o>i?o:i},difference:function(){(h=a-t)<0&&(h=-h),(c=s-e)<0&&(c=-c),(u=o-i)<0&&(u=-u)},exclusion:function(){h=a+t*(255-a-a)/255,c=s+e*(255-s-s)/255,u=o+i*(255-o-o)/255},hue:function(){_(t,e,i,v(a,s,o)),m(h,c,u,p(a,s,o))},saturation:function(){_(a,s,o,v(t,e,i)),m(h,c,u,p(a,s,o))},luminosity:function(){m(a,s,o,p(t,e,i))},color:function(){m(t,e,i,p(a,s,o))},add:function(){h=d(a+t,255),c=d(s+e,255),u=d(o+i,255)},subtract:function(){h=f(a-t,0),c=f(s-e,0),u=f(o-i,0)},average:function(){h=(a+t)/2,c=(s+e)/2,u=(o+i)/2},negation:function(){h=255-g(255-t-a),c=255-g(255-e-s),u=255-g(255-i-o)}},x=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),b=$.getContext(1,1);b&&(r.each(y,function(t,e){var i="darken"===e,n=!1;b.save();try{b.fillStyle=i?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=e,b.globalCompositeOperation===e&&(b.fillStyle=i?"#a00":"#300",b.fillRect(0,0,1,1),n=b.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}b.restore(),x[e]=n}),$.release(b)),this.process=function(r,d,f,g,p){var m=d.canvas,v="normal"===r;if(v||x[r])f.save(),f.setTransform(1,0,0,1,0,0),f.globalAlpha=g,v||(f.globalCompositeOperation=r),f.drawImage(m,p.x,p.y),f.restore();else{var _=y[r];if(!_)return;for(var b=f.getImageData(p.x,p.y,m.width,m.height),I=b.data,C=d.getImageData(0,0,m.width,m.height).data,w=0,S=I.length;w<S;w+=4){t=C[w],a=I[w],e=C[w+1],s=I[w+1],i=C[w+2],o=I[w+2],n=C[w+3],l=I[w+3],_();var M=n*g/255,A=1-M;I[w]=M*h+A*a,I[w+1]=M*c+A*s,I[w+2]=M*u+A*o,I[w+3]=n*g+A*l}f.putImageData(b,p.x,p.y)}}},et=new function(){var t="http://www.w3.org/2000/svg",e="http://www.w3.org/2000/xmlns",i="http://www.w3.org/1999/xlink",r={href:i,xlink:e,xmlns:e+"/","xmlns:xlink":e+"/"};function a(t,e,i){for(var n in e){var a=e[n],s=r[n];"number"==typeof a&&i&&(a=i.number(a)),s?t.setAttributeNS(s,n,a):t.setAttribute(n,a)}return t}return{svg:t,xmlns:e,xlink:i,create:function(e,i,r){return a(n.createElementNS(t,e),i,r)},get:function(t,e){var i=r[e],n=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===n?null:n},set:a}},it=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof E||t instanceof C||t instanceof L)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],fontStretch:["font-stretch","string"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});return new function(){var e;function i(t,i,n){var a=new r,s=t.getTranslation();if(i){var o=(t=t._shiftless())._inverseTransform(s);a[n?"cx":"x"]=o.x,a[n?"cy":"y"]=o.y,s=null}if(!t.isIdentity()){var l=t.decompose();if(l){var c=[],u=l.rotation,d=l.scaling,f=l.skewing;s&&!s.isZero()&&c.push("translate("+e.point(s)+")"),u&&c.push("rotate("+e.number(u)+")"),h.isZero(d.x-1)&&h.isZero(d.y-1)||c.push("scale("+e.point(d)+")"),f.x&&c.push("skewX("+e.number(f.x)+")"),f.y&&c.push("skewY("+e.number(f.y)+")"),a.transform=c.join(" ")}else a.transform="matrix("+t.getValues().join(",")+")"}return a}function a(t,n){for(var r=i(t._matrix),a=t._children,s=et.create("g",r,e),o=0,l=a.length;o<l;o++){var h=a[o],c=_(h,n);if(c)if(h.isClipMask()){var u=et.create("clipPath");u.appendChild(c),g(h,u,"clip"),et.set(s,{"clip-path":"url(#"+u.id+")"})}else s.appendChild(c)}return s}function s(t){var n=t._type,r=t._radius,a=i(t._matrix,!0,"rectangle"!==n);if("rectangle"===n){n="rect";var s=t._size,o=s.width,l=s.height;a.x-=o/2,a.y-=l/2,a.width=o,a.height=l,r.isZero()&&(r=null)}return r&&("circle"===n?a.r=r:(a.rx=r.width,a.ry=r.height)),et.create(n,a,e)}var o,u={Group:a,Layer:a,Raster:function(t,n){var r=i(t._matrix,!0),a=t.getSize(),s=t.getImage();return r.x-=a.width/2,r.y-=a.height/2,r.width=a.width,r.height=a.height,r.href=0==n.embedImages&&s&&s.src||t.toDataURL(),et.create("image",r,e)},Path:function(t,n){var r=n.matchShapes;if(r){var a=t.toShape(!1);if(a)return s(a)}var o,l=t._segments,h=l.length,c=i(t._matrix);if(r&&h>=2&&!t.hasHandles())if(h>2){o=t._closed?"polygon":"polyline";for(var u=[],d=0;d<h;d++)u.push(e.point(l[d]._point));c.points=u.join(" ")}else{o="line";var f=l[0]._point,g=l[1]._point;c.set({x1:f.x,y1:f.y,x2:g.x,y2:g.y})}else o="path",c.d=t.getPathData(null,n.precision);return et.create(o,c,e)},Shape:s,CompoundPath:function(t,n){var r=i(t._matrix),a=t.getPathData(null,n.precision);return a&&(r.d=a),et.create("path",r,e)},SymbolItem:function(t,n){var r=i(t._matrix,!0),a=t._definition,s=f(a,"symbol"),o=a._item,l=o.getBounds();return s||((s=et.create("symbol",{viewBox:e.rectangle(l)})).appendChild(_(o,n)),g(a,s,"symbol")),r.href="#"+s.id,r.x+=l.x,r.y+=l.y,r.width=l.width,r.height=l.height,r.overflow="visible",et.create("use",r,e)},PointText:function(t){var r=et.create("text",i(t._matrix,!0),e);if(""==t.content||""==t.content)return null;/[\u0590-\u05ff\u0600-\u06ff]/.test(t.content)&&(r.style.direction="rtl",r.style.textAnchor="end");for(var a=t.leading,s=0;s<t._lines.length;s++){var o=n.createElementNS("http://www.w3.org/2000/svg","tspan");o.textContent=t._lines[s],0===s&&(a=0),o.setAttributeNS(null,"x",r.getAttribute("x")),o.setAttributeNS(null,"dy",a),""==o.textContent.trim()?a+=t.leading:a=t.leading,r.appendChild(o)}return r}};function d(t,i,n){var a={},s=!n&&t.getParent(),o=[];return null!=t._name&&(a.id=t._name),r.each(it,function(i){var n=i.get,l=i.type,h=t[n]();if(i.exportFilter?i.exportFilter(t,h):!s||!r.equals(s[n](),h)){if("color"===l&&null!=h){var c=h.getAlpha();c<1&&(a[i.attribute+"-opacity"]=c)}"style"===l?o.push(i.attribute+": "+h):a[i.attribute]=null==h?"none":"color"===l?h.gradient?function(t){var i=f(t,"color");if(!i){var n,r=t.getGradient(),a=r._radial,s=t.getOrigin(),o=t.getDestination();if(a){n={cx:s.x,cy:s.y,r:s.getDistance(o)};var l=t.getHighlight();l&&(n.fx=l.x,n.fy=l.y)}else n={x1:s.x,y1:s.y,x2:o.x,y2:o.y};n.gradientUnits="userSpaceOnUse",i=et.create((a?"radial":"linear")+"Gradient",n,e);for(var h=r._stops,c=0,u=h.length;c<u;c++){var d=h[c],p=d._color,m=p.getAlpha(),v=d._offset;n={offset:null==v?c/(u-1):v},p&&(n["stop-color"]=p.toCSS(!0)),m<1&&(n["stop-opacity"]=m),i.appendChild(et.create("stop",n,e))}g(t,i,"color")}return"url(#"+i.id+")"}(h):h.toCSS(!0):"array"===l?h.join(","):"lookup"===l?i.toSVG[h]:h}}),o.length&&(a.style=o.join(";")),1===a.opacity&&delete a.opacity,t._visible||(a.visibility="hidden"),et.set(i,a,e)}function f(t,e){return o||(o={ids:{},svgs:{}}),t&&o.svgs[e+"-"+(t._id||t.__id||(t.__id=c.get("svg")))]}function g(t,e,i){o||f();var n=o.ids[i]=(o.ids[i]||0)+1;e.id=i+"-"+n,o.svgs[i+"-"+(t._id||t.__id)]=e}function m(e,i){var n=e,r=null;if(o){for(var a in n="svg"===e.nodeName.toLowerCase()&&e,o.svgs)r||(n||(n=et.create("svg")).appendChild(e),r=n.insertBefore(et.create("defs"),n.firstChild)),r.appendChild(o.svgs[a]);o=null}return i.asString?(new t.XMLSerializer).serializeToString(n):n}function _(t,e,i){var n=u[t._class],r=n&&n(t,e);if(r){var a=e.onExport;a&&(r=a(t,r,e)||r);var s=JSON.stringify(t._data);s&&"{}"!==s&&"null"!==s&&r.setAttribute("data-paper-data",s)}return r&&d(t,r,i)}function b(t){return t||(t={}),e=new l(t.precision),t}x.inject({exportSVG:function(t){return m(_(this,t=b(t),!0),t)}}),y.inject({exportSVG:function(t){t=b(t);var n=this._children,a=this.getView(),s=r.pick(t.bounds,"view"),o=t.matrix||"view"===s&&a._matrix,l=o&&v.read([o]),h="view"===s?new p([0,0],a.getViewSize()):"content"===s?x._getBounds(n,l,{stroke:!0}).rect:p.read([s],0,{readNull:!0}),c={version:"1.1",xmlns:et.svg,"xmlns:xlink":et.xlink};h&&(c.width=h.width,c.height=h.height,(h.x||h.y)&&(c.viewBox=e.rectangle(h)));var u=et.create("svg",c,e),d=u;l&&!l.isIdentity()&&(d=u.appendChild(et.create("g",i(l),e)));for(var f=0,g=n.length;f<g;f++)d.appendChild(_(n[f],t,!0));return m(u,t)}})},new function(){var a,s={};function o(t,e,i,n,r){var s=et.get(t,e),o=null==s?n?null:i?"":0:i?s:parseFloat(s);return/%\s*$/.test(s)?o/100*(r?1:a[/x|^width/.test(e)?"width":"height"]):o}function l(t,e,i,n,r){return e=o(t,e||"x",!1,n,r),i=o(t,i||"y",!1,n,r),!n||null!=e&&null!=i?new u(e,i):null}function h(t,e,i,n,r){return e=o(t,e||"width",!1,n,r),i=o(t,i||"height",!1,n,r),!n||null!=e&&null!=i?new f(e,i):null}function c(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?D(t)||t:"lookup"===e?i[t]:t}function d(t,e,i,n){var r=t.childNodes,a="clippath"===e,s="defs"===e,o=new b,l=o._project,h=l._currentStyle,c=[];if(a||s||(o=k(o,t,n),l._currentStyle=o._style.clone()),n)for(var u=t.querySelectorAll("defs"),d=0,f=u.length;d<f;d++)P(u[d],i,!1);for(d=0,f=r.length;d<f;d++){var g,p=r[d];1!==p.nodeType||/^defs$/i.test(p.nodeName)||!(g=P(p,i,!1))||g instanceof M||c.push(g)}return o.addChildren(c),a&&(o=k(o.reduce(),t,n)),l._currentStyle=h,(a||s)&&(o.remove(),o=null),o}function g(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,a=i.length;r<a;r+=2)n.push(new u(parseFloat(i[r]),parseFloat(i[r+1])));var s=new z(n);return"polygon"===e&&s.closePath(),s}function m(t,e){var i,n=(o(t,"href",!0)||"").substring(1),r="radialgradient"===e;if(n)(i=s[n].getGradient())._radial^r&&((i=i.clone())._radial=r);else{for(var a=t.childNodes,h=[],c=0,u=a.length;c<u;c++){var d=a[c];1===d.nodeType&&h.push(k(new U,d))}i=new N(h,r)}var f,g,p,m="userSpaceOnUse"!==o(t,"gradientUnits",!0);return r?(g=(f=l(t,"cx","cy",!1,m)).add(o(t,"r",!1,!1,m),0),p=l(t,"fx","fy",!0,m)):(f=l(t,"x1","y1",!1,m),g=l(t,"x2","y2",!1,m)),k(new G(i,f,g,p),t)._scaleToBounds=m,null}var _={"#document":function(t,e,i,n){for(var r=t.childNodes,a=0,s=r.length;a<s;a++){var o=r[a];if(1===o.nodeType)return P(o,i,n)}},g:d,svg:d,clippath:d,polygon:g,polyline:g,path:function(t){return E.create(t.getAttribute("d"))},lineargradient:m,radialgradient:m,image:function(t){var e=new w(o(t,"href",!0));return e.on("load",function(){var e=h(t);this.setSize(e);var i=this._matrix._transformPoint(l(t).add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new M(d(t,e,i,n),!0)},defs:d,use:function(t){var e=(o(t,"href",!0)||"").substring(1),i=s[e],n=l(t);return i?i instanceof M?i.place(n):i.clone().translate(n):null},circle:function(t){return new C.Circle(l(t,"cx","cy"),o(t,"r"))},ellipse:function(t){return new C.Ellipse({center:l(t,"cx","cy"),radius:h(t,"rx","ry")})},rect:function(t){return new C.Rectangle(new p(l(t),h(t)),h(t,"rx","ry"))},line:function(t){return new z.Line(l(t,"x1","y1"),l(t,"x2","y2"))},text:function(t){var e=new F(l(t).add(l(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}};function I(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),a=new v,s=0,o=r.length;s<o;s++){var l=r[s];if(!l)break;for(var h=l.split(/\(\s*/),c=h[0],u=h[1].split(/[\s,]+/g),d=0,f=u.length;d<f;d++)u[d]=parseFloat(u[d]);switch(c){case"matrix":a.append(new v(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":a.rotate(u[0],u[1],u[2]);break;case"translate":a.translate(u[0],u[1]);break;case"scale":a.scale(u);break;case"skewX":a.skew(u[0],0);break;case"skewY":a.skew(0,u[0])}}t.transform(a)}}function S(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}var A=r.set(r.each(it,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](c(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n&&n._scaleToBounds){var r=e.getBounds();n.transform((new v).translate(r.getPoint()).scale(r.getSize()))}}}},{}),{id:function(t,e){s[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=D(e);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof b))return new b(i,t);t.insertChild(0,i)}},gradientTransform:I,transform:I,"fill-opacity":S,"stroke-opacity":S,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,r){var a,s=new p(c(e,"array")),o=h(n,null,null,!0);if(t instanceof b){var l=o?o.divide(s.getSize()):1,u=(new v).scale(l).translate(s.getPoint().negate());a=t}else t instanceof M&&(o&&s.setSize(o),a=t._item);if(a){if("visible"!==T(n,"overflow",r)){var d=new C.Rectangle(s);d.setClipMask(!0),a.addChild(d)}u&&a.transform(u)}}});function T(t,i,n){var a=t.attributes[i],s=a&&a.value;if(!s){var o=r.camelize(i);(s=t.style[o])||n.node[o]===n.parent[o]||(s=n.node[o])}return s?"none"===s?null:s:e}function k(t,i,n){if(i.style){var a=i.parentNode,s={node:Z.getStyles(i)||{},parent:!n&&!/^defs$/i.test(a.tagName)&&Z.getStyles(a)||{}};r.each(A,function(n,r){var a=T(i,r,s);t=a!==e&&n(t,a,r,i,s)||t})}return t}function D(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=e&&e[1],r=n&&s[i?n.replace(i.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function P(t,e,i){var o,l,c,u=t.nodeName.toLowerCase(),d="#document"!==u,f=n.body;i&&d&&(a=paper.getView().getSize(),a=h(t,null,null,!0)||a,o=et.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),l=t.parentNode,c=t.nextSibling,o.appendChild(t),f.appendChild(o));var g=paper.settings,p=g.applyMatrix,m=g.insertItems;g.applyMatrix=!1,g.insertItems=!1;var v=_[u],y=v&&v(t,u,e,i)||null;if(g.insertItems=m,g.applyMatrix=p,y){!d||y instanceof b||(y=k(y,t,i));var x=e.onImport,I=d&&t.getAttribute("data-paper-data");x&&(y=x(t,y,e)||y),e.expandShapes&&y instanceof C&&(y.remove(),y=y.toPath()),I&&(y._data=JSON.parse(I))}return o&&(f.removeChild(o),l&&(c?l.insertBefore(t,c):l.appendChild(t))),i&&(s={},y&&r.pick(e.applyMatrix,p)&&y.matrix.apply(!0,!0)),y}function O(i,r,a){if(!i)return null;r="function"==typeof r?{onLoad:r}:r||{};var s=paper,o=null;function l(n){try{var l="object"==typeof n?n:(new t.DOMParser).parseFromString(n,"image/svg+xml");if(!l.nodeName)throw l=null,new Error("Unsupported SVG source: "+i);paper=s,o=P(l,r,!0),r&&!1===r.insert||a._insertItem(e,o);var c=r.onLoad;c&&c(o,n)}catch(t){h(t)}}function h(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if("string"!=typeof i||/^.*</.test(i)){if("undefined"!=typeof File&&i instanceof File){var c=new FileReader;return c.onload=function(){l(c.result)},c.onerror=function(){h(c.error)},c.readAsText(i)}l(i)}else{var u=n.getElementById(i);u?l(u):K.request({url:i,async:!0,onLoad:l,onError:h})}return o}x.inject({importSVG:function(t,e){return O(t,e,this)}}),y.inject({importSVG:function(t,e){return this.activate(),O(t,e,this)}})},(paper=new(s.inject(r.exports,{Base:r,Numerical:h,Key:q,DomEvent:W,DomElement:Z,document:n,window:i,Symbol:M,PlacedSymbol:S}))).agent.node&&require("./node/extend.js")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);!function(){function t(t,e,i){return t.call.apply(t.bind,arguments)}function e(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function i(n,r,a){return(i=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:e).apply(null,arguments)}var n=Date.now||function(){return+new Date};function r(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var a=!!window.FontFace;function s(t,e,i,n){if(e=t.c.createElement(e),i)for(var r in i)i.hasOwnProperty(r)&&("style"==r?e.style.cssText=i[r]:e.setAttribute(r,i[r]));return n&&e.appendChild(t.c.createTextNode(n)),e}function o(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function h(t,e,i){e=e||[],i=i||[];for(var n=t.className.split(/\s+/),r=0;r<e.length;r+=1){for(var a=!1,s=0;s<n.length;s+=1)if(e[r]===n[s]){a=!0;break}a||n.push(e[r])}for(e=[],r=0;r<n.length;r+=1){for(a=!1,s=0;s<i.length;s+=1)if(n[r]===i[s]){a=!0;break}a||e.push(n[r])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function c(t,e){for(var i=t.className.split(/\s+/),n=0,r=i.length;n<r;n++)if(i[n]==e)return!0;return!1}function u(t,e,i){function n(){c&&r&&l&&(c(h),c=null)}e=s(t,"link",{rel:"stylesheet",href:e,media:"all"});var r=!1,l=!0,h=null,c=i||null;a?(e.onload=function(){r=!0,n()},e.onerror=function(){r=!0,h=Error("Stylesheet failed to load"),n()}):setTimeout(function(){r=!0,n()},0),o(t,"head",e)}function d(t,e,i,n){var r=t.c.getElementsByTagName("head")[0];if(r){var a=s(t,"script",{src:e}),o=!1;return a.onload=a.onreadystatechange=function(){o||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(o=!0,i&&i(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&r.removeChild(a))},r.appendChild(a),setTimeout(function(){o||(o=!0,i&&i(Error("Script load timeout")))},n||5e3),a}return null}function f(){this.a=0,this.c=null}function g(t){return t.a++,function(){t.a--,m(t)}}function p(t,e){t.c=e,m(t)}function m(t){0==t.a&&t.c&&(t.c(),t.c=null)}function v(t){this.a=t||"-"}function _(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function y(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var n=t[i].replace(/["]/g,"");-1!=n.indexOf(" ")||/^\d/.test(n)?e.push('"'+n+'"'):e.push(n)}return e.join(",")}function x(t){return t.a+t.f}function b(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function I(t){var e=4,i="n",n=null;return t&&((n=t.match(/(normal|oblique|italic)/i))&&n[1]&&(i=n[1].substr(0,1).toLowerCase()),(n=t.match(/([1-9]00|normal|bold)/i))&&n[1]&&(/bold/i.test(n[1])?e=7:/[1-9]00/.test(n[1])&&(e=parseInt(n[1].substr(0,1),10)))),i+e}function C(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new v("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function w(t){if(t.g){var e=c(t.f,t.a.c("wf","active")),i=[],n=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),h(t.f,i,n)}S(t,"inactive")}function S(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,x(i)):t.h[e]())}function M(){this.c={}}function A(t,e){this.c=t,this.f=e,this.a=s(this.c,"span",{"aria-hidden":"true"},this.f)}function T(t){o(t.c,"body",t.a)}function k(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+y(t.c)+";font-style:"+b(t)+";font-weight:"+t.f+"00;"}function D(t,e,i,n,r,a){this.g=t,this.j=e,this.a=n,this.c=i,this.f=r||3e3,this.h=a||void 0}function P(t,e,i,n,r,a,s){this.v=t,this.B=e,this.c=i,this.a=n,this.s=s||"BESbswy",this.f={},this.w=r||3e3,this.u=a||null,this.m=this.j=this.h=this.g=null,this.g=new A(this.c,this.s),this.h=new A(this.c,this.s),this.j=new A(this.c,this.s),this.m=new A(this.c,this.s),t=k(t=new _(this.a.c+",serif",x(this.a))),this.g.a.style.cssText=t,t=k(t=new _(this.a.c+",sans-serif",x(this.a))),this.h.a.style.cssText=t,t=k(t=new _("serif",x(this.a))),this.j.a.style.cssText=t,t=k(t=new _("sans-serif",x(this.a))),this.m.a.style.cssText=t,T(this.g),T(this.h),T(this.j),T(this.m)}v.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},D.prototype.start=function(){var t=this.c.o.document,e=this,i=n(),r=new Promise(function(r,a){!function s(){n()-i>=e.f?a():t.fonts.load(function(t){return b(t)+" "+t.f+"00 300px "+y(t.c)}(e.a),e.h).then(function(t){1<=t.length?r():setTimeout(s,25)},function(){a()})}()}),a=null,s=new Promise(function(t,i){a=setTimeout(i,e.f)});Promise.race([s,r]).then(function(){a&&(clearTimeout(a),a=null),e.g(e.a)},function(){e.j(e.a)})};var E={D:"serif",C:"sans-serif"},z=null;function O(){if(null===z){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);z=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return z}function B(t,e,i){for(var n in E)if(E.hasOwnProperty(n)&&e===t.f[E[n]]&&i===t.f[E[n]])return!0;return!1}function R(t){var e,r=t.g.a.offsetWidth,a=t.h.a.offsetWidth;(e=r===t.f.serif&&a===t.f["sans-serif"])||(e=O()&&B(t,r,a)),e?n()-t.A>=t.w?O()&&B(t,r,a)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?L(t,t.v):L(t,t.B):function(t){setTimeout(i(function(){R(this)},t),50)}(t):L(t,t.v)}function L(t,e){setTimeout(i(function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),e(this.a)},t),0)}function F(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}P.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=n(),R(this)};var G=null;function N(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&h(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),S(t,"active")):w(t.a))}function U(t){this.j=t,this.a=new M,this.h=0,this.f=this.g=!0}function j(t,e,n,r,a){var s=0==--t.h;(t.f||t.g)&&setTimeout(function(){var t=a||null,o=r||{};if(0===n.length&&s)w(e.a);else{e.f+=n.length,s&&(e.j=s);var l,c=[];for(l=0;l<n.length;l++){var u=n[l],d=o[u.c],f=e.a,g=u;if(f.g&&h(f.f,[f.a.c("wf",g.c,x(g).toString(),"loading")]),S(f,"fontloading",g),f=null,null===G)if(window.FontFace){g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var p=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);G=g?42<parseInt(g[1],10):!p}else G=!1;f=G?new D(i(e.g,e),i(e.h,e),e.c,u,e.s,d):new P(i(e.g,e),i(e.h,e),e.c,u,e.s,t,d),c.push(f)}for(l=0;l<c.length;l++)c[l].start()}},0)}function Z(t,e){this.c=t,this.a=e}function W(t,e){this.c=t,this.a=e}function V(t,e){this.c=t||X,this.a=[],this.f=[],this.g=e||""}F.prototype.g=function(t){var e=this.a;e.g&&h(e.f,[e.a.c("wf",t.c,x(t).toString(),"active")],[e.a.c("wf",t.c,x(t).toString(),"loading"),e.a.c("wf",t.c,x(t).toString(),"inactive")]),S(e,"fontactive",t),this.m=!0,N(this)},F.prototype.h=function(t){var e=this.a;if(e.g){var i=c(e.f,e.a.c("wf",t.c,x(t).toString(),"active")),n=[],r=[e.a.c("wf",t.c,x(t).toString(),"loading")];i||n.push(e.a.c("wf",t.c,x(t).toString(),"inactive")),h(e.f,n,r)}S(e,"fontinactive",t),N(this)},U.prototype.load=function(t){this.c=new r(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var n=[],r=i.timeout;!function(t){t.g&&h(t.f,[t.a.c("wf","loading")]),S(t,"loading")}(e);var n=function(t,e,i){var n,r=[];for(n in e)if(e.hasOwnProperty(n)){var a=t.c[n];a&&r.push(a(e[n],i))}return r}(t.a,i,t.c),a=new F(t.c,e,r);for(t.h=n.length,e=0,i=n.length;e<i;e++)n[e].load(function(e,i,n){j(t,a,e,i,n)})}(this,new C(this.c,t),t)},Z.prototype.load=function(t){var e=this,i=e.a.projectId,n=e.a.version;if(i){var r=e.c.o;d(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(n?"?v="+n:""),function(n){n?t([]):(r["__MonotypeConfiguration__"+i]=function(){return e.a},function e(){if(r["__mti_fntLst"+i]){var n,a=r["__mti_fntLst"+i](),s=[];if(a)for(var o=0;o<a.length;o++){var l=a[o].fontfamily;null!=a[o].fontStyle&&null!=a[o].fontWeight?(n=a[o].fontStyle+a[o].fontWeight,s.push(new _(l,n))):s.push(new _(l))}t(s)}else setTimeout(function(){e()},50)}())}).id="__MonotypeAPIScript__"+i}else t([])},W.prototype.load=function(t){var e,i,n=this.a.urls||[],r=this.a.families||[],a=this.a.testStrings||{},s=new f;for(e=0,i=n.length;e<i;e++)u(this.c,n[e],g(s));var o=[];for(e=0,i=r.length;e<i;e++)if((n=r[e].split(":"))[1])for(var l=n[1].split(","),h=0;h<l.length;h+=1)o.push(new _(n[0],l[h]));else o.push(new _(n[0]));p(s,function(){t(o,a)})};var X="https://fonts.googleapis.com/css";function Y(t){this.f=t,this.a=[],this.c={}}var H={latin:"BESbswy","latin-ext":"",cyrillic:"",greek:"",khmer:"",Hanuman:""},q={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},J={i:"i",italic:"i",n:"n",normal:"n"},Q=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function K(t,e){this.c=t,this.a=e}var $={Arimo:!0,Cousine:!0,Tinos:!0};function tt(t,e){this.c=t,this.a=e}function et(t,e){this.c=t,this.f=e,this.a=[]}K.prototype.load=function(t){var e=new f,i=this.c,n=new V(this.a.api,this.a.text),r=this.a.families;!function(t,e){for(var i=e.length,n=0;n<i;n++){var r=e[n].split(":");3==r.length&&t.f.push(r.pop());var a="";2==r.length&&""!=r[1]&&(a=":"),t.a.push(r.join(a))}}(n,r);var a=new Y(r);!function(t){for(var e=t.f.length,i=0;i<e;i++){var n=t.f[i].split(":"),r=n[0].replace(/\+/g," "),a=["n4"];if(2<=n.length){var s;if(s=[],o=n[1])for(var o,l=(o=o.split(",")).length,h=0;h<l;h++){var c;if((c=o[h]).match(/^[\w-]+$/))if(null==(d=Q.exec(c.toLowerCase())))c="";else{if(c=null==(c=d[2])||""==c?"n":J[c],null==(d=d[1])||""==d)d="4";else var u=q[d],d=u||(isNaN(d)?"4":d.substr(0,1));c=[c,d].join("")}else c="";c&&s.push(c)}0<s.length&&(a=s),3==n.length&&(s=[],0<(n=(n=n[2])?n.split(","):s).length&&(n=H[n[0]])&&(t.c[r]=n))}for(t.c[r]||(n=H[r])&&(t.c[r]=n),n=0;n<a.length;n+=1)t.a.push(new _(r,a[n]))}}(a),u(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],n=0;n<e;n++)i.push(t.a[n].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(n),g(e)),p(e,function(){t(a.a,a.c,$)})},tt.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?d(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var n=[],r=0;r<e.length;r+=2)for(var a=e[r],s=e[r+1],o=0;o<s.length;o++)n.push(new _(a,s[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(n)}},2e3):t([])},et.prototype.load=function(t){var e=this.f.id,i=this.c.o,n=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var r=0,a=i.fonts.length;r<a;++r){var s=i.fonts[r];n.a.push(new _(s.name,I("font-weight:"+s.weight+";font-style:"+s.style)))}t(n.a)},d(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",function(e){e&&t([])})):t([])};var it=new U(window);it.a.c.custom=function(t,e){return new W(e,t)},it.a.c.fontdeck=function(t,e){return new et(e,t)},it.a.c.monotype=function(t,e){return new Z(e,t)},it.a.c.typekit=function(t,e){return new tt(e,t)},it.a.c.google=function(t,e){return new K(e,t)};var nt={load:i(it.load,it)};"function"==typeof define&&define.amd?define(function(){return nt}):"undefined"!=typeof module&&module.exports?module.exports=nt:(window.WebFont=nt,window.WebFontConfig&&it.load(window.WebFontConfig))}();var LZString=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function r(t,e){if(!n[t]){n[t]={};for(var i=0;i<t.length;i++)n[t][t.charAt(i)]=i}return n[t][e]}var a={compressToBase64:function(t){if(null==t)return"";var i=a._compress(t,6,function(t){return e.charAt(t)});switch(i.length%4){default:case 0:return i;case 1:return i+"===";case 2:return i+"==";case 3:return i+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:a._decompress(t.length,32,function(i){return r(e,t.charAt(i))})},compressToUTF16:function(e){return null==e?"":a._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:a._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=a.compress(t),i=new Uint8Array(2*e.length),n=0,r=e.length;n<r;n++){var s=e.charCodeAt(n);i[2*n]=s>>>8,i[2*n+1]=s%256}return i},decompressFromUint8Array:function(e){if(null==e)return a.decompress(e);for(var i=new Array(e.length/2),n=0,r=i.length;n<r;n++)i[n]=256*e[2*n]+e[2*n+1];var s=[];return i.forEach(function(e){s.push(t(e))}),a.decompress(s.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":a._compress(t,6,function(t){return i.charAt(t)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),a._decompress(t.length,32,function(e){return r(i,t.charAt(e))}))},compress:function(e){return a._compress(e,16,function(e){return t(e)})},_compress:function(t,e,i){if(null==t)return"";var n,r,a,s={},o={},l="",h="",c="",u=2,d=3,f=2,g=[],p=0,m=0;for(a=0;a<t.length;a+=1)if(l=t.charAt(a),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=d++,o[l]=!0),h=c+l,Object.prototype.hasOwnProperty.call(s,h))c=h;else{if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(n=0;n<f;n++)p<<=1,m==e-1?(m=0,g.push(i(p)),p=0):m++;for(r=c.charCodeAt(0),n=0;n<8;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}else{for(r=1,n=0;n<f;n++)p=p<<1|r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r=0;for(r=c.charCodeAt(0),n=0;n<16;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}0==--u&&(u=Math.pow(2,f),f++),delete o[c]}else for(r=s[c],n=0;n<f;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1;0==--u&&(u=Math.pow(2,f),f++),s[h]=d++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(n=0;n<f;n++)p<<=1,m==e-1?(m=0,g.push(i(p)),p=0):m++;for(r=c.charCodeAt(0),n=0;n<8;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}else{for(r=1,n=0;n<f;n++)p=p<<1|r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r=0;for(r=c.charCodeAt(0),n=0;n<16;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}0==--u&&(u=Math.pow(2,f),f++),delete o[c]}else for(r=s[c],n=0;n<f;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1;0==--u&&(u=Math.pow(2,f),f++)}for(r=2,n=0;n<f;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1;for(;;){if(p<<=1,m==e-1){g.push(i(p));break}m++}return g.join("")},decompress:function(t){return null==t?"":""==t?null:a._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,i,n){var r,a,s,o,l,h,c,u=[],d=4,f=4,g=3,p="",m=[],v={val:n(0),position:i,index:1};for(r=0;r<3;r+=1)u[r]=r;for(s=0,l=Math.pow(2,2),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),s|=(o>0?1:0)*h,h<<=1;switch(s){case 0:for(s=0,l=Math.pow(2,8),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),s|=(o>0?1:0)*h,h<<=1;c=t(s);break;case 1:for(s=0,l=Math.pow(2,16),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),s|=(o>0?1:0)*h,h<<=1;c=t(s);break;case 2:return""}for(u[3]=c,a=c,m.push(c);;){if(v.index>e)return"";for(s=0,l=Math.pow(2,g),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),s|=(o>0?1:0)*h,h<<=1;switch(c=s){case 0:for(s=0,l=Math.pow(2,8),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),s|=(o>0?1:0)*h,h<<=1;u[f++]=t(s),c=f-1,d--;break;case 1:for(s=0,l=Math.pow(2,16),h=1;h!=l;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),s|=(o>0?1:0)*h,h<<=1;u[f++]=t(s),c=f-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,g),g++),u[c])p=u[c];else{if(c!==f)return null;p=a+a.charAt(0)}m.push(p),u[f++]=a+p.charAt(0),a=p,0==--d&&(d=Math.pow(2,g),g++)}}};return a}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module?module.exports=LZString:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return LZString}),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function t(e,i,n){function r(s,o){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){return r(e[s][1][t]||t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){"use strict";var n=t("./utils"),r=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,r,s,o,l,h,c=[],u=0,d=t.length,f=d,g="string"!==n.getTypeOf(t);u<t.length;)f=d-u,r=g?(e=t[u++],i=u<d?t[u++]:0,u<d?t[u++]:0):(e=t.charCodeAt(u++),i=u<d?t.charCodeAt(u++):0,u<d?t.charCodeAt(u++):0),s=e>>2,o=(3&e)<<4|i>>4,l=1<f?(15&i)<<2|r>>6:64,h=2<f?63&r:64,c.push(a.charAt(s)+a.charAt(o)+a.charAt(l)+a.charAt(h));return c.join("")},i.decode=function(t){var e,i,n,s,o,l,h=0,c=0,u="data:";if(t.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var d,f=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===a.charAt(64)&&f--,t.charAt(t.length-2)===a.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=r.uint8array?new Uint8Array(0|f):new Array(0|f);h<t.length;)e=a.indexOf(t.charAt(h++))<<2|(s=a.indexOf(t.charAt(h++)))>>4,i=(15&s)<<4|(o=a.indexOf(t.charAt(h++)))>>2,n=(3&o)<<6|(l=a.indexOf(t.charAt(h++))),d[c++]=e,64!==o&&(d[c++]=i),64!==l&&(d[c++]=n);return d}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";var n=t("./external"),r=t("./stream/DataWorker"),a=t("./stream/DataLengthProbe"),s=t("./stream/Crc32Probe");function o(t,e,i,n,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=n,this.compressedContent=r}a=t("./stream/DataLengthProbe"),o.prototype={getContentWorker:function(){var t=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,i){return t.pipe(new s).pipe(new a("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";var n=t("./utils"),r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function(t,e,i,n){var a=r,s=0+i;t^=-1;for(var o=0;o<s;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}(0|e,t,t.length):function(t,e,i,n){var a=r,s=0+i;t^=-1;for(var o=0;o<s;o++)t=t>>>8^a[255&(t^e.charCodeAt(o))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var n;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:37}],7:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),a=t("./utils"),s=t("./stream/GenericWorker"),o=n?"uint8array":"array";function l(t,e){s.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",a.inherits(l,s),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(o,t.data),!1)},l.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new l("Deflate",t)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,i){"use strict";function n(t,e){var i,n="";for(i=0;i<e;i++)n+=String.fromCharCode(255&t),t>>>=8;return n}function r(t,e,i,r,s,c){var u,d,f=t.file,g=t.compression,p=c!==o.utf8encode,m=a.transformTo("string",c(f.name)),v=a.transformTo("string",o.utf8encode(f.name)),_=f.comment,y=a.transformTo("string",c(_)),x=a.transformTo("string",o.utf8encode(_)),b=v.length!==f.name.length,I=x.length!==_.length,C="",w="",S="",M=f.dir,A=f.date,T={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(T.crc32=t.crc32,T.compressedSize=t.compressedSize,T.uncompressedSize=t.uncompressedSize);var k=0;e&&(k|=8),p||!b&&!I||(k|=2048);var D=0,P=0;M&&(D|=16),"UNIX"===s?(P=798,D|=function(t,e){var i=t;return t||(i=M?16893:33204),(65535&i)<<16}(f.unixPermissions)):(P=20,D|=63&(f.dosPermissions||0)),u=A.getUTCHours(),u<<=6,u|=A.getUTCMinutes(),u<<=5,u|=A.getUTCSeconds()/2,d=A.getUTCFullYear()-1980,d<<=4,d|=A.getUTCMonth()+1,d<<=5,d|=A.getUTCDate(),b&&(w=n(1,1)+n(l(m),4)+v,C+="up"+n(w.length,2)+w),I&&(S=n(1,1)+n(l(y),4)+x,C+="uc"+n(S.length,2)+S);var E="";return E+="\n\0",E+=n(k,2),E+=g.magic,E+=n(u,2),E+=n(d,2),E+=n(T.crc32,4),E+=n(T.compressedSize,4),E+=n(T.uncompressedSize,4),E+=n(m.length,2),E+=n(C.length,2),{fileRecord:h.LOCAL_FILE_HEADER+E+m+C,dirRecord:h.CENTRAL_FILE_HEADER+n(P,2)+E+n(y.length,2)+"\0\0\0\0"+n(D,4)+n(r,4)+m+C+y}}var a=t("../utils"),s=t("../stream/GenericWorker"),o=t("../utf8"),l=t("../crc32"),h=t("../signature");function c(t,e,i,n){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(c,s),c.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,s.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-n-1))/i:100}}))},c.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=r(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=r(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:function(t){return h.DATA_DESCRIPTOR+n(t.crc32,4)+n(t.compressedSize,4)+n(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,r=function(t,e,i,r,s){var o=a.transformTo("string",s(r));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(t,2)+n(t,2)+n(e,4)+n(i,4)+n(o.length,2)+o}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},c.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(t){var e=this._sources;if(!s.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},c.prototype.lock=function(){s.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(t,e,i){var a=new r(e.streamFiles,i,e.platform,e.encodeFileName),s=0;try{t.forEach(function(t,i){s++;var r=function(t,e){var i=t||e,r=n[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,e.compression),o=i.options.compressionOptions||e.compressionOptions||{},l=i.dir,h=i.date;i._compressWorker(r,o).withStreamInfo("file",{name:t,dir:l,date:h,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(a)}),a.entriesCount=s}catch(t){a.error(t)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.2.0",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";var n=t("./utils"),r=t("./external"),a=t("./utf8"),s=(n=t("./utils"),t("./zipEntries")),o=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function h(t){return new r.Promise(function(e,i){var n=t.decompressed.getContentWorker().pipe(new o);n.on("error",function(t){i(t)}).on("end",function(){n.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var i=this;return e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var i=new s(e);return i.load(t),i}).then(function(t){var i=[r.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var a=0;a<n.length;a++)i.push(h(n[a]));return r.Promise.all(i)}).then(function(t){for(var n=t.shift(),r=n.files,a=0;a<r.length;a++){var s=r[a];i.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:e.createFolders})}return n.zipComment.length&&(i.comment=n.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../stream/GenericWorker");function a(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(a,r),a.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";var n=t("readable-stream").Readable;function r(t,e,i){n.call(this,e),this._helper=t;var r=this;t.on("data",function(t,e){r.push(t)||r._helper.pause(),i&&i(e)}).on("error",function(t){r.emit("error",t)}).on("end",function(){r.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function n(t,e,i){var n,r=a.getTypeOf(e),o=a.extend(i||{},l);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(t=p(t)),o.createFolders&&(n=g(t))&&m.call(this,n,!0);var u="string"===r&&!1===o.binary&&!1===o.base64;i&&void 0!==i.binary||(o.binary=!u),(e instanceof h&&0===e.uncompressedSize||o.dir||!e||0===e.length)&&(o.base64=!1,o.binary=!0,e="",o.compression="STORE",r="string");var v;v=e instanceof h||e instanceof s?e:d.isNode&&d.isStream(e)?new f(t,e):a.prepareContent(t,e,o.binary,o.optimizedBinaryString,o.base64);var _=new c(t,v,o);this.files[t]=_}var r=t("./utf8"),a=t("./utils"),s=t("./stream/GenericWorker"),o=t("./stream/StreamHelper"),l=t("./defaults"),h=t("./compressedObject"),c=t("./zipObject"),u=t("./generate"),d=t("./nodejsUtils"),f=t("./nodejs/NodejsStreamInputAdapter"),g=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},p=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:l.createFolders,t=p(t),this.files[t]||n.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function v(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,n;for(e in this.files)this.files.hasOwnProperty(e)&&(n=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,n))},filter:function(t){var e=[];return this.forEach(function(i,n){t(i,n)&&e.push(n)}),e},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,n.call(this,t,e,i),this;if(v(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}var a=this.files[this.root+t];return a&&!a.dir?a:null},folder:function(t){if(!t)return this;if(v(t))return this.filter(function(e,i){return i.dir&&t.test(e)});var e=this.root+t,i=m.call(this,e),n=this.clone();return n.root=i.name,n},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter(function(e,i){return i.name.slice(0,t.length)===t}),n=0;n<i.length;n++)delete this.files[i[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=a.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");a.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var n=i.comment||this.comment||"";e=u.generateWorker(this,i,n)}catch(t){(e=new s("error")).error(t)}return new o(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";var n=t("./DataReader");function r(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,n),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===e&&this.data[a+1]===i&&this.data[a+2]===n&&this.data[a+3]===r)return a-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),a=this.readData(4);return e===a[0]&&i===a[1]&&n===a[2]&&r===a[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";var n=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,i){"use strict";var n=t("./Uint8ArrayReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";var n=t("./DataReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";var n=t("./ArrayReader");function r(t){n.call(this,t)}t("../utils").inherits(r,n),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../support"),a=t("./ArrayReader"),s=t("./StringReader"),o=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new o(t):r.uint8array?new l(n.transformTo("uint8array",t)):new a(n.transformTo("array",t)):new s(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";var n=t("./GenericWorker"),r=t("../utils");function a(t){n.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(a,n),a.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";var n=t("./GenericWorker"),r=t("../crc32");function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,n),a.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./GenericWorker");function a(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(a,r),a.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./GenericWorker");function a(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./ConvertWorker"),a=t("./GenericWorker"),s=t("../base64"),o=t("../support"),l=t("../external"),h=null;if(o.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function c(t,e,i){var s=e;switch(e){case"blob":case"arraybuffer":s="uint8array";break;case"base64":s="string"}try{this._internalType=s,this._outputType=e,this._mimeType=i,n.checkSupport(s),this._worker=t.pipe(new r(s)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return function(t,e){return new l.Promise(function(i,r){var a=[],o=t._internalType,l=t._outputType,h=t._mimeType;t.on("data",function(t,i){a.push(t),e&&e(i)}).on("error",function(t){a=[],r(t)}).on("end",function(){try{var t=function(t,e,i){switch(t){case"blob":return n.newBlob(n.transformTo("arraybuffer",e),i);case"base64":return s.encode(e);default:return n.transformTo(t,e)}}(l,function(t,e){var i,n=0,r=null,a=0;for(i=0;i<e.length;i++)a+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(a),i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,a),h);i(t)}catch(t){r(t)}a=[]}).resume()})}(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,function(t){e.call(i,t.data,t.meta)}):this._worker.on(t,function(){n.delay(e,arguments,i)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=0===r.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";for(var n=t("./utils"),r=t("./support"),a=t("./nodejsUtils"),s=t("./stream/GenericWorker"),o=new Array(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function h(){s.call(this,"utf-8 decode"),this.leftOver=null}function c(){s.call(this,"utf-8 encode")}o[254]=o[254]=1,i.utf8encode=function(t){return r.nodebuffer?a.newBufferFrom(t,"utf-8"):function(t){var e,i,n,a,s,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=r.uint8array?new Uint8Array(l):new Array(l),a=s=0;s<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),i<128?e[s++]=i:(i<2048?e[s++]=192|i>>>6:(i<65536?e[s++]=224|i>>>12:(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63),e[s++]=128|i>>>6&63),e[s++]=128|63&i);return e}(t)},i.utf8decode=function(t){return r.nodebuffer?n.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,r,a,s=t.length,l=new Array(2*s);for(e=i=0;e<s;)if((r=t[e++])<128)l[i++]=r;else if(4<(a=o[r]))l[i++]=65533,e+=a-1;else{for(r&=2===a?31:3===a?15:7;1<a&&e<s;)r=r<<6|63&t[e++],a--;1<a?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),n.applyFromCharCode(l)}(t=n.transformTo(r.uint8array?"uint8array":"array",t))},n.inherits(h,s),h.prototype.processChunk=function(t){var e=n.transformTo(r.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var a=e;(e=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),e.set(a,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var s=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+o[t[i]]>e?i:e}(e),l=e;s!==e.length&&(r.uint8array?(l=e.subarray(0,s),this.leftOver=e.subarray(s,e.length)):(l=e.slice(0,s),this.leftOver=e.slice(s,e.length))),this.push({data:i.utf8decode(l),meta:t.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,n.inherits(c,s),c.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";var n=t("./support"),r=t("./base64"),a=t("./nodejsUtils"),s=t("set-immediate-shim"),o=t("./external");function l(t){return t}function h(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,i){var n=[],r=0,a=t.length;if(a<=i)return String.fromCharCode.apply(null,t);for(;r<a;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+i,a)))):n.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+i,a)))),r+=i;return n.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(t){return!1}}()}};function u(t){var e=65536,n=i.getTypeOf(t),r=!0;if("uint8array"===n?r=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(r=c.applyCanBeUsed.nodebuffer),r)for(;1<e;)try{return c.stringifyByChunk(t,n,e)}catch(t){e=Math.floor(e/2)}return c.stringifyByChar(t)}function d(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}i.applyFromCharCode=u;var f={};f.string={string:l,array:function(t){return h(t,new Array(t.length))},arraybuffer:function(t){return f.string.uint8array(t).buffer},uint8array:function(t){return h(t,new Uint8Array(t.length))},nodebuffer:function(t){return h(t,a.allocBuffer(t.length))}},f.array={string:u,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(t)}},f.arraybuffer={string:function(t){return u(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(new Uint8Array(t))}},f.uint8array={string:u,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return a.newBufferFrom(t)}},f.nodebuffer={string:u,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return f.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:l},i.transformTo=function(t,e){if(e=e||"",!t)return e;i.checkSupport(t);var n=i.getTypeOf(e);return f[n][t](e)},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":n.nodebuffer&&a.isBuffer(t)?"nodebuffer":n.uint8array&&t instanceof Uint8Array?"uint8array":n.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!n[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,n="";for(i=0;i<(t||"").length;i++)n+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return n},i.delay=function(t,e,i){s(function(){t.apply(i||null,e||[])})},i.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,a,s,l){return o.Promise.resolve(e).then(function(t){return n.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new o.Promise(function(e,i){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){i(t.target.error)},n.readAsArrayBuffer(t)}):t}).then(function(e){var c=i.getTypeOf(e);return c?("arraybuffer"===c?e=i.transformTo("uint8array",e):"string"===c&&(l?e=r.decode(e):a&&!0!==s&&(e=function(t){return h(t,n.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):o.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,i){"use strict";var n=t("./reader/readerFor"),r=t("./utils"),a=t("./signature"),s=t("./zipEntry"),o=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;return this.reader.setIndex(i),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.uint8array?"uint8array":"array",i=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(t=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=e-i;if(0<n)this.isSignature(e,a.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";var n=t("./reader/readerFor"),r=t("./utils"),a=t("./compressedObject"),s=t("./crc32"),o=t("./utf8"),l=t("./compressions"),h=t("./support");function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,n,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<r;)e=t.readInt(2),i=t.readInt(2),n=t.readData(i),this.extraFields[e]={id:e,length:i,value:n}},handleUTF8:function(){var t=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=r.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var a=r.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:s(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:s(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";function n(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var r=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),s=t("./utf8"),o=t("./compressedObject"),l=t("./stream/GenericWorker");n.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var n="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!n&&(e=e.pipe(new s.Utf8EncodeWorker)),!a&&n&&(e=e.pipe(new s.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new r(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof o&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)n.prototype[h[u]]=c;e.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){(function(t){"use strict";var i,n,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var a=0,s=new r(c),o=t.document.createTextNode("");s.observe(o,{characterData:!0}),i=function(){o.data=a=++a%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var l=new t.MessageChannel;l.port1.onmessage=c,i=function(){l.port2.postMessage(0)}}var h=[];function c(){var t,e;n=!0;for(var i=h.length;i;){for(e=h,h=[],t=-1;++t<i;)e[t]();i=h.length}n=!1}e.exports=function(t){1!==h.push(t)||n||i()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,i){"use strict";var n=t("immediate");function r(){}var a={},s=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==r&&f(this,t)}function c(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function u(t,e,i){n(function(){var n;try{n=e(i)}catch(n){return a.reject(t,n)}n===t?a.reject(t,new TypeError("Cannot resolve promise with itself")):a.resolve(t,n)})}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function f(t,e){var i=!1;function n(e){i||(i=!0,a.reject(t,e))}function r(e){i||(i=!0,a.resolve(t,e))}var s=g(function(){e(r,n)});"error"===s.status&&n(s.value)}function g(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=h).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){throw i})})},h.prototype.catch=function(t){return this.then(null,t)},h.prototype.then=function(t,e){if("function"!=typeof t&&this.state===o||"function"!=typeof e&&this.state===s)return this;var i=new this.constructor(r);return this.state!==l?u(i,this.state===o?t:e,this.outcome):this.queue.push(new c(i,t,e)),i},c.prototype.callFulfilled=function(t){a.resolve(this.promise,t)},c.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},c.prototype.callRejected=function(t){a.reject(this.promise,t)},c.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},a.resolve=function(t,e){var i=g(d,e);if("error"===i.status)return a.reject(t,i.value);var n=i.value;if(n)f(t,n);else{t.state=o,t.outcome=e;for(var r=-1,s=t.queue.length;++r<s;)t.queue[r].callFulfilled(e)}return t},a.reject=function(t,e){t.state=s,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},h.resolve=function(t){return t instanceof this?t:a.resolve(new this(r),t)},h.reject=function(t){var e=new this(r);return a.reject(e,t)},h.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var s=new Array(i),o=0,l=-1,h=new this(r);++l<i;)c(t[l],l);return h;function c(t,r){e.resolve(t).then(function(t){s[r]=t,++o!==i||n||(n=!0,a.resolve(h,s))},function(t){n||(n=!0,a.reject(h,t))})}},h.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);for(var n,s=-1,o=new this(r);++s<e;)n=t[s],this.resolve(n).then(function(t){i||(i=!0,a.resolve(o,t))},function(t){i||(i=!0,a.reject(o,t))});return o}},{immediate:36}],38:[function(t,e,i){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,i){"use strict";var n=t("./zlib/deflate"),r=t("./utils/common"),a=t("./utils/strings"),s=t("./zlib/messages"),o=t("./zlib/zstream"),l=Object.prototype.toString,h=0,c=-1,u=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=r.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==h)throw new Error(s[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var g;if(g="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=n.deflateSetDictionary(this.strm,g))!==h)throw new Error(s[i]);this._dict_set=!0}}function g(t,e){var i=new f(e);if(i.push(t,!0),i.err)throw i.msg||s[i.err];return i.result}f.prototype.push=function(t,e){var i,s,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(c),o.next_out=0,o.avail_out=c),1!==(i=n.deflate(o,s))&&i!==h)return this.onEnd(i),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==s||(this.onEnd(h),!(o.avail_out=0))},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=f,i.deflate=g,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,g(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,g(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,i){"use strict";var n=t("./zlib/inflate"),r=t("./utils/common"),a=t("./utils/strings"),s=t("./zlib/constants"),o=t("./zlib/messages"),l=t("./zlib/zstream"),h=t("./zlib/gzheader"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==s.Z_OK)throw new Error(o[i]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function d(t,e){var i=new u(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}u.prototype.push=function(t,e){var i,o,l,h,u,d,f=this.strm,g=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?f.input=a.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?f.input=new Uint8Array(t):f.input=t,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new r.Buf8(g),f.next_out=0,f.avail_out=g),(i=n.inflate(f,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(d="string"==typeof p?a.string2buf(p):"[object ArrayBuffer]"===c.call(p)?new Uint8Array(p):p,i=n.inflateSetDictionary(this.strm,d)),i===s.Z_BUF_ERROR&&!0===m&&(i=s.Z_OK,m=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&i!==s.Z_STREAM_END&&(0!==f.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(f.output,f.next_out),h=f.next_out-l,u=a.buf2string(f.output,l),f.next_out=h,f.avail_out=g-h,h&&r.arraySet(f.output,f.output,l,h,0),this.onData(u)):this.onData(r.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(m=!0)}while((0<f.avail_in||0===f.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(f.avail_out=0))},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=u,i.inflate=d,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},i.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){var e,i,n,r,a,s;for(e=n=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),e=r=0,i=t.length;e<i;e++)a=t[e],s.set(a,r),r+=a.length;return s}},a={arraySet:function(t,e,i,n,r){for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(n)},{}],42:[function(t,e,i){"use strict";var n=t("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function l(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}s[254]=s[254]=1,i.string2buf=function(t){var e,i,r,a,s,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),a=s=0;s<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),i<128?e[s++]=i:(i<2048?e[s++]=192|i>>>6:(i<65536?e[s++]=224|i>>>12:(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63),e[s++]=128|i>>>6&63),e[s++]=128|63&i);return e},i.buf2binstring=function(t){return l(t,t.length)},i.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,n,r,a,o=e||t.length,h=new Array(2*o);for(i=n=0;i<o;)if((r=t[i++])<128)h[n++]=r;else if(4<(a=s[r]))h[n++]=65533,i+=a-1;else{for(r&=2===a?31:3===a?15:7;1<a&&i<o;)r=r<<6|63&t[i++],a--;1<a?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return l(h,n)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+s[t[i]]>e?i:e}},{"./common":41}],43:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){for(var r=65535&t|0,a=t>>>16&65535|0,s=0;0!==i;){for(i-=s=2e3<i?2e3:i;a=a+(r=r+e[n++]|0)|0,--s;);r%=65521,a%=65521}return r|a<<16|0}},{}],44:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,r){var a=n,s=r+i;t^=-1;for(var o=r;o<s;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},{}],46:[function(t,e,i){"use strict";var n,r=t("../utils/common"),a=t("./trees"),s=t("./adler32"),o=t("./crc32"),l=t("./messages"),h=0,c=4,u=0,d=-2,f=-1,g=4,p=2,m=8,v=9,_=286,y=30,x=19,b=2*_+1,I=15,C=3,w=258,S=w+C+1,M=42,A=113,T=1,k=2,D=3,P=4;function E(t,e){return t.msg=l[e],e}function z(t){return(t<<1)-(4<t?9:0)}function O(t){for(var e=t.length;0<=--e;)t[e]=0}function B(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function R(t,e){a._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,B(t.strm)}function L(t,e){t.pending_buf[t.pending++]=e}function F(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function G(t,e){var i,n,r=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-S?t.strstart-(t.w_size-S):0,h=t.window,c=t.w_mask,u=t.prev,d=t.strstart+w,f=h[a+s-1],g=h[a+s];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+s]===g&&h[i+s-1]===f&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<d);if(n=w-(d-a),a=d-w,s<n){if(t.match_start=e,o<=(s=n))break;f=h[a+s-1],g=h[a+s]}}}while((e=u[e&c])>l&&0!=--r);return s<=t.lookahead?s:t.lookahead}function N(t){var e,i,n,a,l,h,c,u,d,f,g=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=g+(g-S)){for(r.arraySet(t.window,t.window,g,g,0),t.match_start-=g,t.strstart-=g,t.block_start-=g,e=i=t.hash_size;n=t.head[--e],t.head[e]=g<=n?n-g:0,--i;);for(e=i=g;n=t.prev[--e],t.prev[e]=g<=n?n-g:0,--i;);a+=g}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,u=t.strstart+t.lookahead,f=void 0,(d=a)<(f=h.avail_in)&&(f=d),i=0===f?0:(h.avail_in-=f,r.arraySet(c,h.input,h.next_in,f,u),1===h.state.wrap?h.adler=s(h.adler,c,f,u):2===h.state.wrap&&(h.adler=o(h.adler,c,f,u)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=C)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+C-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<C)););}while(t.lookahead<S&&0!==t.strm.avail_in)}function U(t,e){for(var i,n;;){if(t.lookahead<S){if(N(t),t.lookahead<S&&e===h)return T;if(0===t.lookahead)break}if(i=0,t.lookahead>=C&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+C-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-S&&(t.match_length=G(t,i)),t.match_length>=C)if(n=a._tr_tally(t,t.strstart-t.match_start,t.match_length-C),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=C){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+C-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(R(t,!1),0===t.strm.avail_out))return T}return t.insert=t.strstart<C-1?t.strstart:C-1,e===c?(R(t,!0),0===t.strm.avail_out?D:P):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?T:k}function j(t,e){for(var i,n,r;;){if(t.lookahead<S){if(N(t),t.lookahead<S&&e===h)return T;if(0===t.lookahead)break}if(i=0,t.lookahead>=C&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+C-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=C-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-S&&(t.match_length=G(t,i),t.match_length<=5&&(1===t.strategy||t.match_length===C&&4096<t.strstart-t.match_start)&&(t.match_length=C-1)),t.prev_length>=C&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-C,n=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-C),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+C-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=C-1,t.strstart++,n&&(R(t,!1),0===t.strm.avail_out))return T}else if(t.match_available){if((n=a._tr_tally(t,0,t.window[t.strstart-1]))&&R(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return T}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<C-1?t.strstart:C-1,e===c?(R(t,!0),0===t.strm.avail_out?D:P):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?T:k}function Z(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*b),this.dyn_dtree=new r.Buf16(2*(2*y+1)),this.bl_tree=new r.Buf16(2*(2*x+1)),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(I+1),this.heap=new r.Buf16(2*_+1),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*_+1),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function V(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=p,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?M:A,t.adler=2===e.wrap?0:1,e.last_flush=h,a._tr_init(e),u):E(t,d)}function X(t){var e=V(t);return e===u&&function(t){t.window_size=2*t.w_size,O(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=C-1,t.match_available=0,t.ins_h=0}(t.state),e}function Y(t,e,i,n,a,s){if(!t)return d;var o=1;if(e===f&&(e=6),n<0?(o=0,n=-n):15<n&&(o=2,n-=16),a<1||v<a||i!==m||n<8||15<n||e<0||9<e||s<0||g<s)return E(t,d);8===n&&(n=9);var l=new W;return(t.state=l).strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+C-1)/C),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=i,X(t)}n=[new Z(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(N(t),0===t.lookahead&&e===h)return T;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,R(t,!1),0===t.strm.avail_out))return T;if(t.strstart-t.block_start>=t.w_size-S&&(R(t,!1),0===t.strm.avail_out))return T}return t.insert=0,e===c?(R(t,!0),0===t.strm.avail_out?D:P):(t.strstart>t.block_start&&(R(t,!1),t.strm.avail_out),T)}),new Z(4,4,8,4,U),new Z(4,5,16,8,U),new Z(4,6,32,32,U),new Z(4,4,16,16,j),new Z(8,16,32,32,j),new Z(8,16,128,128,j),new Z(8,32,128,256,j),new Z(32,128,258,1024,j),new Z(32,258,258,4096,j)],i.deflateInit=function(t,e){return Y(t,e,m,15,8,0)},i.deflateInit2=Y,i.deflateReset=X,i.deflateResetKeep=V,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?d:(t.state.gzhead=e,u):d},i.deflate=function(t,e){var i,r,s,l;if(!t||!t.state||5<e||e<0)return t?E(t,d):d;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==c)return E(t,0===t.avail_out?-5:d);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===M)if(2===r.wrap)t.adler=0,L(r,31),L(r,139),L(r,8),r.gzhead?(L(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),L(r,255&r.gzhead.time),L(r,r.gzhead.time>>8&255),L(r,r.gzhead.time>>16&255),L(r,r.gzhead.time>>24&255),L(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),L(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(L(r,255&r.gzhead.extra.length),L(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(L(r,0),L(r,0),L(r,0),L(r,0),L(r,0),L(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),L(r,3),r.status=A);else{var f=m+(r.w_bits-8<<4)<<8;f|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(f|=32),f+=31-f%31,r.status=A,F(r,f),0!==r.strstart&&(F(r,t.adler>>>16),F(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),B(t),s=r.pending,r.pending!==r.pending_buf_size));)L(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),B(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,L(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),B(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,L(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&B(t),r.pending+2<=r.pending_buf_size&&(L(r,255&t.adler),L(r,t.adler>>8&255),t.adler=0,r.status=A)):r.status=A),0!==r.pending){if(B(t),0===t.avail_out)return r.last_flush=-1,u}else if(0===t.avail_in&&z(e)<=z(i)&&e!==c)return E(t,-5);if(666===r.status&&0!==t.avail_in)return E(t,-5);if(0!==t.avail_in||0!==r.lookahead||e!==h&&666!==r.status){var g=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(N(t),0===t.lookahead)){if(e===h)return T;break}if(t.match_length=0,i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(R(t,!1),0===t.strm.avail_out))return T}return t.insert=0,e===c?(R(t,!0),0===t.strm.avail_out?D:P):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?T:k}(r,e):3===r.strategy?function(t,e){for(var i,n,r,s,o=t.window;;){if(t.lookahead<=w){if(N(t),t.lookahead<=w&&e===h)return T;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=C&&0<t.strstart&&(n=o[r=t.strstart-1])===o[++r]&&n===o[++r]&&n===o[++r]){s=t.strstart+w;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<s);t.match_length=w-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=C?(i=a._tr_tally(t,1,t.match_length-C),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(R(t,!1),0===t.strm.avail_out))return T}return t.insert=0,e===c?(R(t,!0),0===t.strm.avail_out?D:P):t.last_lit&&(R(t,!1),0===t.strm.avail_out)?T:k}(r,e):n[r.level].func(r,e);if(g!==D&&g!==P||(r.status=666),g===T||g===D)return 0===t.avail_out&&(r.last_flush=-1),u;if(g===k&&(1===e?a._tr_align(r):5!==e&&(a._tr_stored_block(r,0,0,!1),3===e&&(O(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),B(t),0===t.avail_out))return r.last_flush=-1,u}return e!==c?u:r.wrap<=0?1:(2===r.wrap?(L(r,255&t.adler),L(r,t.adler>>8&255),L(r,t.adler>>16&255),L(r,t.adler>>24&255),L(r,255&t.total_in),L(r,t.total_in>>8&255),L(r,t.total_in>>16&255),L(r,t.total_in>>24&255)):(F(r,t.adler>>>16),F(r,65535&t.adler)),B(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?u:1)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==M&&69!==e&&73!==e&&91!==e&&103!==e&&e!==A&&666!==e?E(t,d):(t.state=null,e===A?E(t,-3):u):d},i.deflateSetDictionary=function(t,e){var i,n,a,o,l,h,c,f,g=e.length;if(!t||!t.state)return d;if(2===(o=(i=t.state).wrap)||1===o&&i.status!==M||i.lookahead)return d;for(1===o&&(t.adler=s(t.adler,e,g,0)),i.wrap=0,g>=i.w_size&&(0===o&&(O(i.head),i.strstart=0,i.block_start=0,i.insert=0),f=new r.Buf8(i.w_size),r.arraySet(f,e,g-i.w_size,i.w_size,0),e=f,g=i.w_size),l=t.avail_in,h=t.next_in,c=t.input,t.avail_in=g,t.next_in=0,t.input=e,N(i);i.lookahead>=C;){for(n=i.strstart,a=i.lookahead-(C-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+C-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,--a;);i.strstart=n,i.lookahead=C-1,N(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=C-1,i.match_available=0,t.next_in=h,t.input=c,t.avail_in=l,i.wrap=o,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,i){"use strict";e.exports=function(t,e){var i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S,M;i=t.state,n=t.next_in,S=t.input,r=n+(t.avail_in-5),a=t.next_out,M=t.output,s=a-(e-t.avail_out),o=a+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,f=i.hold,g=i.bits,p=i.lencode,m=i.distcode,v=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{g<15&&(f+=S[n++]<<g,g+=8,f+=S[n++]<<g,g+=8),y=p[f&v];e:for(;;){if(f>>>=x=y>>>24,g-=x,0==(x=y>>>16&255))M[a++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=p[(65535&y)+(f&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}b=65535&y,(x&=15)&&(g<x&&(f+=S[n++]<<g,g+=8),b+=f&(1<<x)-1,f>>>=x,g-=x),g<15&&(f+=S[n++]<<g,g+=8,f+=S[n++]<<g,g+=8),y=m[f&_];i:for(;;){if(f>>>=x=y>>>24,g-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=m[(65535&y)+(f&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(I=65535&y,g<(x&=15)&&(f+=S[n++]<<g,(g+=8)<x&&(f+=S[n++]<<g,g+=8)),l<(I+=f&(1<<x)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(f>>>=x,g-=x,(x=a-s)<I){if(c<(x=I-x)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(w=d,(C=0)===u){if(C+=h-x,x<b){for(b-=x;M[a++]=d[C++],--x;);C=a-I,w=M}}else if(u<x){if(C+=h+u-x,(x-=u)<b){for(b-=x;M[a++]=d[C++],--x;);if(C=0,u<b){for(b-=x=u;M[a++]=d[C++],--x;);C=a-I,w=M}}}else if(C+=u-x,x<b){for(b-=x;M[a++]=d[C++],--x;);C=a-I,w=M}for(;2<b;)M[a++]=w[C++],M[a++]=w[C++],M[a++]=w[C++],b-=3;b&&(M[a++]=w[C++],1<b&&(M[a++]=w[C++]))}else{for(C=a-I;M[a++]=M[C++],M[a++]=M[C++],M[a++]=M[C++],2<(b-=3););b&&(M[a++]=M[C++],1<b&&(M[a++]=M[C++]))}break}}break}}while(n<r&&a<o);n-=b=g>>3,f&=(1<<(g-=b<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=a<o?o-a+257:257-(a-o),i.hold=f,i.bits=g}},{}],49:[function(t,e,i){"use strict";var n=t("../utils/common"),r=t("./adler32"),a=t("./crc32"),s=t("./inffast"),o=t("./inftrees"),l=1,h=2,c=0,u=-2,d=1,f=852,g=592;function p(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=d,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(f),e.distcode=e.distdyn=new n.Buf32(g),e.sane=1,e.back=-1,c):u}function _(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,v(t)):u}function y(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?u:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,_(t))):u}function x(t,e){var i,n;return t?(n=new m,(t.state=n).window=null,(i=y(t,e))!==c&&(t.state=null),i):u}var b,I,C=!0;function w(t){if(C){var e;for(b=new n.Buf32(512),I=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(l,t.lens,0,288,b,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(h,t.lens,0,32,I,0,t.work,{bits:5}),C=!1}t.lencode=b,t.lenbits=9,t.distcode=I,t.distbits=5}function S(t,e,i,r){var a,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),r>=s.wsize?(n.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(r<(a=s.wsize-s.wnext)&&(a=r),n.arraySet(s.window,e,i-r,a,s.wnext),(r-=a)?(n.arraySet(s.window,e,i-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}i.inflateReset=_,i.inflateReset2=y,i.inflateResetKeep=v,i.inflateInit=function(t){return x(t,15)},i.inflateInit2=x,i.inflate=function(t,e){var i,f,g,m,v,_,y,x,b,I,C,M,A,T,k,D,P,E,z,O,B,R,L,F,G=0,N=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return u;12===(i=t.state).mode&&(i.mode=13),v=t.next_out,g=t.output,y=t.avail_out,m=t.next_in,f=t.input,_=t.avail_in,x=i.hold,b=i.bits,I=_,C=y,R=c;t:for(;;)switch(i.mode){case d:if(0===i.wrap){i.mode=13;break}for(;b<16;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(2&i.wrap&&35615===x){N[i.check=0]=255&x,N[1]=x>>>8&255,i.check=a(i.check,N,2,0),b=x=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&x)<<8)+(x>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&x)){t.msg="unknown compression method",i.mode=30;break}if(b-=4,B=8+(15&(x>>>=4)),0===i.wbits)i.wbits=B;else if(B>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<B,t.adler=i.check=1,i.mode=512&x?10:12,b=x=0;break;case 2:for(;b<16;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(i.flags=x,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=x>>8&1),512&i.flags&&(N[0]=255&x,N[1]=x>>>8&255,i.check=a(i.check,N,2,0)),b=x=0,i.mode=3;case 3:for(;b<32;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}i.head&&(i.head.time=x),512&i.flags&&(N[0]=255&x,N[1]=x>>>8&255,N[2]=x>>>16&255,N[3]=x>>>24&255,i.check=a(i.check,N,4,0)),b=x=0,i.mode=4;case 4:for(;b<16;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}i.head&&(i.head.xflags=255&x,i.head.os=x>>8),512&i.flags&&(N[0]=255&x,N[1]=x>>>8&255,i.check=a(i.check,N,2,0)),b=x=0,i.mode=5;case 5:if(1024&i.flags){for(;b<16;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}i.length=x,i.head&&(i.head.extra_len=x),512&i.flags&&(N[0]=255&x,N[1]=x>>>8&255,i.check=a(i.check,N,2,0)),b=x=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(_<(M=i.length)&&(M=_),M&&(i.head&&(B=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,f,m,M,B)),512&i.flags&&(i.check=a(i.check,f,M,m)),_-=M,m+=M,i.length-=M),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===_)break t;for(M=0;B=f[m+M++],i.head&&B&&i.length<65536&&(i.head.name+=String.fromCharCode(B)),B&&M<_;);if(512&i.flags&&(i.check=a(i.check,f,M,m)),_-=M,m+=M,B)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===_)break t;for(M=0;B=f[m+M++],i.head&&B&&i.length<65536&&(i.head.comment+=String.fromCharCode(B)),B&&M<_;);if(512&i.flags&&(i.check=a(i.check,f,M,m)),_-=M,m+=M,B)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;b<16;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(x!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}b=x=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;b<32;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}t.adler=i.check=p(x),b=x=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=v,t.avail_out=y,t.next_in=m,t.avail_in=_,i.hold=x,i.bits=b,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){x>>>=7&b,b-=7&b,i.mode=27;break}for(;b<3;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}switch(i.last=1&x,b-=1,3&(x>>>=1)){case 0:i.mode=14;break;case 1:if(w(i),i.mode=20,6!==e)break;x>>>=2,b-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}x>>>=2,b-=2;break;case 14:for(x>>>=7&b,b-=7&b;b<32;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if((65535&x)!=(x>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&x,b=x=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(M=i.length){if(_<M&&(M=_),y<M&&(M=y),0===M)break t;n.arraySet(g,f,m,M,v),_-=M,m+=M,y-=M,v+=M,i.length-=M;break}i.mode=12;break;case 17:for(;b<14;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(i.nlen=257+(31&x),x>>>=5,b-=5,i.ndist=1+(31&x),x>>>=5,b-=5,i.ncode=4+(15&x),x>>>=4,b-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;b<3;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}i.lens[U[i.have++]]=7&x,x>>>=3,b-=3}for(;i.have<19;)i.lens[U[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,L={bits:i.lenbits},R=o(0,i.lens,0,19,i.lencode,0,i.work,L),i.lenbits=L.bits,R){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;D=(G=i.lencode[x&(1<<i.lenbits)-1])>>>16&255,P=65535&G,!((k=G>>>24)<=b);){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(P<16)x>>>=k,b-=k,i.lens[i.have++]=P;else{if(16===P){for(F=k+2;b<F;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(x>>>=k,b-=k,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}B=i.lens[i.have-1],M=3+(3&x),x>>>=2,b-=2}else if(17===P){for(F=k+3;b<F;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}b-=k,B=0,M=3+(7&(x>>>=k)),x>>>=3,b-=3}else{for(F=k+7;b<F;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}b-=k,B=0,M=11+(127&(x>>>=k)),x>>>=7,b-=7}if(i.have+M>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;M--;)i.lens[i.have++]=B}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,L={bits:i.lenbits},R=o(l,i.lens,0,i.nlen,i.lencode,0,i.work,L),i.lenbits=L.bits,R){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,L={bits:i.distbits},R=o(h,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,L),i.distbits=L.bits,R){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=_&&258<=y){t.next_out=v,t.avail_out=y,t.next_in=m,t.avail_in=_,i.hold=x,i.bits=b,s(t,C),v=t.next_out,g=t.output,y=t.avail_out,m=t.next_in,f=t.input,_=t.avail_in,x=i.hold,b=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;D=(G=i.lencode[x&(1<<i.lenbits)-1])>>>16&255,P=65535&G,!((k=G>>>24)<=b);){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(D&&0==(240&D)){for(E=k,z=D,O=P;D=(G=i.lencode[O+((x&(1<<E+z)-1)>>E)])>>>16&255,P=65535&G,!(E+(k=G>>>24)<=b);){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}x>>>=E,b-=E,i.back+=E}if(x>>>=k,b-=k,i.back+=k,i.length=P,0===D){i.mode=26;break}if(32&D){i.back=-1,i.mode=12;break}if(64&D){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&D,i.mode=22;case 22:if(i.extra){for(F=i.extra;b<F;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}i.length+=x&(1<<i.extra)-1,x>>>=i.extra,b-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;D=(G=i.distcode[x&(1<<i.distbits)-1])>>>16&255,P=65535&G,!((k=G>>>24)<=b);){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(0==(240&D)){for(E=k,z=D,O=P;D=(G=i.distcode[O+((x&(1<<E+z)-1)>>E)])>>>16&255,P=65535&G,!(E+(k=G>>>24)<=b);){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}x>>>=E,b-=E,i.back+=E}if(x>>>=k,b-=k,i.back+=k,64&D){t.msg="invalid distance code",i.mode=30;break}i.offset=P,i.extra=15&D,i.mode=24;case 24:if(i.extra){for(F=i.extra;b<F;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}i.offset+=x&(1<<i.extra)-1,x>>>=i.extra,b-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===y)break t;if(M=C-y,i.offset>M){if((M=i.offset-M)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}A=M>i.wnext?(M-=i.wnext,i.wsize-M):i.wnext-M,M>i.length&&(M=i.length),T=i.window}else T=g,A=v-i.offset,M=i.length;for(y<M&&(M=y),y-=M,i.length-=M;g[v++]=T[A++],--M;);0===i.length&&(i.mode=21);break;case 26:if(0===y)break t;g[v++]=i.length,y--,i.mode=21;break;case 27:if(i.wrap){for(;b<32;){if(0===_)break t;_--,x|=f[m++]<<b,b+=8}if(C-=y,t.total_out+=C,i.total+=C,C&&(t.adler=i.check=i.flags?a(i.check,g,C,v-C):r(i.check,g,C,v-C)),C=y,(i.flags?x:p(x))!==i.check){t.msg="incorrect data check",i.mode=30;break}b=x=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;b<32;){if(0===_)break t;_--,x+=f[m++]<<b,b+=8}if(x!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}b=x=0}i.mode=29;case 29:R=1;break t;case 30:R=-3;break t;case 31:return-4;case 32:default:return u}return t.next_out=v,t.avail_out=y,t.next_in=m,t.avail_in=_,i.hold=x,i.bits=b,(i.wsize||C!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&S(t,t.output,t.next_out,C-t.avail_out)?(i.mode=31,-4):(I-=t.avail_in,C-=t.avail_out,t.total_in+=I,t.total_out+=C,i.total+=C,i.wrap&&C&&(t.adler=i.check=i.flags?a(i.check,g,C,t.next_out-C):r(i.check,g,C,t.next_out-C)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==I&&0===C||4===e)&&R===c&&(R=-5),R)},i.inflateEnd=function(t){if(!t||!t.state)return u;var e=t.state;return e.window&&(e.window=null),t.state=null,c},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?u:((i.head=e).done=!1,c):u},i.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?u:11===i.mode&&r(1,e,n,0)!==i.check?-3:S(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,c):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,i){"use strict";var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,l,h,c,u,d){var f,g,p,m,v,_,y,x,b,I=d.bits,C=0,w=0,S=0,M=0,A=0,T=0,k=0,D=0,P=0,E=0,z=null,O=0,B=new n.Buf16(16),R=new n.Buf16(16),L=null,F=0;for(C=0;C<=15;C++)B[C]=0;for(w=0;w<l;w++)B[e[i+w]]++;for(A=I,M=15;1<=M&&0===B[M];M--);if(M<A&&(A=M),0===M)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(S=1;S<M&&0===B[S];S++);for(A<S&&(A=S),C=D=1;C<=15;C++)if(D<<=1,(D-=B[C])<0)return-1;if(0<D&&(0===t||1!==M))return-1;for(R[1]=0,C=1;C<15;C++)R[C+1]=R[C]+B[C];for(w=0;w<l;w++)0!==e[i+w]&&(u[R[e[i+w]]++]=w);if(_=0===t?(z=L=u,19):1===t?(z=r,O-=257,L=a,F-=257,256):(z=s,L=o,-1),C=S,v=c,k=w=E=0,p=-1,m=(P=1<<(T=A))-1,1===t&&852<P||2===t&&592<P)return 1;for(;;){for(y=C-k,b=u[w]<_?(x=0,u[w]):u[w]>_?(x=L[F+u[w]],z[O+u[w]]):(x=96,0),f=1<<C-k,S=g=1<<T;h[v+(E>>k)+(g-=f)]=y<<24|x<<16|b|0,0!==g;);for(f=1<<C-1;E&f;)f>>=1;if(0!==f?(E&=f-1,E+=f):E=0,w++,0==--B[C]){if(C===M)break;C=e[i+u[w]]}if(A<C&&(E&m)!==p){for(0===k&&(k=A),v+=S,D=1<<(T=C-k);T+k<M&&!((D-=B[T+k])<=0);)T++,D<<=1;if(P+=1<<T,1===t&&852<P||2===t&&592<P)return 1;h[p=E&m]=A<<24|T<<16|v-c|0}}return 0!==E&&(h[v+E]=C-k<<24|64<<16|0),d.bits=A,0}},{"../utils/common":41}],51:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,i){"use strict";var n=t("../utils/common");function r(t){for(var e=t.length;0<=--e;)t[e]=0}var a=0,s=256,o=s+1+29,l=30,h=19,c=2*o+1,u=15,d=16,f=256,g=16,p=17,m=18,v=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=new Array(2*(o+2));r(b);var I=new Array(2*l);r(I);var C=new Array(512);r(C);var w=new Array(256);r(w);var S=new Array(29);r(S);var M,A,T,k=new Array(l);function D(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function P(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function E(t){return t<256?C[t]:C[256+(t>>>7)]}function z(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function O(t,e,i){t.bi_valid>d-i?(t.bi_buf|=e<<t.bi_valid&65535,z(t,t.bi_buf),t.bi_buf=e>>d-t.bi_valid,t.bi_valid+=i-d):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function B(t,e,i){O(t,i[2*e],i[2*e+1])}function R(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function L(t,e,i){var n,r,a=new Array(u+1),s=0;for(n=1;n<=u;n++)a[n]=s=s+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=R(a[o]++,o))}}function F(t){var e;for(e=0;e<o;e++)t.dyn_ltree[2*e]=0;for(e=0;e<l;e++)t.dyn_dtree[2*e]=0;for(e=0;e<h;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*f]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function G(t){8<t.bi_valid?z(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function N(t,e,i,n){var r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&n[e]<=n[i]}function U(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&N(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!N(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function j(t,e,i){var n,r,a,o,l=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],r=t.pending_buf[t.l_buf+l],l++,0===n?B(t,r,e):(B(t,(a=w[r])+s+1,e),0!==(o=v[a])&&O(t,r-=S[a],o),B(t,a=E(--n),i),0!==(o=_[a])&&O(t,n-=k[a],o)),l<t.last_lit;);B(t,f,e)}function Z(t,e){var i,n,r,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=c,i=0;i<l;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=s[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;1<=i;i--)U(t,a,i);for(r=l;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],U(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,a[2*r]=a[2*i]+a[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,a[2*i+1]=a[2*n+1]=r,t.heap[1]=r++,U(t,a,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,a,s,o,l=e.dyn_tree,h=e.max_code,d=e.stat_desc.static_tree,f=e.stat_desc.has_stree,g=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,m=e.stat_desc.max_length,v=0;for(a=0;a<=u;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<c;i++)m<(a=l[2*l[2*(n=t.heap[i])+1]+1]+1)&&(a=m,v++),l[2*n+1]=a,h<n||(t.bl_count[a]++,s=0,p<=n&&(s=g[n-p]),o=l[2*n],t.opt_len+=o*(a+s),f&&(t.static_len+=o*(d[2*n+1]+s)));if(0!==v){do{for(a=m-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[m]--,v-=2}while(0<v);for(a=m;0!==a;a--)for(n=t.bl_count[a];0!==n;)h<(r=t.heap[--i])||(l[2*r+1]!==a&&(t.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),n--)}}(t,e),L(a,h,t.bl_count)}function W(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=e[2*(n+1)+1],++o<l&&r===s||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*g]++):o<=10?t.bl_tree[2*p]++:t.bl_tree[2*m]++,a=r,h=(o=0)===s?(l=138,3):r===s?(l=6,3):(l=7,4))}function V(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=e[2*(n+1)+1],!(++o<l&&r===s)){if(o<h)for(;B(t,r,t.bl_tree),0!=--o;);else 0!==r?(r!==a&&(B(t,r,t.bl_tree),o--),B(t,g,t.bl_tree),O(t,o-3,2)):o<=10?(B(t,p,t.bl_tree),O(t,o-3,3)):(B(t,m,t.bl_tree),O(t,o-11,7));a=r,h=(o=0)===s?(l=138,3):r===s?(l=6,3):(l=7,4)}}r(k);var X=!1;function Y(t,e,i,r){O(t,(a<<1)+(r?1:0),3),function(t,e,i,r){G(t),z(t,i),z(t,~i),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}i._tr_init=function(t){X||(function(){var t,e,i,n,r,a=new Array(u+1);for(n=i=0;n<28;n++)for(S[n]=i,t=0;t<1<<v[n];t++)w[i++]=n;for(w[i-1]=n,n=r=0;n<16;n++)for(k[n]=r,t=0;t<1<<_[n];t++)C[r++]=n;for(r>>=7;n<l;n++)for(k[n]=r<<7,t=0;t<1<<_[n]-7;t++)C[256+r++]=n;for(e=0;e<=u;e++)a[e]=0;for(t=0;t<=143;)b[2*t+1]=8,t++,a[8]++;for(;t<=255;)b[2*t+1]=9,t++,a[9]++;for(;t<=279;)b[2*t+1]=7,t++,a[7]++;for(;t<=287;)b[2*t+1]=8,t++,a[8]++;for(L(b,o+1,a),t=0;t<l;t++)I[2*t+1]=5,I[2*t]=R(t,5);M=new D(b,v,s+1,o,u),A=new D(I,_,0,l,u),T=new D(new Array(0),y,0,h,7)}(),X=!0),t.l_desc=new P(t.dyn_ltree,M),t.d_desc=new P(t.dyn_dtree,A),t.bl_desc=new P(t.bl_tree,T),t.bi_buf=0,t.bi_valid=0,F(t)},i._tr_stored_block=Y,i._tr_flush_block=function(t,e,i,n){var r,a,o=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<s;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),Z(t,t.l_desc),Z(t,t.d_desc),o=function(t){var e;for(W(t,t.dyn_ltree,t.l_desc.max_code),W(t,t.dyn_dtree,t.d_desc.max_code),Z(t,t.bl_desc),e=h-1;3<=e&&0===t.bl_tree[2*x[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==e?Y(t,e,i,n):4===t.strategy||a===r?(O(t,2+(n?1:0),3),j(t,b,I)):(O(t,4+(n?1:0),3),function(t,e,i,n){var r;for(O(t,e-257,5),O(t,i-1,5),O(t,n-4,4),r=0;r<n;r++)O(t,t.bl_tree[2*x[r]+1],3);V(t,t.dyn_ltree,e-1),V(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),j(t,t.dyn_ltree,t.dyn_dtree)),F(t),n&&G(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(w[i]+s+1)]++,t.dyn_dtree[2*E(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){O(t,2,3),B(t,f,b),function(t){16===t.bi_valid?(z(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,i){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)});var CryptoJS=CryptoJS||function(t,e){var i={},n=i.lib={},r=function(){},a=n.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},s=n.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,i=t.words,n=this.sigBytes;if(t=t.sigBytes,this.clamp(),n%4)for(var r=0;r<t;r++)e[n+r>>>2]|=(i[r>>>2]>>>24-r%4*8&255)<<24-(n+r)%4*8;else if(65535<i.length)for(r=0;r<t;r+=4)e[n+r>>>2]=i[r>>>2];else e.push.apply(e,i);return this.sigBytes+=t,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i=[],n=0;n<e;n+=4)i.push(4294967296*t.random()|0);return new s.init(i,e)}}),o=i.enc={},l=o.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++){var r=e[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n+=2)i[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new s.init(i,e/2)}},h=o.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++)i.push(String.fromCharCode(e[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n++)i[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new s.init(i,e)}},c=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(h.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return h.parse(unescape(encodeURIComponent(t)))}},u=n.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,n=i.words,r=i.sigBytes,a=this.blockSize,o=r/(4*a);if(e=(o=e?t.ceil(o):t.max((0|o)-this._minBufferSize,0))*a,r=t.min(4*e,r),e){for(var l=0;l<e;l+=a)this._doProcessBlock(n,l);l=n.splice(0,e),i.sigBytes-=r}return new s.init(l,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});n.Hasher=u.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new d.HMAC.init(t,i).finalize(e)}}});var d=i.algo={};return i}(Math);!function(){var t=CryptoJS,e=(r=t.lib).WordArray,i=r.Hasher,n=[],r=t.algo.SHA1=i.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,r=i[0],a=i[1],s=i[2],o=i[3],l=i[4],h=0;80>h;h++){if(16>h)n[h]=0|t[e+h];else{var c=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=c<<1|c>>>31}c=(r<<5|r>>>27)+l+n[h],c=20>h?c+(1518500249+(a&s|~a&o)):40>h?c+(1859775393+(a^s^o)):60>h?c+((a&s|a&o|s&o)-1894007588):c+((a^s^o)-899497514),l=o,o=s,s=a<<30|a>>>2,a=r,r=c}i[0]=i[0]+r|0,i[1]=i[1]+a|0,i[2]=i[2]+s|0,i[3]=i[3]+o|0,i[4]=i[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=Math.floor(i/4294967296),e[15+(n+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(r),t.HmacSHA1=i._createHmacHelper(r)}(),function(t,e){"object"==typeof exports&&typeof module<"u"?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=typeof globalThis<"u"?globalThis:t||self).ZakekeResizableCanvas={})}(this,function(t){"use strict";var e=Object.defineProperty,i=(t,i,n)=>(((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n),n),n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var r={},a={get exports(){return r},set exports(t){r=t}};const s=function(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var i=function t(){if(this instanceof t){var i=[null];return i.push.apply(i,arguments),new(Function.bind.apply(e,i))}return e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(i,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}),i}(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var o;o=a,function(t,e){var i=(t=t||s).window,n=t.document,r=new function(){var t=/^(statics|enumerable|beans|preserve)$/,i=[],n=i.slice,r=Object.create,a=Object.getOwnPropertyDescriptor,s=Object.defineProperty,o=i.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},l=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},h=function(t,e,i){if(t){var n=a(t,"length");(n&&"number"==typeof n.value?o:function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)}).call(t,e,i=i||t)}return i};function c(e,i,n,r,o){var l={};function h(t,h){"string"==typeof(h=h||(h=a(i,t))&&(h.get?h:h.value))&&"#"===h[0]&&(h=e[h.substring(1)]||h);var c,d="function"==typeof h,f=h,g=o||d&&!h.base?h&&h.get?t in e:e[t]:null;(!o||!g)&&(d&&g&&(h.base=g),d&&!1!==r&&(c=t.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),(!f||d||!f.get||"function"!=typeof f.get||!u.isPlainObject(f))&&(f={value:f,writable:!0}),(a(e,t)||{configurable:!0}).configurable&&(f.configurable=!0,f.enumerable=null!=n?n:!c),s(e,t,f))}if(i){for(var c in i)i.hasOwnProperty(c)&&!t.test(c)&&h(c);for(var c in l){var d=l[c],f=e["set"+d],g=e["get"+d]||f&&e["is"+d];g&&(!0===r||0===g.length)&&h(c,{get:g,set:f})}}return e}function u(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&l(this,i)}return this}return c(u,{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,i=t.beans,n=t.preserve;e!==t&&c(this.prototype,t,t.enumerable,i,n),c(this,e,null,i,n)}for(var r=1,a=arguments.length;r<a;r++)this.inject(arguments[r]);return this},extend:function(){for(var t,e,i,n=this,a=0,o=arguments.length;a<o&&(!t||!e);a++)i=arguments[a],t=t||i.initialize,e=e||i.prototype;return e=(t=t||function(){n.apply(this,arguments)}).prototype=e||r(this.prototype),s(e,"constructor",{value:t,writable:!0,configurable:!0}),c(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=n,t}}).inject({enumerable:!1,initialize:u,set:u,inject:function(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&c(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var t=r(this);return t.inject.apply(t,arguments)},each:function(t,e){return h(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:l,each:h,create:r,define:s,describe:a,clone:function(t){return l(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===u||"Object"===e.name)},pick:function(t,i){return t!==e?t:i},slice:function(t,e,i){return n.call(t,e,i)}}})};o.exports=r,r.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?u.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),i=e.prototype._class;return i&&!r.exports[i]&&(r.exports[i]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((i=t.length)!==e.length)return!1;for(;i--;)if(!r.equals(t[i],e[i]))return!1}else{var i,n=Object.keys(t);if((i=n.length)!==Object.keys(e).length)return!1;for(;i--;){var a=n[i];if(!e.hasOwnProperty(a)||!r.equals(t[a],e[a]))return!1}}return!0}return!1},read:function(t,i,n,a){if(this===r){var s=this.peek(t,i);return t.__index++,s}var o=this.prototype,l=o._readIndex,h=i||l&&t.__index||0,c=t.length,u=t[h];if(a=a||c-h,u instanceof this||n&&n.readNull&&null==u&&a<=1)return l&&(t.__index=h+1),u&&n&&n.clone?u.clone():u;if(u=r.create(o),l&&(u.__read=!0),u=u.initialize.apply(u,h>0||h+a<c?r.slice(t,h,h+a):t)||u,l){t.__index=h+u.__read;var d=u.__filtered;d&&(t.__filtered=d,u.__filtered=e),u.__read=e}return u},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,i,n){for(var r,a=[],s=e||0,o=n?s+n:t.length,l=s;l<o;l++)a.push(Array.isArray(r=t[l])?this.read(r,0,i):this.read(t,l,i,1));return a},readNamed:function(t,i,n,a,s){var o=this.getNamed(t,i),l=o!==e;if(l){var h=t.__filtered;if(!h){var c=this.getSource(t);(h=t.__filtered=r.create(c)).__unfiltered=c}h[i]=e}return this.read(l?[o]:t,n,a,s)},readSupported:function(t,i){var n=this.getSource(t),r=this,a=!1;return n&&Object.keys(n).forEach(function(n){if(n in i){var s=r.readNamed(t,n);s!==e&&(i[n]=s),a=!0}}),a},getSource:function(t){var i=t.__source;if(i===e){var n=1===t.length&&t[0];i=t.__source=n&&r.isPlainObject(n)?n:null}return i},getNamed:function(t,e){var i=this.getSource(t);if(i)return e?i[e]:t.__filtered||i},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n,r){var a;function s(r){if(!(n&&r in n||a&&r in a)){var s=i[r];s!==e&&(t[r]=s)}}if(r){for(var o,l={},h=0,c=r.length;h<c;h++)(o=r[h])in i&&(s(o),l[o]=!0);a=l}return Object.keys(i.__unfiltered||i).forEach(s),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var a,s=!n;if(s&&(e.formatter=new u(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),a=t._class;a&&r[0]!==a&&r.unshift(a),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){a=t._serialize(e,n);var o=t._class;o&&!t._compactSerialize&&(s||!i)&&a[0]!==o&&a.unshift(o)}else if(Array.isArray(t)){a=[];for(var l=0,h=t.length;l<h;l++)a[l]=r.serialize(t[l],e,i,n)}else if(r.isPlainObject(t)){a={};var c=Object.keys(t);for(l=0,h=c.length;l<h;l++){var d=c[l];a[d]=r.serialize(t[d],e,i,n)}}else a="number"==typeof t?e.formatter.number(t,e.precision):t;return s&&n.length>0?[["dictionary",n.definitions],a]:a},deserialize:function(t,e,i,n,a){var s=t,o=!i,l=o&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var h=t[0],c="dictionary"===h;if(1==t.length&&/^#/.test(h))return i.dictionary[h];s=[];for(var u=(h=r.exports[h])?1:0,d=t.length;u<d;u++)s.push(r.deserialize(t[u],e,i,c,l));if(h){var f=s;s=e?e(h,f,o||a):new h(f)}}else if(r.isPlainObject(t))for(var g in s={},n&&(i.dictionary=s),t)s[g]=r.deserialize(t[g],e,i);return l?s[1]:s},exportJSON:function(t,e){var i=r.serialize(t,e);return e&&0==e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var a=n&&e&&e.constructor===t,s=a?e:r.create(t.prototype);if(1===i.length&&s instanceof C&&(a||!(s instanceof S))){var o=i[0];r.isPlainObject(o)&&(o.insert=!1,a&&(i=i.concat([C.INSERT])))}return(a?s.set:t).apply(s,i),a&&(e=null),s})},push:function(t,e){var i=e.length;if(i<4096)t.push.apply(t,e);else{var n=t.length;t.length+=i;for(var r=0;r<i;r++)t[n+r]=e[r]}return t},splice:function(t,i,n,a){var s=i&&i.length,o=n===e;(n=o?t.length:n)>t.length&&(n=t.length);for(var l=0;l<s;l++)i[l]._index=n+l;if(o)return r.push(t,i),[];var h=[n,a];i&&r.push(h,i);for(var c=t.splice.apply(t,h),u=(l=0,c.length);l<u;l++)c[l]._index=e;for(l=n+s,u=t.length;l<u;l++)t[l]._index=l;return c},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var a={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],a=this._callbacks=this._callbacks||{};-1===(a=a[t]=a[t]||[]).indexOf(e)&&(a.push(e),n&&n.install&&1===a.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var i,n=this._eventTypes,a=n&&n[t],s=this._callbacks&&this._callbacks[t];return s&&(!e||-1!==(i=s.indexOf(e))&&1===s.length?(a&&a.uninstall&&a.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&s.splice(i,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function i(){e.apply(this,arguments),this.off(t,i)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=r.slice(arguments,1),a=e&&e.target&&!e.currentTarget;i=i.slice(),a&&(e.currentTarget=this);for(var s=0,o=i.length;s<o;s++)if(0==i[s].apply(this,n)){e&&e.stop&&e.stop();break}return a&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var a=e[r],s=a&&a[n];s&&s.call(this,r)}},statics:{inject:function t(e){var i=e._events;if(i){var n={};r.each(i,function(t,i){var a="string"==typeof t,s=a?t:i,o=r.capitalize(s),l=s.substring(2).toLowerCase();n[l]=a?{}:t,s="_"+s,e["get"+o]=function(){return this[s]},e["set"+o]=function(t){var e=this[s];e&&this.off(l,e),t&&this.on(l,t),this[s]=t}}),e._eventTypes=n}return t.base.apply(this,arguments)}}},l=r.extend({_class:"PaperScope",initialize:function e(){lt=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var n=rt.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:at.nativeModes},rt.release(n)}if(!this.agent){var a=t.navigator.userAgent.toLowerCase(),s=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(a)||[])[0],o="darwin"===s?"mac":s,l=i.agent=i.browser={platform:o};o&&(l[o]=!0),a.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!l.chrome){var a="opera"===e?n:/^(node|trident)$/.test(e)?r:i;l.version=a,l.versionNumber=parseFloat(a),e={trident:"msie",jsdom:"node"}[e]||e,l.name=e,l[e]=!0}}),l.chrome&&delete l.webkit,l.atom&&delete l.chrome}},version:"0.12.17",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){var i=lt.PaperScript.execute(t,this,e);return H.updateFocus(),i},install:function(t){var e=this;for(var i in r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})}),this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return lt=this,this.project=new I(t),this},createCanvas:function(t,e){return rt.getCanvas(t,e)},activate:function(){lt=this},clear:function(){for(var t=this.projects,e=this.tools,i=t.length-1;i>=0;i--)t[i].remove();for(i=e.length-1;i>=0;i--)e[i].remove()},remove:function(){this.clear(),delete l._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),h=r.extend(a,{initialize:function(t){this._scope=lt,this._index=this._scope[this._list].push(this)-1,(t||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),c={findItemBoundsCollisions:function(t,e,i){function n(t){for(var e=new Array(t.length),i=0;i<t.length;i++){var n=t[i].getBounds();e[i]=[n.left,n.top,n.right,n.bottom]}return e}var r=n(t),a=e&&e!==t?n(e):r;return this.findBoundsCollisions(r,a,i||0)},findCurveBoundsCollisions:function(t,e,i,n){function r(t){for(var e=Math.min,i=Math.max,n=new Array(t.length),r=0;r<t.length;r++){var a=t[r];n[r]=[e(a[0],a[2],a[4],a[6]),e(a[1],a[3],a[5],a[7]),i(a[0],a[2],a[4],a[6]),i(a[1],a[3],a[5],a[7])]}return n}var a=r(t),s=e&&e!==t?r(e):a;if(n){for(var o=this.findBoundsCollisions(a,s,i||0,!1,!0),l=this.findBoundsCollisions(a,s,i||0,!0,!0),h=[],c=0,u=o.length;c<u;c++)h[c]={hor:o[c],ver:l[c]};return h}return this.findBoundsCollisions(a,s,i||0)},findBoundsCollisions:function(t,e,i,n,r){var a=!e||t===e,s=a?t:t.concat(e),o=t.length,l=s.length;function h(t,e,i){for(var n=0,r=t.length;n<r;){var a=r+n>>>1;s[t[a]][e]<i?n=a+1:r=a}return n-1}for(var c=n?1:0,u=c+2,d=n?0:1,f=d+2,g=new Array(l),p=0;p<l;p++)g[p]=p;g.sort(function(t,e){return s[t][c]-s[e][c]});var m=[],v=new Array(o);for(p=0;p<l;p++){var _=g[p],y=s[_],x=a?_:_-o,b=_<o,I=a||!b,C=b?[]:null;if(m.length){var w=h(m,u,y[c]-i)+1;if(m.splice(0,w),a&&r){C=C.concat(m);for(var S=0;S<m.length;S++)v[T=m[S]].push(x)}else{var M=y[f],A=y[d];for(S=0;S<m.length;S++){var T=m[S],k=s[T],D=T<o,P=a||T>=o;(r||(b&&P||I&&D)&&M>=k[d]-i&&A<=k[f]+i)&&(b&&P&&C.push(a?T:T-o),I&&D&&v[T].push(x))}}}if(b&&(t===e&&C.push(_),v[_]=C),m.length){var E=h(m,u,y[u]);m.splice(E+1,0,_)}else m.push(_)}for(p=0;p<v.length;p++){var z=v[p];z&&z.sort(function(t,e){return t-e})}return v}},u=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});u.instance=new u;var d=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],i=Math.abs,n=Math.sqrt,r=Math.pow,a=Math.log2||function(t){return Math.log(t)*Math.LOG2E},s=1e-12,o=1.12e-16;function l(t,e,i){return t<e?e:t>i?i:t}function h(t,e,n){function r(t){var e=134217729*t,i=t-e+e;return[i,t-i]}var a=e*e-t*n,s=e*e+t*n;if(3*i(a)<s){var o=r(t),l=r(e),h=r(n),c=e*e,u=t*n;a=c-u+(l[0]*l[0]-c+2*l[0]*l[1]+l[1]*l[1]-(o[0]*h[0]-u+o[0]*h[1]+o[1]*h[0]+o[1]*h[1]))}return a}function c(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?r(2,-Math.round(a(t))):0}return{EPSILON:s,MACHINE_EPSILON:o,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(n(2)-1)/3,isZero:function(t){return t>=-s&&t<=s},isMachineZero:function(t){return t>=-o&&t<=o},clamp:l,integrate:function(i,n,r,a){for(var s=t[a-2],o=e[a-2],l=.5*(r-n),h=l+n,c=0,u=a+1>>1,d=1&a?o[c++]*i(h):0;c<u;){var f=l*s[c];d+=o[c++]*(i(h+f)+i(h-f))}return l*d},findRoot:function(t,e,n,r,a,s,o){for(var h=0;h<s;h++){var c=t(n),u=c/e(n),d=n-u;if(i(u)<o){n=d;break}c>0?(a=n,n=d<=r?.5*(r+a):d):(r=n,n=d>=a?.5*(r+a):d)}return l(n,r,a)},solveQuadratic:function(t,e,r,a,u,d){var f,g=1/0;if(i(t)<s){if(i(e)<s)return i(r)<s?-1:0;f=-r/e}else{var p=h(t,e*=-.5,r);if(p&&i(p)<o){var m=c(i(t),i(e),i(r));m&&(p=h(t*=m,e*=m,r*=m))}if(p>=-o){var v=p<0?0:n(p),_=e+(e<0?-v:v);0===_?g=-(f=r/t):(f=_/t,g=r/_)}}var y=0,x=null==u,b=u-s,I=d+s;return isFinite(f)&&(x||f>b&&f<I)&&(a[y++]=x?f:l(f,u,d)),g!==f&&isFinite(g)&&(x||g>b&&g<I)&&(a[y++]=x?g:l(g,u,d)),y},solveCubic:function(t,e,a,h,u,f,g){var p,m,v,_,y,x=c(i(t),i(e),i(a),i(h));function b(i){var n=t*(p=i);_=(n+(m=n+e))*p+(v=m*p+a),y=v*p+h}if(x&&(t*=x,e*=x,a*=x,h*=x),i(t)<s)t=e,m=a,v=h,p=1/0;else if(i(h)<s)m=e,v=a,p=0;else{b(-e/t/3);var I=y/t,C=r(i(I),1/3),w=I<0?-1:1,S=-_/t,M=S>0?1.324717957244746*Math.max(C,n(S)):C,A=p-w*M;if(A!==p){do{b(A),A=0===_?p:p-y/_/(1+o)}while(w*A>w*p);i(t)*p*p>i(h/p)&&(m=((v=-h/p)-a)/p)}}var T=d.solveQuadratic(t,m,v,u,f,g),k=null==f;return isFinite(p)&&(0===T||T>0&&p!==u[0]&&p!==u[1])&&(k||p>f-s&&p<g+s)&&(u[T++]=k?p:l(p,f,g)),T}}},f={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},g=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var a="number"==typeof e;this._set(t,a?e:t),n&&(r=a?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var s="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(s)?this._set(+s[0],+(s.length>1?s[1]:s[0])):"x"in s?this._set(s.x||0,s.y||0):"width"in s?this._set(s.width||0,s.height||0):"angle"in s?(this._set(s.length||0,0),this.setAngle(s.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new g(this.x,this.y)},toString:function(){var t=u.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();d.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=g.read(arguments),e=this.getLength()*t.getLength();if(d.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=g.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=arguments,e=g.read(t),i=e.x-this.x,n=e.y-this.y,a=i*i+n*n;return r.read(t)?a:Math.sqrt(a)},normalize:function(t){t===e&&(t=1);var i=this.getLength(),n=0!==i?t/i:0,r=new g(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new g(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=g.read(arguments);return new g(this.x+t.x,this.y+t.y)},subtract:function(){var t=g.read(arguments);return new g(this.x-t.x,this.y-t.y)},multiply:function(){var t=g.read(arguments);return new g(this.x*t.x,this.y*t.y)},divide:function(){var t=g.read(arguments);return new g(this.x/t.x,this.y/t.y)},modulo:function(){var t=g.read(arguments);return new g(this.x%t.x,this.y%t.y)},negate:function(){return new g(-this.x,-this.y)},isInside:function(){return _.read(arguments).contains(this)},isClose:function(){var t=arguments,e=g.read(t),i=r.read(t);return this.getDistance(e)<=i},isCollinear:function(){var t=g.read(arguments);return g.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=g.read(arguments);return g.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=d.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=g.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=g.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=g.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new g(t.x*e,t.y*e)},statics:{min:function(){var t=arguments,e=g.read(t),i=g.read(t);return new g(Math.min(e.x,i.x),Math.min(e.y,i.y))},max:function(){var t=arguments,e=g.read(t),i=g.read(t);return new g(Math.max(e.x,i.x),Math.max(e.y,i.y))},random:function(){return new g(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new g(e(this.x),e(this.y))}},{})),p=g.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),m=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var a="number"==typeof e;this._set(t,a?e:t),n&&(r=a?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var s="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(s)?this._set(+s[0],+(s.length>1?s[1]:s[0])):"width"in s?this._set(s.width||0,s.height||0):"x"in s?this._set(s.x||0,s.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new m(this.width,this.height)},toString:function(){var t=u.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=m.read(arguments);return new m(this.width+t.width,this.height+t.height)},subtract:function(){var t=m.read(arguments);return new m(this.width-t.width,this.height-t.height)},multiply:function(){var t=m.read(arguments);return new m(this.width*t.width,this.height*t.height)},divide:function(){var t=m.read(arguments);return new m(this.width/t.width,this.height/t.height)},modulo:function(){var t=m.read(arguments);return new m(this.width%t.width,this.height%t.height)},negate:function(){return new m(-this.width,-this.height)},isZero:function(){var t=d.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new m(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new m(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new m(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new m(e(this.width),e(this.height))}},{})),v=m.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),_=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,a){var s,o=arguments,l=typeof t;if("number"===l?(this._set(t,i,n,a),s=4):"undefined"===l||null===t?(this._set(0,0,0,0),s=null===t?1:0):1===o.length&&(Array.isArray(t)?(this._set.apply(this,t),s=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),s=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.readSupported(o,this)&&(s=1))),s===e){var h,c,u=g.readNamed(o,"from"),d=r.peek(o),f=u.x,p=u.y;if(d&&d.x!==e||r.hasNamed(o,"to")){var v=g.readNamed(o,"to");h=v.x-f,c=v.y-p,h<0&&(f=v.x,h=-h),c<0&&(p=v.y,c=-c)}else{var _=m.read(o);h=_.width,c=_.height}this._set(f,p,h,c),s=o.__index}var y=o.__filtered;return y&&(this.__filtered=y),this.__read&&(this.__read=s),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new _(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?_.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=u.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?g:p)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=g.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?m:v)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=m.read(arguments),e=this._sx,i=this._sy,n=t.width,r=t.height;e&&(this.x+=(this.width-n)*e),i&&(this.y+=(this.height-r)*i),this.width=n,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var e=t-this.x;this.width-=.5===this._sx?2*e:e}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var e=t-this.y;this.height-=.5===this._sy?2*e:e}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var e=t-this.x;this.width=.5===this._sx?2*e:e}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var e=t-this.y;this.height=.5===this._sy?2*e:e}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?g:p)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=g.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(_.read(arguments)):this._containsPoint(g.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=_.read(arguments),e=r.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=_.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new _(e,i,n-e,r-i)},unite:function(){var t=_.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new _(e,i,n-e,r-i)},include:function(){var t=g.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new _(e,i,n-e,r-i)},expand:function(){var t=m.read(arguments),e=t.width,i=t.height;return new _(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],a=t[n?1:0],s="get"+r,o="get"+a,l="set"+r,h="set"+a,c="set"+i;this["get"+i]=function(t){return new(t?g:p)(this[s](),this[o](),this,c)},this[c]=function(){var t=g.read(arguments);this[l](t.x),this[h](t.y)}},{beans:!0})),y=_.extend({initialize:function(t,e,i,n,r,a){this._set(t,e,i,n,!0),this._owner=r,this._setter=a},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=_.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),x=r.extend({_class:"Matrix",initialize:function t(e,i){var n=arguments,r=n.length,a=!0;if(r>=6?this._set.apply(this,n):1===r||2===r?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,i):Array.isArray(e)?this._set.apply(this,i?e.concat([i]):e):a=!1:r?a=!1:this.reset(),!a)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,a,s){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=a,s||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(25))},clone:function(){return new x(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=u.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=g.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=arguments,e=g.read(t),i=g.read(t,0,{readNull:!0});return i&&this.translate(i),this._a*=e.x,this._b*=e.x,this._c*=e.y,this._d*=e.y,i&&this.translate(i.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=g.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),a=Math.sin(t),s=i-i*r+n*a,o=n-i*a-n*r,l=this._a,h=this._b,c=this._c,u=this._d;return this._a=r*l+a*c,this._b=r*h+a*u,this._c=-a*l+r*c,this._d=-a*h+r*u,this._tx+=s*l+o*c,this._ty+=s*h+o*u,this._changed(),this},shear:function(){var t=arguments,e=g.read(t),i=g.read(t,0,{readNull:!0});i&&this.translate(i);var n=this._a,r=this._b;return this._a+=e.y*this._c,this._b+=e.y*this._d,this._c+=e.x*n,this._d+=e.x*r,i&&this.translate(i.negate()),this._changed(),this},skew:function(){var t=arguments,e=g.read(t),i=g.read(t,0,{readNull:!0}),n=Math.PI/180,r=new g(Math.tan(e.x*n),Math.tan(e.y*n));return this.shear(r,i)},append:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,a=this._d,s=t._a,o=t._c,l=t._b,h=t._d,c=t._tx,u=t._ty;this._a=s*i+l*r,this._c=o*i+h*r,this._b=s*n+l*a,this._d=o*n+h*a,this._tx+=c*i+u*r,this._ty+=c*n+u*a,e||this._changed()}return this},prepend:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,a=this._d,s=this._tx,o=this._ty,l=t._a,h=t._c,c=t._b,u=t._d,d=t._tx,f=t._ty;this._a=l*i+h*n,this._c=l*r+h*a,this._b=c*i+u*n,this._d=c*r+u*a,this._tx=l*s+h*o+d,this._ty=c*s+u*o+f,e||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,a=this._ty,s=t*n-e*i,o=null;return s&&!isNaN(s)&&isFinite(r)&&isFinite(a)&&(this._a=n/s,this._b=-e/s,this._c=-i/s,this._d=t/s,this._tx=(i*a-n*r)/s,this._ty=(e*r-t*a)/s,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new x(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(g.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new g),e._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var a=t[n],s=t[n+1];e[n]=a*this._a+s*this._c+this._tx,e[n+1]=a*this._b+s*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,a=[e,i,n,i,n,r,e,r];return this._transformCoordinates(a,a,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),a=r.slice(),s=2;s<8;s++){var o=n[s],l=1&s;o<r[l]?r[l]=o:o>a[l]&&(a[l]=o)}return e||(e=new _),e._set(r[0],r[1],a[0]-r[0],a[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(g.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,a=this._c,s=this._d,o=this._tx,l=this._ty,h=n*s-r*a,c=null;if(h&&!isNaN(h)&&isFinite(o)&&isFinite(l)){var u=t.x-this._tx,d=t.y-this._ty;e||(e=new g),c=e._set((u*s-d*a)/h,(d*n-u*r)/h,i)}return c},decompose:function(){var t,e,i,n=this._a,r=this._b,a=this._c,s=this._d,o=n*s-r*a,l=Math.sqrt,h=Math.atan2,c=180/Math.PI;if(0!==n||0!==r){var u=l(n*n+r*r);t=Math.acos(n/u)*(r>0?1:-1),e=[u,o/u],i=[h(n*a+r*s,u*u),0]}else if(0!==a||0!==s){var d=l(a*a+s*s);t=Math.asin(a/d)*(s>0?1:-1),e=[o/d,d],i=[0,h(n*a+r*s,d*d)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*c,scaling:new g(e),skewing:new g(i[0]*c,i[1]*c)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new g(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),b=r.extend({_class:"Line",initialize:function(t,e,i,n,r){var a=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,a=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,a=i),a||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new g(this._px,this._py)},getVector:function(){return new g(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return b.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return b.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return b.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return g.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return g.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,a,s,o,l,h){l||(i-=t,n-=e,s-=r,o-=a);var c=i*o-n*s;if(!d.isMachineZero(c)){var u=t-r,f=e-a,p=(s*f-o*u)/c,m=(i*f-n*u)/c,v=-1e-12,_=1+1e-12;if(h||v<p&&p<_&&v<m&&m<_)return h||(p=p<=0?0:p>=1?1:p),new g(t+p*i,e+p*n)}},getSide:function(t,e,i,n,r,a,s,o){s||(i-=t,n-=e);var l=r-t,h=l*n-(a-e)*i;return!o&&d.isMachineZero(h)&&(h=(l*i+l*i)/(i*i+n*n))>=0&&h<=1&&(h=0),h<0?-1:h>0?1:0},getSignedDistance:function(t,e,i,n,r,a,s){return s||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?a-e:e-a:((r-t)*n-(a-e)*i)/(n>i?n*Math.sqrt(1+i*i/(n*n)):i*Math.sqrt(1+n*n/(i*i)))},getDistance:function(t,e,i,n,r,a,s){return Math.abs(b.getSignedDistance(t,e,i,n,r,a,s))}}}),I=h.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){h.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new V(null,null,this),this._view=H.create(this,t||rt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,a=e._id,s=r[a];s?s.flags|=t:n.push(r[a]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new S({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:T,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof S){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,i,n){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new S(C.NO_INSERT),!0)).insertChild(t,i),n&&i.activate&&i.activate(),i},getItems:function(t){return C._getItems(this,t)},getItem:function(t){return C._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var a in e){var s=e[a];s&&s!=i&&delete s[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,a=new r({offset:new g(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new x],updateMatrix:!0}),s=0,o=n.length;s<o;s++)n[s].draw(t,a);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var l=this._selectionItems,h=this._scope.settings.handleSize,c=this._updateVersion;for(var u in l)l[u]._drawSelection(t,e,h,l,c);t.restore()}}}),C=r.extend(a,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=r.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new x,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),a=n&&!0===t.internal,s=this._matrix=new x,o=n&&t.project||lt.project,l=lt.settings;return this._id=a?null:f.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&l.applyMatrix,i&&s.translate(i),s._owner=this,this._style=new V(o._currentStyle,this,o),a||n&&0==t.insert||!l.insertItems&&(!n||1!=t.insert)?this._setProject(o):(n&&t.parent||o)._insertItem(e,this,!0),n&&t!==C.NO_INSERT&&t!==C.INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){var i={},n=this;function a(a){for(var s in a){var o=n[s];r.equals(o,"leading"===s?1.2*a.fontSize:a[s])||(i[s]=r.serialize(o,t,"data"!==s,e))}}return a(this._serializeFields),this instanceof w||a(this._style._defaults),[this._class,i]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=e),16&t&&(this._globalMatrix=e),n&&72&t&&C._clearBoundsCache(n),2&t&&C._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(t&&i){var n=i._children,r=i._namedChildren;(r[t]=r[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||e,this._changed(256)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide"],function(t){var e=r.capitalize(t),i="_"+t,n={locked:256,visible:265};this["get"+e]=function(){return this[i]},this["set"+e]=function(e){e!=this[i]&&(this[i]=e,this._changed(n[t]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(257))}},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=t?g:p,i=this._position||(this._position=this._getPositionFromBounds());return new e(i.x,i.y,this,"setPosition")},setPosition:function(){this.translate(g.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(t){return this._pivot?this._matrix._transformPoint(this._pivot):(t||this.getBounds()).getCenter(!0)},getPivot:function(){var t=this._pivot;return t?new p(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=g.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof x,n=r.set({},i?e:t,this._boundsOptions);(!n.stroke||this.getStrokeScaling())&&(n.cacheItem=this);var a=this._getCachedBounds(i&&t,n).rect;return arguments.length?a:new y(a.x,a.y,a.width,a.height,this,"setBounds")},setBounds:function(){var t=_.read(arguments),e=this.getBounds(),i=this._matrix,n=new x,r=t.getCenter();n.translate(r),(t.width!=e.width||t.height!=e.height)&&(i.isInvertible()||(i.set(i._backup||(new x).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(C._updateBoundsCache(this,e.cacheItem),C._getBounds(i,t,e)):new _},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,i){t=t&&t._orNullIfIdentity();var n=e.internal&&!i,r=e.cacheItem,a=n?null:this._matrix._orNullIfIdentity(),s=r&&(!t||t.equals(a))&&this._getBoundsCacheKey(e,n),o=this._bounds;if(C._updateBoundsCache(this._parent||this._symbol,r),s&&o&&s in o)return{rect:(d=o[s]).rect.clone(),nonscaling:d.nonscaling};var l=this._getBounds(t||a,e),h=l.rect||l,c=this._style,u=l.nonscaling||c.hasStroke()&&!c.getStrokeScaling();if(s){o||(this._bounds=o={});var d=o[s]={rect:h.clone(),nonscaling:u,internal:n}}return{rect:h,nonscaling:u}},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,a=r.length;n<a;n++){var s=r[n];s!==t&&(s._bounds=s._position=e,s._boundsCache&&C._clearBoundsCache(s))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,a=n,s=r,o=!1;i=i||{};for(var l=0,h=t.length;l<h;l++){var c=t[l];if(c._visible&&!c.isEmpty(!0)){var u=c._getCachedBounds(e&&e.appended(c._matrix),i,!0),d=u.rect;n=Math.min(d.x,n),a=Math.min(d.y,a),r=Math.max(d.x+d.width,r),s=Math.max(d.y+d.height,s),u.nonscaling&&(o=!0)}}return{rect:isFinite(n)?new _(n,a,r-n,s-a):new _,nonscaling:o}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new p(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=g.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var i=this.getRotation(),n=this._decomposed,r=new x,a=d.isZero;if(a(t.x)||a(t.y))r.translate(n.translation),i&&r.rotate(i),r.scale(e.x,e.y),this._matrix.set(r);else{var s=this.getPosition(!0);r.translate(s),i&&r.rotate(i),r.scale(e.x/t.x,e.y/t.y),i&&r.rotate(-i),r.translate(s.negate()),this.transform(r)}n&&(n.scaling=e,this._decomposed=n)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.set.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix;if(e)for(var i=this._parent,n=[];i;){if(!i._globalMatrix){e=null;for(var r=0,a=n.length;r<a;r++)n[r]._globalMatrix=null;break}n.push(i),i=i._parent}return e||(e=this._globalMatrix=this._matrix.clone(),(i=this._parent)&&e.prepend(i.getGlobalMatrix(!0))),t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof S)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var i=new this.constructor(C.NO_INSERT),n=this._children,a=r.pick(t?t.insert:e,t===e||!0===t),s=r.pick(t?t.deep:e,!0);n&&i.copyAttributes(this),(!n||s)&&i.copyContent(this),n||i.copyAttributes(this),a&&i.insertAbove(this);var o=this._name,l=this._parent;if(o&&l){n=l._children;for(var h=o,c=1;n[o];)o=h+" "+c++;o!==h&&i.setName(o)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,a=i.length;n<a;n++){var s=i[n];t.hasOwnProperty(s)&&(this[s]=t[s])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,l=t._name;this._data=o?r.clone(o):null,l&&this.setName(l)},rasterize:function(t,i){var n,a,s;r.isPlainObject(t)?(n=t.resolution,a=t.insert,s=t.raster):(n=t,a=i),s||(s=new A(C.NO_INSERT));var o=this.getStrokeBounds(),l=(n||this.getView().getResolution())/72,h=o.getTopLeft().floor(),c=o.getBottomRight().ceil(),u=new m(c.subtract(h)),d=u.multiply(l);if(s.setSize(d,!0),!d.isZero()){var f=s.getContext(!0),g=(new x).scale(l).translate(h.negate());f.save(),g.applyToContext(f),this.draw(f,new r({matrices:[g]})),f.restore()}return s._matrix.set((new x).translate(h.add(u.divide(2))).scale(1/l)),(a===e||a)&&s.insertAbove(this),s},contains:function(){var t=this._matrix;return t.isInvertible()&&!!this._contains(t._inverseTransform(g.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return _.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new R.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof C&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){var t=arguments;return this._hitTest(g.read(t),D.getOptions(t))}function e(){var t=arguments,e=g.read(t),i=D.getOptions(t),n=[];return this._hitTest(e,new r({all:n},i)),n}function i(t,e,i,n){var r=this._children;if(r)for(var a=r.length-1;a>=0;a--){var s=r[a],o=s!==n&&s._hitTest(t,e,i);if(o&&!e.all)return o}return null}return I.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var n=this._matrix,a=i?i.appended(n):this.getGlobalMatrix().prepend(this.getView()._matrix),s=Math.max(e.tolerance,1e-12),o=e._tolerancePadding=new m(R._getStrokePadding(s,n._shiftless().invert()));if(!(t=n._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(o.multiply(2))._containsPoint(t))return null;var l,h,c=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),u=e.match,d=this;function f(t){return t&&u&&!u(t)&&(t=null),t&&e.all&&e.all.push(t),t}function g(e,i){var n=i?l["get"+i]():d.getPosition();if(t.subtract(n).divide(o).length<=1)return new D(e,d,{name:i?r.hyphenate(i):e,point:n})}var p=e.position,v=e.center,_=e.bounds;if(c&&this._parent&&(p||v||_)){if((v||_)&&(l=this.getInternalBounds()),!(h=p&&g("position")||v&&g("center","Center"))&&_)for(var y=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],x=0;x<8&&!h;x++)h=g("bounds",y[x]);h=f(h)}return h||(h=this._hitTestChildren(t,e,a)||c&&f(this._hitTestSelf(t,e,a,this.getStrokeScaling()?null:a._shiftless().invert()))||null),h&&h.point&&(h.point=n.transform(h.point)),h},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new D("fill",this)},matches:function(t,e){var i=typeof t;if("object"===i){for(var n in t)if(t.hasOwnProperty(n)&&!this.matches(n,t[n]))return!1;return!0}if("function"===i)return t(this);if("match"===t)return e(this);var a=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;a=this._class}if("function"==typeof e)return!!e(a);if(e){if(e.test)return e.test(a);if(r.isPlainObject(e))return function t(e,i){for(var n in e)if(e.hasOwnProperty(n)){var a=e[n],s=i[n];if(r.isPlainObject(a)&&r.isPlainObject(s)){if(!t(a,s))return!1}else if(!r.equals(a,s))return!1}return!0}(e,a)}return r.equals(a,e)},getItems:function(t){return C._getItems(this,t,this._matrix)},getItem:function(t){return C._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,i,n,a,s){if(!a){var o="object"==typeof i&&i,l=o&&o.overlapping,h=o&&o.inside,c=(y=l||h)&&_.read([y]);a={items:[],recursive:o&&!1!==o.recursive,inside:!!h,overlapping:!!l,rect:c,path:l&&new R.Rectangle({rectangle:c,insert:!1})},o&&(i=r.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var u=e._children,d=a.items;n=(c=a.rect)&&(n||new x);for(var f=0,g=u&&u.length;f<g;f++){var p=u[f],m=n&&n.appended(p._matrix),v=!0;if(c){var y=p.getBounds(m);if(!c.intersects(y))continue;c.contains(y)||a.overlapping&&(y.contains(c)||a.path.intersects(p,m))||(v=!1)}if(v&&p.matches(i)&&(d.push(p),s)||(!1!==a.recursive&&t(p,i,m,a,s),s&&d.length>0))break}return d}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,e){var i=e?this.insertChildren(t,[e]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&e.length>0){for(var n={},a=(e=r.slice(e)).length-1;a>=0;a--){var s=(c=e[a])&&c._id;!c||n[s]?e.splice(a,1):(c._remove(!1,!0),n[s]=!0)}r.splice(i,e,t,0);for(var o=this._project,l=o._changes,h=(a=0,e.length);a<h;a++){var c,u=(c=e[a])._name;c._parent=this,c._setProject(o,!0),u&&c.setName(u),l&&c._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(e,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],a=r?r.indexOf(this):-1;-1!==a&&(e[n]==this&&delete e[n],r.splice(a,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,a=this._index;return this._style&&this._style._dispose(),!!i&&(this._name&&this._removeNamed(),null!=a&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,a,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(t){var e=this._children,i=e?e.length:0;if(t){for(var n=0;n<i;n++)if(!e[n].isEmpty(t))return!1;return!0}return!i},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,a=Math.min(i.length,n.length);r<a;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=arguments,n=(e?r:g).read(i),a=g.read(i,0,{readNull:!0});return this.transform((new x)[t](n,a||this.getPosition(!0)))}},{translate:function(){var t=new x;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i){var n=this._matrix,r=t&&!t.isIdentity(),a=i&&this._canApplyMatrix||this._applyMatrix&&(r||!n.isIdentity()||e&&this._children);if(!r&&!a)return this;if(r){!t.isInvertible()&&n.isInvertible()&&(n._backup=n.getValues()),n.prepend(t,!0);var s=this._style,o=s.getFillColor(!0),l=s.getStrokeColor(!0);o&&o.transform(t),l&&l.transform(t)}if(a&&(a=this._transformContent(n,e,i))){var h=this._pivot;h&&n._transformPoint(h,h,!0),n.reset(!0),i&&this._canApplyMatrix&&(this._applyMatrix=!0)}var c=this._bounds,u=this._position;(r||a)&&this._changed(25);var d=r&&c&&t.decompose();if(d&&d.skewing.isZero()&&d.rotation%90==0){for(var f in c){var g=c[f];if(g.nonscaling)delete c[f];else if(a||!g.internal){var p=g.rect;t._transformBounds(p,p)}}this._bounds=c;var m=c[this._getBoundsCacheKey(this._boundsOptions||{})];m&&(this._position=this._getPositionFromBounds(m.rect))}else r&&u&&this._pivot&&(this._position=t._transformPoint(u,u));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,a=n.length;r<a;r++)n[r].transform(t,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(g.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(g.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(g.read(arguments))},localToParent:function(){return this._matrix._transformPoint(g.read(arguments))},fitBounds:function(t,e){t=_.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,a=(e?n>r:n<r)?t.width/i.width:t.height/i.height,s=new _(new g,new m(i.width*a,i.height*a));s.setCenter(t.getCenter()),this.setBounds(s)}}),{_setStyles:function(t,e,i){var n=this._style,r=this._matrix;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t,r)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t,r),t.lineWidth=n.getStrokeWidth();var a=n.getStrokeJoin(),s=n.getStrokeCap(),o=n.getMiterLimit();if(a&&(t.lineJoin=a),s&&(t.lineCap=s),o&&(t.miterLimit=o),lt.support.nativeDash){var l=n.getDashArray(),h=n.getDashOffset();l&&l.length&&("setLineDash"in t?(t.setLineDash(l),t.lineDashOffset=h):(t.mozDash=l,t.mozDashOffset=h))}}if(n.hasShadow()){var c=e.pixelRatio||1,u=i._shiftless().prepend((new x).scale(c,c)),d=u.transform(new g(n.getShadowBlur(),0)),f=u.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=d.getLength(),t.shadowOffsetX=f.x,t.shadowOffsetY=f.y}},draw:function(t,e,i){if(this._updateVersion=this._project._updateVersion,this._visible&&0!==this._opacity){var n=e.matrices,r=e.viewMatrix,a=this._matrix,s=n[n.length-1].appended(a);if(s.isInvertible()){r=r?r.appended(s):s,n.push(s),e.updateMatrix&&(this._globalMatrix=s);var o,l,h,c=this._blendMode,u=d.clamp(this._opacity,0,1),f="normal"===c,g=at.nativeModes[c],p=f&&1===u||e.dontStart||e.clip||(g||f&&u<1)&&this._canComposite(),m=e.pixelRatio||1;if(!p){var v=this.getStrokeBounds(r);if(!v.width||!v.height)return void n.pop();h=e.offset,l=e.offset=v.getTopLeft().floor(),o=t,t=rt.getContext(v.getSize().ceil().add(1).multiply(m)),1!==m&&t.scale(m,m)}t.save();var _=i?i.appended(a):this._canScaleStroke&&!this.getStrokeScaling(!0)&&r,y=!p&&e.clipItem,x=!_||y;if(p?(t.globalAlpha=u,g&&(t.globalCompositeOperation=c)):x&&t.translate(-l.x,-l.y),x&&(p?a:r).applyToContext(t),y&&e.clipItem.draw(t,e.extend({clip:!0})),_){t.setTransform(m,0,0,m,0,0);var b=e.offset;b&&t.translate(-b.x,-b.y)}this._draw(t,e,r,_),t.restore(),n.pop(),e.clip&&!e.dontFinish&&t.clip(this.getFillRule()),p||(at.process(c,t,o,u,l.subtract(h).multiply(m)),rt.release(t),e.offset=h)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof L)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var a=this._selection,s=1&a,o=2&a||s&&this._selectBounds,l=4&a;if(this._drawSelected||(s=!1),(s||o||l)&&this._isUpdated(r)){var h,c=this.getSelectedColor(!0)||(h=this.getLayer())&&h.getSelectedColor(!0),u=e.appended(this.getGlobalMatrix(!0)),d=i/2;if(t.strokeStyle=t.fillStyle=c?c.toCanvasStyle(t):"#009dec",s&&this._drawSelected(t,u,n),l){var f=this.getPosition(!0),g=this._parent,p=g?g.localToGlobal(f):f,m=p.x,v=p.y;t.beginPath(),t.arc(m,v,d,0,2*Math.PI,!0),t.stroke();for(var _=[[0,-1],[1,0],[0,1],[-1,0]],y=d,x=i+1,b=0;b<4;b++){var I=_[b],C=I[0],w=I[1];t.moveTo(m+C*y,v+w*y),t.lineTo(m+C*x,v+w*x),t.stroke()}}if(o){var S=u._transformCorners(this.getInternalBounds());for(t.beginPath(),b=0;b<8;b++)t[b?"lineTo":"moveTo"](S[b],S[++b]);for(t.closePath(),t.stroke(),b=0;b<8;b++)t.fillRect(S[b]-d,S[++b]-d,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}}),{tween:function(t,e,i){i||(i=e,e=t,t=null,i||(i=e,e=null));var n=i&&i.easing,r=i&&i.start,a=null!=i&&("number"==typeof i?i:i.duration),s=new it(this,t,e,a,n,r);return a&&this.on("frame",function t(e){s._handleFrame(1e3*e.time),s.running||this.off("frame",t)}),s},tweenTo:function(t,e){return this.tween(null,t,e)},tweenFrom:function(t,e){return this.tween(t,null,e)}}),w=C.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(i){t.base.call(this,i),2050&i&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,i){var n=this._getClipItem();return n?n._getCachedBounds(n._matrix.prepended(e),r.set({},i,{stroke:!1})):t.base.call(this,e,i)},_hitTestChildren:function t(e,i,n){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,i,n,r)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,a=0,s=r.length;a<s;a++){var o=r[a];o!==n&&o.draw(t,e)}}}),S=w.extend({_class:"Layer",initialize:function(){w.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),M=C.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new v(t.width,t.height,this,"setSize")},setSize:function(){var t=m.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;"rectangle"===e?this._radius.set(m.min(this._radius,t.divide(2).abs())):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new v(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size._set(i,i)}else if(t=m.read(arguments),this._radius){if(this._radius.equals(t))return;this._radius.set(t),"rectangle"===e?(i=m.max(this._size,t.multiply(2)),this._size.set(i)):"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new(R[r.capitalize(this._type)])({center:new g,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),lt.settings.applyMatrix&&i.setApplyMatrix(!0),(t===e||t)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,i,n){var r=this._style,a=r.hasFill(),s=r.hasStroke(),o=e.dontFinish||e.clip,l=!n;if(a||s||o){var h=this._type,c=this._radius,u="circle"===h;if(e.dontStart||t.beginPath(),l&&u)t.arc(0,0,c,0,2*Math.PI,!0);else{var d=u?c:c.width,f=u?c:c.height,g=this._size,p=g.width,m=g.height;if(l&&"rectangle"===h&&0===d&&0===f)t.rect(-p/2,-m/2,p,m);else{var v=p/2,_=m/2,y=.44771525016920644,x=d*y,b=f*y,I=[-v,-_+f,-v,-_+b,-v+x,-_,-v+d,-_,v-d,-_,v-x,-_,v,-_+b,v,-_+f,v,_-f,v,_-b,v-x,_,v-d,_,-v+d,_,-v+x,_,-v,_-b,-v,_-f];n&&n.transform(I,I,32),t.moveTo(I[0],I[1]),t.bezierCurveTo(I[2],I[3],I[4],I[5],I[6],I[7]),v!==d&&t.lineTo(I[8],I[9]),t.bezierCurveTo(I[10],I[11],I[12],I[13],I[14],I[15]),_!==f&&t.lineTo(I[16],I[17]),t.bezierCurveTo(I[18],I[19],I[20],I[21],I[22],I[23]),v!==d&&t.lineTo(I[24],I[25]),t.bezierCurveTo(I[26],I[27],I[28],I[29],I[30],I[31])}}t.closePath()}!o&&(a||s)&&(this._setStyles(t,e,i),a&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),s&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new _(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(R._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),a=1;a<=4;a++){var s=new g(a>1&&a<4?-1:1,a>2?-1:1),o=s.multiply(r),l=o.subtract(s.multiply(n));if(new _(i?o.add(s.multiply(i)):o,l).contains(e))return{point:l,quadrant:a}}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n.point).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,a,s){var o=!1,l=this._style,h=r.stroke&&l.hasStroke(),c=r.fill&&l.hasFill();if(h||c){var u=this._type,d=this._radius,f=h?l.getStrokeWidth()/2:0,g=r._tolerancePadding.add(R._getStrokePadding(f,!l.getStrokeScaling()&&s));if("rectangle"===u){var p=g.multiply(2),m=t(this,n,p);if(m)o=e(n.subtract(m.point),d,g,m.quadrant);else{var v=new _(this._size).setCenter(0,0),y=v.expand(p),x=v.expand(p.negate());o=y._containsPoint(n)&&!x._containsPoint(n)}}else o=e(n,d,g)}return o?new D(h?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,a){var s=r.create(M.prototype);return s._type=t,s._size=i,s._radius=n,s._initialize(r.getNamed(a),e),s}return{Circle:function(){var e=arguments,i=g.readNamed(e,"center"),n=r.readNamed(e,"radius");return t("circle",i,new m(2*n),n,e)},Rectangle:function(){var e=arguments,i=_.readNamed(e,"rectangle"),n=m.min(m.readNamed(e,"radius"),i.getSize(!0).divide(2));return t("rectangle",i.getCenter(!0),i.getSize(!0),n,e)},Ellipse:function(){var e=arguments,i=M._readEllipse(e),n=i.radius;return t("ellipse",i.center,n.multiply(2),n,e)},_readEllipse:function(t){var e,i;if(r.hasNamed(t,"radius"))e=g.readNamed(t,"center"),i=m.readNamed(t,"radius");else{var n=_.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),A=C.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(t,i){if(!this._initialize(t,i!==e&&g.read(arguments))){var r,a=typeof t,s="string"===a?n.getElementById(t):"object"===a?t:null;if(s&&s!==C.NO_INSERT)if(s.getContext||null!=s.naturalHeight)r=s;else if(s){var o=m.read(arguments);o.isZero()||(r=rt.getCanvas(o))}r?this.setImage(r):this.setSource(t)}this._size||(this._size=new m,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=rt.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new v(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(t,e){var i=m.read(arguments);if(i.equals(this._size))e&&this.clear();else if(i.width>0&&i.height>0){var n=!e&&this.getElement();this._setImage(rt.getCanvas(i)),n&&this.getContext(!0).drawImage(n,0,0,i.width,i.height)}else this._canvas&&rt.release(this._canvas),this._size=i.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new g(0,0).transform(t),i=new g(1,0).transform(t).subtract(e),n=new g(0,1).transform(t).subtract(e);return new m(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var e=this;function i(t){var i=e.getView(),n=t&&t.type||"load";i&&e.responds(n)&&(lt=i._scope,e.emit(n,new J(t)))}this._setImage(t),this._loaded?setTimeout(i,0):t&&Y.add(t,{load:function(n){e._setImage(t),i(n)},error:i})},_setImage:function(t){this._canvas&&rt.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new m(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var t=rt.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){rt.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(1025)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var i=new t.Image,n=this._crossOrigin;n&&(i.crossOrigin=n),e&&(i.src=e),this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getSmoothing:function(){return this._smoothing},setSmoothing:function(t){this._smoothing="string"==typeof t?t:t?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=_.read(arguments),e=rt.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=_.read(arguments),e=new A(C.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=g.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof B?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new _(t):"x"in t&&(e=new _(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var n=Math.min(e.width,32),a=Math.min(e.height,32),s=A._sampleContext;s?s.clearRect(0,0,33,33):s=A._sampleContext=rt.getContext(new m(32)),s.save();var o=(new x).scale(n/e.width,a/e.height).translate(-e.x,-e.y);o.applyToContext(s),i&&i.draw(s,new r({clip:!0,matrices:[o]})),this._matrix.applyToContext(s);var l=this.getElement(),h=this._size;l&&s.drawImage(l,-h.width/2,-h.height/2),s.restore();for(var c=s.getImageData(.5,.5,Math.ceil(n),Math.ceil(a)).data,u=[0,0,0],d=0,f=0,g=c.length;f<g;f+=4){var p=c[f+3];d+=p,p/=255,u[0]+=c[f]*p,u[1]+=c[f+1]*p,u[2]+=c[f+2]*p}for(f=0;f<3;f++)u[f]/=d;return d?j.read(u):null},getPixel:function(){var t=g.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new j("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=arguments,e=g.read(t),i=j.read(t),n=i._convert("rgb"),r=i._alpha,a=this.getContext(!0),s=a.createImageData(1,1),o=s.data;o[0]=255*n[0],o[1]=255*n[1],o[2]=255*n[2],o[3]=null!=r?255*r:255,a.putImageData(s,e.x,e.y)},clear:function(){var t=this._size;this.getContext(!0).clearRect(0,0,t.width+1,t.height+1)},createImageData:function(){var t=m.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=_.read(arguments);return t.isEmpty()&&(t=new _(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},putImageData:function(t){var e=g.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},setImageData:function(t){this.setSize(t),this.getContext(!0).putImageData(t,0,0)},_getBounds:function(t,e){var i=new _(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new D("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t,e,i){var n=this.getElement();if(n&&n.width>0&&n.height>0){t.globalAlpha=d.clamp(this._opacity,0,1),this._setStyles(t,e,i);var r=this._smoothing,a="off"===r;X.setPrefixed(t,a?"imageSmoothingEnabled":"imageSmoothingQuality",!a&&r),t.drawImage(n,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),T=C.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&g.read(arguments,1))||this.setDefinition(t instanceof k?t:new k(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i){var n=e.extend({all:!1}),r=this._definition._item._hitTest(t,n,i);return r&&(r.item=this),r},_draw:function(t,e){this._definition._item.draw(t,e)}}),k=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=f.get(),this.project=lt.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&C._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new g),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new T(this,t)},clone:function(){return new k(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),D=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&this.inject(i)},statics:{getOptions:function(t){var e=t&&r.read(t);return new r({type:null,tolerance:lt.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),P=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,a,s){var o,l,h,c,u=arguments.length;u>0&&(null==t||"object"==typeof t?1===u&&t&&"point"in t?(o=t.point,l=t.handleIn,h=t.handleOut,c=t.selection):(o=t,l=i,h=n,c=r):(o=[t,i],l=n!==e?[n,r]:null,h=a!==e?[a,s]:null)),new E(o,this,"_point"),new E(l,this,"_handleIn"),new E(h,this,"_handleOut"),c&&this.setSelection(c)},_serialize:function(t,e){var i=this._point,n=this._selection,a=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&a.push(n),r.serialize(a,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&((!t||t===this._point||t===this._handleIn)&&(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)&&i._changed(),(!t||t===this._point||t===this._handleOut)&&(i=n[r])&&i._changed()),e._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(g.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(g.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(g.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(257))},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new O(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,i,n){var r=t||{},a=r.type,s=r.factor,o=this.getPrevious(),l=this.getNext(),h=(o||this)._point,c=this._point,u=(l||this)._point,d=h.getDistance(c),f=c.getDistance(u);if(a&&"catmull-rom"!==a){if("geometric"!==a)throw new Error("Smoothing method '"+a+"' not supported.");if(o&&l){var p=h.subtract(u),m=s===e?.4:s,v=m*d/(d+f);i||this.setHandleIn(p.multiply(v)),n||this.setHandleOut(p.multiply(v-m))}}else{var _=s===e?.5:s,y=Math.pow(d,_),x=y*y,b=Math.pow(f,_),I=b*b;if(!i&&o){var C=2*I+3*b*y+x,w=3*b*(b+y);this.setHandleIn(0!==w?new g((I*h._x+C*c._x-x*u._x)/w-c._x,(I*h._y+C*c._y-x*u._y)/w-c._y):new g)}!n&&l&&(C=2*x+3*y*b+I,w=3*y*(y+b),this.setHandleOut(0!==w?new g((x*u._x+C*c._x-I*h._x)/w-c._x,(x*u._y+C*c._y-I*h._y)/w-c._y):new g))}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new P(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new P(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,a=t._point,s=e._point,o=t._handleIn,l=e._handleIn,h=e._handleOut,c=t._handleOut;this._point._set(n*a._x+r*s._x,n*a._y+r*s._y,!0),this._handleIn._set(n*o._x+r*l._x,n*o._y+r*l._y,!0),this._handleOut._set(n*c._x+r*h._x,n*c._y+r*h._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,a=i&&this._handleOut.isZero()?null:this._handleOut,s=n._x,o=n._y,l=2;return e[0]=s,e[1]=o,r&&(e[l++]=r._x+s,e[l++]=r._y+o),a&&(e[l++]=a._x+s,e[l++]=a._y+o),t&&(t._transformCoordinates(e,e,l/2),s=e[0],o=e[1],i?(n._x=s,n._y=o,l=2,r&&(r._x=e[l++]-s,r._y=e[l++]-o),a&&(a._x=e[l++]-s,a._y=e[l++]-o)):(r||(e[l++]=s,e[l++]=o),a||(e[l++]=s,e[l++]=o))),e}}),E=g.extend({initialize:function(t,i,n){var r,a,s;if(t)if((r=t[0])!==e)a=t[1];else{var o=t;(r=o.x)===e&&(r=(o=g.read(arguments)).x),a=o.y,s=o.selected}else r=a=0;this._x=r,this._y=a,this._owner=i,i[n]=this,s&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=d.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),z=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,a,s,o){var l,h,c,u,d,f,g=arguments.length;3===g?(this._path=t,l=e,h=i):g?1===g?"segment1"in t?(l=new P(t.segment1),h=new P(t.segment2)):"point1"in t?(c=t.point1,d=t.handle1,f=t.handle2,u=t.point2):Array.isArray(t)&&(c=[t[0],t[1]],u=[t[6],t[7]],d=[t[2]-t[0],t[3]-t[1]],f=[t[4]-t[6],t[5]-t[7]]):2===g?(l=new P(t),h=new P(e)):4===g?(c=t,d=e,f=i,u=n):8===g&&(c=[t,e],u=[s,o],d=[i-t,n-e],f=[r-s,a-o]):(l=new P,h=new P),this._segment1=l||new P(c,null,d),this._segment2=h||new P(u,f,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new z(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return z.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(g.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(g.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(g.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(g.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return z.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new g(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=z.getLength(this.getValues(),0,1)),this._length},getArea:function(){return z.getArea(this.getValues())},getLine:function(){return new b(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new z(z.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return z.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var i=null;if(t>=1e-8&&t<=1-1e-8){var n=z.subdivide(this.getValues(),t),r=n[0],a=n[1],s=e||this.hasHandles(),o=this._segment1,l=this._segment2,h=this._path;s&&(o._handleOut._set(r[2]-r[0],r[3]-r[1]),l._handleIn._set(a[4]-a[6],a[5]-a[7]));var c=r[6],u=r[7],d=new P(new g(c,u),s&&new g(r[4]-c,r[5]-u),s&&new g(a[2]-c,a[3]-u));h?(h.insert(o._index+1,d),i=this.getNext()):(this._segment2=d,this._changed(),i=new z(d,l))}return i},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new z(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,i,n){var r=t._point,a=t._handleOut,s=e._handleIn,o=e._point,l=r.x,h=r.y,c=o.x,u=o.y,d=n?[l,h,l,h,c,u,c,u]:[l,h,l+a._x,h+a._y,c+s._x,u+s._y,c,u];return i&&i._transformCoordinates(d,d,4),d},subdivide:function(t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7];i===e&&(i=.5);var u=1-i,d=u*n+i*a,f=u*r+i*s,g=u*a+i*o,p=u*s+i*l,m=u*o+i*h,v=u*l+i*c,_=u*d+i*g,y=u*f+i*p,x=u*g+i*m,b=u*p+i*v,I=u*_+i*x,C=u*y+i*b;return[[n,r,d,f,_,y,I,C],[I,C,x,b,m,v,h,c]]},getMonoCurves:function(t,e){var i=[],n=e?0:1,r=t[n+0],a=t[n+2],s=t[n+4],o=t[n+6];if(r>=a==a>=s&&a>=s==s>=o||z.isStraight(t))i.push(t);else{var l=3*(a-s)-r+o,h=2*(r+s)-4*a,c=a-r,u=[],f=d.solveQuadratic(l,h,c,u,1e-8,1-1e-8);if(f){u.sort();var g=u[0],p=z.subdivide(t,g);i.push(p[0]),f>1&&(g=(u[1]-g)/(1-g),p=z.subdivide(p[1],g),i.push(p[0])),i.push(p[1])}else i.push(t)}return i},solveCubic:function(t,e,i,n,r,a){var s=t[e],o=t[e+2],l=t[e+4],h=t[e+6],c=0;if(!(s<i&&h<i&&o<i&&l<i||s>i&&h>i&&o>i&&l>i)){var u=3*(o-s),f=3*(l-o)-u,g=h-s-u-f;c=d.solveCubic(g,f,u,s-i,n,r,a)}return c},getTimeOf:function(t,e){var i=new g(t[0],t[1]),n=new g(t[6],t[7]),r=1e-7;if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var a=[e.x,e.y],s=[],o=0;o<2;o++)for(var l=z.solveCubic(t,o,a[o],s,0,1),h=0;h<l;h++){var c=s[h];if(e.isClose(z.getPoint(t,c),r))return c}return e.isClose(i,r)?0:e.isClose(n,r)?1:null},getNearestTime:function(t,e){if(z.isStraight(t)){var i=t[0],n=t[1],r=t[6]-i,a=t[7]-n,s=r*r+a*a;if(0===s)return 0;var o=((e.x-i)*r+(e.y-n)*a)/s;return o<1e-12?0:o>.999999999999?1:z.getTimeOf(t,new g(i+o*r,n+o*a))}var l=1/0,h=0;function c(i){if(i>=0&&i<=1){var n=e.getDistance(z.getPoint(t,i),!0);if(n<l)return l=n,h=i,!0}}for(var u=0;u<=100;u++)c(u/100);for(var d=.005;d>1e-8;)!c(h-d)&&!c(h+d)&&(d/=2);return h},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=z.subdivide(t,e)[1]),i<1&&(t=z.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=3*r-2*i-l,u=3*a-2*n-h,d=3*s-2*l-i,f=3*o-2*h-n;return Math.max(c*c,d*d)+Math.max(u*u,f*f)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7];return 3*((l-i)*(n+a)-(o-e)*(r+s)+r*(e-a)-n*(i-s)+l*(a+e/3)-o*(s+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)z._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new _(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,a,s,o,l){function h(t,e){var i=t-e,n=t+e;i<s[r]&&(s[r]=i),n>o[r]&&(o[r]=n)}a/=2;var c=s[r]+a,u=o[r]-a;if(t<c||e<c||i<c||n<c||t>u||e>u||i>u||n>u)if(e<t!=e<n&&i<t!=i<n)h(t,0),h(n,0);else{var f=3*(e-i)-t+n,g=2*(t+i)-4*e,p=e-t,m=d.solveQuadratic(f,g,p,l);h(n,0);for(var v=0;v<m;v++){var _=l[v],y=1-_;1e-8<=_&&_<=1-1e-8&&h(y*y*y*t+3*y*y*_*e+3*y*_*_*i+_*_*_*n,a)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=R[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,i,n){if(e.isZero()&&i.isZero())return!0;var r=n.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(i)){var a=new b(t,n);if(a.getDistance(t.add(e))<1e-7&&a.getDistance(n.add(i))<1e-7){var s=r.dot(r),o=r.dot(e)/s,l=r.dot(i)/s;return o>=0&&o<=1&&l<=0&&l>=-1}}return!1},isLinear:function(t,e,i,n){var r=n.subtract(t).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],a=e[6],s=e[7];return t(new g(n,r),new g(e[2]-n,e[3]-r),new g(e[4]-a,e[5]-s),new g(a,s),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new O(this,t):null},getTimeAt:function(t,e){return z.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var t=g.read(arguments);return t.isZero()?[]:z.getTimesWithTangent(this.getValues(),t)},getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(g.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return z.getTimeOf(this.getValues(),g.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=g.read(arguments),e=this.getValues(),i=z.getNearestTime(e,t),n=z.getPoint(e,i);return new O(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t&&t.getPoint()}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return z[t](n,i?e:z.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return z[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=9*(n-a)+3*(o-e),c=6*(e+a)-12*n,u=3*(n-e),d=9*(r-s)+3*(l-i),f=6*(i+s)-12*r,g=3*(r-i);return function(t){var e=(h*t+c)*t+u,i=(d*t+f)*t+g;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],a=t[1],s=t[2],o=t[3],l=t[4],h=t[5],c=t[6],u=t[7],f=d.isZero;f(s-r)&&f(o-a)&&(s=r,o=a),f(l-c)&&f(h-u)&&(l=c,h=u);var p,m,v=3*(s-r),_=3*(l-s)-v,y=c-r-v-_,x=3*(o-a),b=3*(h-o)-x,I=u-a-x-b;if(0===i)p=0===e?r:1===e?c:((y*e+_)*e+v)*e+r,m=0===e?a:1===e?u:((I*e+b)*e+x)*e+a;else{var C=1e-8,w=1-C;if(e<C?(p=v,m=x):e>w?(p=3*(c-l),m=3*(u-h)):(p=(3*y*e+2*_)*e+v,m=(3*I*e+2*b)*e+x),n){0===p&&0===m&&(e<C||e>w)&&(p=l-s,m=h-o);var S=Math.sqrt(p*p+m*m);S&&(p/=S,m/=S)}if(3===i){l=6*y*e+2*_,h=6*I*e+2*b;var M=Math.pow(p*p+m*m,1.5);p=0!==M?(p*h-m*l)/M:0,m=0}}return 2===i?new g(m,-p):new g(p,m)}return{statics:{classify:function(t){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=r*(n-h)+a*(l-i)+i*h-n*l,u=3*(s*(a-n)+o*(i-r)+r*n-a*i),f=u-c,g=f-c+(i*(h-o)+n*(s-l)+l*o-h*s),p=Math.sqrt(g*g+f*f+u*u),m=0!==p?1/p:0,v=d.isZero,_="serpentine";function y(t,i,n){var r=i!==e,a=r&&i>0&&i<1,s=r&&n>0&&n<1;return r&&(!(a||s)||"loop"===t&&!(a&&s))&&(t="arch",a=s=!1),{type:t,roots:a||s?a&&s?i<n?[i,n]:[n,i]:[a?i:n]:null}}if(f*=m,u*=m,v(g*=m))return v(f)?y(v(u)?"line":"quadratic"):y(_,u/(3*f));var x=3*f*f-4*g*u;if(v(x))return y("cusp",f/(2*g));var b=x>0?Math.sqrt(x/3):Math.sqrt(-x),I=2*g;return y(x>0?_:"loop",(f+b)/I,(f-b)/I)},getLength:function(n,r,a,s){if(r===e&&(r=0),a===e&&(a=1),z.isStraight(n)){var o=n;a<1&&(o=z.subdivide(o,a)[0],r/=a),r>0&&(o=z.subdivide(o,r)[1]);var l=o[6]-o[0],h=o[7]-o[1];return Math.sqrt(l*l+h*h)}return d.integrate(s||t(n),r,a,i(r,a))},getTimeAt:function(n,r,a){if(a===e&&(a=r<0?1:0),0===r)return a;var s=Math.abs,o=r>0,l=o?a:0,h=o?1:a,c=t(n),u=z.getLength(n,l,h,c),f=s(r)-u;if(s(f)<1e-12)return o?h:l;if(f>1e-12)return null;var g=r/u,p=0;return d.findRoot(function(t){return p+=d.integrate(c,a,t,i(a,t)),a=t,p-r},c,a+g,l,h,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=3*n-e-3*a+t[6],l=3*e-6*n+3*a,h=-3*e+3*n,c=3*r-i-3*s+t[7],u=3*i-6*r+3*s,f=-3*i+3*r,g=[];return d.solveCubic(9*(o*o+c*c),9*(o*l+u*c),2*(l*l+u*u)+3*(h*o+f*c),h*l+u*f,g,1e-8,1-1e-8),g.sort()}}}},new function(){function t(t,e,i,n,r,a,s){var o=!s&&i.getPrevious()===r,l=!s&&i!==r&&i.getNext()===r,h=1e-8,c=1-h;if(null!==n&&n>=(o?h:0)&&n<=(l?c:1)&&null!==a&&a>=(l?h:0)&&a<=(o?c:1)){var u=new O(i,n,null,s),d=new O(r,a,null,s);u._intersection=d,d._intersection=u,(!e||e(u))&&O.insert(t,u,!0)}}function e(t,e,n,r){return t[0][1]<n?i(t,!0,n):e[0][1]>r?i(e,!1,r):t[0][0]}function i(t,e,i){for(var n=t[0][0],r=t[0][1],a=1,s=t.length;a<s;a++){var o=t[a][0],l=t[a][1];if(e?l>=i:l<=i)return l===i?o:n+(i-r)*(o-n)/(l-r);n=o,r=l}return null}function n(t,e,i,n,r){var a=d.isZero;if(a(n)&&a(r)){var s=z.getTimeOf(t,new g(e,i));return null===s?[]:[s]}for(var o=Math.atan2(-r,n),l=Math.sin(o),h=Math.cos(o),c=[],u=[],f=0;f<8;f+=2){var p=t[f]-e,m=t[f+1]-i;c.push(p*h-m*l,p*l+m*h)}return z.solveCubic(c,1,0,u,0,1),u}function r(i,r,a,o,l,h){var c=1e-12,u=Math.min,d=Math.max;if(d(i[0],i[2],i[4],i[6])+c>u(r[0],r[2],r[4],r[6])&&u(i[0],i[2],i[4],i[6])-c<d(r[0],r[2],r[4],r[6])&&d(i[1],i[3],i[5],i[7])+c>u(r[1],r[3],r[5],r[7])&&u(i[1],i[3],i[5],i[7])-c<d(r[1],r[3],r[5],r[7])){var f=s(i,r);if(f)for(var p=0;p<2;p++){var m=f[p];t(l,h,a,m[0],o,m[1],!0)}else{var v=z.isStraight(i),_=z.isStraight(r),y=v&&_,x=v&&!_,I=l.length;if((y?function(e,i,n,r,a,s){var o=b.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);o&&t(a,s,n,z.getTimeOf(e,o),r,z.getTimeOf(i,o))}:v||_?function(e,i,r,a,s,o,l){for(var h=i[0],c=i[1],u=n(e,h,c,i[6]-h,i[7]-c),d=0,f=u.length;d<f;d++){var g=u[d],p=z.getPoint(e,g),m=z.getTimeOf(i,p);null!==m&&t(s,o,l?a:r,l?m:g,l?r:a,l?g:m)}}:function i(n,r,a,s,o,l,h,c,u,d,f,g,p){if(++u>=4096||++c>=40)return u;var m,v,_=r[0],y=r[1],x=r[6],I=r[7],C=b.getSignedDistance,w=C(_,y,x,I,r[2],r[3]),S=C(_,y,x,I,r[4],r[5]),M=w*S>0?.75:4/9,A=M*Math.min(0,w,S),T=M*Math.max(0,w,S),k=C(_,y,x,I,n[0],n[1]),D=C(_,y,x,I,n[2],n[3]),P=C(_,y,x,I,n[4],n[5]),E=C(_,y,x,I,n[6],n[7]),O=function(t,e,i,n){var r,a=[0,t],s=[1/3,e],o=[2/3,i],l=[1,n],h=e-(2*t+n)/3,c=i-(t+2*n)/3;if(h*c<0)r=[[a,s,l],[a,o,l]];else{var u=h/c;r=[u>=2?[a,s,l]:u<=.5?[a,o,l]:[a,s,o,l],[a,l]]}return(h||c)<0?r.reverse():r}(k,D,P,E),B=O[0],R=O[1];if(0===w&&0===S&&0===k&&0===D&&0===P&&0===E||null==(m=e(B,R,A,T))||null==(v=e(B.reverse(),R.reverse(),A,T)))return u;var L=d+(f-d)*m,F=d+(f-d)*v;if(Math.max(p-g,F-L)<1e-9){var G=(L+F)/2,N=(g+p)/2;t(o,l,h?s:a,h?N:G,h?a:s,h?G:N)}else{n=z.getPart(n,m,v);var U=p-g;if(v-m>.8)if(F-L>U)G=(L+F)/2,u=i(r,(j=z.subdivide(n,.5))[0],s,a,o,l,!h,c,u,g,p,L,G),u=i(r,j[1],s,a,o,l,!h,c,u,g,p,G,F);else{var j;N=(g+p)/2,u=i((j=z.subdivide(r,.5))[0],n,s,a,o,l,!h,c,u,g,N,L,F),u=i(j[1],n,s,a,o,l,!h,c,u,N,p,L,F)}else u=0===U||U>=1e-9?i(r,n,s,a,o,l,!h,c,u,g,p,L,F):i(n,r,a,s,o,l,h,c,u,L,F,g,p)}return u})(x?r:i,x?i:r,x?o:a,x?a:o,l,h,x,0,0,0,1,0,1),!y||l.length===I)for(p=0;p<4;p++){var C=p>>1,w=1&p,S=6*C,M=6*w,A=new g(i[S],i[S+1]),T=new g(r[M],r[M+1]);A.isClose(T,c)&&t(l,h,a,C,o,w)}}}return l}function a(e,i,n,r){var a=z.classify(e);if("loop"===a.type){var s=a.roots;t(n,r,i,s[0],i,s[1])}return n}function s(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=b.getDistance,a=1e-7,s=z.isStraight(t),o=z.isStraight(e),l=s&&o,h=i(t)<i(e),c=h?e:t,u=h?t:e,d=c[0],f=c[1],p=c[6]-d,m=c[7]-f;if(r(d,f,p,m,u[0],u[1],!0)<a&&r(d,f,p,m,u[6],u[7],!0)<a)!l&&r(d,f,p,m,c[2],c[3],!0)<a&&r(d,f,p,m,c[4],c[5],!0)<a&&r(d,f,p,m,u[2],u[3],!0)<a&&r(d,f,p,m,u[4],u[5],!0)<a&&(s=o=l=!0);else if(l)return null;if(s^o)return null;for(var v=[t,e],_=[],y=0;y<4&&_.length<2;y++){var x=1&y,I=1^x,C=y>>1,w=z.getTimeOf(v[x],new g(v[I][C?6:0],v[I][C?7:1]));if(null!=w){var S=x?[C,w]:[w,C];(!_.length||n(S[0]-_[0][0])>1e-8&&n(S[1]-_[0][1])>1e-8)&&_.push(S)}if(y>2&&!_.length)break}if(2!==_.length)_=null;else if(!l){var M=z.getPart(t,_[0][0],_[1][0]),A=z.getPart(e,_[0][1],_[1][1]);(n(A[2]-M[2])>a||n(A[3]-M[3])>a||n(A[4]-M[4])>a||n(A[5]-M[5])>a)&&(_=null)}return _}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?r(e,i,this,t,[]):a(e,this,[])},statics:{getOverlaps:s,getIntersections:function(t,e,i,n,s,o){var l=!e;l&&(e=t);for(var h=t.length,u=e.length,d=new Array(h),f=l?d:new Array(u),g=[],p=0;p<h;p++)d[p]=t[p].getValues(n);if(!l)for(p=0;p<u;p++)f[p]=e[p].getValues(s);for(var m=c.findCurveBoundsCollisions(d,f,1e-7),v=0;v<h;v++){var _=t[v],y=d[v];l&&a(y,_,g,i);var x=m[v];if(x)for(var b=0;b<x.length;b++){if(o&&g.length)return g;var I=x[b];if(!l||I>v){var C=e[I];r(y,f[I],_,C,g,i)}}}return g},getCurveLineIntersections:n,getTimesWithTangent:function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=e.normalize(),u=c.x,f=c.y,g=3*l-9*s+9*r-3*i,p=3*h-9*o+9*a-3*n,m=6*s-12*r+6*i,v=6*o-12*a+6*n,_=3*r-3*i,y=3*a-3*n,x=2*g*f-2*p*u,b=[];if(Math.abs(x)<d.CURVETIME_EPSILON){if(0!=(x=g*v-p*m)){var I=-(g*y-p*_)/x;I>=0&&I<=1&&b.push(I)}}else{var C=(m*m-4*g*_)*f*f+(-2*m*v+4*p*_+4*g*y)*u*f+(v*v-4*p*y)*u*u,w=m*f-v*u;if(C>=0&&0!=x){var S=Math.sqrt(C),M=-(w+S)/x,A=(-w+S)/x;M>=0&&M<=1&&b.push(M),A>=0&&A<=1&&b.push(A)}}return b}}}}),O=r.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){if(e>=.99999999){var a=t.getNext();a&&(e=0,t=a)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setPath:function(t){this._path=t,this._version=t?t._version:0},_setCurve:function(t){this._setPath(t._path),this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){var e=t.getCurve();e?this._setCurve(e):(this._setPath(t._path),this._segment1=t,this._segment2=null),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),i=this.getTime();0===i?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){var t=this._path,e=this;function i(t){var i=t&&t.getCurve();if(i&&null!=(e._time=i.getTimeOf(e._point)))return e._setCurve(i),i}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||i(this._segment)||i(this._segment1)||i(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(t,e){var i=this===t;if(!i&&t instanceof O){var n=this.getCurve(),r=t.getCurve(),a=n._path;if(a===r._path){var s=Math.abs,o=s(this.getOffset()-t.getOffset()),l=!e&&this._intersection,h=!e&&t._intersection;i=(o<1e-7||a&&s(a.getLength()-o)<1e-7)&&(!l&&!h||l&&h&&l.equals(h,!0))}}return i},toString:function(){var t=[],e=this.getPoint(),i=u.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){var t=this._intersection;if(!t)return!1;var e=this.getTime(),i=t.getTime(),n=1e-8,r=1-n,a=e>=n&&e<=r,s=i>=n&&i<=r;if(a&&s)return!this.isTouching();var o=this.getCurve(),l=o&&e<n?o.getPrevious():o,h=t.getCurve(),c=h&&i<n?h.getPrevious():h;if(e>r&&(o=o.getNext()),i>r&&(h=h.getNext()),!(l&&o&&c&&h))return!1;var u=[];function d(t,e){var i=t.getValues(),n=z.classify(i).roots||z.getPeaks(i),r=n.length,a=z.getLength(i,e&&r?n[r-1]:0,!e&&r?n[0]:1);u.push(r?a:a/32)}function f(t,e,i){return e<i?t>e&&t<i:t>e||t<i}a||(d(l,!0),d(o,!1)),s||(d(c,!0),d(h,!1));var g=this.getPoint(),p=Math.min.apply(Math,u),m=a?o.getTangentAtTime(e):o.getPointAt(p).subtract(g),v=a?m.negate():l.getPointAt(-p).subtract(g),_=s?h.getTangentAtTime(i):h.getPointAt(p).subtract(g),y=s?_.negate():c.getPointAt(-p).subtract(g),x=v.getAngle(),b=m.getAngle(),I=y.getAngle(),C=_.getAngle();return!!(a?f(x,I,C)^f(b,I,C)&&f(x,C,I)^f(b,C,I):f(I,x,b)^f(C,x,b)&&f(I,b,x)^f(C,b,x))},hasOverlap:function(){return!!this._overlap}},r.each(z._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){var n=t.length,r=0,a=n-1;function s(i,r){for(var a=i+r;a>=-1&&a<=n;a+=r){var s=t[(a%n+n)%n];if(!e.getPoint().isClose(s.getPoint(),1e-7))break;if(e.equals(s))return s}return null}for(;r<=a;){var o,l=r+a>>>1,h=t[l];if(i&&(o=e.equals(h)?h:s(l,-1)||s(l,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var c=e.getPath(),u=h.getPath();(c!==u?c._id-u._id:e.getIndex()+e.getTime()-(h.getIndex()+h.getTime()))<0?a=l-1:r=l+1}return t.splice(r,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),B=C.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;if(r.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i){var a=i[0];n=a&&Array.isArray(a[0])}else e&&(n=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(n?L:R)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var e,i,n,r=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),a=!1,s=new g,o=new g;function l(t,i){var n=+e[t];return a&&(n+=s[i]),n}function h(t){return new g(l(t,"x"),l(t+1,"y"))}this.clear();for(var c=0,u=r&&r.length;c<u;c++){var d=r[c],f=d[0],p=f.toLowerCase(),v=(e=d.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&e.length;switch(a=f===p,"z"===i&&!/[mz]/.test(p)&&this.moveTo(s),p){case"m":case"l":for(var _="m"===p,y=0;y<v;y+=2)this[_?"moveTo":"lineTo"](s=h(y)),_&&(o=s,_=!1);n=s;break;case"h":case"v":var x="h"===p?"x":"y";for(s=s.clone(),y=0;y<v;y++)s[x]=l(y,x),this.lineTo(s);n=s;break;case"c":for(y=0;y<v;y+=6)this.cubicCurveTo(h(y),n=h(y+2),s=h(y+4));break;case"s":for(y=0;y<v;y+=4)this.cubicCurveTo(/[cs]/.test(i)?s.multiply(2).subtract(n):s,n=h(y),s=h(y+2)),i=p;break;case"q":for(y=0;y<v;y+=4)this.quadraticCurveTo(n=h(y),s=h(y+2));break;case"t":for(y=0;y<v;y+=2)this.quadraticCurveTo(n=/[qt]/.test(i)?s.multiply(2).subtract(n):s,s=h(y)),i=p;break;case"a":for(y=0;y<v;y+=7)this.arcTo(s=h(y+5),new m(+e[y],+e[y+1]),+e[y+2],+e[y+4],+e[y+3]);break;case"z":this.closePath(1e-12),s=o}i=p}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,i,n){var r=this===t||!t,a=this._matrix._orNullIfIdentity(),s=r?a:(i||t._matrix)._orNullIfIdentity();return r||this.getBounds(a).intersects(t.getBounds(s),1e-12)?z.getIntersections(this.getCurves(),!r&&t.getCurves(),e,a,s,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.isCrossing()})},getNearestLocation:function(){for(var t=g.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,a=e.length;r<a;r++){var s=e[r].getNearestLocation(t);s._distance<i&&(i=s._distance,n=s)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t&&t.getPoint()},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",a=t[r],s=e[r],o=this[r];if(!a||!s||a.length!==s.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var l=o.length,h=s.length;if(l<h)for(var c=n?P:R,u=l;u<h;u++)this.add(new c);else l>h&&this[n?"removeSegments":"removeChildren"](h,l);for(u=0;u<h;u++)o[u].interpolate(a[u],s[u],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var i=this._children||[this],n=t._children?t._children.slice():[t],r=i.length,a=n.length,s=[],o=0;e=!0;for(var l=c.findItemBoundsCollisions(i,n,d.GEOMETRIC_EPSILON),h=r-1;h>=0&&e;h--){var u=i[h];e=!1;var f=l[h];if(f)for(var g=f.length-1;g>=0&&!e;g--)u.compare(n[f[g]])&&(s[f[g]]||(s[f[g]]=!0,o++),e=!0)}e=e&&o===a}return e}}),R=B.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=arguments,n=Array.isArray(t)?"object"==typeof t[0]?t:i:!t||t.size!==e||t.x===e&&t.point===e?null:i;n&&n.length>0?this.setSegments(n):(this._curves=e,this._segmentSelection=0,!n&&"string"==typeof t&&(this.setPathData(t),t=null)),this._initialize(!n&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(i){if(t.base.call(this,i),8&i){if(this._length=this._area=e,32&i)this._version++;else if(this._curves)for(var n=0,r=this._curves.length;n<r;n++)this._curves[n]._changed()}else 64&i&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof L?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var i=this.isFullySelected(),n=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,n){var r=t[n-1];"boolean"==typeof r&&(this.setClosed(r),n--),this._add(P.readList(t,0,{},n))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new z(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new z(this,this._segments[e-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(t,e){var i,n,r,a,s,o,l,h,c=this._segments,d=c.length,f=new u(e),g=new Array(6),p=!0,m=[];function v(e,c){if(e._transformCoordinates(t,g),i=g[0],n=g[1],p)m.push("M"+f.pair(i,n)),p=!1;else if(s=g[2],o=g[3],s===i&&o===n&&l===r&&h===a){if(!c){var u=i-r,d=n-a;m.push(0===u?"v"+f.number(d):0===d?"h"+f.number(u):"l"+f.pair(u,d))}}else m.push("c"+f.pair(l-r,h-a)+" "+f.pair(s-r,o-a)+" "+f.pair(i-r,n-a));r=i,a=n,l=g[4],h=g[5]}if(!d)return"";for(var _=0;_<d;_++)v(c[_]);return this._closed&&d>0&&(v(c[0],!0),m.push("z")),m.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,a=t.length,s=null==e,o=(e=s?i.length:e,0);o<a;o++){var l=t[o];l._path&&(l=t[o]=l.clone()),l._path=this,l._index=e+o,l._selection&&this._updateSelection(l,0,l._selection)}if(s)r.push(i,t);else{i.splice.apply(i,[e,0].concat(t)),o=e+a;for(var h=i.length;o<h;o++)i[o]._index=o}if(n){var c=this._countCurves(),u=e>0&&e+a-1===c?e-1:e,d=u,f=Math.min(u+a,c);for(t._curves&&(n.splice.apply(n,[u,0].concat(t._curves)),d+=t._curves.length),o=d;o<f;o++)n.splice(o,0,new z(this,null,null));this._adjustCurves(u,f)}return this._changed(41),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,a=t;a<e;a++)(i=r[a])._path=this,i._segment1=n[a],i._segment2=n[a+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){var e=arguments;return e.length>1&&"number"!=typeof t?this._add(P.readList(e)):this._add([P.read(e)])[0]},insert:function(t,e){var i=arguments;return i.length>2&&"number"!=typeof e?this._add(P.readList(i,1),t):this._add([P.read(i,1)],t)[0]},addSegment:function(){return this._add([P.read(arguments)])[0]},insertSegment:function(t){return this._add([P.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(P.readList(t))},insertSegments:function(t,e){return this._add(P.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=r.pick(e,this._segments.length);var n=this._segments,a=this._curves,s=n.length,o=n.splice(t,e-t),l=o.length;if(!l)return o;for(var h=0;h<l;h++){var c=o[h];c._selection&&this._updateSelection(c,c._selection,0),c._index=c._path=null}h=t;for(var u=n.length;h<u;h++)n[h]._index=h;if(a){var d=t>0&&e===s+(this._closed?1:0)?t-1:t;for(h=(a=a.splice(d,l)).length-1;h>=0;h--)a[h]._path=null;i&&(o._curves=a.slice(1)),this._adjustCurves(d,d)}return this._changed(41),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,i=this._closed;t=0;for(var n=0,r=e.length;n<r;n++){var a=n+1===r;t+=z.getArea(z.getValues(e[n],e[a?0:n+1],null,a&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i,(this._segmentSelection+=i-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,i=this.getLocationAt(t);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),i=e&&e.index,n=e&&e.time;n>1-1e-8&&(i++,n=0);var r=this.getCurves();if(i>=0&&i<r.length){n>=1e-8&&r[i++].divideAtTime(n);var a,s=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),a=this):((a=new R(C.NO_INSERT)).insertAbove(this),a.copyAttributes(this)),a._add(s,0),this.addSegment(s[0]),a}return null},split:function(t,i){var n,r=i===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(i);return null!=r?this.splitAt(r):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),a=t.getLastSegment();if(!a)return this;r&&r._point.isClose(a._point,i)&&t.reverse();var s=t.getFirstSegment();if(r&&r._point.isClose(s._point,i))r.setHandleOut(s._handleOut),this._add(n.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(s._point,i)&&t.reverse(),a=t.getLastSegment(),o&&o._point.isClose(a._point,i)?(o.setHandleIn(a._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var l=this.getFirstSegment(),h=this.getLastSegment();return l!==h&&l._point.isClose(h._point,i)&&(l.setHandleIn(h._handleIn),h.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;r>=0;r--){var a=e[r];!a.hasHandles()&&(!a.hasLength(n)||i&&a.isCollinear(a.getNext()))&&a.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new F(this,t||.25,256,!0).parts,i=e.length,n=[],r=0;r<i;r++)n.push(new P(e[r].curve.slice(0,2)));!this._closed&&i>0&&n.push(new P(e[i-1].curve.slice(6))),this.setSegments(n)},simplify:function(t){var e=new G(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){var i=this,n=t||{},r=n.type||"asymmetric",a=this._segments,s=a.length,o=this._closed;function l(t,e){var n=t&&t.index;if(null!=n){var r=t.path;if(r&&r!==i)throw new Error(t._class+" "+n+" of "+r+" is not part of "+i);e&&t instanceof z&&n++}else n="number"==typeof t?t:e;return Math.min(n<0&&o?n%s:n<0?n+s:n,s-1)}var h=o&&n.from===e&&n.to===e,c=l(n.from,0),u=l(n.to,s-1);if(c>u)if(o)c-=s;else{var d=c;c=u,u=d}if(/^(?:asymmetric|continuous)$/.test(r)){var f="asymmetric"===r,g=Math.min,p=u-c+1,m=p-1,v=h?g(p,4):1,_=v,y=v,x=[];if(o||(_=g(1,c),y=g(1,s-u-1)),(m+=_+y)<=1)return;for(var b=0,I=c-_;b<=m;b++,I++)x[b]=a[(I<0?I+s:I)%s]._point;var C=x[0]._x+2*x[1]._x,w=x[0]._y+2*x[1]._y,S=2,M=m-1,A=[C],T=[w],k=[S],D=[],P=[];for(b=1;b<m;b++){var E=b<M,O=E?4:f?2:7,B=E?4:f?3:8,R=E?2:f?0:1,L=(E||f?1:2)/S;S=k[b]=O-L,C=A[b]=B*x[b]._x+R*x[b+1]._x-L*C,w=T[b]=B*x[b]._y+R*x[b+1]._y-L*w}for(D[M]=A[M]/k[M],P[M]=T[M]/k[M],b=m-2;b>=0;b--)D[b]=(A[b]-D[b+1])/k[b],P[b]=(T[b]-P[b+1])/k[b];D[m]=(3*x[m]._x-D[M])/2,P[m]=(3*x[m]._y-P[M])/2,b=_;var F=m-y;for(I=c;b<=F;b++,I++){var G=a[I<0?I+s:I],N=G._point,U=D[b]-N._x,j=P[b]-N._y;(h||b<F)&&G.setHandleOut(U,j),(h||b>_)&&G.setHandleIn(-U,-j)}}else for(b=c;b<=u;b++)a[b<0?b+s:b].smooth(n,!h&&b===c,!h&&b===u)},toShape:function(t){if(!this._closed)return null;var i,n,r,a,s,o,l,h=this._segments;function c(t,e){var i=h[t],n=i.getNext(),r=h[e],a=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&a._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(a._point.subtract(r._point))}function u(t){var e=h[t],i=e.getNext(),n=e._handleOut,r=i._handleIn,a=.5522847498307936;if(n.isOrthogonal(r)){var s=e._point,o=i._point,l=new b(s,n,!0).intersect(new b(o,r,!0),!0);return l&&d.isZero(n.getLength()/l.subtract(s).getLength()-a)&&d.isZero(r.getLength()/l.subtract(o).getLength()-a)}return!1}function f(t,e){return h[t]._point.getDistance(h[e]._point)}if(!this.hasHandles()&&4===h.length&&c(0,2)&&c(1,3)&&(s=h[1],o=s.getPrevious(),l=s.getNext(),o._handleOut.isZero()&&s._handleIn.isZero()&&s._handleOut.isZero()&&l._handleIn.isZero()&&s._point.subtract(o._point).isOrthogonal(l._point.subtract(s._point)))?(i=M.Rectangle,n=new m(f(0,3),f(0,1)),a=h[1]._point.add(h[2]._point).divide(2)):8===h.length&&u(0)&&u(2)&&u(4)&&u(6)&&c(1,5)&&c(3,7)?(i=M.Rectangle,r=(n=new m(f(1,6),f(0,3))).subtract(new m(f(0,7),f(1,2))).divide(2),a=h[3]._point.add(h[4]._point).divide(2)):4===h.length&&u(0)&&u(1)&&u(2)&&u(3)&&(d.isZero(f(0,2)-f(1,3))?(i=M.Circle,r=f(0,2)/2):(i=M.Ellipse,r=new m(f(2,0)/2,f(3,1)/2)),a=h[1]._point),i){var g=this.getPosition(!0),p=new i({center:g,size:n,radius:r,insert:!1});return p.copyAttributes(this,!0),p._matrix.prepend(this._matrix),p.rotate(a.subtract(g).getAngle()+90),(t===e||t)&&p.insertAbove(this),p}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof L)return t.base.call(this,e);var i=this.getCurves(),n=e.getCurves(),r=i.length,a=n.length;if(!r||!a)return r==a;for(var s,o,l=i[0].getValues(),h=[],c=0,u=0,d=0;d<a;d++){var f=n[d].getValues();if(h.push(f),m=z.getOverlaps(l,f)){s=!d&&m[0][0]>0?a-1:d,o=m[0][1];break}}var g,p=Math.abs;for(f=h[s];l&&f;){var m;if((m=z.getOverlaps(l,f))&&p(m[0][0]-u)<1e-8){1===(u=m[1][0])&&(l=++c<r?i[c].getValues():null,u=0);var v=m[0][1];if(p(v-o)<1e-8){if(g||(g=[s,v]),1===(o=m[1][1])&&(++s>=a&&(s=0),f=h[s]||n[s].getValues(),o=0),!l)return g[0]===s&&g[1]===o;continue}}break}return!1},_hitTestSelf:function(t,e,i,n){var r,a,s,o,l,h,c=this,u=this.getStyle(),d=this._segments,f=d.length,g=this._closed,p=e._tolerancePadding,m=p,v=e.stroke&&u.hasStroke(),_=e.fill&&u.hasFill(),y=e.curves,x=v?u.getStrokeWidth()/2:_&&e.tolerance>0||y?0:null;function b(e,i){return t.subtract(e).divide(i).length<=1}function I(t,i,n){if(!e.selected||i.isSelected()){var r=t._point;if(i!==r&&(i=i.add(r)),b(i,m))return new D(n,c,{segment:t,point:i})}}function C(t,i){return(i||e.segments)&&I(t,t._point,"segment")||!i&&e.handles&&(I(t,t._handleIn,"handle-in")||I(t,t._handleOut,"handle-out"))}function w(t){o.add(t)}function S(e){var i,l=g||e._index>0&&e._index<f-1;return"round"===(l?r:a)?b(e._point,m):(o=new R({internal:!0,closed:!0}),l?e.isSmooth()||R._addBevelJoin(e,r,x,s,null,n,w,!0):"square"===a&&R._addSquareCap(e,a,x,null,n,w,!0),o.isEmpty()?void 0:o.contains(t)||(i=o.getNearestLocation(t))&&b(i.getPoint(),p))}if(null!==x&&(x>0?(r=u.getStrokeJoin(),a=u.getStrokeCap(),s=u.getMiterLimit(),m=m.add(R._getStrokePadding(x,n))):r=a="round"),!e.ends||e.segments||g){if(e.segments||e.handles)for(var M=0;M<f;M++)if(h=C(d[M]))return h}else if(h=C(d[0],!0)||C(d[f-1],!0))return h;if(null!==x){if(l=this.getNearestLocation(t)){var A=l.getTime();0===A||1===A&&f>1?S(l.getSegment())||(l=null):b(l.getPoint(),m)||(l=null)}if(!l&&"miter"===r&&f>1)for(M=0;M<f;M++){var T=d[M];if(t.getDistance(T._point)<=s*x&&S(T)){l=T.getLocation();break}}}return!l&&_&&this._contains(t)||l&&!v&&!y?new D("fill",this):l?new D(v?"stroke":"curve",this,{location:l,point:l.getPoint()}):null}},r.each(z._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=g.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var a=i,s=e[n];if((i+=s.getLength())>t)return s.getLocationAt(t-a)}if(e.length>0&&t<=this.getLength())return new O(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null},getOffsetsWithTangent:function(){var t=g.read(arguments);if(t.isZero())return[];for(var e=[],i=0,n=this.getCurves(),r=0,a=n.length;r<a;r++){for(var s=n[r],o=s.getTimesWithTangent(t),l=0,h=o.length;l<h;l++){var c=i+s.getOffsetAtTime(o[l]);e.indexOf(c)<0&&e.push(c)}i+=s.length}return e}}),new function(){function t(t,e,i){var n,r,a,s,o,l,h,c,u=e._segments,d=u.length,f=new Array(6),g=!0;function p(e){if(i)e._transformCoordinates(i,f),n=f[0],r=f[1];else{var u=e._point;n=u._x,r=u._y}if(g)t.moveTo(n,r),g=!1;else{if(i)o=f[2],l=f[3];else{var d=e._handleIn;o=n+d._x,l=r+d._y}o===n&&l===r&&h===a&&c===s?t.lineTo(n,r):t.bezierCurveTo(h,c,o,l,n,r)}a=n,s=r,i?(h=f[4],c=f[5]):(d=e._handleOut,h=a+d._x,c=s+d._y)}for(var m=0;m<d;m++)p(u[m]);e._closed&&d>0&&p(u[0])}return{_draw:function(e,i,n,r){var a=i.dontStart,s=i.dontFinish||i.clip,o=this.getStyle(),l=o.hasFill(),h=o.hasStroke(),c=o.getDashArray(),u=!lt.support.nativeDash&&h&&c&&c.length;function d(t){return c[(t%u+u)%u]}if(a||e.beginPath(),(l||h&&!u||s)&&(t(e,this,r),this._closed&&e.closePath()),!s&&(l||h)&&(this._setStyles(e,i,n),l&&(e.fill(o.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),h)){if(u){a||e.beginPath();for(var f,g=new F(this,.25,32,!1,r),p=g.length,m=-o.getDashOffset(),v=0;m>0;)m-=d(v--)+d(v--);for(;m<p;)f=m+d(v++),(m>0||f>0)&&g.drawPart(e,Math.max(m,0),Math.max(f,0)),m=f+d(v++)}e.stroke()}},_drawSelected:function(e,i){e.beginPath(),t(e,this,i),e.stroke(),function(t,e,i,n){if(!(n<=0))for(var r,a,s=n/2,o=n-2,l=s-1,h=new Array(6),c=0,u=e.length;c<u;c++){var d=e[c],f=d._selection;if(d._transformCoordinates(i,h),r=h[0],a=h[1],2&f&&p(2),4&f&&p(4),t.fillRect(r-s,a-s,n,n),o>0&&!(1&f)){var g=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(r-l,a-l,o,o),t.fillStyle=g}}function p(e){var i=h[e],n=h[e+1];(r!=i||a!=n)&&(t.beginPath(),t.moveTo(r,a),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,s,0,2*Math.PI,!0),t.fill())}}(e,this._segments,i,lt.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new P(g.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new P(g.read(arguments))])},cubicCurveTo:function(){var e=arguments,i=g.read(e),n=g.read(e),r=g.read(e),a=t(this);a.setHandleOut(i.subtract(a._point)),this._add([new P(r,n.subtract(r))])},quadraticCurveTo:function(){var e=arguments,i=g.read(e),n=g.read(e),r=t(this)._point;this.cubicCurveTo(i.add(r.subtract(i).multiply(1/3)),i.add(n.subtract(i).multiply(1/3)),n)},curveTo:function(){var e=arguments,i=g.read(e),n=g.read(e),a=r.pick(r.read(e),.5),s=1-a,o=t(this)._point,l=i.subtract(o.multiply(s*s)).subtract(n.multiply(a*a)).divide(2*a*s);if(l.isNaN())throw new Error("Cannot put a curve through points with parameter = "+a);this.quadraticCurveTo(l,n)},arcTo:function(){var e,i,n,a,s=arguments,o=Math.abs,l=Math.sqrt,h=t(this),c=h._point,u=g.read(s),f=r.peek(s);if("boolean"==typeof(I=r.pick(f,!0)))var p=(w=c.add(u).divide(2)).add(w.subtract(c).rotate(I?-90:90));else if(r.remain(s)<=2)p=u,u=g.read(s);else if(!c.equals(u)){var v=m.read(s),_=d.isZero;if(_(v.width)||_(v.height))return this.lineTo(u);var y=r.read(s),I=!!r.read(s),C=!!r.read(s),w=c.add(u).divide(2),S=(Y=c.subtract(w).rotate(-y)).x,M=Y.y,A=o(v.width),T=o(v.height),k=A*A,D=T*T,E=S*S,z=M*M,O=l(E/k+z/D);if(O>1&&(k=(A*=O)*A,D=(T*=O)*T),o(O=(k*D-k*z-D*E)/(k*z+D*E))<1e-12&&(O=0),O<0)throw new Error("Cannot create an arc with the given arguments");e=new g(A*M/T,-T*S/A).multiply((C===I?-1:1)*l(O)).rotate(y).add(w),i=(n=(a=(new x).translate(e).rotate(y).scale(A,T))._inverseTransform(c)).getDirectedAngle(a._inverseTransform(u)),!I&&i>0?i-=360:I&&i<0&&(i+=360)}if(p){var B=new b(c.add(p).divide(2),p.subtract(c).rotate(90),!0),R=new b(p.add(u).divide(2),u.subtract(p).rotate(90),!0),L=new b(c,u),F=L.getSide(p);if(!(e=B.intersect(R,!0))){if(!F)return this.lineTo(u);throw new Error("Cannot create an arc with the given arguments")}i=(n=c.subtract(e)).getDirectedAngle(u.subtract(e));var G=L.getSide(e,!0);0===G?i=F*o(i):F===G&&(i+=i<0?360:-360)}if(i){for(var N=o(i),U=N>=360?4:Math.ceil((N-1e-5)/90),j=i/U,Z=j*Math.PI/360,W=4/3*Math.sin(Z)/(1+Math.cos(Z)),V=[],X=0;X<=U;X++){var Y=u,H=null;if(X<U&&(H=n.rotate(90).multiply(W),a?(Y=a._transformPoint(n),H=a._transformPoint(n.add(H)).subtract(Y)):Y=e.add(n)),X){var q=n.rotate(-90).multiply(W);a&&(q=a._transformPoint(n.add(q)).subtract(Y)),V.push(new P(Y,q,H))}else h.setHandleOut(H);n=n.rotate(j)}this._add(V)}},lineBy:function(){var e=g.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=arguments,i=g.read(e),n=g.read(e),a=r.read(e),s=t(this)._point;this.curveTo(s.add(i),s.add(n),a)},cubicCurveBy:function(){var e=arguments,i=g.read(e),n=g.read(e),r=g.read(e),a=t(this)._point;this.cubicCurveTo(a.add(i),a.add(n),a.add(r))},quadraticCurveBy:function(){var e=arguments,i=g.read(e),n=g.read(e),r=t(this)._point;this.quadraticCurveTo(r.add(i),r.add(n))},arcBy:function(){var e=arguments,i=t(this)._point,n=i.add(g.read(e)),a=r.pick(r.peek(e),!0);"boolean"==typeof a?this.arcTo(n,a):this.arcTo(n,i.add(g.read(e)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return R[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,a){var s=t[0];if(!s)return new _;var o=new Array(6),l=s._transformCoordinates(n,new Array(6)),h=l.slice(0,2),c=h.slice(),u=new Array(2);function d(t){t._transformCoordinates(n,o);for(var e=0;e<2;e++)z._addBounds(l[e],l[e+4],o[e+2],o[e],e,a?a[e]:0,h,c,u);var i=l;l=o,o=i}for(var f=1,g=t.length;f<g;f++)d(t[f]);return e&&d(s),new _(h[0],h[1],c[0]-h[0],c[1]-h[1])},getStrokeBounds:function(t,e,i,n,r){var a=i.getStyle(),s=a.hasStroke(),o=a.getStrokeWidth(),l=s&&i._getStrokeMatrix(n,r),h=s&&R._getStrokePadding(o,l),c=R.getBounds(t,e,i,n,r,h);if(!s)return c;var u=o/2,d=a.getStrokeJoin(),f=a.getStrokeCap(),g=a.getMiterLimit(),p=new _(new m(h));function v(t){c=c.include(t)}function y(t){c=c.unite(p.setCenter(t._point.transform(n)))}function x(t,e){"round"===e||t.isSmooth()?y(t):R._addBevelJoin(t,e,u,g,n,l,v)}function b(t,e){"round"===e?y(t):R._addSquareCap(t,e,u,n,l,v)}var I=t.length-(e?0:1);if(I>0){for(var C=1;C<I;C++)x(t[C],d);e?x(t[0],d):(b(t[0],f),b(t[t.length-1],f))}return c},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new g(t,0).transform(e),n=new g(0,t).transform(e),r=i.getAngleInRadians(),a=i.getLength(),s=n.getLength(),o=Math.sin(r),l=Math.cos(r),h=Math.tan(r),c=Math.atan2(s*h,a),u=Math.atan2(s,h*a);return[Math.abs(a*Math.cos(c)*l+s*Math.sin(c)*o),Math.abs(s*Math.sin(u)*l+a*Math.cos(u)*o)]},_addBevelJoin:function(t,e,i,n,r,a,s,o){var l=t.getCurve(),h=l.getPrevious(),c=l.getPoint1().transform(r),u=h.getNormalAtTime(1).multiply(i).transform(a),d=l.getNormalAtTime(0).multiply(i).transform(a),f=u.getDirectedAngle(d);if((f<0||f>=180)&&(u=u.negate(),d=d.negate()),o&&s(c),s(c.add(u)),"miter"===e){var p=new b(c.add(u),new g(-u.y,u.x),!0).intersect(new b(c.add(d),new g(-d.y,d.x),!0),!0);p&&c.getDistance(p)<=n*i&&s(p)}s(c.add(d))},_addSquareCap:function(t,e,i,n,r,a,s){var o=t._point.transform(n),l=t.getLocation(),h=l.getNormal().multiply(0===l.getTime()?i:-i).transform(r);"square"===e&&(s&&(a(o.subtract(h)),a(o.add(h))),o=o.add(h.rotate(-90))),a(o.add(h)),a(o.subtract(h))},getHandleBounds:function(t,e,i,n,r){var a,s,o=i.getStyle();if(r.stroke&&o.hasStroke()){var l=i._getStrokeMatrix(n,r),h=o.getStrokeWidth()/2,c=h;"miter"===o.getStrokeJoin()&&(c=h*o.getMiterLimit()),"square"===o.getStrokeCap()&&(c=Math.max(c,h*Math.SQRT2)),a=R._getStrokePadding(h,l),s=R._getStrokePadding(c,l)}for(var u=new Array(6),d=1/0,f=-d,g=d,p=f,m=0,v=t.length;m<v;m++){t[m]._transformCoordinates(n,u);for(var y=0;y<6;y+=2){var x=y?a:s,b=x?x[0]:0,I=x?x[1]:0,C=u[y],w=u[y+1],S=C-b,M=C+b,A=w-I,T=w+I;S<d&&(d=S),M>f&&(f=M),A<g&&(g=A),T>p&&(p=T)}}return new _(d,g,f-d,p-g)}}});R.inject({statics:new function(){var t=.5522847498307936,e=[new P([-1,0],[0,t],[0,-t]),new P([0,-1],[-t,0],[t,0]),new P([1,0],[0,-t],[0,t]),new P([0,1],[t,0],[-t,0])];function i(t,e,i){var n=r.getNamed(i),a=new R(n&&(1==n.insert?C.INSERT:0==n.insert?C.NO_INSERT:null));return a._add(t),a._closed=e,a.set(n,C.INSERT)}function n(t,n,r){for(var a=new Array(4),s=0;s<4;s++){var o=e[s];a[s]=new P(o._point.multiply(n).add(t),o._handleIn.multiply(n),o._handleOut.multiply(n))}return i(a,!0,r)}return{Line:function(){var t=arguments;return i([new P(g.readNamed(t,"from")),new P(g.readNamed(t,"to"))],!1,t)},Circle:function(){var t=arguments,e=g.readNamed(t,"center"),i=r.readNamed(t,"radius");return n(e,new m(i),t)},Rectangle:function(){var e,n=arguments,r=_.readNamed(n,"rectangle"),a=m.readNamed(n,"radius",0,{readNull:!0}),s=r.getBottomLeft(!0),o=r.getTopLeft(!0),l=r.getTopRight(!0),h=r.getBottomRight(!0);if(!a||a.isZero())e=[new P(s),new P(o),new P(l),new P(h)];else{var c=(a=m.min(a,r.getSize(!0).divide(2))).width,u=a.height,d=c*t,f=u*t;e=[new P(s.add(c,0),null,[-d,0]),new P(s.subtract(0,u),[0,f]),new P(o.add(0,u),null,[0,-f]),new P(o.add(c,0),[-d,0],null),new P(l.subtract(c,0),null,[d,0]),new P(l.add(0,u),[0,-f],null),new P(h.subtract(0,u),null,[0,f]),new P(h.subtract(c,0),[d,0])]}return i(e,!0,n)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=arguments,e=M._readEllipse(t);return n(e.center,e.radius,t)},Oval:"#Ellipse",Arc:function(){var t=arguments,e=g.readNamed(t,"from"),i=g.readNamed(t,"through"),n=g.readNamed(t,"to"),a=r.getNamed(t),s=new R(a&&0==a.insert&&C.NO_INSERT);return s.moveTo(e),s.arcTo(i,n),s.set(a)},RegularPolygon:function(){for(var t=arguments,e=g.readNamed(t,"center"),n=r.readNamed(t,"sides"),a=r.readNamed(t,"radius"),s=360/n,o=n%3==0,l=new g(0,o?-a:a),h=o?-1:.5,c=new Array(n),u=0;u<n;u++)c[u]=new P(e.add(l.rotate((u+h)*s)));return i(c,!0,t)},Star:function(){for(var t=arguments,e=g.readNamed(t,"center"),n=2*r.readNamed(t,"points"),a=r.readNamed(t,"radius1"),s=r.readNamed(t,"radius2"),o=360/n,l=new g(0,-1),h=new Array(n),c=0;c<n;c++)h[c]=new P(e.add(l.rotate(o*c).multiply(c%2?s:a)));return i(h,!0,t)}}}});var L=B.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,i){var n=i,a=n[0];a&&"number"==typeof a[0]&&(n=[n]);for(var s=i.length-1;s>=0;s--){var o=n[s];n===i&&!(o instanceof R)&&(n=r.slice(n)),Array.isArray(o)?n[s]=new R({segments:o,insert:!1}):o instanceof L&&(n.splice.apply(n,[s,1].concat(o.removeChildren())),o.remove())}return t.base.call(this,e,n)},reduce:function t(e){for(var i=this._children,n=i.length-1;n>=0;n--)(r=i[n].reduce(e)).isEmpty()&&r.remove();var r;return i.length?t.base.call(this):((r=new R(C.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)r.push(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,a=i.length;r<a;r++){var s=i[r],o=s._matrix;n.push(s.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join("")},_hitTestChildren:function t(e,i,n){return t.base.call(this,e,i.class===R||"path"===i.type?i:r.set({},i,{fill:!1}),n)},_draw:function(t,e,i,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var a=0,s=r.length;a<s;a++)r[a].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,a=n.length;r<a;r++){var s=n[r],o=s._matrix;i[s._id]||s._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var i=t._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new R(C.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=g.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,a=n.length;r<a;r++)i=n[r][t](e)||i;return i}},{}));B.inject(new function(){var t=Math.min,i=Math.max,n=Math.abs,a={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function s(t){return t._children||[t]}function o(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(e){for(var n=s(i),r=0,a=n.length;r<a;r++)!(t=n[r])._closed&&!t.isEmpty()&&(t.closePath(1e-12),t.getFirstSegment().setHandleIn(0,0),t.getLastSegment().setHandleOut(0,0));i=i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0)}return i}function l(t,e,i,n,r){var a=new L(C.NO_INSERT);return a.addChildren(t,!0),a=a.reduce({simplify:e}),r&&0==r.insert||a.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),a.copyAttributes(i,!0),a}function h(t){return t.hasOverlap()||t.isCrossing()}function u(t,e,i,n){if(n&&(0==n.trace||n.stroke)&&/^(subtract|intersect)$/.test(i))return f(t,e,i);var u=o(t,!0),d=e&&t!==e&&o(e,!0),g=a[i];g[i]=!0,d&&(g.subtract||g.exclude)^d.isClockwise()^u.isClockwise()&&d.reverse();var p,_=v(O.expand(u.getIntersections(d,h))),b=s(u),I=d&&s(d),C=[],w=[];function S(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];r.push(C,n._segments),r.push(w,n.getCurves()),n._overlapsOnly=!0}}function M(t){for(var e=[],i=0,n=t&&t.length;i<n;i++)e.push(w[t[i]]);return e}if(_.length){S(b),I&&S(I);for(var A=new Array(w.length),T=0,k=w.length;T<k;T++)A[T]=w[T].getValues();var D=c.findCurveBoundsCollisions(A,A,0,!0),P={};for(T=0;T<w.length;T++){var E=w[T],z=E._path._id;(P[z]=P[z]||{})[E.getIndex()]={hor:M(D[T].hor),ver:M(D[T].ver)}}for(T=0,k=_.length;T<k;T++)y(_[T]._segment,u,d,P,g);for(T=0,k=C.length;T<k;T++){var B=C[T],R=B._intersection;B._winding||y(B,u,d,P,g),R&&R._overlap||(B._path._overlapsOnly=!1)}p=x(C,g)}else p=m(I?b.concat(I):b.slice(),function(t){return!!g[t]});return l(p,!0,t,e,n)}function f(t,e,i){var n=o(t),r=o(e),a=n.getIntersections(r,h),s="subtract"===i,c="divide"===i,u={},d=[];function f(t){if(!u[t._id]&&(c||r.contains(t.getPointAt(t.getLength()/2))^s))return d.unshift(t),u[t._id]=!0}for(var g=a.length-1;g>=0;g--){var p=a[g].split();p&&(f(p)&&p.getFirstSegment().setHandleIn(0,0),n.getLastSegment().setHandleOut(0,0))}return f(n),l(d,!1,t,e)}function g(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function p(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function m(t,e,i){var a=t&&t.length;if(a){var s=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),o=t.slice().sort(function(t,e){return n(e.getArea())-n(t.getArea())}),l=o[0],h=c.findItemBoundsCollisions(o,null,d.GEOMETRIC_EPSILON);null==i&&(i=l.isClockwise());for(var u=0;u<a;u++){var f=o[u],g=s[f._id],p=0,m=h[u];if(m)for(var v=null,_=m.length-1;_>=0;_--)if(m[_]<u){v=v||f.getInteriorPoint();var y=o[m[_]];if(y.contains(v)){var x=s[y._id];p=x.winding,g.winding+=p,g.container=x.exclude?x.container:y;break}}if(e(g.winding)===e(p))g.exclude=!0,t[g.index]=null;else{var b=g.container;f.setClockwise(b?!b.isClockwise():i)}}}return t}function v(t,e,i){var n,r,a,s=e&&[],o=1e-8,l=!1,h=i||[],c=i&&{};function u(t){return t._path._id+"."+t._segment1._index}for(var d=(i&&i.length)-1;d>=0;d--)(f=i[d])._path&&(c[u(f)]=!0);for(d=t.length-1;d>=0;d--){var f,m,v=t[d],_=v._time,y=_,x=e&&!e(v);if((f=v._curve)&&(f!==r?(l=!f.hasHandles()||c&&c[u(f)],n=[],a=null,r=f):a>=o&&(_/=a)),x)n&&n.push(v);else{if(e&&s.unshift(v),a=y,_<o)m=f._segment1;else if(_>.99999999)m=f._segment2;else{var b=f.divideAtTime(_,!0);l&&h.push(f,b),m=b._segment1;for(var I=n.length-1;I>=0;I--){var C=n[I];C._time=(C._time-_)/(1-_)}}v._setSegment(m);var w=m._intersection,S=v._intersection;if(w){g(w,S);for(var M=w;M;)g(M._intersection,w),M=M._next}else m._intersection=S}}return i||p(h),s||t}function _(e,r,a,s,o){var l,h,c=Array.isArray(r)?r:r[a?"hor":"ver"],u=a?1:0,d=1^u,f=[e.x,e.y],g=f[u],p=f[d],m=1e-6,v=g-1e-9,y=g+1e-9,x=0,b=0,I=0,C=0,w=!1,S=!1,M=1,A=[];function T(n){var h=n[d+0],c=n[d+6];if(!(p<t(h,c)||p>i(h,c))){var f=n[u+0],x=n[u+2],b=n[u+4],S=n[u+6];if(h===c)return void((f<y&&S>v||S<y&&f>v)&&(w=!0));var T=p===h?0:p===c||v>i(f,x,b,S)||y<t(f,x,b,S)?1:z.solveCubic(n,d,p,A,0,1)>0?A[0]:1,k=0===T?f:1===T?S:z.getPoint(n,T)[a?"y":"x"],D=h>c?1:-1,P=l[d]>l[d+6]?1:-1,E=l[u+6];return p!==h?(k<v?I+=D:k>y?C+=D:w=!0,k>g-m&&k<g+m&&(M/=2)):(D!==P?f<v?I+=D:f>y&&(C+=D):f!=E&&(E<y&&k>y?(C+=D,w=!0):E>v&&k<v&&(I+=D,w=!0)),M/=4),l=n,!o&&k>v&&k<y&&0===z.getTangent(n,T)[a?"x":"y"]&&_(e,r,!a,s,!0)}}function k(e){var n=e[d+0],r=e[d+2],s=e[d+4],o=e[d+6];if(p<=i(n,r,s,o)&&p>=t(n,r,s,o))for(var l,h=e[u+0],c=e[u+2],f=e[u+4],g=e[u+6],m=v>i(h,c,f,g)||y<t(h,c,f,g)?[e]:z.getMonoCurves(e,a),_=0,x=m.length;_<x;_++)if(l=T(m[_]))return l}for(var D=0,P=c.length;D<P;D++){var E,O=c[D],B=O._path,R=O.getValues();if(!(D&&c[D-1]._path===B||(l=null,B._closed||(h=z.getValues(B.getLastCurve().getSegment2(),O.getSegment1(),null,!s),h[d]!==h[d+6]&&(l=h)),l))){l=R;for(var L=B.getLastCurve();L&&L!==O;){var F=L.getValues();if(F[d]!==F[d+6]){l=F;break}L=L.getPrevious()}}if(E=k(R))return E;if(D+1===P||c[D+1]._path!==B){if(h&&(E=k(h)))return E;w&&!I&&!C&&(I=C=B.isClockwise(s)^a?1:-1),x+=I,b+=C,I=C=0,w&&(S=!0,w=!1),h=null}}return x=n(x),b=n(b),{winding:i(x,b),windingL:x,windingR:b,quality:M,onPath:S}}function y(t,e,i,r,a){var s=[],o=t,l=0;do{if(y=t.getCurve()){var h=y.getLength();s.push({segment:t,curve:y,length:h}),l+=h}t=t.getNext()}while(t&&!t._intersection&&t!==o);for(var c=[.5,.25,.75],u={winding:0,quality:-1},f=0;f<c.length&&u.quality<.5;f++){h=l*c[f];for(var g=0,p=s.length;g<p;g++){var m=s[g],v=m.length;if(h<=v){var y,x=(y=m.curve)._path,b=x._parent,I=b instanceof L?b:x,C=d.clamp(y.getTimeAt(h),.001,.999),w=y.getPointAtTime(C),S=n(y.getTangentAtTime(C).y)<Math.SQRT1_2,M=null;if(a.subtract&&i){var A=(I===e?i:e)._getWinding(w,S,!0);if(I===e&&A.winding||I===i&&!A.winding){if(A.quality<1)continue;M={winding:0,quality:1}}}(M=M||_(w,r[x._id][y.getIndex()],S,!0)).quality>u.quality&&(u=M);break}h-=v}}for(g=s.length-1;g>=0;g--)s[g].segment._winding=u}function x(t,e){var i,n=[];function r(t){var i;return!(!t||t._visited||e&&(!e[(i=t._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function a(t){if(t)for(var e=0,n=i.length;e<n;e++)if(t===i[e])return!0;return!1}function s(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}function o(t,e){var n=t._intersection,s=n,o=[];function l(n,s){for(;n&&n!==s;){var l=n._segment,h=l&&l._path;if(h){var c=l.getNext()||h.getFirstSegment(),u=c._intersection;l!==t&&(a(l)||a(c)||c&&r(l)&&(r(c)||u&&r(u._segment)))&&o.push(l),e&&i.push(l)}n=n._next}}if(e&&(i=[t]),n){for(l(n);n&&n._previous;)n=n._previous;l(n,s)}return o}t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),a=!(!n||!n._overlap),s=t._path,o=e._path;return r^a?r?1:-1:!i^!n?i?1:-1:s!==o?s._id-o._id:t._index-e._index});for(var l=0,h=t.length;l<h;l++){var c,u,d,f=t[l],g=r(f),p=null,m=!1,v=!0,_=[];if(g&&f._path._overlapsOnly){var y=f._path,x=f._intersection._segment._path;y.compare(x)&&(y.getArea()&&n.push(y.clone(!1)),s(y),s(x),g=!1)}for(;g;){var b=!p,I=o(f,b),w=I.shift(),S=!(m=!b&&(a(f)||a(w)))&&w;if(b&&(p=new R(C.NO_INSERT),c=null),m){(f.isFirst()||f.isLast())&&(v=f._path._closed),f._visited=!0;break}if(S&&c&&(_.push(c),c=null),c||(S&&I.push(f),c={start:p._segments.length,crossings:I,visited:u=[],handleIn:d}),S&&(f=w),!r(f)){p.removeSegments(c.start);for(var M=0,A=u.length;M<A;M++)u[M]._visited=!1;u.length=0;do{(!(f=c&&c.crossings.shift())||!f._path)&&(f=null,(c=_.pop())&&(u=c.visited,d=c.handleIn))}while(c&&!r(f));if(!f)break}var T=f.getNext();p.add(new P(f._point,d,T&&f._handleOut)),f._visited=!0,u.push(f),f=T||f._path.getFirstSegment(),d=T&&T._handleIn}m&&(v&&(p.getFirstSegment().setHandleIn(d),p.setClosed(v)),0!==p.getArea()&&n.push(p))}return n}return{_getWinding:function(t,e,i){return _(t,this.getCurves(),e,i)},unite:function(t,e){return u(this,t,"unite",e)},intersect:function(t,e){return u(this,t,"intersect",e)},subtract:function(t,e){return u(this,t,"subtract",e)},exclude:function(t,e){return u(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?f(this,t,"divide"):l([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function i(t,e){var i=t&&t._intersection;return i&&i._overlap&&i._path===e}var n=!1,a=!1,s=this.getIntersections(null,function(t){return t.hasOverlap()&&(n=!0)||t.isCrossing()&&(a=!0)}),o=n&&a&&[];if(s=O.expand(s),n)for(var l=v(s,function(t){return t.hasOverlap()},o),h=l.length-1;h>=0;h--){var c=l[h],u=c._path,d=c._segment,f=d.getPrevious(),g=d.getNext();i(f,u)&&i(g,u)&&(d.remove(),f._handleOut._set(0,0),g._handleIn._set(0,0),f!==d&&!f.getCurve().hasLength()&&(g._handleIn.set(f._handleIn),f.remove()))}a&&(v(s,n&&function(t){var e=t.getCurve(),i=t.getSegment(),n=t._intersection,r=n._curve,a=n._segment;if(e&&r&&e._path&&r._path)return!0;i&&(i._intersection=null),a&&(a._intersection=null)},o),o&&p(o),e=x(r.each(e,function(t){r.push(this,t._segments)},[])));var m,_=e.length;return _>1&&t?(e!==t&&this.setChildren(e),m=this):1===_&&!t&&(e[0]!==this&&this.setSegments(e[0].removeSegments()),m=this),m||((m=new L(C.NO_INSERT)).addChildren(e),(m=m.reduce()).copyAttributes(this),this.replaceWith(m)),m},reorient:function(t,i){var n=this._children;return n&&n.length?this.setChildren(m(this.removeChildren(),function(e){return!!(t?e:1&e)},i)):i!==e&&this.setClockwise(i),this},getInteriorPoint:function(){var e=this.getBounds().getCenter(!0);if(!this.contains(e)){for(var n=this.getCurves(),r=e.y,a=[],s=[],o=0,l=n.length;o<l;o++){var h=n[o].getValues(),c=h[1],u=h[3],d=h[5],f=h[7];if(r>=t(c,u,d,f)&&r<=i(c,u,d,f))for(var g=z.getMonoCurves(h),p=0,m=g.length;p<m;p++){var v=g[p],_=v[1],y=v[7];if(_!==y&&(r>=_&&r<=y||r>=y&&r<=_)){var x=r===_?v[0]:r===y?v[6]:1===z.solveCubic(v,1,r,s,0,1)?z.getPoint(v,s[0]).x:(v[0]+v[6])/2;a.push(x)}}}a.length>1&&(a.sort(function(t,e){return t-e}),e.x=(a[0]+a[1])/2)}return e}}});var F=r.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){var a,s=[],o=[],l=0,h=1/(i||32),c=t._segments,u=c[0];function d(t,i){var a=z.getValues(t,i,r);s.push(a),function t(i,r,a,s){if(!(s-a>h)||n&&z.isStraight(i)||z.isFlatEnough(i,e||.25)){var c=i[6]-i[0],u=i[7]-i[1],d=Math.sqrt(c*c+u*u);d>0&&(l+=d,o.push({offset:l,curve:i,index:r,time:s}))}else{var f=z.subdivide(i,.5),g=(a+s)/2;t(f[0],r,a,g),t(f[1],r,g,s)}}(a,t._index,0,1)}for(var f=1,g=c.length;f<g;f++)d(u,a=c[f]),u=a;t._closed&&d(a||u,c[0]),this.curves=s,this.parts=o,this.length=l,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;e=r,r&&!(i[--r].offset<t););for(;e<n;e++){var a=i[e];if(a.offset>=t){this.index=e;var s=i[e-1],o=s&&s.index===a.index?s.time:0,l=s?s.offset:0;return{index:a.index,time:o+(a.time-o)*(t-l)/(a.offset-l)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),a=n.index,s=r.index;a<=s;a++){var o=z.getPart(this.curves[a],a===n.index?n.time:0,a===r.index?r.time:1);a===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(z._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return z[t](this.curves[i.index],i.time)}},{})),G=r.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,a=0,s=n.length;a<s;a++){var o=n[a].point;(!e||!e.equals(o))&&i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new P(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,a){var s=this.points;if(n-i!=1){for(var o,l=this.chordLengthParameterize(i,n),h=Math.max(e,e*e),c=!0,u=0;u<=4;u++){var d=this.generateBezier(i,n,l,r,a),f=this.findMaxError(i,n,d,l);if(f.error<e&&c)return void this.addCurve(t,d);if(o=f.index,f.error>=h)break;c=this.reparameterize(i,n,l,d),h=f.error}var g=s[o-1].subtract(s[o+1]);this.fitCubic(t,e,i,o,r,g),this.fitCubic(t,e,o,n,g.negate(),a)}else{var p=s[i],m=s[n],v=p.getDistance(m)/3;this.addCurve(t,[p,p.add(r.normalize(v)),m.add(a.normalize(v)),m])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new P(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var a=1e-12,s=Math.abs,o=this.points,l=o[t],h=o[e],c=[[0,0],[0,0]],u=[0,0],d=0,f=e-t+1;d<f;d++){var g=i[d],p=1-g,m=3*g*p,v=p*p*p,_=m*p,y=m*g,x=g*g*g,b=n.normalize(_),I=r.normalize(y),C=o[t+d].subtract(l.multiply(v+_)).subtract(h.multiply(y+x));c[0][0]+=b.dot(b),c[0][1]+=b.dot(I),c[1][0]=c[0][1],c[1][1]+=I.dot(I),u[0]+=b.dot(C),u[1]+=I.dot(C)}var w,S,M=c[0][0]*c[1][1]-c[1][0]*c[0][1];if(s(M)>a){var A=c[0][0]*u[1]-c[1][0]*u[0];w=(u[0]*c[1][1]-u[1]*c[0][1])/M,S=A/M}else{var T=c[0][0]+c[0][1],k=c[1][0]+c[1][1];w=S=s(T)>a?u[0]/T:s(k)>a?u[1]/k:0}var D,P,E=h.getDistance(l),z=a*E;if(w<z||S<z)w=S=E/3;else{var O=h.subtract(l);D=n.normalize(w),P=r.normalize(S),D.dot(O)-P.dot(O)>E*E&&(w=S=E/3,D=P=null)}return[l,l.add(D||n.normalize(w)),h.add(P||r.normalize(S)),h]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);r=1;for(var a=i.length;r<a;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],a=0;a<=2;a++)n[a]=t[a+1].subtract(t[a]).multiply(3);for(a=0;a<=1;a++)r[a]=n[a+1].subtract(n[a]).multiply(2);var s=this.evaluate(3,t,i),o=this.evaluate(2,n,i),l=this.evaluate(1,r,i),h=s.subtract(e),c=o.dot(o)+h.dot(l);return d.isMachineZero(c)?i:i-h.dot(o)/c},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var a=0;a<=t-r;a++)n[a]=n[a].multiply(1-i).add(n[a+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);n=1;for(var r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),a=0,s=t+1;s<e;s++){var o=this.evaluate(3,i,n[s-t]).subtract(this.points[s]),l=o.x*o.x+o.y*o.y;l>=a&&(a=l,r=s)}return{error:a,index:r}}}),N=C.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&g.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),U=N.extend({_class:"PointText",initialize:function(){N.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new p(t.x,t.y,this,"setPoint")},setPoint:function(){var t=g.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,a=r.hasFill(),s=r.hasStroke(),o=r.getLeading(),l=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var h=0,c=n.length;h<c;h++){t.shadowColor=l;var u=n[h];a&&(t.fillText(u,0,0),t.shadowColor="rgba(0,0,0,0)"),s&&t.strokeText(u,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,a=i.getJustification(),s=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),l=0;"left"!==a&&(l-=o/("center"===a?2:1));var h=new _(l,r?-.75*s:0,o,r*s);return t?t._transformBounds(h,h):h}}),j=r.extend(new function(){var t,e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},n={},a={transparent:[0,0,0,0]},s=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],o={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=n-Math.min(t,e,i);return[0===r?0:60*(n==t?(e-i)/r+(e<i?6:0):n==e?(i-t)/r+2:(t-e)/r+4),0===n?0:r/n,n]},"hsb-rgb":function(t,e,i){var n,r=(t=(t/60%6+6)%6)-(n=Math.floor(t)),a=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[a[(n=s[n])[0]],a[n[1]],a[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),a=n-r,s=0===a,o=(n+r)/2;return[s?0:60*(n==t?(e-i)/a+(e<i?6:0):n==e?(i-t)/a+2:(t-e)/a+4),s?0:o<.5?a/(n+r):a/(2-n-r),o]},"hsl-rgb":function(t,e,i){if(0===e)return[i,i,i];for(var n=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,a=2*i-r,s=[],o=0;o<3;o++){var l=n[o];l<0&&(l+=1),l>1&&(l-=1),s[o]=6*l<1?a+6*(r-a)*l:2*l<1?r:3*l<2?a+(r-a)*(2/3-l)*6:a}return s},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(e,function(t,i){n[i]=[],r.each(t,function(t,a){var s=r.capitalize(t),o=/^(hue|saturation)$/.test(t),l=n[i][a]="gradient"===i?"gradient"===t?function(t){var e=this._components[0];return e!==(t=Z.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:function(){return g.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:+t};this["get"+s]=function(){return this._type===i||o&&/^hs[bl]$/.test(this._type)?this._components[a]:this._convert(i)[a]},this["set"+s]=function(t){this._type!==i&&!(o&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(i),this._properties=e[i],this._type=i),this._components[a]=l.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function s(o){var l,h,c,u,d=arguments,f=this.__read,g=0;Array.isArray(o)&&(o=(d=o)[0]);var p=null!=o&&typeof o;if("string"===p&&o in e&&(l=o,o=d[1],Array.isArray(o)?(h=o,c=d[2]):(f&&(g=1),d=r.slice(d,1),p=typeof o)),!h){if(u="number"===p?d:"object"===p&&null!=o.length?o:null){l||(l=u.length>=3?"rgb":"gray");var m=e[l].length;c=u[m],f&&(g+=u===arguments?m+(null!=c?1:0):1),u.length>m&&(u=r.slice(u,0,m))}else if("string"===p){var v=function(e){var n,r=e.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||e.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),s="rgb";if(r){var o=r[4]?4:3;n=new Array(o);for(var l=0;l<o;l++){var h=r[l+1];n[l]=parseInt(1==h.length?h+h:h,16)/255}}else if(r=e.match(/^(rgb|hsl)a?\((.*)\)$/)){s=r[1],n=r[2].trim().split(/[,\s]+/g);for(var c="hsl"===s,u=(l=0,Math.min(n.length,4));l<u;l++){var d=n[l];if(h=parseFloat(d),c)if(0===l){var f=d.match(/([a-z]*)$/)[1];h*={turn:360,rad:180/Math.PI,grad:.9}[f]||1}else l<3&&(h/=100);else l<3&&(h/=/%$/.test(d)?100:255);n[l]=h}}else{var g=a[e];if(!g)if(i){t||((t=rt.getContext(1,1,{willReadFrequently:!0})).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=e,t.fillRect(0,0,1,1);var p=t.getImageData(0,0,1,1).data;g=a[e]=[p[0]/255,p[1]/255,p[2]/255]}else g=[0,0,0];n=g.slice()}return[s,n]}(o);l=v[0],4===(h=v[1]).length&&(c=h[3],h.length--)}else if("object"===p)if(o.constructor===s){if(l=o._type,h=o._components.slice(),c=o._alpha,"gradient"===l)for(var _=1,y=h.length;_<y;_++){var x=h[_];x&&(h[_]=x.clone())}}else if(o.constructor===Z)l="gradient",u=d;else{var b=e[l="hue"in o?"lightness"in o?"hsl":"hsb":"gradient"in o||"stops"in o||"radial"in o?"gradient":"gray"in o?"gray":"rgb"],I=n[l];for(this._components=h=[],_=0,y=b.length;_<y;_++)null==(C=o[b[_]])&&!_&&"gradient"===l&&"stops"in o&&(C={stops:o.stops,radial:o.radial}),null!=(C=I[_].call(this,C))&&(h[_]=C);c=o.alpha}f&&l&&(g=1)}if(this._type=l||"rgb",!h)for(this._components=h=[],_=0,y=(I=n[this._type]).length;_<y;_++){var C;null!=(C=I[_].call(this,u&&u[_]))&&(h[_]=C)}return this._components=h,this._properties=e[this._type],this._alpha=c,f&&(this.__read=g),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(t){var e;return this._type===t?this._components.slice():(e=o[this._type+"-"+t])?e.apply(this,this._components):o["rgb-"+t].apply(this,o[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new j(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=e[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?j.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=u.instance,r=0,a=t.length;r<a;r++){var s=this._components[r];null!=s&&e.push(t[r]+": "+(i?s:n.number(s)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){var e=this._convert("rgb"),i=t||null==this._alpha?1:this._alpha;function n(t){return Math.round(255*(t<0?0:t>1?1:t))}return e=[n(e[0]),n(e[1]),n(e[2])],i<1&&e.push(i<0?0:i),t?"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):(4==e.length?"rgba(":"rgb(")+e.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,n=this._components,r=n[0],a=r._stops,s=n[1],o=n[2],l=n[3],h=e&&e.inverted();if(h&&(s=h._transformPoint(s),o=h._transformPoint(o),l&&(l=h._transformPoint(l))),r._radial){var c=o.getDistance(s);if(l){var u=l.subtract(s);u.getLength()>c&&(l=s.add(u.normalize(c-.1)))}var d=l||s;i=t.createRadialGradient(d.x,d.y,0,s.x,s.y,c)}else i=t.createLinearGradient(s.x,s.y,o.x,o.y);for(var f=0,g=a.length;f<g;f++){var p,m=a[f],v=m._offset;i.addColorStop(null!==(p=v)&&void 0!==p?p:f/(g-1),m._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:e,random:function(){var t=Math.random;return new j(t(),t(),t())},_setOwner:function(t,e,i){return t&&(t._owner&&e&&t._owner!==e&&(t=t.clone()),!t._owner^!e&&(t._owner=e||null,t._setter=i||null)),t}}})},new function(){return r.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=j.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),a=0,s=n.length;a<s;a++)r[a]=t(n[a],r[a]);return new j(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),Z=r.extend({_class:"Gradient",initialize:function(t,e){this._id=f.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var i=this._owners?this._owners.indexOf(t):-1;-1!=i&&(this._owners.splice(i,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new Z(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;for(n=0,r=(i=this._stops=W.readList(t,0,{clone:!0})).length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),W=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new W(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){j._setOwner(this._color,null),this._color=j._setOwner(j.read(arguments,0),this,"setColor"),this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),V=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new g,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new j}),a={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},s={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,a){this._values={},this._owner=r,this._project=r&&r._project||a||lt.project,this._defaults=!r||r instanceof w?i:r instanceof N?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),l="shadowOffset"===i,h=r.capitalize(i),c=a[i],u="set"+h,d="get"+h;o[u]=function(t){var e=this._owner,r=e&&e._children,a=r&&r.length>0&&!(e instanceof L);if(a)for(var s=0,o=r.length;s<o;s++)r[s]._style[u](t);if(("selectedColor"===i||!a)&&i in this._defaults){var l=this._values[i];l!==t&&(n&&(l&&(j._setOwner(l,null),l._canvasStyle=null),t&&t.constructor===j&&(t=j._setOwner(t,e,a&&u))),this._values[i]=t,e&&e._changed(c||129))}},o[d]=function(t){var a=this._owner,s=a&&a._children,o=s&&s.length>0&&!(a instanceof L);if(o&&!t)for(var h=0,c=s.length;h<c;h++){var f=s[h]._style[d]();if(h){if(!r.equals(p,f))return e}else p=f}else if(i in this._defaults){var p;if((p=this._values[i])===e)(p=this._defaults[i])&&p.clone&&(p=p.clone());else{var m=n?j:l?g:null;m&&(!p||p.constructor!==m)&&(this._values[i]=p=m.read([p],0,{readNull:!0,clone:!0}))}}return p&&n&&(p=j._setOwner(p,a,o&&u)),p},s[d]=function(t){return this._style[d](t)},s[u]=function(t){this._style[u](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;o[i]=s[i]="#get"+t,o[n]=s[n]="#set"+t}),C.inject(s),o},{set:function(t){var e=t instanceof V,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){function i(t,i,n){var a=t._values,s=i._values,o=i._defaults;for(var l in a){var h=a[l],c=s[l];if(!(n&&l in s||r.equals(h,c===e?o[l]:c)))return!1}return!0}return t===this||t&&this._class===t._class&&i(this,t)&&i(t,this,!0)||!1},_dispose:function(){var t;(t=this.getFillColor())&&(t._canvasStyle=null),(t=this.getStrokeColor())&&(t._canvasStyle=null),(t=this.getShadowColor())&&(t._canvasStyle=null)},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),X=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],a=e[0].toUpperCase()+e.substring(1),s=0;s<6;s++){var o=r[s],l=o?o+a:e;if(l in t){if(!i)return t[l];t[l]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,a=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var s=i.left-(a.clientLeft||r.clientLeft||0),o=i.top-(a.clientTop||r.clientTop||0);if(!e){var l=n.defaultView;s+=l.pageXOffset||a.scrollLeft||r.scrollLeft,o+=l.pageYOffset||a.scrollTop||r.scrollTop}return new _(s,o,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new _(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return X.getBounds(t,e).getPoint()},getSize:function(t){return X.getBounds(t,!0).getSize()},isInvisible:function(t){return X.getSize(t).equals(new m(0,0))},isInView:function(t){return!X.isInvisible(t)&&X.getViewportBounds(t).intersects(X.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},Y={add:function(t,e){if(t)for(var i in e)for(var r=e[i],a=i.split(/[\s,]+/g),s=0,o=a.length;s<o;s++){var l=a[s],h=t===n&&("touchstart"===l||"touchmove"===l)&&{passive:!1};t.addEventListener(l,r,h)}},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),a=0,s=r.length;a<s;a++)t.removeEventListener(r[a],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new g(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return Y.getPoint(t).subtract(X.getOffset(e||Y.getTarget(t)))}};Y.requestAnimationFrame=new function(){var t,e=X.getPrefixed(i,"requestAnimationFrame"),n=!1,r=[];function a(){var t=r;r=[];for(var i=0,s=t.length;i<s;i++)t[i]();(n=e&&r.length)&&e(a)}return function(i){r.push(i),e?n||(e(a),n=!0):t||(t=setInterval(a,1e3/60))}};var H=r.extend(a,{_class:"View",initialize:function t(e,r){function a(t){return r[t]||parseInt(r.getAttribute(t),10)}function s(){var t=X.getSize(r);return t.isNaN()||t.isZero()?new m(a("width"),a("height")):t}var o;if(i&&r){this._id=r.getAttribute("id"),null==this._id&&r.setAttribute("id",this._id="paper-view-"+t._id++),Y.add(r,this._viewEvents);var h="none";if(X.setPrefixed(r.style,{userDrag:h,userSelect:h,touchCallout:h,contentZooming:h,tapHighlightColor:"rgba(0,0,0,0)"}),l.hasAttribute(r,"resize")){var c=this;Y.add(i,this._windowEvents={resize:function(){c.setViewSize(s())}})}if(o=s(),l.hasAttribute(r,"stats")&&typeof Stats<"u"){this._stats=new Stats;var u=this._stats.domElement,d=u.style,f=X.getOffset(r);d.position="absolute",d.left=f.x+"px",d.top=f.y+"px",n.body.appendChild(u)}}else o=new m(r),r=null;this._project=e,this._scope=e._scope,this._element=r,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(o.width,o.height),this._viewSize=o,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new x)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!lt.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;H._focused===this&&(H._focused=null),H._views.splice(H._views.indexOf(this),1),delete H._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),Y.remove(this._element,this._viewEvents),Y.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(C._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;Y.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;(!X.getPrefixed(n,"hidden")||"true"===l.getAttribute(e,"keepalive"))&&X.isInView(e)&&t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){lt=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new v(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=m.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new _(new g,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return X.isInView(this._element)},isInserted:function(){return X.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var r=i.parentNode,a=n.createElement("div");a.style.fontSize=t,r.appendChild(a),e=parseFloat(X.getStyles(a).fontSize),r.removeChild(a)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=arguments,n=(e?r:g).read(i),a=g.read(i,0,{readNull:!0});return this.transform((new x)[t](n,a||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new x;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=g.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose().scaling;return(t.x+t.y)/2},setZoom:function(t){this.transform((new x).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose().scaling;return new p(t.x,t.y,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=g.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.set.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(g.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(g.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(g.read(arguments))},getEventPoint:function(t){return this.viewToProject(Y.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return n&&"string"==typeof e&&(e=n.getElementById(e)),new(i?q:H)(t,e)}}},new function(){if(i){var t,e,r,a,s,o=!1,l=!1,h=i.navigator;h.pointerEnabled||h.msPointerEnabled?(r="pointerdown MSPointerDown",a="pointermove MSPointerMove",s="pointerup pointercancel MSPointerUp MSPointerCancel"):(r="touchstart",a="touchmove",s="touchend touchcancel","ontouchstart"in i&&h.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(r+=" mousedown",a+=" mousemove",s+=" mouseup"));var c={},u={mouseout:function(t){var e=H._focused,i=Y.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=Y.getOffset(t,e._element),r=n.x,a=Math.abs,s=a(r),o=s-(1<<25);n.x=a(o)<s?o*(r<0?-1:1):r,A(e,t,e.viewToProject(n))}},scroll:M};c[r]=function(t){var e=H._focused=S(t);o||(o=!0,e._handleMouseEvent("mousedown",t))},u[a]=function(i){var n=H._focused;if(!l){var r=S(i);r?n!==r&&(n&&A(n,i),t||(t=n),n=H._focused=e=r):e&&e===n&&(t&&!t.isInserted()&&(t=null),n=H._focused=t,t=null,M())}n&&A(n,i)},u[r]=function(){l=!0},u[s]=function(t){var e=H._focused;e&&o&&e._handleMouseEvent("mouseup",t),l=o=!1},Y.add(n,u),Y.add(i,{load:M});var d,f,g,p,m,v,_,y,x=!1,b=!1,I={doubleclick:"click",mousedrag:"mousemove"},C=!1,w={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:c,_handleMouseEvent:function(t,e,i){var n=this._itemEvents,r=n.native[t],a="mousemove"===t,s=this._scope.tool,l=this;function h(t){return n.virtual[t]||l.responds(t)||s&&s.responds(t)}a&&o&&h("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var c=this.getBounds().contains(i),u=r&&c&&l._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),I=u&&u.item||null,w=!1,S={};if(S[t.substr(5)]=!0,r&&I!==p&&(p&&T(p,null,"mouseleave",e,i),I&&T(I,null,"mouseenter",e,i),p=I),C^c&&(T(this,null,c?"mouseenter":"mouseleave",e,i),w=!0),(c||S.drag)&&!i.equals(f)&&(k(this,I,a?t:"mousemove",e,i,f),w=!0),C=c,S.down&&c||S.up&&d){if(k(this,I,t,e,i,d),S.down){if(y=I===v&&Date.now()-_<300,g=v=I,!b&&I){for(var M=I;M&&!M.responds("mousedrag");)M=M._parent;M&&(m=I)}d=i}else S.up&&(!b&&I===g&&(_=Date.now(),k(this,I,y?"doubleclick":"click",e,i,d),y=!1),g=m=null);C=!1,w=!0}f=i,w&&s&&(x=s._handleMouseEvent(t,e,i,S)||x),!1!==e.cancelable&&(x&&!S.move||S.down&&h("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){var r,a=this._scope,s=a.tool;function o(s){s.responds(t)&&(lt=a,s.emit(t,r=r||new Q(t,e,i,n)))}this.isVisible()&&(o(this),s&&s.responds(t)&&o(s))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var a in w)n[a]=(n[a]||0)+(w[a][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:M,_resetState:function(){o=l=x=C=!1,t=e=d=f=g=p=m=v=_=y=null}}}}function S(t){var e=Y.getTarget(t);return e.getAttribute&&H._viewsById[e.getAttribute("id")]}function M(){var t=H._focused;if(!t||!t.isVisible())for(var i=0,n=H._views.length;i<n;i++)if((t=H._views[i]).isVisible()){H._focused=e=t;break}}function A(t,e,i){t._handleMouseEvent("mousemove",e,i)}function T(t,e,i,n,r,a,s){var o,l=!1;function h(t,i){if(t.responds(i)){if(o||(o=new $(i,n,r,e||t,a?r.subtract(a):null)),t.emit(i,o)&&(x=!0,o.prevented&&(b=!0),o.stopped))return l=!0}else{var s=I[i];if(s)return h(t,s)}}for(;t&&t!==s&&!h(t,i);)t=t._parent;return l}function k(t,e,i,n,r,a){return t._project.removeOn(i),b=x=!1,m&&T(m,null,i,n,r,a)||e&&e!==m&&!e.isDescendant(m)&&T(e,null,"mousedrag"===i?"mousemove":i,n,r,a,m)||T(t,m||e||t,i,n,r,a)}}),q=H.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var n=m.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=rt.getCanvas(n)}var a=this._context=e.getContext("2d");if(a.save(),this._pixelRatio=1,!/^off|false$/.test(l.getAttribute(e,"hidpi"))){var s=i.devicePixelRatio||1,o=X.getPrefixed(a,"backingStorePixelRatio")||1;this._pixelRatio=s/o}H.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,i){var n=this._pixelRatio;if(t.base.call(this,e*n,i*n),1!==n){var r=this._element,a=this._context;if(!l.hasAttribute(r,"resize")){var s=r.style;s.width=e+"px",s.height=i+"px"}a.restore(),a.save(),a.scale(n,n)}},getContext:function(){return this._context},getPixelSize:function t(e){var i,n=lt.agent;if(n&&n.firefox)i=t.base.call(this,e);else{var r=this._context,a=r.font;r.font=e+" serif",i=parseFloat(r.font),r.font=a}return i},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var a=0,s=e.length;a<s;a++)r=Math.max(r,i.measureText(e[a]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),J=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return K.modifiers}}),Q=J.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),K=new function(){var t,a,s={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},o={tab:"\t",space:" ",enter:"\r"},l={},h={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=lt&&lt.agent;return t&&t.mac?this.meta:this.control}}});function u(t){var i=t.key||t.keyIdentifier;return i=/^U\+/.test(i)?String.fromCharCode(parseInt(i.substr(2),16)):/^Arrow[A-Z]/.test(i)?i.substr(5):"Unidentified"===i||i===e?String.fromCharCode(t.keyCode):i,s[i]||(i.length>1?r.hyphenate(i):i.toLowerCase())}function d(e,i,n,a){var s,o=H._focused;if(l[i]=e,e?h[i]=n:delete h[i],i.length>1&&(s=r.camelize(i))in c){c[s]=e;var u=lt&&lt.agent;if("meta"===s&&u&&u.mac)if(e)t={};else{for(var f in t)f in h&&d(!1,f,t[f],a);t=null}}else e&&t&&(t[i]=n);o&&o._handleKeyEvent(e?"keydown":"keyup",a,i,n)}return Y.add(n,{keydown:function(t){var e=u(t),i=lt&&lt.agent;e.length>1||i&&i.chrome&&(t.altKey||i.mac&&t.metaKey||!i.mac&&t.ctrlKey)?d(!0,e,o[e]||(e.length>1?"":e),t):a=e},keypress:function(t){if(a){var e=u(t),i=t.charCode,n=i>=32?String.fromCharCode(i):e.length>1?"":e;e!==a&&(e=n.toLowerCase()),d(!0,e,n,t),a=null}},keyup:function(t){var e=u(t);e in h&&d(!1,e,h[e],t)}}),Y.add(i,{blur:function(t){for(var e in h)d(!1,e,h[e],t)}}),{modifiers:c,isDown:function(t){return!!l[t]}}},$=J.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),tt=J.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),et=h.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){h.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){lt=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var r=n.move||n.drag,a=this.responds(t),s=this.minDistance,o=this.maxDistance,l=!1,h=this;function c(t,e){var a=i,s=r?h._point:h._downPoint||a;if(r){if(h._moveCount>=0&&a.equals(s))return!1;if(s&&(null!=t||null!=e)){var o=a.subtract(s),l=o.getLength();if(l<(t||0))return!1;e&&(a=s.add(o.normalize(Math.min(l,e))))}h._moveCount++}return h._point=a,h._lastPoint=s||a,n.down&&(h._moveCount=-1,h._downPoint=a,h._downCount++),!0}function u(){a&&(l=h.emit(t,new tt(h,t,e))||l)}if(n.down)c(),u();else if(n.up)c(null,o),u();else if(a)for(;c(s,o);)u();return l}}),it=r.extend(a,{_class:"Tween",statics:{easings:new r({linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:2*(2-t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}})},initialize:function t(e,i,n,r,a,s){this.object=e;var o=typeof a,l="function"===o;this.type=l?o:"string"===o?a:"linear",this.easing=l?a:t.easings[this.type],this.duration=r,this.running=!1,this._then=null,this._startTime=null;var h=i||n;this._keys=h?Object.keys(h):[],this._parsedKeys=this._parseKeys(this._keys),this._from=h&&this._getState(i),this._to=h&&this._getState(n),!1!==s&&this.start()},then:function(t){return this._then=t,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(t){if(this.running){t>=1&&(t=1,this.running=!1);for(var e=this.easing(t),i=this._keys,n=function(i){return"function"==typeof i?i(e,t):i},a=0,s=i&&i.length;a<s;a++){var o=i[a],l=n(this._from[o]),h=n(this._to[o]),c=l&&h&&l.__add&&h.__add?h.__subtract(l).__multiply(e).__add(l):(h-l)*e+l;this._setProperty(this._parsedKeys[o],c)}this.responds("update")&&this.emit("update",new r({progress:t,factor:e})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(t){var e=this._startTime,i=e?(t-e)/this.duration:0;e||(this._startTime=t),this.update(i)},_getState:function(t){for(var e=this._keys,i={},n=0,r=e.length;n<r;n++){var a,s=e[n],o=this._parsedKeys[s],l=this._getProperty(o);if(t){var h=this._resolveValue(l,t[s]);this._setProperty(o,h),a=(a=this._getProperty(o))&&a.clone?a.clone():a,this._setProperty(o,l)}else a=l&&l.clone?l.clone():l;i[s]=a}return i},_resolveValue:function(t,e){if(e){if(Array.isArray(e)&&2===e.length){var i=e[0];return i&&i.match&&i.match(/^[+\-\*\/]=/)?this._calculate(t,i[0],e[1]):e}if("string"==typeof e){var n=e.match(/^[+\-*/]=(.*)/);if(n){var r=JSON.parse(n[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(t,e[0],r)}}}return e},_calculate:function(t,e,i){return lt.PaperScript.calculateBinary(t,e,i)},_parseKeys:function(t){for(var e={},i=0,n=t.length;i<n;i++){var r=t[i],a=r.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");e[r]=a.split("/")}return e},_getProperty:function(t,e){for(var i=this.object,n=0,r=t.length-(e||0);n<r&&i;n++)i=i[t[n]];return i},_setProperty:function(t,e){var i=this._getProperty(t,1);i&&(i[t[t.length-1]]=e)}}),nt={request:function(e){var i=new t.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var t=i.status;0===t||200===t?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,n='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(n);e.onError(n,t)},i.send(null)}},rt=r.exports.CanvasProvider={canvases:[],getCanvas:function(t,e,r){if(!i)return null;var a,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?a=this.canvases.pop():(a=n.createElement("canvas"),s=!1);var o=a.getContext("2d",r||{});if(!o)throw new Error("Canvas "+a+" is unable to provide a 2D context.");return a.width===t&&a.height===e?s&&o.clearRect(0,0,t+1,e+1):(a.width=t,a.height=e),o.save(),a},getContext:function(t,e,i){var n=this.getCanvas(t,e,i);return n?n.getContext("2d",i||{}):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},at=new function(){var t,e,i,n,a,s,o,l,h,c,u,d=Math.min,f=Math.max,g=Math.abs;function p(t,e,i){return.2989*t+.587*e+.114*i}function m(t,e,i,n){var r=n-p(t,e,i),a=(n=p(h=t+r,c=e+r,u=i+r),d(h,c,u)),s=f(h,c,u);if(a<0){var o=n-a;h=n+(h-n)*n/o,c=n+(c-n)*n/o,u=n+(u-n)*n/o}if(s>255){var l=255-n,g=s-n;h=n+(h-n)*l/g,c=n+(c-n)*l/g,u=n+(u-n)*l/g}}function v(t,e,i){return f(t,e,i)-d(t,e,i)}function _(t,e,i,n){var r,a=[t,e,i],s=f(t,e,i),o=d(t,e,i);r=0===d(o=o===t?0:o===e?1:2,s=s===t?0:s===e?1:2)?1===f(o,s)?2:1:0,a[s]>a[o]?(a[r]=(a[r]-a[o])*n/(a[s]-a[o]),a[s]=n):a[r]=a[s]=0,a[o]=0,h=a[0],c=a[1],u=a[2]}var y={multiply:function(){h=a*t/255,c=s*e/255,u=o*i/255},screen:function(){h=a+t-a*t/255,c=s+e-s*e/255,u=o+i-o*i/255},overlay:function(){h=a<128?2*a*t/255:255-2*(255-a)*(255-t)/255,c=s<128?2*s*e/255:255-2*(255-s)*(255-e)/255,u=o<128?2*o*i/255:255-2*(255-o)*(255-i)/255},"soft-light":function(){var n=t*a/255;h=n+a*(255-(255-a)*(255-t)/255-n)/255,c=(n=e*s/255)+s*(255-(255-s)*(255-e)/255-n)/255,u=(n=i*o/255)+o*(255-(255-o)*(255-i)/255-n)/255},"hard-light":function(){h=t<128?2*t*a/255:255-2*(255-t)*(255-a)/255,c=e<128?2*e*s/255:255-2*(255-e)*(255-s)/255,u=i<128?2*i*o/255:255-2*(255-i)*(255-o)/255},"color-dodge":function(){h=0===a?0:255===t?255:d(255,255*a/(255-t)),c=0===s?0:255===e?255:d(255,255*s/(255-e)),u=0===o?0:255===i?255:d(255,255*o/(255-i))},"color-burn":function(){h=255===a?255:0===t?0:f(0,255-255*(255-a)/t),c=255===s?255:0===e?0:f(0,255-255*(255-s)/e),u=255===o?255:0===i?0:f(0,255-255*(255-o)/i)},darken:function(){h=a<t?a:t,c=s<e?s:e,u=o<i?o:i},lighten:function(){h=a>t?a:t,c=s>e?s:e,u=o>i?o:i},difference:function(){(h=a-t)<0&&(h=-h),(c=s-e)<0&&(c=-c),(u=o-i)<0&&(u=-u)},exclusion:function(){h=a+t*(255-a-a)/255,c=s+e*(255-s-s)/255,u=o+i*(255-o-o)/255},hue:function(){_(t,e,i,v(a,s,o)),m(h,c,u,p(a,s,o))},saturation:function(){_(a,s,o,v(t,e,i)),m(h,c,u,p(a,s,o))},luminosity:function(){m(a,s,o,p(t,e,i))},color:function(){m(t,e,i,p(a,s,o))},add:function(){h=d(a+t,255),c=d(s+e,255),u=d(o+i,255)},subtract:function(){h=f(a-t,0),c=f(s-e,0),u=f(o-i,0)},average:function(){h=(a+t)/2,c=(s+e)/2,u=(o+i)/2},negation:function(){h=255-g(255-t-a),c=255-g(255-e-s),u=255-g(255-i-o)}},x=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),b=rt.getContext(1,1,{willReadFrequently:!0});b&&(r.each(y,function(t,e){var i="darken"===e,n=!1;b.save();try{b.fillStyle=i?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=e,b.globalCompositeOperation===e&&(b.fillStyle=i?"#a00":"#300",b.fillRect(0,0,1,1),n=b.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}b.restore(),x[e]=n}),rt.release(b)),this.process=function(r,d,f,g,p){var m=d.canvas,v="normal"===r;if(v||x[r])f.save(),f.setTransform(1,0,0,1,0,0),f.globalAlpha=g,v||(f.globalCompositeOperation=r),f.drawImage(m,p.x,p.y),f.restore();else{var _=y[r];if(!_)return;for(var b=f.getImageData(p.x,p.y,m.width,m.height),I=b.data,C=d.getImageData(0,0,m.width,m.height).data,w=0,S=I.length;w<S;w+=4){t=C[w],a=I[w],e=C[w+1],s=I[w+1],i=C[w+2],o=I[w+2],n=C[w+3],l=I[w+3],_();var M=n*g/255,A=1-M;I[w]=M*h+A*a,I[w+1]=M*c+A*s,I[w+2]=M*u+A*o,I[w+3]=n*g+A*l}f.putImageData(b,p.x,p.y)}}},st=new function(){var t="http://www.w3.org/2000/svg",e="http://www.w3.org/2000/xmlns",i="http://www.w3.org/1999/xlink",r={href:i,xlink:e,xmlns:e+"/","xmlns:xlink":e+"/"};function a(t,e,i){for(var n in e){var a=e[n],s=r[n];"number"==typeof a&&i&&(a=i.number(a)),s?t.setAttributeNS(s,n,a):t.setAttribute(n,a)}return t}return{svg:t,xmlns:e,xlink:i,create:function(e,i,r){return a(n.createElementNS(t,e),i,r)},get:function(t,e){var i=r[e],n=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===n?null:n},set:a}},ot=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof B||t instanceof M||t instanceof N)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});new function(){var e;function i(t,i,n){var a,s=new r,o=t.getTranslation();if(i&&(t.isInvertible()?(a=(t=t._shiftless())._inverseTransform(o),o=null):a=new g,s[n?"cx":"x"]=a.x,s[n?"cy":"y"]=a.y),!t.isIdentity()){var l=t.decompose();if(l){var h=[],c=l.rotation,u=l.scaling,f=l.skewing;o&&!o.isZero()&&h.push("translate("+e.point(o)+")"),c&&h.push("rotate("+e.number(c)+")"),(!d.isZero(u.x-1)||!d.isZero(u.y-1))&&h.push("scale("+e.point(u)+")"),f.x&&h.push("skewX("+e.number(f.x)+")"),f.y&&h.push("skewY("+e.number(f.y)+")"),s.transform=h.join(" ")}else s.transform="matrix("+t.getValues().join(",")+")"}return s}function n(t,n){for(var r=i(t._matrix),a=t._children,s=st.create("g",r,e),o=0,l=a.length;o<l;o++){var h=a[o],u=m(h,n);if(u)if(h.isClipMask()){var d=st.create("clipPath");d.appendChild(u),c(h,d,"clip"),st.set(s,{"clip-path":"url(#"+d.id+")"})}else s.appendChild(u)}return s}function a(t){var n=t._type,r=t._radius,a=i(t._matrix,!0,"rectangle"!==n);if("rectangle"===n){n="rect";var s=t._size,o=s.width,l=s.height;a.x-=o/2,a.y-=l/2,a.width=o,a.height=l,r.isZero()&&(r=null)}return r&&("circle"===n?a.r=r:(a.rx=r.width,a.ry=r.height)),st.create(n,a,e)}var s,o={Group:n,Layer:n,Raster:function(t,n){var r=i(t._matrix,!0),a=t.getSize(),s=t.getImage();return r.x-=a.width/2,r.y-=a.height/2,r.width=a.width,r.height=a.height,r.href=0==n.embedImages&&s&&s.src||t.toDataURL(),st.create("image",r,e)},Path:function(t,n){var r=n.matchShapes;if(r){var s=t.toShape(!1);if(s)return a(s)}var o,l=t._segments,h=l.length,c=i(t._matrix);if(r&&h>=2&&!t.hasHandles())if(h>2){o=t._closed?"polygon":"polyline";for(var u=[],d=0;d<h;d++)u.push(e.point(l[d]._point));c.points=u.join(" ")}else{o="line";var f=l[0]._point,g=l[1]._point;c.set({x1:f.x,y1:f.y,x2:g.x,y2:g.y})}else o="path",c.d=t.getPathData(null,n.precision);return st.create(o,c,e)},Shape:a,CompoundPath:function(t,n){var r=i(t._matrix),a=t.getPathData(null,n.precision);return a&&(r.d=a),st.create("path",r,e)},SymbolItem:function(t,n){var r=i(t._matrix,!0),a=t._definition,s=h(a,"symbol"),o=a._item,l=o.getStrokeBounds();return s||((s=st.create("symbol",{viewBox:e.rectangle(l)})).appendChild(m(o,n)),c(a,s,"symbol")),r.href="#"+s.id,r.x+=l.x,r.y+=l.y,r.width=l.width,r.height=l.height,r.overflow="visible",st.create("use",r,e)},PointText:function(t){var n=st.create("text",i(t._matrix,!0),e);return n.textContent=t._content,n}};function l(t,i,n){var a={},s=!n&&t.getParent(),o=[];return null!=t._name&&(a.id=t._name),r.each(ot,function(i){var n=i.get,l=i.type,u=t[n]();if(i.exportFilter?i.exportFilter(t,u):!s||!r.equals(s[n](),u)){if("color"===l&&null!=u){var d=u.getAlpha();d<1&&(a[i.attribute+"-opacity"]=d)}"style"===l?o.push(i.attribute+": "+u):a[i.attribute]=null==u?"none":"color"===l?u.gradient?function(t){var i=h(t,"color");if(!i){var n,r=t.getGradient(),a=r._radial,s=t.getOrigin(),o=t.getDestination();if(a){n={cx:s.x,cy:s.y,r:s.getDistance(o)};var l=t.getHighlight();l&&(n.fx=l.x,n.fy=l.y)}else n={x1:s.x,y1:s.y,x2:o.x,y2:o.y};n.gradientUnits="userSpaceOnUse",i=st.create((a?"radial":"linear")+"Gradient",n,e);for(var u=r._stops,d=0,f=u.length;d<f;d++){var g,p=u[d],m=p._color,v=m.getAlpha();n={offset:null!==(g=p._offset)&&void 0!==g?g:d/(f-1)},m&&(n["stop-color"]=m.toCSS(!0)),v<1&&(n["stop-opacity"]=v),i.appendChild(st.create("stop",n,e))}c(t,i,"color")}return"url(#"+i.id+")"}(u):u.toCSS(!0):"array"===l?u.join(","):"lookup"===l?i.toSVG[u]:u}}),o.length&&(a.style=o.join(";")),1===a.opacity&&delete a.opacity,t._visible||(a.visibility="hidden"),st.set(i,a,e)}function h(t,e){return s||(s={ids:{},svgs:{}}),t&&s.svgs[e+"-"+(t._id||t.__id||(t.__id=f.get("svg")))]}function c(t,e,i){s||h();var n=s.ids[i]=(s.ids[i]||0)+1;e.id=i+"-"+n,s.svgs[i+"-"+(t._id||t.__id)]=e}function p(e,i){var n=e,r=null;if(s){for(var a in n="svg"===e.nodeName.toLowerCase()&&e,s.svgs)r||(n||(n=st.create("svg")).appendChild(e),r=n.insertBefore(st.create("defs"),n.firstChild)),r.appendChild(s.svgs[a]);s=null}return i.asString?(new t.XMLSerializer).serializeToString(n):n}function m(t,e,i){var n=o[t._class],r=n&&n(t,e);if(r){var a=e.onExport;a&&(r=a(t,r,e)||r);var s=JSON.stringify(t._data);s&&"{}"!==s&&"null"!==s&&r.setAttribute("data-paper-data",s)}return r&&l(t,r,i)}function v(t){return t||(t={}),e=new u(t.precision),t}C.inject({exportSVG:function(t){return p(m(this,t=v(t),!0),t)}}),I.inject({exportSVG:function(t){t=v(t);var n=this._children,a=this.getView(),s=r.pick(t.bounds,"view"),o=t.matrix||"view"===s&&a._matrix,l=o&&x.read([o]),h="view"===s?new _([0,0],a.getViewSize()):"content"===s?C._getBounds(n,l,{stroke:!0}).rect:_.read([s],0,{readNull:!0}),c={version:"1.1",xmlns:st.svg,"xmlns:xlink":st.xlink};h&&(c.width=h.width,c.height=h.height,(h.x||0===h.x||h.y||0===h.y)&&(c.viewBox=e.rectangle(h)));var u=st.create("svg",c,e),d=u;l&&!l.isIdentity()&&(d=u.appendChild(st.create("g",i(l),e)));for(var f=0,g=n.length;f<g;f++)d.appendChild(m(n[f],t,!0));return p(u,t)}})},new function(){var a,s={};function o(t,e,i,n,r,s){var o=st.get(t,e)||s,l=null==o?n?null:i?"":0:i?o:parseFloat(o);return/%\s*$/.test(o)?l/100*(r?1:a[/x|^width/.test(e)?"width":"height"]):l}function l(t,e,i,n,r,a,s){return e=o(t,e||"x",!1,n,r,a),i=o(t,i||"y",!1,n,r,s),!n||null!=e&&null!=i?new g(e,i):null}function h(t,e,i,n,r){return e=o(t,e||"width",!1,n,r),i=o(t,i||"height",!1,n,r),!n||null!=e&&null!=i?new m(e,i):null}function c(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?D(t)||t:"lookup"===e?i[t]:t}function u(t,e,i,n){var r=t.childNodes,a="clippath"===e,s="defs"===e,o=new w,l=o._project,h=l._currentStyle,c=[];if(!a&&!s&&(o=T(o,t,n),l._currentStyle=o._style.clone()),n)for(var u=t.querySelectorAll("defs"),d=0,f=u.length;d<f;d++)P(u[d],i,!1);for(d=0,f=r.length;d<f;d++){var g,p=r[d];1===p.nodeType&&!/^defs$/i.test(p.nodeName)&&(g=P(p,i,!1))&&!(g instanceof k)&&c.push(g)}return o.addChildren(c),a&&(o=T(o.reduce(),t,n)),l._currentStyle=h,(a||s)&&(o.remove(),o=null),o}function d(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,a=i.length;r<a;r+=2)n.push(new g(parseFloat(i[r]),parseFloat(i[r+1])));var s=new R(n);return"polygon"===e&&s.closePath(),s}function f(t,e){var i,n=(o(t,"href",!0)||"").substring(1),r="radialgradient"===e;if(n)(i=s[n].getGradient())._radial^r&&((i=i.clone())._radial=r);else{for(var a=t.childNodes,h=[],c=0,u=a.length;c<u;c++){var d=a[c];1===d.nodeType&&h.push(T(new W,d))}i=new Z(h,r)}var f,g,p,m="userSpaceOnUse"!==o(t,"gradientUnits",!0);return r?(g=(f=l(t,"cx","cy",!1,m,"50%","50%")).add(o(t,"r",!1,!1,m,"50%"),0),p=l(t,"fx","fy",!0,m)):(f=l(t,"x1","y1",!1,m,"0%","0%"),g=l(t,"x2","y2",!1,m,"100%","0%")),T(new j(i,f,g,p),t)._scaleToBounds=m,null}var p={"#document":function(t,e,i,n){for(var r=t.childNodes,a=0,s=r.length;a<s;a++){var o=r[a];if(1===o.nodeType)return P(o,i,n)}},g:u,svg:u,clippath:u,polygon:d,polyline:d,path:function(t){return B.create(t.getAttribute("d"))},lineargradient:f,radialgradient:f,image:function(t){var e=new A(o(t,"href",!0));return e.on("load",function(){var e=h(t);this.setSize(e);var i=l(t).add(e.divide(2));this._matrix.append((new x).translate(i))}),e},symbol:function(t,e,i,n){return new k(u(t,e,i,n),!0)},defs:u,use:function(t){var e=(o(t,"href",!0)||"").substring(1),i=s[e],n=l(t);return i?i instanceof k?i.place(n):i.clone().translate(n):null},circle:function(t){return new M.Circle(l(t,"cx","cy"),o(t,"r"))},ellipse:function(t){return new M.Ellipse({center:l(t,"cx","cy"),radius:h(t,"rx","ry")})},rect:function(t){return new M.Rectangle(new _(l(t),h(t)),h(t,"rx","ry"))},line:function(t){return new R.Line(l(t,"x1","y1"),l(t,"x2","y2"))},text:function(t){var e=new U(l(t).add(l(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e},switch:u};function v(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),a=new x,s=0,o=r.length;s<o;s++){var l=r[s];if(!l)break;for(var h=l.split(/\(\s*/),c=h[0],u=h[1].split(/[\s,]+/g),d=0,f=u.length;d<f;d++)u[d]=parseFloat(u[d]);switch(c){case"matrix":a.append(new x(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":a.rotate(u[0],u[1]||0,u[2]||0);break;case"translate":a.translate(u[0],u[1]||0);break;case"scale":a.scale(u);break;case"skewX":a.skew(u[0],0);break;case"skewY":a.skew(0,u[0])}}t.transform(a)}}function y(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}var b=r.set(r.each(ot,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](c(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n&&n._scaleToBounds){var r=e.getBounds();n.transform((new x).translate(r.getPoint()).scale(r.getSize()))}}}},{}),{id:function(t,e){s[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=D(e);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof w))return new w(i,t);t.insertChild(0,i)}},gradientTransform:v,transform:v,"fill-opacity":y,"stroke-opacity":y,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,r){var a,s=new _(c(e,"array")),o=h(n,null,null,!0);if(t instanceof w){var l=o?o.divide(s.getSize()):1,u=(new x).scale(l).translate(s.getPoint().negate());a=t}else t instanceof k&&(o&&s.setSize(o),a=t._item);if(a){if("visible"!==S(n,"overflow",r)){var d=new M.Rectangle(s);d.setClipMask(!0),a.addChild(d)}u&&a.transform(u)}}});function S(t,i,n){var a=t.attributes[i],s=a&&a.value;if(!s&&t.style){var o=r.camelize(i);!(s=t.style[o])&&n.node[o]!==n.parent[o]&&(s=n.node[o])}return s?"none"===s?null:s:e}function T(t,i,n){var a=i.parentNode,s={node:X.getStyles(i)||{},parent:!n&&!/^defs$/i.test(a.tagName)&&X.getStyles(a)||{}};return r.each(b,function(n,r){var a=S(i,r,s);t=a!==e&&n(t,a,r,i,s)||t}),t}function D(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=e&&e[1],r=n&&s[i?n.replace(i.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function P(t,e,i){var o,l,c,u=t.nodeName.toLowerCase(),d="#document"!==u,f=n.body;i&&d&&(a=lt.getView().getSize(),a=h(t,null,null,!0)||a,o=st.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),l=t.parentNode,c=t.nextSibling,o.appendChild(t),f.appendChild(o));var g=lt.settings,m=g.applyMatrix,v=g.insertItems;g.applyMatrix=!1,g.insertItems=!1;var _=p[u],y=_&&_(t,u,e,i)||null;if(g.insertItems=v,g.applyMatrix=m,y){d&&!(y instanceof w)&&(y=T(y,t,i));var x=e.onImport,b=d&&t.getAttribute("data-paper-data");x&&(y=x(t,y,e)||y),e.expandShapes&&y instanceof M&&(y.remove(),y=y.toPath()),b&&(y._data=JSON.parse(b))}return o&&(f.removeChild(o),l&&(c?l.insertBefore(t,c):l.appendChild(t))),i&&(s={},y&&r.pick(e.applyMatrix,m)&&y.matrix.apply(!0,!0)),y}function E(i,r,a){if(!i)return null;r="function"==typeof r?{onLoad:r}:r||{};var s=lt,o=null;function l(n){try{var l="object"==typeof n?n:(new t.DOMParser).parseFromString(n.trim(),"image/svg+xml");if(!l.nodeName)throw l=null,new Error("Unsupported SVG source: "+i);lt=s,o=P(l,r,!0),(!r||!1!==r.insert)&&a._insertItem(e,o);var c=r.onLoad;c&&c(o,n)}catch(t){h(t)}}function h(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if("string"!=typeof i||/^[\s\S]*</.test(i)){if(typeof File<"u"&&i instanceof File){var c=new FileReader;return c.onload=function(){l(c.result)},c.onerror=function(){h(c.error)},c.readAsText(i)}l(i)}else{var u=n.getElementById(i);u?l(u):nt.request({url:i,async:!0,onLoad:l,onError:h})}return o}C.inject({importSVG:function(t,e){return E(t,e,this)}}),I.inject({importSVG:function(t,e){return this.activate(),E(t,e,this)}})},r.exports.PaperScript=function(){var a,s,o,h,c=this,u=c.acorn;if(!u)try{u=require("acorn")}catch(t){}function d(t,e){return(c.acorn||u).parse(t,e)}u||(u=a=s={},o=this,h=function(t){var e,i,n,r;t.version="0.5.0",t.parse=function(t,r){return i=String(t),n=i.length,s(r),Xt(),function(t){v=_=o,e.locations&&(y=new Vt),x=I=null,b=[],Kt();var i=t||ce(),n=!0;for(t||(i.body=[]);d!==D;){var r=Ie();i.body.push(r),n&&fe(r)&&oe(!0),n=!1}return de(i,"Program")}(e.program)};var a=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function s(t){for(var i in e=t||{},a)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=a[i]);r=e.sourceFile||null}var o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C=t.getLineInfo=function(t,e){for(var i=1,n=0;;){jt.lastIndex=n;var r=jt.exec(t);if(!(r&&r.index<e))break;++i,n=r.index+r[0].length}return{line:i,column:e-n}};function w(t,e){var n=C(i,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=o,r}t.tokenize=function(t,r){i=String(t),n=i.length,s(r),Xt();var a={};function v(t){return _=h,Kt(t),a.start=l,a.end=h,a.startLoc=c,a.endLoc=u,a.type=d,a.value=f,a}return v.jumpTo=function(t,n){if(o=t,e.locations){p=1,m=jt.lastIndex=0;for(var r;(r=jt.exec(i))&&r.index<t;)++p,m=r.index+r[0].length}g=n,Jt()},v};var S=[],M={type:"num"},A={type:"regexp"},T={type:"string"},k={type:"name"},D={type:"eof"},P={keyword:"break"},E={keyword:"case",beforeExpr:!0},z={keyword:"catch"},O={keyword:"continue"},B={keyword:"debugger"},R={keyword:"default"},L={keyword:"do",isLoop:!0},F={keyword:"else",beforeExpr:!0},G={keyword:"finally"},N={keyword:"for",isLoop:!0},U={keyword:"function"},j={keyword:"if"},Z={keyword:"return",beforeExpr:!0},W={keyword:"switch"},V={keyword:"throw",beforeExpr:!0},X={keyword:"try"},Y={keyword:"var"},H={keyword:"while",isLoop:!0},q={keyword:"with"},J={keyword:"new",beforeExpr:!0},Q={keyword:"this"},K={keyword:"null",atomValue:null},$={keyword:"true",atomValue:!0},tt={keyword:"false",atomValue:!1},et={keyword:"in",binop:7,beforeExpr:!0},it={break:P,case:E,catch:z,continue:O,debugger:B,default:R,do:L,else:F,finally:G,for:N,function:U,if:j,return:Z,switch:W,throw:V,try:X,var:Y,while:H,with:q,null:K,true:$,false:tt,new:J,in:et,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Q,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},nt={type:"[",beforeExpr:!0},rt={type:"]"},at={type:"{",beforeExpr:!0},st={type:"}"},ot={type:"(",beforeExpr:!0},lt={type:")"},ht={type:",",beforeExpr:!0},ct={type:";",beforeExpr:!0},ut={type:":",beforeExpr:!0},dt={type:"."},ft={type:"?",beforeExpr:!0},gt={binop:10,beforeExpr:!0},pt={isAssign:!0,beforeExpr:!0},mt={isAssign:!0,beforeExpr:!0},vt={postfix:!0,prefix:!0,isUpdate:!0},_t={prefix:!0,beforeExpr:!0},yt={binop:1,beforeExpr:!0},xt={binop:2,beforeExpr:!0},bt={binop:3,beforeExpr:!0},It={binop:4,beforeExpr:!0},Ct={binop:5,beforeExpr:!0},wt={binop:6,beforeExpr:!0},St={binop:7,beforeExpr:!0},Mt={binop:8,beforeExpr:!0},At={binop:9,prefix:!0,beforeExpr:!0},Tt={binop:10,beforeExpr:!0};for(var kt in t.tokTypes={bracketL:nt,bracketR:rt,braceL:at,braceR:st,parenL:ot,parenR:lt,comma:ht,semi:ct,colon:ut,dot:dt,question:ft,slash:gt,eq:pt,name:k,eof:D,num:M,regexp:A,string:T},it)t.tokTypes["_"+kt]=it[kt];function Dt(t){t=t.split(" ");var e="",i=[];t:for(var n=0;n<t.length;++n){for(var r=0;r<i.length;++r)if(i[r][0].length==t[n].length){i[r].push(t[n]);continue t}i.push([t[n]])}function a(t){if(1==t.length)return e+="return str === "+JSON.stringify(t[0])+";";e+="switch(str){";for(var i=0;i<t.length;++i)e+="case "+JSON.stringify(t[i])+":";e+="return true}return false;"}if(i.length>3){for(i.sort(function(t,e){return e.length-t.length}),e+="switch(str.length){",n=0;n<i.length;++n){var s=i[n];e+="case "+s[0].length+":",a(s)}e+="}"}else a(t);return new Function("str",e)}var Pt,Et=Dt("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zt=Dt("class enum extends super const export import"),Ot=Dt("implements interface let package private protected public static yield"),Bt=Dt("eval arguments"),Rt=Dt("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Lt=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ft="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Gt=new RegExp("["+Ft+"]"),Nt=new RegExp("["+Ft+"------------------------------------------------------------------------------------------------------------------------------------------]"),Ut=/[\n\r\u2028\u2029]/,jt=/\r\n|[\n\r\u2028\u2029]/g,Zt=t.isIdentifierStart=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Gt.test(String.fromCharCode(t)))},Wt=t.isIdentifierChar=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&Nt.test(String.fromCharCode(t))))};function Vt(){this.line=p,this.column=o-m}function Xt(){p=1,o=m=0,g=!0,Jt()}function Yt(t,i){h=o,e.locations&&(u=new Vt),d=t,Jt(),f=i,g=t.beforeExpr}function Ht(){var t=e.onComment&&e.locations&&new Vt,n=o,r=i.indexOf("*/",o+=2);if(-1===r&&w(o-2,"Unterminated comment"),o=r+2,e.locations){jt.lastIndex=n;for(var a;(a=jt.exec(i))&&a.index<o;)++p,m=a.index+a[0].length}e.onComment&&e.onComment(!0,i.slice(n+2,r),n,o,t,e.locations&&new Vt)}function qt(){for(var t=o,r=e.onComment&&e.locations&&new Vt,a=i.charCodeAt(o+=2);o<n&&10!==a&&13!==a&&8232!==a&&8233!==a;)++o,a=i.charCodeAt(o);e.onComment&&e.onComment(!1,i.slice(t+2,o),t,o,r,e.locations&&new Vt)}function Jt(){for(;o<n;){var t=i.charCodeAt(o);if(32===t)++o;else if(13===t)++o,10===(r=i.charCodeAt(o))&&++o,e.locations&&(++p,m=o);else if(10===t||8232===t||8233===t)++o,e.locations&&(++p,m=o);else if(t>8&&t<14)++o;else if(47===t){var r;if(42===(r=i.charCodeAt(o+1)))Ht();else{if(47!==r)break;qt()}}else if(160===t)++o;else{if(!(t>=5760&&Lt.test(String.fromCharCode(t))))break;++o}}}function Qt(t){switch(t){case 46:return function(){var t=i.charCodeAt(o+1);return t>=48&&t<=57?ie(!0):(++o,Yt(dt))}();case 40:return++o,Yt(ot);case 41:return++o,Yt(lt);case 59:return++o,Yt(ct);case 44:return++o,Yt(ht);case 91:return++o,Yt(nt);case 93:return++o,Yt(rt);case 123:return++o,Yt(at);case 125:return++o,Yt(st);case 58:return++o,Yt(ut);case 63:return++o,Yt(ft);case 48:var r=i.charCodeAt(o+1);if(120===r||88===r)return function(){o+=2;var t=ee(16);return null==t&&w(l+2,"Expected hexadecimal number"),Zt(i.charCodeAt(o))&&w(o,"Identifier directly after number"),Yt(M,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return ie(!1);case 34:case 39:return function(t){o++;for(var r="";;){o>=n&&w(l,"Unterminated string constant");var a=i.charCodeAt(o);if(a===t)return++o,Yt(T,r);if(92===a){a=i.charCodeAt(++o);var s=/^[0-7]+/.exec(i.slice(o,o+3));for(s&&(s=s[0]);s&&parseInt(s,8)>255;)s=s.slice(0,-1);if("0"===s&&(s=null),++o,s)I&&w(o-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(s,8)),o+=s.length-1;else switch(a){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(ne(2));break;case 117:r+=String.fromCharCode(ne(4));break;case 85:r+=String.fromCharCode(ne(8));break;case 116:r+="\t";break;case 98:r+="\b";break;case 118:r+="\v";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:10===i.charCodeAt(o)&&++o;case 10:e.locations&&(m=o,++p);break;default:r+=String.fromCharCode(a)}}else(13===a||10===a||8232===a||8233===a)&&w(l,"Unterminated string constant"),r+=String.fromCharCode(a),++o}}(t);case 47:return function(){var t=i.charCodeAt(o+1);return g?(++o,te()):61===t?$t(mt,2):$t(gt,1)}();case 37:case 42:return 61===i.charCodeAt(o+1)?$t(mt,2):$t(Tt,1);case 124:case 38:return function(t){var e=i.charCodeAt(o+1);return e===t?$t(124===t?yt:xt,2):61===e?$t(mt,2):$t(124===t?bt:Ct,1)}(t);case 94:return 61===i.charCodeAt(o+1)?$t(mt,2):$t(It,1);case 43:case 45:return function(t){var e=i.charCodeAt(o+1);return e===t?45==e&&62==i.charCodeAt(o+2)&&Ut.test(i.slice(_,o))?(o+=3,qt(),Jt(),Kt()):$t(vt,2):61===e?$t(mt,2):$t(At,1)}(t);case 60:case 62:return function(t){var e=i.charCodeAt(o+1),n=1;return e===t?(n=62===t&&62===i.charCodeAt(o+2)?3:2,61===i.charCodeAt(o+n)?$t(mt,n+1):$t(Mt,n)):33==e&&60==t&&45==i.charCodeAt(o+2)&&45==i.charCodeAt(o+3)?(o+=4,qt(),Jt(),Kt()):(61===e&&(n=61===i.charCodeAt(o+2)?3:2),$t(St,n))}(t);case 61:case 33:return function(t){return 61===i.charCodeAt(o+1)?$t(wt,61===i.charCodeAt(o+2)?3:2):$t(61===t?pt:_t,1)}(t);case 126:return $t(_t,1)}return!1}function Kt(t){if(t?o=l+1:l=o,e.locations&&(c=new Vt),t)return te();if(o>=n)return Yt(D);var r=i.charCodeAt(o);if(Zt(r)||92===r)return ae();var a=Qt(r);if(!1===a){var s=String.fromCharCode(r);if("\\"===s||Gt.test(s))return ae();w(o,"Unexpected character '"+s+"'")}return a}function $t(t,e){var n=i.slice(o,o+e);o+=e,Yt(t,n)}function te(){for(var t,e,r=o;;){o>=n&&w(r,"Unterminated regular expression");var a=i.charAt(o);if(Ut.test(a)&&w(r,"Unterminated regular expression"),t)t=!1;else{if("["===a)e=!0;else if("]"===a&&e)e=!1;else if("/"===a&&!e)break;t="\\"===a}++o}var s=i.slice(r,o);++o;var l=re();l&&!/^[gmsiy]*$/.test(l)&&w(r,"Invalid regexp flag");try{var h=new RegExp(s,l)}catch(t){t instanceof SyntaxError&&w(r,t.message),w(t)}return Yt(A,h)}function ee(t,e){for(var n=o,r=0,a=0,s=null!=e?e:1/0;a<s;++a){var l,h=i.charCodeAt(o);if((l=h>=97?h-97+10:h>=65?h-65+10:h>=48&&h<=57?h-48:1/0)>=t)break;++o,r=r*t+l}return o===n||null!=e&&o-n!==e?null:r}function ie(t){var e=o,n=!1,r=48===i.charCodeAt(o);!t&&null===ee(10)&&w(e,"Invalid number"),46===i.charCodeAt(o)&&(++o,ee(10),n=!0);var a=i.charCodeAt(o);(69===a||101===a)&&((43===(a=i.charCodeAt(++o))||45===a)&&++o,null===ee(10)&&w(e,"Invalid number"),n=!0),Zt(i.charCodeAt(o))&&w(o,"Identifier directly after number");var s,l=i.slice(e,o);return n?s=parseFloat(l):r&&1!==l.length?/[89]/.test(l)||I?w(e,"Invalid number"):s=parseInt(l,8):s=parseInt(l,10),Yt(M,s)}function ne(t){var e=ee(16,t);return null===e&&w(l,"Bad character escape sequence"),e}function re(){Pt=!1;for(var t,e=!0,n=o;;){var r=i.charCodeAt(o);if(Wt(r))Pt&&(t+=i.charAt(o)),++o;else{if(92!==r)break;Pt||(t=i.slice(n,o)),Pt=!0,117!=i.charCodeAt(++o)&&w(o,"Expecting Unicode escape sequence \\uXXXX"),++o;var a=ne(4),s=String.fromCharCode(a);s||w(o-1,"Invalid Unicode escape"),(e?Zt(a):Wt(a))||w(o-4,"Invalid Unicode escape"),t+=s}e=!1}return Pt?t:i.slice(n,o)}function ae(){var t=re(),e=k;return!Pt&&Rt(t)&&(e=it[t]),Yt(e,t)}function se(){v=l,_=h,y=u,Kt()}function oe(t){if(I=t,o=l,e.locations)for(;o<m;)m=i.lastIndexOf("\n",m-2)+1,--p;Jt(),Kt()}function le(){this.type=null,this.start=l,this.end=null}function he(){this.start=c,this.end=null,null!==r&&(this.source=r)}function ce(){var t=new le;return e.locations&&(t.loc=new he),e.directSourceFile&&(t.sourceFile=e.directSourceFile),e.ranges&&(t.range=[l,0]),t}function ue(t){var i=new le;return i.start=t.start,e.locations&&(i.loc=new he,i.loc.start=t.loc.start),e.ranges&&(i.range=[t.range[0],0]),i}function de(t,i){return t.type=i,t.end=_,e.locations&&(t.loc.end=y),e.ranges&&(t.range[1]=_),t}function fe(t){return e.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function ge(t){if(d===t)return se(),!0}function pe(){return!e.strictSemicolons&&(d===D||d===st||Ut.test(i.slice(_,l)))}function me(){!ge(ct)&&!pe()&&_e()}function ve(t){d===t?se():_e()}function _e(){w(l,"Unexpected token")}function ye(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&w(t.start,"Assigning to rvalue"),I&&"Identifier"===t.type&&Bt(t.name)&&w(t.start,"Assigning to "+t.name+" in strict mode")}var xe={kind:"loop"},be={kind:"switch"};function Ie(){(d===gt||d===mt&&"/="==f)&&Kt(!0);var t=d,n=ce();switch(t){case P:case O:se();var r=t===P;ge(ct)||pe()?n.label=null:d!==k?_e():(n.label=Re(),me());for(var a=0;a<b.length;++a){var s=b[a];if((null==n.label||s.name===n.label.name)&&(null!=s.kind&&(r||"loop"===s.kind)||n.label&&r))break}return a===b.length&&w(n.start,"Unsyntactic "+t.keyword),de(n,r?"BreakStatement":"ContinueStatement");case B:return se(),me(),de(n,"DebuggerStatement");case L:return se(),b.push(xe),n.body=Ie(),b.pop(),ve(H),n.test=Ce(),me(),de(n,"DoWhileStatement");case N:if(se(),b.push(xe),ve(ot),d===ct)return Se(n,null);if(d===Y){var o=ce();return se(),Ae(o,!0),de(o,"VariableDeclaration"),1===o.declarations.length&&ge(et)?Me(n,o):Se(n,o)}return o=Te(!1,!0),ge(et)?(ye(o),Me(n,o)):Se(n,o);case U:return se(),Oe(n,!0);case j:return se(),n.test=Ce(),n.consequent=Ie(),n.alternate=ge(F)?Ie():null,de(n,"IfStatement");case Z:return!x&&!e.allowReturnOutsideFunction&&w(l,"'return' outside of function"),se(),ge(ct)||pe()?n.argument=null:(n.argument=Te(),me()),de(n,"ReturnStatement");case W:se(),n.discriminant=Ce(),n.cases=[],ve(at),b.push(be);for(var h,c;d!=st;)if(d===E||d===R){var u=d===E;h&&de(h,"SwitchCase"),n.cases.push(h=ce()),h.consequent=[],se(),u?h.test=Te():(c&&w(v,"Multiple default clauses"),c=!0,h.test=null),ve(ut)}else h||_e(),h.consequent.push(Ie());return h&&de(h,"SwitchCase"),se(),b.pop(),de(n,"SwitchStatement");case V:return se(),Ut.test(i.slice(_,l))&&w(_,"Illegal newline after throw"),n.argument=Te(),me(),de(n,"ThrowStatement");case X:if(se(),n.block=we(),n.handler=null,d===z){var g=ce();se(),ve(ot),g.param=Re(),I&&Bt(g.param.name)&&w(g.param.start,"Binding "+g.param.name+" in strict mode"),ve(lt),g.guard=null,g.body=we(),n.handler=de(g,"CatchClause")}return n.guardedHandlers=S,n.finalizer=ge(G)?we():null,!n.handler&&!n.finalizer&&w(n.start,"Missing catch or finally clause"),de(n,"TryStatement");case Y:return se(),Ae(n),me(),de(n,"VariableDeclaration");case H:return se(),n.test=Ce(),b.push(xe),n.body=Ie(),b.pop(),de(n,"WhileStatement");case q:return I&&w(l,"'with' in strict mode"),se(),n.object=Ce(),n.body=Ie(),de(n,"WithStatement");case at:return we();case ct:return se(),de(n,"EmptyStatement");default:var p=f,m=Te();if(t===k&&"Identifier"===m.type&&ge(ut)){for(a=0;a<b.length;++a)b[a].name===p&&w(m.start,"Label '"+p+"' is already declared");var y=d.isLoop?"loop":d===W?"switch":null;return b.push({name:p,kind:y}),n.body=Ie(),b.pop(),n.label=m,de(n,"LabeledStatement")}return n.expression=m,me(),de(n,"ExpressionStatement")}}function Ce(){ve(ot);var t=Te();return ve(lt),t}function we(t){var e,i=ce(),n=!0,r=!1;for(i.body=[],ve(at);!ge(st);){var a=Ie();i.body.push(a),n&&t&&fe(a)&&(e=r,oe(r=!0)),n=!1}return r&&!e&&oe(!1),de(i,"BlockStatement")}function Se(t,e){return t.init=e,ve(ct),t.test=d===ct?null:Te(),ve(ct),t.update=d===lt?null:Te(),ve(lt),t.body=Ie(),b.pop(),de(t,"ForStatement")}function Me(t,e){return t.left=e,t.right=Te(),ve(lt),t.body=Ie(),b.pop(),de(t,"ForInStatement")}function Ae(t,e){for(t.declarations=[],t.kind="var";;){var i=ce();if(i.id=Re(),I&&Bt(i.id.name)&&w(i.id.start,"Binding "+i.id.name+" in strict mode"),i.init=ge(pt)?Te(!0,e):null,t.declarations.push(de(i,"VariableDeclarator")),!ge(ht))break}return t}function Te(t,e){var i=ke(e);if(!t&&d===ht){var n=ue(i);for(n.expressions=[i];ge(ht);)n.expressions.push(ke(e));return de(n,"SequenceExpression")}return i}function ke(t){var e=function(t){var e=function(t){return function t(e,i,n){var r=d.binop;if(null!=r&&(!n||d!==et)&&r>i){var a=ue(e);a.left=e,a.operator=f;var s=d;se(),a.right=t(De(),r,n);var o=de(a,s===yt||s===xt?"LogicalExpression":"BinaryExpression");return t(o,i,n)}return e}(De(),-1,t)}(t);if(ge(ft)){var i=ue(e);return i.test=e,i.consequent=Te(!0),ve(ut),i.alternate=Te(!0,t),de(i,"ConditionalExpression")}return e}(t);if(d.isAssign){var i=ue(e);return i.operator=f,i.left=e,se(),i.right=ke(t),ye(e),de(i,"AssignmentExpression")}return e}function De(){if(d.prefix){var t=ce(),e=d.isUpdate;return t.operator=f,t.prefix=!0,g=!0,se(),t.argument=De(),e?ye(t.argument):I&&"delete"===t.operator&&"Identifier"===t.argument.type&&w(t.start,"Deleting local variable in strict mode"),de(t,e?"UpdateExpression":"UnaryExpression")}for(var i=Pe(Ee());d.postfix&&!pe();)(t=ue(i)).operator=f,t.prefix=!1,t.argument=i,ye(i),se(),i=de(t,"UpdateExpression");return i}function Pe(t,e){var i;return ge(dt)?((i=ue(t)).object=t,i.property=Re(!0),i.computed=!1,Pe(de(i,"MemberExpression"),e)):ge(nt)?((i=ue(t)).object=t,i.property=Te(),i.computed=!0,ve(rt),Pe(de(i,"MemberExpression"),e)):!e&&ge(ot)?((i=ue(t)).callee=t,i.arguments=Be(lt,!1),Pe(de(i,"CallExpression"),e)):t}function Ee(){switch(d){case Q:var t=ce();return se(),de(t,"ThisExpression");case k:return Re();case M:case T:case A:return(t=ce()).value=f,t.raw=i.slice(l,h),se(),de(t,"Literal");case K:case $:case tt:return(t=ce()).value=d.atomValue,t.raw=d.keyword,se(),de(t,"Literal");case ot:var n=c,r=l;se();var a=Te();return a.start=r,a.end=h,e.locations&&(a.loc.start=n,a.loc.end=u),e.ranges&&(a.range=[r,h]),ve(lt),a;case nt:return t=ce(),se(),t.elements=Be(rt,!0,!0),de(t,"ArrayExpression");case at:return function(){var t=ce(),i=!0,n=!1;for(t.properties=[],se();!ge(st);){if(i)i=!1;else if(ve(ht),e.allowTrailingCommas&&ge(st))break;var r,a={key:ze()},s=!1;if(ge(ut)?(a.value=Te(!0),r=a.kind="init"):e.ecmaVersion>=5&&"Identifier"===a.key.type&&("get"===a.key.name||"set"===a.key.name)?(s=n=!0,r=a.kind=a.key.name,a.key=ze(),d!==ot&&_e(),a.value=Oe(ce(),!1)):_e(),"Identifier"===a.key.type&&(I||n))for(var o=0;o<t.properties.length;++o){var l=t.properties[o];if(l.key.name===a.key.name){var h=r==l.kind||s&&"init"===l.kind||"init"===r&&("get"===l.kind||"set"===l.kind);h&&!I&&"init"===r&&"init"===l.kind&&(h=!1),h&&w(a.key.start,"Redefinition of property")}}t.properties.push(a)}return de(t,"ObjectExpression")}();case U:return t=ce(),se(),Oe(t,!1);case J:return function(){var t=ce();return se(),t.callee=Pe(Ee(),!0),ge(ot)?t.arguments=Be(lt,!1):t.arguments=S,de(t,"NewExpression")}();default:_e()}}function ze(){return d===M||d===T?Ee():Re(!0)}function Oe(t,e){d===k?t.id=Re():e?_e():t.id=null,t.params=[];var i=!0;for(ve(ot);!ge(lt);)i?i=!1:ve(ht),t.params.push(Re());var n=x,r=b;if(x=!0,b=[],t.body=we(!0),x=n,b=r,I||t.body.body.length&&fe(t.body.body[0]))for(var a=t.id?-1:0;a<t.params.length;++a){var s=a<0?t.id:t.params[a];if((Ot(s.name)||Bt(s.name))&&w(s.start,"Defining '"+s.name+"' in strict mode"),a>=0)for(var o=0;o<a;++o)s.name===t.params[o].name&&w(s.start,"Argument name clash in strict mode")}return de(t,e?"FunctionDeclaration":"FunctionExpression")}function Be(t,i,n){for(var r=[],a=!0;!ge(t);){if(a)a=!1;else if(ve(ht),i&&e.allowTrailingCommas&&ge(t))break;n&&d===ht?r.push(null):r.push(Te(!0))}return r}function Re(t){var n=ce();return t&&"everywhere"==e.forbidReserved&&(t=!1),d===k?(!t&&(e.forbidReserved&&(3===e.ecmaVersion?Et:zt)(f)||I&&Ot(f))&&-1==i.slice(l,h).indexOf("\\")&&w(l,"The keyword '"+f+"' is reserved"),n.name=f):t&&d.keyword?n.name=d.keyword:_e(),g=!1,se(),de(n,"Identifier")}},"object"==typeof a&&"object"==typeof s?h(a):"function"==typeof e&&e.amd?e(["exports"],h):h(o.acorn||(o.acorn={})),u.version||(u=null));var f={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},p={"-":"__negate","+":"__self"},v=r.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(t){this["__"+t]="#"+t},{__self:function(){return this}});function _(t,e,i){var n=f[e];if(t&&t[n]){var r=t[n](i);return"!="===e?!r:r}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;case"%":return t%i;case"==":return t==i;case"!=":return t!=i}}function y(t,e){var i=p[t];if(e&&e[i])return e[i]();switch(t){case"+":return+e;case"-":return-e}}function x(e,r){if(!e)return"";var a=[];function s(t){for(var e=0,i=a.length;e<i;e++){var n=a[e];if(n[0]>=t)break;t+=n[1]}return t}function o(t){return e.substring(s(t.range[0]),s(t.range[1]))}function l(t,i){for(var n=s(t.range[0]),r=s(t.range[1]),o=0,l=a.length-1;l>=0;l--)if(n>a[l][0]){o=l+1;break}a.splice(o,0,[n,i.length-r+n]),e=e.substring(0,n)+i+e.substring(r)}function h(t,i){switch(t.type){case"UnaryExpression":if(t.operator in p&&"Literal"!==t.argument.type){var n=o(t.argument);l(t,'$__("'+t.operator+'", '+n+")")}break;case"BinaryExpression":if(t.operator in f&&"Literal"!==t.left.type){var r=o(t.left),a=o(t.right),h=function(t,i){return e.substring(s(t.range[1]),s(i.range[0]))}(t.left,t.right),c=t.operator;l(t,"__$__("+r+","+h.replace(new RegExp("\\"+c),'"'+c+'"')+", "+a+")")}break;case"UpdateExpression":case"AssignmentExpression":var u=i&&i.type;if(!("ForStatement"===u||"BinaryExpression"===u&&/^[=!<>]/.test(i.operator)||"MemberExpression"===u&&i.computed))if("UpdateExpression"===t.type){var d=(n=o(t.argument))+" = "+(g="__$__("+n+', "'+t.operator[0]+'", 1)');t.prefix?d="("+d+")":("AssignmentExpression"===u||"VariableDeclarator"===u||"BinaryExpression"===u)&&(o(i.left||i.id)===n&&(d=g),d=n+"; "+d),l(t,d)}else if(/^.=$/.test(t.operator)&&"Literal"!==t.left.type){r=o(t.left),a=o(t.right);var g=r+" = __$__("+r+', "'+t.operator[0]+'", '+a+")";l(t,/^\(.*\)$/.test(o(t))?"("+g+")":g)}}}var c,u=(r=r||{}).url||"",g=r.sourceMaps,m=r.paperFeatures||{},v=r.source||e,_=r.offset||0,y=lt.agent,x=y.versionNumber,b=!1,I=/\r\n|\n|\r/gm;if(g&&(y.chrome&&x>=30||y.webkit&&x>=537.76||y.firefox&&x>=23||y.node)){if(y.node)_-=2;else if(i&&u&&!i.location.href.indexOf(u)){var C=n.getElementsByTagName("html")[0].innerHTML;_=C.substr(0,C.indexOf(e)+1).match(I).length+1}var w=["AA"+function(t){var e="";for(t=(Math.abs(t)<<1)+(t<0?1:0);t||!e;){var i=31&t;(t>>=5)&&(i|=32),e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[i]}return e}((b=_>0&&!(y.chrome&&x>=36||y.safari&&x>=600||y.firefox&&x>=40||y.node))?0:_)+"A"];w.length=(e.match(I)||[]).length+1+(b?_:0),c={version:3,file:u,names:[],mappings:w.join(";AACA"),sourceRoot:"",sources:[u],sourcesContent:[v]}}return(!1!==m.operatorOverloading||!1!==m.moduleExports)&&function t(e,i,n){if(e){for(var r in e)if("range"!==r&&"loc"!==r){var a=e[r];if(Array.isArray(a))for(var s=0,c=a.length;s<c;s++)t(a[s],e,n);else a&&"object"==typeof a&&t(a,e,n)}!1!==n.operatorOverloading&&h(e,i),!1!==n.moduleExports&&function(t){switch(t.type){case"ExportDefaultDeclaration":l({range:[t.start,t.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var e=t.declaration,i=t.specifiers;if(e){var n=e.declarations;n&&(n.forEach(function(t){l(t,"module.exports."+o(t))}),l({range:[t.start,e.start+e.kind.length]},""))}else if(i){var r=i.map(function(t){var e=o(t);return"module.exports."+e+" = "+e+"; "}).join("");r&&l(t,r)}}}(e)}}(d(e,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,m),c&&(b&&(e=new Array(_+1).join("\n")+e),/^(inline|both)$/.test(g)&&(e+="\n//# sourceMappingURL=data:application/json;base64,"+t.btoa(unescape(encodeURIComponent(JSON.stringify(c))))),e+="\n//# sourceURL="+(u||"paperscript")),{url:u,source:v,code:e,map:c}}function b(t,e,i){lt=e;var a,s=e.getView(),o=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(t)&&!/\bnew\s+Tool\b/.test(t)?new et:null,l=o?o._events:[],h=["onFrame","onResize"].concat(l),c=[],u=[],d="object"==typeof t?t:x(t,i);function f(e,i){for(var n in e)(i||!/^_/.test(n))&&new RegExp("([\\b\\s\\W]|^)"+n.replace(/\$/g,"\\$")+"\\b").test(t)&&(c.push(n),u.push(e[n]))}t=d.code,f({__$__:_,$__:y,paper:e,tool:o},!0),f(e),t="var module = { exports: {} }; "+t,(b=r.each(h,function(e){new RegExp("\\s+"+e+"\\b").test(t)&&(c.push(e),this.push("module.exports."+e+" = "+e+";"))},[]).join("\n"))&&(t+="\n"+b),t+="\nreturn module.exports;";var p=lt.agent;if(n&&(p.chrome||p.firefox&&p.versionNumber<40)){var m=n.createElement("script"),v=n.head||n.getElementsByTagName("head")[0];p.firefox&&(t="\n"+t),m.appendChild(n.createTextNode("document.__paperscript__ = function("+c+") {"+t+"\n}")),v.appendChild(m),a=n.__paperscript__,delete n.__paperscript__,v.removeChild(m)}else a=Function(c,t);var b,I=(b=a&&a.apply(e,u))||{};return r.each(l,function(t){var e=I[t];e&&(o[t]=e)}),s&&(I.onResize&&s.setOnResize(I.onResize),s.emit("resize",{size:s.size,delta:new g}),I.onFrame&&s.setOnFrame(I.onFrame),s.requestUpdate()),b}function I(t){if(/^text\/(?:x-|)paperscript$/.test(t.type)&&"true"!==l.getAttribute(t,"ignore")){var e=l.getAttribute(t,"canvas"),i=n.getElementById(e),r=t.src||t.getAttribute("data-src"),a=l.hasAttribute(t,"async"),s="data-paper-scope";if(!i)throw new Error('Unable to find canvas with id "'+e+'"');var o=l.get(i.getAttribute(s))||(new l).setup(i);return i.setAttribute(s,o._id),r?nt.request({url:r,async:a,mimeType:"text/plain",onLoad:function(t){b(t,o,r)}}):b(t.innerHTML,o,t.baseURI),t.setAttribute("data-paper-ignore","true"),o}}function C(){r.each(n&&n.getElementsByTagName("script"),I)}return g.inject(v),m.inject(v),j.inject(v),i&&("complete"===n.readyState?setTimeout(C):Y.add(i,{load:C})),{compile:x,execute:b,load:function(t){return t?I(t):C()},parse:d,calculateBinary:_,calculateUnary:y}}.call(this);var lt=new(l.inject(r.exports,{Base:r,Numerical:d,Key:K,DomEvent:Y,DomElement:X,document:n,window:i,Symbol:k,PlacedSymbol:T}));return lt.agent.node&&s(lt),"function"==typeof e&&e.amd?e("paper",lt):o&&(o.exports=lt),lt}.call(n,"object"==typeof self?self:null);t.Preview3DGenerator=class{constructor(){i(this,"_paperScope",new r.PaperScope);const t=document.createElement("canvas");t.width=1,t.height=1,this._paperScope.setup(new r.Size(1,1))}generatePreview3D(t){console.log("Generating 3D preview for resizable canvas...",t);const e=BABYLON.MeshBuilder.CreateBox("box",{width:t.width,height:t.height,depth:t.depth});let i=e.getVerticesData(BABYLON.VertexBuffer.PositionKind),n=e.getIndices(),r=e.getVerticesData(BABYLON.VertexBuffer.NormalKind),a=e.getVerticesData(BABYLON.VertexBuffer.UVKind);if(t.borderRadius>0&&console.warn("Mirror canvas effect will not work for border radius > 0"),0===t.borderRadius){const i=t.depth/t.width,n=t.depth/t.height,h=Math.min(i,n);for(var s=0;s<a.length;s+=2){const t=Math.round(r[s/2*3]),e=Math.round(r[s/2*3+1]),i=Math.round(r[s/2*3+2]);if(-1==t&&0==e&&0==i){var o=a[s],l=a[s+1];a[s]=l*h,a[s+1]=o}1==t&&0==e&&0==i&&(o=a[s],l=a[s+1],a[s]=l*h+(1-h),a[s+1]=o),0==t&&-1==e&&0==i&&(o=a[s],l=a[s+1],a[s]=l,a[s+1]=o*h),0==t&&1==e&&0==i&&(o=a[s],l=a[s+1],a[s]=1-l,a[s+1]=(1-o)*h+(1-h))}e.setVerticesData(BABYLON.VertexBuffer.UVKind,a)}return null==e||e.dispose(),{positions:i,indices:n,normals:r,uvs:a}}},t.ProductAreaGenerator=class{constructor(){i(this,"_paperScope",new r.PaperScope),this._paperScope.setup(new r.Size(1,1))}generateArea(t){if(t.width<=0||t.height<=0)throw new Error("Width and height must be greater than 0");const e=new this._paperScope.Path.Rectangle({point:[0,0],size:[t.width,t.height],radius:t.borderRadius});return e.position=new this._paperScope.Point(0,0),e.remove(),{json:e.exportJSON(),svg:e.exportSVG({asString:!0})}}},t.ProductImageGenerator=class{constructor(){i(this,"_paperScope",new r.PaperScope),this._paperScope.setup(new r.Size(1,1))}generateImage(t){if(t.width<=0||t.height<=0)throw new Error("Width and height must be greater than 0");return{shape:this.createShape(t),splitColumns:this.createSplitColumns(t),measures:this.createMeasures(t)}}createShape(t){const e=new this._paperScope.Path.Rectangle({point:[0,0],size:[t.width,t.height],radius:t.shape.borderRadius,fillColor:t.shape.fillColor,strokeColor:t.shape.borderColor,strokeWidth:t.shape.borderWidth,shadowColor:t.shape.shadowColor,shadowBlur:t.shape.shadowBlur,shadowOffset:new this._paperScope.Point(t.shape.shadowOffset.x,t.shape.shadowOffset.y)});return e.position=new this._paperScope.Point(0,0),e.remove(),{json:e.exportJSON(),svg:e.exportSVG({asString:!0})}}createSplitColumns(t){const e=new this._paperScope.Group,i=t.width/t.splitColumns.columns,n=t.height/t.splitColumns.rows;for(let n=1;n<t.splitColumns.columns;n++){const r=n*i,a=new this._paperScope.Path.Line({from:[r,0+t.splitColumns.marginVertical],to:[r,t.height-t.splitColumns.marginVertical],strokeColor:t.splitColumns.lineColor,strokeWidth:t.splitColumns.lineWidth,dashArray:t.splitColumns.lineDashArray,strokeScaling:!1});e.addChild(a)}for(let i=1;i<t.splitColumns.rows;i++){const r=i*n,a=new this._paperScope.Path.Line({from:[0+t.splitColumns.marginVertical,r],to:[t.width-t.splitColumns.marginVertical,r],strokeColor:t.splitColumns.lineColor,strokeWidth:t.splitColumns.lineWidth,dashArray:t.splitColumns.lineDashArray,strokeScaling:!1});e.addChild(a)}return e.position=new this._paperScope.Point(0,0),{json:e.exportJSON(),svg:e.exportSVG({asString:!0})}}createMeasures(t){const e=new this._paperScope.Group,i=this.createArrow(t,new this._paperScope.Point(-t.width/2,-t.height/2-10),new this._paperScope.Point(+t.width/2,-t.height/2-10)),n=this.createArrow(t,new this._paperScope.Point(-t.width/2-10,-t.height/2),new this._paperScope.Point(-t.width/2-10,+t.height/2)),r=new this._paperScope.PointText({fillColor:t.measures.labelColor,fontFamily:"Courier New",fontWeight:"bold",fontSize:t.measures.labelFontSize,justification:"center",position:[0,-t.height/2-20],content:t.measures.widthLabel}),a=new this._paperScope.PointText({fillColor:t.measures.labelColor,fontFamily:"Courier New",fontWeight:"bold",fontSize:t.measures.labelFontSize,justification:"center",position:[-t.width/2-20,0],content:t.measures.heightLabel,rotation:-90});return e.addChild(r),e.addChild(a),e.addChild(i),e.addChild(n),{json:e.exportJSON(),svg:e.exportSVG({asString:!0})}}createArrow(t,e,i){const n=new this._paperScope.Group,r=i.subtract(e).angle,a={strokeColor:t.measures.lineColor,strokeWidth:t.measures.lineWidth,dashArray:t.measures.lineDashArray,strokeScaling:!1},s=new this._paperScope.Path.Line(_objectSpread({from:e,to:i},a)),o=new this._paperScope.Path.Line(_objectSpread({from:e,to:e.add(new this._paperScope.Point(-5,-5))},a)),l=new this._paperScope.Path.Line(_objectSpread({from:e,to:e.add(new this._paperScope.Point(-5,5))},a)),h=new this._paperScope.Path.Line(_objectSpread({from:i,to:i.add(new this._paperScope.Point(-5,-5))},a)),c=new this._paperScope.Path.Line(_objectSpread({from:i,to:i.add(new this._paperScope.Point(-5,5))},a));return o.rotate(r+180,e),l.rotate(r+180,e),h.rotate(r,i),c.rotate(r,i),n.addChild(s),n.addChild(o),n.addChild(l),n.addChild(h),n.addChild(c),n}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}),(Zakeke=Zakeke||{}).MaterialLibrary={materialNames:["stainless steel","gold"],getMaterial:function(t,e){switch(t){case"stainless steel":return this.getStainlessSteel(e);case"gold":return this.getGold(e)}return null},getStainlessSteel:function(t){var e=this.getUnusedMaterialName("steel",t),i=new BABYLON.StandardMaterial(e,t);return i.id=Zakeke.generateUUID(),i.reflectionTexture=new BABYLON.CubeTexture("../Content/textures/cubemaps/yokohama/Yokohama",t),i.diffuseColor=new BABYLON.Color3(0,0,0),i.specularPower=128,i.reflectionFresnelParameters=new BABYLON.FresnelParameters,i.reflectionFresnelParameters.power=2,i.reflectionFresnelParameters.leftColor=new BABYLON.Color3(1,1,1),i.reflectionFresnelParameters.rightColor=BABYLON.Color3.White(),i},getGold:function(t){var e=this.getUnusedMaterialName("gold",t),i=new BABYLON.StandardMaterial(e,t);return i.id=Zakeke.generateUUID(),i.reflectionTexture=new BABYLON.CubeTexture("../Content/textures/cubemaps/yokohama_dark/Yokohama",t),i.diffuseColor=new BABYLON.Color3(.8,.6,0),i.specularPower=12,i.reflectionFresnelParameters=new BABYLON.FresnelParameters,i.reflectionFresnelParameters.power=2,i.reflectionFresnelParameters.leftColor=new BABYLON.Color3(1,1,1),i.reflectionFresnelParameters.rightColor=BABYLON.Color3.White(),i},getUnusedMaterialName:function(t,e){for(var i=1,n=t+" - "+i,r=e.getMaterialByName(n);r;)n=t+" - "+ ++i,r=e.getMaterialByName(n);return n}},(Zakeke=Zakeke||{}).isIPhoneX=function(){var t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,e=window.devicePixelRatio||1,i=window.screen.width*e,n=window.screen.height*e;return!(!t||1125!==i||2436!==n)},Zakeke.getViewport=function(){var t="CSS1Compat"===document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(t?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(t?document.documentElement.clientHeight:document.body.clientHeight)}},Zakeke.getContrastYIQ=function(t,e,i){return(299*t+587*e+114*i)/1e3>=128?"black":"white"},Zakeke.getContrastYIQHex=function(t){return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},Zakeke.arrayContains=function(t,e){if(null==e||null==e)return!1;if("[object Array]"!==Object.prototype.toString.call(t))return!1;return function(t){var e=t!=t;return(e||"function"!=typeof Array.prototype.indexOf?function(t){var i=-1,n=-1;for(i=0;i<this.length;i++){var r=this[i];if(e&&r!=r||r===t){n=i;break}}return n}:Array.prototype.indexOf).call(this,t)>-1}.call(t,e)},Zakeke.getColorBrightness=function(t){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t.substr(0,2),16),i=parseInt(t.substr(2,2),16),n=parseInt(t.substr(4,2),16);return Math.sqrt(e*e*.241+i*i*.691+n*n*.068)},Zakeke.isColorDark=function(t){return Zakeke.getColorBrightness(t)<130},Zakeke.changeColorLuminosity=function(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,n,r="#";for(n=0;n<3;n++)i=parseInt(t.substr(2*n,2),16),r+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16))).substr(i.length);return r},Zakeke.cropImageTransparency=function(t,e,i,n){var r=new Image,a=$("<canvas>"),s=a[0],o=s.getContext("2d");r.crossOrigin="anonymous",r.onload=function(){a.attr({width:this.width,height:this.height}),(o=s.getContext("2d"))?(o.drawImage(this,0,0),function(t,r){var a=o.getImageData(0,0,s.width,s.height).data,l=function(e,i){return a[4*(t*i+e)+3]},h=function(t){return 0==t},c=function(e){for(var i=e?1:-1,n=e?0:r-1;e?n<r:n>-1;n+=i)for(var a=0;a<t;a++)if(!h(l(a,n)))return n;return null},u=function(e){for(var i=e?1:-1,n=e?0:t-1;e?n<t:n>-1;n+=i)for(var a=0;a<r;a++)if(!h(l(n,a)))return n;return null},d=c(!0),f=c(!1),g=u(!0),p=u(!1)-g,m=f-d,v=e,_=i,y=v/p,x=_/m,b=p*y,I=m*y;I>_&&(b=p*x,I=m*x);var C=$("<canvas>").attr({width:v,height:_});C[0].getContext("2d").drawImage(s,g,d,p,m,(v-b)/2,(_-I)/2,b,I);var w=C[0],S=(C[0].getContext("2d").getImageData(0,0,w.width,w.height),w.toDataURL());n&&n(S)}(this.width,this.height)):alert("Get a real browser!")},r.src=t},Zakeke.getColorImage=function(t,e,i){var n=$("<canvas>");n.attr({width:e,height:i});var r=n[0],a=r.getContext("2d");return a.fillStyle=t,a.fillRect(0,0,e,i),r.toDataURL()},Zakeke.chunkString=function(t,e){return t?t.match(new RegExp(".[^]{1,"+e+"}","g")):null},Zakeke.getStringHashCode=function(t){var e,i=0;if(0===t.length)return i;for(e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i},(MPlaza=MPlaza||{}).EmptyUUID="00000000-0000-0000-0000-000000000000",MPlaza.generateUUID=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:7&i|8).toString(16)})},MPlaza.getContrastYIQ=function(t,e,i){return(299*t+587*e+114*i)/1e3>=128?"black":"white"},MPlaza.getContrastYIQHex=function(t){return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"black":"white"},MPlaza.makeID=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},MPlaza.cloudFlareApiUrl=function(){return"string"==typeof Zakeke.config.cloudFlareApiUrl&&null!==Zakeke.config.cloudFlareApiUrl&&""!==Zakeke.config.cloudFlareApiUrl.trim()?Zakeke.config.cloudFlareApiUrl:null},MPlaza.syncCloudflare=function(t,e,i){var n=function(t){void 0!==t._defaultUrl&&(t.url=t._defaultUrl),delete t.cloudflareUrl,delete t._defaultUrl},r=Backbone.sync;e.hasOwnProperty("retrySyncEngine")&&(r=e.retrySyncEngine);var a=0,s=e.stepsLimit||2;e.cloudflareUrl=MPlaza.cloudFlareApiUrl(),e._defaultUrl=e.url,e.url=function(){var t=e._defaultUrl();return"string"==typeof e.cloudflareUrl&&null!==e.cloudflareUrl&&""!==e.cloudflareUrl.trim()&&(t=t.replace(Zakeke.config.baseApiUrl,Zakeke.config.cloudFlareApiUrl)),t},"read"===t&&null!==e.cloudflareUrl||(n(e),s=1);var o=$.Deferred(),l=function(h,c,u){var d=_.extend({},i);++a>s?(n(e),i.error(h,c,u),o.reject(h,c,u)):(delete d.error,delete d.success,r(t,e,d).then(function(t,r,a){n(e),i.success(t,r,a),o.resolve(t,r,a)}).fail(function(t,i,r){n(e),l(t,i,r)}))};return l(),o.promise()},MPlaza.PricingModel={Simple:1,Advanced:2,RuleBased:3},MPlaza.PricingType={Undefined:1,Global:2,PerColor:3},MPlaza.PricingApplicationType={Undefined:1,Global:2,PerSide:3,PerArea:4},MPlaza.AttributeType={Options:1,Color:2,Number:3,String:4},MPlaza.LogicalOperator={AND:"AND",OR:"OR"},MPlaza.ComparisonOperator={Equal:"Equal",NotEqual:"NotEqual",In:"In",NotIn:"NotIn"},MPlaza.SceneElementType={None:0,Mesh:1,Material:2,Light:4,Camera:8,CameraLocation:16,SubMesh:32},MPlaza.SceneElementType.All=MPlaza.SceneElementType.Mesh|MPlaza.SceneElementType.Material|MPlaza.SceneElementType.Light|MPlaza.SceneElementType.Camera|MPlaza.SceneElementType.CameraLocation|MPlaza.SceneElementType.SubMesh,MPlaza.SceneActionType={Filter:1,ShowHideMesh:2,SetMeshMaterial:3,SetMaterialColor:4,SetCameraLocation:5,AdjustCamera:6,SetSubMeshMaterial:7,SetCameraPivot:8,ResetCameraPivot:9,EnableDiableZoom:10,SetMeshDesignMaterial:11,SetMeshDesignEffect:12},MPlaza.PaddingType={Start:1,End:2,StartEnd:3},MPlaza.AttributeOptionPreviewShape={Rectangle:1,Circle:2},MPlaza.AttributeGroupDirection={Horizontal:0,Vertical:1},MPlaza.DeviceType={Any:0,PC:1,Phone:2,Tablet:4},MPlaza.DeviceType.All=MPlaza.DeviceType.PC|MPlaza.DeviceType.Phone|MPlaza.DeviceType.Tablet,MPlaza.ExtensionFieldDataType={Money:1,Integer:2,Decimal:3},MPlaza.ExtensionFieldOperationType={None:1,Addition:2};var TempStateObjectInterface={tempState:null,initTempState:function(){this.tempState=this.clone(),this.callToTempStateChildren("initTempState")},applyTempState:function(){this.tempState&&this.set(this.tempState.attributes),this.callToTempStateChildren("applyTempState")},resetTempState:function(){this.tempState=null},childHasTempState:function(t){return!(!t||!t.hasOwnProperty("tempState"))},hasTempStateChildren:function(){return!!(this.tempStateChildren&&Array.isArray(this.tempStateChildren)&&this.tempStateChildren.length>0)},callToTempStateChildren:function(t){if(this.hasTempStateChildren()&&this.tempState)for(var e=0;e<this.tempStateChildren.length;e++){var i=this.tempState.get(this.tempStateChildren[e]);this.childHasTempState(i)&&t&&i[t]()}}};MPlaza.UserIdentity=Backbone.AssociatedModel.extend({defaults:{nominative:"",token:""},idAttribute:"userID",initialize:function(){},url:function(){return Zakeke.config.baseApiUrl+"login"},sync:MPlaza.syncCloudflare}),MPlaza.AttributeProposition=Backbone.AssociatedModel.extend({defaults:{attributeGuid:"",op:"Equal",value:""},initialize:function(){},relations:[],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.AttributePropositions=Backbone.Collection.extend({model:MPlaza.AttributeProposition,sync:MPlaza.syncCloudflare}),MPlaza.AttributeExpression=Backbone.AssociatedModel.extend({defaults:{op:"AND",propositions:null,expressions:null},initialize:function(){this.get("propositions")||this.set("propositions",[]),this.get("expressions")||this.set("expressions",[]),this.get("propositions").parentModel=this,this.get("expressions").parentModel=this},getAllAttributeGuids:function(){for(var t=[],e=function(e){var i=e.attributeGuid;Zakeke.arrayContains(t,i)||t.push(i)},i=function(t){for(var i=0;i<t.propositions.length;i++){var n=t.proposition[i];e(n)}},n=0;n<this.get("propositions").length;n++){var r=this.get("propositions")[n];e(r)}for(n=0;n<this.get("expressions").length;n++){i(this.get("expressions")[n])}return t},isEmpty:function(){return 0==this.get("propositions").length&&0==this.get("expressions").length},sync:MPlaza.syncCloudflare}),MPlaza.AttributeExpressions=Backbone.Collection.extend({model:MPlaza.AttributeExpression,sync:MPlaza.syncCloudflare}),MPlaza.AttributeSelectionColor=Backbone.AssociatedModel.extend({defaults:{selectionExpression:null,colorID:-1},idAttribute:"selectionID",sync:MPlaza.syncCloudflare}),MPlaza.AttributeSelectionColors=Backbone.Collection.extend({model:MPlaza.AttributeSelectionColor,getAttributeSelectionColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("selectionID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.ComposerPricingPrice=Backbone.AssociatedModel.extend({defaults:{qtyFrom:0,qtyTo:null,price:0},idAttribute:"priceID",initialize:function(){},relations:[],getPricingID:function(){return this.collection&&this.collection.getPricingID?this.collection.getPricingID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.ComposerPricingPrices=Backbone.Collection.extend({model:MPlaza.ComposerPricingPrice,getPricingID:function(){return this.parentModel&&this.parentModel.getPricingID?this.parentModel.getPricingID():null},sync:MPlaza.syncCloudflare}),MPlaza.ComposerPricing=Backbone.AssociatedModel.extend({defaults:{prices:[]},idAttribute:"pricingID",initialize:function(){var t=this;this.get("prices").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("prices").on("add",function(){t._fireEvent("change")}),this.get("prices").on("remove",function(){t._fireEvent("change")}),this.get("prices").on("change",function(){t._fireEvent("change")})},_eventListeners:{change:[]},_fireEvent:function(t,e){if(this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&_.isArray(this._eventListeners[t]))for(var i=this._eventListeners[t],n=0;n<i.length;++n)i[n](e)},trigger:function(t){this._fireEvent(t)},addEventListener:function(t,e){this._eventListeners&&_.isObject(this._eventListeners)&&(_.has(this._eventListeners,t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},relations:[{type:Backbone.Many,key:"prices",collectionType:MPlaza.ComposerPricingPrices}],url:function(){var t=Zakeke.config.baseApiUrl+"composerpricings";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},getPricingID:function(){return this.get("pricingID")},toString:function(){},getComposerPricingPriceForQuantity:function(t){for(var e=0;e<this.get("prices").length;e++){var i=this.get("prices").at(e);if(i.get("qtyFrom")<=t&&(!i.get("qtyTo")||t<i.get("qtyTo")))return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.ComposerPricings=Backbone.Collection.extend({model:MPlaza.ComposerPricing,url:function(){return Zakeke.config.baseApiUrl+"composerpricings"},getComposerPricing:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("pricingID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.AttributePricing=Backbone.AssociatedModel.extend({defaults:{selectedOptionID:null,selectedOptionGuid:null,selectedValue:"",constraintExpression:null,price:0,pricingID:-1},idAttribute:"attributePricingID",initialize:function(){},resetIDs:function(){this.unset("attributePricingID")},relations:[{type:Backbone.One,key:"constraintExpression",relatedModel:MPlaza.AttributeExpression}],sync:MPlaza.syncCloudflare}),MPlaza.AttributePricings=Backbone.Collection.extend({model:MPlaza.AttributePricing,resetIDs:function(){for(var t=0;t<this.length;t++){this.at(t).resetIDs()}},sync:MPlaza.syncCloudflare}),MPlaza.AttributeSceneAction=Backbone.AssociatedModel.extend({defaults:{name:"",actionTypeID:MPlaza.SceneActionType.ShowHideMesh,sceneElementTypeID:MPlaza.SceneElementType.Mesh,selector:"",propertyName:"",value:"",execOrder:0,deviceTypes:MPlaza.DeviceType.Any},idAttribute:"actionID",initialize:function(){this.get("actionGuid")||this.set("actionGuid",MPlaza.generateUUID())},relations:[],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},resetIDs:function(){this.tempID=Zakeke.generateUUID(),this.unset("actionID")},sync:MPlaza.syncCloudflare}),MPlaza.AttributeSceneActions=Backbone.Collection.extend({model:MPlaza.AttributeSceneAction,resetIDs:function(){for(var t=0;t<this.length;t++){this.at(t).resetIDs()}},comparator:function(t){return t.get("execOrder")},getActionByID:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("actionID")===t)return i}return null},getActionByGuid:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("actionGuid")===t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.AttributeOptionExtensionField=Backbone.AssociatedModel.extend({defaults:{name:"",dataTypeID:MPlaza.ExtensionFieldDataType.Integer,operationTypeID:MPlaza.ExtensionFieldOperationType.Addition,label:"",formatString:"",value:""},idAttribute:"extensionFieldID",relations:[],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},resetIDs:function(){this.unset("extensionFieldID")},sync:MPlaza.syncCloudflare}),MPlaza.AttributeOptionExtensionFields=Backbone.Collection.extend({model:MPlaza.AttributeOptionExtensionField,resetIDs:function(){for(var t=0;t<this.length;t++){this.at(t).resetIDs()}},sync:MPlaza.syncCloudflare}),MPlaza.AttributeOption=Backbone.AssociatedModel.extend({defaults:{optionCode:"",tempImageFileKey:"",imageUrl:"",imageFileObjectID:-1,tempImageFileObjectID:-1,displayOrder:0,name:"",description:"",isDefault:!1,constraintExpression:null,actions:[],optionExtensionFields:[]},idAttribute:"optionID",initialize:function(){this.get("actions").parentModel=this,this.get("optionExtensionFields").parentModel=this,this.get("optionGuid")||this.set("optionGuid",MPlaza.generateUUID())},relations:[{type:Backbone.Many,key:"actions",collectionType:MPlaza.AttributeSceneActions},{type:Backbone.One,key:"constraintExpression",relatedModel:MPlaza.AttributeExpression},{type:Backbone.Many,key:"optionExtensionFields",collectionType:MPlaza.AttributeOptionExtensionFields}],resetIDs:function(){this.tempID=Zakeke.generateUUID(),this.unset("optionID"),this.set("optionGuid",MPlaza.generateUUID()),this.get("actions").resetIDs(),this.get("optionExtensionFields").resetIDs()},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},getPricings:function(){var t=[],e=this.getParentModel();return e&&(t=e.getOptionPricings(this.get("optionGuid"))),t},addSimplePricing:function(t,e){var i=this.getParentModel();if(i){var n=new MPlaza.AttributePricing;return this.get("optionID")&&n.set("selectedOptionID",this.get("optionID")),n.set("selectedOptionGuid",this.get("optionGuid")),e&&e instanceof MPlaza.AttributeExpression&&n.set("constraintExpression",e),n.set("price",t),i.get("pricings").add(n),n}return null},addAdvancedPricing:function(t,e){var i=this.getParentModel();if(i&&t&&t instanceof MPlaza.ComposerPricing){var n=new MPlaza.AttributePricing;this.get("optionID")&&n.set("selectedOptionID",this.get("optionID")),n.set("selectedOptionGuid",this.get("optionGuid")),e&&e instanceof MPlaza.AttributeExpression&&n.set("constraintExpression",e),n.set("pricingID",t.get("pricingID")),i.get("pricings").add(n)}},removePricing:function(t){var e=this.getParentModel();e&&e.get("pricings").remove(t)},getActionByID:function(t){return this.get("actions").getActionByID(t)},getExtensionField:function(t){return this.get("extensionFields")&&this.get("extensionFields").filter(e=>e.extensionFieldID===t)[0]},getExtensionFields:function(){return this.get("extensionFields")},getActionByGuid:function(t){return this.get("actions").getActionByGuid(t)},sync:MPlaza.syncCloudflare}),MPlaza.AttributeOptions=Backbone.Collection.extend({model:MPlaza.AttributeOption,comparator:function(t){return t.get("displayOrder")},resetIDs:function(){for(var t=0;t<this.length;t++){this.at(t).resetIDs()}},sync:MPlaza.syncCloudflare}),MPlaza.Attribute=Backbone.AssociatedModel.extend({defaults:{attributeCode:"",attributeTypeID:MPlaza.AttributeType.Options,name:"",description:"",groupID:-1,groupGuid:MPlaza.EmptyUUID,stepID:-1,stepGuid:MPlaza.EmptyUUID,defaultValue:"",displayOrder:0,optionPreviewShapeID:MPlaza.AttributeOptionPreviewShape.Rectangle,options:[],preActions:[],valueActions:[],postActions:[],pricings:[],constraintExpression:null,meshSelector:"",cameraLocationID:null,hideOptionsLabel:!1},idAttribute:"attributeID",initialize:function(){this.get("attributeGuid")||this.set("attributeGuid",MPlaza.generateUUID()),this.get("options").parentModel=this,this.get("preActions").parentModel=this,this.get("valueActions").parentModel=this,this.get("postActions").parentModel=this,this.get("pricings").parentModel=this},relations:[{type:Backbone.Many,key:"options",collectionType:MPlaza.AttributeOptions},{type:Backbone.Many,key:"preActions",collectionType:MPlaza.AttributeSceneActions},{type:Backbone.Many,key:"valueActions",collectionType:MPlaza.AttributeSceneActions},{type:Backbone.Many,key:"postActions",collectionType:MPlaza.AttributeSceneActions},{type:Backbone.Many,key:"pricings",collectionType:MPlaza.AttributePricings},{type:Backbone.One,key:"constraintExpression",relatedModel:MPlaza.AttributeExpression}],getOption:function(t){return this.get("options").findWhere({optionID:t})},getOptionByGuid:function(t){return this.get("options").findWhere({optionGuid:t})},getOptionByCode:function(t){if(!t)return null;for(var e=0;e<this.get("options").length;e++){var i=this.get("options").at(e);if(i.get("optionCode")&&i.get("optionCode")===t)return i}return null},cloneAttribute:function(t){const e=[];for(let t=0;t<this.get("options").length;t++){const i=this.get("options").at(t),n=this.get("pricings").find(t=>t.get("selectedOptionGuid")===i.get("optionGuid"));n&&e.push({optionIndex:this.get("options").indexOf(i),pricingIndex:this.get("pricings").indexOf(n)})}var i=this.clone();void 0!==t&&i.set("name",t);for(var n=0;n<this.get("options").length;n++){var r=this.get("options").at(n),a=i.get("options").at(n);a.resetIDs(),a.set("tempImageFileObjectID",r.get("imageFileObjectID"))}i.resetIDs();for(const{optionIndex:t,pricingIndex:n}of e){const e=i.get("options").at(t),r=i.get("pricings").at(n);r.set("selectedOptionID",e.get("optionID")),r.set("selectedOptionGuid",e.get("optionGuid"))}return i},addClonedOption:function(t,e){var i=t.clone();void 0!==e&&i.set("name",e),i.resetIDs(),i.set("isDefault",!1),i.set("tempImageFileObjectID",t.get("imageFileObjectID")),this.get("options").add(i);const n=this.get("pricings").find(e=>e.get("selectedOptionGuid")===t.get("optionGuid"));if(n){const t=n.clone();t.resetIDs(),t.set("selectedOptionID",i.get("optionID")),t.set("selectedOptionGuid",i.get("optionGuid")),this.get("pricings").add(t)}return i},getOptionPricings:function(t){return this.get("pricings").where({selectedOptionGuid:t})},resetIDs:function(){this.tempID=Zakeke.generateUUID(),this.unset("attributeID"),this.set("attributeGuid",MPlaza.generateUUID()),this.get("options").resetIDs(),this.get("pricings").resetIDs()},sync:MPlaza.syncCloudflare}),MPlaza.Attributes=Backbone.Collection.extend({model:MPlaza.Attribute,getAttribute:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("attributeID")===t)return i}return null},getAttributeByGuid:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("attributeGuid")===t)return i}return null},getAttributeByCode:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("attributeCode")===t)return i}return null},comparator:function(t){return t.get("displayOrder")},sync:MPlaza.syncCloudflare}),MPlaza.AttributeGroup=Backbone.AssociatedModel.extend({defaults:{tempImageFileKey:"",imageUrl:"",name:"",displayOrder:0,sceneCameraLocationID:MPlaza.EmptyUUID,meshSelector:"",direction:0,attributesAlwaysOpened:!1},idAttribute:"groupID",initialize:function(){this.get("groupGuid")||this.set("groupGuid",MPlaza.generateUUID())},relations:[],resetIDs:function(){this.tempID=Zakeke.generateUUID(),this.unset("groupID"),this.set("groupGuid",MPlaza.generateUUID())},cloneGroup:function(t){var e=this.clone();return void 0!==t&&e.set("name",t),e.resetIDs(),e},sync:MPlaza.syncCloudflare}),MPlaza.AttributeGroups=Backbone.Collection.extend({model:MPlaza.AttributeGroup,sync:MPlaza.syncCloudflare}),MPlaza.AttributeStep=Backbone.AssociatedModel.extend({defaults:{groupID:-1,groupGuid:null,name:"",displayOrder:0},idAttribute:"stepID",initialize:function(){this.get("stepGuid")||this.set("stepGuid",MPlaza.generateUUID())},relations:[],resetIDs:function(){this.tempID=Zakeke.generateUUID(),this.unset("stepID"),this.set("stepGuid",MPlaza.generateUUID())},cloneStep:function(t){var e=this.clone();return void 0!==t&&e.set("name",t),e.resetIDs(),e},sync:MPlaza.syncCloudflare}),MPlaza.AttributeSteps=Backbone.Collection.extend({model:MPlaza.AttributeStep,comparator:function(t){return t.get("displayOrder")},sync:MPlaza.syncCloudflare}),MPlaza.CompositionCategory=Backbone.AssociatedModel.extend({defaults:{categoryID:null,macroCategoryID:null},relations:[],resetIDs:function(){}}),MPlaza.CompositionCategories=Backbone.Collection.extend({model:MPlaza.CompositionCategory,sync:MPlaza.syncCloudflare}),MPlaza.FrontEndComposition=Backbone.AssociatedModel.extend({defaults:{compositionID:null,name:"",previewImageUrl:""},idAttribute:"compositionID",relations:[],resetIDs:function(){}}),MPlaza.FrontEndCompositions=Backbone.Collection.extend({model:MPlaza.FrontEndComposition,sync:MPlaza.syncCloudflare}),MPlaza.FrontEndCategory=Backbone.AssociatedModel.extend({defaults:{categoryID:null,name:"",composition:MPlaza.FrontEndCompositions},idAttribute:"categoryID",relations:[{type:Backbone.Many,key:"composition",collectionType:MPlaza.FrontEndCompositions}],resetIDs:function(){}}),MPlaza.FrontEndCategories=Backbone.Collection.extend({model:MPlaza.FrontEndCategory,sync:MPlaza.syncCloudflare}),MPlaza.FrontEndMacroCategory=Backbone.AssociatedModel.extend({defaults:{macroCategoryID:null,name:"",category:MPlaza.FrontEndCategories},idAttribute:"macroCategoryID",relations:[{type:Backbone.Many,key:"category",collectionType:MPlaza.FrontEndCategories}],resetIDs:function(){}}),MPlaza.FrontEndMacroCategories=Backbone.Collection.extend({model:MPlaza.FrontEndMacroCategory,sync:MPlaza.syncCloudflare}),MPlaza.TemplateGroup=Backbone.AssociatedModel.extend({defaults:{templateGroupGuid:null,templateGroupID:-1,groupGuid:MPlaza.EmptyUUID,groupID:-1,stepGuid:MPlaza.EmptyUUID,name:"",displayOrder:0,stepID:-1,categories:[],compositions:[],macrocategories:[],macrocategory:[]},idAttribute:"templateGroupGuid",initialize:function(){this.get("templateGroupGuid")||this.set("templateGroupGuid",MPlaza.generateUUID())},relations:[{type:Backbone.Many,key:"categories",collectionType:MPlaza.CompositionCategories},{type:Backbone.Many,key:"macrocategory",collectionType:MPlaza.FrontEndMacroCategories}],resetIDs:function(){this.tempID=Zakeke.generateUUID(),this.unset("templateGroupID"),this.set("templateGroupGuid",MPlaza.generateUUID())},cloneTemplateGroup:function(t){var e=this.clone();return void 0!==t&&e.set("name",t),e.resetIDs(),e},sync:MPlaza.syncCloudflare}),MPlaza.TemplateGroups=Backbone.Collection.extend({model:MPlaza.TemplateGroup,sync:MPlaza.syncCloudflare}),MPlaza.AttributeSteps=Backbone.Collection.extend({model:MPlaza.AttributeStep,comparator:function(t){return t.get("displayOrder")},sync:MPlaza.syncCloudflare}),MPlaza.ExtensionField=Backbone.AssociatedModel.extend({defaults:{fieldID:null,name:"",dataTypeID:MPlaza.ExtensionFieldDataType.Integer,operationTypeID:MPlaza.ExtensionFieldOperationType.None,dataTypeName:"",operationTypeName:"",label:"",formatString:""},idAttribute:"fieldID",relations:[],resetIDs:function(){this.unset("fieldID")},url:function(){return null!==this.id?Zakeke.config.baseApiUrl+"extensionFields/"+this.id:Zakeke.config.baseApiUrl+"extensionFields/"},sync:MPlaza.syncCloudflare}),MPlaza.SellerSetting=Backbone.AssociatedModel.extend({defaults:{sellerID:null,minimumFractionDigits:2,isCompositionRecapEnabled:!1,isCompositionRecapVisibleFromStart:!1,canUserCloseCompositionRecap:!1,hotJarSiteID:null,googleTagManagerID:null},idAttribute:"sellerID",relations:[],resetIDs:function(){this.unset("sellerID")},url:function(){return Zakeke.config.baseApiUrl+"sellerSetting/"},sync:MPlaza.syncCloudflare}),MPlaza.ExtensionFields=Backbone.AssociatedModel.extend({model:MPlaza.ExtensionField,url:function(){return Zakeke.config.baseApiUrl+"extensionFields"},sync:MPlaza.syncCloudflare}),MPlaza.DiffuseConfig=Backbone.AssociatedModel.extend({defaults:{enabled:!0,blendMode:"normal",level:1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.OpacityConfig=Backbone.AssociatedModel.extend({defaults:{enabled:!0},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.MeshDesignGeneralConfig=Backbone.AssociatedModel.extend({defaults:{showDesign:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.InnerShadowConfig=Backbone.AssociatedModel.extend({defaults:{enabled:!1,color:"#000000",angle:135,distance:2,size:5},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.OuterShadowConfig=Backbone.AssociatedModel.extend({defaults:{enabled:!1,color:"#000000",angle:135,distance:2,size:5},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.NormalmapConfig=Backbone.AssociatedModel.extend({defaults:{showDesign:!0,showOnDesign:!0,showOnMesh:!0,bias:50,invertR:!1,invertG:!1,preBlurEnabled:!1,preBlur:1,postBlurEnabled:!1,postBlur:1,intensity:.5,bevel:!0},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.MeshDesignConfig=Backbone.AssociatedModel.extend({defaults:{general:null,diffuse:null,opacity:null,normalmap:null,innerShadow:null,outerShadow:null},initialize:function(){this.get("general")&&(this.get("general").parentModel=this),this.get("diffuse")&&(this.get("diffuse").parentModel=this),this.get("opacity")&&(this.get("opacity").parentModel=this),this.get("normalmap")&&(this.get("normalmap").parentModel=this),this.get("innerShadow")&&(this.get("innerShadow").parentModel=this),this.get("outerShadow")&&(this.get("outerShadow").parentModel=this)},relations:[{type:Backbone.One,key:"general",relatedModel:MPlaza.MeshDesignGeneralConfig},{type:Backbone.One,key:"diffuse",relatedModel:MPlaza.DiffuseConfig},{type:Backbone.One,key:"opacity",relatedModel:MPlaza.OpacityConfig},{type:Backbone.One,key:"normalmap",relatedModel:MPlaza.NormalmapConfig},{type:Backbone.One,key:"innerShadow",relatedModel:MPlaza.InnerShadowConfig},{type:Backbone.One,key:"outerShadow",relatedModel:MPlaza.OuterShadowConfig}],getParentModel:function(){return this.parentModel},toString:function(){},getGeneralConfig:function(){return this.get("general")&&this.get("general")instanceof MPlaza.MeshDesignGeneralConfig?this.get("general"):null},getOrCreateGeneralConfig:function(){var t=this.get("general");return t||(t=new MPlaza.MeshDesignGeneralConfig,this.set("general",t)),t},getShowDesign:function(){var t=this.getGeneralConfig();return!t||t.get("showDesign")},setShowDesign:function(t){this.getOrCreateGeneralConfig().set("showDesign",t)},getDiffuseConfig:function(){return this.get("diffuse")&&this.get("diffuse")instanceof MPlaza.DiffuseConfig?this.get("diffuse"):null},getOrCreateDiffuseConfing:function(){var t=this.get("diffuse");return t||(t=new MPlaza.DiffuseConfig,this.set("diffuse",t)),t},getDiffuseEnabled:function(){var t=this.getDiffuseConfig();return!t||t.get("enabled")},setDiffuseEnabled:function(t){this.getOrCreateDiffuseConfing().set("enabled",t)},getDiffuseBlendMode:function(){var t=this.getDiffuseConfig();return t&&t.get("blendMode")?t.get("blendMode"):"normal"},setDiffuseBlendMode:function(t){this.getOrCreateDiffuseConfing().set("blendMode",t)},getDiffuseLevel:function(){var t=this.getDiffuseConfig();return t&&null!=t.get("level")&&null!=t.get("level")?t.get("level"):1},setDiffuseLevel:function(t){this.getOrCreateDiffuseConfing().set("level",t)},getOpacityConfig:function(){return this.get("opacity")&&this.get("opacity")instanceof MPlaza.OpacityConfig?this.get("opacity"):null},getOrCreateOpacityConfig:function(){var t=this.get("opacity");return t||(t=new MPlaza.OpacityConfig,this.set("opacity",t)),t},getOpacityEnabled:function(){var t=this.getOpacityConfig();return!!t&&t.get("enabled")},setOpacityEnabled:function(t){this.getOrCreateOpacityConfig().set("enabled",t)},getNormalmapConfig:function(){return this.get("normalmap")&&this.get("normalmap")instanceof MPlaza.NormalmapConfig?this.get("normalmap"):null},getOrCreateNormalmapConfig:function(){var t=this.get("normalmap");return t||(t=new MPlaza.NormalmapConfig,this.set("normalmap",t)),t},getNormalmapEnabled:function(){var t=this.getNormalmapConfig();return!!t&&t.get("enabled")},setNormalmapEnabled:function(t){this.getOrCreateNormalmapConfig().set("enabled",t)},getInnerShadowConfig:function(){return this.get("innerShadow")&&this.get("innerShadow")instanceof MPlaza.InnerShadowConfig?this.get("innerShadow"):null},getOrCreateInnerShadowConfig:function(){var t=this.get("innerShadow");return t||(t=new MPlaza.InnerShadowConfig,this.set("innerShadow",t)),t},getInnerShadowEnabled:function(){var t=this.getInnerShadowConfig();return!!t&&t.get("enabled")},setInnerShadowEnabled:function(t){this.getOrCreateInnerShadowConfig().set("enabled",t)},getOuterShadowConfig:function(){return this.get("outerShadow")&&this.get("outerShadow")instanceof MPlaza.OuterShadowConfig?this.get("outerShadow"):null},getOrCreateOuterShadowConfig:function(){var t=this.get("outerShadow");return t||(t=new MPlaza.OuterShadowConfig,this.set("outerShadow",t)),t},getOuterShadowEnabled:function(){var t=this.getOuterShadowConfig();return!!t&&t.get("enabled")},setOuterShadowEnabled:function(t){this.getOrCreateOuterShadowConfig().set("enabled",t)},sync:MPlaza.syncCloudflare}),MPlaza.ModelSceneMeshSide=Backbone.AssociatedModel.extend({defaults:{meshID:"",subMeshID:0,sideID:-1,matrix:"",percWidth:1,percHeight:1,uvChannel:0,materialID:null,materialTexture:"",config:null,isResizable:!1},idAttribute:"key",initialize:function(){},relations:[{type:Backbone.One,key:"config",relatedModel:MPlaza.MeshDesignConfig}],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},getConfig:function(){return this.get("config")},getOrCreateConfig:function(){var t=this.getConfig();return t||(t=new MPlaza.MeshDesignConfig,this.set("config",t)),t},sync:MPlaza.syncCloudflare}),MPlaza.ModelSceneMeshSides=Backbone.Collection.extend({model:MPlaza.ModelSceneMeshSide,sync:MPlaza.syncCloudflare}),MPlaza.ModelSceneMeshDesignEffect=Backbone.AssociatedModel.extend({defaults:{meshID:"",subMeshID:0,name:"",materialID:null,config:null,isDefault:!1},idAttribute:"effectID",initialize:function(){this.get("effectID")||this.set("effectID",MPlaza.generateUUID())},relations:[{type:Backbone.One,key:"config",relatedModel:MPlaza.MeshDesignConfig}],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},getConfig:function(){return this.get("config")},getOrCreateConfig:function(){var t=this.getConfig();return t||(t=new MPlaza.MeshDesignConfig,this.set("config",t)),t},sync:MPlaza.syncCloudflare}),MPlaza.ModelSceneMeshDesignEffects=Backbone.Collection.extend({model:MPlaza.ModelSceneMeshDesignEffect,sync:MPlaza.syncCloudflare}),MPlaza.ModelScene=Backbone.AssociatedModel.extend({defaults:{sceneID:"",isDefault:!1,meshSides:[],meshDesignEffects:[],isResizable:!1},initialize:function(){this.get("meshSides").parentModel=this,this.get("meshDesignEffects").parentModel=this},relations:[{type:Backbone.Many,key:"meshSides",collectionType:MPlaza.ModelSceneMeshSides},{type:Backbone.Many,key:"meshDesignEffects",collectionType:MPlaza.ModelSceneMeshDesignEffects}],isEffectForMesh:function(t,e,i){var n=this.get("meshDesignEffects");if(n)for(var r=0;r<n.length;r++){var a=n.at(r);if(a.get("meshID")===t&&a.get("subMeshID")===e&&a.get("effectID")===i)return!0}return!1},getMeshDesignEffect:function(t){var e=this.get("meshDesignEffects");if(e)for(var i=0;i<e.length;i++){var n=e.at(i);if(n.get("effectID")===t)return n}return null},getMeshDesignEffects:function(t,e){var i=this.get("meshDesignEffects");if(i)for(var n=0;n<i.length;n++){var r=i.at(n);if(r.get("meshID")==t&&r.get("subMeshID")==e)return r}return null},getDefaultDesignEffect:function(t,e){var i=this.get("meshDesignEffects");if(i)for(var n=0;n<i.length;n++){var r=i.at(n);if(r.get("meshID")==t&&r.get("subMeshID")==e&&r.get("isDefault"))return r}return null},sync:MPlaza.syncCloudflare}),MPlaza.ModelScenes=Backbone.Collection.extend({model:MPlaza.ModelScene,sync:MPlaza.syncCloudflare}),MPlaza.AttributeSelectionScript=function(){this.attributeID=-1,this.selectedValue="",this.actions=[]},MPlaza.DesignPrice=Backbone.AssociatedModel.extend({defaults:{qtyFrom:0,qtyTo:null,price:0,firstColorPrice:null},idAttribute:"priceID",initialize:function(){},relations:[],getPricingID:function(){return this.collection&&this.collection.getPricingID?this.collection.getPricingID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignPrices=Backbone.Collection.extend({model:MPlaza.DesignPrice,getPricingID:function(){return this.parentModel&&this.parentModel.getPricingID?this.parentModel.getPricingID():null},sync:MPlaza.syncCloudflare}),MPlaza.SetupPrice=Backbone.AssociatedModel.extend({defaults:{qtyFrom:0,qtyTo:null,price:0,firstColorPrice:null},idAttribute:"priceID",initialize:function(){},relations:[],getPricingID:function(){return this.collection&&this.collection.getPricingID?this.collection.getPricingID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.SetupPrices=Backbone.Collection.extend({model:MPlaza.SetupPrice,getPricingID:function(){return this.parentModel&&this.parentModel.getPricingID?this.parentModel.getPricingID():null},sync:MPlaza.syncCloudflare}),MPlaza.Pricing=Backbone.AssociatedModel.extend({defaults:{setupPriceTypeID:MPlaza.PricingType.Global,designPriceTypeID:MPlaza.PricingType.Global,setupPrices:[],designPrices:[]},idAttribute:"pricingID",initialize:function(){var t=this;this.get("setupPrices").parentModel=this,this.get("designPrices").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("setupPrices").on("add",function(){t._fireEvent("change")}),this.get("setupPrices").on("remove",function(){t._fireEvent("change")}),this.get("setupPrices").on("change",function(){t._fireEvent("change")}),this.get("designPrices").on("add",function(){t._fireEvent("change")}),this.get("designPrices").on("remove",function(){t._fireEvent("change")}),this.get("designPrices").on("change",function(){t._fireEvent("change")})},_eventListeners:{change:[]},_fireEvent:function(t,e){if(this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&_.isArray(this._eventListeners[t]))for(var i=this._eventListeners[t],n=0;n<i.length;++n)i[n](e)},trigger:function(t){this._fireEvent(t)},addEventListener:function(t,e){this._eventListeners&&_.isObject(this._eventListeners)&&(_.has(this._eventListeners,t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},relations:[{type:Backbone.Many,key:"setupPrices",collectionType:MPlaza.SetupPrices},{type:Backbone.Many,key:"designPrices",collectionType:MPlaza.DesignPrices}],url:function(){var t=Zakeke.config.baseApiUrl+"pricings";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},getPricingID:function(){return this.get("pricingID")},toString:function(){},getSetupPriceForQuantity:function(t){for(var e=0;e<this.get("setupPrices").length;e++){var i=this.get("setupPrices").at(e);if(i.get("qtyFrom")<=t&&(!i.get("qtyTo")||t<i.get("qtyTo")))return i}return null},getDesignPriceForQuantity:function(t){for(var e=0;e<this.get("designPrices").length;e++){var i=this.get("designPrices").at(e);if(i.get("qtyFrom")<=t&&(!i.get("qtyTo")||t<i.get("qtyTo")))return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.Pricings=Backbone.Collection.extend({model:MPlaza.Pricing,url:function(){return Zakeke.config.baseApiUrl+"pricings"},getPricing:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("pricingID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectParameterValue=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},toJSON:function(){return{name:this.get("name"),value:this.get("value")}},copyAttributes:function(t){this.set("name",t.get("name")),this.set("value",t.get("value"))},sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectParameterValues=Backbone.Collection.extend({model:MPlaza.ImageEffectParameterValue,getValue:function(t){for(var e=0;e<this.length;e++)if(this.at(e).get("name").toLowerCase()===t.toLowerCase())return this.at(e).get("value")},getValueNumber:function(t){var e=this.getValue(t);if(e)return Number(e)},getValueInt:function(t){var e=this.getValue(t);if(e)return parseInt(e)},getValueFloat:function(t){var e=this.getValue(t);if(e)return parseFloat(e)},getValueBoolean:function(t){var e=this.getValue(t);if(e)return"true"===e.toLowerCase()},sync:MPlaza.syncCloudflare}),MPlaza.DesignEffect=Backbone.AssociatedModel.extend({defaults:{blendMode:"normal",enhancedBlendMode:!1,opacity:1,textColor:null,imageEffectTypeName:null,imageEffectParameterValues:[]},initialize:function(){this.get("imageEffectParameterValues").parentModel=this},relations:[{type:Backbone.Many,key:"imageEffectParameterValues",collectionType:MPlaza.ImageEffectParameterValues}],sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectParameterOption=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},toJSON:function(){return{nameKey:this.get("nameKey"),value:this.get("value")}},copyAttributes:function(t){this.set("nameKey",t.get("nameKey")),this.set("value",t.get("value"))},sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectParameterOptions=Backbone.Collection.extend({model:MPlaza.ImageEffectParameterOption,sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectParameter=Backbone.AssociatedModel.extend({defaults:{name:"",options:[]},initialize:function(){},relations:[{type:Backbone.Many,key:"options",collectionType:MPlaza.ImageEffectParameterOptions}],getParentModel:function(){return this.parentModel},toString:function(){},toJSON:function(){return{name:this.get("name"),labelKey:this.get("labelKey"),type:this.get("type"),min:this.get("min"),max:this.get("max"),step:this.get("step"),required:this.get("required"),defaultValue:this.get("defaultValue"),displayOrder:this.get("displayOrder"),options:this.get("options").toJSON()}},copyAttributes:function(t){this.set("name",t.get("name")),this.set("labelKey",t.get("labelKey")),this.set("type",t.get("type")),this.set("min",t.get("min")),this.set("max",t.get("max")),this.set("step",t.get("step")),this.set("required",t.get("required")),this.set("defaultValue",t.get("defaultValue")),this.set("displayOrder",t.get("displayOrder"));for(var e=[],i=0;i<t.get("options").length;i++){var n=t.get("options").at(i),r=new MPlaza.ImageEffectParameterOption;r.copyAttributes(n),e.push(r)}this.set("options",e)},sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectParameters=Backbone.Collection.extend({model:MPlaza.ImageEffectParameter,sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectType=Backbone.AssociatedModel.extend({defaults:{name:"",parameters:[]},idAttribute:"imageEffectTypeID",initialize:function(){this.get("parameters").parentModel=this},relations:[{type:Backbone.Many,key:"parameters",collectionType:MPlaza.ImageEffectParameters}],url:function(){var t=Zakeke.config.baseApiUrl+"imageeffects/types";return void 0!==this.id&&null!==this.id&&this.id>0&&(t=t+"/"+this.id),t},getImageEffectTypeID:function(){return this.get("imageEffectTypeID")},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.ImageEffectTypes=Backbone.Collection.extend({model:MPlaza.ImageEffectType,url:function(){return Zakeke.config.baseApiUrl+"imageeffects/types"},sync:MPlaza.syncCloudflare}),MPlaza.PrintTypeFont=Backbone.AssociatedModel.extend({defaults:{printTypeID:-1,fontFamilyID:-1,fontFamilyName:null},idAttribute:"fontFamilyID",initialize:function(){},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.PrintTypeFonts=Backbone.Collection.extend({model:MPlaza.PrintTypeFont,getModelID:function(){return this.parentModel?this.parentModel.getModelID():null},getFont:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("fontFamilyID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.PartPrintTypeRestriction=Backbone.AssociatedModel.extend({defaults:{disableTextColors:null,textColors:null,disableSellerImages:null,disableUserImages:null,useImagesFixedSize:null,canAddText:null,canChangeSvgColors:null,canUseImageFilters:null,uploadRestrictions:null,canIgnoreDPIWarning:null,canPreviewDesignsPDF:null,useCustomFonts:null,defaultFontFamilyID:null,fonts:[],showLayerButtons:null,showDuplicateButton:null,showFlipButtons:null,showImageProvider:null,canUseTextArt:null,imageEditingToolSettingsToExclude:null,imageInsertScalingUpload:null,imageInsertScalingCliparts:null},idAttribute:"partPrintTypeRestrictionID",initialize:function(){var t=this;this.get("fonts").url=function(){return t.url()+"/fonts"},this.get("fonts").parentModel=this},relations:[{type:Backbone.Many,key:"fonts",collectionType:MPlaza.PrintTypeFonts}],url:function(){var t=Zakeke.config.baseApiUrl+"partPrintTypeRestrictions";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getPartPrintTypeRestrictionID:function(){return this.get("partPrintTypeRestrictionID")},getParentModel:function(){return this.parentModel?this.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.PartPrintTypeOutputSettings=Backbone.AssociatedModel.extend({defaults:{width:0,height:0,partPrintTypeOutputSettingsID:-1,rows:0,columns:0,marginH:0,marginV:0,rotation:0,flowDirectionH:1,flowDirectionV:1,flowDirectionPriority:1},idAttribute:"partPrintTypeOutputSettingsID",sync:MPlaza.syncCloudflare}),MPlaza.PartPrintType=Backbone.AssociatedModel.extend({defaults:{isEnabled:!0,pricingID:-1,patID:MPlaza.PricingApplicationType.Global,partPrintTypeRestrictionID:null,dpi:null,restrictions:null,outputSettings:null},idAttribute:"printTypeID",initialize:function(){this.get("restrictions")&&(this.get("restrictions").parentModel=this),this.get("outputSettings")&&(this.get("outputSettings").parentModel=this)},relations:[{type:Backbone.One,key:"restrictions",relatedModel:MPlaza.PartPrintTypeRestriction},{type:Backbone.One,key:"outputSettings",relatedModel:MPlaza.PartPrintTypeOutputSettings}],url:function(){var t=Zakeke.config.baseApiUrl+"partprintTypes";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getPrintTypeID:function(){return this.get("printTypeID")},toString:function(){},setRestrictions:function(t){this.set("restrictions",t),t&&(this.get("restrictions").parentModel=this)},setOutputSettings:function(t){this.set("outputSettings",t),t&&(this.get("outputSettings").parentModel=this)},sync:MPlaza.syncCloudflare}),MPlaza.PartPrintTypes=Backbone.Collection.extend({model:MPlaza.PartPrintType,url:function(){return Zakeke.config.baseApiUrl+"partprinttypes"},getPrintType:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("printTypeID")>0?i.get("printTypeID")===t:i.tempID&&i.tempID===t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.AreaLayer=Backbone.AssociatedModel.extend({defaults:{name:"",json:"",svg:"",displayOrder:0,isVisibleInCanvas:!0,isVisibleInCart:!0,isVisibleInOutput:!0,showLabel:!0,isClipMask:!1},idAttribute:"layerID",initialize:function(){this.get("layerID")||this.set("layerID",MPlaza.generateUUID())},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getColorID:function(){return this.collection&&this.collection.getColorID?this.collection.getColorID():null},getSideID:function(){return this.collection&&this.collection.getSideID?this.collection.getSideID():null},getAreaID:function(){return this.collection&&this.collection.getAreaID?this.collection.getAreaID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},getArea:function(){return this.getParentModel()},getSide:function(){var t=this.getArea();return t&&t instanceof MPlaza.Area?t.getSide():null},getColor:function(){var t=this.getSide();return t&&t instanceof MPlaza.Side?t.getParentModel():null},getModel:function(){var t=this.getColor();return t&&t instanceof MPlaza.Color?t.getParentModel():null},sync:MPlaza.syncCloudflare}),MPlaza.AreaLayers=Backbone.Collection.extend({model:MPlaza.AreaLayer,getModelID:function(){return this.parentModel&&this.parentModel.getModelID?this.parentModel.getModelID():null},getColorID:function(){return this.parentModel&&this.parentModel.getColorID?this.parentModel.getColorID():null},getSideID:function(){return this.parentModel&&this.parentModel.getSideID?this.parentModel.getSideID():null},getAreaID:function(){return this.parentModel&&this.parentModel.getAreaID?this.parentModel.getAreaID():null},sync:MPlaza.syncCloudflare}),MPlaza.AreaTextConstraints=Backbone.AssociatedModel.extend({defaults:{maxNumItems:-1,maxNumChars:-1,fitArea:!1,canMove:!0,canResize:!0,canRotate:!0,fixedDirection:0},initialize:function(){},url:function(){return""},getModelID:function(){return this.parentModel?this.parentModel.getModelID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.AreaTemplateFile=Backbone.AssociatedModel.extend({defaults:{fileID:"",fileUrl:""},initialize:function(){},url:function(){return""},getModelID:function(){return this.parentModel?this.parentModel.getModelID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.Area=Backbone.AssociatedModel.extend({defaults:{guid:"",name:"",path:"",pathSVG:"",boundsX:0,boundsY:0,boundsWidth:0,boundsHeight:0,clipOut:!0,screenPPI:0,textConstraints:null,templateFile:null,printTypes:[],layers:[]},idAttribute:"areaID",relations:[{type:Backbone.One,key:"textConstraints",relatedModel:MPlaza.AreaTextConstraints},{type:Backbone.One,key:"templateFile",relatedModel:MPlaza.AreaTemplateFile},{type:Backbone.Many,key:"printTypes",collectionType:MPlaza.PartPrintTypes},{type:Backbone.Many,key:"layers",collectionType:MPlaza.AreaLayers}],initialize:function(){this.get("guid")||this.set("guid",MPlaza.generateUUID()),this.get("textConstraints")&&(this.get("textConstraints").parentModel=this),this.get("templateFile")&&(this.get("templateFile").parentModel=this),this.get("layers")&&(this.get("layers").parentModel=this)},url:function(){var t=Zakeke.config.baseApiUrl+"areas";return this.collection&&this.collection.url&&(t=this.collection.url()),this.id&&this.id>0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getColorID:function(){return this.collection&&this.collection.getColorID?this.collection.getColorID():null},getSideID:function(){return this.collection&&this.collection.getSideID?this.collection.getSideID():null},getAreaID:function(){return this.get("areaID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},getPrintType:function(t){for(var e=0;e<this.get("printTypes").length;e++){var i=this.get("printTypes").at(e);if(i.get("printTypeID")>0?i.get("printTypeID")===t:i.tempID&&i.tempID===t)return i}return null},getSide:function(){return this.getParentModel()},getColor:function(){var t=this.getParentModel();return t&&t instanceof MPlaza.Side?t.getParentModel():null},getModel:function(){var t=this.getParentModel();if(t&&t instanceof MPlaza.Side){var e=t.getParentModel();if(e&&e instanceof MPlaza.Color)return e.getParentModel()}return null},sync:MPlaza.syncCloudflare}),MPlaza.Areas=Backbone.Collection.extend({model:MPlaza.Area,getArea:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("guid")==t)return i}return null},getAreaByID:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("areaID")==t)return i}return null},getMaxArea:function(){for(var t=0,e=null,i=0;i<this.length;i++){var n=this.at(i),r=new paper.Rectangle(n.get("boundsX"),n.get("boundsY"),n.get("boundsWidth"),n.get("boundsHeight")).area;t<r&&(t=r,e=n)}return e},url:function(){return Zakeke.config.baseApiUrl+"areas"},getModelID:function(){return this.parentModel&&this.parentModel.getModelID?this.parentModel.getModelID():null},getColorID:function(){return this.parentModel&&this.parentModel.getColorID?this.parentModel.getColorID():null},getSideID:function(){return this.parentModel&&this.parentModel.getSideID?this.parentModel.getSideID():null},sync:MPlaza.syncCloudflare}),MPlaza.Side=Backbone.AssociatedModel.extend({defaults:{name:"",code:"",ppcm:0,tempImageFileKey:"",imageUrl:"",colorable:!1,sortOrder:null,isDefault:!1,printTypes:[],areas:[],cameraLocationID:null},idAttribute:"sideID",initialize:function(){var t=this;this.get("areas").url=function(){return t.url()+"/areas"},this.get("areas").parentModel=this},relations:[{type:Backbone.Many,key:"areas",collectionType:MPlaza.Areas},{type:Backbone.Many,key:"printTypes",collectionType:MPlaza.PartPrintTypes}],url:function(){var t=Zakeke.config.baseApiUrl+"sides";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getColorID:function(){return this.collection&&this.collection.getColorID?this.collection.getColorID():null},getSideID:function(){return this.get("sideID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},findAreaByID:function(t){var e=this.get("areas");return e?e.findWhere({areaID:t}):null},findAreaByGuid:function(t){var e=this.get("areas");return e?e.findWhere({guid:t}):null},getPrintType:function(t){for(var e=0;e<this.get("printTypes").length;e++){var i=this.get("printTypes").at(e);if(i.get("printTypeID")>0?i.get("printTypeID")===t:i.tempID&&i.tempID===t)return i}return null},toString:function(){},getColor:function(){return this.getParentModel()},getModel:function(){var t=this.getParentModel();return t&&t instanceof MPlaza.Color?t.getParentModel():null},sync:MPlaza.syncCloudflare}),MPlaza.Sides=Backbone.Collection.extend({model:MPlaza.Side,url:function(){return Zakeke.config.baseApiUrl+"sides"},getModelID:function(){return this.parentModel&&this.parentModel.getModelID?this.parentModel.getModelID():null},getColorID:function(){return this.parentModel&&this.parentModel.getColorID?this.parentModel.getColorID():null},getSide:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sideID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.CompliantColor=Backbone.AssociatedModel.extend({defaults:{},idAttribute:"colorCode",url:function(){var t=Zakeke.config.baseApiUrl+"compliantColors";return this.collection&&this.collection.url&&(t=this.collection.url()),this.id&&this.id>0&&(t=t+"/"+this.id),t},getModelID:function(){if(this.collection&&this.collection.getModelID)return this.collection.getModelID()},getColorID:function(){if(this.collection&&this.collection.getColorID)return this.collection.getColorID()},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.CompliantColors=Backbone.Collection.extend({model:MPlaza.CompliantColor,getCompliantColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("colorCode")==t)return i}return null},url:function(){return Zakeke.config.baseApiUrl+"compliantColors"},getModelID:function(){return this.parentModel&&this.parentModel.getModelID()?this.parentModel.getModelID():null},getColorID:function(){return this.parentModel&&this.parentModel.getColorID()?this.parentModel.getColorID():null},sync:MPlaza.syncCloudflare}),MPlaza.Size=Backbone.AssociatedModel.extend({defaults:{name:"",genre:""},idAttribute:"sizeID",url:function(){var t=Zakeke.config.baseApiUrl+"sizes";return this.collection&&this.collection.url&&(t=this.collection.url()),this.id&&this.id>0&&(t=t+"/"+this.id),t},getModelID:function(){if(this.collection&&this.collection.getModelID)return this.collection.getModelID()},getColorID:function(){if(this.collection&&this.collection.getColorID)return this.collection.getColorID()},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.Sizes=Backbone.Collection.extend({model:MPlaza.Size,getSize:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sizeID")==t)return i}return null},url:function(){return Zakeke.config.baseApiUrl+"sizes"},getModelID:function(){return this.parentModel&&this.parentModel.getModelID?this.parentModel.getModelID():null},getColorID:function(){return this.parentModel&&this.parentModel.getColorID?this.parentModel.getColorID():null},sync:MPlaza.syncCloudflare}),MPlaza.Color=Backbone.AssociatedModel.extend({defaults:{name:"",colorCode:"",colorHexCode:"",code:"",colorProviderCode:"",imageUrl:"",showSideImage:!1,position:0,sizes:[],compliantColors:[],printTypes:[],sides:[]},idAttribute:"colorID",initialize:function(){var t=this;this.get("sizes").url=function(){return t.url()+"/sizes"},this.get("compliantColors").url=function(){return t.url()+"/compliantColors"},this.get("sides").url=function(){return t.url()+"/sides"},this.get("sizes").parentModel=this,this.get("compliantColors").parentModel=this,this.get("sides").parentModel=this},relations:[{type:Backbone.Many,key:"sizes",collectionType:MPlaza.Sizes},{type:Backbone.Many,key:"compliantColors",collectionType:MPlaza.CompliantColors},{type:Backbone.Many,key:"sides",collectionType:MPlaza.Sides},{type:Backbone.Many,key:"printTypes",collectionType:MPlaza.PartPrintTypes}],url:function(){var t=Zakeke.config.baseApiUrl+"colors";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getColorID:function(){return this.get("colorID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},findSize:function(t){var e=this.get("sizes");return e?e.findWhere({sizeID:t}):null},findCompliantColor:function(t){return this.get("compliantColors")?sizes.findWhere({colorCode:t}):null},findSide:function(t){var e=this.get("sides");return e?e.findWhere({sideID:t}):null},getAreaWithGuid:function(t){for(var e=this.get("sides"),i=0;i<e.length;i++){var n=e.at(i).getArea(t);if(n)return n}return null},getPrintType:function(t){for(var e=0;e<this.get("printTypes").length;e++){var i=this.get("printTypes").at(e);if(i.get("printTypeID")>0?i.get("printTypeID")===t:i.tempID&&i.tempID===t)return i}return null},toString:function(){},getModel:function(){return this.getParentModel()},sync:MPlaza.syncCloudflare}),MPlaza.Colors=Backbone.Collection.extend({model:MPlaza.Color,url:function(){return Zakeke.config.baseApiUrl+"colors"},getModelID:function(){return this.parentModel?this.parentModel.getModelID():null},getColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("colorID")==t)return i}return null},comparator:function(t){return t.get("position")},sync:MPlaza.syncCloudflare}),MPlaza.PrintType=Backbone.AssociatedModel.extend({defaults:{name:"",dpi:300,printTypeDPI:0,priceDeltaPerc:0,priceDeltaValue:0,price:0,textBasePrice:0,imageBasePrice:0,pricingID:-1,patID:MPlaza.PricingApplicationType.Global,disableTextColors:null,disableImageColors:null,disableSellerImages:null,disableUserImages:null,useImagesFixedSize:null,textColors:null,imageColors:null,canAddText:null,canChangeSvgColors:null,canUseImageFilters:null,uploadRestrictions:null,canIgnoreDPIWarning:null,useCustomFonts:null,printTypeFonts:[],printTypeDefaultFontFamilyID:null,fonts:[],defaultFontFamilyID:null,pantoneEnabled:!1,canPreviewDesignsPDF:null,outputTypeID:1,outputSettings:null,showLayerButtons:null,showDuplicateButton:null,showFlipButtons:null,showImageProvider:null,canUseTextArt:null,imageEditingToolSettingsToExclude:null,printTypeRestrictionsID:null,printTypeRestrictions:null,previewDesignEffect:null,outputDesignEffect:null,maxColors:null,paletteID:null,paletteColors:[],splitColorFiles:!1,layeredPdf:!1},idAttribute:"printTypeID",initialize:function(){var t=this;this.get("printTypeFonts").url=function(){return t.url()+"/printtypefonts"},this.get("fonts").url=function(){return t.url()+"/fonts"},this.get("printTypeFonts").parentModel=this,this.get("fonts").parentModel=this,this.get("printTypeRestrictions")&&(this.get("printTypeRestrictions").parentModel=this)},relations:[{type:Backbone.One,key:"printTypeRestrictions",relatedModel:MPlaza.PartPrintTypeRestriction},{type:Backbone.Many,key:"printTypeFonts",collectionType:MPlaza.PrintTypeFonts},{type:Backbone.Many,key:"fonts",collectionType:MPlaza.PrintTypeFonts},{type:Backbone.One,key:"outputSettings",relatedModel:MPlaza.PartPrintTypeOutputSettings},{type:Backbone.One,key:"previewDesignEffect",relatedModel:MPlaza.DesignEffect},{type:Backbone.One,key:"outputDesignEffect",relatedModel:MPlaza.DesignEffect}],url:function(){var t=Zakeke.config.baseApiUrl+"printTypes";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getPrintTypeID:function(){return this.get("printTypeID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},setOutputSettings:function(t){this.set("outputSettings",t),t&&(this.get("outputSettings").parentModel=this)},sync:MPlaza.syncCloudflare}),MPlaza.PrintTypes=Backbone.Collection.extend({model:MPlaza.PrintType,url:function(){return Zakeke.config.baseApiUrl+"printtypes"},getModelID:function(){return this.parentModel?this.parentModel.getModelID():null},getPrintType:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("printTypeID")>0?i.get("printTypeID")===t:i.tempID&&i.tempID===t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.OptionsItem=Backbone.AssociatedModel.extend({defaults:{optionId:-1,modelID:-1,colorID:-1,sideID:null,optionsData:{}},idAttribute:"optionId",initialize:function(){},relations:[],getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getColorID:function(){return this.get("colorID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},getModel:function(){return this.getParentModel()},sync:MPlaza.syncCloudflare}),MPlaza.ModelOptions=Backbone.Collection.extend({model:MPlaza.OptionsItem,url:function(){return Zakeke.config.baseApiUrl+"options"},getModelID:function(){return this.parentModel?this.parentModel.getModelID():null},sync:MPlaza.syncCloudflare}),MPlaza.PreviewColor=Backbone.AssociatedModel.extend({defaults:{color:"",hasTexture:!1,textureUrl:"",tempTextureFileKey:"",isCustomTexture:!1,refractionMode:null,reflectivity:null,opacity:null,opacityAffectCustomization:null,textureWidth:null,textureHeight:null,itemsPositionX:null,itemsPositionY:null,itemsScaleX:null,itemsScaleY:null},idAttribute:"colorID",initialize:function(){},url:function(){var t=Zakeke.config.baseApiUrl+"previewcolors";return this.collection&&this.collection.url&&(t=this.collection.url()),this.id&&this.id>0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getPreviewModelID:function(){return this.collection&&this.collection.getPreviewModelID?this.collection.getPreviewModelID():null},getPartID:function(){return this.collection&&this.collection.getPartID?this.collection.getPartID():null},getColorID:function(){return this.get("colorID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.PreviewColors=Backbone.Collection.extend({model:MPlaza.PreviewColor,getPreviewColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("colorID")==t)return i}return null},url:function(){return Zakeke.config.baseApiUrl+"previewcolors"},getModelID:function(){return this.parentModel&&this.parentModel.getModelID?this.parentModel.getModelID():null},getPreviewModelID:function(){return this.parentModel&&this.parentModel.getPreviewModelID?this.parentModel.getPreviewModelID():null},getPartID:function(){return this.parentModel&&this.parentModel.getPartID?this.parentModel.getPartID():null},sync:MPlaza.syncCloudflare}),MPlaza.PreviewPart=Backbone.AssociatedModel.extend({defaults:{materialIndex:-1,sideID:-1,color:"",hasTexture:!1,textureWidth:0,textureHeight:0,textureUrl:"",tempTextureFileKey:"",reflectivity:0,opacity:1,opacityAffectCustomization:!0,itemsPositionX:0,itemsPositionY:0,itemsScaleX:0,itemsScaleY:0,refractionMode:!1,colors:[]},idAttribute:"partID",initialize:function(){var t=this;this.get("colors").url=function(){return t.url()+"/previewcolors"},this.get("colors").parentModel=this},relations:[{type:Backbone.Many,key:"colors",collectionType:MPlaza.PreviewColors}],url:function(){var t=Zakeke.config.baseApiUrl+"previewparts";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getPreviewModelID:function(){return this.collection&&this.collection.getPreviewModelID?this.collection.getPreviewModelID():null},getPartID:function(){return this.get("partID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},findColor:function(t){var e=this.get("colors");return e?e.findWhere({colorID:t}):null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.PreviewParts=Backbone.Collection.extend({model:MPlaza.PreviewPart,url:function(){return Zakeke.config.baseApiUrl+"previewparts"},getModelID:function(){return this.parentModel&&this.parentModel.getModelID?this.parentModel.getModelID():null},getPreviewModelID:function(){return this.parentModel&&this.parentModel.getPreviewModelID?this.parentModel.getPreviewModelID():null},getPreviewPart:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("partID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.PreviewModel=Backbone.AssociatedModel.extend({defaults:{backface:!1,scale:1,tempModel3DFileKey:"",model3DUrl:"",parts:[]},idAttribute:"modelID",initialize:function(){var t=this;this.get("parts").url=function(){return t.url()+"/previewparts"},this.get("parts").parentModel=this},relations:[{type:Backbone.Many,key:"parts",collectionType:MPlaza.PreviewParts}],url:function(){var t=Zakeke.config.baseApiUrl+"previewmodels";return this.collection&&this.collection.url&&(t=this.collection.url()),null!=this.id&&null!=this.id&&this.id>=0&&(t=t+"/"+this.id),t},getModelID:function(){return this.collection&&this.collection.getModelID?this.collection.getModelID():null},getPreviewModelID:function(){return this.get("modelID")},getParentModel:function(){return this.parentModel?this.parentModel:null},findPart:function(t){var e=this.get("parts");return e?e.findWhere({partID:t}):null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.QuantityRule=Backbone.AssociatedModel.extend({defaults:{minQuantity:null,maxQuantity:null,step:null},sync:MPlaza.syncCloudflare}),MPlaza.VariantOptionMaterialAction=Backbone.AssociatedModel.extend({defaults:{actionGuid:"",meshID:""},initialize:function(){},relations:[],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.VariantOptionMaterialActions=Backbone.Collection.extend({model:MPlaza.VariantOptionMaterialAction,getActionForMesh(t){for(var e=0;e<this.length;e++)if(this.at(e).get("meshID")===t)return this.at(e);return null},sync:MPlaza.syncCloudflare}),MPlaza.VariantOptionMaterial=Backbone.AssociatedModel.extend({defaults:{optionMaterialID:"",variableMaterialID:"",actions:[]},initialize:function(){this.get("actions").parentModel=this},relations:[{type:Backbone.Many,key:"actions",collectionType:MPlaza.VariantOptionMaterialActions}],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.VariantOptionMaterials=Backbone.Collection.extend({model:MPlaza.VariantOptionMaterial,sync:MPlaza.syncCloudflare}),MPlaza.VariantOption=Backbone.AssociatedModel.extend({defaults:{variantID:"",optionGuid:"",materials:[]},initialize:function(){this.get("materials").parentModel=this},relations:[{type:Backbone.Many,key:"materials",collectionType:MPlaza.VariantOptionMaterials}],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.VariantOptions=Backbone.Collection.extend({model:MPlaza.VariantOption,getVariantOption(t){for(var e=0;e<this.length;e++)if(this.at(e).get("variantID")===t)return this.at(e);return null},sync:MPlaza.syncCloudflare}),MPlaza.VariableMaterial=Backbone.AssociatedModel.extend({defaults:{materialID:"",meshes:[]},initialize:function(){},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.VariableMaterials=Backbone.Collection.extend({model:MPlaza.VariableMaterial,getVariableMaterial(t){for(var e=0;e<this.length;e++)if(this.at(e).get("materialID")===t)return this.at(e);return null},sync:MPlaza.syncCloudflare}),MPlaza.VariantsAttributeOptions=Backbone.AssociatedModel.extend({defaults:{attributeGuid:"",variableMaterials:[],variantOptions:[]},initialize:function(){this.get("variableMaterials").parentModel=this,this.get("variantOptions").parentModel=this},relations:[{type:Backbone.Many,key:"variableMaterials",collectionType:MPlaza.VariableMaterials},{type:Backbone.Many,key:"variantOptions",collectionType:MPlaza.VariantOptions}],getParentModel:function(){return this.parentModel?this.parentModel:null},getOptionsMaterialIDs:function(){for(var t=[],e=0;e<this.get("variantOptions").length;e++)for(var i=this.get("variantOptions").at(e),n=0;n<i.get("materials").length;n++){var r=i.get("materials").at(n).get("optionMaterialID");-1===t.indexOf(r)&&t.push(r)}return t},setVariableMaterial:function(t,e){var i=this.get("variableMaterials").getVariableMaterial(t);i||((i=new MPlaza.VariableMaterial).set("materialID",t),this.get("variableMaterials").push(i)),i.set("meshes",e)},removeVariableMaterial:function(t){var e=this.get("variableMaterials").getVariableMaterial(t);e&&this.get("variableMaterials").remove(e)},getVariantOption:function(t){return this.get("variantOptions").getVariantOption(t)},sync:MPlaza.syncCloudflare}),MPlaza.Preview3D=Backbone.AssociatedModel.extend({defaults:{variantsAttributeOptions:null},initialize:function(){this.get("variantsAttributeOptions")&&(this.get("variantsAttributeOptions").parentModel=this)},relations:[{type:Backbone.One,key:"variantsAttributeOptions",relatedModel:MPlaza.VariantsAttributeOptions}],getParentModel:function(){return this.parentModel?this.parentModel:null},getVariantsAttributeOptions:function(){return this.get("variantsAttributeOptions")},getOrCreateVariantsAttributeOptions:function(){var t=this.getVariantsAttributeOptions();return t||(t=new MPlaza.VariantsAttributeOptions,this.set("variantsAttributeOptions",t)),t},sync:MPlaza.syncCloudflare}),MPlaza.Model=Backbone.AssociatedModel.extend({defaults:{name:"",description:"",code:"",statusID:1,tempSmallImageFileKey:"",smallImageUrl:"",tempLargeImageFileKey:"",largeImageUrl:"",price:0,variantIconCode:"",variantTypeName:"",pricingModelID:MPlaza.PricingModel.Simple,defaultDesignTemplateID:-1,loadFirstDesignTemplate:!1,showTemplateSelection:!1,printTypes:[],colors:[],options:[],preview3D:null,previewModel:null,pricings:[],composerPricings:[],scenes:[],attributeGroups:[],templateGroups:[],attributeSteps:[],attributes:[],attributeSelectionColors:[],backgroundColorRules:null,areaBackgroundRules:null,quoteRule:null,quantityRule:null,hasAdditionalFeeOnImagesProvider:!1,isShowSecondScreenEnabled:!1,environment:1},idAttribute:"modelID",initialize:function(){var t=this;this.get("printTypes").url=function(){return t.url()+"/printTypes"},this.get("colors").url=function(){return t.url()+"/colors"},this.get("options").url=function(){return t.url()+"/options"},this.get("printTypes").parentModel=this,this.get("colors").parentModel=this,this.get("options").parentModel=this,this.get("preview3D")&&(this.get("preview3D").parentModel=this),this.get("previewModel")&&(this.get("previewModel").parentModel=this),this.get("scenes").parentModel=this,this.get("attributeGroups").parentModel=this,this.get("templateGroups").parentModel=this,this.get("attributeSteps").parentModel=this,this.get("attributes").parentModel=this,this.get("attributeSelectionColors").parentModel=this},relations:[{type:Backbone.One,key:"preview3D",relatedModel:MPlaza.Preview3D},{type:Backbone.One,key:"previewModel",relatedModel:MPlaza.PreviewModel},{type:Backbone.One,key:"quantityRule",relatedModel:MPlaza.QuantityRule},{type:Backbone.Many,key:"printTypes",collectionType:MPlaza.PrintTypes},{type:Backbone.Many,key:"options",collectionType:MPlaza.ModelOptions},{type:Backbone.Many,key:"colors",collectionType:MPlaza.Colors},{type:Backbone.Many,key:"pricings",collectionType:MPlaza.Pricings},{type:Backbone.Many,key:"composerPricings",collectionType:MPlaza.ComposerPricings},{type:Backbone.Many,key:"scenes",collectionType:MPlaza.ModelScenes},{type:Backbone.Many,key:"attributeGroups",collectionType:MPlaza.AttributeGroups},{type:Backbone.Many,key:"templateGroups",collectionType:MPlaza.TemplateGroups},{type:Backbone.Many,key:"attributeSteps",collectionType:MPlaza.AttributeSteps},{type:Backbone.Many,key:"attributes",collectionType:MPlaza.Attributes},{type:Backbone.Many,key:"attributeSelectionColors",collectionType:MPlaza.AttributeSelectionColors}],url:function(){var t=Zakeke.config.baseApiUrl+"models";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},getModelID:function(){return this.get("modelID")},toString:function(){},getPreview3D:function(){return this.get("preview3D")},getOrCreatePreview3D:function(){var t=this.getPreview3D();return t||(t=new MPlaza.Preview3D,this.set("preview3D",t)),t},getModelPriceDeltaPerc:function(t){var e=this.get("printTypes");if(e){var i=e.getPrintType(t);if(i)return i.get("priceDeltaPerc")}return 0},getModelPriceDeltaValue:function(t){var e=this.get("printTypes");if(e){var i=e.getPrintType(t);if(i)return i.get("priceDeltaValue")}return 0},getModelPrice:function(t){var e=this.get("printTypes");if(e){var i=e.getPrintType(t);if(i)return i.get("price")}return 0},getModelTextBasePrice:function(t){var e=this.get("printTypes");if(e){var i=e.getPrintType(t);if(i)return i.get("textBasePrice")}return 0},getModelImageBasePrice:function(t){var e=this.get("printTypes");if(e){var i=e.getPrintType(t);if(i)return i.get("imageBasePrice")}return 0},getPrintType:function(t){var e=this.get("printTypes");return e?e.getPrintType(t):null},getDefaultSceneID:function(){for(var t=0;t<this.get("scenes").length;t++){var e=this.get("scenes").at(t);if(e.get("isDefault"))return e.get("sceneID")}return null},getAttributesByGroupID:function(t){for(var e=[],i=0;i<this.get("attributes").length;i++){var n=this.get("attributes").at(i);n.get("groupID")==t&&e.push(n)}return e},getAttributesWithoutGroup:function(){for(var t=[],e=0;e<this.get("attributes").length;e++){var i=this.get("attributes").at(e);i.get("groupID")<=0&&t.push(i)}return t},getTemplateGroupsWithoutGroup:function(){for(var t=[],e=0;e<this.get("templateGroups").length;e++){var i=this.get("templateGroups").at(e);i.get("groupID")<=0&&t.push(i)}return t},getAttribute:function(t){return this.get("attributes").getAttribute(t)},getAttributeByGuid:function(t){return this.get("attributes").getAttributeByGuid(t)},getOption:function(t){for(var e=0;e<this.get("attributes").length;e++){var i=this.get("attributes").at(e).get("options").findWhere({optionID:t});if(i)return i}return null},getOptionByGuid:function(t){for(var e=0;e<this.get("attributes").length;e++){var i=this.get("attributes").at(e).get("options").findWhere({optionGuid:t});if(i)return i}return null},getComposerPricing:function(t){for(var e=0;e<this.get("composerPricings").length;e++){var i=this.get("composerPricings").at(e);if(i.get("pricingID")==t)return i}return null},getModelSide:function(t,e){for(var i=0;i<this.get("colors").length;i++){var n=this.get("colors").at(i);if(n.get("colorID")==t)for(var r=0;r<n.get("sides").length;r++){var a=n.get("sides").at(r);if(a.get("sideID")==e)return a}}return null},getAttributeSelectionColor:function(t){return this.get("attributeSelectionColors").getAttributeSelectionColor(t)},setShowTemplateSelection(t){this.set("showTemplateSelection",t)},sync:MPlaza.syncCloudflare}),MPlaza.Models=Backbone.Collection.extend({model:MPlaza.Model,url:function(){return Zakeke.config.baseApiUrl+"models"},getModel:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("modelID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.ColorMapping=Backbone.AssociatedModel.extend({defaults:{src:"",dest:""},initialize:function(){},copyAttributes:function(t){this.set("src",t.get("src")),this.set("dest",t.get("dest"))},toJSON:function(){return{src:this.get("src"),dest:this.get("dest")}},sync:MPlaza.syncCloudflare}),MPlaza.ColorMappings=Backbone.Collection.extend({model:MPlaza.ColorMapping,toJSON:function(){var t=[];return this.forEach(e=>t.push(e.toJSON())),t},sync:MPlaza.syncCloudflare}),MPlaza.TextArtConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},toJSON:function(){return{angleValue:this.get("angleValue"),curveValue:this.get("curveValue"),intensT:this.get("intensT"),intensB:this.get("intensB"),isTriangle:this.get("isTriangle"),isBridge:this.get("isBridge"),isTop:this.get("isTop"),isBottom:this.get("isBottom"),isMiddle:this.get("isMiddle")}},copyAttributes:function(t){this.set("angleValue",t.get("angleValue")),this.set("curveValue",t.get("curveValue")),this.set("intensT",t.get("intensT")),this.set("intensB",t.get("intensB")),this.set("isTriangle",t.get("isTriangle")),this.set("isBridge",t.get("isBridge")),this.set("isTop",t.get("isTop")),this.set("isBottom",t.get("isBottom")),this.set("isMiddle",t.get("isMiddle"))},sync:MPlaza.syncCloudflare}),MPlaza.TextArtControl=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){},toJSON:function(){return{property:this.get("property"),labelKey:this.get("labelKey"),type:this.get("type"),min:this.get("min"),max:this.get("max"),step:this.get("step")}},copyAttributes:function(t){this.set("property",t.get("property")),this.set("labelKey",t.get("labelKey")),this.set("type",t.get("type")),this.set("min",t.get("min")),this.set("max",t.get("max")),this.set("step",t.get("step"))},sync:MPlaza.syncCloudflare}),MPlaza.TextArtControls=Backbone.Collection.extend({model:MPlaza.TextArtControl,sync:MPlaza.syncCloudflare}),MPlaza.TextArtType=Backbone.AssociatedModel.extend({defaults:{name:"",imageUrl:"",config:null,controls:[]},idAttribute:"textArtTypeID",initialize:function(){this.get("controls").parentModel=this,this.get("config")&&(this.get("config").parentModel=this)},relations:[{type:Backbone.One,key:"config",relatedModel:MPlaza.TextArtConfig},{type:Backbone.Many,key:"controls",collectionType:MPlaza.TextArtControls}],url:function(){var t=Zakeke.config.baseApiUrl+"textart/types";return void 0!==this.id&&null!==this.id&&this.id>0&&(t=t+"/"+this.id),t},getTextArtTypeID:function(){return this.get("textArtTypeID")},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.TextArtTypes=Backbone.Collection.extend({model:MPlaza.TextArtType,url:function(){return Zakeke.config.baseApiUrl+"textart/types"},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemColor=Backbone.AssociatedModel.extend({defaults:{imageID:-1,colorID:-1,colorCode:""},idAttribute:"key",initialize:function(){},getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getDesignItemID:function(){return this.collection&&this.collection.getDesignItemID?this.collection.getDesignItemID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemColors=Backbone.Collection.extend({model:MPlaza.DesignItemColor,getDesignItemColor:function(t,e){for(var i=0;i<this.length;i++){var n=this.at(i);if(n.get("imageID")==t&&n.get("colorID")==e)return n}return null},getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},getDesignItemID:function(){return this.parentModel&&this.parentModel.getDesignItemID?this.parentModel.getDesignItemID():null},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemArea=Backbone.AssociatedModel.extend({defaults:{modelID:-1,colorID:-1,sideID:-1,areaID:-1},idAttribute:"id",initialize:function(){},getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getDesignItemID:function(){return this.collection&&this.collection.getDesignItemID?this.collection.getDesignItemID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemAreas=Backbone.Collection.extend({model:MPlaza.DesignItemArea,getDesignItemArea:function(t,e,i,n){for(var r=0;r<this.length;r++){var a=this.at(r);if(a.get("modelID")==t&&a.get("colorID")==e&&a.get("sideID")==i&&a.get("areaID")==n)return a}return null},getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},getDesignItemID:function(){return this.parentModel&&this.parentModel.getDesignItemID?this.parentModel.getDesignItemID():null},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemConstraints=Backbone.AssociatedModel.extend({defaults:{itemID:-1,canMove:!0,canMoveX:!0,canMoveY:!0,canRotate:!0,canResize:!0,canDelete:!0,canEdit:!0,keepNrChars:!1,minNrChars:0,maxNrChars:0,paddingTypeID:MPlaza.PaddingType.Start,paddingString:"",canChangeFontFamily:!0,canChangeFontSize:!0,canChangeFontColor:!0,canChangeFontWeight:!0,canChangeFontItalic:!0,canChangeTextPathMode:!0,canChangeJustification:!0,canTransform:!0,canChangeSvgColors:!0,isAlwaysOnTop:!1,isPrintable:!0,keepInPreview:!0,mandatoryToEdit:!1,canSyncContent:!0,canSyncAlignment:!0,canSyncFontFamily:!0,canSyncFontStyle:!0,canSyncFontColor:!0,canSyncCurved:!0,canSyncTransforms:!1,canResizeTextBox:!0,canChangeTextBoxMode:!0,toUppercase:!1,canChangeTextBoxMode:!0,toUppercase:!1,canAddMask:!0,canReplaceMask:!0,canEditMask:!0,canDeleteMask:!0,canEditMaskedImage:!0,canChangeMaskStrokeColor:!0,canChangeMaskStrokeWidth:!0,canFillShape:!0,canReplaceShapeFilling:!0,canEditShapeFilling:!0,canDeleteShapeFilling:!0,canEditFilledShape:!0,canChangeShapeStrokeColor:!0,canChangeShapeStrokeWidth:!0,canChangeShapeFillColor:!0,canChangeLetterSpacing:!1,minLetterSpacing:null,maxLetterSpacing:null,canChangeLineSpacing:!1,minLineSpacing:null,maxLineSpacing:null,canChangeAdaptText:!0,canWrapTextOnAdaptText:!0,minFontSize:null,maxFontSize:null,canChangeVerticalAlignment:!0,canChangeShadowColor:!0,canChangeShadowBlur:!0,canChangeShadowDistance:!0,canChangeShadowAngle:!0,minShadowBlur:null,maxShadowBlur:null,minShadowDistance:null,maxShadowDistance:null,minShadowAngle:null,maxShadowAngle:null},idAttribute:"itemID",initialize:function(){},url:function(){return""},getDesignID:function(){return this.parentModel?this.parentModel.getDesignID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){},copyAttributes:function(t){this.set("canMove",t.get("canMove")),this.set("canRotate",t.get("canRotate")),this.set("canResize",t.get("canResize")),this.set("canDelete",t.get("canDelete")),this.set("canEdit",t.get("canEdit")),this.set("keepNrChars",t.get("keepNrChars")),this.set("minNrChars",t.get("minNrChars")),this.set("maxNrChars",t.get("maxNrChars")),this.set("paddingTypeID",t.get("paddingTypeID")),this.set("paddingString",t.get("paddingString")),this.set("canChangeFontFamily",t.get("canChangeFontFamily")),this.set("canChangeFontSize",t.get("canChangeFontSize")),this.set("canChangeFontColor",t.get("canChangeFontColor")),this.set("canChangeFontWeight",t.get("canChangeFontWeight")),this.set("canChangeTextPathMode",t.get("canChangeTextPathMode")),this.set("canChangeJustification",t.get("canChangeJustification")),this.set("canTransform",t.get("canTransform")),this.set("canChangeSvgColors",t.get("canChangeSvgColors")),this.set("isAlwaysOnTop",t.get("isAlwaysOnTop")),this.set("isPrintable",t.get("isPrintable")),this.set("keepInPreview",t.get("keepInPreview")),this.set("mandatoryToEdit",t.get("mandatoryToEdit")),this.set("canSyncContent",t.get("canSyncContent")),this.set("canSyncAlignment",t.get("canSyncAlignment")),this.set("canSyncFontFamily",t.get("canSyncFontFamily")),this.set("canSyncFontStyle",t.get("canSyncFontStyle")),this.set("canSyncFontColor",t.get("canSyncFontColor")),this.set("canSyncCurved",t.get("canSyncCurved")),this.set("canSyncTransforms",t.get("canSyncTransforms")),this.set("canResizeTextBox",t.get("canResizeTextBox")),this.set("canChangeTextBoxMode",t.get("canChangeTextBoxMode")),this.set("toUppercase",t.get("toUppercase")),this.set("canAddMask",t.get("canAddMask")),this.set("canReplaceMask",t.get("canReplaceMask")),this.set("canEditMask",t.get("canEditMask")),this.set("canDeleteMask",t.get("canDeleteMask")),this.set("canEditMaskedImage",t.get("canEditMaskedImage")),this.set("canChangeMaskStrokeColor",t.get("canChangeMaskStrokeColor")),this.set("canChangeMaskStrokeWidth",t.get("canChangeMaskStrokeWidth")),this.set("canFillShape",t.get("canFillShape")),this.set("canReplaceShapeFilling",t.get("canReplaceShapeFilling")),this.set("canEditShapeFilling",t.get("canEditShapeFilling")),this.set("canDeleteShapeFilling",t.get("canDeleteShapeFilling")),this.set("canEditFilledShape",t.get("canEditFilledShape")),this.set("canChangeShapeStrokeColor",t.get("canChangeShapeStrokeColor")),this.set("canChangeShapeStrokeWidth",t.get("canChangeShapeStrokeWidth")),this.set("canChangeShapeFillColor",t.get("canChangeShapeFillColor")),this.set("canChangeLetterSpacing",t.get("canChangeLetterSpacing")),this.set("minLetterSpacing",t.get("minLetterSpacing")),this.set("maxLetterSpacing",t.get("maxLetterSpacing")),this.set("canChangeLineSpacing",t.get("canChangeLineSpacing")),this.set("minLineSpacing",t.get("minLineSpacing")),this.set("canChangeAdaptText",t.get("canChangeAdaptText")),this.set("canWrapTextOnAdaptText",t.get("canWrapTextOnAdaptText")),this.set("minFontSize",t.get("minFontSize")),this.set("maxFontSize",t.get("maxFontSize")),this.set("canChangeVerticalAlignment",t.get("canChangeVerticalAlignment")),this.set("canChangeShadowColor",t.get("canChangeShadowColor")),this.set("canChangeShadowBlur",t.get("canChangeShadowBlur")),this.set("canChangeShadowDistance",t.get("canChangeShadowDistance")),this.set("canChangeShadowAngle",t.get("canChangeShadowAngle")),this.set("minShadowBlur",t.get("minShadowBlur")),this.set("maxShadowBlur",t.get("maxShadowBlur")),this.set("minShadowDistance",t.get("minShadowDistance")),this.set("maxShadowDistance",t.get("maxShadowDistance")),this.set("minShadowAngle",t.get("minShadowAngle")),this.set("maxShadowAngle",t.get("maxShadowAngle"))},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemTextArt=Backbone.AssociatedModel.extend({defaults:{itemID:-1,text:"",fontFamilyID:-1,fontFaceID:-1,textArtTypeID:-1,config:null},idAttribute:"itemID",initialize:function(){this.get("config")&&(this.get("config").parentModel=this)},relations:[{type:Backbone.One,key:"config",relatedModel:MPlaza.TextArtConfig}],url:function(){return""},getDesignID:function(){return this.parentModel?this.parentModel.getDesignID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){},copyAttributes:function(t){if(this.set("text",t.get("text")),this.set("fontFamilyID",t.get("fontFamilyID")),this.set("fontFaceID",t.get("fontFaceID")),this.set("textArtTypeID",t.get("textArtTypeID")),this.unset("config"),t.get("config")){var e=t.get("config"),i=new MPlaza.TextArtConfig;i.set("itemID",this.get("itemID")),i.copyAttributes(e),this.set("config",i)}},sync:MPlaza.syncCloudflare}),MPlaza.DesignItemShape=Backbone.AssociatedModel.extend({defaults:{itemID:-1,shapeID:-1,isMask:!0},idAttribute:"itemID",initialize:function(){},relations:[],url:function(){return""},getDesignID:function(){return this.parentModel?this.parentModel.getDesignID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){},copyAttributes:function(t){this.set("shapeID",t.get("shapeID")),this.set("isMask",t.get("isMask"))},sync:MPlaza.syncCloudflare}),MPlaza.DesignItem=Backbone.AssociatedModel.extend({defaults:{name:"",index:0,json:"",svg:"",imageID:-1,imageType:"",imageFormat:"",imageWidth:0,imageHeight:0,imageDpiX:0,imageDpiY:0,imageFileSize:0,imageCustomerID:-1,imageVisitorID:-1,imagePrice:0,providerImageID:null,applyImagePriceForQuantity:null,imageIsMulticolor:!1,imageContainsRaster:!1,imagePreferredWidth:null,imagePreferredHeight:null,syncGuid:null,isChanged:!0,areas:[],colors:[],constraints:null,textArt:null,shape:null,colorMappings:[]},resetColors:function(){this.set("colors",[])},copyAttributes:function(t){if(this.set("index",t.get("index")),this.set("name",t.get("name")),this.set("json",t.get("json")),this.set("svg",t.get("svg")),this.set("imageID",t.get("imageID")),this.set("imageType",t.get("imageType")),this.set("imageFormat",t.get("imageFormat")),this.set("imageWidth",t.get("imageWidth")),this.set("imageHeight",t.get("imageHeight")),this.set("imageDpiX",t.get("imageDpiX")),this.set("imageDpiY",t.get("imageDpiY")),this.set("imageFileSize",t.get("imageFileSize")),this.set("imageCustomerID",t.get("imageCustomerID")),this.set("imageVisitorID",t.get("imageVisitorID")),this.set("imagePrice",t.get("imagePrice")),this.set("applyImagePriceForQuantity",t.get("applyImagePriceForQuantity")),this.set("providerImageID",t.get("providerImageID")),this.set("imageIsMulticolor",t.get("imageIsMulticolor")),this.set("imageContainsRaster",t.get("imageContainsRaster")),this.set("imagePreferredWidth",t.get("imagePreferredWidth")),this.set("imagePreferredHeight",t.get("imagePreferredHeight")),this.set("isChanged",t.get("isChanged")),this.set("itemColors",[]),t.get("itemColors"))for(var e=0;e<t.get("itemColors").length;e++)this.get("itemColors").push(t.get("itemColors")[e]);if(this.unset("colorMappings"),this.set("colorMappings",new MPlaza.ColorMappings),t.get("colorMappings"))for(e=0;e<t.get("colorMappings").length;e++){var i=new MPlaza.ColorMapping;i.copyAttributes(t.get("colorMappings").at(e)),this.get("colorMappings").add(i)}this.set("syncGuid",t.get("syncGuid"));for(e=0;e<t.get("colors").length;e++){var n=t.get("colors").at(e),r=this.get("colors").find(t=>t.get("colorID")==n.get("colorID"));r||(r=new MPlaza.DesignItemColor,this.get("colors").add(r)),r.set("imageID",n.get("imageID")),r.set("colorID",n.get("colorID")),r.set("colorCode",n.get("colorCode"))}if(this.unset("constraints"),t.get("constraints")){var a=t.get("constraints"),s=new MPlaza.DesignItemConstraints;s.set("itemID",this.get("itemID")),s.copyAttributes(a),this.set("constraints",s)}if(this.unset("textArt"),t.get("textArt")){var o=t.get("textArt"),l=new MPlaza.DesignItemTextArt;l.set("itemID",this.get("itemID")),l.copyAttributes(o),this.set("textArt",l)}if(this.unset("shape"),t.get("shape")){var h=t.get("shape"),c=new MPlaza.DesignItemShape;c.set("itemID",this.get("itemID")),c.copyAttributes(h),this.set("shape",c)}},copyConstraints:function(t){if(this.unset("constraints"),t){var e=new MPlaza.DesignItemConstraints;e.set("itemID",this.get("itemID")),e.copyAttributes(t),this.set("constraints",e)}},copyTextArt:function(t){if(this.unset("textArt"),source.get("textArt")){var e=new MPlaza.DesignItemTextArt;e.set("itemID",this.get("itemID")),e.copyAttributes(t),this.set("textArt",e)}},copyShape:function(t){if(this.unset("shape"),source.get("shape")){var e=new MPlaza.DesignItemShape;e.set("itemID",this.get("itemID")),e.copyAttributes(t),this.set("shape",e)}},idAttribute:"itemGuid",initialize:function(){this.get("areas").parentModel=this,this.get("colors").parentModel=this,this.get("constraints")&&(this.get("constraints").parentModel=this),this.get("textArt")&&(this.get("textArt").parentModel=this),this.get("itemGuid")||this.set("itemGuid",MPlaza.generateUUID()),this.get("itemColors")||this.set("itemColors",[])},relations:[{type:Backbone.Many,key:"areas",collectionType:MPlaza.DesignItemAreas},{type:Backbone.Many,key:"colors",collectionType:MPlaza.DesignItemColors},{type:Backbone.One,key:"constraints",relatedModel:MPlaza.DesignItemConstraints},{type:Backbone.One,key:"textArt",relatedModel:MPlaza.DesignItemTextArt},{type:Backbone.One,key:"shape",relatedModel:MPlaza.DesignItemShape},{type:Backbone.Many,key:"colorMappings",collectionType:MPlaza.ColorMappings}],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getDesignItemID:function(){return this.get("itemID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},findArea:function(t,e,i,n){var r=this.get("areas");return r?r.getDesignItemArea(t,e,i,n):null},findColor:function(t,e){var i=this.get("colors");return i?i.getDesignItemColor(t,e):null},toString:function(){},isOnSide:function(t){if(!(t&&t instanceof MPlaza.Side))return!1;for(var e=this.get("areas"),i=0;i<e.length;i++){var n=e.at(i);if(n.get("areaGuid")&&(!n.get("areaID")||n.get("areaID")<=0)){for(var r=0;r<t.get("areas").length;r++)if(t.get("areas").at(r).get("guid")==n.get("areaGuid"))return!0}else if(n.get("sideID")==t.getSideID())return!0}return!1},inOnArea:function(t){return!!(t||t instanceof MPlaza.Area)&&null!=this.findArea(t.getModelID(),t.getColorID(),t.getSideID(),t.getAreaID())},updateAreas:function(t){for(;this.get("areas").length>0;)this.get("areas").pop();for(var e=0;e<t.length;e++)this.addArea(t[e])},addArea:function(t){if(t&&t instanceof MPlaza.Area&&!this.findArea(t.getModelID(),t.getColorID(),t.getSideID(),t.getAreaID())){var e=new MPlaza.DesignItemArea;e.set("modelID",t.getModelID()),e.set("colorID",t.getColorID()),e.set("sideID",t.getSideID()),e.set("areaID",t.getAreaID()),e.set("areaGuid",t.get("guid")),this.get("areas").add(e)}},changeColor:function(t,e,i){if(t===this.get("imageID")){var n=this.findColor(t,e);n||((n=new MPlaza.DesignItemColor).set("imageID",t),n.set("colorID",e),this.get("colors").add(n)),n.set("colorCode",i)}},setConstraintsFromSource:function(t){this.unset("constraints");var e=new MPlaza.DesignItemConstraints;e.itemID=this.get("itemID"),e.copyAttributes(t),this.set("constraints",e)},setTextArtFromSource:function(t){this.unset("textArt");var e=new MPlaza.DesignItemTextArt;e.itemID=this.get("itemID"),e.copyAttributes(t),this.set("textArt",e)},isTextArt:function(){return null!==this.get("textArt")&&void 0!==this.get("textArt")},sync:MPlaza.syncCloudflare}),MPlaza.DesignItems=Backbone.Collection.extend({model:MPlaza.DesignItem,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},getDesignItemByGuid:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("itemGuid")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignTemplateCategory=Backbone.AssociatedModel.extend({defaults:{categoryID:-1,name:""},initialize:function(){},relations:[],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignTemplateCategories=Backbone.Collection.extend({model:MPlaza.DesignTemplateCategory,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},findCategory:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("categoryID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignTemplateColor=Backbone.AssociatedModel.extend({defaults:{colorID:-1,name:"",isDefault:!1},initialize:function(){},relations:[],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignTemplateColors=Backbone.Collection.extend({model:MPlaza.DesignTemplateColor,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},findColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("colorID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignArea=Backbone.AssociatedModel.extend({defaults:{modelID:-1,colorID:-1,sideID:-1,areaID:-1,printTypeID:-1},initialize:function(){},relations:[],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignAreas=Backbone.Collection.extend({model:MPlaza.DesignArea,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},findArea:function(t,e,i,n){for(var r=0;r<this.length;r++){var a=this.at(r);if(a.get("modelID")==t&&a.get("colorID")==e&&a.get("sideID")==i&&a.get("areaID")==n)return a}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignAreaGrid=Backbone.AssociatedModel.extend({defaults:{modelID:-1,colorID:-1,sideID:-1,areaID:-1,gridID:-1},initialize:function(){},relations:[],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignAreasGrids=Backbone.Collection.extend({model:MPlaza.DesignAreaGrid,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},findAreaGrid:function(t,e,i,n,r){for(var a=0;a<this.length;a++){var s=this.at(a);if(s.get("modelID")==t&&s.get("colorID")==e&&s.get("sideID")==i&&s.get("areaID")==n&&s.get("gridID")==r)return s}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignSidePrintType=Backbone.AssociatedModel.extend({defaults:{modelID:-1,colorID:-1,sideID:-1,printTypeID:-1},initialize:function(){},relations:[],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignSidesPrintTypes=Backbone.Collection.extend({model:MPlaza.DesignSidePrintType,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},findSidePrintType:function(t,e,i,n){for(var r=0;r<this.length;r++){var a=this.at(r);if(a.get("modelID")==t&&a.get("colorID")==e&&a.get("sideID")==i&&a.get("printTypeID")==n)return a}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignSide=Backbone.AssociatedModel.extend({defaults:{modelID:-1,colorID:-1,sideID:-1,fillColor:"",canAddText:!0,canAddImage:!0,canAddShape:!0,canMaskImages:!0,maxNrTexts:null,maxNrImages:null,maxNrShapes:null,canChangeSvgColors:!0,uploadRestrictions:null,disableSellerImages:!1},initialize:function(){},relations:[],getDesignID:function(){return this.collection&&this.collection.getDesignID?this.collection.getDesignID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignSides=Backbone.Collection.extend({model:MPlaza.DesignSide,getDesignID:function(){return this.parentModel&&this.parentModel.getDesignID?this.parentModel.getDesignID():null},findSide:function(t,e,i){for(var n=0;n<this.length;n++){var r=this.at(n);if(r.get("modelID")==t&&r.get("colorID")==e&&r.get("sideID")==i)return r}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignClientPreview=Backbone.AssociatedModel.extend({defaults:{sideID:-1,fileObjectID:-1,url:""},initialize:function(){},relations:[],sync:MPlaza.syncCloudflare}),MPlaza.DesignClientPreviews=Backbone.Collection.extend({model:MPlaza.DesignClientPreview,sync:MPlaza.syncCloudflare}),MPlaza.TextDesignElement=Backbone.AssociatedModel.extend({defaults:{},copyAttributes:function(t){var e=function(t,e){this.unset(e),void 0!==t.get(e)&&null!=t.get(e)&&this.set(e,t.get(e))};e("content"),e("strokeColor"),e("strokeWidth"),e("fillColor"),e("fontFamily"),e("fontSize"),e("fontWeight"),e("fontStyle"),e("fontStretch"),e("justification"),e("adaptText"),e("letterSpacing"),e("lineSpacing"),e("verticalAlignment"),e("shadowColor"),e("shadowBlur"),e("shadowBlur"),e("shadowBlur")}}),MPlaza.TextArtDesignElement=Backbone.AssociatedModel.extend({defaults:{},copyAttributes:function(t){!function(t,e){this.unset(e),void 0!==t.get(e)&&null!=t.get(e)&&this.set(e,t.get(e))}("content")}}),MPlaza.ImageDesignElement=Backbone.AssociatedModel.extend({defaults:{},copyAttributes:function(t){!function(t,e){this.unset(e),void 0!==t.get(e)&&null!=t.get(e)&&this.set(e,t.get(e))}("imageID")}}),MPlaza.ShapeDesignElement=Backbone.AssociatedModel.extend({defaults:{},copyAttributes:function(t){!function(t,e){this.unset(e),void 0!==t.get(e)&&null!=t.get(e)&&this.set(e,t.get(e))}("shapeID")}}),MPlaza.DesignElement=Backbone.AssociatedModel.extend({defaults:{tag:"",text:null,textArt:null,image:null,shape:null},initialize:function(){},relations:[{type:Backbone.One,key:"text",relatedModel:MPlaza.TextDesignElement},{type:Backbone.One,key:"textArt",relatedModel:MPlaza.TextArtDesignElement},{type:Backbone.One,key:"image",relatedModel:MPlaza.ImageDesignElement},{type:Backbone.One,key:"shape",relatedModel:MPlaza.ShapeDesignElement}],copyAttributes:function(t){if(function(t,e){this.unset(e),void 0!==t.get(e)&&null!=t.get(e)&&this.set(e,t.get(e))}("tag"),this.unset("text"),t.get("text")){var e=new MPlaza.TextDesignElement;e.copyAttributes(t.get("text")),this.set("text",e)}if(this.unset("textArt"),t.get("textArt")){var i=new MPlaza.TextArtDesignElement;i.copyAttributes(t.get("textArt")),this.set("textArt",i)}if(this.unset("image"),t.get("image")){var n=new MPlaza.ImageDesignElement;n.copyAttributes(t.get("image")),this.set("image",n)}if(this.unset("shape"),t.get("shape")){var r=new MPlaza.ShapeDesignElement;r.copyAttributes(t.get("shape")),this.set("shape",r)}}}),MPlaza.DesignElements=Backbone.Collection.extend({model:MPlaza.DesignElement}),MPlaza.DesignElementsDesc=Backbone.AssociatedModel.extend({defaults:{elements:[]},idAttribute:"id",initialize:function(){this.get("id")||this.set("id",MPlaza.generateUUID())},relations:[{type:Backbone.Many,key:"elements",collectionType:MPlaza.DesignElements}],copyAttributes:function(t){if(this.unset("elements"),null!==t.get("elements")&&void 0!==t.get("elements")){for(var e=[],i=0;i<t.get("elements").length;i++){var n=t.get("elements").at(i),r=new MPlaza.DesignElement;r.copyAttributes(n),e.push(r)}this.set("elements",e)}}}),MPlaza.DesignElementsDescs=Backbone.Collection.extend({model:MPlaza.DesignElementsDesc,getDescById:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.id===t)return i}return null}}),MPlaza.DesignOptionsItem=Backbone.AssociatedModel.extend({defaults:{colorID:-1,sideID:null,width:null,height:null,columns:1,rows:1},idAttribute:"optionId",initialize:function(){},relations:[]}),MPlaza.DesignOptions=Backbone.Collection.extend({model:MPlaza.DesignOptionsItem}),MPlaza.Design=Backbone.AssociatedModel.extend({defaults:{modelID:-1,modelName:"",pricingModelID:-1,modelPriceDeltaPerc:0,modelPriceDeltaValue:0,modelPrice:0,modelTextBasePrice:0,modelImageBasePrice:0,printTypeID:-1,description:"",info:"",isTemplate:!1,isDraft:!1,name:"",templateDesignID:-1,customerID:-1,visitorID:-1,sells:0,finalPrice:0,tempPreviewImageData:null,tempPreviewImageUrl:"",canAddText:!0,canAddImage:!0,canAddShape:!0,canMaskImages:!0,maxNrTexts:null,maxNrImages:null,maxNrShapes:null,filterCode:"",canChangeSvgColors:!0,uploadRestrictions:null,disableSellerImages:!1,hasSyncEnabled:!1,sides:[],sidesPrintTypes:[],areasGrids:[],areas:[],designItems:[],categories:[],colors:[],tags:[],clientPreviews:[],elementsDescs:[],options:[]},idAttribute:"docID",initialize:function(){var t=this;this.get("options").parentModel=this,this.get("sides").parentModel=this,this.get("sidesPrintTypes").parentModel=this,this.get("areasGrids")||this.set("areasGrids",new MPlaza.DesignAreasGrids),this.get("areasGrids").parentModel=this,this.get("areas").parentModel=this,this.get("designItems").parentModel=this,this.get("colors")||this.set("colors",new MPlaza.DesignTemplateColors),this.get("categories").parentModel=this,this.get("colors").parentModel=this,this.get("options").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("designItems").on("add",function(){t._fireEvent("change")}),this.get("designItems").on("remove",function(){t._fireEvent("change")}),this.get("designItems").on("change",function(){t._fireEvent("change")}),this.get("categories").on("change",function(){t._fireEvent("change")}),this.get("colors").on("change",function(){t._fireEvent("change")}),this.get("clientPreviews").on("change",function(){t._fireEvent("change")}),this.get("sidesPrintTypes").on("change",function(){t._fireEvent("change")}),this.get("options").on("change",function(){t._fireEvent("change")})},_eventListeners:{change:[]},_fireEvent:function(t,e){if(this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&_.isArray(this._eventListeners[t]))for(var i=this._eventListeners[t],n=0;n<i.length;++n)i[n](e)},trigger:function(t){this._fireEvent(t)},addEventListener:function(t,e){this._eventListeners&&_.isObject(this._eventListeners)&&(_.has(this._eventListeners,t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},isEmpty:function(){return 0==this.get("designItems").length},relations:[{type:Backbone.Many,key:"sides",collectionType:MPlaza.DesignSides},{type:Backbone.Many,key:"sidesPrintTypes",collectionType:MPlaza.DesignSidesPrintTypes},{type:Backbone.Many,key:"areasGrids",collectionType:MPlaza.DesignAreasGrids},{type:Backbone.Many,key:"areas",collectionType:MPlaza.DesignAreas},{type:Backbone.Many,key:"designItems",collectionType:MPlaza.DesignItems},{type:Backbone.Many,key:"categories",collectionType:MPlaza.DesignTemplateCategories},{type:Backbone.Many,key:"colors",collectionType:MPlaza.DesignTemplateColors},{type:Backbone.Many,key:"clientPreviews",collectionType:MPlaza.DesignClientPreviews},{type:Backbone.Many,key:"elementsDescs",collectionType:MPlaza.DesignElementsDescs},{type:Backbone.Many,key:"options",collectionType:MPlaza.DesignOptions}],url:function(){var t=Zakeke.config.baseApiUrl+"proxydesigns";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),!0===this.attributes.isDraft&&(t+="/?draft=true"),t},getDesignID:function(){return this.get("designID")},toString:function(){},getDesignItems:function(){return this.get("designItems")},getSideDesignItems:function(t){for(var e=[],i=0;i<this.get("designItems").length;i++){var n=this.get("designItems").at(i);n.isOnSide(t)&&e.push(n)}return e.sort(function(t,e){return t.get("index")-e.get("index")}),e},getAreaDesignItems:function(t){var e=[];if(t&&t instanceof MPlaza.Area)for(var i=0;i<this.get("designItems").length;i++){var n=this.get("designItems").at(i);n.inOnArea(t)&&e.push(n)}return e.sort(function(t,e){return t.get("index")-e.get("index")}),e},getDesignItemsByTag:function(t){var e=[];for(let i=0;i<this.get("designItems").length;i++){const n=this.get("designItems").at(i);null!==n.get("tag")&&void 0!==n.get("tag")&&n.get("tag")===t&&e.push(n)}return e.sort(function(t,e){return t.get("index")-e.get("index")}),e},setModel:function(t){if(t&&t instanceof MPlaza.Model){this.set("modelID",t.get("modelID")),this.set("modelName",t.get("name")),this.set("pricingModelID",t.get("pricingModelID"));var e=this.get("printTypeID");this.set("modelPriceDeltaPerc",t.getModelPriceDeltaPerc(e)),this.set("modelPriceDeltaValue",t.getModelPriceDeltaValue(e)),this.set("modelPrice",t.getModelPrice(e)),this.set("modelTextBasePrice",t.getModelTextBasePrice(e)),this.set("modelImageBasePrice",t.getModelImageBasePrice(e))}},setPrintType:function(t){t&&t instanceof MPlaza.PrintType&&(this.set("printTypeID",t.get("printTypeID")||t.tempID),this.set("modelPriceDeltaPerc",t.get("priceDeltaPerc")),this.set("modelPriceDeltaValue",t.get("priceDeltaValue")),this.set("modelPrice",t.get("price")),this.set("modelTextBasePrice",t.get("textBasePrice")),this.set("modelImageBasePrice",t.get("imageBasePrice")))},cloneWithDifferentModel:function(t){var e=new MPlaza.Design;if(!(t&&t instanceof MPlaza.Model))return e;if(t.get("modelID")==this.get("modelID"))return this.clone();if(0==t.get("colors").length)return e;e.setModel(t);var i=t.get("printTypes").getPrintType(this.get("printTypeID"));!i&&t.get("printTypes").length>0&&(i=t.get("printTypes").at(0)),i?e.set("printTypeID",i.get("printTypeID")):e.set("printTypeID",-1);var n=t.get("colors").at(0);if(n)for(var r=0;r<this.get("designItems").length;r++){var a=this.get("designItems").at(r),s=new MPlaza.DesignItem;s.copyAttributes(a);for(var o=0;o<a.get("areas").length;o++){var l=a.get("areas").at(o),h=n.get("sides").getSide(l.get("sideID"));if(h){var c=h.get("areas").getAreaByID(l.get("areaID"));c&&s.addArea(c)}}s.get("areas").length>0&&e.get("designItems").add(s)}for(var u=0;u<this.get("categories").length;u++){var d=this.get("categories").at(u),f=new MPlaza.DesignTemplateCategory;f.set("categoryID",d.get("categoryID")),f.set("name",d.get("name")),designs.get("categories").add(f)}for(u=0;u<this.get("colors").length;u++){var g=this.get("colors").at(u),p=new MPlaza.DesignTemplateColor;p.set("colorID",g.get("colorID")),p.set("name",g.get("name")),designs.get("colors").add(p)}if(null!==this.get("elementsDescs")&&void 0!==this.get("elementsDescs")){var m=new MPlaza.DesignElementsDescs;for(u=0;u<this.get("elementsDescs").length;u++){var v=this.get("elementsDescs").at(u),_=new MPlaza.DesignElementsDesc;_.copyAttributes(v),m.push(_)}e.set("elementsDescs",m)}return e},changeColor:function(t){if(t){var e=[],i=[],n=[];for(let e of this.get("areasGrids").models)e.set("modelID",t.getModelID()),t.get("sides").find(t=>t.id==e.get("sideID"))&&e.set("colorID",t.getColorID());for(var r=0;r<this.get("sides").length;r++){var a=this.get("sides").at(r),s=null;if(a.get("modelID")==t.getModelID()){var o=t.get("sides").getSide(a.get("sideID"));o&&(s=o)}var l=null;let _=null;for(var h=0;h<this.get("sidesPrintTypes").length;h++){var c=this.get("sidesPrintTypes").at(h);c.get("modelID")==a.get("modelID")&&c.get("colorID")==a.get("colorID")&&c.get("sideID")==a.get("sideID")&&(l=c)}for(var u=0;u<this.get("areasGrids").length;u++){let t=this.get("areasGrids").at(u);t.get("modelID")==a.get("modelID")&&t.get("colorID")==a.get("colorID")&&t.get("sideID")==a.get("sideID")&&(_=t)}if(s){var d=null;for(var f of this.get("sides").models)f!==a&&f.get("modelID")===t.getModelID()&&f.get("colorID")===t.getColorID()&&f.get("sideID")===a.get("sideID")&&(d=f);d?e.push(a):a.set("colorID",t.get("colorID"));var g=null;for(var p of this.get("sidesPrintTypes").models)p!==l&&p.get("modelID")===t.getModelID()&&p.get("colorID")===t.getColorID()&&p.get("sideID")===a.get("sideID")&&(g=p);if(g&&l)i.push(l);else if(l)l.set("colorID",t.get("colorID"));else if(!g){var m=-1;m=s.get("printTypes").length>0?s.get("printTypes").at(0):t.getParentModel().get("printTypes").at(0);var v=new MPlaza.DesignSidePrintType;v.set("modelID",a.get("modelID")),v.set("colorID",a.get("colorID")),v.set("sideID",a.get("sideID")),v.set("printTypeID",m),this.get("sidesPrintTypes").add(v)}}else e.push(a),l&&i.push(l),_&&n.push(_)}for(var _ of e)this.get("sides").remove(_);for(var y of i)this.get("sidesPrintTypes").remove(y);for(let t of n)this.get("areasGrids").remove(t);for(var x=[],b=0;b<this.get("designItems").length;b++){var I=this.get("designItems").at(b),C=[];for(h=0;h<I.get("areas").length;h++){var w=I.get("areas").at(h),S=!1;if(w.get("modelID")==t.getModelID())if(f=t.get("sides").getSide(w.get("sideID")))f.get("areas").getAreaByID(w.get("areaID"))&&(S=!0);S?w.set("colorID",t.get("colorID")):C.push(w)}C.length>0&&I.get("areas").remove(C),0==I.get("areas").length&&x.push(I)}x.length>0&&this.get("designItems").remove(x),this._fireEvent("change")}},addSide:function(t){if(t&&t instanceof MPlaza.Side&&!this.get("sides").findSide(t.getModelID(),t.getColorID(),t.getSideID())){var e=new MPlaza.DesignSide;e.set("modelID",area.getModelID()),e.set("colorID",area.getColorID()),e.set("sideID",area.getSideID()),this.get("sides").add(e)}},addSidePrintType:function(t,e){if(t&&e&&t instanceof MPlaza.Side&&e instanceof MPlaza.PartPrintType&&!this.get("sidesPrintTypes").findSidePrintType(t.getModelID(),t.getColorID(),t.getSideID(),e.getPrintTypeID())){var i=new MPlaza.DesignSidePrintType;i.set("modelID",t.getModelID()),i.set("colorID",t.getColorID()),i.set("sideID",t.getSideID()),i.set("printTypeID",e.getPrintTypeID()),this.get("sidesPrintTypes").add(i)}},addArea:function(t){if(t&&side instanceof MPlaza.Area&&!this.get("areas").findArea(t.getModelID(),t.getColorID(),t.getSideID(),t.getAreaID())){var e=new MPlaza.DesignArea;e.set("modelID",t.getModelID()),e.set("colorID",t.getColorID()),e.set("sideID",t.getSideID()),e.set("areaID",t.getAreaID()),e.set("areaGuid",t.get("guid")),this.get("areas").add(e)}},getDesignSide:function(t){if(t&&t instanceof MPlaza.Side)return this.get("sides").findSide(t.getModelID(),t.getColorID(),t.getSideID())},getDesignSidePrintType:function(t,e){if(t&&e&&t instanceof MPlaza.Side&&e instanceof MPlaza.PartPrintType)return this.get("sidesPrintTypes").findSide(t.getModelID(),t.getColorID(),t.getSideID(),e.getPrintTypeID())},getDesignArea:function(t){if(t&&t instanceof MPlaza.Area)return this.get("areas").findArea(t.getModelID(),t.getColorID(),t.getSideID(),t.getAreaID())},getSelectedPrintTypeForArea:function(t){if(!t)return this.get("printTypeID");var e=this.getDesignArea(t);return this.getSelectedPrintTypeForDesignArea(e,t.getSideID(),t.getColorID())},getSelectedPrintTypeForDesignArea:function(t,e,i){if(t&&t.get("printTypeID")&&t.get("printTypeID")>0)return parseInt(t.get("printTypeID"));for(var n=null,r=0;r<this.get("sidesPrintTypes").length;r++){var a=this.get("sidesPrintTypes").at(r);a.get("colorID")==i&&a.get("sideID")==e&&(n=a)}return n?parseInt(n.get("printTypeID")):parseInt(this.get("printTypeID"))},getImageDesignItems:function(t){for(var e=[],i=0;i<this.get("designItems").length;i++){var n=this.get("designItems").at(i);n.get("imageID")==t&&e.push(n)}return e},getDesignPrice:function(t,e=1){for(var i=0,n=this.get("customerID"),r=this.get("visitorID"),a=[],s=0;s<this.get("designItems").length;s++){var o=this.get("designItems").at(s);if(o.get("imageID")>0){i+=this.get("modelImageBasePrice");var l=o.get("imagePrice");l>0&&!a.find(t=>t.get("providerImageID")===o.get("providerImageID"))&&(o.get("providerImageID")&&a.push(o),t.get("hasAdditionalFeeOnImagesProvider")||(l=null==o.get("applyImagePriceForQuantity")||o.get("applyImagePriceForQuantity")?l:l/e),n>0?n!=o.get("imageCustomerID")&&(i+=l):r>0?r!=o.get("imageVisitorID")&&(i+=l):i+=l)}else i+=this.get("modelTextBasePrice")}return i*e},getPrice:function(){var t=this.get("modelFinalPrice");return Math.round(100*t)/100},getDesignPriceEx:function(t,e){if(counter={},t&&t instanceof MPlaza.Model&&e>0)for(var i=0;i<t.get("colors").length;i++)for(var n=t.get("colors").at(i),r=0;r<n.get("sides").length;r++)for(var a=n.get("sides").at(r),s=0;s<a.get("areas").length;s++){var o=a.get("areas").at(s),l=this.getAreaDesignItems(o).filter(function(t){var e=t.get("constraints");return!e||1==e.get("isPrintable")});l.length>0&&this.addAreaPrice(o,l,e,counter)}var h=0;for(var c in counter)if(counter.hasOwnProperty(c)){var u=counter[c];isNaN(u)||(h+=u)}return Math.round(100*h)/100},addAreaPrice:function(t,e,i,n){var r=this.getSelectedPrintTypeForArea(t),a=this.getAreaPricingRef(t,r),s=a.pricingApplicationType,o=t.getModel();if(o&&o instanceof MPlaza.Model&&o.get("pricings")){var l=0,h=0,c=a.pricingID>0?o.get("pricings").getPricing(a.pricingID):null;if(c&&c instanceof MPlaza.Pricing){var u=0;c.get("setupPriceTypeID")!=MPlaza.PricingType.PerColor&&c.get("designPriceTypeID")!=MPlaza.PricingType.PerColor||(u=this.getAreaColorsCount(t,e));var d=c.getSetupPriceForQuantity(i);if(d)if(c.get("setupPriceTypeID")==MPlaza.PricingType.PerColor){if(u>0){var f=u;null!=d.get("firstColorPrice")&&null!=d.get("firstColorPrice")&&(l+=d.get("firstColorPrice"),f--),l+=f*d.get("price")}}else c.get("setupPriceTypeID")==MPlaza.PricingType.Global&&(l+=d.get("price"));var g=c.getDesignPriceForQuantity(i);if(g)if(c.get("designPriceTypeID")==MPlaza.PricingType.PerColor){if(u>0){f=u;null!=g.get("firstColorPrice")&&null!=g.get("firstColorPrice")&&(h+=g.get("firstColorPrice")*i,f--),h+=f*g.get("price")*i}}else c.get("designPriceTypeID")==MPlaza.PricingType.Global&&(h+=g.get("price")*i)}var p=null;switch(s){case MPlaza.PricingApplicationType.Global:p=this.getModelCounterKey(t.getModel(),r);break;case MPlaza.PricingApplicationType.PerSide:p=this.getSideCounterKey(t.getSide(),r);break;case MPlaza.PricingApplicationType.PerArea:p=this.getAreaCounterKey(t,r)}null!=p&&(n[p]=l+h);for(var m=[],v=0;v<e.length;v++){var _=e[v];if(_.get("imageID")>0&&_.get("imagePrice")>0&&!m.find(t=>t.get("providerImageID")===_.get("providerImageID"))){m.push(_);var y=_.get("imagePrice");y=o.get("hasAdditionalFeeOnImagesProvider")?_.get("imagePrice")*i:null===_.get("applyImagePriceForQuantity")||_.get("applyImagePriceForQuantity")?_.get("imagePrice")*i:_.get("imagePrice");var x=this.getImageCounterKey(_.get("providerImageID"));if(!(x in n)){var b=y;n[x]=b+(n[x]||0)}}}}},getAreaPricingRef:function(t,e){var i=-1,n=MPlaza.PricingApplicationType.Undefined,r=t.getPrintType(e);if(r&&r.get("pricingID")>0)i=r.get("pricingID"),n=r.get("patID");else{var a=t.getParentModel(),s=a.getPrintType(e);if(s&&s.get("pricingID")>0)i=s.get("pricingID"),n=s.get("patID");else{var o=a.getParentModel(),l=o.getPrintType(e);if(l&&l.get("pricingID")>0)i=l.get("pricingID"),n=l.get("patID");else{var h=o.getParentModel().getPrintType(e);h&&h.get("pricingID")>0&&(i=h.get("pricingID"),n=h.get("patID"))}}}return{pricingID:i,pricingApplicationType:n}},getAreaColorsCount:function(t,e){for(var i={},n=0;n<e.length;n++)for(var r=e[n].get("itemColors"),a=0;a<r.length;a++)i[r[a]]=1+(i[r[a]]||0);return Object.keys(i).length},getModelCounterKey:function(t,e){return e+"_"+t.get("modelID")},getColorCounterKey:function(t,e){return e+"_"+t.getModelID()+"_"+t.get("colorID")},getSideCounterKey:function(t,e){return e+"_"+t.getModelID()+"_"+t.getColorID()+"_"+t.get("sideID")},getAreaCounterKey:function(t,e){return e+"_"+t.getModelID()+"_"+t.getColorID()+"_"+t.getSideID()+"_"+t.get("areaID")},getImageCounterKey:function(t){return"img_"+t},countTextItemsForColor:function(t,e){for(var i={},n=0,r=0;r<this.get("designItems").length;r++){var a=this.get("designItems").at(r),s=JSON.parse(a.get("json")),o=s.length>1&&s[1].data&&s[1].data.isAreaForBackground;if(a.get("imageID")<=0&&!o)for(var l=0;l<a.get("areas").length;l++){var h=a.get("areas").at(l);h.get("modelID")==t&&h.get("colorID")==e&&(i.hasOwnProperty(a.get("itemGuid"))||(n++,i[a.get("itemGuid")]=!0))}}return n},countTextItemsForSide:function(t,e,i){for(var n={},r=0,a=0;a<this.get("designItems").length;a++){var s=this.get("designItems").at(a),o=JSON.parse(s.get("json")),l=o.length>1&&o[1].data&&o[1].data.isAreaForBackground;if(s.get("imageID")<=0&&!l)for(var h=0;h<s.get("areas").length;h++){var c=s.get("areas").at(h);c.get("modelID")==t&&c.get("colorID")==e&&c.get("sideID")==i&&(n.hasOwnProperty(s.get("itemGuid"))||(r++,n[s.get("itemGuid")]=!0))}}return r},countImageItemsForColor:function(t,e){for(var i={},n=0,r=0;r<this.get("designItems").length;r++){var a=this.get("designItems").at(r);if(a.get("imageID")>0)for(var s=0;s<a.get("areas").length;s++){var o=a.get("areas").at(s);o.get("modelID")==t&&o.get("colorID")==e&&(i.hasOwnProperty(a.get("itemGuid"))||(n++,i[a.get("itemGuid")]=!0))}}return n},countImageItemsForSide:function(t,e,i){for(var n={},r=0,a=0;a<this.get("designItems").length;a++){var s=this.get("designItems").at(a);if(s.get("imageID")>0)for(var o=0;o<s.get("areas").length;o++){var l=s.get("areas").at(o);l.get("modelID")==t&&l.get("colorID")==e&&l.get("sideID")==i&&(n.hasOwnProperty(s.get("itemGuid"))||(r++,n[s.get("itemGuid")]=!0))}}return r},countShapeItemsForColor:function(t,e){for(var i={},n=0,r=0;r<this.get("designItems").length;r++){var a=this.get("designItems").at(r),s=a.get("shape");if(s&&!s.get("isMask"))for(var o=0;o<a.get("areas").length;o++){var l=a.get("areas").at(o);l.get("modelID")==t&&l.get("colorID")==e&&(i.hasOwnProperty(a.get("itemGuid"))||(n++,i[a.get("itemGuid")]=!0))}}return n},countShapeItemsForSide:function(t,e,i){for(var n={},r=0,a=0;a<this.get("designItems").length;a++){var s=this.get("designItems").at(a);if(s.get("imageID")>0){var o=s.get("shape");if(o&&!o.get("isMask"))for(var l=0;l<s.get("areas").length;l++){var h=s.get("areas").at(l);h.get("modelID")==t&&h.get("colorID")==e&&h.get("sideID")==i&&(n.hasOwnProperty(s.get("itemGuid"))||(r++,n[s.get("itemGuid")]=!0))}}}return r},getTextItemsFonts:function(){for(var t=[],e=0;e<this.get("designItems").length;e++){var i=this.get("designItems").at(e);if(i.get("imageID")<=0){var n=i.get("json"),r=JSON.parse(n)[1],a=r.fontFamily||(r.children&&r.children.length>0&&r.children[0].length>1?r.children[0][1].fontFamily:null);a=a.replace(/"/g,""),_.contains(t,a)||t.push(a)}}return t}}),MPlaza.Designs=Backbone.Collection.extend({model:MPlaza.Design,url:function(){return Zakeke.config.baseApiUrl+"designs"},getDesign:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("designID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.ImageColor=Backbone.AssociatedModel.extend({defaults:{colorID:-1,code:""},initialize:function(){},relations:[],getImageID:function(){return this.collection&&this.collection.getImageID?this.collection.getImageID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.ImageColors=Backbone.Collection.extend({model:MPlaza.ImageColor,getImageID:function(){return this.parentModel&&this.parentModel.getImageID?this.parentModel.getImageID():null},findColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("colorID")==t)return i}return null},setupUrlForImageID:function(t){this.url=function(){return Zakeke.config.baseApiUrl+"images/"+t+"/colors"}},sync:MPlaza.syncCloudflare}),MPlaza.ImageAssignedCategory=Backbone.AssociatedModel.extend({defaults:{categoryID:-1,name:""},initialize:function(){},relations:[],getImageID:function(){return this.collection&&this.collection.getImageID?this.collection.getImageID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.ImageAssignedCategories=Backbone.Collection.extend({model:MPlaza.ImageAssignedCategory,getImageID:function(){return this.parentModel&&this.parentModel.getImageID?this.parentModel.getImageID():null},findCategory:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("categoryID")==t)return i}return null},setupUrlForImageID:function(t){this.url=function(){return Zakeke.config.baseApiUrl+"images/"+t+"/categories"}},sync:MPlaza.syncCloudflare}),MPlaza.Image=Backbone.AssociatedModel.extend({defaults:{imageID:-1,name:"",type:"",format:"",width:0,height:0,dpiX:0,dpiY:0,isMulticolor:!1,containsRaster:!1,isFilterApplied:!1,imageFileSize:0,sellerID:-1,visitorID:-1,customerID:-1,price:0,url:"",previewUrl:"",choiceUrl:"",preferredWidth:null,preferredHeight:null,colors:[],categories:[],selectionColors:"",sourceUrlImage:"",applyPriceForQuantity:null},idAttribute:"imageID",initialize:function(){var t=this;this.get("colors").parentModel=this,this.get("colors").url=function(){return t.url()+"/"+t.id+"/imagecolors"},this.get("categories").parentModel=this,this.get("categories").url=function(){return t.url()+"/"+t.id+"/categories"}},relations:[{type:Backbone.Many,key:"colors",collectionType:MPlaza.ImageColors},{type:Backbone.Many,key:"categories",collectionType:MPlaza.ImageAssignedCategories}],url:function(){var t=Zakeke.config.baseApiUrl+"images",e=this.getUrlId();return null!==e&&(t=t+"/"+e),t},getImageID:function(){return this.get("imageID")},toString:function(){},getUrlId:function(){return void 0!==this.id&&null!=this.id&&null!=this.id&&this.id>0?this.id:null},sync:function(t,e,i){return null===this.getUrlId()?MPlaza.syncCloudflare.call(this,t,e,i):Backbone.sync.call(this,t,e,i)}}),MPlaza.Images=Backbone.Collection.extend({model:MPlaza.Image,url:function(){return Zakeke.config.baseApiUrl+"images"},getImage:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("imageID")==t)return i}return null},sync:function(t,e,i){return void 0!==i&&void 0!==i.data&&void 0!==i.data.type&&"lib"===i.data.type?MPlaza.syncCloudflare.call(this,t,e,i):Backbone.sync.call(this,t,e,i)}}),MPlaza.BgImages=Backbone.Collection.extend({model:MPlaza.Image,url:function(){return Zakeke.config.baseApiUrl+"images?onlybackground=true"},getImage:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("imageID")==t)return i}return null}}),MPlaza.ImageFormatCount=Backbone.AssociatedModel.extend({defaults:{fileFormat:"",rastersCount:0,vectorsCount:0},idAttribute:"fileFormat",url:function(){return null},sync:MPlaza.syncCloudflare}),MPlaza.ImageFormatsCounts=Backbone.Collection.extend({model:MPlaza.ImageFormatCount,url:function(){return null},comparator:function(t){return t.get("fileFormat")},sync:MPlaza.syncCloudflare}),MPlaza.ImageCategory=Backbone.AssociatedModel.extend({defaults:{categoryID:-1,name:"",imagesCount:0,imageFormatsCounts:[]},idAttribute:"categoryID",initialize:function(){this.get("imageFormatsCounts").parentModel=this},relations:[{type:Backbone.Many,key:"imageFormatsCounts",collectionType:MPlaza.ImageFormatsCounts}],url:function(){return null},sync:MPlaza.syncCloudflare}),MPlaza.ImageCategories=Backbone.Collection.extend({model:MPlaza.ImageCategory,url:function(){return null},comparator:function(t){return t.get("name")},sync:MPlaza.syncCloudflare}),MPlaza.ImageMacroCategory=Backbone.AssociatedModel.extend({defaults:{macroCategoryID:-1,name:"",onlyForBackgrounds:!1,imagesCount:0,categories:[]},idAttribute:"macroCategoryID",initialize:function(){this.get("categories").parentModel=this},relations:[{type:Backbone.Many,key:"categories",collectionType:MPlaza.ImageCategories}],url:function(){var t=Zakeke.config.baseApiUrl+"imagesMacroCategories";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},sync:MPlaza.syncCloudflare}),MPlaza.ImageMacroCategories=Backbone.Collection.extend({model:MPlaza.ImageMacroCategory,url:function(){return Zakeke.config.baseApiUrl+"imageMacroCategories"},comparator:function(t){return t.get("name")},sync:MPlaza.syncCloudflare}),MPlaza.ImageMacroCategoriesBackground=Backbone.Collection.extend({model:MPlaza.ImageMacroCategory,url:function(){return Zakeke.config.baseApiUrl+"imageMacroCategories?onlybackground=true"},comparator:function(t){return t.get("name")},sync:MPlaza.syncCloudflare}),MPlaza.ColorChange=Backbone.AssociatedModel.extend({defaults:{colorID:-1,code:""},initialize:function(){},relations:[],getImageID:function(){return this.collection&&this.collection.getImageID?this.collection.getImageID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.ColorChanges=Backbone.Collection.extend({model:MPlaza.ColorChange,getImageID:function(){return this.parentModel&&this.parentModel.getImageID?this.parentModel.getImageID():null},findColor:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("colorID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.RecoloredImage=Backbone.AssociatedModel.extend({defaults:{imageID:-1,colorChanges:[],versionKey:"",imageUrl:""},idAttribute:"imageID",initialize:function(){this.get("colorChanges").parentModel=this},relations:[{type:Backbone.Many,key:"colorChanges",collectionType:MPlaza.ColorChanges}],url:function(){var t=Zakeke.config.baseApiUrl+"recoloredimages";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},getImageID:function(){return this.get("imageID")},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DrawingItem=Backbone.Model.extend({defaults:{guid:null,info:""},initialize:function(){this.set("guid",MPlaza.generateUUID())}}),MPlaza.DrawingItems=Backbone.Collection.extend({model:MPlaza.DrawingItem,getDrawingItem:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("guid")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.CompositionItem=Backbone.AssociatedModel.extend({defaults:{attributeID:-1,attributeGuid:"",attributeTypeID:MPlaza.AttributeType.Options,attributeCode:"",attributeName:"",selectedOptionID:null,selectedOptionGuid:null,selectedOptionCode:"",selectedOptionName:null,selectedValue:null},copyAttributes:function(t){this.set("attributeID",t.get("attributeID")),this.set("attributeGuid",t.get("attributeGuid")),this.set("attributeTypeID",t.get("attributeTypeID")),this.set("attributeCode",t.get("attributeCode")),this.set("attributeName",t.get("attributeName")),this.set("selectedOptionID",t.get("selectedOptionID")),this.set("selectedOptionGuid",t.get("selectedOptionGuid")),this.set("selectedOptionCode",t.get("selectedOptionCode")),this.set("selectedOptionName",t.get("selectedOptionName")),this.set("selectedValue",t.get("selectedValue"))},idAttribute:"itemGuid",initialize:function(){this.get("itemGuid")||this.set("itemGuid",MPlaza.generateUUID())},getCompositionID:function(){return this.collection&&this.collection.getCompositionID?this.collection.getCompositionID():null},getCompositionItemID:function(){return this.get("itemID")},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.CompositionItems=Backbone.Collection.extend({model:MPlaza.CompositionItem,getCompositionID:function(){return this.parentModel&&this.parentModel.getCompositionID?this.parentModel.getCompositionID():null},getCompositionItem:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("itemID")==t)return i}return null},getCompositionItemByAttributeID:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("attributeID")==t)return i}return null},getCompositionItemByAttributeGuid:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("attributeGuid")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.CompositionCategoryMapping=Backbone.AssociatedModel.extend({defaults:{categoryID:null,name:""},relations:[],resetIDs:function(){}}),MPlaza.CompositionCategoriesMapping=Backbone.Collection.extend({model:MPlaza.CompositionCategoryMapping,sync:MPlaza.syncCloudflare}),MPlaza.Composition=Backbone.AssociatedModel.extend({defaults:{name:"",designID:-1,designDocID:"",modelID:-1,modelName:"",modelPrice:0,customerID:-1,visitorID:-1,finalPrice:0,previewImageData:null,previewImageUrl:"",compositionItems:[],categories:[]},idAttribute:"docID",initialize:function(){var t=this;this.get("compositionItems").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("compositionItems").on("add",function(){t._fireEvent("change")}),this.get("compositionItems").on("remove",function(){t._fireEvent("change")}),this.get("compositionItems").on("change",function(){t._fireEvent("change")})},_eventListeners:{change:[]},_fireEvent:function(t,e){if(this._eventListeners&&_.isObject(this._eventListeners)&&_.has(this._eventListeners,t)&&_.isArray(this._eventListeners[t]))for(var i=this._eventListeners[t],n=0;n<i.length;++n)i[n](e)},trigger:function(t){this._fireEvent(t)},addEventListener:function(t,e){this._eventListeners&&_.isObject(this._eventListeners)&&(_.has(this._eventListeners,t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},isEmpty:function(){return 0==this.get("compositionItems").length},relations:[{type:Backbone.Many,key:"compositionItems",collectionType:MPlaza.CompositionItems},{type:Backbone.Many,key:"categories",collectionType:MPlaza.CompositionCategoriesMapping}],url:function(){var t=Zakeke.config.baseApiUrl+"proxycompositions";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},getCompositionID:function(){return this.get("compositionID")},toString:function(){},setModel:function(t){t&&t instanceof MPlaza.Model&&(this.set("modelID",t.get("modelID")),this.set("modelName",t.get("name")),this.set("modelPrice",t.getModelPrice(printTypeID)))},getCompositionItemByAttributeID:function(t){return this.get("compositionItems").getCompositionItemByAttributeID(t)},getCompositionItemByAttributeGuid:function(t){return this.get("compositionItems").getCompositionItemByAttributeGuid(t)},getPrice:function(t,e){for(var i=t.get("price"),n=0;n<this.get("compositionItems").length;n++){var r=this.get("compositionItems").at(n),a=(t.getAttribute(r.get("attributeID")),this.getAttributePricing(r,t));if(a)if(null!=a.get("pricingID")&&a.get("pricingID")>0){var s=t.getComposerPricing(a.get("pricingID"));if(s){var o=s.getComposerPricingPriceForQuantity(e);o&&(i+=o.get("price"))}}else i+=a.get("price")}return i*e},getAttributePricing:function(t,e){var i=null,n=e.getAttribute(t.get("attributeID"));if(t.get("attributeTypeID")==MPlaza.AttributeType.Options&&t.get("selectedOptionID"))for(var r=0;r<n.get("pricings").length;r++){if((s=n.get("pricings").at(r)).get("selectedOptionID")==t.get("selectedOptionID"))if(!(a=s.get("constraintExpression"))||this.evaluateAttributeExpression(a)){i=s;break}}else if(t.get("selectedValue"))for(r=0;r<n.get("pricings").length;r++){var a;if((s=n.get("pricings").at(r)).get("selectedValue")==t.get("selectedValue"))if(!(a=s.get("constraintExpression"))||this.evaluateAttributeExpression(a)){i=s;break}}if(!i)for(r=0;r<n.get("pricings").length;r++){var s;if(!(s=n.get("pricings").at(r)).get("selectedOptionID")&&!s.get("selectedValue")){i=s;break}}return i},evaluateAttributeExpression:function(t){if(!(t&&t instanceof MPlaza.AttributeExpression))return!1;for(var e=t.get("op"),i=e==MPlaza.LogicalOperator.AND,n=0;n<t.get("propositions").length;n++){var r=t.get("propositions")[n],a=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}for(n=0;n<t.get("expressions").length;n++){var s=t.get("expressions")[n];a=this.evaluateChildAttributeExpression(s);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}return i},evaluateChildAttributeExpression:function(t){for(var e=t.op,i=e==MPlaza.LogicalOperator.AND,n=0;n<t.propositions.length;n++){var r=t.propositions[n],a=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}for(n=0;n<t.expressions.length;n++){var s=t.expressions[n];a=this.evaluateChildAttributeExpression(s);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}return i},evaluateAttributeProposition:function(t){if(t&&t.hasOwnProperty("attributeGuid")&&t.hasOwnProperty("op")&&t.hasOwnProperty("value")){var e=t.attributeGuid,i=this.getCompositionItemByAttributeGuid(e);if(i){var n=i.get("selectedValue");i.get("attributeTypeID")==MPlaza.AttributeType.Options&&(n=i.get("selectedOptionGuid"));var r=!1;if(t.op==MPlaza.ComparisonOperator.Equal)r=n==t.value;else if(t.op==MPlaza.ComparisonOperator.NotEqual)r=n!=t.value;else if(t.op==MPlaza.ComparisonOperator.In||t.op==MPlaza.ComparisonOperator.NotIn){var a=t.value.split(";");r=t.op==MPlaza.ComparisonOperator.In?Zakeke.arrayContains(a,n):!Zakeke.arrayContains(a,n)}return r}}return!1}}),MPlaza.Compositions=Backbone.Collection.extend({model:MPlaza.Composition,url:function(){return Zakeke.config.baseApiUrl+"proxycompositions"},getComposition:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("compositionID")==t)return i}return null},getCompositionByDocID:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("docID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.TemplateCategory=Backbone.AssociatedModel.extend({defaults:{id:-1,name:"",isDummy:!1,displayOrder:0},url:function(){return null},sync:MPlaza.syncCloudflare}),MPlaza.TemplateCategories=Backbone.Collection.extend({model:MPlaza.TemplateCategory,url:function(){return null},sync:MPlaza.syncCloudflare}),MPlaza.TemplateMacroCategory=Backbone.AssociatedModel.extend({defaults:{id:-1,name:"",isDummy:!1,displayOrder:0,categories:[]},initialize:function(){this.get("categories").parentModel=this},relations:[{type:Backbone.Many,key:"categories",collectionType:MPlaza.TemplateCategories}],url:function(){var t=Zakeke.config.baseApiUrl+"designs/templatemacrocategories";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},sync:MPlaza.syncCloudflare}),MPlaza.TemplateMacroCategories=Backbone.Collection.extend({model:MPlaza.TemplateMacroCategory,url:function(){return Zakeke.config.baseApiUrl+"designs/templatemacrocategories"},sync:MPlaza.syncCloudflare}),MPlaza.Grid=Backbone.AssociatedModel.extend({defaults:{json:"",svg:"",name:"",sellerID:-1,isDeleted:!1},idAttribute:"gridID",initialize:function(){},relations:[],getGridRuleID:function(){return this.collection&&this.collection.getGridRuleID?this.collection.getGridRuleID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.Grids=Backbone.Collection.extend({model:MPlaza.Grid,getGridRuleID:function(){return this.parentModel&&this.parentModel.getGridRuleID?this.parentModel.getGridRuleID():null},findGrid:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("gridID")==t)return i}return null},sync:MPlaza.syncCloudflare,comparator:function(t){return t.get("name")}}),MPlaza.GridRuleGridSideMapping=Backbone.AssociatedModel.extend({defaults:{gridRuleID:-1,gridID:-1,productID:null,sideID:null},initialize:function(){},relations:[],getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.GridRuleGridSideMappings=Backbone.Collection.extend({model:MPlaza.GridRuleGridSideMapping,modelId:function(t){return t.gridID+"-"+t.productID+"-"+t.sideID},getGridRuleID:function(){return this.parentModel&&this.parentModel.getGridRuleID?this.parentModel.getGridRuleID():null},findAssociation:function(t,e,i,n){for(var r=0;r<this.length;r++){var a=this.at(r);if(a.get("gridRuleID")==t&&a.get("gridID")==e&&a.get("productID")==i&&a.get("sideID")==n)return a}return null},sync:MPlaza.syncCloudflare}),MPlaza.GridRule=Backbone.AssociatedModel.extend({defaults:{name:"",sellerID:-1,associations:[],grids:[]},idAttribute:"gridRuleID",initialize:function(){var t=this;this.get("associations").parentModel=this,this.get("grids").parentModel=this,this.on("change",function(){t._fireEvent("change")}),this.get("associations").on("add",function(){t._fireEvent("change")}),this.get("associations").on("remove",function(){t._fireEvent("change")}),this.get("associations").on("change",function(){t._fireEvent("change")})},relations:[{type:Backbone.Many,key:"associations",collectionType:MPlaza.GridRuleGridSideMappings},{type:Backbone.Many,key:"grids",collectionType:MPlaza.Grids}],url:function(){var t=Zakeke.config.baseApiUrl+"gridrules";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},getGridRuleID:function(){return this.get("gridRuleID")},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.GridRules=Backbone.Collection.extend({model:MPlaza.GridRule,url:function(){return Zakeke.config.baseApiUrl+"gridrules/"},findGridRule:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("gridRuleID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.Quote=Backbone.AssociatedModel.extend({defaults:{sellerID:-1,designDocID:"",compositionDocID:"",orderDocID:"",visitorID:-1,visitorCode:"",customerID:-1,customerCode:"",formData:"",subject:"",statusID:1,createdOn:null,amount:0,shippingAmount:0,additionalAmountLabel:"",additionalAmount:0,modelPrice:0,variantName:"",quantity:1,notifyEmailList:""},idAttribute:"quoteID",initialize:function(){},relations:[],getQuoteID:function(){return this.collection&&this.collection.getQuoteID?this.collection.getQuoteID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},url:function(){var t=Zakeke.config.baseApiUrl+"quotes";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.Quotes=Backbone.Collection.extend({model:MPlaza.Quote,getQuoteID:function(){return this.parentModel&&this.parentModel.getQuoteID?this.parentModel.getQuoteID():null},findQuote:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("quoteID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.DesignEffectTemplate=Backbone.AssociatedModel.extend({defaults:{name:"",sellerID:-1,previewDesignEffect:null,outputDesignEffect:null},idAttribute:"templateID",initialize:function(){},relations:[{type:Backbone.One,key:"previewDesignEffect",relatedModel:MPlaza.DesignEffect},{type:Backbone.One,key:"outputDesignEffect",relatedModel:MPlaza.DesignEffect}],url:function(){var t=Zakeke.config.baseApiUrl+"gridrules";return void 0!==this.id&&null!==this.id&&(t=t+"/"+this.id),t},getTemplateID:function(){return this.get("templateID")},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.DesignEffectTemplates=Backbone.Collection.extend({model:MPlaza.DesignEffectTemplate,url:function(){return Zakeke.config.baseApiUrl+"designeffecttemplates/"},findTemplate:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("templateID")==t)return i}return null},sync:MPlaza.syncCloudflare}),MPlaza.ShapeCategory=Backbone.AssociatedModel.extend({defaults:{name:"",imagesCount:0},idAttribute:"shapeCategoryID",initialize:function(){},relations:[],url:function(){var t=Zakeke.config.baseApiUrl+"shapeCategories";return null!=this.id&&null!=this.id&&this.id>0&&(t=t+"/"+this.id),t},sync:MPlaza.syncCloudflare}),MPlaza.ShapeCategories=Backbone.Collection.extend({model:MPlaza.ShapeCategory,url:function(){return Zakeke.config.baseApiUrl+"shapeCategories"},comparator:function(t){return t.get("name")},sync:MPlaza.syncCloudflare}),MPlaza.ShapeAssignedCategory=Backbone.AssociatedModel.extend({defaults:{shapeCategoryID:-1,name:""},initialize:function(){},relations:[],getShapeID:function(){return this.collection&&this.collection.getShapeID?this.collection.getShapeID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.ShapeAssignedCategories=Backbone.Collection.extend({model:MPlaza.ShapeAssignedCategory,getShapeID:function(){return this.parentModel&&this.parentModel.getShapeID?this.parentModel.getShapeID():null},findShapeCategory:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("shapeCategoryID")===t)return i}return null},setupUrlForShapeID:function(t){this.url=function(){return Zakeke.config.baseApiUrl+"shapes/"+t+"/categories"}},sync:MPlaza.syncCloudflare}),MPlaza.Shape=Backbone.AssociatedModel.extend({defaults:{name:"",tags:"",pathDataUrl:"",imageUrl:"",maskImageUrl:"",categories:[]},idAttribute:"shapeID",initialize:function(){var t=this;this.get("categories").parentModel=this,this.get("categories").url=function(){return t.url()+"/"+t.id+"/categories"},this.get("shapeGuid")||this.set("shapeGuid",MPlaza.generateUUID())},relations:[{type:Backbone.Many,key:"categories",collectionType:MPlaza.ShapeAssignedCategories}],url:function(){var t=Zakeke.config.baseApiUrl+"shapes";return void 0!==this.id&&null!==this.id&&this.id>0&&(t=t+"/"+this.id),t},getShapeID:function(){return this.get("shapeID")},toString:function(){},sync:MPlaza.syncCloudflare}),MPlaza.Shapes=Backbone.Collection.extend({model:MPlaza.Shape,url:function(){return Zakeke.config.baseApiUrl+"shapes"},getShape:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("shapeID")===t)return i}return null},sync:MPlaza.syncCloudflare}),function(t){!function(t){var e=function(){function t(){this._topNode=void 0,this._count=0,this._changedEventListeners=[],this._enableChangedEvent=!0}return t.prototype.count=function(){return this._count},t.prototype.isEmpty=function(){return void 0===this._topNode},t.prototype.push=function(t){var e=new i(t,this._topNode);this._topNode=e,this._count++,this.fireChangedEventListener()},t.prototype.pop=function(){if(0!=this._count){var t=this._topNode;return this._topNode=t.previous,this._count--,this.fireChangedEventListener(),t.data}},t.prototype.peek=function(){return this._topNode.data},t.prototype.clear=function(){this._topNode&&this._count>0&&(this._topNode=void 0,this._count=0,this.fireChangedEventListener())},t.prototype.addChangedEventListener=function(t){this._changedEventListeners.push(t)},t.prototype.removeChangedEventListener=function(t){for(var e=0;e<this._changedEventListeners.length;e++)this._changedEventListeners[e]==t&&this._changedEventListeners.splice(e--,1)},t.prototype.fireChangedEventListener=function(){if(this._enableChangedEvent)for(var t=0;t<this._changedEventListeners.length;t++){(0,this._changedEventListeners[t])()}},t.prototype.getAllData=function(){for(var t=new Array(this._count),e=this._count-1,i=this._topNode;i;)t[e]=i.data,i=i.previous,e--;return t},t.prototype.getLastData=function(t){for(var e=this._topNode;e;){if(!t||t(e.data))return e.data;e=e.previous}return null},t.prototype.getAllDataAfter=function(t){for(var e=[],i=this._topNode;i&&i.data!=t;)e.push(i.data),i=i.previous;return e.reverse()},t.prototype.removeDataArray=function(t){var e=this;this._enableChangedEvent=!1,t.forEach(function(t){e.removeData(t)}),this._enableChangedEvent=!0,this.fireChangedEventListener()},t.prototype.removeData=function(t){var e=this.getNodeHavingData(t);e&&(this.removeNode(e),this.fireChangedEventListener())},t.prototype.getNodeHavingData=function(t){for(var e=this._topNode;e;){if(e.data==t)return e;e=e.previous}return null},t.prototype.removeNode=function(t){if(t)if(this._topNode==t)this._topNode=t.previous,this._count--;else{var e=this.getFollowingNode(t);e&&(e.previous=t.previous,this._count--)}},t.prototype.getFollowingNode=function(t){for(var e=this._topNode;e;){if(e.previous==t)return e;e=e.previous}},t}();t.Stack=e;var i=function(){return function(t,e){this.previous=e,this.data=t}}()}(t.Customizer||(t.Customizer={}))}(Zakeke||(Zakeke={}));var MaskedImageSelectionMode,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,a){function s(t){try{l(n.next(t))}catch(t){a(t)}}function o(t){try{l(n.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,o)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,r=0,a=e.length;r<a;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},_this_1=this,MPlaza=MPlaza||{};String.prototype.padStart||(String.prototype.padStart=function(t,e){return t>>=0,e=String(e||" "),this.length>t?String(this):((t-=this.length)>e.length&&(e+=e.repeat(t/e.length)),e.slice(0,t)+String(this))}),String.prototype.padEnd||(String.prototype.padEnd=function(t,e){return t>>=0,e=String(e||" "),this.length>t?String(this):((t-=this.length)>e.length&&(e+=e.repeat(t/e.length)),String(this)+e.slice(0,t))}),String.prototype.padStartEnd||(String.prototype.padStartEnd=function(t,e){if(t>>=0,e=String(e||" "),this.length>t)return String(this);t-=this.length;var i=Math.floor(t/2),n=t%2>0?i+1:i,r=i,a=e;n>a.length&&(a+=a.repeat(n/a.length));var s=e;return r>s.length&&(s+=s.repeat(r/s.length)),a.slice(0,n)+String(this)+s.slice(0,r)}),MPlaza.EventMessages={DPIWarning:1,UploadLimit:2,AddToCartConfirmation:4,ItemsClippedWarning:7},MPlaza.CustomizerElementType={None:"none",Rectangle:"rectangle",Oval:"oval",Line:"line",Path:"pen",Free:"freeHand",Text:"text",Image:"image",TextArt:"textart",Shape:"shape"},MPlaza.CustomizerInteractionMode={None:"none",Select:"select",Create:"create",Move:"move",Rotate:"rotate",Resize:"resize",ResizeTop:"resizeTop",ResizeBottom:"resizeBottom",ResizeLeft:"resizeLeft",ResizeRight:"resizeRight",Delete:"delete",Edit:"edit",MoveTextOnPathFirstEnd:"moveTextOnPathFirstEnd",MoveTextOnPathMiddleEnd:"moveTextOnPathMiddleEnd",MoveTextOnPathLastEnd:"moveTextOnPathLastEnd",MoveTextAreaTopEnd:"moveTextAreaTopEnd",MoveTextAreaRightEnd:"moveTextAreaRightEnd",MoveTextAreaBottomEnd:"moveTextAreaBottomEnd",MoveTextAreaLeftEnd:"moveTextAreaLeftEnd"},function(t){t[t.Element=1]="Element",t[t.Raster=2]="Raster",t[t.Mask=3]="Mask"}(MaskedImageSelectionMode||(MaskedImageSelectionMode={})),MPlaza.PointingInfo=function(){return this.modifiers={option:!1,control:!1,shift:!1},this.point=void 0,this.delta=void 0,this};var getViewport=function(){var t="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(t?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(t?document.documentElement.clientHeight:document.body.clientHeight)}};MPlaza.ItemInfo=function(t,e){this.designItem=t,this.item=e,this.elementType=MPlaza.CustomizerElementType.None,this.sideID=-1,this.itemGuid=MPlaza.EmptyUUID,this.constraints=[],t&&t instanceof MPlaza.DesignItem&&(this.itemGuid=t.get("itemGuid"))},MPlaza.TextItemInfo=function(t,e){MPlaza.ItemInfo.call(this,t,e),this.elementType=MPlaza.CustomizerElementType.Text,this.text="",this.strokeColor="black",this.strokeWidth=0,this.fillColor="black",this.fontFamily="Arial",this.fontSize=18,this.fontWeight="normal",this.fontStyle="normal",this.fontStretch="normal",this.justification="center",this.isTextOnPath=!1,this.isTextArea=!1,this.adaptText=!1,this.letterSpacing=0,this.lineSpacing=0,this.scaling=1,this.verticalAlignment="top",this.shadowColor=null,this.shadowBlur=0,this.shadowDistance=7,this.shadowAngle=45,this.__defineGetter__("totalFontSizePt",function(){return this.fontSize*this.scaling*4/3})},MPlaza.TextItemInfo.prototype=Object.create(MPlaza.ItemInfo.prototype),MPlaza.TextItemInfo.prototype.constructor=MPlaza.TextItemInfo,MPlaza.ImageItemInfo=function(t,e){MPlaza.ItemInfo.call(this,t,e),this.elementType=MPlaza.CustomizerElementType.Image,this.url="",this.deleted=!1,this.isMasked=!1,this.maskID=-1,this.maskStyle={strokeColor:void 0,strokeWidth:void 0,strokeCap:void 0,strokeJoin:void 0,dashArray:void 0,dashOffset:void 0}},MPlaza.ImageItemInfo.prototype=Object.create(MPlaza.ItemInfo.prototype),MPlaza.ImageItemInfo.prototype.constructor=MPlaza.ImageItemInfo,MPlaza.ShapeItemInfo=function(t,e){MPlaza.ItemInfo.call(this,t,e),this.elementType=MPlaza.CustomizerElementType.Shape,this.style={strokeColor:void 0,strokeWidth:void 0,strokeCap:void 0,strokeJoin:void 0,dashArray:void 0,dashOffset:void 0,fillColor:void 0},this.isImagePlaceholder=!1,this.fillerImageID=-1},MPlaza.ShapeItemInfo.prototype=Object.create(MPlaza.ItemInfo.prototype),MPlaza.ShapeItemInfo.prototype.constructor=MPlaza.ShapeItemInfo,MPlaza.TextArtItemInfo=function(t,e){MPlaza.ItemInfo.call(this,t,e),this.elementType=MPlaza.CustomizerElementType.TextArt,this.text="",this.fontFamilyID=-1,this.fontFaceID=-1,this.text="",this.textArtTypeID=-1,this.style={strokeColor:void 0,strokeWidth:void 0,strokeCap:void 0,strokeJoin:void 0,dashArray:void 0,dashOffset:void 0,fillColor:void 0,shadowColor:void 0,shadowBlur:void 0,shadowDistance:void 0,shadowAngle:void 0},this.config={angleValue:0,curveValue:0,intensT:0,intensB:0,isTriangle:!1,isBridge:!1,isTop:!1,isBottom:!1,isMiddle:!1}},MPlaza.TextArtItemInfo.prototype=Object.create(MPlaza.ItemInfo.prototype),MPlaza.TextArtItemInfo.prototype.constructor=MPlaza.TextArtItemInfo,MPlaza.Customizer=function(t,e,i,n){this.isViewer=t||!1,this.isMobile=e||!1,this.isConfigurator=n||!1,this.isCartPreview=!1,this.isImageScalingEnabled=!0,this.showSideImage=!0,this.fitToScreenMargin=this.isMobile?18:13,this.canvasID="mp-canvas-customizer_"+MPlaza.makeID(5),this.canvas=null,this.context=null,null!=i&&(this.canvas=i,this.context=this.canvas.getContext("2d")),this._paper=new paper.PaperScope,this.__defineGetter__("paper",function(){return paper=this._paper,this._paper}),this.__defineSetter__("viewMatrix",function(t){var e=new this.paper.Matrix(t);this.paper.view.matrix=e}),this.rasterLayer=null,this.zooming=!1,this.frozen=!1,this.tool=null,this.clipboard=null,this.selectionBounds=null,this.selectionBoundsShape=null,this.selectionMoveHandle=null,this.selectionRotateHandle=null,this.selectionResizeHandle=null,this.selectionDeleteHandle=null,this.selectionMaskMoveImage=null,this.selectionMaskMoveShape=null,this.selectionResizeTopHandle=null,this.selectionResizeBottomHandle=null,this.selectionResizeLeftHandle=null,this.selectionResizeRightHandle=null,this.selectionLateralResizeDimension=this.isMobile?15:8,this.drawSelectionBounds=0,this.model=null,this.grids=[],this.loadingCircles=[],this.interactionMode=MPlaza.CustomizerInteractionMode.None,this.elementType=MPlaza.CustomizerElementType.None,this.hammertime=null,this.hitItem=null,this.hitTestEnabled=!0,this.mouseStartPos=null,this.adjustmentDelta=null,this.originalPositions=null,this.element=null,this.pivot=null,this.corner=null,this.topCorner=null,this.bottomCorner=null,this.leftCorner=null,this.rightCorner=null,this.originalSize=null,this.originalCenter=null,this.originalScaleCenter=null,this.originalContent=null,this.originalMatrix=null,this.originalShape=null,this.originalAngle=null,this.itemsLayer=null,this.imageLayer=null,this.imageItem=null,this.imageWidth=500,this.imageHeight=516,this.mask=null,this.verticalCenterLine=null,this.horizontalCenterLine=null,this.resizableSideImageItem=null,this.resizableMeasuresItem=null,this.resizableSplitColumnsItem=null,this.productImageGenerator=new ZakekeResizableCanvas.ProductImageGenerator,this.productAreaGenerator=new ZakekeResizableCanvas.ProductAreaGenerator,void 0!==i&&null!=i?this.setupCanvas():(this.createCanvas(),this.createDOMElement()),this.setupImageLayer(),this.lastPanPoint=new this.paper.Point(0,0),this.iconsBytes=null,this.masterGroup=null,this.snapCache=null,this.oldScale=1;getViewport();return this.isViewer||(this.iconsBytes={move:"iVBORw0KGgoAAAANSUhEUgAAAJIAAACSCAYAAACue5OOAAAACXBIWXMAAC4jAAAuIwF4pT92AAAOQElEQVR42u2dTUxT6RrH/2NMWlhIJwIpi9aaMBGjCQVXIMnQScYMK4+zmRk2Uq9rL4suXDFMV96EZNA1Y+sGrxssm+nEmwAmiCtpSTDUaEJtF5DK5LYuarvyLvp2LkOg53nP5/uenidpjHDO6aHn1//z9X588fnzZ7jmml475X4ErrkgueaC5Jqz7HS7fwDRmbkQgBD77/gJh4UA5I/5+Rr7N5+Ix/Lt/Dl+0S7BNgMmfOgVAjBo8NtsASgzwLIAsu0CmGNBYuCMH3qds+lW3jOo1gCknAqWo0CKzsyFAUwxcAYFvc33AFIAkol4LOuCJJbyTANQbFSdtodKWpCiM3NTTH2+dsiXegvAfCIeS7ogmQ+Pj6nPlITqQ7UKgHkGVdkFyRyApgF0tUlGLRVQQoNkNUAdXg+C/l7SsYX9Ej7V6i5QooPEYqBZM1zYhVAAwb4edPu6EPT3ovvLM+j2aeO0WqujsFdCYb+Eg3IFhb0PeJMvmgXUbCIem3dBoqfw80YF0R1eDwZCAQycb7yoiqPXCvsl5HaLjVe+aKR6bQGYTsRjay5IJ0M0C+BnI+AZHujH8MWvMHyxX4i/LbdbxGbuLTZ33uHP8kcjLnmfKVTZBenvKpSEziLi1fAloeBpBdV6ZhubuXd6leo9gCkR1Ml2kKIzc9MAftV6/lnfGVwbuYKxocvo9HqkSsuqtTo2d94itbqhV6V+ScRjs20JEsvIkgCuawVIiYxibOiyI3L99cw21jOv9QTqzwEodrk6W0BiriylJSNzGkDHub3F9AqK+x+0ZnbjdrRbLAcpOjOnMCXiyrc7vB4okVFcG7mCdrD1zDYW06taY6io1a0WS0FitaEE73nfjgxDiVyVLgYyIoZKrb7Af15uCh83WQZSdGZuHsA/ed3Y7RsTGDgfQDtbYb+EhaW0Fnf3KBGPTTkGpOjMXBLATVeF9FlqdQPLqxtCwmQ6SLwQdXg9uH1jQvhakJ3B+IPHKd7YyXSYTAWJF6KAvwd3JhXNfa92ip0eLKZ4SwWmwmQaSLwx0dXwJdz+fsKlhMMW0yu8gbhpMJkCEm929tNEpG3SejPKBL89/cP2bM5wkFid6Cn1+H/c+M6xxUUrYeKsORleZzIUJFaxXgOx2OhCZGyJ4N7DJzwwDRlZATcMJNY7y4LY9nAhsh2mCoCQUb05I+f+J50I0cJSGgtLaSnuNejvxd1bP6CDVnvrwv+nnIsBEhsKct2JEL3IvsaL7GupYLp9g5z9DrLBhPa7NhYXZZyWnTUhkrVEwZnNRfQOjjNCkUjR/9XwJakhAiCVMo0NXca3I8PkZ8hiXHtAYrKoOjw24O+R5pt8EkQywjQ58Q0uhEgN73NozNixHiTm0lQH6nd4Pbh760dHQCQjTHcmFZz1naEc+s/ozNy4HYpEml915ydFig4+FSLZYOr0enBnUjE0TDEMJNYCUZ139u3IsBRjiXghkg2moL8X1yOjJBenNYs7pQEiH0WNAv4eTE5841iIZINJiYwi4O+hHDqtJfDWokikefjtAJFsMBETni5q2KIZpEOLOkjv0oyCSCaYOFzcTbaAmWmKpKpGjdkeV9sKIplgUiKj1Cxu1hSQqGo0OREROkszCyKZYCKGHVyqxKNIqmp01ndG6D6a2RDJAtPwxX5qoXLWLJCkDbCtgkgWmBRarKRQMzgSSKxu1KWW7os688NqiGSAaeB8gKJKXWis12mYIqmqkagNWbsgkgEmoipNGwIS66kNyhgb2Q2R6DANnA9QipTnKD04iiKpSpuIaiQKRKLDRHx2qgxQdkdq2fHr8HqEU6NqrY6xocvk+9KxjAx3K6haqwtVHhkbukyZgaLoAom5tZbjsIcH+oWrG3V6PVyV9U6vV8d7eaVf5GJs6JLaRMuu6MyckojHUlpd2xSFaNfkNqJ7U/TESIpakC3Kt7FqzeLpjrznbl8XJejWBhIrj7d2a4LUjRaW0ijslaQDqbBXEiYAJ3iWLhbqcCuSYsCbt112Jms2RxQFRQtI42rZmlWr6DsVIpFg6vZ1UUYFjBsO0kAo4ELkMJgIqvQ1F0gsPuoSNT5yGkSiwDQQCqoec1KV+yRFCqtdMNjX60LkMJiIGXjYMJDsio+cDpHdMHV6PZQ46Vg2TmuJj5wGUbCvx5Zz1WACYPkM5aC/V21flBAPSCEDJFAaJRJ1QJ4dMAX7epHJveMOuE9ybedap4pnHAOR6+b4s/HjRk2eOuYg1UDbquWL2x0iO2Dq/pIkEmGKa1Mdo2tFxsYL0WJ6hdzFD/aZNwt4Mb2Cwh5tSEq1VhPOzRFFwkcBKUSJ7kVTIq3jiYw2EzdHtgyms74zagF3c5u0ljFSS5CI88dddyaxm9MSunDP/dczCMyFSM4AnOLaTony4bgQiQNTt4aiJLdrcyFyPkzdXxrj2lqCZHQx0oVIejdnv2tzIXIOTLaCVNgvuRQY+FnaOQbcVpDu3vrR9HJCO1jA34O7t360dVrYcSC13OTEyEH2nWzpZBcmuSE6CaSWWy8ZLZ8uTOJBxNO6EcK1uTCJqUSEXmFWN0haaHVhcpw7K1NAyre6gpnNURcmMSA6KFe4zznNC5JVbu7ew39zQRvw93ANIzHLeK5drdW4/0YrlEil838sI6e1vFFut2jqcFstME1OfCPEOgQ845xyu0X8K/FEKIiIapRXdW2UDeCsKHy5bs6emOjgvx+NAYlZSyytqki7MFkfWFOebSIeI7u2LFpMz83tFoGI2DETj61ntnFQ/qjp3G4T18+0IzsjFJy3qMG2KkhaonqRYVrPvNY8PPZCKGAKSHal+ARFOrZgfYrn4MNRvV0wtYObswuiaq1O+aLmDQPpL/dmU2nAyTDZWWwkPtM1MkiJeCyrFnDbAZLTYbK7Yp3LFyiBNh0kiirl8kXbPnAnwiRCF58gDlsn/aIVSCm1OMnOgWlOgkkEiA7KFUp8tKYFpDW1q27uvLP1ATgBJlHGExGfJT9IlDhpPbNt+4NowmTXwl96LNjXKwRE1GepZ8F2od3bYZhE3rVS9PsmurXlVr/UBZIoquSaJW4tpRkkJmUq7s2dTiS7PXv5SjdIp4kXuHnSLz/V6ljPbAu1J0m1Vje1N3fY3uSLiM7MSRVYH1Ujwvij5UQ8Vtbj2gAgaRDRbZ3NiQgRx7NTZUAVJFbJfN/qmOL+B9sq3TLAJCpEB+UKpVldaZWt8SgSAMyr+r/VDSGzIrthEhUiAEitbBjy7HlASqoF3W/yReFUyW6YRIbooFyhrruQNAwkFmipypuIqmQXTCJDBACLv69SDnt03GhIPYoEALOUDEZEVbIaJtEhyu0W1dbS5nJrXCAxMh+pHbfwVMw97q2CSXSIODzHc9YmMxYkqir9Wf4orIszGyYZIHr28hV1WPEsz3W5QKKq0rOXrywfims3TDJAVK3VqV/yR5RpaXoUCQCm1TK4T7U6Fpb+gMhmJEwyQAQ0Vsj7RJuTOMt7bW6QWAanGoS9yReFq3ibAZMsEG3uvKMG2PepmZpeRUIiHpuFSrUbAB6nV4Vf3k8PTLJAdFCuUJOgihY10gwSsymqnIqyv72RMMkCEQA8WExRXdqUWnPWcJBYMLasdlxx/wMWf18R/sPmgUkmiBaW0tRREM8pPTUzFKmpSqrp2Yvsa6FLAjwwyQTRemab2gapUD2MKSAxGSTdwPLqhhSjKVvBJBNEud0ifntKzpyntQTYRipScxTlfcqxixIE3yfBJBNEhf0SHjwme6nlRDyW1PuehixGmojHptFi8lzTPtXquPfwiXQwyQbRvYdPqMH1e70urWlffP782ZA/IDozF0Jjdq7qjigdXg/u3vrBlt26ea2ZcToQogqAcZ5+mumKxFQpD0ChHCubMjkQomZclDXq/Q1dZ5uVBKJOg8mBEP1iRFxkims74uaSaDHz5Kibm5yICDULRSbL7Rbx4HGKB6JHiXhsyuj7MAUkXpgA4KeJCK6NXHHJ4LD1zDZPig80io7jZtyLaVtIMOqXqcc/Tq9K0U4RxRaW0rwQbVFjWC122uS/dwqNFSwGKQe/yL5GYb+E299PSJHR2WEH5QoeLKZ4J39usQytbNZ9mebaDrk4HxoTB76mntPh9UCJjLqu7oht7rzDwtM0TzxkCUSWgKQ1ZgIaK8be/v47TfvQO8mqtToWltLU8UR/i4kAKGZDZClIWmFqd3Vaz2xjMb3Kq0KmZWdCgMRgmgbwK+95AX+PMPuNWJXWp1Y3tK7/fZ+1reBYkBhMChozOLl9ltPd3UG5gtTKhtbdxytoVKyTVt+3LSAxmMIMpkEt518NX8K10SuOye50AgQ0GrCKkW0PKUA6lNHN88ZNRxXq2sgVDF/sl9aFPXv5SksgfdiWoWOYrPQgGeHqmnaWbS4zNnRJeLdXZYuTPXv5irLIlZCuTEiQDqlTEsB1vde6EApg+GI/hi/2CwNVtVbH5s5bnmlBlNR+Su/IRseBdESd5gGcM+J6AX8PBs4HMDzwleUZX263iFy+iM2dt0YuQyiMCgkN0iF1mgbws9HXboLV7etC0N+LYF+v7vFG1Vodhb0SDsoVFPZLKOx90Lxtl1paD2DWzlhIKpAOARVCY8LeTbPf60KooVadXo/q4u+FvdJfzeU31uzJIpQbkw4kO4ASzJ4zBVoT/UalAKkNgXoEICkDQFKCdASoKfY65xB4KixrnRfZhTkKpGOyvCkjygY22TKAlGhZWNuBdCTTU9jrugzwMIDKTvj8HQPSCUo1zl6DNt/OFhojRdcArDkFnrYA6Ri1CjOowgBCJsL1Ho2JolkGTtaJ4LQlSC0ACwNoQuZjPx4nnt7MqMoMmrJdnXcXJNccY6fcj8A1FyTXXJBcc5b9D4O1t0lsiFUUAAAAAElFTkSuQmCC",rotate:"iVBORw0KGgoAAAANSUhEUgAAAJIAAACSCAYAAACue5OOAAAACXBIWXMAAC4jAAAuIwF4pT92AAAQUElEQVR42u2dTUwb1xbH/0WR+FiAqxBEFgZHIgookQJmBYkUiFQUusHJJg2LPkhRF5Ee5VV+alaUePGUSqiieVIWfUkMXdBmU8ymREQqVCKwCgaJKEZBwtiLWIQqdhZgVn0LX6cuBd8z4ztz74znSIi0DB4z/t3zdc8594M//vgDjjhSqJQ4j8ARByRHHJAcsZccK/YH0D886gHgYf/ZccglLvY9ecjP5tn3lWDAnyzm5/hBsTjbDJhm9tXB4KkXfJtVAFEAK+xrvlgAsy1IDBwfg6YDQJWkt7LFNNc8AyvqgKQ+PB0MHp8B2kak1poHMB4M+FcckNSBpxlAn+Lw5NNW4wyqqAOS+fC4GDhDAM7bZFH/xoAad0AyB6Ah9lUFe8oWgDEGVdIBSbzjPALgH0UUUacYUGNWAEppkHI00Ndm3O+4qxLVLpqiiyW2sZfeNw2oYMA/4oCkD6IhpoWEmrDyslLU1dag8ZQb1QycupM1qCgr1fV6O8kUdt6+QyyxjZ1kCrHXb7AejRtl8oaCAX/IAYkewo+JcqLLy0rR6HHD29SAupM1qKutMeXviCW2EdmMI7IZRziyIdop71MtylMGJGbGRgB8IcJEeZsacLHlnGng8GT55QaWX77CcmRDlEm8o5K5UwIkpoXGUUAeqLysFN7GBnS1tyoDDw+qZysvCn2pVaadVooepP7h0ZFCnOnjrkr4OtvhbTqt28+RJbvpfcwuPcdCeA2/J98V4oyPBAP+saIEiZmyeb2+0BmPG77OdjSectsi1l8IryE0t1gIUNNMOyWLBiS2rTGvJyKzG0CCgZJm6kwHqX94tA9AUK8Ju9hyDsUgs0vPEZpb1OOYpwD4ggH/vG1B6h8eHdMTlfV0tqOrrdVyPpAIH2ryl1/1OuX9Zu7bmQZS//DoODRucbhrT2DgWrfyUZjREtmM48HUjB5z9y+znHBTQNIDUU9nO3yd7XDkT+0UmnuGp0vLWn91Ihjw91keJK0QHXdVYrDXV/Ra6ChZfrmBB1MzWn0nw2EyFCStELU0NmDgWnfR+UJaZSeZwr3JEOKJN8rAZBhIWiH6qM2L3u7LDiXGOuKG+UyGgKQVos+uXimasF60hOYWMT23KD2aEw6SljxReVkpBm/4bJtcNEsWwmt4OPVEy690is4zCQWJbb7OUSG6ffO641TLgSkFoENkBlwYSKwcdgWEbQ8HIiVgWmUwCdmbE9n7H7IbRLvpfQzfn7AMSBdbzuGzq1eol59HpnQHyoDEtj5Iu/hWgujuo5+0hthWg6mHlTTLB6l/eNQH4v7ZZ1evOBCZBFMPfVdghFVjyAOJ1RSR1GOPRXburQ5RVnyd7bjQfJZyaZUIE1eoRhqn+EUtjQ2W2DezC0RZ6f34Mty1J0j+EqtUNR8kZtJ6eNdld/AdiMyXirJSDPb6UE7bcvqaRd7mgcRMGinVboW9MztClJVqVxUGrpIX8ripICHT/crt+LjR3am8c21niLLibWrAR21eyqWXmKUxHiSm/rgh4xmPG11trQ5EyjjfF3DcVUm5dMwUkEBooy4vK8XAtSsORIr5S0QTV6/H8dYEEtNG3F39rrZW8jAGByLzpPGUm5oSGGJ+MFm0TrXlkprt9rATRKGcMo0KNoSi+sNKpRdLvpQAoW28irkvZM1E3rRl2miTd91X/deVLQsRrYmyAyoaT2WGVFgFrNml5/hxhlukkQLgoW7qlojURmfYQy0Wc7aX3kc4soEfZ+bw72//h7uPHmMhvKY8SF1trRTHuwqZ2ZzifCRmL7m+kaomzSyfaD0ax8OpJ7j1n/8iNLeIXXMGcemM4kif1ZBQkKjhvqraKLIZN9Wx3kvvY3puEf5vv1dWQ11sOUfRSvWs4lUYSH2CCJci3qYGLaUVQoF6OPUEdx89RiyxbVWtJAYklumst6o2yl2BMmDKmjwV/SeiVrpE2YOjaCRuylz1DLYKMGW104OfZ5R7JiK00rFCnezsmD2rSPbBaem6+Kr/OnbT+4gltrGbThc0cPTZygvsJN9hsNenxGZ2V1srpZ2pjxe18xKSPkFEWxqmrNk+uGD0zoXMmLqfcPvmJ9JhqigrxYXms7xGy/r+4dHmfF0nJYWDdBZWFBFmztuUaTEf/fJz9HS2U+t+AADxxBvcm1Rj0rG36XTB5o0HUke+H7prT1hym0C0z1RRVgpfZ/t7oLRoJhV8Jm9TA2URdOgCiUVrVXYza0Y64Fmg7tz6lFriimcrL5SI5ryNXD/3fL7orUQvgYf5DA5MGamrrcHtm59Qd9oxOTMnPc9ENG8dwkGSbdZ20/vYSaaUhamirBQD17pJMO2l9zH5y5xkkBoMA+k8JZKRJbNLzzF8/wehK9mIPBMVpvVoXLqJa+GbN20gsWEQ+UNiT520P3gnmcI0m/gqevtBJkyTM3NSN3oJyqH+qIK3Er3+kUyNFPp18S9mwQowUXrM9thJAAqDdCQbR4HUzPOPZCXSdpKpvyXPrABT1meimGxZQuz4adYCkkfADQ2RhfCLI1ez6jDV1dZw80x76X2pvtIZj1soSHkd7bqTMkFay/sh5Jo9UTCJlK62Vm7y76jFYopWOsnNf3lIIFEmU8jSSJHNOHdoueqVCBVlpdz3uB6NC01taBFCSuc8VSO5+NTKAWk58irvz4+7Ki0xj5KilZZfbkh5bxQlcVjkVqLV0c6uKlkaycraKPf58bYkeH+rYRrpQ1I3bnPBGom6hyRadtP73LprK23Z8LYkIlFJIOncrSjRvprKpPyBsdfbXLNmpUoEHvR7greAtIieSgDNpk2aWeOs0EaP9WZ180LtnbfvpLwvPcGUZtMmM/S34vsqJNRWsfNEmGmTJTzn04ozu3lugsoNlpYFyY5ip4H1DkiS0wAOSI4Us3gckBwRIVEHJJUCCElJx6I2bXYKle3oQ2kGaedtStJDzR8qy8oCF6SRbJTSOAyk+fwfmJxsKy9zLWuTsxDhzQ8gbqAKFz2L0jKmjfdQ44k3lkrg8cAvLyuVtnf4O19ZzFNAShayigwDyVXFneWz/PKVZUDi1VbJ2jvUuxgPA2nFqJsZbd5kFs5rFV45rawCPV6VhZbwPynoZsKFV8MTT7yxhK+0EF7jjsGRVVtF8Y+CAT8fJMrJy7IiJMrUjNDcovIg8d6jzHZ4QhplVYuzvVXgzYyDiVOiuh6NC9VKO8mU8L+XNwRUZslw7DV3+m9SC0grBd7MMOlq5z/kyZlfxYH09p2p/XLlZaXUySCyNNK8MJDWJab262pruJWF8cQboTCZ2XzZ1dYqLaMdS2xTRhiuCAOJkgcxUijzoZ8uLQvtWDUDpnJCz5uRQvxMNYE0z72pRK3UeMpNGcEifICV0TDJ1EZEkFKHRWxHgsROxFnN94qyk3+9H3dyIzgjPnijYPrnDZ/00xMIyuFIBVOi55eyfojMLYlqVxXpwWc/eNXNnOyePKJ/JB4kFbRSV1srycRlp+6r7oDLFOJCCxkE0ob0BzBwrZvc/ft0aRnD9yeEBQp2gonwWW4d5R/lBYn5SdP5Xjkc2ZC+454dYEUdlh5PvME3wce4++ixEKDsAFMssU3Z8c87XZ5XRsLVSirMiM6MI76uafL+ejSOb4KPMXx/AgvhtYIWhNVhml0kbXbnBSnvmbZsfMnbfC9w3FWJ0S8/V2Zl3X30WNO5ILnirj2BxlNuVLuq3lcnxhLblPNf3+eBbt+8bqnKxt30Pvzffs97ZlvBgN+jGyQGUwhAT75rVDoQOZbYxoOfZ6QdxW41mBbCa5TDfb4LBvxDhZg2rkpTxbz91cx9QormjBCrmTlitcQ47wIuSMGAfxyZo7uPlMwZZOoU31eUlWKw14cb3Z2a/KZig4kyShHAKqW0iFqzzSVS9BBQEdLV1orArU+laKcsTCp3txC10RjlIipI3BdTTStlpdpVhcFeH77qv04Z/Sv43pXSBpNRtBGhiiNFcW3IILFE1LQVtVJWGk+5cfvmddy59SkuNJ813OS5a08ocUJkodqI5RO5ckzDvcd40duzlRfoam9VOmKpq615P4E/e5RoJEryFWwD0UJ4jVpTNkZ9TW74fyAVMA/gUr5rzngyK99qspNMYeftO0Si8fcHIGfyLGlNqQTVIdpN72P4/gRl4UwEA/4+6use0/g+RgDkzc5lj4uy2umS1a4qVLuq/pYPi2xmMuB2gAjItGwRte+IltfV1GkbDPjnAfzGu072cVEyxAoQxRLblKPZAeBOvg3agkFiMkQJfVU49NeB6K9C/ExSWnwj3SCx5NQE77pwZEOJMhMHoj+jNKKvN0KN1ArVSFmtxE0aPZiasbWJswpEGkzaajDgH9NzD10gMWK5ztheeh/3JkMORJKjNA2fwZDe++gea8PI5Tre69G40BJXByLtfhExSvuOBVPmgsSkj2LiRPeYORDRZHLmV4QjJD91S2u4LxQkFiKS3sDDqSeWr222EkQL4TU8XVomKwQ9DrZIjZQ1cdOUa61cjmoliCKbcUqxWlbuFGLShIGUY+K2KM636qUVVocoltjGvR/JzvVqMOAfEXFfISAxteijXJuN5KySFqg7WWMpiDTUrKdwyLlrekXTpi1P+odH+wAEqat8sNdnqcP6bAQRALRQKh+lgMRgGgPwBeVaK3Zd2ASiflZCDWVBYjCNA/iHA5M50ZkGxxogdITIdLYPyhA400xyfaav7/9gmzyTmRKaW9QK0YQREBmmkZhWciHTqXue+jsftXnR233ZIYQju6y6gphszIWoz6j3ZBhIemE643FjsNdnq0PxRPtDOhpADYXIcJD0wlReVoqBq93SZwapJrNLz8nt42ZCZApIemECgJbGBgxc6y567bSTTOHBz0/0DIE1BSLTQMqBaYwazeVqp97uTsvVgIt0qGeXnusZjGEaRKaClAMUOc900Hfq/bizaNIEkc04HkzN6G2TEp4nUg4kBlMfiBnwg3Kh+Sx8l9ttmxGPbMYRmlvUO8s8BcAnYhPWEiAxmJqRaQeud4AqGCAgk7fzae3+sDxIOX7TODgdvDygLracU2Y+k1ZZfrmB2aXnhZ6m8J1RiUZLgJQD1BAyBXK61ctxVyW62lpxseWc8lHeTjKFhfALLITXCm0VTyFTlCa9MF4JkBhMHqadLhX6Wi2NDfA2NcDbdFoZqHaSKSy/3MBCeE3UNLlpCKhstB1IIrVTrrhrT8DbdBqNHrep5m83vY/Y620sR14hshkXOYpwC8CQClpIaZByfCfNOSdqGqHu5AnU1dYc2utfCDSxxPb77wbMsMx2wI6pooWUB+lAZDcmwtxRAAMyw7GqP8yvDGOvt7Gb3tc8qaQAmUCmAzaq6melNEg5QHUwc3cJxSXKA2QpkA4ANVRIusAByAHpYIQ3hEz3il1S3FssalXSB7IlSAeg6kOmg8WqWmoCQEi1KKzoQDoQ6fUh02KjOlTTyGwPhayofWwN0iFQdeR8nZf8llaRqceat7rmKSqQ8oDVnPNVbyA0UWQOEZ6XsRPvgGQ+YM0AXAwsF/vfHYRfTeLP06az/06KbDh0QHKkKKXEeQSOOCA54oDkiL3k/xH7i8FYmXomAAAAAElFTkSuQmCC",resize:"iVBORw0KGgoAAAANSUhEUgAAAJMAAACSCAYAAABBufiwAAAACXBIWXMAAC4jAAAuIwF4pT92AAAO80lEQVR42u2dT0wbVx7Hv0WVMBzAVSAiBxNHIgKUSDHkFBIpGGmjOJc4XNJy2OAU9ZBDN7vySjl5XR9WWQltaVbqZZ3Y7IE2F3Av6yiVApEInIJBIsJRkfjjQxChqp0DMafswW9aLzUzb968efNsv6+EkJLxzHjeh9/v937v937z0YcPH6CkxEMN6hEoKZiUFExKtauP1SMAQpFxLwAvADcAX4VD3OR3vsL/zZHfy4lYOF/Pz/GjegrACTQ+8jNIADrJ+TIrADYBLBPQ6gaymoYpFBnXoNF+Wh26lS0C1hyAuUQsvKlgqg6AggScoA1Wh6f1SgFIJWLhZQWTfBZolPy0VtntbwGYIGBtKpicAchNrM9dAOdq5I/7BwDJRCycUjCJC6JHCUStqE1p1ipZTcF71cBEIIoCuFVHs+0CgWqiGqCSHibizqIA/iTiesfcLWhz/7/Ba3Y1Yr948Ltjt3d28b7Cv9sEVTQRC08omNhBitrhzppcjejsOI6eUx60EXg6TxxHs6uR6Xx7+QL2fnmH7Z1d7OUL2H7zFq83c3a5v7uyxlRSwhSKjA8CSPKa2je5GtHf04WeUx50njiOzo7jQr5HdiOH7Z1dZDdyyGTXeZ76OYBR2WZ/UsFEXNoEj7jomLsF/b1duNR3Vhg8RlpaW8fS2k9Yyq7zcI8FEktFFUyVrVHKikvTLNCVgfPSAKQH1nxmlYfFWgEQlMFKSQFTKDI+YSXAPuZuQdA/gP7e08xxj1Payxcwn3mFp4svrVirAomlknULE5nup8CYdOz2ehD0D6DnlKcm8gDzmVWkZhfwc/4d6ykmCVT5uoLJilurNYg4Q+WY23MEplBkfBRAgsWdjQSG0N/bhXpQanaB1f0VAAyKXkQWDlMoMp5kma1d9w8g6B9AvWm/eID4dJo1UA+JjKOEwsQCUrfXg7Hhq7/LStebshs5xGfSLK5PGFBCYGLNH30W8OPKhfNQ+s1KTf33GV4svzL70a9E5KNsh4mANGdmxnbM3YIvR4LS54qc0tLaOuIzabOx1GQiFh61875E7E5JmgGpr6cLsTu3FEg66u/twr3bN+HpaDfzsVtkrbM6LZPZGKleg2zBwbltMZRtMJkF6fMbV3Gp76wihEHx6bTZOMoWoGyBKRQZvwvga5pjm1yNuHf7pnJrFjWfWcXDmSdmPtLHOw/FHSayO2RGgSQ9UAUAPp6Z8gbOIPlIwK1AckCX+s7i8xtXaQ9vBZAis225YCI3lQTFWpsCSRqgzqGU/5POMk3QpAAUSNIBdYuslcoBE4mTqGZuIwG/AkkQUBd9Z6gNASkHchamMvdmqM8CfjX9F6ix4QD6eqgqLFppx9Buy0QVJ130nVHrbA4BRZkpv0xSOs7ARNzbdaPjPB3tGLk2pEbWATW7GjE2HEATXTlz1Iq7a7AAEpV7ayJfptpqs2tJnR3HMRLw2+7urHSOo9ocGfQPMAfc9x89tu2v9cuRoG2DN59ZxXzmlS3nvnf7JnNAvrS2TrOOdzkUGR9MxMJzQmAipvBvRsf19XRZipPs2BWrpSbsnkllN3IsdUe2x0+RbydpCuySKHXVE+LmojSDNnLNL9XDFJnjGhsOmJmaC4ufRgJUsetJltyTaZjIrhLDnFLQPyBVqa0TyVIZgerv7aJNF0yYXWphsUyGVsnT0S5VGsDJrLuMQI1c89PM7lpJXGwPTGQh97LhzQaGFEgSA9XmbqX9Y7cPJpqT95FuIwokuYG6cuE8jrlbDK2TmdiJGiYygzOMlWQJumVcUJYJqGZXI22JdJQ7TCj1kdTVRd8ZKYJumSsTZALqUt9ZGut0kqx0cIXJ0MUFh+TYDNBWoZWg0tGzbh6GhBom4jd1R6fb65FmAHM7b3H/0fcV+1A6LYbif9utE8XM7jrNmh2tZQpyIryugZINpPJgnAcDhjCRxJVuZcAxd4uU7W1kAWq/eID7jx5LCVLJOlHFcKOWYaIhUuY6JaeBKoH0vV3ddznFmK00WfFzRq6OC0xO9UuirNFBbuctHkylHAMpt/PW8FhPR7ujszzKMQwyw0Tj4vp6uhwJvLXpP23h/OvNHOLTaWlBunf7U0fTBpSB+KgVyzQoo1UqzyOZ2YnxYvmVEKBYQNKKB50Eqp/O1blthOm0YyCV/1XJApQZkErf5dPfVaE6BRTlWA7aApOno11oOa5eZtvM1h67gNrLF0yCdPPI5+cEUJQzcvMwEXN2TharRLNEYmYAeAO1ly8g8u1/TIFktNwjGqhmVyO6vR5bLJOhi+vxeqQBiWUAlrLr2MsXOA2EC23G61ym1w1FA0VhnY6Mm/Rg8nEyi8JAMjMA2nl5zUSbSfyjt0eNdQFaJFCUBsLH1TJ1e+UEiWYA7Koq0APK6jVFAWUlbtKDyat3ts4T7bZ/sdidP1oa8EoDYHd5SiWgeF1zbDggxDpR7AD2moVJ911vImqFeLig8v32ouqcDgM1diNQVc06KO61IkwfHzGTGxQx0KI0NhxAfDqN4NCAsEHVgMpu5Kru9RxtnxiO7WWWPJOjwTfPgXWir3izq7Eq3/PCOktvYAm+m1TfgJpWc5Px+FbyXkyWSTXrqm2xjm8Dy0xOSakSI0wwiUgLKDkrlvQAk5trdrnU0671uIlhjBvUY1PiJQWTkoJJScGkpGBSUlIwKSmYlBRMSgqmCtrU+1B2I6eeXI2LYjv7JheYlJTMwKSr7Z1d9ShrWKzjexRMui8Cfi9hEy0lftp/TzW+y7Qw5WvNOm3v7GI+syr8mnf+/i/h1xVhmRKxcJ4KJpqXsOz98q6qHs79R4/xcOaJsIHVrvm+eCD0ujxEsTH1udnUQMFpy8SjQVf5oAIQMrCHr8nruvvFAyFQbr8x3OKeNwvTstPpgaeLLy09vEqDajdQR11Tuy7rH6HWXcWuV4+ZTAssm4VpzuIFuYh14PUG1S6gjK4JlN6hZxYoM216BM3k5rhaJpFBuNmBpxlUO4BKPVswvOZ70iyV9tmJBMmEx1nmDpPITDjtwO8XDxCfTlOlL5pcjeg8wW+nDe3LlWmBEg0S5ZhuVZrJ6cKUiIU3AWzpnXVpbR0iZQSU+a5tfLeK03RCoQXKCZAAIGscvhwZ/jSwflCLm0S3RD4KKKdB4gmUUyAtra3TWHR7YCrdwE/C8yCHgTLbkNRqdxU7gXIKJBNjyQxTioZmJ6QBxdLZVkTTDbNAxafTpnpiOuTiVkj4Yx4mEmit6B2Tya471v3/4cwTRL6dZGqRLELNrkbE7tyiatKV23mLv/7z346BtLS2TvNWcV1PRVM1kJTR1WmieACOgHR4lifbe3oZxzBpFSZDV/d08aW0D8lpkKoBqP3iAc1LgrYSsfCyJZiIj1wxMtEyVhHIApLsQFEmbg2NCm1x3IShdVqQyzp1ez1SgSQzUJSeZYIXTCkYVBG8WH7Frac2H5BuSgeSppFrQ9I0TJvPrNLEnc/1ZnGmYCKzOkMzl3q2IMUDer2Zk7Z+SEtlyFKtmpqlGrMkzUFmasCjRgfIZJ1kLEhzMiFpIR1QSMTCfGEiZu55tVgn2YCSDSQAmEo/4xIrsVimqrNOsgAlI0iUsVLBNphIbbihdYpPP5HKvTgJlIwg7RcPMJWepbJKR5Wb8LBMVNbp9WbOsTU7mYCSEaRS0P2CZgJgyioxwURrnabSzxx/BbyTQMkK0vbOLn5cXOJulVgtE5V1+jn/DqnZF9JNzUUAJStIpRCE6oWNpq0ScMS7U2isUygyPgnglt5xPy4uob/ntHSvxng48wSX+s7aeo2RwJAt56V5e8DR7m2BFvC7Zq0SAHz04cMHphsLRca9KNWJ6xYHNbkaMf6XL6TNRteLshs5/CPxmObQlUQs7GO5BnN/JpJ3MnR374sHeDCVUqPp8OztwXfUYzDKeh1Lzb4SsfAEDCoKtNkdZdpeyQY9mErRLt98Y1RmYhtMZkj+YXah6ho41ILi02naDbNbNJ7GVpgIyX+mOXYqPat6OwnUfGaVpuhNU5Al6OZtmTR3Z5h7MrubVckaSA9nqFcivrLi3rjCpJENg5onDaj4dFq6hGYtaXtnl3a5BCjVKkV5XJcbTMREBmmOze28xf1H3yugbAKJps8CUYF2zERbJm2pJaSAqhqQBq3GSeViTlrqKRQZT8IgO67J09GOseGAelWrRS2trSM+kzZTwRmiLXpzFCYCVArAdZpj7dz7r4LtIwPuKO/7sPMNBaOgSGiWz/JUHsq8ptLPzII0aQdItlomYp3cKG0pPkf7mev+AQT9A4oSA2l9qDLZdbMgjdp1T7bCxApUt9eDL0eCanFYJ9B+MJWi2hovCiQhMLEC1eRqxNiNAPp7uxQ9ZXq6+BLf0eeQhIEkDCZWoADgDxf6EfRfrHsrtZcvID79hKUxrRCQhMJUBlSSdpanrFRJqdkFPF18ybJx8yu7gm3HYSqDKgnKPNThWGps+KqQZl0yKLuRQ3wmbTY2+vUx884jSQkTAWoUQILlsxd9ZxAcGqhZqLIbpfovxl7rWmZ7WfR9OwYTAcpH4qhWBZVliIBSXo/rEknVwFQWR6UAXGY9x0XfGVzqOyvdxgVazWdWMZ95ZfWtD98kYuG7Tn4Px2Eqg+ougK+tnMPT0Y4rF86jv/e09LO/vXwB85lXtNu0jdxakOZNXHUDU5nbm7BipTT19XShv7dLKrD28gUsra1jPrPKa0/dJBi3JdU8TIesVJQ1lqo0C+w55UEP+S1K+8UDZDdyyG5uI7uR47kpcwvAqAzWSHqYymKpCZYUAg1cnSfa0dlxHG3uVi6A7RcPsP1mF9s7u7/+tmFHbwGlbdtRGcdMWpjKoBokVuqy3dfq9paganO3oO0TfaO4/WYX+8UD7BeLoraBTwKI0rQDVDBJBJVkkh6iqoOpDqGqGoiqFqYyqLwEqiCvQF0CbaG0djkhywytLmA6FKgHUarsrFZrNQkglYiFq7opQ9XDVMFaBcmPzGAVUFpGShGI8rXw/GsKpgoWa5CANQjgpMO3tKIBJFt+SMHEDpeP/PbaCNgKgE2U+lfN1So8dQuTDmQ+AG4CmZv88yDFR/P47aXYm9pPNc2+FExK0qpBPQIlBZOSgkmpdvU/qa4Z7QH/pAsAAAAASUVORK5CYII=",remove:"iVBORw0KGgoAAAANSUhEUgAAAJIAAACSCAYAAACue5OOAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKi0lEQVR42u2d73XiOhPGH+fc7+atALYCvBXgrQBuBXArgK0AtoLlVgCpIKQCnApwKsBUgKlg3g+Czd1NgsaWbEv2POfoZHePNzHSL/NHGkkBEUEkMtWDdIFIQBIJSKJ26a/O90AQ9ABE17/Fnzw1AJB98O/J9WsGoqzT3diZYFsBE1+hia5wDC3/lFcA+RWwFEDaFcDaC1IQDK7g3Fq/oTe5XMFKAOzaCla7QAqCCMDsCs7Q0bc8AdgB2IIoFZDcsjyza+t79vatgcpfkILgBs+oJb/UrwDWV/eXC0jVB8wLT61PkZhqDWDtE1B+gPQG0AJA2KGs+hHAyocA3W2Q6gYoDIEo4j2bZcDpVFdP/HDdQrkLkoqBVpW4sNFIATMYvH0dDMp9rzwH0lSBlaZv7XKpwuWtQLQWkPhZ2NZqED0eA3GsGtfimCpNgSR5a/bAegWwAFHi1LgRkTsNWBFAxi0MiaZToqcnckaHA9F8TtTvk5XPCKwJ6Lkydq4AFBGQGneua/Dcg2o6VcCbfeaMgFhAUhAtCMhLd2a/T7RcEp3P5J3OZ6LNxoaVWnUXJKBHwM4IoM2GWqOnJ6LRyASmtElX558raxtAf2q/NwEqJyDqBkhAXMqVhSHRz5/UGZm5vFm7QQJmpYNoH2MgGzHUclk+q2slSCqoLu7G9nvqvA4HouGwDEzbdoEEbAt3wnzeTSt0T+Ws07YdIBWFKAz9mAtq0joVj522foNUFKLhkOh4FFg4sdN47BRM7sREXQ2oTTSfOwOTG9nZcilQmEwTOJDNVTVPxP9gbZ5crHNWvNi6nfV5JrtlJGoXR8IuQttsgNkMIktlK3FcpFzlm81SFHsgqWrGBNxtQAJR0zBdAES2ynht7v3fCkQNK4pUEV3Icggh1FYouANSECwAjAUiR2DasfkYIgjslO5aWsmX7MzvbC5uPmvjloNMpzK47i6p5Ka1TGbBdhCsACz1BnSofHevJ66nbk0mwPMz58lnEE3qz9pUqn/Qh3ShyibKbvcRmSnPVdzE24NXekrAJNjmBWnbrUDUpHq9IsH39jqNU5NFUpsXN9rn5nNgvXa3k9dr9Rtra8AWC7c/6/fvnCd/gGhVfdamivYzVlGay4uw06mt/WX+JBS8WvCcgEH1WRt3E6PLlY1VQOQDTMcjd01uWy1IyhrlXndmlRD58Pn5UwKD6tJ/TrofhupAhapT/e1W/Zyia1G8VNhc43G5cwZWq+rfbTDgZHGPIJrZj5G41qiuLUNmmwndbXVov7dulYqk//ozivp9tzMXkVIcq6N9GPaxinmkmRNmWWRHvLGacueVeCCpeaO+1hrJqn4brdLCHkhijbpslWZ2QFInqI3EGnXWKvURBBNzkDimTSDyV7yx04Kkn0cKgkwbH53P9ZeIpKm9dTLXrETd4s0r/e/eqbp/aSCKtBBNp83UGdV1qGhXrNKPHxyrtC3r2vR2bzKRgRD3pnFtQZDi3s6QMHTHvSSJuDJTC//6eu+JC4h6xV2bytaG3lijb9/8BMmVc85nM129UoggiD+roLzn2vS/KuLW2iPeWE7KxEj3QQpDAalNGgzUJg2NI7YPkiu+XVRnvDYsBpKKj/oCkoD0ARtxEYsUWfmhojZmkJZBkgnB9qnX48RJA3sgjUbS6W2V3kBERUAaiDUSkIoE3A9Fo/NfqaKoqyDdkjENSB88JBapQ+IZCQZIOrcmFklAYoIEAanjKpG5PXDnCX4pDKWjuzANUFDFLZLER6IPpgAepE9E731SrLVZApKoEpXL2kQiY5BksVZkJdgWiZggZXf/h69F9iLHQBKJxLWJBCRRfUpT3RO5OUhFz20U+Sf9pteUA9J9HHlXEYjEtSG3QKzIZ728WHFtet+l96Gi9ro1pmvj3HEqcVKXA+1CwfZJQBKQPhVRygXpPikyu91e6Y3EKzfYBtS16xIjiUViG5kHbjD1my4XcW/dzdhSeyCJe2uneGOa8EFSmdtFQBKQTC2SPk7i35Mq8kX6MX397Ijk8iBdLhJ0t0l5rjuM9C4T5UEC1OV7oq5Yo5IgqUmnk7g3AcnUIgHA/e9+Ool7a4tb01/R+nzvComHsgT+0notA+G7eCHKXaPCudQmx70rSOu6DFmnIPBzEF04sN3CpTacCsmtNnuTWMlfJQkHortuzQ5IgNwe6bN4oYnWUuhdm3Ib9y+3AYD9vtlduOLaiivLgC9fdE/dvcymiEUCAD22YpX8E2/MWJE41yL1oMoHQmetklikKqwRAHzhVM0+MD9s7rxV0h9X556aPP2ON1aPrNJrFNvXpjdxLy/NLZv4eEpKU7dLJQnw+GjNrV2NDfEbsCVljD9v/T7R+Uy163gkCkPSvp9Lbb+nRjQacd4vKcJGUZAGrA5aLpvpoJ8//YFoPm+mjzYb7jvG1YGkYFqzXuRwaKajplP3IZpOm+mb85lrtZOiXJQBqUdArn2Z0Yga09OTcrGuARSGymo2pfGY+66Dolzw0v/3qfYKwFL73HLZbCaXJO6UBEdRs1e37nbA339znvwXRIvCSFDZeYwgyKC7ZRIADgc5m7tpZZkag8tFP4sNDHTraqbp/5+asVNcOXSi+WkGPUQAsCgDkRlI6v73f7XPnU7qTnlRM1osOLXYAPACoq0BD1S+qcA7c3pKoMvip/p5mQDbPNj+PVaKAexZz242Yp3qUpoCX79yn/4OIqNSV3OQFExrAHPWs02Xm3QFojjmxkXPIDJOJ+2ApGDS1ywBaqEySSSTcwOiE4CobIBtK2t7lxtAt80bUB8wjmX3SRXKcxU68CBSY2YBIrsgqXIDnokUmKqzRLwMDQD++ejArOZd25uLmwHYsJ4VN9eEOwNKzl7X5dpulmnLml+6WaavX2Xrd70QPdqGyHweybR2SeaZ6ponurW0qvGuDqQyME2nzRTF+aj5vDhEQM9PkMrANBw2V8vkg45H1UcOQVQPSGVgarpux1U9PZUpJ64covpAKgPTrTjueBSAzuciRWm1Q1QvSGVh6rp12mzKbmrY1gVR/SApmGalylT7/eZ2XTShw4G72+Ojtq57XOsHScEUs+q+P3N3bQ7Gj0fTDQyzJsa0GZDetjalRjsx2mShzAHKCIiaGs/mQHorjFsb7cwYjVQ246v2extbqHZ1xkPugfQG1KS0q/tvDLVc+pHlnc8qgTDfMpUTsHBhDN0A6c067azsHxsO1UC5BNX5rDKwcmn8x5sYDctjbTb7q//m1QMTqJNP+la+33CoFjUnk/orM2/76na7IuUd2qVuACvT0ljrw+YcSAqmHoAFOJswy4AVRb8304NU81ytwmeZ+pqmnFuGyugRBluGugfSG1ADACsA08p/1nCogOr19PVRWfZ2zVg1wPypFwAz7llFApILQLmll6sbS5wfIi9A6h5QzwDWPgDkJ0i/AzW7tn5L4LlAnZC2dtmFtQuk91neDMDYY+uzM9ouLSBZz/Qm1zb2Ah4FUCtO2GgPSB9bqvjamj7y9hXqgiDVWgJPN0B6b62iK1QRgEGFcJ2g7n1Nr+CkbQSnmyB9DlgE4AbZbVbyv3++p1tGlV+hyW1uOBSQRJ3Ug3SBSEASCUiidun/DlECl01FAtQAAAAASUVORK5CYII=",itemAlert:"iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpkZmM5M2YyZi1hYzg1LTVlNGUtODE2Zi0yN2UzOTNjNTM0ZjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RTk1OEVGRDQyRUI0MTFFOEJGQzRCQjY0RDUzNERGMzYiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RTk1OEVGRDMyRUI0MTFFOEJGQzRCQjY0RDUzNERGMzYiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmFjYjg5M2U2LTllNTktYmY0ZS04MWVjLTM4NmQyOGQ1NjEwZiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpkZmM5M2YyZi1hYzg1LTVlNGUtODE2Zi0yN2UzOTNjNTM0ZjgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz53t8IQAAACGUlEQVR42qyVz0sbQRTH36YhblAJCtYKHqonBW3soWB78VCKCkppBCFeevBWKCiekj/AnIT0klsPXhQKLbQWtIgXDyp4UgNtQcSDP1APkhYxDZrt9zvOxkXdTUJ88GFmZ998Z/btvDeGZVniYnUgCvrBE/AI5MAe2AbzYBac3jmbwjcwQQycWsWNPnEQvKlj2Ds2DIMDj9GdAx2Sz0tucUly3+flYmVN8scnys/3sEH8L7olMNAvgVcvMeDjcBoMQmO3oOcIRTNYZXuxlZaziZhc/vwlXvagvU2qpxLi7+wQHaLnui0Im2AZPOMuz96NiZXNSilmmKZUp5JXuxdZBz3g3Kffj1FU7bQMUfWP4Ms5nEsNraV2XI92BzENZfpeu35+1fCQav99+uwaltDCV8Y8g8dWnz5SIYbAK6bB8fcKN+NcalCLmhTu5RP/fqXm0OijcBd7PFKVmkMjTOFG9uxzWok5NBr9/B8gUHTS4WFZi1CYM2qZUV67/hOJFhWjhrYjhuK3WgFp6rmDp2GFp8+1xgaFf7DH3PeymtQHhZc5NBZKThBz9K1qsx+nS0oQu1bEwCTT8i9iWU5K2/Wi9susXYziIGHXiiTY4gsWFDqWI8o5WjSttcQWPgcRcMAqxdX5acWMPvTVlW0fvNFatwp9C7rf7qPQ33U1BfV1cz9Xk8tlOsKCoi/TJj3OhNrkkQIzbpfpfwEGAB0OebpeExhfAAAAAElFTkSuQmCC",itemAlertDark:"iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpkZmM5M2YyZi1hYzg1LTVlNGUtODE2Zi0yN2UzOTNjNTM0ZjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RjQzNTRGRTYyRUI0MTFFODlFNDdCODEyNTEzMUI5NkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RjQzNTRGRTUyRUI0MTFFODlFNDdCODEyNTEzMUI5NkQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmFjYjg5M2U2LTllNTktYmY0ZS04MWVjLTM4NmQyOGQ1NjEwZiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpkZmM5M2YyZi1hYzg1LTVlNGUtODE2Zi0yN2UzOTNjNTM0ZjgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7DiQshAAACAklEQVR42qyVvS9DURjG3yuiDNLQwUcMNNKkidDFoB1qU4M/gIQJo1oQgsFnsGDEzMLCoDYkarDUx6KRxkBEaMQktdTz3JwrV7m3qp7kl3Puvec899xzz/u+WjqdFguVgU7QDhpBJXgHd+AG7IMt8PLjbBpnUAxGwUs6uzhmDJRk+mgZK64Fe6CB909OonJ0eCSxWEySyaQ+wOVyic/nk2BrUAIBv2iaxttXoAPcGkZm4xpwyjYej8viwpIkEgmxk9vtluGRIfF4PKK2qEW1n8bF4Bg0R6NRmZ6akVQqJb+Rw+GQiclx8fv9vDwDQfBWoJ4P0pQrzcWU4ljO4Vx6KC99xeVoE2idfb39lp8fag/pbWQ/Yrkt6xtr3PNXXhaoI+Xkj7Lb056ebh0rcS496EVPGrfxin8/X5k8QjT2sccjla9MHk00rmDPOKf5yORRUcgfC4qyTXp6es7pJTR+AKWMKLtVhwfCWc3oofTIrbhmj2FqJ6/Xq2Mnk8c5jQ/YY+zbidFF7GTyiBSq1DeLhOLkIbc6yzvbO1nzBpMSxADZMnLFKJhjWIYHBnMKaSNfrKwuG8loDMwbuWIZXPIBP5cDczHlHGV6pby+pM16Bg+o/mPavAetqrp8S/R1YPc/Ev1PpalElZt/LU2ZxbSLCUUV0yp1nwF1wSMFNq2K6YcAAwCfZ3CwpLDluwAAAABJRU5ErkJggg==",maskMoveShape:"iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAACXBIWXMAAC4jAAAuIwF4pT92AAAI3klEQVR42u2dvXMTRxjGH90w6jw2Yxq78dGYivgYqOxCR0WVQZmhSgqLSiXKX4D4C3J0uEIUScUMctIkFaeeDBJUoeHU2A1MpFGnRineUywJfZx0u3f77u4zo5E/5fPtT+8+7+67u4XRaARjdFbYAeAl+MkI1VEEg1TQDoSzghc3ths/7wAopXjFVvwcAohiSEILgnrvcD9+eCkbfF11YjjaAJqojnoWhGwb3wVQjh8lha6sA6AZQ9G2IMht/AqAIwb3tRtDEXDxGmqDcFYYN/5DxlG3BaCB6qhhQVgfgAqAOoADjfxYF0AjjhI9C8JyAOpxBNAJgFn1AQSqAaEGCHpGAFZA5AvCWcGPb8YRzFUXQA3VUdM8ECj/DwCcwmrSVFbyyjKcnDKByELwjUoA2rFP0jgiUBRoME8FtY0O2YBA4/9Nw8ygCDNZyco7OBlAUAPw3kKwtrYBvMFZIeAfEc4KDesFhHUVZZlpphwQyA+EhqeFotWJu4o2DxAsBLJ9gy8DBkcwBF6cGloI5PmGML7PioJAFxfGF2vFDAbHQmBhEOMRyBNEFgLensERAIGNBBpEhrRdQ5OtMdz3dYKhEb8pcwCBBotKLG/drgd8/5ae9dBR/KbMGAQqJOE7YngSTD/roVKa4WhnAwg8AC/Z3q5bFWAvDmR7JfpcHz2Jp/klZw3UD7XBdQKpuAP8FAHFCW877AO/usCwpwsMfQDeulPY60aEOjjPIp4E0xAA9LleXQSZR2ldA4WcJ2xvz74PHC6wNYenOmURY79QF981cO8SAOBRG9hdkul+7QCvPZ1gWKuLSBoReHcJt2vLIQDo+7drxnYRqyMCZQnv2d6OLZeiQTHB4OewT1FhEOkExA9Jyt2SRATeTuo4SAbB2Dgea2Ucqf0SjDo6CQxiie0t2PcBd82iafehbsbxAEAtbUTg/fbwG9n+nrqqrYoKzpJoUGFtEO/Vga0NL3/rgH5fL+NY28wsnhUitiBsucCPn9O/zm83dTKOfQDuokpoZ4k34BsN7jfUeh0GUcFZ2KdwlVu+mlRKq70SvZ4+qiQHgcYNeGYKxR3x6d9xQK+rSwZB3i9RROAbDdIYRHOMYyWZWTwr9MCxBnHXAx5JHAB9fQf42tYFhpuzcxDOnJSRZyGq7Klkvaaqa6u6Bp7OaLLqSJb0qmYqL+4aaOTpX5YGcbbqSJb0qma6M7kewmEfDU6CbCAAdKtmKi/qGnx2/8qyqiNZ0qeaaSEI/CJCXlPGekxVH01ORDmxP/DYZQtJqo6kparaVDP5sxGBV6zbcvMf5LlXp+vQDAReVZvHGRrEZcaRfxfBOCJsUnUkS/yrmY5mQeAz5axa9RD3aibaDxvO+AMWkjGplNqvsJ+UcscRgYfj2XKBu0/VvLa7TzkbR2YgqF4txLeayR+DoH7GILLqSJaYVzM5oAMy1ZWMqiOpaS27aqYSj65BRYOooXEsjF5A3fP+ZFcdyRK/aqbr15S+vGEP+OM+PxD41St4aoMwiHRbmay0WbSysiBYWRCsLAhWFgQrC4LVYl2zt0CAdj2afbwxZ9rmImSRBqs9sqiy3DJws0zPScrmBl3gMgQ+BCqOOl4vjF6gDdlnLqgw/n4R0iOtblWAu/V08x+XLeBdXcz1iFB1VLgGQP54qCoFJWlu/K5HNQciSuj3SnRexGULeFtRottwQOcxWa2KAo/ei19HsVeizUDzrWNoWRCS6H4D8CUeT1HcBh68yXOldc+CsErHQXZrK/2XecHQtiCs6g5uZ3wqgf8yj3USEYFQHYW21ecYw7zK4x40sy53+z8iAHQSudVYJzkuqct6D4Z4swxnkgorZLMNzyodnma1TqI1mT4CdJqrFUCDRSoom0G4tgVhnvZ9dSqmD0+z8ArhNAi0517XdgsV064nnI0INioAwJ6v1vXITSVbkzu1T4LQNBqC4o56C2nkgjDV3s5EGtEE7elvpm4ouAS0uC3TJywAwfSooOqydjmAdpbvxWxBMEWN2S9Mg0Ddg80e9FdzOQjWNJqg83nHBM8DITDy9nwxZpS9Me+L34JAtJwbB4KqK5gvQpGv1l10PPCidQ3mRQWxN1yMBsLtWn3RN+aDQDUKLeNg+KrYbPyl8GjQWA+EFfRoq38aal3PZ6G+fek/txgEE6NCpFDCNOyLvJ4uqqP6ZiCYGBUGEfDplRrX8lGoTVvZjstBoKhgVgbxrq5GNPggDITOMm+QNCIAdDRc36io8PF5/jCKS2cTnTCyGgQaVwiMiwp5ZRCXLZHdwqukVerJ9kcgo2FOpfOwR2sShxkHwkEX+FPY8rc+1jjeeZ2NMipmjSm0gd/97GAY9oG/yiK7hMpkBZI4EKj+/ZmFQcbf6dDfEbdvwvmioWQREcG8LmIMw2tPnmeIzkVD0N0kem+yh1IZppW0DSKC4e9n4qLDsA+Ej0V3B9Q+a3QJY12dDb2O6Pift4l/XoUDsETtY1TcAb6r0bmPmyyLG3SBTw0aJxA/4/kzqqONUo7NQCAYagB+gcka76O06y3fROOyRfUOF6HMYexXqI42NvSbg0AwNACcwoq05U7XPn5pZ1Xn0EF1lKrKNR0IBEOI+BQQq1zUAeBv4gvSmsV55tEuq89HfREQiAGBLsK3MPCFQFREsDDkB4GwwQdxezFbGNhCIBaEaRhatr2kGUNXNARisgabWmalFjYcNcwXBILBDjqJUarBovxBIBh80DK6bdueG+lxklIz9UEgGNwYhiPbronVjbuCTNbiZQPCFRB1AE9tG6/UcwB1WX4gfxAIBg+02MJGh/lRoLZuUQlPEKajQ816h/yigBogXHmHAMBDw9PCWlZeQE0QpjOLOsyaxcytG1AXBLOA6MZdQEOli1ILhGkgapp1GS0AgSoRgAcI0x6iBqp5OGDY+H3Q+EmQtwfgDcI0FOUYiDKDTOMcQFO18K8HCPOh8BWJFON3fhgD0ON2S3mC8G334ccPD9kMVHXjRm8DCFUP+2aAsNhsujOPnTUh6YIOvurFDR4BiHQ9A+s/810wc9nms20AAAAASUVORK5CYII=",maskMoveImage:"iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAYAAACKAxD9AAAACXBIWXMAAC4jAAAuIwF4pT92AAAI1ElEQVR42u2dP2gbZxjGn5yDiiHOGbtBaYodBYqHJsFXsqWDRQaDoRB1SuliebmxUSFjQhU6ZpGzVUvkzR5CZDqYdsllqLM09EySIaIQOa6THMEiig0GgXEHfUpk+2Tdne9035/3AREIPumk93fP977f32O7u7tQSUU7aQAY7PZ3puFYKv0ux2QDoWgnBwEY7JVi/w4CGA/4lnUANoAqe9kAbNNwqgQCX4FPAciwgKcBnO3RR7cAsQBYojuIkCAU7WSGBT3Tw8B7AcMCUAZQNg3nPYEQTfDTALIs+LoAt7woEhRcg8Da+yyAHEdPfhCnKAMomIZjEwj+2/28QE+/Vz0CkOcxn+AKhDYApiWv1lYYEGUCQU0AuHWIWEFgOUCOvXSoq0UAuTj7JmIDgVUBJYGTwCiSyoJpOHklQGAuUFCwGfCTP2R7XWFoMbiATRAcqnEA/xTtZF5KR2Bf7BeKs+9kMtOLDqnIQWBNQRnABMU1cO6Qibqy0CKGwGBNAUEQXDqAh0U7mRUSBDYwZFFVEJruFe1kSSgQGL0PFO8biELTUcEQeo7AILhHMYu8xEyHmURqBIGwJabFEnG+QCAIxIZBIwiEh6HMBQgEQeyaCCOBPFKyyPoJrCiqgzMnLgMAvjjxbey/dGOnjqfvirwDcfsoA1aBQWBtUzVMCBJ9Oi5/+StS+hQSfSe5+pUrtQVYr37iHYYZ03ACucNRmoZQnSClT+HHr//G2NA17iAAgLGha0iP3uUdhAJz6d6AULSTBQRfMOIKweS5EpcACAaDDqAcpJLQAkCQAXA9zOZAgCdNJBjOojnhJzoQGGmlMO/64imTeycQEIar7IGNzBHKYVcIF0+ZQtZsAsBQYpOCwwWBERbqcPJw/wUu3WBj+7kMMOhoTgkMD4QomgQA+IzTJqFaX4L16roMMHhuIrw6Qh6KDSlXavOywFDwUkVoHtzACLNKIBhiqSJyYThCAQpLEhhy3RJHrYsbpEHzDWWAQWfNe2BHyIMkCwzTh7mCRm6gFAz5II5AbiAfDNOdKgitgxukyA2khSHnxxHIDeSFwRsIzDoyFGppYdDdVk25OYJs+xYRDO4x7gpCjsIrPQxX95eSmkuSOE6hVQKGzGGOQLmBOjBkCQSCAQDG25sHbV+1QH0HasGQdnOENIUwPhhimrKXcQOBmoUYYUj06dw4gkGhixeGGKS3FsRobfkBlY1qwmAAwHFyg4MaSIx8XIQblrYar1CpLWBs6BpvXzcNoHRcxESxUltAtb6Eje1n2GysYSAxguH+C0jpU6H80GND13gMWFRKtTtCSoQ73th+jj9fTmOzsbbn/zcba9hsrKFaX8KTt3cweW4Ow/3nydq8aaI9WUyJ4AL3X1w5AMF+bTbWcP/FFVRqCxRijyrayZTWTgXPTrC8fsvXNcvrtzyvWCIhpYlwl4/Xb6KxU/d1TWOnjsfrNynEHisHjU1S5doNXm8tB7r29dYyuYI3DXLvCNX6UqzXq9Q0pPh2hGexXk8gcCK/uUHY16si7puG4f4LsV5PIBAIBAJXjZc+FXiINtGnI6VPUZRlACHRdzLwpA0RN+qi8vEQXTp9w/do4JkTl3Hp9A0u7p/jIeiW3muiIDt5bs6zzTc38JzjBoJKbZ6ahjCbiMlzJaRH72IgMeL6NwOJEaRH73Kzi6soEACfhqGFUWuuwMb28wPzEXgaehYJghYINgTUcP95bucciAZBq2l4D5LSEACwNQqd8hA0q4aoj5olCIRQteUIyo7MNE9mua4yBABQbVUNSp7fvP94nvTorIoQ7HGEquoQBFmEIgkEMA3nIwi2yhAEgUEWCAA8apWPSoHQ7bQ2LzBIBMHH2GvMGiyCwBsMkkGwFwSmFYLgcBgkhABoHtu4BwSLIOgMg6QQrJqGUwX2DjpZkPCAjqOe4FqpzePN1l9dl9qJ7AZ7HME0nDJB4C5JIXAHgWmRIFBK5U4glAkCZbRoGs57aUEgCPy7wQEQGCGLBIHiIIjsCgSBL821NwuuIJiGU4Jgw9IEwdHcoJMjABEc/0sQcKNVt66CTiAUCAJp5RpbVxBYt+McQSCd6p3cXsjj/giC4G6wP0nsCgJzhUcEgVRu0LHJ7zadPUsQyO8GXUHgKVcgCKJzAy+O0MoV6gSB0Mof5gaAh0WwpuFUi3ayAOCXOL7BxvZzVGrzoe+WrpBWTMPp2h3gaTW0aTh5dnro2V5/i+H+8/juqwcUzuDydI6nn7WPoSeOEk/44EWzXicmewaBveFs2CBsNf6jcCGSHWJX4aMvyO9q6Dz7gND0Qr4Job71Zms5ih1is90SxMAgsDcO9TS4p++KyrvCk7d3YmsSgjoCTMOxAfwc1h03dur44+U0GjsflITAenU98O7zh1QJvg96D7RRBitHQpvJtLH9DL//+71SW+o3dj5EsVaijoDncx3b3d0N9InsiEALIR8TODb0Ay6eMqU9k6mx8wGV2gKevvstiqrpG+bYvQOBwZBCc+1c6MeYJvp0fC4ZDK1DyCLSDJtdhp6DwGAwmDPoIMWl26bh5I/yBkcGgcGQBvCQ4hGL5kzDyR71TULZVY2VKjMUEzEhCA0EBkOJYBATglBBIBjEhSC0HIESyJ5qNkiHUU8doc0ZbNaxsUpxC71EzEXxxpE4QpszRNLppKDqADJR7nUVKQhtQJQATFM8A2mFQVCN8kN6sik3S2xmoPBWv0GTQgDpqCHomSO0OUMKzZU2ExTjrk1BtpfbGfUUhDYg8mjOpaOq4qAW4XNSibAgkDu4ahVALq5NzWIDoQ2IDJqLL84qDMFtdFmJJD0IijcXc2guPqnGfSPcgNDW75BTAAhuAOAShH1AZNCcNS1Lk1FHc8sargDgGgSXHCIL4KqgAKywpLgUZw4gPAj7XCLLXrx3Wa+yp78UdA4hgeC99MygObB1laMn3xIp+MKD4AJGmkFhsH97kWg+QnPirgXA4tn2lQGhQzNisNcgPs31N3xC0to6yEbzxFwbQFXEJ76b/geXEooCwBQ2IQAAAABJRU5ErkJggg==",warningOutlined:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TRZEWBzuIdMhQnSyIFXWUKhbBQmkrtOpgcukXNGlIUlwcBdeCgx+LVQcXZ10dXAVB8APE0clJ0UVK/F9SaBHjwXE/3t173L0DhGaVqWbPBKBqlpFOxMVcflXse4UfYQQRw4zETD2ZWczCc3zdw8fXuyjP8j735wgqBZMBPpF4jumGRbxBPL1p6Zz3iUOsLCnE58TjBl2Q+JHrsstvnEsOCzwzZGTT88QhYrHUxXIXs7KhEk8RRxRVo3wh57LCeYuzWq2z9j35CwMFbSXDdZphJLCEJFIQIaOOCqqwEKVVI8VEmvbjHv4Rx58il0yuChg5FlCDCsnxg//B727NYmzSTQrEgd4X2/4YBfp2gVbDtr+Pbbt1AvifgSut4681gdlP0hsdLXIEDG4DF9cdTd4DLneA4SddMiRH8tMUikXg/Yy+KQ8M3QIDa25v7X2cPgBZ6mr5Bjg4BMZKlL3u8e7+7t7+PdPu7wcF5XLiwo0hmwAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+YDHA8LOJEM5qAAAAOHSURBVHja7ZlLbAxxHMd/07KltNQjJUJESUMiUUIiJBJF4oJLJUjowTM4cFAHktZFBQdOHFSCAw4IlTg4iIhEEa9IvBpB69mgWBTtx2XEGr/ZndnXzM7ON9nDzv/3+n73v7//Y0RChAgRIkSIvIXhVWKgWERqzK8nDcP4llfKA+f5i+Z8I7+I/7EwX8hHgEeKAK1AUT4IsBV71AWdfDnQGUeAT8DwIAtwmMRoCir5yUC3AwG6gWlBI28AlxWy54Bm5flVwAiSAMsUkl1AJTAW+K6MLw0K+b7AM4Xg7hibPcp4G9AvCALsUMi9AQbE2JQArxS7hlwnPxKIKsRWKrarFLuvwOhcFuCkQuoWUKjYFgDXFfsTuUp+BtCjEJqVTh+/ki8AbihEjjvwPeF01vhZgDXJ/p/j9I3VuUK+1Kaj17uI0aD4vwUG5oIAe5XiX1jXdGAdUGd+1lrG+pk+Vuz1O3m7Xd0SxfYfKONLlTg/gMpcueaKu693IIDd+aHZr+Tn2pzsptrYxxXAtKmyOUHO9xv53sADpdBDcXwSCmDaNSlxHwMRPwmw2e3tjgsByoGPSvxNfiE/FPigFLglgZ8jAUzbOiV+JzDMDwIcVIp7kuiG16UAEeChkueA1+QnAb+UwhY48HUsgGm/0KbJTvFSgEtKURcd+roSwPS5oOS74sn1GbBYKeYnMDGDAow3N0NW1GSbfB/gqVLIPhcxXAtg+u1X8j43X7ZmTYBtShEdwCAXMTpifV34DbL4/sG2bJEfAXxRClifxR9gg5I/CozKRvJjSvL7QK8sClAI3FXqOJrpxNNtrqzmedCEZyt19AAzM3nNdU1JesrDZfi0Us9NoCATyWqVZN+BiiRiRYBdwEugHWhM5nADVNjcP9Smm3yJWawVjUnGa8xwrJdASToF0JK8BkqTjKeJ+SrJWP3NWWTFznSRH2MzzVakEFMruC3Nf88uYFymGk1LKo3GZkbtTLFBtygxT6dKvtpmqZmeYtyIKUJ7Kk3Q4RJdnVubDb9s0jzdbnq9TQfKgHeeHThSE2G7Uvd7YLBmbzc1dojIEMuzqIjcAeb4XIPbZq2xb6LKRKReRDZajbUXFhPMIL0lWOgWkSrDMO7FPtSWst0BJC8iUigijU5mQFREiiWY+GwYRmmiGXBGgouzTmZAkYgsF5GKgJFvFZEjhmF0SYgQIUKECBFCROQ3nMO7R8eI5nkAAAAASUVORK5CYII="}),this.side=null,this.design=null,this.editTextCallback=null,this.itemRemovedListeners=[],this.designItemRemovingListeners=[],this.itemChangedListeners=[],this.itemCreatedListeners=[],this.designItemChangedListeners=[],this.selectionChangedListeners=[],this.deselectionChangedListeners=[],this.imageLoadedListeners=[],this.textArtLoadedListeners=[],this.notifyMessageListeners=[],this.removeMessageListeners=[],this.gridImageSelectedListeners=[],this.shapeLoadedListeners=[],this.fillShapeRequestedListeners=[],this.undoChangedListeners=[],this.redoChangedListeners=[],this.bindedUndoStackChanged=this.onUndoStackChanged.bind(this),this.bindedRedoStackChanged=this.onRedoStackChanged.bind(this),this.areaAlertItems=[],this.areasSizeCountCollection=[],this.areasSizeLimit=52428800,this.panOrigin=null,this.preventViewMoving=!0,this.preventAreasAndIndexUpdate=!1,this.usedColorsItemsToCheck=null,this.touchEnabled=!1,this.isSafari=/^((?!chrome|android).)*safari/i.test(window.navigator.userAgent),this.customizedMessages=[],this.fontAscentCache={},this.originalBgImage=null,this.currentDesignOperation=null,this.undoStack=new Zakeke.Customizer.Stack,this.redoStack=new Zakeke.Customizer.Stack,this.setupUndoRedoStacks(),this.executingUndoRedo=!1,this.showDashedEdge=!1,this.DashedEdgeColor="black",this.showSelectedElementDimensions=!1,this.showUnselectedElementsDimensions=!1,this.showTotalSizeOfCurrentSide=!1,this.unitOfMeasurement="cm",this.RGB_HEX=/^#?(?:([\da-f]{3})[\da-f]?|([\da-f]{6})(?:[\da-f]{2})?)$/i,this.supportedBlendModes=["normal","multiply","screen","overlay","soft-light","hard-light","color-dodge","color-burn","darken","lighten","difference","exclusion","hue","saturation","luminosity","color","add","average","negation","lighter","darker","copy","xor"],window.imageEffectCache={},this.maskedImageSelectionMode=MaskedImageSelectionMode.Element,this.shapeImagePlaceholderIconPathd="M 15.2,12 A 3.2,3.2 0 0 1 12,15.2 3.2,3.2 0 0 1 8.8,12 3.2,3.2 0 0 1 12,8.8 3.2,3.2 0 0 1 15.2,12 ZM9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z",this.shapeImagePlaceholderIconFillerSize=8,this.selectedDesignItem=null,this.selectedPaperRootItem=null,this.areaLayersPaperLayer=null,this.areaLayerIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M 16 5.9375 L 15.625 6.0625 L 5.625 10.0625 L 3.3125 11 L 5.625 11.9375 L 9.53125 13.5 L 5.625 15.0625 L 3.3125 16 L 5.625 16.9375 L 9.53125 18.5 L 5.625 20.0625 L 3.3125 21 L 5.625 21.9375 L 15.625 25.9375 L 16 26.0625 L 16.375 25.9375 L 26.375 21.9375 L 28.6875 21 L 26.375 20.0625 L 22.46875 18.5 L 26.375 16.9375 L 28.6875 16 L 26.375 15.0625 L 22.46875 13.5 L 26.375 11.9375 L 28.6875 11 L 26.375 10.0625 L 16.375 6.0625 Z M 16 8.09375 L 23.28125 11 L 16 13.90625 L 8.71875 11 Z M 12.25 14.59375 L 15.625 15.9375 L 16 16.0625 L 16.375 15.9375 L 19.75 14.59375 L 23.28125 16 L 16 18.90625 L 8.71875 16 Z M 12.25 19.59375 L 15.625 20.9375 L 16 21.0625 L 16.375 20.9375 L 19.75 19.59375 L 23.28125 21 L 16 23.90625 L 8.71875 21 Z"/></svg>',this.areaLayerArrowIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M 4.21875 10.78125 L 2.78125 12.21875 L 15.28125 24.71875 L 16 25.40625 L 16.71875 24.71875 L 29.21875 12.21875 L 27.78125 10.78125 L 16 22.5625 Z"/></svg>',this.initialItemsInfo={},this},MPlaza.Customizer.prototype={debounce:function(t,e,i){var n;return function(){var r=this,a=arguments,s=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(r,a)},e),s&&t.apply(r,a)}},throttle:function(t,e){var i;return function(){var n=arguments;i||(t.apply(this,n),i=!0,setTimeout(function(){return i=!1},e))}},createCanvas:function(){return this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.canvasID),this.context=this.canvas.getContext("2d"),this.setupCanvas(),this.isViewer||(this.setupTouchEvents(),this.setupTool(),this.showSelectionBounds()),this.updateCanvasImageQuality(),this.canvas},updateCanvasImageQuality:function(){this.context.imageSmoothingQuality="high",this.context.imageSmoothingEnabled=!0},setupCanvas:function(){this.isViewer||$(this.canvas).mousewheel(function(t){});this.paper.setup(this.canvas),this.paper.Layer.inject({_selectChildren:!1}),this.paper.view.draw();var t=this;this.paper.view.onFrame=function(e){t.loadingCircles.forEach(function(t){t.rotate(3)})}},clearMemoryForIOS:function(){this.canvas.width=1,this.canvas.height=1},appendViewMatrix:function(t){var e=new this.paper.Matrix(t);this.paper.view.matrix.append(e)},translateView:function(t,e){var i=new this.paper.Matrix;i=i.translate(t,e),this.paper.view.matrix.append(i)},rotateView:function(t,e,i){var n=new this.paper.Matrix;n=null!=e&&null!=i?n.rotate(t,e,i):n.rotate(t),this.paper.view.matrix.append(n)},scaleView:function(t,e,i,n){var r=new this.paper.Matrix;r=null!=i&&null!=n?r.scale(t,e,i,n):r.scale(t,e),this.paper.view.matrix.append(r)},getIdentityMatrixValues:function(){return(new this.paper.Matrix).values},getTranslatedMatrixValues:function(t,e,i){var n=new this.paper.Matrix(t);return(n=n.translate(e,i)).values},getRotatedMatrixValues:function(t,e,i,n){var r=new this.paper.Matrix(t);return(r=null!=i&&null!=n?r.rotate(e,i,n):r.rotate(e)).values},getScaledMatrixValues:function(t,e,i,n,r){var a=new this.paper.Matrix(t);return(a=null!=n&&null!=r?a.scale(e,i,n,r):a.scale(e,i)).values},setupTouchEvents:function(){var t=this,e=new Hammer.Manager(this.canvas);e.add(new Hammer.Pan({threshold:5,pointers:0})),e.add(new Hammer.Tap({event:"doubletap",taps:2,threshold:100,posThreshold:1e3})),e.add(new Hammer.Pinch),e.on("panstart panmove panend pan",function(e){t.onPan(e)}),e.on("doubletap",function(e){t.onDoubleTap(e)}),e.on("pinchstart pinch",function(e){t.onPinch(e)})},setupTool:function(){this.tool=new this.paper.Tool;var t=this;this.tool.on({mousedown:function(e){t.onMouseDown(e)},mousemove:function(e){t.onMouseMove(e)},mouseup:function(e){t.onMouseUp(e)},keydown:function(e){t.onKeyDown(e)},keyup:function(e){t.onKeyUp(e)}}),this.tool.minDistance=1,this.tool.activate()},createDOMElement:function(){this.domElement=document.createElement("div"),this.domElement.setAttribute("id","mp-canvas-customizer-div_"+MPlaza.makeID(5)),this.domElement.appendChild(this.canvas),this.domElement.style.position="relative"},appendTo:function(t){t.appendChild(this.domElement),this.resize(t.offsetWidth,t.offsetHeight),this.resize(t.offsetWidth,t.offsetHeight),this.moveOriginToViewCenter(),this.isViewer||this.setupZoomControl();var e=this;$(window).resize(function(){e.resize(t.offsetWidth,t.offsetHeight),setTimeout(e.resize(t.offsetWidth,t.offsetHeight),200)}),$(window).on("orientationchange",function(){setTimeout(function(){t.offsetHeight,e.paper.view.center=new paper.Point(0,0),e.paper.view.update(!1),e.fitToScreen(!1,!0)},200)})},resize:function(t,e){t||(t=this.domElement.offsetWidth),e||(e=this.domElement.offsetHeight),this.isMobile||this.fitToScreen(!1,!0),this.paper.view.viewSize=[t,e],this.paper.view.zoom=this.paper.view.zoom,this.checkAllAlertItems()},moveOriginToViewCenter:function(){this.paper.view.center=new this.paper.Point(0,0)},setupZoomControl:function(){"mp-canvas-zoomControl"!=$("body").find("#mp-canvas-zoomControl").attr("id")&&$('<div id="mp-canvas-zoomControl" class="olControlZoom" unselectable="on">  <a class="olControlZoomOut olButton" id="mp-canvas-zoomout" href="#zoomOut"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAMAAADW3miqAAABklBMVEVkZGT///9kZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGSZMFejAAAAhXRSTlMAAAECBAUGBwgKCwwNDg8QERITFRYXGRocICEiIyQlJykqLC0uMDM1Njc5Oj0+QEFCRUhKTE1OT1BRUlNUVVZYWltdX2BiY2RnaWprbG9wcnN0dXd5ent8f4CCg4WGh4uMjo+RkpOUlZaXmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKzHueo5wAAAfZJREFUeAGF0PtTElEYxvGXTQVrUYmyC5WlGZpd0sKETLBE7VKkoFnSpSgrKlRAAkFY2Kf/u3fB4ZxDzfb9bWc+8+w7hw5z+oKJrdzej2TUr2sk5eCoWffF1SoOa3yecv8L9UVqkKonh/5G3jiszOJOJt/S2audaCABrv7+4bXhS/6ZtRy4wpiKXA+slZ93vdSsy/8SXPq0jI6MGmxSI9ROX7KG12Skr7P5NuKQ6n0KoOSX0DCAyh3+ENGJFE8lJDQPNDZ1FXVPAfg6KNAmD82RisiTAfLXBdoBtq8QkdY2GtHROHAQEagK89NZot7fIiLXAlB7LJAJ8yO/iVtBznnAeCZQBebWOaIedWmJlx4JlAayE52HH3sFlO8LtA5UFzrRqQKwOy7QNGCmBlVknYSULpDvwJpSkHZhFzCekECuZQD5SZLyvgGQ80lIO58FkA20iXYmCR5fJAlR1yS4cvxyi3jC3wE0NkhB5IqAMwtvo4Hb4XimBgu9uzkmI1ZzBqzqRq1ugjM+pE1jL6Qg6hr/YkL0a1EPAyjekxGnh1Kl1n/K27Eh6pkGtz+rIM45Ovt843UieuMkcX0r4CohTUUd6astJZCNCtoicq+0lC2i/hdNNWOLyNPc2g92k13Hm6oUJXsVs1CA7BuIoTjRQ/+pf/mWw/EHz+jJTaZSlbAAAAAASUVORK5CYII=">  </a>   <a class="olControlZoomIn olButton" id="mp-canvas-zoomin" href="#zoomIn">  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAMAAADW3miqAAABklBMVEVkZGT///9kZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGSZMFejAAAAhXRSTlMAAAECBAUGBwgKCwwNDg8QERITFRYXGRocICEiIyQlJykqLC0uMDM1Njc5Oj0+QEFCRUhKTE1OT1BRUlNUVVZYWltdX2BiY2RnaWprbG9wcnN0dXd5ent8f4CCg4WGh4uMjo+RkpOUlZaXmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKzHueo5wAAAftJREFUeAGF0PtXEk0cx/Ev+3DBp0Ulyi5UlmZodkkLEzLBErVLkYJmSZeirKhQAQkEYWE//N/N7nqYGeps799mz+t8ds7QUZ5gJL1d3P+RSYRUhYQcLDJzXVxr4Kj252nf31B/vAmhVmb4TxRIwUiv7OZLli5c7UWDabBa7x9eG7kUml0vglUel5H3gbHy826AzJyhl2DlTovovzGNmewodVOXjeF1EakbzHwbdQj1PQVQDQloBED9jnXodDrmtxNZNpUW0ALQ3lJl5JoG8HWIoy02NE8yIn8eKF3naBfYucIOShcpRP+ngMM4Rw3on84S9XV4RN5FoPmYIx36R/YmPgl5FgDtGUd16NvniNzy0jJbesRRDihM9l782Cugdp+jDaCx2ItOlYG9CY5mAD07JCPjSsiqHAUPjSkJKRf2AO0JceRdAVCaIqHAGwDFoICU8wUAhXCXKGcyYONLJCByToFVS122iD/2HUB7kyRE3jhYevltInw7lso3YaB3N8dFxNS8BqOW1mzpYGkfcrq2H5UQOSe+6OD9WlJjACr3RMRSo9mq9Z/aTnKY3DNgHcxJiOUZm3u++TqduHGSWP2rYNWjiox6UtcsZYO4itgi8q1ayhbRwAtTzdoi8ptbBxEX2XXcVNUE2aukgcJk32ASlUk3/aOBlVsOx29IL9WtgmuD+QAAAABJRU5ErkJggg==">   </a>   <a class="olControl3D olButton" id="mp-canvas-show3d" href="#show3d">  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ1SURBVHjapNZBiFZVFADg848zDTnhWItQx9oIYWiU2bgIyUVERdAiazMYldlOg0hIBwLpgzBHsGGIqGB0FxS5ys3gIBIUFAONLWoWQzWLSENplTqO/2nha3xv/t9G3s/ZXO6774N3zj333RDLxkEL5nznhD0eXfo0i4jbgLqMysU45fW6UAgjJSpN2VkXCkcK5E/zUhpzRz0oHJZmbLDNhJTOGqgHhbeKZDcMS+lHa+tB5RiyIJ22olMovKQpjXUOhf1SerZzKExK03o6h7a6Ig3dGlqp313FuGGVfv2lmXJ8JZ3WaId0O+CSlD62Rljtd39L6brPbV+y+mmpaWMr0/CZNOMDZ6VpK/VakCYc942UXq6s7/Wr9FordL/0mwEhTEnPCPOa1gsNL7gmbS43rePSJ63QKk/aVIy/lIaEq5o2FHPvSx9WoHeluf87PHa45II1elzVtLGYf/xGwUvQZofsvRVz0kXpL4PC3RXoYenCzfot12vHnDMrjVihrwI9Ip1vB73pkAfbYg0/SM8XOfoPekKavnEWVaE/pHdKr9/nFduK8T7pvSXJPiaNtTtqx6VPS9Bj0i/uEcIp6dWi/ANCj11Seqgd9IY0e7MKup2UfnbUGWnG6sUNecL3stgQbaBNUnqqsleHXZTmjbq30iL/GF/87BaoyxnpiyWJvlO/vpam7WstSbn8u6TLrb++24sy1OMnabJzKDwnpbc7h8JHUtOLnUPdJqVr1dLWgcI656Q0rCGEQfvrQWF9cQJOGPSAWelwPSj0GpPSFeeLK8ORelAIO01VrjAjdaEQdvu6RI3qqguFsMVu4741Z8GB5aF/BwBgaLXGzqeljgAAAABJRU5ErkJggg==">   </a> </div>').appendTo("#zoomPanel");this.setZoomControlPosition()},setZoomControlPosition:function(){var t=$("#"+this.canvasID).offset(),e=t.left,i=t.top,n=$("#"+this.canvasID).width(),r=$("#"+this.canvasID).height();$("#mp-canvas-zoomControl").width(),$("#mp-canvas-zoomControl").height()},setupMoveControl:function(){"mp-canvas-moveControl"!=$("body").find("#mp-canvas-moveControl").attr("id")&&$('<div id="mp-canvas-moveControl" class="olControlMove" style="position: absolute; z-index: 1003;" unselectable="on">     <div id="mp-canvas-moveVerticalControl" class="olControlMoveVertical">     <a class="olControlMoveUp olButton" id="mp-canvas-moveup" href="#moveUp">&#708;</a>     <a class="olControlMoveDown olButton" id="mp-canvas-movedown" href="#moveDown">&#709;</a>   </div>  <div id="mp-canvas-moveHorizontalControl" class="olControlMoveHorizontal">     <a class="olControlMoveLeft olButton" id="mp-canvas-moveleft" href="#moveLeft">&#706;</a>     <a class="olControlMoveRight olButton" id="mp-canvas-moveright" href="#moveRight">&#707;</a>   </div></div>').appendTo("body");var t=this;$("#mp-canvas-moveup").click(function(e){t.moveSelectionUp()}),$("#mp-canvas-movedown").click(function(e){t.moveSelectionDown()}),$("#mp-canvas-moveleft").click(function(e){t.moveSelectionLeft()}),$("#mp-canvas-moveright").click(function(e){t.moveSelectionRight()}),this.setMoveControlPosition()},setMoveControlPosition:function(){var t=$("#"+this.canvasID).offset(),e=t.left,i=t.top,n=($("#"+this.canvasID).width(),$("#"+this.canvasID).height()),r=($("#mp-canvas-moveControl").width(),e+10),a=i+n-$("#mp-canvas-moveControl").height()-100;$("#mp-canvas-moveControl").css({top:a,left:r,position:"absolute"})},setCustomizedMessages:function(t){var e=this;t.forEach(function(t){e.customizedMessages.push(t)})},setShowDashedEdge:function(t){this.showDashedEdge=t},setShowSelectedElementDimensions:function(t){this.showSelectedElementDimensions=t},setShowUnselectedElementsDimensions:function(t){this.showUnselectedElementsDimensions=t},setShowTotalSizeOfCurrentSide:function(t){this.showTotalSizeOfCurrentSide=t},setUnitOfMeasurement:function(t){this.unitOfMeasurement=t},setDashedEdgeColor:function(t){this.DashedEdgeColor=t},fireSelectionChangedEvent:function(t){for(var e=0;e<this.selectionChangedListeners.length;++e)this.selectionChangedListeners[e](t);var i=this.design.getSideDesignItems(this.side);if(i)for(e=0;e<i.length;e++){var n=this.findItemForDesignItem(i[e]);if(n&&n.data.selected){this.showAreaItems();break}}},fireDeselectionChangedEvent:function(t){for(var e=0;e<this.deselectionChangedListeners.length;++e)this.deselectionChangedListeners[e](t)},fireItemRemovedEvent:function(t){for(var e=0;e<this.itemRemovedListeners.length;++e)this.itemRemovedListeners[e](t)},fireDesignItemRemovingEvent:function(t,e){for(var i=0;i<this.designItemRemovingListeners.length;++i)this.designItemRemovingListeners[i](t,e)},fireItemChangedEvent:function(t){for(var e=0;e<this.itemChangedListeners.length;e++)this.itemChangedListeners[e](t)},fireDesignItemChangedEvent:function(t){for(var e=0;e<this.designItemChangedListeners.length;e++)this.designItemChangedListeners[e](t)},fireItemCreatedEvent:function(t){for(var e=0;e<this.itemCreatedListeners.length;e++)this.itemCreatedListeners[e](t)},fireImageLoadedEvent:function(t){for(var e=0;e<this.imageLoadedListeners.length;e++)this.imageLoadedListeners[e](t)},fireTextArtLoadedEvent:function(t){for(var e=0;e<this.textArtLoadedListeners.length;e++)this.textArtLoadedListeners[e](t)},fireShapeLoadedEvent:function(t){for(var e=0;e<this.shapeLoadedListeners.length;e++)this.shapeLoadedListeners[e](t)},fireGridImageSelectedEvent:function(t){for(var e=0;e<this.gridImageSelectedListeners.length;e++)this.gridImageSelectedListeners[e](t)},fireNotifyMessageEvent:function(t,e,i,n,r,a,s,o){for(var l=0;l<this.notifyMessageListeners.length;l++)this.notifyMessageListeners[l](t,e,i,n,r,a,s,o)},fireRemoveMessageEvent:function(t){for(var e=0;e<this.removeMessageListeners.length;e++)this.removeMessageListeners[e](t)},fireUndoChangedEvent:function(){for(var t=0;t<this.undoChangedListeners.length;t++)this.undoChangedListeners[t]()},fireRedoChangedEvent:function(){for(var t=0;t<this.redoChangedListeners.length;t++)this.redoChangedListeners[t]()},fireFillShapeRequestedEvent:function(t){for(var e=0;e<this.fillShapeRequestedListeners.length;e++)this.fillShapeRequestedListeners[e](t)},addSelectionChangedListener:function(t){this.selectionChangedListeners.push(t)},addDeselectionListener:function(t){this.deselectionChangedListeners.push(t)},addItemRemovedListener:function(t){this.itemRemovedListeners.push(t)},addDesignItemRemovingListener:function(t){this.designItemRemovingListeners.push(t)},addItemChangedListener:function(t){this.itemChangedListeners.push(t)},addItemCreatedListener:function(t){this.itemCreatedListeners.push(t)},addImageLoadedListener:function(t){this.imageLoadedListeners.push(t)},addTextArtLoadedListener:function(t){this.textArtLoadedListeners.push(t)},addShapeLoadedListener:function(t){this.shapeLoadedListeners.push(t)},addGridImageSelectedListener:function(t){this.gridImageSelectedListeners.push(t)},addNotifyMessageListeners:function(t){this.notifyMessageListeners.push(t)},addRemoveMessageListeners:function(t){this.removeMessageListeners.push(t)},addDesignItemChangedListener:function(t){this.designItemChangedListeners.push(t)},addUndoChangedListener:function(t){this.undoChangedListeners.push(t)},addRedoChangedListener:function(t){this.redoChangedListeners.push(t)},addFillShapeRequestedListener:function(t){this.fillShapeRequestedListeners.push(t)},getScreenPoint:function(t){var e=this.paper.view.projectToView(t),i=$("#"+this.canvasID).offset();return e.x+=i.left,e.y+=i.top,e},onMouseWheel:function(t){var e=this.getAllItemsBounds(),i=this.paper.project.view.bounds;if(!this.zooming&&null!=e){t.preventDefault();var n=new this.paper.Point(t.offsetX,t.offsetY),r=(n=this.paper.project.view.viewToProject(n)).subtract(this.paper.view.center);if(t.deltaY>0)this.paper.view.zoom<4&&(this.paper.view.zoom*=1.3,this.paper.view.center=this.paper.view.center.add(r.multiply((1.3-1)/1.3)));else if(t.deltaY<0){if(e.width<i.width&&e.height<i.height)return;this.paper.view.zoom/=1.3,this.paper.view.center=this.paper.view.center.subtract(r.multiply(1.3-1))}this.hitItem=null,this.updateSelectionState(),this.paper.project.view.update(),this.checkAllAlertItems(),this.checkImagesSizeLimit()}},windowToCanvas:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left*($(this.canvas).width()/i.width),y:e-i.top*($(this.canvas).height()/i.height)}},clearCanvas:function(){for(var t=0;t<this.paper.project.layers.length;t++){this.paper.project.layers[t].removeChildren()}this.paper.project.view.update()},getAllAreasBounds:function(){var t=this,e=null;return this.side&&this.side.get("areas").forEach(function(i){var n=t.findItemForArea(i);n&&(e=e?e.unite(n.bounds):n.bounds.clone())}),e},getAllItemsBounds:function(t){void 0===t&&(t=[]);for(var e=null,i=t.length>0?t:this.getAllItems(),n=0;n<i.length;n++)if(!i[n].data.isAreaLayer){var r=this.getItemBounds(i[n]);!r||isNaN(r.width)||isNaN(r.height)||(e=null==e?r.clone():e.unite(r))}return e},getAllItems:function(t,e){void 0===t&&(t=this.paper.project),void 0===e&&(e=this.masterGroup);var i=[],n=this;function r(t){if((!n.isItemGroup(t)||t==e)&&t.children)for(var a=t.children.length-1;a>=0;a--){var s=t.children[a];s.guide||i.push(s),r(s)}}for(var a=0,s=t.layers.length;a<s;a++){var o=t.layers[a];o.guide||r(o)}return i},getAllShapeItems:function(){for(var t=[],e=this.getAllItems(),i=0;i<e.length;i++){var n=e[i];(this.isFilledShape(n)||this.isShape(n))&&t.push(n)}return t},getAllShapeImagePlaceholders:function(){for(var t=[],e=this.getAllShapeItems(),i=0;i<e.length;i++){var n=e[i];!this.isFilledShape(n)&&this.isShape(n)&&n.data&&n.data.isImagePlaceholder&&t.push(n)}return t},getAllMaskedImages:function(){var t=this;return this.getAllItems().filter(function(e){return t.isMaskedImage(e)})},getAllFilledShapes:function(){var t=this;return this.getAllItems().filter(function(e){return t.isFilledShape(e)})},getAllSimpleImages:function(){var t=this;return this.getAllItems().filter(function(e){return e instanceof t.paper.Raster&&!t.isMaskedImage(e)&&!t.isFilledShape(e)})},getAllShapesAndMasks:function(){for(var t=[],e=this.getAllItems(),i=0;i<e.length;i++){var n=e[i];this.isShape(n)?t.push(n):this.isMaskedImage(n)&&t.push(this.getMaskedImageShapeItem(n))}return t},zoomIn:function(){var t=this;if(!(this.paper.view.zoom>=2)){this.preventViewMoving=!1;this.paper.view.zoom*=1.3,this.updateZoomIndicators(),this.updateSelectionState(),this.clampView(),this.checkAllAlertItems(),this.checkImagesSizeLimit(),this.placeHandleOut(),this.getAllShapeImagePlaceholders().forEach(function(e){return t.updateShapeImagePlaceholder(e)}),this.updateAreaLayerNamesSizes(),this.updateResizableProductTextZoom()}},zoomOut:function(){var t=this,e=this.getAllItemsBounds(),i=this.paper.project.view.bounds;if(!(e&&e.width<i.width-100&&e.height<i.height-100)){this.preventViewMoving=!1;this.paper.view.zoom/=1.3,this.updateZoomIndicators(),this.updateSelectionState(),this.clampView(),this.checkAllAlertItems(),this.checkImagesSizeLimit(),this.getAllShapeImagePlaceholders().forEach(function(e){return t.updateShapeImagePlaceholder(e)}),this.updateAreaLayerNamesSizes(),this.updateResizableProductTextZoom()}},setZoom:function(t){this.animatedZoom(this.paper.view.zoom,t/100,this.paper.view.center,this.paper.view.center,30),this.clampView(),this.checkAllAlertItems(),this.checkImagesSizeLimit(),this.updateAreaLayerNamesSizes(),this.updateResizableProductTextZoom()},zoomToBounds:function(t,e,i,n){var r=this;if(t&&0!=t.width&&0!=t.height){var a=!0;!1===i&&(a=!1);var s=t.clone(),o=1;e>0&&(o=1+e/100),s.width*=o,s.height*=o;var l=this.paper.view.bounds;if(s.width>l.width||s.height>l.height||n){var h=1,c=1;Math.abs(l.width)>1e-7&&(h=l.width/s.width),Math.abs(l.height)>1e-7&&(c=l.height/s.height);var u=Math.min(h,c),d=this.paper.view.zoom,f=this.paper.view.zoom*u,g=this.paper.view.center,p=t.center;a?this.animatedZoom(d,f,g,p,15):(this.paper.view.zoom=f,this.paper.view.center=p),this.preventViewMoving=!0,this.clampView(),this.checkAllAlertItems(),this.checkImagesSizeLimit(),this.updateZoomIndicators(),this.updateSelectionState(),this.getAllShapeImagePlaceholders().forEach(function(t){return r.updateShapeImagePlaceholder(t)}),this.updateResizableProductTextZoom(),this.paper.project.view.update()}}},updateRasterLayer:function(){var t=this.getAllItemsBounds();null==this.rasterLayer&&(this.rasterLayer=this.findItemByName("rasterLayer")),this.rasterLayer?(this.rasterLayer.removeChildren(),this.paper.project.view.update()):(this.rasterLayer=new this.paper.Layer,this.rasterLayer.name="rasterLayer",this.rasterLayer.insertAbove(this.itemsLayer),this.rasterLayer.guide=!0);var e=96;Math.max(t.width,t.height)>2e3&&(e=72),this.rasterLayer.activate();var i=this.paper.project.layers[0].rasterize(e,!1),n=this.paper.project.layers[1].rasterize(e,!1);this.rasterLayer.addChild(i),this.rasterLayer.addChild(n)},toDataURL:function(){return this.canvas.toDataURL()},getDesignDataUrl:function(){return this.itemsLayer.rasterize(96,!1).toDataURL()},showRasterLayer:function(){null==this.rasterLayer&&this.updateRasterLayer();for(var t=0;t<this.paper.project.layers.length;t++){var e=this.paper.project.layers[t];e!=this.rasterLayer&&(e.visible=!1)}this.rasterLayer.visible=!0,this.paper.project.view.update()},hideRasterLayer:function(){for(var t=0;t<this.paper.project.layers.length;t++){var e=this.paper.project.layers[t];e!=this.rasterLayer&&(e.visible=!0,e.activate())}this.rasterLayer.visible=!1,this.paper.project.view.update()},setImageScalingEnabled:function(t){this.isImageScalingEnabled=t},animatedZoom:function(t,e,i,n,r){if(!this.zooming){this.zooming=!0;var a=this;if(!(r<=0)){var s=(e-t)/r,o=n.subtract(i).clone();o=o.divide(r);var l=0,h=setInterval(function(){var t=l==r-1?e-a.paper.view.zoom:s,i=l==r-1?n.subtract(a.paper.view.center):o;a.paper.view.zoom+=t,a.paper.view.center=a.paper.view.center.add(i),a.updateZoomIndicators(),++l==r&&(clearInterval(h),a.zooming=!1,a.clampView(),a.checkAllAlertItems(),a.checkImagesSizeLimit(),a.updateSelectionState(),a.updateAreaLayerNamesSizes(),a.getAllShapeImagePlaceholders().forEach(function(t){return a.updateShapeImagePlaceholder(t)}))},30)}}},fitToScreen:function(t,e){var i=this.getAllItemsBounds();if(i){var n=this.fitToScreenMargin;if(this.imageItem&&this.isMobile){var r=i.width/this.imageItem.bounds.width,a=i.height/this.imageItem.bounds.height,s=Math.max(r,a);if(s>=.8)n=100*(Math.min(s,1)-.8)+20}this.zoomToBounds(i,n,t,e),this.paper.view.update()}},fitToScreenForPreview:function(){var t,e=null===(t=this.imageItem)||void 0===t?void 0:t.bounds,i=this.getAllAreasBounds(),n=this.getAllItemsBounds();if(i&&e&&(n=i.area>e.area?i:e),n){var r=this.fitToScreenMargin;if(this.isMobile){var a=n.width/this.imageItem.bounds.width,s=n.height/this.imageItem.bounds.height,o=Math.max(a,s);if(o>=.8)r=100*(Math.min(o,1)-.8)+20}this.zoomToBounds(n,r,!1,!0),this.paper.view.update()}},updateZoomIndicators:function(){},areAllItemsInView:function(){var t=this.getAllItemsBounds();return this.paper.project.view.bounds.contains(t)},setElementType:function(t){t!=MPlaza.CustomizerElementType.None&&t!=MPlaza.CustomizerElementType.Rectangle&&t!=MPlaza.CustomizerElementType.Oval&&t!=MPlaza.CustomizerElementType.Path&&t!=MPlaza.CustomizerElementType.Free&&t!=MPlaza.CustomizerElementType.Text&&t!=MPlaza.CustomizerElementType.TextArt||(this.elementType=t)},setSide:function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return this.removeAllAlertItems(),this.clearCanvas(),this.resetUndoRedo(),this.imageItem=null,this.resetAllDimensionLabels(),this.side=t,[4,new Promise(function(t){return e.updateImageItem(t)})];case 1:return i.sent(),this.masterGroup=new this.paper.Group,this.itemsLayer.addChild(this.masterGroup),this.areaLayersPaperLayer||(this.areaLayersPaperLayer=new this.paper.Layer({name:"areas-layer"}),this.areaLayersPaperLayer.bringToFront(),this.areaLayersPaperLayer.data.isAreaLayersLayer=!0),this.updateAreaItems(),[4,this.updateDesignItemsCanvasItems()];case 2:return i.sent(),[4,this.updateGrids()];case 3:return i.sent(),[4,this.restoreResizable()];case 4:return i.sent(),[2]}})})},setSide_old:function(t,e){this.removeAllAlertItems(),this.clearCanvas(),this.resetUndoRedo(),this.masterGroup=null,this.imageItem=null,this.side=t;var i=this;this.updateImageItem(function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return i.masterGroup=new this.paper.Group,this.itemsLayer.addChild(i.masterGroup),[4,i.rebuildItems()];case 1:return t.sent(),e&&e(),[2]}})})})},getCurrentModel:function(){var t=null;if(this.side&&this.side instanceof MPlaza.Side){var e=this.side.getParentModel();if(e&&e instanceof MPlaza.Color){var i=e.getParentModel();i&&i instanceof MPlaza.Model&&(t=i)}}return t||(t=this.model),t},refresh:_.debounce(function(t,e){var i=this;this.updateImageItem(function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,i.rebuildItems()];case 1:return n.sent(),t&&t.boundsToAreas?i.adaptZoomToSideAreas(!1):i.fitToScreen(!1,!0),e&&e(),[2]}})})})},100),rebuildItems:function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.masterGroup?Array.from(this.masterGroup.children).forEach(function(t){return t.remove()}):(this.masterGroup=new this.paper.Group,this.itemsLayer.addChild(this.masterGroup)),paper.project.activeLayer.children.filter(function(t){return t.isMaskPath}).forEach(function(t){return t.remove()}),this.updateAreaItems(),[4,this.updateDesignItemsCanvasItems()];case 1:return t.sent(),[4,this.updateGrids()];case 2:return t.sent(),[4,this.restoreResizable()];case 3:return t.sent(),[2]}})})},setDesign:function(t){this.deselectAll(),this.initialItemsInfo={},this.clearDesignItemsCanvasItems(),this.resetUndoRedo(),this.design=t,this.checkAllAlertItems(),this.checkImagesSizeLimit();this.isViewer},refreshDesign:function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.updateDesignItemsCanvasItems()];case 1:return t.sent(),[4,this.updateGrids()];case 2:return t.sent(),[2]}})})},setupImageLayer:function(){this.imageLayer||(this.imageLayer=new this.paper.Layer({name:"side-image-layer"}),this.imageLayer.sendToBack(),this.itemsLayer=new this.paper.Layer({name:"items-layer"}),this.itemsLayer.bringToFront(),this.itemsLayer.activate())},updateImageItem:function(t){if(!this.showSideImage||!this.side||!this.side.get("imageUrl"))return this.imageItem&&this.imageItem.remove(),void(t&&t());var e=null;this.design&&(e=this.design.getDesignSide(this.side));var i=this,n=function(t,e){i.imageItem&&i.imageItem.remove(),i.imageItem=t,i.imageLayer.addChild(t),i.paper.project.view.update(),i.fitToScreen(!1,!0),e()};if(this.side.get("colorable")&&e&&e.get("fillColor")){var r="#"+e.get("fillColor"),a=document.createElement("canvas");a.setAttribute("id","customizerOffscreen");var s=a.getContext("2d");a.width=i.imageWidth,a.height=i.imageHeight,this.domElement&&this.domElement.appendChild(a),Caman("#customizerOffscreen",this.side.get("imageUrl"),function(){this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.fillColor(r)}),this.render(function(){var e=s.getImageData(0,0,a.width,a.height),r=new i.paper.Raster({position:i.paper.view.center});r.setSize(new i.paper.Size(i.imageWidth,i.imageHeight)),r.setImageData(e,new i.paper.Point(0,0)),n(r,function(){i.domElement&&i.domElement.removeChild(a),t&&t()})})})}else{if(!i.imageLayer){i.imageLayer=new i.paper.Layer,i.imageLayer.name="side-image-layer",i.imageLayer.sendToBack();var o=new i.paper.Layer;i.itemsLayer=o,o.name="items-layer",o.bringToFront(),o.activate()}var l=new this.paper.Raster({crossOrigin:"anonymous",source:this.side.get("imageUrl"),position:new this.paper.Point(0,0)});l.onLoad=function(){n(l,function(){t&&t()})}}},updateAreaItems:function(){if(this.side&&this.side instanceof MPlaza.Side){var t=this.side.get("areas");if(t){for(var e=0;e<t.length;e++){var i=t.at(e);this.createItemForArea(i)}var n=[],r=[];for(e=0;e<t.length;e++){i=t.at(e);var a=this.paper.project.activeLayer.importJSON(i.get("path"));if(a instanceof this.paper.CompoundPath){for(var s=0;s<a.children.length;s++)n.push(a.children[s]);r.push(a)}else n.push(a)}n.forEach(function(t){t.data=void 0});var o=new this.paper.CompoundPath({children:n});o.data={isClippingArea:!0},this.masterGroup.addChild(o),o.sendToBack(),o.fillRule="nonzero",o.clipMask=!0,o.reorient(!1,!0),r.forEach(function(t){t.remove()})}}this.deselectAll(),this.paper.project.view.update()},createItemForArea:function(t){if(t&&t instanceof MPlaza.Area){var e=this.findItemForArea(t);e&&e.remove(),(e=this.paper.project.activeLayer.importJSON(t.get("path"))).data.guid=t.get("guid"),e.data.isArea=!0,e.data.selected=!0,this.masterGroup.addChild(e),this.isViewer&&(e.visible=!1),this.updateAreaItemColor(e),this.createAreaLayersItemsForArea(t,e)}},createAreaLayersItemsForArea:function(t,e){var i=this;this.getAllItems().filter(function(e){return e.data.connectedAreaGuid==t.get("guid")}).forEach(function(t){return t.remove()});var n=0;t.get("layers").each(function(r){var a=!i.isViewer,s=i.isViewer&&!i.isCartPreview,o=i.isViewer&&i.isCartPreview;if(!s&&(a&&r.get("isVisibleInCanvas")||o&&r.get("isVisibleInCart"))){var l=i.areaLayersPaperLayer.importJSON(r.get("json"));l.data.connectedAreaGuid=t.get("guid"),l.data.layerID=r.get("layerID"),l.data.isAreaLayer=!0,r.get("showLabel")&&a&&i.createAreaLayerName(t,e,r,l,n++)}}),this.updateAreaLayerNamesSizes()},createAreaLayerName:function(t,e,i,n,r){var a,s,o=this,l=this.getAreaLayerPaths(n);if(0!==l.length){var h=null!==(a=l[0].strokeColor.toCSS(!0))&&void 0!==a?a:"#000000",c=new this.paper.Group({onMouseEnter:function(){return o.paper.project.view.element.style.setProperty("cursor",""!=i.get("description")?"pointer":"default")},onMouseLeave:function(){return o.paper.project.view.element.style.setProperty("cursor",null)}});c.data.connectedAreaGuid=t.get("guid"),c.data.layerID=i.get("layerID"),c.data.isAreaLayerName=!0,c.data.isOpened=!1,c.data.layerIndex=r,this.areaLayersPaperLayer.addChild(c);var u=new this.paper.Point(0,0),d=new this.paper.PointText(new this.paper.Point(0,0));d.content=i.get("displayName"),d.fillColor=h,d.fontSize=16,d.position=u;var f=d.bounds.width;s=Math.max(150,f+70),c.data.tipWidth=s;var g=new this.paper.Path.Rectangle(new this.paper.Rectangle(0,0,s,26));g.position=u,g.isClipMask=!0;var p=new this.paper.Path.Rectangle(new this.paper.Rectangle(0,0,s,26));p.position=u,p.fillColor="#FFFFFF",p.strokeColor="#EEEEEE";var m=new this.paper.PointText(new this.paper.Point(0,20));m.content=this.simpleWordWrap(i.get("description"),s/7),m.fillColor="#555",m.visible=!1,m.justify="left",m.position=p.position.add(new this.paper.Point(0-s/2+m.bounds.width/2+10,15+m.bounds.height/2+10));var v=m.bounds.height,_=this.paper.project.activeLayer.importSVG(this.areaLayerIcon),y=_.children[1];if(y.position=new this.paper.Point(-s/2+20,0),y.scale(.7),y.fillColor=h,c.addChild(g),c.addChild(p),c.addChild(d),c.addChild(m),c.addChild(y),_.remove(),c.clipped=!0,""!=i.get("description")){var x=this.paper.project.activeLayer.importSVG(this.areaLayerArrowIcon),b=x.children[1];b.position=new this.paper.Point(s/2-20,0),b.scale(.4),b.fillColor=h,c.addChild(b),x.remove(),c.onClick=function(){var t=(c.data.isOpened?26:26+v+20)/o.paper.view.zoom/p.bounds.height;p.scale(new o.paper.Point(1,t),c.bounds.topCenter),g.scale(new o.paper.Point(1,t),c.bounds.topCenter),c.data.isOpened=!c.data.isOpened,m.visible=c.data.isOpened}}}},updateAreaLayerNamesSizes:function(t){var e=this;this.areaLayersPaperLayer.children.filter(function(t){return t.data.isAreaLayerName}).forEach(function(t){var i=t.data.layerIndex,n=t.data.tipWidth/e.paper.view.zoom/t.bounds.width,r=e.areaLayersPaperLayer.children.find(function(e){return e.data.layerID==t.data.layerID});if(t.scale(n,n),r){var a=e.getAreaLayerPaths(r);if(a.length>0){for(var s=new e.paper.Rectangle(a[0].bounds),o=0,l=a;o<l.length;o++){var h=l[o];s=s.unite(h.bounds)}var c=[s.bottomCenter,s.rightCenter,s.topCenter,s.leftCenter];t.position=c[i%c.length].add(new e.paper.Point(t.bounds.width/2*[0,1,0,-1][i%c.length],t.bounds.height/2*[1,0,-1,0][i%c.length]))}}})},getAreaLayerPaths:function(t){var e=this,i=[],n=function(t){if(t instanceof e.paper.CompoundPath&&t.strokeColor)i.push(t);else if(t.children)for(var r=0,a=t.children;r<a.length;r++){var s=a[r];n(s)}};return n(t),i},simpleWordWrap:function(t,e){var i=[],n=-1;function r(){t.length<=e?(i.push(" "==t[0]?t.slice(1):t),t=""):t.length&&function(){for(var a=0;a<t.length;a++)if(" "==t[a]&&(n=a),a>=e){(-1==n||" "==t[a])&&(n=a),n>0&&i.push(t.slice(" "==t[0]?1:0,n)),t=t.slice(" "==t[0]?n+1:n),n=-1;break}r()}()}return e=Math.round(e),r(),this.content=i.join("\n")},hideAreaItems:function(){if(this.showSideImage){for(var t=this.getAllAreaItems(),e=0;e<t.length;e++){t[e].visible=!1}this.updateSelectionState(),this.paper.project.view.update()}},showAreaItems:function(){for(var t=this.getAllAreaItems(),e=0;e<t.length;e++){var i=t[e];i.visible=!0,i.strokeWidth=2}this.updateSelectionState(),this.paper.project.view.update()},adaptZoomToSideAreas:function(t){void 0===t&&(t=!0);var e=this.getAllAreasBounds();this.zoomToBounds(e,this.fitToScreenMargin,t,!0),this.updateSelectionState(),this.paper.project.view.update()},updateAreaItemsColor:function(){for(var t=this.getAllAreaItems(),e=0;e<t.length;e++){var i=t[e];this.updateAreaItemColor(i)}this.paper.project.view.update()},updateAreaItemColor:function(t){t&&t.bounds&&(t.strokeColor=this.getContrastedColor(t.bounds))},getAllAreaItems:function(){var t=[];function e(i){if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=i.children[n];!r.guide&&r.data&&r.data.guid&&r.data.isArea&&t.push(r),e(r)}}for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=this.paper.project.layers[i];r.guide||e(r)}return t},getAreasIntersectingItem:function(t){var e=this,i=[];if(t&&t.data&&t.data.guid&&!t.data.isArea&&this.side&&this.side instanceof MPlaza.Side&&this.side.get("areas")){var n=t;t.realBounds&&(n=new this.paper.Path.Rectangle(t.realBounds));for(var r=0;r<this.side.get("areas").length;r++){var a=this.side.get("areas").at(r),s=this.findItemForArea(a);a&&s&&(s instanceof this.paper.CompoundPath&&s.children&&s.children.length>0?__spreadArray([],s.children,!0):[s]).some(function(i){return n.bounds.intersects(i.bounds)&&(!t.data.isImageForBackground&&!t.data.isAreaForBackground||a.get("guid")===t.data.areaGuid)&&(!t.data.isGridImage||t.data.isGridImage&&e.design.get("areasGrids")&&e.design.get("areasGrids").find(function(t){return t.get("sideID")==e.side.id&&t.get("areaID")==a.id}))})&&i.push(a)}t.realBounds&&n.remove()}return i},getAreasContainingItem:function(t){var e=this,i=[];if(t&&t.data&&t.data.guid&&!t.data.isArea&&this.side&&this.side instanceof MPlaza.Side&&this.side.get("areas")){var n=t;t.realBounds&&(n=new this.paper.Path.Rectangle(t.realBounds));for(var r=0;r<this.side.get("areas").length;r++){var a=this.side.get("areas").at(r),s=this.findItemForArea(a);a&&s&&(s instanceof this.paper.CompoundPath&&s.children&&s.children.length>0?__spreadArray([],s.children,!0):[s]).some(function(i){return!n.bounds.intersects(i.bounds)&&i.bounds.contains(n.bounds)&&i.contains(n.position)&&(!t.data.isImageForBackground&&!t.data.isAreaForBackground||a.get("guid")===t.data.areaGuid)&&(!t.data.isGridImage||t.data.isGridImage&&e.design.get("areasGrids")&&e.design.get("areasGrids").find(function(t){return t.get("sideID")==e.side.id&&t.get("areaID")==a.id}))})&&i.push(a)}t.realBounds&&n.remove()}return i},getAreasIntersectingOrContainingItem:function(t){var e=this,i=[];if(t&&t.data&&t.data.guid&&!t.data.isArea&&this.side&&this.side instanceof MPlaza.Side&&this.side.get("areas")){var n=t;t.realBounds&&(n=new this.paper.Path.Rectangle(t.realBounds));for(var r=0;r<this.side.get("areas").length;r++){var a=this.side.get("areas").at(r),s=this.findItemForArea(a);a&&s&&(s instanceof this.paper.CompoundPath&&s.children&&s.children.length>0?__spreadArray([],s.children,!0):[s]).some(function(i){return(n.bounds.intersects(i.bounds)||n.bounds.contains(i.bounds)||i.bounds.contains(n.bounds)||i.contains(n.position))&&(!t.data.isImageForBackground&&!t.data.isAreaForBackground||a.get("guid")===t.data.areaGuid)&&(!t.data.isGridImage||t.data.isGridImage&&e.design.get("areasGrids")&&e.design.get("areasGrids").find(function(t){return t.get("sideID")==e.side.id&&t.get("areaID")==a.id}))})&&i.push(a)}t.realBounds&&n.remove()}return i},getItemArea:function(t){var e=this.getAreasIntersectingOrContainingItem(t);return e.length>1||0==e.length?null:e[0]},clearDesignItemsCanvasItems:function(){var t=this;function e(i){if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=i.children[n];e(r),r.data&&r.data.maskPath&&r.data.maskPath.remove(),t.removeProfanityCheckInvalidOverlayAndEdgeForItem(r),(!r.guide&&r.data&&r.data.guid&&!r.data.isArea||r.data.isDashedEdge)&&r.remove()}}t.removeAllAlertItems();for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=this.paper.project.layers[i];r.guide||e(r)}},updateDesignItemsCanvasItems:function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:if(this.clearDesignItemsCanvasItems(),!(this.side&&this.side instanceof MPlaza.Side&&this.design&&this.design instanceof MPlaza.Design))return[3,4];if(!(t=this.design.getSideDesignItems(this.side).sort(function(t,e){return t.get("index")>e.get("index")})))return[3,4];e=0,n.label=1;case 1:return e<t.length?(i=t[e],[4,this.createItemForDesignItem(i)]):[3,4];case 2:n.sent().data.selected=!1,n.label=3;case 3:return e++,[3,1];case 4:return this.deselectAll(),this.paper.project.view.update(),[2]}})})},createItemForDesignItem:function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,a,s,o,l,h,c,u,d;return __generator(this,function(f){switch(f.label){case 0:return e=null,t&&t instanceof MPlaza.DesignItem?((e=this.findItemForDesignItem(t))&&(e.remove(),e.data.maskPath&&e.data.maskPath.remove(),e.data.maskAlertPath&&e.data.maskAlertPath.remove(),this.removeDashedEdgeForItem(e),this.removeProfanityCheckInvalidOverlayAndEdgeForItem(e)),[4,this.getOrCreateItemFromDesignItem(t)]):[3,2];case 1:if(e=f.sent(),(i=this.getMaskedImageRasterItem(e))&&i instanceof this.paper.Raster&&!(i.data&&i.data.originalBounds&&i.data.originalMatrix)&&(i.data.originalBounds=new this.paper.Rectangle(0,0,i.width,i.height),i.data.originalMatrix=i.matrix.clone()),e.data&&(e.data.isImageForBackground||e.data.isAreaForBackground)?(n=this.findItemByGuid(e.data.areaGuid))&&((r=this.getOrCreateBackgroundGroupItem(n)).addChild(e),this.masterGroup.addChild(r),r.sendToBack()):(this.masterGroup.addChild(e),this.updateShapeImagePlaceholder(e)),this.getItemIsTextArea(e)&&e.children){for(a=[],s=[],o=0,l=e.children;o<l.length;o++)(u=l[o])instanceof this.paper.PointText&&(""==u.content||""==u.content)?s.push(u):a.push(u);for(h=0,c=s;h<c.length;h++)(u=c[h]).remove();s.length>0&&(e.children=a,this.onItemUpdated(e))}d=t.get("constraints"),this.isViewer&&d&&!d.get("isPrintable")&&(e.visible=d.get("keepInPreview")),e instanceof this.paper.Raster?this.getAllItems().find(function(t){return t==e})&&(this.paper.project.view.update(),this.createMaskForItem(e),this.createDashedEdgeForItem(e),this.createProfanityCheckInvalidOverlayAndEdgeForItem(e),this.checkAlertItems(e),this.fireItemCreatedEvent(e),this.fireImageLoadedEvent(e)):(this.createMaskForItem(e),this.createDashedEdgeForItem(e),this.createProfanityCheckInvalidOverlayAndEdgeForItem(e),this.checkAlertItems(e),this.fireItemCreatedEvent(e)),f.label=2;case 2:return[2,e]}})})},findAreaByGuid:function(t){return this.side&&this.side instanceof MPlaza.Side&&this.side.get("areas")?this.side.get("areas").getArea(t):null},findItemByGuid:function(t,e){void 0===e&&(e=null),e=e||this.paper;for(var i=t.toUpperCase(),n=function(t,e){if(t.data.guid&&t.data.guid.toUpperCase()==e)return t;if(t.children)for(var i=t.children.length-1;i>=0;i--){var r=t.children[i],a=n(r,e);if(a)return a}},r=0;r<e.project.layers.length;r++){var a=e.project.layers[r];if(!a.guide){var s=n(a,i);if(s)return s}}return null},getChildrens:function(t){var e=[],i=function(t){if(e=__spreadArray(__spreadArray([],e,!0),[t],!1),t.children)for(var n=0,r=t.children;n<r.length;n++){var a=r[n];i(a)}};return i(t),e},removeItemByGuid:function(t){var e=this.findItemByGuid(t);e.remove(),this.onItemRemoved(e)},findItemForArea:function(t){return t&&t instanceof MPlaza.Area?this.findItemByGuid(t.get("guid")):null},findDesignItemByGuid:function(t){var e=null;return this.design&&(e=this.design.get("designItems").getDesignItemByGuid(t)),e},findDesignItemForItem:function(t){return t&&t.data&&t.data.guid?this.findDesignItemByGuid(t.data.guid):null},getPaperItemFromDesignItem:function(t){var e=JSON.parse(t.get("json"));return this.paper.project.importJSON(e)},findItemForDesignItem:function(t){if(t&&t instanceof MPlaza.DesignItem)return this.findItemByGuid(t.get("itemGuid"))},snapDeltaToAngle:function(t,e){var i=180/Math.PI*e,n=t.angle;n=Math.round(n/i)*i;var r=t.clone();return r.angle=n,r},onItemsCreated:function(t){for(var e=0;e<t.length;e++)this.onItemCreated(t[e],null)},onItemCreated:function(t,e){var i=this.createDesignItem(t,e);return this.updateItemsIndexes(),this.checkAllAlertItems(),this.isViewer||this.checkImagesSizeLimit(),this.registerItemOperation("create",i.get("itemGuid"),null,i.clone()),i},onTextArtItemCreated:function(t,e){var i=this.createTextArtDesignItem(t,e);return this.updateItemsIndexes(),this.checkAllAlertItems(),this.isViewer||this.checkImagesSizeLimit(),this.registerItemOperation("create",i.get("itemGuid"),null,i.clone()),i},onShapeItemCreated:function(t,e,i){var n=this.createShapeDesignItem(t,e,i);return this.updateItemsIndexes(),this.checkAllAlertItems(),this.updateShapeImagePlaceholder(t),this.isViewer||this.checkImagesSizeLimit(),this.registerItemOperation("create",n.get("itemGuid"),null,n.clone()),n},onItemsUpdated:function(t){for(var e=0;e<t.length;e++)this.onItemUpdated(t[e])},onItemUpdated:function(t){var e=this.getItemRealBounds(t);t.realBounds=e;var i=null,n=null,r=this.findDesignItemForItem(t);r&&(i=r.clone()),this.checkAlertItems(t),this.checkImagesSizeLimit(),this.updateTransformsData(t),this.updateDesignItem(t),this.updateDesignItemAreasAndIndex(t),this.fireItemChangedEvent(t),this.updateShapeImagePlaceholder(t),(r=this.findDesignItemForItem(t))&&(n=r.clone()),i&&n&&this.registerItemOperation("update",t.data.guid,i,n)},onImageItemUpdated:function(t,e,i){var n=this.findDesignItemByGuid(t.data.guid);if(n){var r=n.clone();this.updateImageDesignItem(t,n,e,i),this.checkAlertItems(t),this.checkImagesSizeLimit(),this.updateTransformsData(t),this.updateDesignItem(t),this.fireItemChangedEvent(t);var a=(n=this.findDesignItemByGuid(t.data.guid)).clone();r&&a&&this.registerItemOperation("update",t.data.guid,r,a)}},onTextArtItemUpdated:function(t,e){var i=this.findDesignItemByGuid(t.data.guid);if(i){var n=i.clone();this.updateTextArtDesignItem(t,i,e),this.fireItemChangedEvent(t),this.updateTransformsData(t);var r=(i=this.findDesignItemByGuid(t.data.guid)).clone();n&&r&&this.registerItemOperation("update",t.data.guid,n,r)}},onShapeItemUpdated:function(t,e,i){var n=this.findDesignItemByGuid(t.data.guid);if(n){var r=n.clone();this.updateShapeDesignItem(t,n,e,i),this.fireItemChangedEvent(t),this.updateTransformsData(t),this.updateShapeImagePlaceholder(t);var a=(n=this.findDesignItemByGuid(t.data.guid)).clone();r&&a&&this.registerItemOperation("update",t.data.guid,r,a)}},onDesignItemChanged:function(t){var e=this.findDesignItemForItem(t);e&&this.fireDesignItemChangedEvent(e)},onItemsRemoved:function(t){for(var e=0;e<t.length;e++)this.onItemRemoved(t[e])},onItemRemoved:function(t){var e=this.findDesignItemByGuid(t.data.guid);this._onItemRemovedInternal(t),e&&this.registerItemOperation("delete",t.data.guid,e.clone(),null)},_onItemRemovedInternal:function(t){if(this.removeAlertItems(t),this.checkImagesSizeLimit(),this.removeTextOnPathGuide(t),this.removeTextOnPathHandles(t),this.removeTextAreaGuide(t),this.removeTextAreaHandles(t),this.removeDesignItem(t),this.findDesignItemByGuid(t.data.guid))throw console.trace("Item removed, but the design item is still present.",t,this.findDesignItemByGuid(t.data.guid)),"There was an error during item deletion";this.fireItemRemovedEvent(t),t.data.isProfanityCheckInvalid=!1,t.data.maskPath&&t.data.maskPath.remove(),t.data.maskAlertPath&&t.data.maskAlertPath.remove(),this.removeDashedEdgeForItem(t),this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t)},getSerializedPaperItem:function(t){var e=this.getMaskedImageGuideRasterItem(t),i=null,n=this.getMaskedImageGuideShapeItem(t),r=null;e&&(i=e.id,e.remove()),n&&(r=n.id,n.remove());var a={json:t.exportJSON({asString:!0}),svg:t.exportSVG({asString:!0,embedImages:!1})};if(e){var s=this.createMaskedImageGuideRaster(t);s&&i&&(s._id=i)}if(n){var o=this.createMaskedImageGuideShape(t);o&&r&&(o._id=r)}return a},createDesignItem:function(t,e){if(t&&!t.guide){var i=null;if(t.data.guid&&(i=this.findDesignItemByGuid(t.data.guid)),null==i&&(i=new MPlaza.DesignItem,t.data.guid=i.get("itemGuid"),this.design.get("designItems").add(i)),null!=i){i.set("index",t.index);var n=this.getSerializedPaperItem(t);if(i.set("json",n.json),i.set("svg",n.svg),e&&e instanceof MPlaza.Image){if(i.set("imageID",e.get("imageID")),i.set("imageType",e.get("type")),i.set("imageFormat",e.get("format")),i.set("imageWidth",e.get("width")),i.set("imageHeight",e.get("height")),i.set("imageDpiX",e.get("dpiX")),i.set("imageDpiY",e.get("dpiY")),i.set("imageUserID",e.get("userID")),i.set("imageVisitorID",e.get("visitorID")),i.set("imageVisitorCode",e.get("visitorCode")),i.set("imagePrice",e.get("price")),i.set("applyImagePriceForQuantity",e.get("applyPriceForQuantity")),i.set("providerImageID",e.get("providerImageID")),i.set("imageIsMulticolor",e.get("isMulticolor")),i.set("imagePreferredWidth",e.get("preferredWidth")),i.set("imagePreferredHeight",e.get("preferredHeight")),i.set("imageFileSize",e.get("imageFileSize")),i.set("imageCustomerID",e.get("customerID")),i.set("imageCustomerCode",e.get("customerCode")),"Vector"==e.get("type")&&e.get("colors")&&e.get("colors").length>0)for(var r=0;r<e.get("colors").length;r++)i.get("itemColors").push(e.get("colors").at(r).get("code"))}else this.updateDesignItemDistinctColors(i,t);if(!this.preventAreasAndIndexUpdate){var a=this.getAreasIntersectingOrContainingItem(t);i.updateAreas(a)}}return i}return null},createTextArtDesignItem:function(t,e){if(t&&!t.guide&&e){var i=null;if(t.data.guid&&(i=this.findDesignItemByGuid(t.data.guid)),null==i&&(i=new MPlaza.DesignItem,t.data.guid=i.get("itemGuid"),this.design.get("designItems").add(i)),null!=i){i.set("index",t.index);var n=this.getSerializedPaperItem(t);i.set("json",n.json),i.set("svg",n.svg);var r=new MPlaza.DesignItemTextArt;r.set("text",e.text),r.set("fontFamilyID",e.fontFamilyID),r.set("fontFaceID",e.fontFaceID),r.set("textArtTypeID",e.textArtTypeID);var a=new MPlaza.TextArtConfig(e.config);if(r.set("config",a),i.set("textArt",r),!this.preventAreasAndIndexUpdate){var s=this.getAreasIntersectingOrContainingItem(t);i.updateAreas(s)}}return i}return null},createShapeDesignItem:function(t,e,i){if(t&&!t.guide&&i&&e&&e instanceof MPlaza.Shape){var n=null;if(t.data.guid&&(n=this.findDesignItemByGuid(t.data.guid)),null==n&&(n=new MPlaza.DesignItem,t.data.guid=n.get("itemGuid"),this.design.get("designItems").add(n)),null!=n){n.set("index",t.index);var r=this.getSerializedPaperItem(t);n.set("json",r.json),n.set("svg",r.svg);var a=new MPlaza.DesignItemShape;if(a.set("shapeID",e.get("shapeID")),a.set("isMask",!1),n.set("shape",a),!this.preventAreasAndIndexUpdate){var s=this.getAreasIntersectingOrContainingItem(t);n.updateAreas(s)}}return n}return null},updateTransformsData:function(t){if(t&&t.data&&(t.data.guid||t.data.isTextOnPath||t.data.isTextArea)&&!t.data.isArea){var e=null;if(t.data.transformsData&&t.data.transformsData.dimensions&&!t.data.needsTransformsDataUpdate)e=t.data.transformsData.dimensions;else{var i=t.clone();i.visible=!1,i.rotate(0-i.rotation);var n=new this.paper.Path.Rectangle(this.getItemBounds(i));n.visible=!1,e={width:n.bounds.width,height:n.bounds.height},n.remove(),i.remove()}t.data.transformsData={position:{x:t.position.x,y:t.position.y},rotation:t.rotation,dimensions:e}}},updateDesignItem:function(t){if(t&&t.data&&t.data.guid&&!t.data.isArea){var e=this.findDesignItemByGuid(t.data.guid);if(e){var i=t.visible;t.visible=!0,e.set("index",t.index);var n=this.getSerializedPaperItem(t);e.set("json",n.json),e.set("svg",n.svg),t.visible=i,this.updateDesignItemDistinctColors(e,t)}}},updateDesignItemDistinctColors:function(t,e){var i=[],n=this.getMaskedImageRasterItem(e),r=this.getMaskedImageShapeItem(),a=t.get("colorMappings");if(a&&a.length>0){for(var s=0;s<a.length;s++){var o=a.at(s);o.get("dest")&&-1===i.indexOf(o.get("dest"))&&i.push(o.get("dest"))}this.updateDesignItemColors(t,i)}else if(!n&&!r||n&&r){var l=e;if(r?l=r:(e.data.isTextOnPath||e.data.isTextArea)&&(l=null,e.children.length>0&&(l=e.children[0])),l){var h=null;l.strokeWidth>0&&l.strokeColor&&(h=l.strokeColor.toCSS(!0),i.push(h));var c=null;!l.fillColor||h&&l.fillColor==h||(c=l.fillColor,i.push(l.fillColor.toCSS(!0)));var u=null;!l.shadowColor||!l.shadowBlur||!l.shadowOffset.x&&!l.shadowOffset.y||h&&l.shadowColor==h||c&&l.shadowColor==c||(u=l.shadowColor,i.push(u.toCSS(!0)))}this.updateDesignItemColors(t,i)}},updateDesignItemAreasAndIndex:function(t){if(t&&t.data&&t.data.guid&&!t.data.isArea&&!this.preventAreasAndIndexUpdate){var e=this.findDesignItemByGuid(t.data.guid);if(e){var i=this.getAreasIntersectingOrContainingItem(t);e.updateAreas(i);for(var n=this.design.getSideDesignItems(this.side),r=0;r<n.length;r++){var a=n[r],s=this.findItemForDesignItem(a);if(s){var o=a.clone();a.set("index",s.index),this.registerItemOperation("update",s.data.guid,o,a.clone())}}}}},updateDesignItemColors:function(t,e){for(;t.get("itemColors").length>0;)t.get("itemColors").pop();for(var i=0,n=e;i<n.length;i++){var r=n[i];t.get("itemColors").push(r)}},updateDesignItemColorMappings:function(t,e){if(t&&t instanceof MPlaza.DesignItem&&(t.set("colorMappings",new MPlaza.ColorMappings),e))for(var i=0;i<e.length;i++){var n=new MPlaza.ColorMapping(e[i]);t.get("colorMappings").add(n)}},updateImageDesignItem:function(t,e,i,n){if(this.canEditItem(t)){var r=this.getMaskedImageRasterItem(t);if(t&&!t.guide&&r&&r instanceof this.paper.Raster&&e&&e instanceof MPlaza.DesignItem&&i&&i instanceof MPlaza.Image){var a=this.getSerializedPaperItem(t);for(e.set("json",a.json),e.set("svg",a.svg),e.set("imageID",i.get("imageID")),e.set("imageType",i.get("type")),e.set("imageFormat",i.get("format")),e.set("imageWidth",i.get("width")),e.set("imageHeight",i.get("height")),e.set("imageDpiX",i.get("dpiX")),e.set("imageDpiY",i.get("dpiY")),e.set("imageUserID",i.get("userID")),e.set("imageVisitorID",i.get("visitorID")),e.set("imageVisitorCode",i.get("visitorCode")),e.set("imagePrice",i.get("price")),e.set("imageIsMulticolor",i.get("isMulticolor")),e.set("imagePreferredWidth",i.get("preferredWidth")),e.set("imagePreferredHeight",i.get("preferredHeight")),e.set("imageFileSize",i.get("imageFileSize")),e.set("imageCustomerID",i.get("customerID")),e.set("imageCustomerCode",i.get("customerCode")),e.set("isChanged",!0);e.get("itemColors").length>0;)e.get("itemColors").pop();if("Vector"==i.get("type")&&i.get("colors")&&i.get("colors").length>0)for(var s=0;s<i.get("colors").length;s++)e.get("itemColors").push(i.get("colors").at(s).get("code"));if(e.unset("shape"),n&&n instanceof MPlaza.Shape&&-1!==n.get("shapeID")&&void 0!==n.get("shapeID")){var o=new MPlaza.DesignItemShape;o.set("itemID",e.getDesignItemID()),o.set("shapeID",n.get("shapeID")),o.set("isMask",!0),e.set("shape",o)}if(!this.preventAreasAndIndexUpdate){var l=this.getAreasIntersectingOrContainingItem(t);e.updateAreas(l)}}}},updateTextArtDesignItem:function(t,e,i){if(this.canEditItem(t)&&t&&!t.guide&&(t instanceof this.paper.CompoundPath||t instanceof this.paper.Path)&&t.data&&t.data.isTextArt&&e&&e instanceof MPlaza.DesignItem&&e.isTextArt()&&i){var n=this.getSerializedPaperItem(t);e.set("json",n.json),e.set("svg",n.svg);var r=e.get("textArt");if(r){r.set("text",i.text),r.set("fontFamilyID",i.fontFamilyID),r.set("fontFaceID",i.fontFaceID),r.set("textArtTypeID",i.textArtTypeID);var a=new MPlaza.TextArtConfig(i.config);r.set("config",a)}if(!this.preventAreasAndIndexUpdate){var s=this.getAreasIntersectingOrContainingItem(t);e.updateAreas(s)}}},updateShapeDesignItem:function(t,e,i,n){if(this.canEditItem(t)&&t&&!t.guide&&(t instanceof this.paper.CompoundPath||t instanceof this.paper.Path)&&t.data&&t.data.isShape&&i&&i instanceof MPlaza.Shape&&e&&e instanceof MPlaza.DesignItem){var r=this.getSerializedPaperItem(t);e.set("json",r.json),e.set("svg",r.svg);var a=e.get("shape");if(a&&(a.set("shapeID",i.get("shapeID")),a.set("isMask",!1)),!this.preventAreasAndIndexUpdate){var s=this.getAreasIntersectingOrContainingItem(t);e.updateAreas(s)}for(n&&n instanceof MPlaza.Image?(e.set("imageID",n.get("imageID")),e.set("imageType",n.get("type")),e.set("imageFormat",n.get("format")),e.set("imageWidth",n.get("width")),e.set("imageHeight",n.get("height")),e.set("imageDpiX",n.get("dpiX")),e.set("imageDpiY",n.get("dpiY")),e.set("imageUserID",n.get("userID")),e.set("imageVisitorID",n.get("visitorID")),e.set("imageVisitorCode",n.get("visitorCode")),e.set("imagePrice",n.get("price")),e.set("imageIsMulticolor",n.get("isMulticolor")),e.set("imagePreferredWidth",n.get("preferredWidth")),e.set("imagePreferredHeight",n.get("preferredHeight")),e.set("imageFileSize",n.get("imageFileSize")),e.set("isChanged",!0)):(e.unset("imageID"),e.unset("imageType"),e.unset("imageFormat"),e.unset("imageWidth"),e.unset("imageHeight"),e.unset("imageDpiX"),e.unset("imageDpiY"),e.unset("imageUserID"),e.unset("imageVisitorID"),e.unset("imageVisitorCode"),e.unset("imagePrice"),e.unset("imageIsMulticolor"),e.unset("imagePreferredWidth"),e.unset("imagePreferredHeight"),e.unset("imageFileSize"),e.unset("isChanged"));e.get("itemColors").length>0;)e.get("itemColors").pop();if(n&&n.get("ImageID")>0&&"Vector"==n.get("type")&&n.get("colors")&&n.get("colors").length>0)for(var o=0;o<n.get("colors").length;o++)e.get("itemColors").push(n.get("colors").at(o).get("code"))}},removeDesignItem:function(t){if(t&&t.data&&t.data.guid&&!t.data.isArea){var e=this.findDesignItemByGuid(t.data.guid);e&&this.design.get("designItems").remove(e)}},checkImagesSizeLimit:function(t){var e=this;if(null==t||isNaN(t)||t<=0?t=this.areasSizeLimit:this.areasSizeLimit=t,this.removeSizeLimitAlert(),null!=this.side){var i=this.side.collection.models,n=this.getAllImageItems();i&&n&&(this.side.get("areas").forEach(function(t){var i=e.areasSizeCountCollection.findIndex(function(i){return i.sideID==e.side.get("sideID")&&i.areaID==t.get("areaID")});-1==i?e.areasSizeCountCollection.push({sideID:e.side.get("sideID"),areaID:t.get("areaID"),sizeCount:0}):e.areasSizeCountCollection[i].sideID==e.side.get("sideID")&&(e.areasSizeCountCollection[i].sizeCount=0)}),n.forEach(function(t){var i=e.findDesignItemForItem(t);i&&e.getAreasIntersectingOrContainingItem(t).forEach(function(t){var n=e.areasSizeCountCollection.findIndex(function(i){return i.sideID==e.side.get("sideID")&&i.areaID==t.get("areaID")});e.areasSizeCountCollection[n].sizeCount+=i.get("imageFileSize")})}),this.areasSizeCountCollection.filter(function(t){return t.sideID==e.side.get("sideID")}).forEach(function(i){e.side.get("areas").models.forEach(function(n){if(n.get("areaID")==i.areaID&&i.sizeCount>t){var r=StringHelper.format(T._("Total size of uploaded pictures must be less than {0} MB per each print-area","Customizer"),(parseInt(t)/1024/1024).toFixed(2)),a=e.customizedMessages.find(function(t){return t.EventID==MPlaza.EventMessages.UploadLimit});if(a&&(r=StringHelper.format(T._d(a.Description)),!1===a.Visible))return;var s=e.findItemForArea(n);s&&e.fireNotifyMessageEvent(n.get("guid"),2,T._("Warning!","Customizer"),r,!a||a.Closeable,function(){return e.zoomToBounds(s.bounds,e.fitToScreenMargin,!0,!0)},null,null)}})}))}},removeSizeLimitAlert:function(){this.areaAlertItems.forEach(function(t){t.icon.remove(),t.tooltip.remove()}),this.areaAlertItems=[]},checkAlertItems:function(t){if(t&&(!t.data||!t.data.isImageForBackground&&!t.data.isAreaForBackground)&&(!t.data||!t.data.isTextArt&&!t.data.isTextOnPath)){this.removeAlertItems(t);var e=[],i=this,n=this.getAreasIntersectingOrContainingItem(t),r=i.customizedMessages.filter(function(t){return t.Visible}).find(function(t){return t.EventID==MPlaza.EventMessages.ItemsClippedWarning});r&&!this.isViewer&&(n.length>0?n.forEach(function(n){var a=i.findItemForArea(n),s=new i.paper.Path.Rectangle(t.bounds);a&&a.intersects(s)&&e.push(r),s.remove()}):e.push(r));for(var a=1,s=1,o=0;o<n.length;o++){var l=n[o];if(!this.checkItemQualityForArea(t,l)){var h,c=this.getMaskedImageRasterItem(t);if(!c)return;if((h=this.findDesignItemForItem(t))&&h.attributes&&"svg"==h.attributes.imageFormat.toLowerCase())break;var u=h.get("constraints");if(u&&!u.get("isPrintable"))break;var d=this.side.get("ppcm"),f=300,g=this.getSelectedPrintType(l);if(g){var p=g.get("dpi");f=g instanceof MPlaza.PartPrintType&&p&&p>0?p:(g=this.getModelPrintType(this.design.getSelectedPrintTypeForArea(l))).get("dpi")||g.get("printTypeDPI"),"PrintfulPrintType"==g.get("name")&&f>120&&(f*=.75)}else console.warn("Can't determinate the print type DPI");if(a=c.bounds.width/d/2.54*f,s=c.bounds.height/d/2.54*f,_=i.customizedMessages.find(function(t){return t.EventID==MPlaza.EventMessages.DPIWarning})){if(!1===_.Visible&&(h.get("imageCustomerCode")||h.get("imageVisitorCode")||h.get("imageVisitorID")>0||h.get("imageCustomerID")>0)&&!this.model.get("providerID"))break;if(!1===_.EnableCheckForSellerImages&&!h.get("imageCustomerCode")&&!h.get("imageVisitorCode")&&h.get("imageVisitorID")<=0&&h.get("imageCustomerID")<=0)break;e.push(__assign(__assign({},_),{Description:StringHelper.format(T._d(_.Description),a.toFixed(0),s.toFixed(0))}))}else e.push(__assign(__assign({},_),{Description:StringHelper.format(T._("We strongly suggest file with a higher resolution to get better results.<br/>(at least {0} x {1} pixels)","Customizer"),a.toFixed(0),s.toFixed(0))}));break}}if(e.length>0)if(h=this.findDesignItemForItem(t)){for(var m=0,v=e;m<v.length;m++){var _=v[m];this.fireNotifyMessageEvent(h.get("itemGuid"),2,T._("Warning!","Customizer"),T._d(_.Description),!_.Closeable||_.Closeable,this.zoomToItem(t),null,{requiredWidth:a,requiredHeight:s})}return{itemGuid:h.get("itemGuid"),customizedMessages:e}}}},zoomToItem:function(t){var e=this;return function(){t&&(e.zoomToBounds(t.bounds,e.fitToScreenMargin,!0,!0),e.selectItems([t]))}},checkAllAlertItems:function(){for(var t=[],e=this.getAllItems(),i=0;i<e.length;i++){var n=e[i];if(n&&n.data&&n.data.guid&&!n.data.isArea&&!n.guide){var r=this.checkAlertItems(n);r&&t.push(r)}}return t},drawRealBounds:function(t){if(this.realRect&&this.realRect.remove(),this.getMaskedImageRasterItem(t)){var e=this.getItemRealBounds(t);this.realRect=new this.paper.Path.Rectangle(e),this.realRect.strokeColor="red",this.realRect.strokeWidth=1}},getItemRealBounds:function(t){if(!this.getMaskedImageRasterItem(t))return t.bounds;var e=t.bounds,i=t.rasterize(72);try{var n,r,a=i.position.x-i.width/2,s=i.position.y-i.height/2,o=i.width,l=i.height,h=i.getImageData().data,c=new Uint32Array(h.buffer),u=o,d=l,f=0,g=0;for(r=0;r<l;r++){for(n=0;n<o;n++)c[n+r*o]>0&&n<u&&(u=n);for(n=o;n>=0;n--)c[n+r*o]>0&&n>f&&(f=n)}for(n=0;n<o;n++){for(r=0;r<l;r++)c[n+r*o]>0&&r<d&&(d=r);for(r=l;r>=0;r--)c[n+r*o]>0&&r>g&&(g=r)}e=new this.paper.Rectangle(a+u,s+d,f-u,g-d)}catch(t){Logger.info(t.message)}finally{i.remove()}return e},createAlertIcon:function(t,e){if(!t)return null;e=e||!1;var i=25/this.paper.view.zoom,n="data:image/png;base64,"+(e?this.iconsBytes.itemAlertDark:this.iconsBytes.itemAlert),r=new this.paper.Raster({source:n,position:t}),a=function(){var t=r.size,e=new this.paper.Size(i,i),n=1,a=1;Math.abs(t.width)>1e-7&&(n=e.width/t.width),Math.abs(t.height)>1e-7&&(a=e.height/t.height),r.scale(n,a)};return r.size.width>0&&r.size.height>0?a():r.onLoad=function(){a()},r},checkSelectionAlertItems:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[0];this.checkAlertItems(i)}},removeAlertItems:function(t){t&&this.fireRemoveMessageEvent(t.data.guid)},removeAllAlertItems:function(){var t=this;this.getAllItems().forEach(function(e){return t.removeAlertItems(e)})},removeSelectionAlertItems:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[0];this.removeAlertItems(i)}},checkItemQualityForArea:function(t,e){var i=this.getMaskedImageRasterItem(t);if(t&&i&&t.data&&t.data.guid&&!t.data.isArea&&!t.data.isTextArt&&!t.data.isTextOnPath){var n=this.findDesignItemByGuid(t.data.guid);if(n&&"Vector"!=n.get("imageType")){i.bounds;var r=this.getAreaScaleFactor(e);if(r){var a=this.isMaskedImage(t),s=i.size.width*(a?i.scaling.x:1)*t.scaling.x,o=i.size.height*(a?i.scaling.y:1)*t.scaling.y,l=s*r.width,h=o*r.height;if(l>n.get("imageWidth")+.1*n.get("imageWidth")||h>n.get("imageHeight")+.1*n.get("imageHeight"))return!1}}}return!0},getAreaScaleFactor:function(t){var e=new this.paper.Size(1,1),i=this.getSelectedPrintType(t);(!i||i.get("dpi")<=0)&&(i=this.getModelPrintType(this.design.getSelectedPrintTypeForArea(t)));var n=this.getScaledAreaPixelSize(t,i);return n&&(e.width=n.width/t.get("boundsWidth"),e.height=n.height/t.get("boundsHeight")),e},getSelectedPrintType:function(t){var e=this.design.getSelectedPrintTypeForArea(t),i=null;if(t){var n=t.getSideID(),r=t.getColorID(),a=this.getCurrentModel();a&&n>0&&r>0&&(i=a.get("colors").getColor(r).get("sides").getSide(n).get("printTypes").getPrintType(e)||a.get("printTypes").getPrintType(e))}return i},getModelPrintType:function(t){var e=null,i=this.getCurrentModel();return i&&this.design&&this.design instanceof MPlaza.Design&&i.get("printTypes")instanceof MPlaza.PrintTypes&&(e=i.get("printTypes").getPrintType(t)),e},getScaledAreaPixelSize:function(t,e){var i=new this.paper.Size(0,0),n=null;if(t instanceof MPlaza.Area&&(n=t.getParentModel()),n&&n.get("ppcm")>0){var r=t.get("boundsWidth")/n.get("ppcm"),a=t.get("boundsHeight")/n.get("ppcm");if((!e||e.get("dpi")<=0)&&t.get("screenPPI")>0){var s=r/(t.get("boundsWidth")/t.get("screenPPI")*2.54),o=a/(t.get("boundsHeight")/t.get("screenPPI")*2.54);i.width=Math.round(s*t.get("boundsWidth")),i.height=Math.round(o*t.get("boundsHeight"))}else if(e){var l=e.get("dpi")||e.get("printTypeDPI");"PrintfulPrintType"==e.get("name")&&l>120&&(l*=.75);var h=.3937*r*l,c=.3937*a*l;i.width=Math.round(h),i.height=Math.round(c)}}return i},cloneSelectedItems:function(){var t=this.getLastUndoOperationId();this.beginDesignOperation();for(var e=this.getSelectedItems(),i=[],n=0;n<e.length;n++){var r=e[n];if((!this.getMaskedImageRasterItem(r)||this.canAddImage())&&((!(r instanceof this.paper.PointText)||this.canAddText())&&(!r.data||!r.data.isTextOnPath&&!r.data.isTextArea||this.canAddText())&&(!r.data||!r.data.isTextArt||this.canAddTextArt()))){var a=this.findDesignItemForItem(r);if(a&&(!r.data||!r.data.isTextArt||a.get("textArt"))){var s=r.clone();s.data.guid=void 0,r.data&&r.data.isTextOnPath&&r.data.points&&(s.data.points=[r.data.points[0].clone(),r.data.points[1].clone(),r.data.points[2].clone()]),r.data&&r.data.isTextArea&&r.data.rect&&(s.data.rect=r.data.rect.clone()),r.data&&r.data.originalBounds&&(s.data.originaBounds=r.data.originalBounds.clone()),r.data&&r.data.originalMatrix&&(s.data.originalMatrix=r.data.originalMatrix.clone()),r.data&&r.data.originalPosition&&(s.data.originalPosition=r.data.originalPosition.clone());var o=new this.paper.Point(25,25);if(s.position.x+=o.x,s.position.y+=o.y,s.data.originalPosition){var l=(new this.paper.Matrix).translate(o.x,o.y);s.data.originalPosition=s.data.originalPosition.transform(l)}s.data.needsTransformsDataUpdate=!0,this.onTextOnPathMoved(s,o),this.onTextAreaMoved(s,o),i.push(s);var h=null;if(r.data&&r.data.isTextArt){var c=a.get("textArt"),u={fontFamilyID:c.get("fontFamilyID"),fontFaceID:c.get("fontFaceID"),text:c.get("text"),textArtTypeID:c.get("textArtTypeID"),style:null,config:c.get("config").toJSON()};h=this.onTextArtItemCreated(s,u)}else if(this.isImage(r)){var d=this.createDummyImageFromDesignItem(a);h=this.onItemCreated(s,d)}else if(this.isMaskedImage(r)&&!this.isFilledShape(r)){d=this.createDummyImageFromDesignItem(a);var f=this.createDummyShapeFromDesignItem(a);h=this.onItemCreated(s,d),this.onImageItemUpdated(s,d,f)}else if(this.isShape(r)){var g={isImagePlaceholder:r.data.isImagePlaceholder,style:this.getShapeItemStyle(r)},p=this.createDummyShapeFromDesignItem(a);h=this.onShapeItemCreated(s,p,g)}else if(this.isFilledShape(r)){d=this.createDummyImageFromDesignItem(a),f=this.createDummyShapeFromDesignItem(a),g={isImagePlaceholder:r.data.isImagePlaceholder,style:this.getShapeItemStyle(r)};h=this.onShapeItemCreated(s,f,g),this.onShapeItemUpdated(s,f,d)}else r.data&&(r.data.isTextArea||r.data.isTextOnPath)&&(h=this.onItemCreated(s));if(h&&(h.copyConstraints(a.get("constraints")),a.get("colors").each(function(t){h.changeColor(t.get("imageID"),t.get("colorID"),t.get("colorCode"))}),h.unset("colorMappings"),h.set("colorMappings",new MPlaza.ColorMappings),a.get("colorMappings")))for(n=0;n<a.get("colorMappings").length;n++){var m=new MPlaza.ColorMapping;m.copyAttributes(a.get("colorMappings").at(n)),h.get("colorMappings").add(m)}}}}this.deselectAll(),this.selectItems(i),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(t)},mirrorSelectedItems:function(t){var e=this.getLastUndoOperationId();this.beginDesignOperation();for(var i=this.getSelectedItems(),n=0;n<i.length;n++){var r=i[n];r.data.needsTransformsDataUpdate=!0;var a,s=null,o=null;if(this.isShape||this.isFilledShape(r))(a=this.isShape(r)?r:this.getMaskedImageShapeItem(r))&&a.data.originalMatrix&&a.data.originalPosition&&(s=a.data.originalPosition.clone(),o=a.data.originalMatrix.clone());if("X"==t){r.scale(-1,-1);var l=(new this.paper.Matrix).scale(-1,-1);r.data&&r.data.originalMatrix&&r.data.originalMatrix.prepend(l),r.data&&r.data.originalPosition&&(r.data.originalPosition=r.data.originalPosition.transform(l)),this.onTextOnPathScaled(r,-1,-1,r.bounds.center),this.onTextAreaScaled(r,-1,-1,r.bounds.center)}else{r.scale(1,-1);l=(new this.paper.Matrix).scale(1,-1);r.data&&r.data.originalMatrix&&r.data.originalMatrix.prepend(l),r.data&&r.data.originalPosition&&(r.data.originalPosition=r.data.originalPosition.transform(l)),this.onTextOnPathScaled(r,1,-1,r.bounds.center),this.onTextAreaScaled(r,1,-1,r.bounds.center)}if((this.isShape||this.isFilledShape(r))&&o&&s)(a=this.isShape(r)?r:this.getMaskedImageShapeItem(r))&&a.data.originalMatrix&&a.data.originalPosition&&(this.applyTransformationsToMaskImageSubItems(r),a.data.originalPosition=s,a.data.originalMatrix=o,a.data.flips||(a.data.flips=[]),a.data.flips.push(t))}this.updateTextOnPathGuides(i),this.updateTextAreaGuides(i),this.onItemsUpdated(i),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(e)},createDummyImageFromDesignItem:function(t){var e=new MPlaza.Image;return e.set("imageID",t.get("imageID")),e.set("type",t.get("imageType")),e.set("format",t.get("imageFormat")),e.set("width",t.get("imageWidth")),e.set("height",t.get("imageHeight")),e.set("dpiX",t.get("imageDpiX")),e.set("dpiY",t.get("imageDpiY")),e.set("imageFileSize",t.get("imageFileSize")),e.set("providerImageID",t.get("providerImageID")),e.set("userID",t.get("imageUserID")),e.set("visitorID",t.get("imageVisitorID")),e.set("visitorCode",t.get("imageVisitorCode")),e.set("customerID",t.get("imageCustomerID")),e.set("customerCode",t.get("imageCustomerCode")),e.set("price",t.get("imagePrice")),e.set("preferredWidth",t.get("imagePreferredHeight")),e.set("preferredHeight",t.get("imagePreferredHeight")),e},createDummyShapeFromDesignItem:function(t){var e=new MPlaza.Shape;return t.get("shape")&&e.set("shapeID",t.get("shape").get("shapeID")),e},canAddText:function(){if(this.side&&this.side instanceof MPlaza.Side&&this.design&&this.design instanceof MPlaza.Design){var t=this.design.getDesignSide(this.side),e=t?t.get("canAddText"):this.design.get("canAddText");if(null!=e&&null!=e&&"boolean"==typeof e&&!e&&!this.design.get("isTemplate"))return!1;var i=this.side.get("areas").at(0),n=this.getSelectedPrintType(i),r=(t?t.get("maxNrTexts"):this.design.get("maxNrTexts"))||(n&&this.model.get("printTypes").get(n.id).get("printTypeRestrictions")?this.model.get("printTypes").get(n.id).get("printTypeRestrictions").get("maxNrTextElements"):null);if(null!=r&&null!=r&&"number"==typeof r)if((t?this.design.countTextItemsForSide(this.side.getModelID(),this.side.getColorID(),this.side.getSideID()):this.design.countTextItemsForColor(this.side.getModelID(),this.side.getColorID()))>=r)return!1}return!0},canAddImage:function(){if(this.side&&this.side instanceof MPlaza.Side&&this.design&&this.design instanceof MPlaza.Design){var t=this.design.getDesignSide(this.side),e=t?t.get("canAddImage"):this.design.get("canAddImage");if(null!=e&&null!=e&&"boolean"==typeof e&&!e&&!this.design.get("isTemplate"))return!1;var i=this.side.get("areas").at(0),n=this.getSelectedPrintType(i),r=(t?t.get("maxNrImages"):this.design.get("maxNrImages"))||(n&&this.model.get("printTypes").get(n.id).get("printTypeRestrictions")?this.model.get("printTypes").get(n.id).get("printTypeRestrictions").get("maxNrImages"):null);if(null!=r&&null!=r&&"number"==typeof r)if((t?this.design.countImageItemsForSide(this.side.getModelID(),this.side.getColorID(),this.side.getSideID()):this.design.countImageItemsForColor(this.side.getModelID(),this.side.getColorID()))>=r)return!1}return!0},canMaskImages:function(){if(this.side&&this.side instanceof MPlaza.Side&&this.design&&this.design instanceof MPlaza.Design){if(this.design.get("templateDesignID")<=0)return!0;var t=this.design.getDesignSide(this.side),e=t?t.get("canMaskImages"):this.design.get("canMaskImages");if(null!=e&&null!=e&&"boolean"==typeof e&&!e)return!1}return!0},canAddTextArt:function(){return this.canAddText()},canAddShape:function(){if(this.side&&this.side instanceof MPlaza.Side&&this.design&&this.design instanceof MPlaza.Design){if(this.design.get("templateDesignID")<=0)return!0;var t=this.design.getDesignSide(this.side),e=t?t.get("canAddShape"):this.design.get("canAddShape");if(null!=e&&null!=e&&"boolean"==typeof e&&!e)return!1;var i=t?t.get("maxNrShapes"):this.design.get("maxNrShapes");if(null!=i&&null!=i&&"number"==typeof i)if((t?this.design.countShapeItemsForSide(this.side.getModelID(),this.side.getColorID(),this.side.getSideID()):this.design.countShapeItemsForColor(this.side.getModelID(),this.side.getColorID()))>=i)return!1}return!0},canMoveSelection:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(this.isMaskedImage(i)&&this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element)if(this.isFilledShape(i)){if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canEditShapeFilling(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canEditFilledShape(i))return!1}else{if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canEditMask(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canEditMaskedImage(i))return!1}else if(!this.canMoveItem(i))return!1}return!0},canRotateSelection:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(this.isMaskedImage(i)&&this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element)if(this.isFilledShape(i)){if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canEditShapeFilling(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canEditFilledShape(i))return!1}else{if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canEditMask(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canEditMaskedImage(i))return!1}else if(!this.canRotateItem(i))return!1}return!0},canDeleteSelection:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(this.isMaskedImage(i)&&this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element)if(this.isFilledShape(i)){if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canDeleteShapeFilling(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask)return!1}else{if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canDeleteMask(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster)return!1}else if(!this.canDeleteItem(i))return!1}return!0},canResizeSelection:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(this.isMaskedImage(i)&&this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element)if(this.isFilledShape(i)){if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canEditShapeFilling(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canEditFilledShape(i))return!1}else{if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&!this.canEditMask(i))return!1;if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster&&!this.canEditMaskedImage(i))return!1}else{if(i.data.isTextBox&&i.data.adaptText)return!1;if(!this.canResizeItem(i)||i.data&&i.data.isImageForBackground)return!1}var n=this.side.get("areas").at(0),r=this.getSelectedPrintType(n);if(r&&this.model.get("printTypes").get(r.id).get("printTypeRestrictions")&&!1===this.model.get("printTypes").get(r.id).get("printTypeRestrictions").get("allowChangeFontSize")&&!this.design.get("isTemplate")&&(this.getItemIsTextArea(i)||this.getItemIsTextOnPath(i)))return!1}return!0},canEditSelection:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canEditItem(i)||i.data&&i.data.isImageForBackground)return!1}return!0},canChangeSelectionFontFamily:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemFontFamily(i))return!1}return!0},canChangeSelectionFontSize:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemFontSize(i))return!1}return!0},canChangeSelectionFontColor:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemFontColor(i))return!1}return!0},canChangeSelectionFontWeight:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemFontWeight(i))return!1}return!0},canChangeSelectionFontItalic:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemFontItalic(i))return!1}return!0},canChangeSelectionTextPathMode:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemTextPathMode(i))return!1}return!0},canChangeSelectionJustification:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemJustification(i))return!1}return!0},canChangeSelectionShadowColor:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemShadowColor(i))return!1}return!0},canChangeSelectionShadowBlur:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemShadowBlur(i))return!1}return!0},canChangeSelectionShadowDistance:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemShadowDistance(i))return!1}return!0},canChangeSelectionShadowAngle:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canChangeItemShadowAngle(i))return!1}return!0},canResizeTextBoxSelection:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];if(!this.canResizeTextBoxItem(i))return!1}return!0},getItemConstraints:function(t,e){if(this.design&&!(this.design.get("templateDesignID")<=0)||e){var i=t instanceof MPlaza.DesignItem?t:this.findDesignItemForItem(t);return i?i.get("constraints"):null}},getItemConstraintsProperty:function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var r=this.getItemConstraints(t,n);return r?r.get(e):i},canMoveItem:function(t){return this.getItemConstraintsProperty(t,"canMove")},canRotateItem:function(t){return this.getItemConstraintsProperty(t,"canRotate")},canDeleteItem:function(t){return this.getItemConstraintsProperty(t,"canDelete")},canResizeItem:function(t){return this.getItemConstraintsProperty(t,"canResize")},canEditItem:function(t){return this.getItemConstraintsProperty(t,"canEdit")},canChangeItemFontFamily:function(t){return this.getItemConstraintsProperty(t,"canChangeFontFamily")},canChangeItemFontSize:function(t){var e=this.getItemConstraintsProperty(t,"canChangeFontSize");if(e){var i=this.getItemMinFontSize(t),n=this.getItemMaxFontSize(t);null!=i&&null!=i&&null!=n&&null!=n&&(e=i!=n)}return e},getItemMinFontSize:function(t){if(this.side){var e=this.getItemConstraints(t,!1);if(e)return e.get("minFontSize");var i=this.side.get("areas").at(0),n=this.model.get("printTypes").getPrintType(this.design.getSelectedPrintTypeForArea(i));return n&&n.get("printTypeRestrictions")&&n.get("printTypeRestrictions").get("minFontSize")?n.get("printTypeRestrictions").get("minFontSize"):void 0}},getDefaultFontSize:function(){if(!this.side)return null;var t=this.model.get("printTypes").getPrintType(this.design.getSelectedPrintTypeForArea(this.side.get("areas").at(0)));return t&&t.get("printTypeRestrictions")&&t.get("printTypeRestrictions").get("defaultFontSize")?t.get("printTypeRestrictions").get("defaultFontSize"):null},getFontSizeList:function(){if(!this.side)return null;var t=this.model.get("printTypes").getPrintType(this.design.getSelectedPrintTypeForArea(this.side.get("areas").at(0)));return t&&t.get("printTypeRestrictions")&&t.get("printTypeRestrictions").get("fontSizeList")?t.get("printTypeRestrictions").get("fontSizeList"):[]},getItemMaxFontSize:function(t){if(this.side){var e=this.getItemConstraints(t,!1);if(e)return e.get("maxFontSize");var i=this.side.get("areas").at(0),n=this.model.get("printTypes").getPrintType(this.design.getSelectedPrintTypeForArea(i));return n&&n.get("printTypeRestrictions")&&n.get("printTypeRestrictions").get("maxFontSize")?n.get("printTypeRestrictions").get("maxFontSize"):void 0}},canChangeItemFontColor:function(t){return this.getItemConstraintsProperty(t,"canChangeFontColor")},canChangeItemFontWeight:function(t){return this.getItemConstraintsProperty(t,"canChangeFontWeight")},canChangeItemFontItalic:function(t){return this.getItemConstraintsProperty(t,"canChangeFontItalic")},canChangeItemTextPathMode:function(t){return this.getItemConstraintsProperty(t,"canChangeTextPathMode")},canChangeItemTextAreaMode:function(t){return this.canEditItem(t)},canChangeItemAdaptText:function(t){return this.getItemConstraintsProperty(t,"canChangeAdaptText")},canWrapTextOnAdaptText:function(t){return this.getItemConstraintsProperty(t,"canWrapTextOnAdaptText",!0,!0)},canChangeItemLetterSpacing:function(t){return this.getItemConstraintsProperty(t,"canChangeLetterSpacing")},canChangeItemLineSpacing:function(t){return this.getItemConstraintsProperty(t,"canChangeLineSpacing")},canChangeItemShadowColor:function(t){return this.getItemConstraintsProperty(t,"canChangeShadowColor")},canChangeItemShadowBlur:function(t){return this.getItemConstraintsProperty(t,"canChangeShadowBlur")},canChangeItemShadowDistance:function(t){return this.getItemConstraintsProperty(t,"canChangeShadowDistance")},canChangeItemShadowAngle:function(t){return this.getItemConstraintsProperty(t,"canChangeShadowAngle")},getItemIsTextOnPath:function(t){return t&&t.data&&t.data.isTextOnPath},getItemIsTextArea:function(t){return t&&t.data&&t.data.isTextArea},getItemIsTextArt:function(t){return t&&t.data&&t.data.isTextArt},getItemIsTextElement:function(t){return t&&t.data&&(t.data.isText||t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)},isRaster:function(t){return"svg"!=t.get("imageFormat").toLowerCase()},canChangeItemJustification:function(t){return this.getItemConstraintsProperty(t,"canChangeJustification")},canChangeItemVerticalAlignment:function(t){return this.getItemConstraintsProperty(t,"canChangeVerticalAlignment")},canTransform:function(t){return this.getItemConstraintsProperty(t,"canTransform")},canChangeSvgColors:function(t){return this.getItemConstraintsProperty(t,"canChangeSvgColors")},canResizeTextBoxItem:function(t){return this.getItemConstraintsProperty(t,"canResizeTextBox")},canChangeItemTextBoxMode:function(t){return this.getItemConstraintsProperty(t,"canChangeTextBoxMode")},toUppercaseOption:function(t){return this.getItemConstraintsProperty(t,"toUppercase",!1,!0)},isAlwaysOnTop:function(t){var e=this.findDesignItemForItem(t);if(!e)return!1;var i=e.get("constraints");return i&&i.get("isAlwaysOnTop")||!1},isItemPrintable:function(t){return this.getItemConstraintsProperty(t,"isPrintable")},isItemStatic:function(t){var e=!(this.canEditItem(t)||this.canMoveItem(t)||this.canRotateItem(t)||this.canResizeItem(t)||this.canDeleteItem(t)||this.canTransform(t));if(this.getMaskedImageRasterItem(t)){var i=this.findDesignItemForItem(t);if(!i)return!1;"Vector"==i.get("imageType")&&(e=e&&!this.canChangeSvgColors(t))}return(t instanceof this.paper.PointText||t&&t.data&&(t.data.isTextOnPath||t.data.isTextArea))&&(e=e&&!(this.canChangeItemFontFamily(t)||this.canChangeItemFontColor(t)||this.canChangeItemFontWeight(t)||this.canChangeItemTextPathMode(t))),e},itemCanBeTransformed:function(t){return this.canMoveItem(t)||this.canRotateItem(t)||this.canResizeItem(t)||this.canDeleteItem(t)||this.canTransform(t)},isMandatoryToEdit:function(t){return this.getItemConstraintsProperty(t,"mandatoryToEdit")},canAddMask:function(t){return this.getItemConstraintsProperty(t,"canAddMask")},canReplaceMask:function(t){return this.getItemConstraintsProperty(t,"canReplaceMask")},canEditMask:function(t){return this.getItemConstraintsProperty(t,"canEditMask")},canDeleteMask:function(t){return this.getItemConstraintsProperty(t,"canDeleteMask")},canEditMaskedImage:function(t){return this.getItemConstraintsProperty(t,"canEditMaskedImage")},canChangeMaskStrokeColor:function(t){return this.getItemConstraintsProperty(t,"canChangeMaskStrokeColor")},canChangeMaskStrokeWidth:function(t){return this.getItemConstraintsProperty(t,"canChangeMaskStrokeWidth")},canFillShape:function(t){return this.getItemConstraintsProperty(t,"canFillShape")},canReplaceShapeFilling:function(t){return this.getItemConstraintsProperty(t,"canReplaceShapeFilling")},canEditShapeFilling:function(t){return this.getItemConstraintsProperty(t,"canEditShapeFilling")},canDeleteShapeFilling:function(t){return this.getItemConstraintsProperty(t,"canDeleteShapeFilling")},canEditFilledShape:function(t){return this.getItemConstraintsProperty(t,"canEditFilledShape")},canChangeShapeStrokeColor:function(t){return this.getItemConstraintsProperty(t,"canChangeShapeStrokeColor")},canChangeShapeStrokeWidth:function(t){return this.getItemConstraintsProperty(t,"canChangeShapeStrokeWidth")},canChangeShapeFillColor:function(t){return this.getItemConstraintsProperty(t,"canChangeShapeFillColor")},allowShadows:function(){return this.getPrintTypeConstraintsProperty("allowShadows",!1)},getMinShadowBlur:function(t){var e=this.getItemConstraints(t);return e&&null!=e.get("minShadowBlur")&&null!=e.get("minShadowBlur")?e.get("minShadowBlur"):this.getPrintTypeConstraintsProperty("minShadowBlur",null)||0},getMaxShadowBlur:function(t){var e=this.getItemConstraints(t);return e&&null!=e.get("maxShadowBlur")&&null!=e.get("maxShadowBlur")?e.get("maxShadowBlur"):this.getPrintTypeConstraintsProperty("maxShadowBlur",null)},adjustInputShadowBlur:function(t,e){var i=this.getMinShadowBlur(t),n=this.getMaxShadowBlur(t);return null!=i&&null!=i&&e<i&&(e=i),null!=n&&null!=n&&e>n&&(e=n),e},getMinShadowDistance:function(t){var e=this.getItemConstraints(t);return e&&null!=e.get("minShadowDistance")&&null!=e.get("minShadowDistance")?e.get("minShadowDistance"):this.getPrintTypeConstraintsProperty("minShadowDistance",null)||0},getMaxShadowDistance:function(t){var e=this.getItemConstraints(t);return e&&null!=e.get("maxShadowDistance")&&null!=e.get("maxShadowDistance")?e.get("maxShadowDistance"):this.getPrintTypeConstraintsProperty("maxShadowDistance",null)},adjustInputShadowDistance:function(t,e){var i=this.getMinShadowDistance(t),n=this.getMaxShadowDistance(t);return null!=i&&null!=i&&e<i&&(e=i),null!=n&&null!=n&&e>n&&(e=n),e},getMinShadowAngle:function(t){var e=this.getItemConstraints(t);return e&&null!=e.get("minShadowAngle")&&null!=e.get("minShadowAngle")?e.get("minShadowAngle"):this.getPrintTypeConstraintsProperty("minShadowAngle",null)||0},getMaxShadowAngle:function(t){var e=this.getItemConstraints(t);if(e&&null!=e.get("maxShadowAngle")&&null!=e.get("maxShadowAngle"))return e.get("maxShadowAngle");var i=this.getPrintTypeConstraintsProperty("maxShadowAngle",null);return null!=i&&null!=i?Math.min(Math.max(0,i),359):359},adjustInputShadowAngle:function(t,e){var i=this.getMinShadowAngle(t)||0,n=this.getMaxShadowAngle(t)||359;return Math.min(Math.max(i,e),n)},getPrintTypeConstraints:function(){if(this.side&&this.side.get("areas").length>0&&this.model){var t=this.side.get("areas").at(0),e=this.getSelectedPrintType(t);if(e)return this.model.get("printTypes").get(e.id).get("printTypeRestrictions")}return null},getPrintTypeConstraintsProperty:function(t,e){var i=this.getPrintTypeConstraints();return i?i.get(t):e},findItemById:function(t){if(-1==t)return null;function e(i){if(i.id==t)return i;if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=e(i.children[n]);if(null!=r)return r}return null}for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=e(this.paper.project.layers[i]);if(null!=r)return r}return null},findItemByName:function(t){if(!t)return null;function e(i){if(i.name===t)return i;if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=e(i.children[n]);if(null!=r)return r}return null}for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=e(this.paper.project.layers[i]);if(null!=r)return r}return null},clearSelectionBounds:function(){this.selectionBoundsShape&&this.selectionBoundsShape.remove(),this.selectionMaskMoveImage&&this.selectionMaskMoveImage.remove(),this.selectionMaskMoveShape&&this.selectionMaskMoveShape.remove(),this.selectionMoveHandle&&this.selectionMoveHandle.remove(),this.selectionRotateHandle&&this.selectionRotateHandle.remove(),this.selectionResizeHandle&&this.selectionResizeHandle.remove(),this.selectionDeleteHandle&&this.selectionDeleteHandle.remove(),this.selectionResizeTopHandle&&this.selectionResizeTopHandle.remove(),this.selectionResizeBottomHandle&&this.selectionResizeBottomHandle.remove(),this.selectionResizeLeftHandle&&this.selectionResizeLeftHandle.remove(),this.selectionResizeRightHandle&&this.selectionResizeRightHandle.remove(),this.selectionBoundsShape=null,this.selectionBounds=null,this.selectionMoveHandle=null,this.selectionRotateHandle=null,this.selectionResizeHandle=null,this.selectionDeleteHandle=null,this.selectionMaskMoveImage=null,this.selectionMaskMoveShape=null,this.selectionResizeTopHandle=null,this.selectionResizeBottomHandle=null,this.selectionResizeLeftHandle=null,this.selectionResizeRightHandle=null},showSelectionBounds:function(){this.drawSelectionBounds++,this.drawSelectionBounds>0&&(this.selectionBoundsShape&&(this.selectionBoundsShape.visible=!0),this.selectionMoveHandle&&(this.selectionMoveHandle.visible=!0),this.selectionRotateHandle&&(this.selectionRotateHandle.visible=!0),this.selectionResizeHandle&&(this.selectionResizeHandle.visible=!0),this.selectionDeleteHandle&&(this.selectionDeleteHandle.visible=!0),this.selectionMaskMoveImage&&(this.selectionMaskMoveImage.visible=!0),this.selectionMaskMoveShape&&(this.selectionMaskMoveShape.visible=!0),this.selectionResizeTopHandle&&(this.selectionResizeTopHandle.visible=!0),this.selectionResizeBottomHandle&&(this.selectionResizeBottomHandle.visible=!0),this.selectionResizeLeftHandle&&(this.selectionResizeLeftHandle.visible=!0),this.selectionResizeRightHandle&&(this.selectionResizeRightHandle.visible=!0))},hideSelectionBounds:function(){this.drawSelectionBounds>0&&this.drawSelectionBounds--,0==this.drawSelectionBounds&&(this.selectionBoundsShape&&(this.selectionBoundsShape.visible=!1),this.selectionMoveHandle&&(this.selectionMoveHandle.visible=!1),this.selectionRotateHandle&&(this.selectionRotateHandle.visible=!1),this.selectionResizeHandle&&(this.selectionResizeHandle.visible=!1),this.selectionDeleteHandle&&(this.selectionDeleteHandle.visible=!1),this.selectionMaskMoveImage&&(this.selectionMaskMoveImage.visible=!1),this.selectionMaskMoveShape&&(this.selectionMaskMoveShape.visible=!1),this.selectionResizeTopHandle&&(this.selectionResizeTopHandle.visible=!1),this.selectionResizeBottomHandle&&(this.selectionResizeBottomHandle.visible=!1),this.selectionResizeLeftHandle&&(this.selectionResizeLeftHandle.visible=!1),this.selectionResizeRightHandle&&(this.selectionResizeRightHandle.visible=!1))},updateSelectionState:function(){if(!this.isViewer){if(this.clearSelectionBounds(),this.updateMaskedImageGuides(),this.selectionBounds=this.getSelectionBounds(),null!=this.selectionBounds){var t=new this.paper.Path.Rectangle(this.selectionBounds);t.strokeColor=this.getContrastedColor(this.selectionBounds),t.strokeWidth=1/this.paper.view.zoom,t.dashOffset=.5/this.paper.view.zoom,t.dashArray=[1/this.paper.view.zoom,1/this.paper.view.zoom],t.guide=!0,t.visible=this.drawSelectionBounds>0,this.selectionBoundsShape=t,this.createSelectionHandles()}this.updateTextOnPathGuides(),this.updateTextAreaGuides()}},moveSelectionShapes:function(t){this.selectionBoundsShape&&(this.selectionBoundsShape.position.x+=t.x,this.selectionBoundsShape.position.y+=t.y,this.selectionMoveHandle&&(this.selectionMoveHandle.position.x+=t.x,this.selectionMoveHandle.position.y+=t.y),this.selectionRotateHandle&&(this.selectionRotateHandle.position.x+=t.x,this.selectionRotateHandle.position.y+=t.y),this.selectionResizeHandle&&(this.selectionResizeHandle.position.x+=t.x,this.selectionResizeHandle.position.y+=t.y),this.selectionDeleteHandle&&(this.selectionDeleteHandle.position.x+=t.x,this.selectionDeleteHandle.position.y+=t.y),this.selectionMaskMoveShape&&(this.selectionMaskMoveShape.position.x+=t.x,this.selectionMaskMoveShape.position.y+=t.y),this.selectionMaskMoveImage&&(this.selectionMaskMoveImage.position.x+=t.x,this.selectionMaskMoveImage.position.y+=t.y),this.selectionResizeTopHandle&&(this.selectionResizeTopHandle.position.x+=t.x,this.selectionResizeTopHandle.position.y+=t.y),this.selectionResizeBottomHandle&&(this.selectionResizeBottomHandle.position.x+=t.x,this.selectionResizeBottomHandle.position.y+=t.y),this.selectionResizeLeftHandle&&(this.selectionResizeLeftHandle.position.x+=t.x,this.selectionResizeLeftHandle.position.y+=t.y),this.selectionResizeRightHandle&&(this.selectionResizeRightHandle.position.x+=t.x,this.selectionResizeRightHandle.position.y+=t.y),this.selectionBounds=this.selectionBoundsShape.bounds)},scaleSelectionShapes:function(t,e,i){this.selectionBoundsShape&&(this.selectionBoundsShape.scale(t,e,i),this.selectionBounds=this.selectionBoundsShape.bounds,this.placeHandleOut(this.selectionBoundsShape))},createSelectionHandles:function(){if(this.selectionMoveHandle&&this.selectionMoveHandle.remove(),this.selectionRotateHandle&&this.selectionRotateHandle.remove(),this.selectionResizeHandle&&this.selectionResizeHandle.remove(),this.selectionDeleteHandle&&this.selectionDeleteHandle.remove(),this.selectionMaskMoveShape&&this.selectionMaskMoveShape.remove(),this.selectionMaskMoveImage&&this.selectionMaskMoveImage.remove(),this.selectionResizeTopHandle&&this.selectionResizeTopHandle.remove(),this.selectionResizeBottomHandle&&this.selectionResizeBottomHandle.remove(),this.selectionResizeLeftHandle&&this.selectionResizeLeftHandle.remove(),this.selectionResizeRightHandle&&this.selectionResizeRightHandle.remove(),this.selectionBoundsShape){var t=this.selectionBoundsShape.segments;if(4==t.length){var e=t[0].point,i=t[1].point,n=t[2].point,r=t[3].point,a=i.add(n.subtract(i).divide(2)),s=e.add(r.subtract(e).divide(2)),o=e.add(i.subtract(e).divide(2)),l=r.add(n.subtract(r).divide(2)),h=this.getSelectedItems();if(this.showSelectedElementDimensions&&this.createDimensionLabel(a,r),this.showTotalSizeOfCurrentSide&&this.createPrintAreaTotalDimensionLabel(a,r),this.showUnselectedElementsDimensions&&this.createUnselectedDimensionLabel(),this.canMoveSelection()&&(this.selectionMoveHandle=this.createSelectionHandle("move",i)),this.canRotateSelection()&&(this.selectionRotateHandle=this.createSelectionHandle("rotate",n)),this.canDeleteSelection()&&(this.selectionDeleteHandle=this.createSelectionHandle("remove",e)),this.canResizeSelection()&&!this.isFixedFontListEnabled()){var c=this.getCurrentModel();if(c&&this.design&&this.design instanceof MPlaza.Design&&c.get("printTypes")instanceof MPlaza.PrintTypes&&h.length>0&&this.side&&this.side.get("areas").length>0){var u=h[0],d=this.selectedDesignItem;this.isImagesFixedSizeEnabled()&&(!d||d.get("imagePreferredWidth")||d.get("imagePreferredHeight"))||this.isMobile&&(!u.data||u.data.isTextArea||u.data.isTextOnPath)||(this.selectionResizeHandle=this.createSelectionHandle("resize",r),(u.data&&u.data.isTextArt||this.isMaskedImage(u)&&this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask||u.data&&u.data.isShape)&&(this.selectionResizeTopHandle=this.createLateralSelectionHandle("top",a),this.selectionResizeBottomHandle=this.createLateralSelectionHandle("bottom",s),this.selectionResizeLeftHandle=this.createLateralSelectionHandle("left",o),this.selectionResizeRightHandle=this.createLateralSelectionHandle("right",l)))}}var f=this.getSelectedItem();if(f&&this.isMaskedImage(f)){var g=!(this.canMoveItem(f)||this.canRotateItem(f)||this.canResizeItem(f));!this.isFilledShape(f)&&this.canEditMask(f)&&(this.selectionMaskMoveShape=this.createSelectionHandle("maskMoveShape",l)),this.isFilledShape(f)&&!g&&(this.selectionMaskMoveShape=this.createSelectionHandle("maskMoveShape",l)),this.canEditMaskedImage(f)&&(this.selectionMaskMoveImage=this.createSelectionHandle("maskMoveImage",l))}this.placeHandleOut(this.selectionBoundsShape)}}},resetAllDimensionLabels:function(){this.selectedItemDimensionLabel&&this.selectedItemDimensionLabel.remove(),this.printAreaLabel&&this.printAreaLabel.remove(),this.labelLayer&&(this.labelLayer.remove(),this.selectedItemDimensionLabel=null,this.printAreaLabel=null,this.labelLayer=null),this.dimensionLabelList&&(this.dimensionLabelList.map(function(t){return t.remove(),!1}),this.dimensionLabelList=null,this.unselectedLabelsGroup.remove(),this.unselectedLabelsGroup=null)},createUnselectedDimensionLabel:function(){var t=this,e=this.getSelectedItem();if(e)if(this.dimensionLabelList)this.updateUnselectedLabels();else{this.dimensionLabelList=[],this.unselectedLabelsGroup||(this.unselectedLabelsGroup=new this.paper.Group({name:"unselectedLabelsGroup",applyMatrix:!1,visible:!1}));var i=this.getAllItems(),n=this.side.get("ppcm"),r=this.unselectedLabelsGroup;0===this.dimensionLabelList.length&&this.labelLayer&&(this.labelLayer.addChild(r),i.forEach(function(i){if(i.data&&i.data.guid&&!i.data.isArea&&!t.dimensionLabelList["label-".concat(i.id)]&&i.id!==e.id){var a=i.data.transformsData?i.data.transformsData.dimensions.width:i.bounds.width,s=i.data.transformsData?i.data.transformsData.dimensions.height:i.bounds.height,o=new t.paper.Group({name:"label-".concat(i.id),id:"label-".concat(i.id),applyMatrix:!1});r.addChild(o);var l=i.bounds.topLeft,h=i.bounds.topRight,c=l.add(h.subtract(l).divide(2)),u=(a/n/("cm"===t.unitOfMeasurement?1:2.54)).toFixed(2),d=(s/n/("cm"===t.unitOfMeasurement?1:2.54)).toFixed(2);t.createLabel(c,o,"".concat(u).concat(t.unitOfMeasurement," x ").concat(d).concat(t.unitOfMeasurement)),o.position=c.add(new t.paper.Point(0,-22/t.paper.view.zoom));var f=(o.children[1].bounds.width+20)/o.children[0].bounds.width;o.children[0].scale(f,1),t.dimensionLabelList["label-".concat(i.id)]=o}})),r.visible=!0,this.updateUnselectedLabels()}},updateUnselectedLabels:function(){var t=this,e=this.getSelectedItem();if(e){if(!this.dimensionLabelList)return;var i=this.getAllItems(),n=this.side.get("ppcm");if(this.dimensionLabelList["label-".concat(e.id)]&&(this.dimensionLabelList["label-".concat(e.id)].remove(),delete this.dimensionLabelList["label-".concat(e.id)]),this.dimensionList=this.dimensionLabelList.map(function(t){return t.remove(),!1}),this.unselectedLabelsGroup){var r=this.unselectedLabelsGroup;i.forEach(function(i){if(i.data&&i.data.guid&&!i.data.isArea&&i.id!==e.id)if(t.dimensionLabelList["label-".concat(i.id)])t.resizeHandle(t.dimensionLabelList["label-".concat(i.id)],110);else{var a=i.data.transformsData?i.data.transformsData.dimensions.width:i.bounds.width,s=i.data.transformsData?i.data.transformsData.dimensions.height:i.bounds.height,o=new t.paper.Group({name:"label-".concat(i.id),id:"label-".concat(i.id),applyMatrix:!1});r.addChild(o);var l=i.bounds.topLeft,h=i.bounds.topRight,c=l.add(h.subtract(l).divide(2));c.y-=40;var u=(a/n/("cm"===t.unitOfMeasurement?1:2.54)).toFixed(2),d=(s/n/("cm"===t.unitOfMeasurement?1:2.54)).toFixed(2);t.createLabel(c,o,"".concat(u," x ").concat(d," ").concat(t.unitOfMeasurement));var f=(o.children[1].bounds.width+20)/o.children[0].bounds.width;o.children[0].scale(f,1),t.dimensionLabelList["label-".concat(i.id)]=o}})}}},deleteDimensionLabel:function(t){t&&this.dimensionLabelList&&this.dimensionLabelList[t]&&(this.dimensionLabelList[t].remove(),this.dimensionLabelList.splice(t,1))},isGridImage:function(){var t=this.getSelectedItem();return t&&t.data&&t.data.isGridImage},createDimensionLabel:function(t,e){if(this.labelLayer)this.updateLabelsPosition();else{var i=this.paper.project.activeLayer;this.labelLayer=new this.paper.Layer({name:"labels"}),i.activate(),this.labelLayer.visible=!1,this.labelLayer.bringToFront(),this.selectedItemDimensionLabel=new this.paper.Group({name:"widthLabelGroup"}),this.selectedItemDimensionLabel.applyMatrix=!1,this.labelLayer.addChild(this.selectedItemDimensionLabel),this.createLabel(t,this.selectedItemDimensionLabel,"".concat(0," x ").concat(0," ").concat(this.unitOfMeasurement)),this.updateLabelsPosition();var n=(this.selectedItemDimensionLabel.children[1].bounds.width+20)/this.selectedItemDimensionLabel.children[0].bounds.width;this.selectedItemDimensionLabel.children[0].scale(n,1)}},createPrintAreaTotalDimensionLabel:function(){if(this.printAreaLabel)this.updatePrintAreaLabelText();else{if(!this.labelLayer){var t=this.paper.project.activeLayer;this.labelLayer=new this.paper.Layer({name:"labels"}),t.activate(),this.labelLayer.bringToFront()}this.printAreaLabel=new this.paper.Group({name:"heightLabelGroup"}),this.printAreaLabel.applyMatrix=!1,this.labelLayer.addChild(this.printAreaLabel);var e=this.side.get("ppcm");if(this.itemsLayer.children[0].children[1]){var i=this.paper.project.layers[1].children[0].children[1],n=(i.bounds.width/e/("cm"===this.unitOfMeasurement?1:2.54)).toFixed(2),r=(i.bounds.height/e/("cm"===this.unitOfMeasurement?1:2.54)).toFixed(2);this.createLabelPrintArea(i,this.printAreaLabel,"".concat(n," x ").concat(r," ").concat(this.unitOfMeasurement))}}},createLabelPrintArea:function(t,e,i){var n=new this.paper.Path.Rectangle(new this.paper.Rectangle(0,0,80,15),0);n.fillColor=new this.paper.Color("#ffffff"),n.strokeScaling=!1,n.strokeWidth=0,n.strokeColor=new this.paper.Color("#000000"),n.position=t.pointTop,n.position.y+=28,n.name="labelRectanglePrintArea-".concat(e.name),n.opacity=1;var r=new this.paper.PointText(t.pointTop);r.content=i,r.position.y+=32,r.fontSize=10,r.fontWeight=600,r.fontFamily="Montserrat, sans-serif",r.fillColor=new this.paper.Color("#000000"),r.justification="center",r.opacity=.7,e.addChildren([n,r]),e.position=t.bounds.topCenter.add(new this.paper.Point(0,-22/this.paper.view.zoom))},createLabel:function(t,e,i){var n=new this.paper.Path.Rectangle(new this.paper.Rectangle(0,0,80,15),0);n.fillColor=new this.paper.Color("#ffffff"),n.strokeScaling=!1,n.strokeWidth=0,n.strokeColor=new this.paper.Color("#000000"),n.position=t,n.position.y+=32,n.name="labelRectangle-".concat(e.name);var r=new this.paper.PointText(t);r.content=i,r.position.y+=36,r.fontSize=10,r.fontWeight=600,r.fontFamily="Montserrat, sans-serif",r.fillColor=new this.paper.Color("#514f52"),r.justification="center",e.addChildren([n,r])},updateLabelsPosition:function(){var t=this.labelLayer,e=this.getSelectedItem();e&&this.selectedItemDimensionLabel&&(this.selectedItemDimensionLabel.position=e.bounds.topCenter.add(new this.paper.Point(0,-22/this.paper.view.zoom)),this.updateLabelsText(),this.resizeHandle(this.selectedItemDimensionLabel,110),t.visible=!0),this.paper.project.view.update()},updatePrintAreaLabelText:function(){var t;if(null===(t=this.itemsLayer.children[0])||void 0===t?void 0:t.children[1]){var e=this.getAllItems(),i=[];e.forEach(function(t){t.data&&t.data.guid&&!t.data.isArea&&i.push(t)}),this.getAllGridItems().forEach(function(t){t.children&&t.children.length>0&&t.children.forEach(function(t){t.children.forEach(function(t){t.data&&t.data.isGridImage&&i.push(t)})})});var n=this.totalAreaCalculator(i)/("cm"===this.unitOfMeasurement?1:2.54);this.printAreaLabel.children[1].content="".concat(n.toFixed(2)," ").concat(this.unitOfMeasurement,"2");var r=(this.printAreaLabel.children[1].bounds.width+20)/this.printAreaLabel.children[0].bounds.width;this.printAreaLabel.children[0].scale(r,1),this.resizeHandle(this.printAreaLabel,110),this.labelLayer.visible=!0}},updateLabelsText:function(t){var e=this.getSelectedItem();if(!e)throw new Error("Item cannot be null");var i=this.side.get("ppcm"),n=(e.bounds.width/i/("cm"===this.unitOfMeasurement?1:2.54)).toFixed(2),r=(e.bounds.height/i/("cm"===this.unitOfMeasurement?1:2.54)).toFixed(2);this.selectedItemDimensionLabel.children[1].content="".concat(n," x ").concat(r," ").concat(this.unitOfMeasurement);var a=(this.selectedItemDimensionLabel.children[1].bounds.width+10)/this.selectedItemDimensionLabel.children[0].bounds.width;this.selectedItemDimensionLabel.children[0].scale(a,1)},totalAreaCalculator:function(t){var e=this,i=0;return[this.side.get("areas").models].forEach(function(n){var r=e.side;if(null!=r&&r.get("ppcm")>0){var a=t.map(function(t){var e=t.data.transformsData?t.data.transformsData.dimensions.width:t.bounds.width,i=t.data.transformsData?t.data.transformsData.dimensions.height:t.bounds.height,n=t.data.transformsData?t.data.transformsData.position.x:t.bounds.x,r=t.data.transformsData?t.data.transformsData.position.y:t.bounds.y;return new Rectangle(e,i,n,r)});i+=rectanglesDistinctArea(a,r.get("ppcm"))}},this),i},placeHandleOut:function(t){if(t=t||this.selectionBoundsShape){var e=t.segments[0].point,i=t.segments[1].point,n=t.segments[2].point,r=t.segments[3].point,a=i.add(n.subtract(i).divide(2)),s=e.add(r.subtract(e).divide(2)),o=e.add(i.subtract(e).divide(2)),l=r.add(n.subtract(r).divide(2)),h=r.subtract(i),c=Math.atan2(h.x,h.y),u=i.getDistance(e)/i.getDistance(n),d=c+Math.atan(u);if(this.selectionMoveHandle){var f=.5*this.selectionMoveHandle.bounds.width;this.selectionMoveHandle.position=i,this.selectionMoveHandle.position.y-=Math.sin(d+Math.PI/4)*f,this.selectionMoveHandle.position.x+=Math.cos(d+Math.PI/4)*f}if(this.selectionRotateHandle){f=.5*this.selectionRotateHandle.bounds.width;this.selectionRotateHandle.position=n,this.selectionRotateHandle.position.y-=Math.sin(d-Math.PI/4)*f,this.selectionRotateHandle.position.x+=Math.cos(d-Math.PI/4)*f}if(this.selectionDeleteHandle){f=.5*this.selectionDeleteHandle.bounds.width;this.selectionDeleteHandle.position=e,this.selectionDeleteHandle.position.y-=Math.sin(d+3*Math.PI/4)*f,this.selectionDeleteHandle.position.x+=Math.cos(d+3*Math.PI/4)*f}if(this.selectionResizeHandle){f=.5*this.selectionResizeHandle.bounds.width;this.selectionResizeHandle.position=r,this.selectionResizeHandle.position.y-=Math.sin(d-3*Math.PI/4)*f,this.selectionResizeHandle.position.x+=Math.cos(d-3*Math.PI/4)*f}if(this.selectionMaskMoveImage){f=.5*this.selectionMaskMoveImage.bounds.width;this.selectionMaskMoveImage.position=l,this.selectionMaskMoveImage.position.y-=Math.sin(d+.7-Math.PI/2)*(f+20/this.paper.view.zoom),this.selectionMaskMoveImage.position.x+=Math.cos(d+.7-Math.PI/2)*(f+20/this.paper.view.zoom)}if(this.selectionMaskMoveShape){f=.5*this.selectionMaskMoveShape.bounds.width;this.selectionMaskMoveShape.position=l,this.selectionMaskMoveShape.position.y-=Math.sin(d-.7-Math.PI/2)*(f+20/this.paper.view.zoom),this.selectionMaskMoveShape.position.x+=Math.cos(d-.7-Math.PI/2)*(f+20/this.paper.view.zoom)}if(this.selectionResizeTopHandle||this.selectionResizeBottomHandle||this.selectionResizeLeftHandle||this.selectionResizeRightHandle){var g=this.selectionResizeHandle?.5*this.selectionResizeHandle.bounds.width:.5*this.selectionLateralResizeDimension*2,p=i.clone();p.y-=Math.sin(d+Math.PI/4)*g,p.x+=Math.cos(d+Math.PI/4)*g;var m=n.clone();m.y-=Math.sin(d-Math.PI/4)*g,m.x+=Math.cos(d-Math.PI/4)*g;var v=e.clone();v.y-=Math.sin(d+3*Math.PI/4)*g,v.x+=Math.cos(d+3*Math.PI/4)*g;var _=r.clone();_.y-=Math.sin(d-3*Math.PI/4)*g,_.x+=Math.cos(d-3*Math.PI/4)*g,this.selectionResizeTopHandle&&(this.selectionResizeTopHandle.position=a),this.selectionResizeBottomHandle&&(this.selectionResizeBottomHandle.position=s),this.selectionResizeLeftHandle&&(this.selectionResizeLeftHandle.position=o),this.selectionResizeRightHandle&&(this.selectionResizeRightHandle.position=l)}}},resizeHandle:function(t,e){var i=t.bounds,n=(null!=e?e:200)/_this_1.paper.view.zoom,r=(e=new _this_1.paper.Size(n,n),1);Math.abs(i.width)>1e-7&&(r=e.width/i.width),Math.abs(i.height)>1e-7&&(e.height,i.height),t.scale(r)},createSelectionHandle:function(t,e){if(!this.selectionBounds)return null;var i=this.selectionBoundsShape,n=getViewport(),r=0;r=(n.w,32/this.paper.view.zoom);var a="data:image/png;base64,"+this.iconsBytes[t],s=new this.paper.Raster({source:a,position:e.add()});s.data.isHandle=!0;var o=function(){var t=s.size,e=new this.paper.Size(r,r),i=1,n=1;Math.abs(t.width)>1e-7&&(i=e.width/t.width),Math.abs(t.height)>1e-7&&(n=e.height/t.height),s.scale(i,n)};if(s.size.width>0&&s.size.height>0)o();else{var l=this;s.onLoad=function(){o(),l.placeHandleOut(i)}}return s},createLateralSelectionHandle:function(t,e){var i=this.selectionLateralResizeDimension/this.paper.view.zoom,n=new this.paper.Path.Circle(e,i);return n.data.isLateralResize=!0,n.data.lateralResizeType=t,n.strokeColor=new this.paper.Color(1,1,1,.5),n.strokeWidth=1,n.fillColor=new this.paper.Color(0,0,0,.5),n},isItemFrozen:function(t){return t&&(t.data&&t.data.frozen||this.isItemGroupChild(t)&&t.parent.data&&t.parent.data.frozen)},isItemGroup:function(t){return t instanceof this.paper.Group&&!(t instanceof this.paper.Layer)},isItemGroupChild:function(t){return t.parent&&this.isItemGroup(t.parent)},isItemChild:function(t){return t.parent&&!(t.parent instanceof this.paper.Layer)},getRootDesignItemCanvasItem:function(t){if(t){if(t.isMaskPath)return t.item;if(t.data&&t.data.guid&&!t.data.isArea)return t;if(t.parent&&!(t.parent instanceof this.paper.Layer))return this.getRootDesignItemCanvasItem(t.parent)}return null},isDesignItemCanvasItem:function(t){return null!=this.getRootDesignItemCanvasItem(t)},setItemDataCustomOptions:function(t,e){t.data.customOptions=e,this.onItemUpdated(t),console.log(t.data)},setItemSelection:function(t,e){var i=this.getRootDesignItemCanvasItem(t);if(i&&i.data.selected!=e){i.data.selected=e;var n=this.findDesignItemForItem(i);i.data.maskAlertPath&&i.data.maskAlertPath.remove(),this.createMaskForItem(t),e?(this.cacheSelectedItemConstraints(n),this.checkAlertItems(i),this.removeDashedEdgeForItem(i),this.selectedDesignItem=n,this.selectedPaperRootItem=i):(n&&(this.createDashedEdgeForItem(i),this.createProfanityCheckInvalidOverlayAndEdgeForItem(i)),this.selectedDesignItem=null,this.selectedPaperRootItem=null);var r={designItem:n,selected:e};n&&this.fireSelectionChangedEvent(r)}},createMaskForItem:function(t){if(!t.data||!t.data.isImageForBackground&&!t.data.isAreaForBackground){var e=this.getRootDesignItemCanvasItem(t);if(e&&e.data){var i=this.getAreasIntersectingItem(e),n=this.getAreasContainingItem(e),r=0==i.length&&0==n.length;e.data.maskPath&&e.data.maskPath.remove(),e.data.maskPath=new this.paper.Path.Rectangle(e.bounds),e.data.maskPath.strokeWidth=2,e.data.maskPath.strokeColor="blue",e.data.maskPath.dashArray=[4,10],e.data.maskPath.isMaskPath=!0,e.data.maskPath.item=e,e.data.maskPath.visible=!1,!e.data.selected&&r&&this.itemCanBeTransformed(t)&&(e.data.maskPath.visible=!0)}}},removeMaskForItem:function(t){var e=this.getRootDesignItemCanvasItem(t);e&&e.data&&e.data.maskPath&&e.data.maskPath.remove()},canAddDashedEdge:function(t){return!(!this.design||this.design.get("templateDesignID")<=0||!this.canEditItem(t)||!t.data.isTemplateElement||t.data&&(t.data.isImageForBackground||t.data.isAreaForBackground))&&this.showDashedEdge},createDashedEdgeForItem:function(t){if(this.canAddDashedEdge(t)&&!this.isViewer){var e=this.getRootDesignItemCanvasItem(t);if(this.removeDashedEdgeForItem(e),!e.data.maskPath.visible){var i=new this.paper.Path.Rectangle(e.bounds);i.strokeWidth=2,i.strokeColor=this.DashedEdgeColor,i.dashArray=[10,10],i.visible=!0,e.data.dashedEdgeID=i.id,this.masterGroup.addChild(i),i.insertBelow(e),i.data.isDashedEdge=!0}}},removeDashedEdgeForItem:function(t){var e=this.getRootDesignItemCanvasItem(t);if(e&&e.data&&e.data.dashedEdgeID>0){var i=this.paper.project.getItem({id:e.data.dashedEdgeID});i&&(i.remove(),e.data.dashedEdgeID=-1)}},createMaskAlertForItem:function(t){var e=this.getRootDesignItemCanvasItem(t);e.data.maskAlertPath&&e.data.maskAlertPath.remove(),e.data.maskAlertPath=new this.paper.Path.Rectangle(e.bounds),e.data.maskAlertPath.strokeWidth=3,e.data.maskAlertPath.strokeColor="red",e.data.maskAlertPath.dashArray=[10,10],e.data.maskAlertPath.isMaskAlertPath=!0,e.data.maskAlertPath.item=e,e.data.maskAlertPath.data.isMaskAlertPath=!0},createProfanityCheckInvalidOverlayAndEdgeForItem:function(t){var e=this;if(!this.isViewer){var i=this.getRootDesignItemCanvasItem(t);if(this.removeProfanityCheckInvalidOverlayAndEdgeForItem(i),!i.data.isProfanityCheckInvalid)return;var n=new this.paper.Path.Rectangle(i.bounds);if(n.strokeWidth=3,n.strokeColor="red",n.dashArray=[10,10],n.visible=!0,n.insertBelow(i),n.data.isProfanityCheckDashedEdge=!0,i.data.profanityCheckDashedEdgeId=n.id,this.masterGroup.addChild(n),this.isImage(i)){this.invalidOverlayLayer||(this.invalidOverlayLayer=new this.paper.Layer({name:"invalid-overlay-layer"}),this.invalidOverlayLayer.bringToFront());var r=new this.paper.Group,a=new this.paper.Group;r.position=new this.paper.Point(0,0),r.data.isInvalidOverlayGroup=!0,a.visible=!1,a.position=new this.paper.Point(0,0),a.data.isInvalidOverlayGroup=!0;var s=i.bounds.width/i.bounds.height,o=new this.paper.Path.Rectangle({width:300,height:300/s});o.position=r.position,o.fillColor=new paper.Color(.1,.1,.1,.65),o.data.isInvalidOverlayGroup=!0,i.data.profanityCheckOverlayId=r.id,r.addChildren([o,a]),this.invalidOverlayLayer.addChild(r),this.itemsLayer.activate();var l=i.bounds.width/r.bounds.width;r.scale(l),r.position=i.position;var h=new this.paper.Raster({source:"data:image/png;base64,"+this.iconsBytes.warningOutlined});h.data.isInvalidOverlayGroup=!0,h.position=new this.paper.Point(o.bounds.x+o.bounds.width/2,o.bounds.y+o.bounds.height/2-20),h.onLoad=function(){var t=new e.paper.PointText({content:"Image not",fillColor:"white",fontStyle:"bold",fontWeight:"bold",fontSize:"18px"});t.data.isInvalidOverlayGroup=!0,t.position=new e.paper.Point(o.bounds.x+o.bounds.width/2,o.bounds.y+o.bounds.height/2+20);var i=new e.paper.PointText({content:"allowed",fillColor:"white",fontStyle:"bold",fontWeight:"bold",fontSize:"18px"});i.data.isInvalidOverlayGroup=!0,i.position=new e.paper.Point(o.bounds.x+o.bounds.width/2,o.bounds.y+o.bounds.height/2+40),a.addChildren([h,t,i]),l=Math.min(o.bounds.width/a.bounds.width,o.bounds.height/a.bounds.height),a.scale(l);var n=100/e.paper.view.zoom;l=n<a.bounds.height?n/a.bounds.height:1,a.scale(l),a.visible=!0}}}},removeProfanityCheckInvalidOverlayAndEdgeForItem:function(t){var e=this.getRootDesignItemCanvasItem(t);if(e&&e.data){if(e.data.profanityCheckDashedEdgeId>0){var i=this.paper.project.getItem({id:e.data.profanityCheckDashedEdgeId});i&&(i.remove(),e.data.profanityCheckDashedEdgeId=-1)}if(e.data.profanityCheckOverlayId>0){var n=this.paper.project.getItem({id:e.data.profanityCheckOverlayId});n&&(n.remove(),e.data.profanityCheckOverlayId=-1)}}},groupSelectedItems:function(){var t=this.getSelectedItems();if(0!=t.length){for(var e=new this.paper.Group,i=0;i<t.length;i++){var n=t[i];n.guide||e.addChild(n)}return this.setItemSelection(e,!0),this.updateSelectionState(),this.paper.project.view.update(),e}},ungroupSelectedItems:function(){var t=this.getSelectedItems();if(0!=t.length){for(var e=0;e<t.length;e++){var i=t[e];i instanceof this.paper.Group&&this.ungroup(i)}this.updateSelectionState(),this.paper.project.view.update()}},ungroup:function(t){if(this.setItemSelection(t,!1),t&&t instanceof this.paper.Group){for(;t.children.length>0;){var e=t.children.pop();e.parent=this.paper.project.activeLayer,this.setItemSelection(e,!0)}t.remove()}},captureSelectionPosition:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];if(!n.guide&&!this.isItemChild(n)){var r=this.getSubItemsToChange(n),a=[];r.forEach(function(t){a.push({id:t.id,position:t.position})}),t.push(a)}}return t},restoreSelectionPosition:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++){var r=i[n],a=this.findItemById(r.id);a||console.log("ITEM NOT FOUND!"),a&&(a.position=r.position)}},captureSelectionState:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i],r=this.getSubItemsToChange(n);if(!n.guide){this.removeMaskForItem(n);this.getMaskedImageRasterItem(n);var a=[];r.forEach(function(t){a.push({id:t.id,applyMatrix:t.applyMatrix,json:t.exportJSON({asString:!1}),matrix:t.matrix.clone(),selectedSegments:[],boundsItemMatrix:t.data&&t.data.originalMatrix?t.data.originalMatrix.clone():null,boundsItemPosition:t.data&&t.data.originalPosition?t.data.originalPosition.clone():null})}),t.push(a)}}return t},restoreSelectionState:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++){var r=i[n],a=this.findItemById(r.id);if(a){if(r.applyMatrix){var s=a.id;a.importJSON(r.json),a._id=s}else a.matrix.set(r.matrix.a,r.matrix.b,r.matrix.c,r.matrix.d,r.matrix.tx,r.matrix.ty);a.data.originalBounds&&a.data.originalMatrix&&r.boundsItemMatrix&&(a.data.originalMatrix=r.boundsItemMatrix.clone()),a.data.originalPosition&&a.data.originalPosition&&r.boundsItemPosition&&(a.data.originalPosition=r.boundsItemPosition.clone())}}},captureSelectionMatrix:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i],r=n;if(this.isMaskedImage(n))r=this.getReferenceItemForSelectedItem(n);else{if(n.guide)continue;if(this.isItemChild(n))continue}var a=this.getMaskedImageRasterItem(n),s={id:n.id,refId:r.id,matrix:r.matrix.clone(),selectedSegments:[],boundsItemMatrix:n.data.originalMatrix?n.data.originalMatrix.clone():null,boundsRasterMatrix:a&&a.data.originalMatrix?a.data.originalMatrix.clone():null};t.push(s)}return t},restoreSelectionMatrix:function(t){for(var e=0;e<t.length;e++){var i=t[e],n=this.findItemById(i.id),r=this.findItemById(i.refId);if(n&&r){r.matrix.set(i.matrix.a,i.matrix.c,i.matrix.b,i.matrix.d,i.matrix.tx,i.matrix.ty),n.data&&n.data.originalMatrix&&(n.data.originalMatrix=i.boundsItemMatrix.clone());var a=this.getMaskedImageRasterItem(n);a&&a.data.originalMatrix&&i.boundsRasterMatrix&&(a.data.originalMatrix=i.boundsRasterMatrix.clone())}}},deselectAll:function(){var t=this.getSelectedItems();this.fireDeselectionChangedEvent(t),this.deselectGridBoxes();for(var e=0;e<t.length;e++){var i=t[e];i.data&&i.data.selected&&this.setItemSelection(i,!1)}this.paper.project.deselectAll(),this.hideAreaItems(),this.labelLayer&&this.labelLayer.visible&&(this.labelLayer.visible=!1)},selectItems:function(t){if(this.deselectAll(),t&&"[object Array]"===Object.prototype.toString.call(t))for(var e=0;e<t.length;e++){var i=t[e];i&&this.setItemSelection(i,!0)}this.updateSelectionState(),this.paper.project.view.update()},getSelectionBounds:function(){for(var t=null,e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i],r=this.getItemBounds(n);t=null==t?r.clone():t.unite(r)}return t},getSelectedItem:function(){var t=this.getSelectedItems();return t.length>0?t[0]:null},isItemSelected:function(t){for(var e=this.getSelectedItems(),i=0;i<e.length;i++){if(e[i]===t)return!0}return!1},getSelectedItems:function(){for(var t=[],e=function(i){if(!i.guide&&(!i.data||!i.data.isArea)&&(i.data&&i.data.selected&&t.push(i),i.children))for(var n=i.children.length-1;n>=0;n--){var r=i.children[n];e(r)}},i=0;i<this.paper.project.layers.length;i++){var n=this.paper.project.layers[i];n.guide||e(n)}return t},getSelectedSimpleItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||(n instanceof this.paper.Group||n.parent&&this.isItemGroup(n.parent)||t.push(n))}return t},getSelectedGroupItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||this.isItemGroup(n)&&t.push(n)}return t},getSelectedTextItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||(n instanceof this.paper.TextItem?t.push(n):n&&n.data&&n.data.isTextOnPath?t.push(n):n&&n.data&&n.data.isTextArea&&t.push(n))}return t},getDefaultTextItemInfo:function(){var t={text:"",strokeColor:"black",strokeWidth:0,fillColor:"black",fontFamily:"Arial",fontSize:18,fontWeight:"normal",fontStyle:"normal",fontStretch:"normal",justification:"center",isTextOnPath:!1,isTextArea:!1,isTextBox:!1,adaptText:!1,letterSpacing:0,lineSpacing:0,scaling:1,verticalAlignment:"top",shadowColor:null,shadowBlur:0,shadowDistance:7,shadowAngle:45};return t},getTextFromItem:function(t){var e="";if(t instanceof this.paper.TextItem)e=t.content;else if(t&&t.data&&t.data.isTextOnPath){if(t.children&&t.children.length>0){var i=t.data.text;if(!i)for(var n=0;n<t.children.length;n++)i+=t.children[n].content;e=i}}else t&&t.data&&t.data.isTextArea&&(e=t.data.text||"");return __assign(__assign({},t),{text:e})},getTextItemInfo:function(t){var e=this.getDefaultTextItemInfo();if(t instanceof this.paper.TextItem)e.text=t.content,e.strokeColor=t.strokeColor.toCSS(!0),e.strokeWidth=t.strokeWidth,e.fillColor=t.fillColor.toCSS(!0),e.fontFamily=t.fontFamily,e.fontSize=t.fontSize,e.fontWeight=t.fontWeight,e.fontStyle=t.fontStyle,e.fontStretch=t.fontStretch,e.justification=t.justification,e.scaling=t.scaling,e.shadowColor=t.shadowColor,e.shadowBlur=t.shadowBlur,e.shadowDistance=this.getOffsetDistance(t.shadowOffset),e.shadowAngle=this.getOffsetAngle(t.shadowOffset),e.letterSpacing=t.letterSpacing,e.lineSpacing=t.lineSpacing;else if(t&&t.data&&t.data.isTextOnPath){if(t.children.length>0){var i=t.data.text;if(!i)for(var n=0;n<t.children.length;n++)i+=t.children[n].content;e.text=i,e.isTextOnPath=t.data&&t.data.isTextOnPath,e.isTextArea=t.data&&t.data.isTextArea,e.isTextBox=t.data&&t.data.isTextBox,e.adaptText=t.data&&t.data.adaptText,e.strokeColor=t.children[0].strokeColor,e.strokeWidth=t.children[0].strokeWidth,e.fillColor=t.children[0].fillColor,e.fontFamily=t.children[0].fontFamily,e.fontWeight=t.children[0].fontWeight,e.fontStyle=t.children[0].fontStyle,e.fontStretch=t.children[0].fontStretch,e.fontSize=t.children[0].fontSize,e.scaling=t.children[0].scaling,e.justification=t.data.isTextArea?t.data.justification:void 0,e.shadowColor=t.children[0].shadowColor,e.shadowBlur=t.children[0].shadowBlur,e.shadowDistance=this.getOffsetDistance(t.children[0].shadowOffset),e.shadowAngle=this.getOffsetAngle(t.children[0].shadowOffset)}}else t&&t.data&&t.data.isTextArea&&(e=this.getTextAreaItemInfo(t,null));return e.isPlaceHolder=t.data&&t.data.isPlaceHolder||!1,t.data.hasOwnProperty("originalStrokeColor")&&(e.strokeColor=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(e.fillColor=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(e.shadowColor=t.data.originalShadowColor),t.data.hasOwnProperty("adaptText")&&(e.adaptText=t.data.adaptText),t.data.hasOwnProperty("letterSpacing")&&(e.letterSpacing=t.data.letterSpacing),t.data.hasOwnProperty("lineSpacing")&&(e.lineSpacing=t.data.lineSpacing),e.fontFamily=e.fontFamily.replace(/"/g,""),e},getSelectedTextItemsInfo:function(){var t=this.getDefaultTextItemInfo(),e=this.getSelectedTextItems();if(e&&1==e.length){var i=e[0];t=this.getTextItemInfo(i)}return t.fontFamily=t.fontFamily.replace(/"/g,""),t},getSelectedTextItemsNotOnPath:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n instanceof this.paper.TextItem&&t.push(n)}return t},getSelectedTextOnPathItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n&&n.data&&n.data.isTextOnPath&&t.push(n)}return t},getSelectedTextAreaItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n&&n.data&&n.data.isTextArea&&t.push(n)}return t},getSelectedSimpleTextAreaItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n&&n.data&&n.data.isTextArea&&!n.data.isTextBox&&t.push(n)}return t},getSelectedTextBoxItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n&&n.data&&n.data.isTextArea&&n.data.isTextBox&&t.push(n)}return t},getSelectedTextArtItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n&&n.data&&n.data.isTextArt&&t.push(n)}return t},getSelectedShapeItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];n.guide||n&&n.data&&n.data.isShape&&t.push(n)}return t},getSelectedImageItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];this.getMaskedImageRasterItem(n)&&n.data&&n.data.guid&&!n.data.isArea&&t.push(n)}return t},getSelectedMaskedImageItems:function(){var t=this;return this.getSelectedImageItems().filter(function(e){return t.isMaskedImage(e)})},getSelectedFilledShapesItems:function(){var t=this;return this.getSelectedImageItems().filter(function(e){return t.isFilledShape(e)})},getSelectedItemsCommonImageID:function(){for(var t=null,e=this.getSelectedImageItems(),i=0;i<e.length;i++){var n=e[i],r=this.findDesignItemByGuid(n.data.guid);if(r){var a=r.get("imageID");if(null==t)t=a;else if(a!=t)return null}}return t},getSelectedDesignItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i],r=this.findDesignItemForItem(n);n&&t.push(r)}return t},countTextItems:function(){var t=0,e=this;function i(n){if((!e.isItemGroup(n)||n==e.masterGroup)&&n.children)for(var r=n.children.length-1;r>=0;r--){var a=n.children[r];!a.guide&&(a instanceof this.paper.TextItem||a.data&&a.data.isTextOnPath||a.data&&a.data.isTextArea)&&t++,i(a)}}for(var n=0,r=e.paper.project.layers.length;n<r;n++){var a=e.paper.project.layers[n];a.guide||i(a)}return t},countImageItems:function(){var t=0,e=this;function i(n){if((!e.isItemGroup(n)||this.isMaskedImage(n)||this.isMaskedImageClipGroup(n)||n==e.masterGroup)&&n.children)for(var r=n.children.length-1;r>=0;r--){var a=n.children[r];a&&a instanceof this.paper.Raster&&a.data&&a.data.guid&&!a.data.isArea&&t++,i(a)}}for(var n=0,r=e.paper.project.layers.length;n<r;n++){var a=e.paper.project.layers[n];a.guide||i(a)}return t},countTextArtItems:function(){var t=0,e=this;function i(n){if((!e.isItemGroup(n)||n==e.masterGroup)&&n.children)for(var r=n.children.length-1;r>=0;r--){var a=n.children[r];a&&a.data&&a.data.isTextArt&&t++,i(a)}}for(var n=0,r=e.paper.project.layers.length;n<r;n++){var a=e.paper.project.layers[n];a.guide||i(a)}return t},getItemsInfo:function(){var t=[],e=this;function i(n){if(n.children)for(var r=n.children.length-1;r>=0;r--){var a=n.children[r];if(a&&!a.guide){var s=null,o=e.findDesignItemForItem(a);if(o){var l=o.get("shape"),h=e.getMaskedImageRasterItem(a),c=e.getMaskedImageShapeItem(a);if(a instanceof this.paper.TextItem||a.data&&a.data.isTextOnPath||a.data&&a.data.isTextArea){s=new MPlaza.TextItemInfo(o,a);var u=e.getTextItemInfo(a);s.sideID=e.side.get("sideID"),s.text=u.text,s.strokeColor=u.strokeColor,s.strokeWidth=u.strokeWidth,s.fillColor=u.fillColor instanceof paper.Color?u.fillColor.toCSS(!0):u.fillColor,s.fontFamily=u.fontFamily,s.fontSize=u.fontSize,s.fontWeight=u.fontWeight,s.fontStyle=u.fontStyle,s.fontStretch=u.fontStretch,s.justification=u.justification,s.isTextOnPath=u.isTextOnPath,s.isTextArea=u.isTextArea,s.adaptText=u.adaptText,s.letterSpacing=u.letterSpacing,s.lineSpacing=u.lineSpacing,s.scaling=u.scaling,s.shadowColor=u.shadowColor,s.shadowBlur=u.shadowBlur,s.shadowDistance=e.getOffsetDistance(u.shadowOffset),s.shadowAngle=e.getOffsetAngle(u.shadowOffset)}else h&&a.data&&a.data.guid&&!a.data.isArea?((s=new MPlaza.ImageItemInfo(o,a)).imageID=o.get("imageID"),s.url=h.data.originalUrl||h.source,s.sideID=e.side.get("sideID"),s.visible=a.visible,s.isMasked=e.isMaskedImage(a),s.maskID=l?l.get("shapeID"):void 0,c&&(s.maskStyle.strokeColor=c.strokeColor?c.strokeColor.toCSS(!0):void 0,s.maskStyle.strokeWidth=c.strokeWidth,s.maskStyle.strokeCap=c.strokeCap,s.maskStyle.strokeJoin=c.strokeJoin,s.maskStyle.dashArray=c.dashArray,s.maskStyle.dashOffset=c.dashOffset,c.data.hasOwnProperty("originalStrokeColor")&&(s.maskStyle.strokeColor=c.data.originalStrokeColor))):a.data&&a.data.isTextArt&&(s=e.getTextArtItemInfo(a))}null!=s&&(s.constraints=(o.get("constraints")||new MPlaza.DesignItemConstraints).toJSON(),t.push(s))}i(a)}}for(var n=0;n<e.paper.project.layers.length;n++){var r=e.paper.project.layers[n];r.guide||i(r)}return t},getSelectedAreaItems:function(){for(var t=[],e=this.getSelectedItems(),i=0;i<e.length;i++)for(var n=e[i],r=this.getAreasIntersectingOrContainingItem(n),a=0;a<r.length;a++){var s=r[a],o=this.findItemForArea(s);o&&t.push(o)}return t},log:function(t){Logger.info(t),$("#logMsg").length&&$("#logMsg").text(t)},appendLog:function(t){var e=$("#logMsg").text();e&&(e+="\n"),e+=t,Logger.info(t),$("#logMsg").text(e)},getTextArtItemInfo:function(t){if(t&&t.data&&t.data.isTextArt){var e=this.findDesignItemForItem(t);if(e){var i=new MPlaza.TextArtItemInfo(e,t),n=e.get("textArt");i.text=n.get("text"),i.fontFamilyID=n.get("fontFamilyID"),i.fontFaceID=n.get("fontFaceID"),i.textArtTypeID=n.get("textArtTypeID"),t instanceof this.paper.Item&&(t.strokeColor&&(i.style.strokeColor=t.strokeColor.toCSS(!0)),i.style.strokeWidth=t.strokeWidth,i.style.strokeCap=t.strokeCap,i.style.strokeJoin=t.strokeJoin,i.style.dashArray=t.dashArray,i.style.dashOffset=t.dashOffset,t.fillColor&&(i.style.fillColor=t.fillColor.toCSS(!0)),t.data.hasOwnProperty("originalStrokeColor")&&(i.style.strokeColor=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(i.style.fillColor=t.data.originalFillColor),t.shadowColor&&(i.style.shadowColor=t.shadowColor.toCSS(!0)),i.style.shadowBlur=t.shadowBlur||0,i.style.shadowDistance=this.getOffsetDistance(t.shadowOffset),i.style.shadowAngle=this.getOffsetAngle(t.shadowOffset));var r=n.get("config");return i.config.angleValue=r.get("angleValue"),i.config.curveValue=r.get("curveValue"),i.config.intensT=r.get("intensT"),i.config.intensB=r.get("intensB"),i.config.isTriangle=r.get("isTriangle"),i.config.isBridge=r.get("isBridge"),i.config.isTop=r.get("isTop"),i.config.isBottom=r.get("isBottom"),i.config.isMiddle=r.get("isMiddle"),i}}return null},getTextArtItemText:function(t){if(t&&t.data&&t.data.isTextArt){var e=this.findDesignItemForItem(t);if(e)return e.get("textArt").get("text")}return null},getImageItemInfo:function(t){var e=null;if(t&&t.data&&t.data.guid&&!t.guide&&!t.data.isArea){var i=this.findDesignItemForItem(t);if(i){var n=i.get("shape"),r=this.getMaskedImageRasterItem(t);this.getMaskedImageShapeItem(t);r&&((e=new MPlaza.ImageItemInfo(i,t)).imageID=i.get("imageID"),e.sideID=this.side.get("sideID"),e.url=r.data.originalUrl||r.source,e.visible=t.visible,e.isMasked=this.isMaskedImage(t),e.maskID=n?n.get("shapeID"):void 0,e.maskStyle=this.getMaskedImageMaskPathStyle(t)),e.constraints=(i.get("constraints")||new MPlaza.DesignItemConstraints).toJSON()}}return e},getShapeItemInfo:function(t){var e=null;if(t&&(this.isShape(t)||this.isFilledShape(t))){var i=this.findDesignItemForItem(t);if(i){i.get("shape");var n=null;(n=this.isShape(t)?t:this.getMaskedImageShapeItem(t))&&((e=new MPlaza.ShapeItemInfo(i,t)).style=this.getShapeItemStyle(n),e.isImagePlaceholder=n.data.isImagePlaceholder,e.fillerImageID=i.get("imageID"))}}return e},onTouchStart:function(t){if(this.touchEnabled=!0,t.preventDefault(),1==t.touches.length){var e=this.windowToCanvas(t.touches[0].clientX,t.touches[0].clientY),i=new this.paper.Point(e.x,e.y);if(i=this.paper.project.view.viewToProject(i),this.hitTest(i),this.hitTestEnabled=!1,this.interactionMode=MPlaza.CustomizerInteractionMode.Create,this.elementType==MPlaza.CustomizerElementType.None&&(this.interactionMode=MPlaza.CustomizerInteractionMode.Select),this.mouseStartPos=i.clone(),this.adjustmentDelta=null,this.mouseLastPos=i.clone(),this.element=null,this.captureInitialSelectionState(i),this.hitItem)if(this.beginDesignOperation(),this.hitItem.data&&this.hitItem.data.isTextOnPathFirstEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextOnPathFirstEnd;else if(this.hitItem.data&&this.hitItem.data.isTextOnPathMiddleEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextOnPathMiddleEnd;else if(this.hitItem.data&&this.hitItem.data.isTextOnPathLastEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextOnPathLastEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaTopEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaTopEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaRightEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaRightEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaBottomEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaBottomEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaLeftEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaLeftEnd;else{this.getRootDesignItemCanvasItem(this.hitItem)?this.interactionMode=MPlaza.CustomizerInteractionMode.Select:this.hitItem==this.selectionMoveHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.Move:this.hitItem==this.selectionRotateHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.Rotate:this.hitItem==this.selectionResizeHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.Resize:this.hitItem==this.selectionResizeTopHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeTop:this.hitItem==this.selectionResizeBottomHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeBottom:this.hitItem==this.selectionResizeLeftHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeLeft:this.hitItem==this.selectionResizeRightHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeRight:this.hitItem==this.selectionDeleteHandle&&(this.interactionMode=MPlaza.CustomizerInteractionMode.Delete)}}},onTouchEnd:function(t){this.endDesignOperation(),this.hitTestEnabled=!0,this.hideCenterLines(),this.adjustmentDelta=null;var e=this.getSelectedItems();this.interactionMode==MPlaza.CustomizerInteractionMode.Select?this.selectElement():this.interactionMode==MPlaza.CustomizerInteractionMode.Create?(this.onItemCreated(this.element),this.deselectAll(),this.setItemSelection(this.element,!0)):this.interactionMode==MPlaza.CustomizerInteractionMode.Move?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.Rotate?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.Resize?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeTop?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeBottom?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeLeft?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeRight?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.Delete?this.deleteSelection():this.interactionMode==MPlaza.CustomizerInteractionMode.Edit?this.editElement():this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathFirstEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathMiddleEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathLastEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaTopEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaRightEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaBottomEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaLeftEnd&&this.onItemsUpdated(e),this.updateSelectionState(),this.paper.project.view.update()},onTap:function(t){},onDoubleTap:function(t){this.fitToScreen(!0,!0)},onPan:function(t){t.preventDefault();var e=this.windowToCanvas(t.center.x,t.center.y),i=new this.paper.Point(e.x,e.y),n=this.getSelectedItems();i=this.paper.project.view.viewToProject(i),"panstart"==t.type?(this.lastPanPoint.x=i.x,this.lastPanPoint.y=i.y,this.panOrigin=paper.view.center,this.removeAllAlertItems(),this.removeSizeLimitAlert()):"panend"==t.type&&(n.length>0&&this.checkAlertItems(n[0]),this.checkImagesSizeLimit());var r=i.subtract(this.lastPanPoint);this.lastPanPoint.x=i.x,this.lastPanPoint.y=i.y;var a=new MPlaza.PointingInfo;t.srcEvent&&(a.modifiers.option=t.srcEvent.altKey||!1,a.modifiers.control=t.srcEvent.ctrlKey||!1,a.modifiers.shift=t.srcEvent.shiftKey||!1),a.delta=r,a.point=i,this.onPointerDrag(a),this.paper.project.view.update();var s=n.length>0&&!this.canMoveSelection(n[0])&&this.interactionMode==MPlaza.CustomizerInteractionMode.Move;0!=n.length&&!s||!this.panOrigin||this.preventViewMoving||(paper.view.center=this.panOrigin.subtract(new paper.Point(1*t.deltaX/paper.view.zoom,1*t.deltaY/paper.view.zoom))),this.clampView()},onPinch:function(t){try{var e=this.getAllItemsBounds(),i=this.paper.project.view.bounds;if(this.zooming||!e||!i)return;"pinchstart"==t.type&&(this.oldScale=t.scale);var n=t.scale-this.oldScale;if(this.oldScale=t.scale,t.pointers.length<2)return;var r=1+Math.abs(n),a=new paper.Point(t.center.x,t.center.y),s=(a=paper.project.view.viewToProject(a)).subtract(paper.view.center),o=r-1;if(n>0){if(paper.view.zoom>=1.1)return;paper.view.zoom*=r,paper.view.center=paper.view.center.add(s.multiply(o/r))}else if(n<0){if(e.width<i.width-100&&e.height<i.height-100)return;paper.view.zoom/=r,paper.view.center=paper.view.center.subtract(s.multiply(o))}this.preventViewMoving=!1,this.checkAllAlertItems(),this.checkImagesSizeLimit(),this.clampView()}catch(t){alert(t)}},onRotate:function(t){},dumpSelectionPosition:function(){for(var t=this.getSelectedItems(),e=0;e<t.length;e++){var i=t[e];Logger.info("item_"+i._id+" - x: "+i.position.x+" - y: "+i.position.y)}},onMouseDown:function(t){if(!this.touchEnabled&&(this.hitTest(t.point),this.hitTestEnabled=!1,this.interactionMode=MPlaza.CustomizerInteractionMode.Create,this.elementType==MPlaza.CustomizerElementType.None&&(this.interactionMode=MPlaza.CustomizerInteractionMode.Select),this.mouseStartPos=t.point.clone(),this.adjustmentDelta=null,this.mouseLastPos=t.point.clone(),this.element=null,this.captureInitialSelectionState(t.point),this.hitItem))if(this.beginDesignOperation(),this.hitItem.data&&this.hitItem.data.isTextOnPathFirstEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextOnPathFirstEnd;else if(this.hitItem.data&&this.hitItem.data.isTextOnPathMiddleEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextOnPathMiddleEnd;else if(this.hitItem.data&&this.hitItem.data.isTextOnPathLastEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextOnPathLastEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaTopEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaTopEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaRightEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaRightEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaBottomEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaBottomEnd;else if(this.hitItem.data&&this.hitItem.data.isTextAreaLeftEndHandle)this.interactionMode=MPlaza.CustomizerInteractionMode.MoveTextAreaLeftEnd;else if(this.hitItem.data&&this.hitItem.data.isImageForBackground)this.interactionMode=MPlaza.CustomizerInteractionMode.Select;else if(this.hitItem.data&&(this.hitItem.data.isGridIcon||this.hitItem.data.isGridImage))this.interactionMode=MPlaza.CustomizerInteractionMode.SelectedGridImage;else if(this.hitItem.data&&this.hitItem.data.isShapePlaceholderIcon)this.fireFillShapeRequestedEvent({itemGuid:this.hitItem.data.shapeGuid});else{this.getRootDesignItemCanvasItem(this.hitItem)?this.interactionMode=MPlaza.CustomizerInteractionMode.Select:this.hitItem==this.selectionMoveHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.Move:this.hitItem==this.selectionRotateHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.Rotate:this.hitItem==this.selectionResizeHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.Resize:this.hitItem==this.selectionResizeTopHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeTop:this.hitItem==this.selectionResizeBottomHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeBottom:this.hitItem==this.selectionResizeLeftHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeLeft:this.hitItem==this.selectionResizeRightHandle?this.interactionMode=MPlaza.CustomizerInteractionMode.ResizeRight:this.hitItem==this.selectionDeleteHandle&&(this.interactionMode=MPlaza.CustomizerInteractionMode.Delete)}},onMouseMove:function(t){this.hitTestEnabled&&this.hitTest(t.point)},onMouseDrag:function(t){t.preventDefault();var e=new MPlaza.PointingInfo;e.modifiers.option=t.modifiers.option,e.modifiers.control=t.modifiers.control,e.modifiers.shift=t.modifiers.shift,e.delta=t.delta,e.point=t.point,this.onPointerDrag(e)},onPointerDrag:function(t){this.hitTestEnabled=!1,this.labelLayer&&this.labelLayer.visible&&(this.labelLayer.visible=!1),this.frozen||(this.interactionMode!=MPlaza.CustomizerInteractionMode.Select&&this.interactionMode!=MPlaza.CustomizerInteractionMode.SelectedGridImage||(this.selectElement(),this.updateSelectionState(),this.captureInitialSelectionState(t.point),this.interactionMode=MPlaza.CustomizerInteractionMode.Move),this.interactionMode==MPlaza.CustomizerInteractionMode.Create?this.elementType!=MPlaza.CustomizerElementType.Text&&this.createElement(t):this.interactionMode==MPlaza.CustomizerInteractionMode.Move?this.moveSelection(t):this.interactionMode==MPlaza.CustomizerInteractionMode.Rotate?this.rotateSelection(t):this.interactionMode==MPlaza.CustomizerInteractionMode.Resize?this.resizeSelection(t):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeTop?this.resizeSelectionTop(t):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeBottom?this.resizeSelectionBottom(t):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeLeft?this.resizeSelectionLeft(t):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeRight?this.resizeSelectionRight(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathFirstEnd?this.moveTextOnPathFirstEnd(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathMiddleEnd?this.moveTextOnPathMiddleEnd(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathLastEnd?this.moveTextOnPathLastEnd(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaTopEnd?this.moveTextAreaTopEnd(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaRightEnd?this.moveTextAreaRightEnd(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaBottomEnd?this.moveTextAreaBottomEnd(t):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaLeftEnd&&this.moveTextAreaLeftEnd(t),this.selectedPaperRootItem&&this.removeProfanityCheckInvalidOverlayAndEdgeForItem(this.selectedPaperRootItem))},onMouseUp:function(t){this.hitTestEnabled=!0,this.hideCenterLines(),this.adjustmentDelta=null;var e=this.getSelectedItems(),i=new MPlaza.PointingInfo;i.delta=t.delta,i.point=t.point,this.interactionMode==MPlaza.CustomizerInteractionMode.Select?(this.switchMaskedImageSelectionMode(t),this.selectElement()):this.interactionMode==MPlaza.CustomizerInteractionMode.Create?this.elementType==MPlaza.CustomizerElementType.Text?this.createElement(i):(this.onItemCreated(this.element),this.deselectAll(),this.setItemSelection(this.element,!0)):this.interactionMode==MPlaza.CustomizerInteractionMode.Move?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.Rotate?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.Resize?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeTop?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeBottom?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeLeft?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.ResizeRight?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.Delete?this.deleteSelection():this.interactionMode==MPlaza.CustomizerInteractionMode.Edit?this.editElement():this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathFirstEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathMiddleEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextOnPathLastEnd?this.onItemsUpdated(e):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaTopEnd?(this.onTextAreaGuidesUpdated(this.interactionMode),this.onItemsUpdated(e)):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaRightEnd?(this.onTextAreaGuidesUpdated(this.interactionMode),this.onItemsUpdated(e)):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaBottomEnd?(this.onTextAreaGuidesUpdated(this.interactionMode),this.onItemsUpdated(e)):this.interactionMode==MPlaza.CustomizerInteractionMode.MoveTextAreaLeftEnd?(this.onTextAreaGuidesUpdated(this.interactionMode),this.onItemsUpdated(e)):this.interactionMode==MPlaza.CustomizerInteractionMode.SelectedGridImage&&(this.hitItem.data.isGridImage?(this.switchMaskedImageSelectionMode(t),this.selectElement()):this.deselectAll(),this.onGridImageSelected(this.hitItem),this.onItemsUpdated(e)),this.forceSelectedTextAreasToBounds(),e.length>0&&this.createProfanityCheckInvalidOverlayAndEdgeForItem(this.getRootDesignItemCanvasItem(e[0])),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()},hitTest:function(t){if(!this.frozen){var e=8;this.isMobile&&(this.getSelectedTextItemsInfo().isTextOnPath||this.getSelectedTextItemsInfo().isTextArea)&&(e=25/this.paper.view.zoom);var i=this;if(this.hitItem=null,t&&this.itemsLayer){var n=this.itemsLayer.hitTestAll(t,{fill:!0,stroke:!0,tolerance:e,match:function(t){return!(t.item instanceof i.paper.Raster&&0==t.item.getPixel(t.offset.x,t.offset.y).alpha)&&(!(t.item&&t.item.data&&t.item.data.guid&&i.isItemStatic(t.item))&&(!(t.item&&t.item.data&&t.item.data.isAreaForBackground)&&(!(t.item&&t.item.data&&t.item.data.isGridBorderPath)&&(!(t.item&&t.item.data&&t.item.data.isInvalidOverlayGroup)&&(!(t.item&&t.item.data&&t.item.data.isMaskAlertPath)&&!(i.mask&&t.item==i.mask||t.item.isClippingArea))))))}});if(n&&n.length>0)this.hitItem=n[0].item;else for(var r=this.getAllItems(),a=0;a<r.length;a++){var s=r[a];if(s.isMaskPath&&s.contains(t))return void(!s.visibile&&s.item?this.hitItem=s.item:this.hitItem=s)}}}},captureInitialSelectionState:function(t){if(this.selectionBounds){this.originalPositions=this.captureSelectionPosition(),this.originalContent=this.captureSelectionState(),this.pivot=this.selectionBounds.center.clone(),this.corner=this.selectionBounds.bottomRight.clone(),this.cornerLeft=this.selectionBounds.leftCenter,this.cornerRight=this.selectionBounds.rightCenter,this.cornerTop=this.selectionBounds.topCenter,this.cornerBottom=this.selectionBounds.bottomCenter,this.originalSize=this.corner.subtract(this.pivot),this.originalCenter=this.selectionBounds.center,this.originalScaleCenter=this.selectionBounds.center;var e=this.getSelectedItems();if(e&&1==e.length){var i=e[0];i.data&&i.data.rect&&(this.originalCenter=i.data.rect.center)}this.originalShape=this.selectionBoundsShape.exportJSON({asString:!1});var n=t.subtract(this.originalCenter);this.originalAngle=Math.atan2(n.y,n.x);for(var r=this.getAllItems(),a=this.getSelectedItems(),s=[],o=1==a.length?this.getItemArea(a[0]):null,l=0;l<r.length;l++){var h=r[l];if(h&&h.data&&h.data.guid&&!h.data.isArea&&!h.guide&&h!=a[0]&&!h.data.isGroupForBackground&&!h.data.isClippingAreaForBackground&&!h.data.isImageForBackground)this.findDesignItemForItem(h).inOnArea(o)&&s.push(h)}this.snapCache={selectedItems:a,areaItems:s,area:o,areaItem:this.findItemForArea(o)}}},clampView:function(){},onKeyDown:function(t){},onKeyUp:function(t){if(!this.frozen){this.beginDesignOperation(),t.preventDefault(),t.stopPropagation();var e=1;t.modifiers.control&&(e=.5);var i=t.event&&t.event.target&&-1!=["INPUT","TEXTAREA"].indexOf(t.event.target.tagName);"delete"!=t.key||i?"right"!=t.key||i?"left"!=t.key||i?"up"!=t.key||i?"down"!=t.key||i||this.moveSelectionByDelta(0,e):this.moveSelectionByDelta(0,-e):this.moveSelectionByDelta(-e,0):this.moveSelectionByDelta(e,0):this.deleteSelection(),this.endDesignOperation()}},getItemAtPoint:function(t){var e=null,i=4;this.paper.view.zoom>1&&(i=0);var n=this;if(t){var r=this.paper.project.hitTest(t,{fill:!0,stroke:!0,tolerance:i,match:function(t){return!(n.mask&&t.item==n.mask||t.item.isClippingArea)}});if(r.item){var a=this.getRootDesignItemCanvasItem(r.item);e=a||r.item}}return e},selectItemAtPoint:function(t){t||this.deselectAll();var e=this.getItemAtPoint(t);!e||e==this.imageItem||e.data&&e.data.isArea?this.deselectAll():this.setItemSelection(e,!0)},selectElement:function(){if(this.hitItem){var t=this.getRootDesignItemCanvasItem(this.hitItem),e=this.getSelectedItems(),i=e.length>0?e[0]:null;if(!this.findDesignItemForItem(t))return void(this.hitItem.data&&this.hitItem.data.isArea&&this.deselectAll());if(t&&(null==i||i!=t)){if(this.element=t,this.isItemStatic(this.element)||t.data&&(t.data.isAreaForBackground||t.data.isGroupForBackground||t.data.isClippingAreaForBackground))return void this.deselectAll();this.deselectAll(),this.setItemSelection(this.element,!0),i&&this.setItemSelection(i,!1)}}else this.deselectAll()},createElement:function(t){!this.frozen&&this.mouseStartPos&&(this.beginDesignOperation(),this.elementType==MPlaza.CustomizerElementType.Rectangle?this.createRectangle(t):this.elementType==MPlaza.CustomizerElementType.Oval?this.createEllipse(t):this.elementType==MPlaza.CustomizerElementType.Free?this.createFreeHand(t):this.elementType==MPlaza.CustomizerElementType.Text&&this.createText(t),this.endDesignOperation())},createRectangle:function(t){if(t.point){var e=t.point;if(this.element&&this.element.remove(),this.mouseStartPos&&e){var i=this.mouseStartPos,n=e;this.element=new this.paper.Path.Rectangle(i,n),this.element.strokeColor="black",this.element.strokeWidth=1,this.element.fillColor="lavender",Logger.info("Rectangle created")}this.paper.project.view.update()}},createEllipse:function(t){if(t.point){var e=t.point;if(this.element&&this.element.remove(),this.mouseStartPos&&e){var i=this.mouseStartPos,n=e,r=new this.paper.Rectangle(i,n);this.element=new this.paper.Path.Ellipse(r),this.element.strokeColor="black",this.element.strokeWidth=1,this.element.fillColor="lavender",Logger.info("Ellipse created")}this.paper.project.view.update()}},createLine:function(t){if(t.point){var e=t.point;if(this.element&&this.element.remove(),this.mouseStartPos&&e){var i=this.mouseStartPos,n=e;this.element=new this.paper.Path.Line(i,n),this.element.strokeColor="black",this.element.strokeWidth=1,Logger.info("Line created")}this.paper.project.view.update()}},createFreeHand:function(t){if(t.point){var e=t.point;if(e){if(!this.element){this.element=new this.paper.Path;new this.paper.Rectangle(e.x-2,e.y-2,4,4);this.element.strokeColor="black",this.element.strokeWidth=1,this.element.fillColor="lavender"}this.element.add(e),this.paper.project.view.update()}}},sendSelectionToBack:function(){this.beginDesignOperation();for(var t=this.getSelectedItems(),e=0;e<t.length;e++){t[e].sendToBack()}this.imageItem&&this.imageItem.sendToBack(),this.onItemsUpdated(t),this.updateItemsIndexes(),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()},bringSelectionToFront:function(){this.beginDesignOperation();for(var t=this.getSelectedItems(),e=0;e<t.length;e++){t[e].bringToFront()}this.onItemsUpdated(t),this.updateItemsIndexes(),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()},moveSelectionToCenter:function(){if(this.canMoveSelection()){this.beginDesignOperation();for(var t=this.getSelectedItems(),e=null,i=0;i<t.length;i++){var n=t[i],r=this.getAreasIntersectingOrContainingItem(n);if(r.length>1||0==r.length)return;if(null==e)e=r[0];else if(e.get("areaID")!=r[0].get("areaID"))return}if(e){var a=this.findItemForArea(e);if(a){for(i=0;i<t.length;i++){n=t[i];var s=a.position.subtract(n.position);n.position.x=a.position.x,n.position.y=a.position.y,n.data.needsTransformsDataUpdate=!0;var o=(new this.paper.Matrix).translate(s.x,s.y);(n instanceof this.paper.Raster||this.getItemIsTextArt(n)||this.isMaskedImage(n))&&n.data&&n.data.originalMatrix&&n.data.originalMatrix.prepend(o),n.data&&n.data.originalPosition&&(n.data.originalPosition=n.data.originalPosition.transform(o)),this.onTextOnPathMoved(n,s),this.onTextAreaMoved(n,s)}this.onItemsUpdated(t),this.updateSelectionState(),this.paper.project.view.update()}}this.endDesignOperation()}},moveSelectionByDelta:function(t,e){if(!this.frozen&&this.canMoveSelection()){var i=!1;this.currentDesignOperation||(this.beginDesignOperation(),i=!0),this.removeSelectionAlertItems();for(var n=new this.paper.Point(t,e),r=this.getSelectedItems(),a=0;a<r.length;a++){r[a].position=r[a].position.add(n);var s=(new this.paper.Matrix).translate(n.x,n.y);(r[a]instanceof this.paper.Raster||this.getItemIsTextArt(r[a])||this.isMaskedImage(r[a]))&&r[a].data&&r[a].data.originalMatrix&&r[a].data.originalMatrix.prepend(s),r[a].data&&r[a].data.originalPosition&&(r[a].data.originalPosition=r[a].data.originalPosition.transform(s)),this.onTextOnPathMoved(r[a],n),this.onTextAreaMoved(r[a],n)}this.onItemsUpdated(r),this.updateSelectionState(),this.paper.project.view.update(),i&&this.endDesignOperation()}},moveSelectionUp:function(){this.canMoveSelection()&&this.moveSelectionByDelta(0,-2)},moveSelectionDown:function(){this.canMoveSelection()&&this.moveSelectionByDelta(0,2)},moveSelectionLeft:function(){this.canMoveSelection()&&this.moveSelectionByDelta(-2,0)},moveSelectionRight:function(){this.canMoveSelection()&&this.moveSelectionByDelta(2,0)},moveSelection:function(t){var e=this;if(!this.frozen&&this.canMoveSelection()&&t.delta){var i=t.delta;this.hideCenterLines(),null!=this.adjustmentDelta&&(i.x-=this.adjustmentDelta.x,i.y-=this.adjustmentDelta.y),!0===this.canMove&&(!1===this.canMoveX&&(i.x=0),!1===this.canMoveY&&(i.y=0)),this.removeSelectionAlertItems();var n=this.getSelectedItems();if(0!=n.length){for(var r=0;r<n.length;r++){var a=n[r];this.getSubItemsToChange(a).forEach(function(t){if(t){t.position.x+=i.x,t.position.y+=i.y;var n=(new e.paper.Matrix).translate(i.x,i.y);t.data&&t.data.originalMatrix&&t.data.originalMatrix.prepend(n),t.data&&t.data.originalPosition&&(t.data.originalPosition=t.data.originalPosition.transform(n))}}),this.onTextOnPathMoved(n[r],i),this.onTextAreaMoved(n[r],i)}this.moveSelectionShapes(i),this.snapToCenter(),this.snapToItems(),this.updateTextOnPathGuides(n),this.updateTextAreaGuides(n),this.updateShapeImagePlaceholders(n),!this.adjustmentDelta||0==this.adjustmentDelta.x&&0==this.adjustmentDelta.y||this.moveSelectionShapes(this.adjustmentDelta);for(r=0;r<n.length;r++)n[r].data.maskPath&&(n[r].data.maskPath.position=n[r].position),n[r].loadingCircle&&(n[r].loadingCircle.position=n[r].bounds.center)}}},cacheSelectedItemConstraints:function(t){var e,i,n;if(t){var r=t.get("constraints");this.canMove=null===(e=null==r?void 0:r.get("canMove"))||void 0===e||e,this.canMoveX=null===(i=null==r?void 0:r.get("canMoveX"))||void 0===i||i,this.canMoveY=null===(n=null==r?void 0:r.get("canMoveY"))||void 0===n||n}},snapToCenter:function(){var t=this;this.adjustmentDelta||(this.adjustmentDelta=new this.paper.Point(0,0)),this.adjustmentDelta.x=0,this.adjustmentDelta.y=0;var e=3/this.paper.view.zoom;if(this.snapCache&&this.snapCache.area&&this.snapCache.areaItem){for(var i=this.snapCache.areaItem,n=this.snapCache.selectedItems,r=i.bounds,a=this.selectionBounds,s=r.center,o=[new this.paper.Point(a.left,a.center.y),a.center,new this.paper.Point(a.right,a.center.y)],l=[new this.paper.Point(a.center.x,a.top),a.center,new this.paper.Point(a.center.x,a.bottom)],h=null,c=null,u=0;u<o.length;u++){var d=o[u].x-s.x,f=Math.abs(d);(null==h||f<h)&&(h=f,c=d)}var g=null,p=null;for(u=0;u<l.length;u++){d=l[u].y-s.y,f=Math.abs(d);(null==g||f<g)&&(g=f,p=d)}var m=null;h<=e&&(m=c);var v=null;g<=e&&(v=p),this.adjustmentDelta.x=null!=m?-m:0,this.adjustmentDelta.y=null!=v?-v:0;for(u=0;u<n.length;u++){var _=n[u];this.getSubItemsToChange(_).forEach(function(e){null!=m&&(e.position.x-=m),null!=v&&(e.position.y-=v);var i=null!=m?(new t.paper.Matrix).translate(-m,0):null,n=null!=v?(new t.paper.Matrix).translate(0,-v):null;e.data&&e.data.originalMatrix&&(i&&e.data.originalMatrix.prepend(i),n&&e.data.originalMatrix.prepend(n)),e.data&&e.data.originalPosition&&(i&&(e.data.originalPosition=e.data.originalPosition.transform(i)),n&&(e.data.originalPosition=e.data.originalPosition.transform(n)))}),null==m&&null==v||(this.onTextOnPathMoved(_,this.adjustmentDelta),this.onTextAreaMoved(_,this.adjustmentDelta))}null==m&&null==v||(null!=m&&this.showVerticalCenterLine(r),null!=v&&this.showHorizontalCenterLine(r))}},snapToItems:function(){var t=this,e=3/this.paper.view.zoom;if(0!=this.snapCache.selectedItems.length&&this.snapCache&&this.snapCache.area&&this.snapCache.areaItem){var i=this.snapCache.areaItem,n=this.snapCache.selectedItems,r=(this.getAllItems(),null),a=null,s=null,o=null;for(C=0;C<this.snapCache.areaItems.length;C++){for(var l=this.snapCache.areaItems[C],h=(l.bounds,n[0].bounds.leftCenter),c=n[0].bounds.rightCenter,u=n[0].bounds.topCenter,d=n[0].bounds.bottomCenter,f=n[0].bounds.center,g=[f,h,c],p=[f,u,d],m=[l.bounds.center,l.bounds.leftCenter,l.bounds.rightCenter],v=[l.bounds.center,l.bounds.topCenter,l.bounds.bottomCenter],_=0;_<g.length;_++){var y=g[_].x,x=m[_].x;if(Math.abs(y-x)<e){r=y-x,s=x,this.adjustmentDelta.x-=r;break}}for(_=0;_<p.length;_++){var b=p[_].y,I=v[_].y;if(Math.abs(b-I)<e){a=b-I,o=I,this.adjustmentDelta.y-=a;break}}if(null!=r||null!=a)break}for(var C=0;C<n.length;C++){var w=n[C];if(this.getSubItemsToChange(w).forEach(function(e){if(null!=r&&(e.position.x-=r),null!=a&&(e.position.y-=a),null!=r||null!=a){var i=null!=r?-r:0,n=null!=a?-a:0,s=(new t.paper.Matrix).translate(i,n);e.data.originalMatrix&&e.data.originalMatrix.prepend(s),e.data.originalPosition&&(e.data.originalPosition=e.data.originalPosition.transform(s))}}),null!=r||null!=a){var S=null!=r?-r:0,M=null!=a?-a:0;this.onTextOnPathMoved(w,new this.paper.Point(S,M)),this.onTextAreaMoved(w,new this.paper.Point(S,M))}}null==r&&null==a||(this.hideCenterLines(),null!=r&&this.showVerticalCenterLine(new this.paper.Rectangle(s-1,i.bounds.topCenter.y,1,i.bounds.bottomCenter.y)),null!=a&&this.showHorizontalCenterLine(new this.paper.Rectangle(i.bounds.leftCenter.x,o,i.bounds.rightCenter.x,1)))}},showVerticalCenterLine:function(t){var e=this.paper.project.view.bounds;this.verticalCenterLine=this.createGuideLine(new this.paper.Point(t.center.x,e.top),new this.paper.Point(t.center.x,e.bottom))},showHorizontalCenterLine:function(t){var e=this.paper.project.view.bounds;this.horizontalCenterLine=this.createGuideLine(new this.paper.Point(e.left,t.center.y),new this.paper.Point(e.right,t.center.y))},createGuideLine:function(t,e){var i=new this.paper.Point(.5/this.paper.view.zoom,.5/this.paper.view.zoom),n=t.add(i),r=e.add(i),a=new this.paper.Path.Line(n,r);return a.strokeColor="blue",a.strokeWidth=1/this.paper.view.zoom,a.dashOffset=.5/this.paper.view.zoom,a.dashArray=[1/this.paper.view.zoom,1/this.paper.view.zoom],a.blendMode="xor",a.removeOn({drag:!0,up:!0}),a.guide=!0,a},hideCenterLines:function(){this.verticalCenterLine&&this.verticalCenterLine.remove(),this.horizontalCenterLine&&this.horizontalCenterLine.remove(),this.verticalCenterLine=null,this.horizontalCenterLine=null},rotateSelection:function(t){var e=this;if(!this.frozen&&this.canRotateSelection()&&t.point){var i=t.point;this.removeSelectionAlertItems(),this.hideCenterLines();var n=this.getSelectedItems();if(1==n.length){var r=n[0],a=i.subtract(this.originalCenter),s=Math.atan2(a.y,a.x)-this.originalAngle;this.restoreSelectionState(this.originalContent);var o=this.selectionBoundsShape.id;this.selectionBoundsShape.importJSON(this.originalShape),this.selectionBoundsShape._id=o;for(var l=s/Math.PI*180,h=[0,90,180,270,360,-90,-180,-270,-360],c=0;c<h.length;c++){var u=h[c],d=r.rotation;r.data.isTextArea&&(d=r.children[0].rotation),Math.abs(l+d-u)<5&&(l=u-d,0!=u&&180!=u&&-180!=u||this.showHorizontalCenterLine(r.bounds),90!=u&&-90!=u||this.showVerticalCenterLine(r.bounds))}if(this.selectionBoundsShape.rotate(l,this.originalCenter),this.createSelectionHandles(),this.placeHandleOut(this.selectionBoundsShape),!r.guide)this.getSubItemsToChange(r).forEach(function(t){if(t.rotate(l,e.originalCenter),t.data.originalMatrix){var i=(new e.paper.Matrix).rotate(l,e.originalCenter);t.data.originalMatrix.prepend(i)}if(t.data.originalPosition){i=(new e.paper.Matrix).rotate(l,e.originalCenter);t.data.originalPosition=t.data.originalPosition.transform(i)}}),this.onTextOnPathRotated(r,l,this.originalCenter),this.onTextAreaRotated(r,l,this.originalCenter),this.updateTextOnPathGuides(n),this.updateTextAreaGuides(n),this.updateShapeImagePlaceholders(n)}}},rotateSelectionAngle:function(t){var e=this;this.removeSelectionAlertItems(),this.restoreSelectionState(this.originalContent);var i=this.selectionBoundsShape.id;this.selectionBoundsShape.importJSON(this.originalShape),this.selectionBoundsShape._id=i,this.selectionBoundsShape.rotate(t,this.originalCenter),this.createSelectionHandles();for(var n=this.getSelectedItems(),r=0;r<n.length;r++){var a=n[r];if(!a.guide)this.getSubItemsToChange(a).forEach(function(i){if(i.rotate(t,e.originalCenter),i.data.originalMatrix){var n=(new e.paper.Matrix).rotate(t,e.originalCenter);i.data.originalMatrix.prepend(n)}if(i.data.originalPosition){n=(new e.paper.Matrix).rotate(t,e.originalCenter);i.data.originalPosition=i.data.originalPosition.transform(n)}}),this.onTextOnPathRotated(a,t,this.originalCenter),this.onTextAreaRotated(a,t,this.originalCenter)}this.updateTextOnPathGuides(n),this.updateTextAreaGuides(n)},resizeSelection:function(t){if(!this.frozen&&this.canResizeSelection()&&(t.point&&(this.removeSelectionAlertItems(),0!=this.getSelectedItems().length))){var e=this.originalScaleCenter.clone(),i=this.corner.subtract(e),n=t.point,r=new this.paper.Point;r.x=n.x-this.selectionResizeHandle.bounds.width/2,r.y=n.y-this.selectionResizeHandle.bounds.width/2;var a=this.projectPointOnLine(e,this.corner,r,!1);if(!(a.subtract(e).length<.1)){var s=a.subtract(this.corner);this.corner.x+=s.x,this.corner.y+=s.y;var o=this.corner.subtract(e),l=1,h=1;Math.abs(i.x)>1e-7&&(l=o.x/i.x),Math.abs(i.y)>1e-7&&(h=o.y/i.y),this.scaleSelectedItems(l,h,e)}}},resizeSelectionTop:function(t){this.resizeSelectionLaterally(t,"top")},resizeSelectionBottom:function(t){this.resizeSelectionLaterally(t,"bottom")},resizeSelectionLeft:function(t){this.resizeSelectionLaterally(t,"left")},resizeSelectionRight:function(t){this.resizeSelectionLaterally(t,"right")},resizeSelectionLaterally:function(t,e){if(!this.frozen&&this.canResizeSelection()&&(t.point&&(this.removeSelectionAlertItems(),0!=this.getSelectedItems().length))){var i=this.originalScaleCenter.clone(),n=this._getResizeCorner(e),r=n.subtract(i),a=t.point,s=this._getResizeCompensatedPoint(e,a),o=0,l=0;"top"===e||"bottom"===e?l=s.y-n.y:o=s.x-n.x,this._moveResizeCorner(e,o,l);var h=n.subtract(i),c=1,u=1;"top"===e||"bottom"===e?u=h.y/r.y:c=h.x/r.x,this.scaleSelectedItems(c,u,i)}},_getResizeCorner:function(t){var e=this.corner;return"top"===t?e=this.cornerTop:"bottom"===t?e=this.cornerBottom:"left"===t?e=this.cornerLeft:"right"===t&&(e=this.cornerRight),e},_moveResizeCorner:function(t,e,i){"top"===t?(this.cornerTop.x+=e,this.cornerTop.y+=i):"bottom"===t?(this.cornerBottom.x+=e,this.cornerBottom.y+=i):"left"===t?(this.cornerLeft.x+=e,this.cornerLeft.y+=i):"right"===t?(this.cornerRight.x+=e,this.cornerRight.y+=i):(this.corner.x+=e,this.corner.y+=i)},_getResizeCompensatedPoint:function(t,e){var i=new this.paper.Point;return"all"===t?(i.x=e.x-this.selectionResizeHandle.bounds.width/2,i.y=e.y-this.selectionResizeHandle.bounds.width/2):(i.x=e.x-this.selectionLateralResizeDimension/2,i.y=e.y-this.selectionLateralResizeDimension/2),i},projectPointOnLine:function(t,e,i,n){var r=new this.paper.Point(0,0);if(t.x==e.x)return r.x=t.x,r.y=i.y,r;if(t.y==e.y)return r.x=i.x,r.y=t.y,r;var a=(e.y-t.y)/(e.x-t.x),s=(e.x*t.y-t.x*e.y)/(e.x-t.x),o=i.y-a*i.x-s;return n?o>0?(r.x=i.x,r.y=a*i.x+s):o<0?(r.y=i.y,r.x=(i.y-s)/a):r=i:o>0?(r.y=i.y,r.x=(i.y-s)/a):o<0?(r.x=i.x,r.y=a*i.x+s):r=i,r},scaleItem:function(t,e,i,n){var r=this;if(t){if(!this.canScaleTextFont(t,e,i))return;var a=this.getSubItemsToChange(t);if(!this.canResizeSelectedTextAreas(e,i,n))return;a.forEach(function(t){if(t.scale(e,i,n),t.data.needsTransformsDataUpdate=!0,t.data.originalMatrix){var a=(new r.paper.Matrix).scale(e,i,n);t.data.originalMatrix.prepend(a)}if(t.data.originalPosition){a=(new r.paper.Matrix).scale(e,i,n);t.data.originalPosition=t.data.originalPosition.transform(a)}}),this.onTextOnPathScaled(t,e,i,n),this.onTextAreaScaled(t,e,i,n),this.updateTextOnPathGuides([t]),this.updateTextAreaGuides([t]),this.updateShapeImagePlaceholders([t]),this.updateSelectionState()}},scaleSelectedItems:function(t,e,i){var n=this;if(t<0||e<0){var r=this.getModelPrintType(this.design.getSelectedPrintTypeForArea(this.side.get("areas").at(0)));if(r&&r.get("printTypeRestrictions")&&!1===r.get("printTypeRestrictions").get("showFlipButtons"))return}if(this.canResizeSelection()&&this.canScaleSelectedTextFont(t,e)&&this.canResizeSelectedTextAreas(t,e,i)){for(var a=this.getSelectedItems(),s=0;s<a.length;s++){var o=a[s];if(!o.guide)this.getSubItemsToChange(o).forEach(function(r){if(r.scale(t,e,i),r.data.needsTransformsDataUpdate=!0,r.data.originalMatrix){var a=(new n.paper.Matrix).scale(t,e,i);r.data.originalMatrix.prepend(a)}if(r.data.originalPosition){a=(new n.paper.Matrix).scale(t,e,i);r.data.originalPosition=r.data.originalPosition.transform(a)}}),this.onTextOnPathScaled(o,t,e,i),this.onTextAreaScaled(o,t,e,i)}this.scaleSelectionShapes(t,e,i),this.updateTextOnPathGuides(a),this.updateTextAreaGuides(a),this.updateShapeImagePlaceholders(a)}},deleteSelection:function(){var t=this;if(this.canDeleteSelection()){this.removeSelectionAlertItems();for(var e,i,n=this.getSelectedItems(),r=function(){if(e=n[s],a.deleteDimensionLabel(e.id),a.isMaskedImage(e)&&!a.isFilledShape(e)&&a.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&a.canDeleteMask(e))a.removeMaskFromImage(e);else if(a.isFilledShape(e)&&a.maskedImageSelectionMode==MaskedImageSelectionMode.Raster)a.removeImageFromShape(e);else{if((i=a.findDesignItemForItem(e))&&a.fireDesignItemRemovingEvent(i,e),e.data&&e.data.isGridImage){var r=e.parent;r&&r.data&&r.data.isGridPathGroup&&a.createGridBoxIcon().then(function(e){var i=r.children.find(function(t){return t.data&&t.data.isGridBorderPath});i&&(i.fillColor=new paper.Color(1,1,1,.9)),r.addChild(e);var n=t.isMobile?Math.min(Math.min(r.bounds.width,r.bounds.height),180):Math.min(.8*Math.min(r.bounds.width,r.bounds.height),66);e.data.isGridIcon=!0,e.position.x=r.position.x,e.position.y=r.position.y,e.scale(n/e.bounds.width,n/e.bounds.height)})}e.remove(),a.onItemRemoved(e),a.removeShapeImagePlaceholder(e),a.setItemSelection(e,!1)}},a=this,s=0;s<n.length;s++)r();this.updateSelectionState(),this.paper.project.view.update()}},editElement:function(){!this.frozen&&this.mouseStartPos&&this.elementType==MPlaza.CustomizerElementType.Text&&this.editText()},updateItemSyncGuid:function(t,e){var i=this.findDesignItemForItem(t);i&&i.set("syncGuid",e)},getContrastedColor:function(t){var e="black";if(this.imageItem){t.height=Math.max(1,t.height),t.width=Math.max(1,t.width);try{var i=this.imageItem.getAverageColor(t);i&&(e=MPlaza.getContrastYIQ(255*i.red,255*i.green,255*i.blue))}catch(t){console.trace("error getting image avarage color "+t.message)}}return e},insertSVGFromUrl:function(t){var e=this;$.ajax({url:t}).done(function(t){e.insertSVG(t)})},insertSVG:function(t){if(this.side){var e=this.side.get("areas").getMaxArea();if(e){var i=this.paper.project.activeLayer.importSVG(t);this.onItemCreated(i),this.detectItemColors(i);var n=this.findItemForArea(e);if(n){i.position=n.position;var r=i.bounds,a=n.bounds;if(a.intersects(r)||r.contains(a)){var s=a.clone();s.width*=.8,s.height*=.8;var o=1,l=1;Math.abs(s.width)>1e-7&&(o=s.width/r.width),Math.abs(s.height)>1e-7&&(l=s.height/r.height);var h=o>0?1:-1,c=l>0?1:-1;o=l=Math.min(Math.abs(o),Math.abs(l)),o*=h,l*=c,i.scale(o,l),this.masterGroup.addChild(i),this.updateItemsIndexes(),this.onItemUpdated(i),this.onDesignItemChanged(i),this.mask&&this.mask.bringToFront}}}}},detectItemColors:function(t){var e=[],i=function(t){if(t.fillColor){var n=t.fillColor.toCSS(!0);-1===e.indexOf(n)&&e.push(n)}if(t.children)for(var r=0;r<t.children.length;r++){var a=t.children[r];i(a)}};i(t);for(var n=0;n<e.length;n++)Logger.info("Color: "+e[n])},resetShadows:function(t){var e=this,i=this.getLastUndoOperationId();this.beginDesignOperation(),t.filter(this.getItemIsTextElement).forEach(function(t){return e.resetTextElementShadow(t)}),t.filter(this.getItemIsTextArt).forEach(function(t){return e.resetTextArtShadow(t)}),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(i)},insertTextArt:function(t,e){if(t&&this.canAddTextArt()){this.beginDesignOperation();var i=this;Zakeke.Customizer.TextArt.createTextArtPath(t.typrFont,t.opentypeFont,t.text,void 0,void 0,t.config).then(function(n){if(n&&i.side){var r=i.side.get("areas").getMaxArea();if(r){var a=i.getDesignEffectForArea(r);i.allowShadows()||(t.style.shadowColor=null);var s=null!=t.style.strokeWidth?t.style.strokeColor:void 0,o=t.style.fillColor,l=t.style.shadowColor;s=i.forceColorInFixedPalette(null,s),o=i.forceColorInFixedPalette(null,o),l=i.forceColorInFixedPalette(null,l),t.style.strokeColor=i.applyDesignEffectToTextColor(a,s),t.style.fillColor=i.applyDesignEffectToTextColor(a,o),t.style.shadowColor=i.applyDesignEffectToTextColor(a,l),t.style.shadowBlur=i.adjustInputShadowBlur(null,t.style.shadowBlur),t.style.shadowDistance=i.adjustInputShadowDistance(null,t.style.shadowDistance),t.style.shadowAngle=i.adjustInputShadowDistance(null,t.style.shadowAngle);var h=new i.paper.CompoundPath(n);i.applyStyleToItem(h,t.style),h.applyMatrix=!0,h.data={},h.data.isTextArt=!0,h.data.originalBounds=h.bounds,h.data.originalMatrix=new i.paper.Matrix,h.data.originalStrokeColor=s,h.data.originalFillColor=o,h.data.originalShadowColor=l,i.applyDesignEffectToItem(a,h);i.onTextArtItemCreated(h,t);var c=i.findItemForArea(r);if(c){var u=c.position.subtract(h.position);h.position.x+=u.x,h.position.y+=u.y;var d=(new i.paper.Matrix).translate(u.x,u.y);h.data.originalMatrix.prepend(d);var f=h.bounds,g=c.bounds;if(g.intersects(f)||f.contains(g)){var p=g.clone();p.width*=.8,p.height*=.8;var m=1,v=1;Math.abs(p.width)>1e-7&&(m=p.width/f.width),Math.abs(p.height)>1e-7&&(v=p.height/f.height);var _=m>0?1:-1,y=v>0?1:-1;m=v=Math.min(Math.abs(m),Math.abs(v)),m*=_,v*=y,h.scale(m,v),d=(new i.paper.Matrix).scale(m,v),h.data.originalMatrix.prepend(d),i.masterGroup.addChild(h),i.onItemUpdated(h),i.updateItemsIndexes(),i.onDesignItemChanged(h),i.fireTextArtLoadedEvent(),i.mask&&i.mask.bringToFront(),e&&e(h),i.endDesignOperation()}}}}})}},buildTextArtPathElement:function(t,e){return'<path xmlns="http://www.w3.org/2000/svg" d="'+t+'" />'},replaceSelectedTextArt:function(t,e){if(t&&this.design){var i=this.getSelectedTextArtItems();if(i&&i.length>0){var n=i[0];if(!this.canEditItem(n))return;this.replaceTextArt(n,t,e)}}},replaceItemTextArt:function(t,e,i){if(t&&this.design&&e){if(!this.canEditItem(e))return;this.replaceTextArt(e,t,i)}},replaceTextArtByGuid:function(t,e,i){var n=this.findItemByGuid(t);n&&this.replaceTextArt(n,e,i)},replaceTextArt:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,a){if(n.canEditItem(t)){var s=n;e.text=n.adjustInputTextByConstraints(t,e.text)||e.text,n.beginDesignOperation(),Zakeke.Customizer.TextArt.createTextArtPath(e.typrFont,e.opentypeFont,e.text,void 0,void 0,e.config).then(function(n){if(n){var a=s.findDesignItemByGuid(t.data.guid);if(a){var o=s.getDesignEffectForDesignItem(a);s.allowShadows()||(e.style.shadowColor=null);var l=null!=e.style.strokeWidth?e.style.strokeColor:void 0,h=e.style.fillColor,c=e.style.shadowColor;l=s.forceColorInFixedPalette(t,l),h=s.forceColorInFixedPalette(t,h),c=s.forceColorInFixedPalette(t,c),e.style.strokeColor=s.applyDesignEffectToTextColor(o,l),e.style.fillColor=s.applyDesignEffectToTextColor(o,h),e.style.shadowColor=s.applyDesignEffectToTextColor(o,c),e.style.shadowBlur=s.adjustInputShadowBlur(t,e.style.shadowBlur),e.style.shadowDistance=s.adjustInputShadowDistance(t,e.style.shadowDistance),e.style.shadowAngle=s.adjustInputShadowDistance(t,e.style.shadowAngle);var u=t.bounds.width,d=t.bounds.height,f=new s.paper.CompoundPath(n);f.visible=!1,s.applyStyleToItem(f,e.style),f.transform(t.data.originalMatrix),f.position=t.position,t.removeChildren(),t.copyContent(f);var g=t.data;t.copyAttributes(f),t.data=g,t.visible=!0,t.data.originalStrokeColor=l,t.data.originalFillColor=h,t.data.originalShadowColor=c,t.data.isProfanityCheckInvalid=!1,s.removeProfanityCheckInvalidOverlayAndEdgeForItem(t),f.remove();var p=t.bounds.width,m=t.bounds.height,v=1,_=1;p>0&&Math.abs(u)>1e-7&&(v=u/p),m>0&&Math.abs(d)>1e-7&&(_=d/m),t.scale(v,_);var y=(new s.paper.Matrix).scale(v,_);t.data.originalMatrix.prepend(y),s.onTextArtItemUpdated(t,e),s.updateSelectionState(),s.paper.project.view.update(),s.endDesignOperation(),i&&i(t),s.fireTextArtLoadedEvent(),r()}}})}})];case 1:return r.sent(),[2]}})})},changeTextArtStyle:function(t,e){if(this.canEditItem(t)&&t&&t instanceof this.paper.Item){this.beginDesignOperation();var i=this.findDesignItemByGuid(t.data.guid),n=this.getDesignEffectForDesignItem(i);this.allowShadows()||(e.shadowColor=null);var r=e.strokeColor,a=e.fillColor,s=e.shadowColor;r=this.forceColorInFixedPalette(t,r),a=this.forceColorInFixedPalette(t,a),s=this.forceColorInFixedPalette(t,s),e.strokeColor=this.applyDesignEffectToTextColor(n,r),e.fillColor=this.applyDesignEffectToTextColor(n,a),e.shadowColor=this.applyDesignEffectToTextColor(n,s),e.shadowBlur=this.adjustInputShadowBlur(t,e.shadowBlur),e.shadowDistance=this.adjustInputShadowDistance(t,e.shadowDistance),e.shadowAngle=this.adjustInputShadowAngle(t,e.shadowAngle),this.applyStyleToItem(t,e),t.data.originalStrokeColor=r,t.data.originalFillColor=a,t.data.originalShadowColor=s,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()}},applyStyleToItem:function(t,e){if(t&&t instanceof this.paper.Item&&(null!=e.strokeColor&&(t.strokeColor=e.strokeColor),null!=e.strokeWidth&&(t.strokeWidth=e.strokeWidth),e.strokeCap&&(t.strokeCap=e.strokeCap),e.strokeJoin&&(t.strokeJoin=e.strokeJoin),null!=e.dashOffset&&(t.dashOffset=e.dashOffset),e.dashArray&&(t.dashArray=e.dashArray),e.fillColor&&!this.isFilledShape(t)&&(t.fillColor=e.fillColor),null!=e.shadowColor&&!this.isShape(t)&&!this.isMaskedImageShapeItem(t)&&!this.isMaskedImageMaskItem(t))){t.shadowColor=e.shadowColor,t.shadowBlur=e.shadowBlur;var i=0,n=0;e.hasOwnProperty("shadowDistance")&&(i=e.shadowDistance),e.hasOwnProperty("shadowAngle")&&(n=e.shadowAngle),t.shadowOffset=this.getOffsetByDistanceAngle(i,n)}},getAllTextArtItems:function(){var t=this;return this.getAllItems().filter(function(e){return t.getItemIsTextArt(e)})},resetTextArtShadow:function(t){if(t&&t.data&&t.data.guid&&t.data.isTextArt){var e=this.findDesignItemByGuid(t.data.guid);if(e){this.beginDesignOperation();var i=this.getDesignEffectForDesignItem(e),n=this.getTextArtItemInfo(t);this.allowShadows()||(n.style.shadowColor=null);var r=n.style.shadowColor;r=this.forceColorInFixedPalette(t,r),n.style.shadowColor=this.applyDesignEffectToTextColor(i,r),n.style.shadowBlur=this.adjustInputShadowBlur(t,n.style.shadowBlur),n.style.shadowDistance=this.adjustInputShadowDistance(t,n.style.shadowDistance),n.style.shadowAngle=this.adjustInputShadowDistance(t,n.style.shadowAngle),this.applyStyleToItem(t,n.style),t.data.originalShadowColor=r,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()}}},_getRandomColor:function(){return"#"+(16777215*Math.random()<<0).toString(16).padStart(6,"0")},isImageAutofitEnabled:function(t){var e=this.side.get("areas").at(0),i=this.getModelPrintType(this.design.getSelectedPrintTypeForArea(e));return!!i&&(!!i.get("printTypeRestrictions")&&1==i.get("printTypeRestrictions").get("upload"==t?"imageInsertScalingUpload":"imageInsertScalingCliparts"))},isFixedFontListEnabled:function(t){var e,i=this.side.get("areas").at(0),n=this.getModelPrintType(this.design.getSelectedPrintTypeForArea(i));return!!n&&(!!n.get("printTypeRestrictions")&&(null===(e=n.get("printTypeRestrictions").get("fontSizeList"))||void 0===e?void 0:e.length)>0)},insertImageById:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r;return __generator(this,function(a){switch(a.label){case 0:return i=this,(n=new MPlaza.Image).set("imageID",t),[4,new Promise(function(t){n.fetch({success:function(e){t(e)}})})];case 1:return r=a.sent(),[4,i.insertImage(r,e)];case 2:return a.sent(),[2]}})})},insertImage:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S=this;return __generator(this,function(M){switch(M.label){case 0:return i=null,t&&t instanceof MPlaza.Image?this.canAddImage()?(this.beginDesignOperation(),n="",!this.isImageScalingEnabled&&"svg"!=t.get("format").toLowerCase()&&"vector"!=t.get("type").toLowerCase()&&["png","jpg","jpeg"].find(function(e){return e==t.get("format").toLowerCase()})&&(n=t.get("url")),n||(n=t.get("previewUrl")),n?this.side&&(r=this.side.get("areas").getMaxArea())?(a=n,s=this.getDesignEffectForArea(r),[4,this.applyDesignEffectToImageUrl(s,n)]):[3,7]:[2]):[2]:[2];case 1:return n=M.sent(),e?[3,3]:[4,this.getImageDefaultColorMappings(n,null)];case 2:e=M.sent(),M.label=3;case 3:return e&&e.length>0?[4,this.recolorImage(n,e)]:[3,5];case 4:n=M.sent(),M.label=5;case 5:return[4,this.createRasterItem(n)];case 6:(i=M.sent()).data.originalUrl=a,this.applyDesignEffectToItem(s,i),o=this.onItemCreated(i,t),this.updateDesignItemColorMappings(o,e),l=this.getCurrentModel(),(h=this.findItemForArea(r))&&(i.position=h.interiorPoint,h.contains(i.position)||((c=this.side.get("areas").map(function(t){return S.findItemForArea(t)}).sort(function(t,e){return t.bounds.area-e.bounds.area}).at(0))instanceof paper.CompoundPath&&c.children.length>0?(u=c.children.sort(function(t,e){return t.area-e.area}).at(0),i.position=u.interiorPoint):i.position=c.interiorPoint),d=i.bounds,((f=h.bounds).intersects(d)||d.contains(f))&&(g=t.get("customerID")>0||t.get("visitorID")>0,p=this.isImageAutofitEnabled(g?"upload":"cliparts")?1:.8,(m=f.clone()).width*=p,m.height*=p,v=1,_=1,Math.abs(m.width)>1e-7&&(v=m.width/d.width),Math.abs(m.height)>1e-7&&(_=m.height/d.height),y=v>0?1:-1,x=_>0?1:-1,v=_=this.isImageAutofitEnabled(g?"upload":"cliparts")?Math.max(Math.abs(v),Math.abs(_)):Math.min(Math.abs(v),Math.abs(_)),v*=y,_*=x,l&&this.design&&this.design instanceof MPlaza.Design&&l.get("printTypes")instanceof MPlaza.PrintTypes&&this.isImagesFixedSizeEnabled()&&o.get("imagePreferredWidth")&&o.get("imagePreferredHeight")&&(b=this.side.get("ppcm"),I=b/10,C=o.get("imagePreferredWidth")*I,w=o.get("imagePreferredHeight")*I,v=C/d.width,_=w/d.height),i.scale(v,_),i.data.originalBounds=new this.paper.Rectangle(0,0,i.width,i.height),i.data.originalMatrix=i.matrix.clone(),this.onItemUpdated(i),this.onDesignItemChanged(i))),this.masterGroup.addChild(i),this.onItemUpdated(i),this.updateItemsIndexes(),this.onDesignItemChanged(i),this.fireImageLoadedEvent(),this.mask&&this.mask.bringToFront(),this.endDesignOperation(),M.label=7;case 7:return[2,i]}})})},isImagesFixedSizeEnabled:function(){var t,e,i=this.side.get("areas").at(0);if(i){var n=this.getCurrentModel(),r=this.getSelectedPrintType(i),a=n.get("printTypes").getPrintType(this.design.getSelectedPrintTypeForArea(i));r||(r=n.get("printTypes").getPrintType(this.design.getSelectedPrintTypeForArea(i)));var s=null;if(r instanceof MPlaza.PartPrintType){var o=r.get("restrictions");s=o?o.get("useImagesFixedSize"):null}return null==s&&(s=null!==(t=null==a?void 0:a.get("useImagesFixedSize"))&&void 0!==t?t:null===(e=a.get("printTypeRestrictions"))||void 0===e?void 0:e.get("useImagesFixedSize")),s}return!1},replaceSelectedImage:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(r){switch(r.label){case 0:return t&&t instanceof MPlaza.Image&&this.design&&t.get("previewUrl")?(i=this.getSelectedImageItems())&&i.length>0?(n=i[0],this.canEditItem(n)?[4,this.replaceImage(n,t,e)]:[2,n]):[3,2]:[2,null];case 1:return r.sent(),[2,n];case 2:return[2,null]}})})},replaceImageByGuid:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return(n=this.findItemByGuid(t))?[4,this.replaceImage(n,e,i)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2,n]}})})},replaceImage:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x;return __generator(this,function(b){switch(b.label){case 0:return this.canEditItem(t)&&(n=e.get("previewUrl"))?(t.data.isTemplateElement&&(t.data.isTemplateElement=!1),this.beginDesignOperation(),r=this.findDesignItemByGuid(t.data.guid),t.data.isSVGRecolored&&(t.data.isSVGRecolored=!1),t.data.isProfanityCheckInvalid=!1,this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t),r&&(r.get("imageID")!==e.get("imageID")||n.startsWith("data:"))?(this.getMaskedImageShapeItem(t),(a=this.getMaskedImageRasterItem(t))?(s=a.width,o=a.height,a.data.originalBounds&&a.data.originalMatrix&&((l=new this.paper.Path.Rectangle(a.data.originalBounds)).visible=!1,l.matrix=a.data.originalMatrix.clone(),h=this.getRectangleItemSize(l),l.remove(),s=h.width,o=h.height),c=a.matrix,u=this.getDesignEffectForDesignItem(r),d=n,[4,this.applyDesignEffectToImageUrl(u,n)]):[3,7]):[3,7]):[2,t];case 1:return n=b.sent(),i?[3,3]:[4,this.getImageDefaultColorMappings(n,t)];case 2:i=b.sent(),b.label=3;case 3:return i&&i.length>0?[4,this.recolorImage(n,i)]:[3,5];case 4:n=b.sent(),b.label=5;case 5:return[4,this.changeRasterItem(a,n)];case 6:b.sent(),a.data.originalUrl=d,this.applyDesignEffectToItem(u,t),a.matrix=c,(f=new this.paper.Path.Rectangle(0,0,a.width,a.height)).visible=!1,f.matrix=c.clone(),g=this.getRectangleItemSize(f),f.remove(),p=1,m=1,this.isImagesFixedSizeEnabled()&&e.get("preferredWidth")&&e.get("preferredHeight")?(v=this.side.get("ppcm")/10,g.width=e.get("preferredWidth")*v,g.height=e.get("preferredHeight")*v,p=g.width/t.bounds.width,m=g.height/t.bounds.height):(_=g.width,y=g.height,_==s&&y==o||(Math.abs(_)>1e-7&&(p=s/_),Math.abs(y)>1e-7&&(m=o/y))),x=Math.min(p,m),a.scale(x,x),r.get("colors").reset(),this.updateDesignItemColorMappings(r,i),this.onImageItemUpdated(t,e,this.createDummyShapeFromDesignItem(r)),this.updateSelectionState(),this.paper.project.view.update(),this.fireImageLoadedEvent(),b.label=7;case 7:return this.endDesignOperation(),[2,t]}})})},updateItemsIndexes:function(){var t=this,e=this.design.getSideDesignItems(this.side).sort(function(t,e){return t.get("index")>e.get("index")}).map(function(e){return t.findItemForDesignItem(e)});e.forEach(function(e){null==e||e.bringToFront(),t.updateShapeImagePlaceholder(e)});var i=e.filter(function(e){return t.isAlwaysOnTop(e)});i.forEach(function(t){return t.bringToFront()}),i.forEach(function(e){return t.onItemUpdated(e)}),this.getAllGridItems().forEach(function(t){return t.sendToBack()});var n=this.getAllItems().filter(function(t){return t.data&&t.data.isGroupForBackground});n.forEach(function(t){return t.sendToBack()}),n.forEach(function(e){return e.children.forEach(function(e){e.data&&(e.data.isImageForBackground||e.data.isAreaForBackground)&&(e.sendToBack(),t.onItemUpdated(e))})});var r=[];!function t(e){if(e.children)for(var i=0;i<e.children.length;i++){var n=e.children[i];n.data&&n.data.isGroupForBackground?r.push(n):t(n)}}(this.masterGroup),r.forEach(function(t){t.sendToBack()})},getRectangleItemSize:function(t){var e=0,i=0,n=t.segments;if(4==n.length){var r=n[0].point,a=n[1].point,s=n[2].point;n[3].point;e=s.subtract(a).length,i=r.subtract(a).length}return new this.paper.Size(e,i)},modifySelectedImageElementColors:function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return(e=this.getSelectedItems())&&e.length>0?(i=e[0],[4,this.modifyImageElementColors(i,t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},setImageSizeManually:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h,c,u;return __generator(this,function(d){return(i=this.getSelectedItems())&&i.length>0&&(n=i[0],r=this.side.get("ppcm"),a=n.bounds.height/n.bounds.width,s=t,o=e,t||e?(t?e||(o=t*a):s=e/a,s=s*r*("cm"===this.unitOfMeasurement?1:2.54),o=o*r*("cm"===this.unitOfMeasurement?1:2.54)):(s=n.bounds.width,o=n.bounds.height),l=s/n.bounds.width,h=o/n.bounds.height,n.scale(l,h),n.data.originalMatrix&&(c=n.bounds.center,u=(new this.paper.Matrix).scale(l,h,c),n.data.originalMatrix.prepend(u)),n.data.needsTransformsDataUpdate=!0,this.onItemUpdated(n),this.onDesignItemChanged(n),this.deselectAll(),this.setItemSelection(n,!0)),[2]})})},modifyImageElementColors:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v;return __generator(this,function(_){switch(_.label){case 0:if(i=this.getMaskedImageRasterItem(t),n=this.side,!(this.design&&t&&i&&"[object Array]"===Object.prototype.toString.call(e)))return[3,7];if(r=this.findDesignItemByGuid(t.data.guid),a=r.clone(),!(r&&r instanceof MPlaza.DesignItem&&r.get("imageID")>0))return[3,7];for(this.beginDesignOperation(),s=r.get("imageID"),(o=new MPlaza.RecoloredImage).set("imageID",s),o.set("versionKey","preview"),l=0;l<e.length;l++)(v=e[l])instanceof MPlaza.ColorChange?o.get("colorChanges").push(v):v.hasOwnProperty("colorID")&&v.hasOwnProperty("code")&&(h=new MPlaza.ColorChange(v),o.get("colorChanges").push(h));return[4,new Promise(function(t,e){o.save(null,{success:function(i,n,r){i&&i.get("imageID")?t(o.get("imageUrl")):e("Errore nella lettura dei dati! "+i.get("message"))},error:function(t,i,n){e("Errore nella lettura dei dati")}})})];case 1:return(c=_.sent())&&this.side==n?(u=i.matrix,d=c,f=this.getDesignEffectForDesignItem(r),g=d,[4,this.applyDesignEffectToImageUrl(f,d)]):[3,7];case 2:return d=_.sent(),[4,this.getImageDefaultColorMappings(d,t)];case 3:return(p=_.sent())&&p.length>0?[4,this.recolorImage(d,p)]:[3,5];case 4:d=_.sent(),_.label=5;case 5:return this.updateDesignItemColorMappings(r,p),[4,this.changeRasterItem(i,d)];case 6:for(_.sent(),i.data.originalUrl=g,this.applyDesignEffectToItem(f,t),i.matrix=u,m=0;m<e.length;m++)(v=e[m])instanceof MPlaza.ColorChange?(r.changeColor(s,v.get("colorID"),v.get("code")),t.data.isSVGRecolored=!0):v.hasOwnProperty("colorID")&&v.hasOwnProperty("code")&&(r.changeColor(s,v.colorID,v.code),t.data.isSVGRecolored=!0);this.updateDesignItemColors(r,r.get("colors").map(function(t){return t.get("colorCode")})),this.registerItemOperation("update",r.get("itemGuid"),a,r),console.log("item: ",t),this.onItemUpdated(t),this.onDesignItemChanged(t),this.updateSelectionState(),this.paper.project.view.update(),this.fireImageLoadedEvent(),this.endDesignOperation(),_.label=7;case 7:return[2]}})})},modifySelectedImageElementsColors:function(t){if(this.design&&"[object Array]"===Object.prototype.toString.call(t)){var e=this,i=this.getSelectedImageItems();if(0==i.length)return;this.beginDesignOperation();for(var n=null,r={},a=0;a<i.length;a++){var s=i[a],o=this.findDesignItemByGuid(s.data.guid),l=o.get("imageID");if(null==n)n=l;else if(n!=l)return;r[s.data.guid]=o}try{var h=new MPlaza.RecoloredImage;h.set("imageID",n),h.set("versionKey","preview");for(a=0;a<t.length;a++){var c=t[a];if(c instanceof MPlaza.ColorChange)h.get("colorChanges").push(c);else if(c.hasOwnProperty("colorID")&&c.hasOwnProperty("code")){var u=new MPlaza.ColorChange(c);h.get("colorChanges").push(u)}}h.save(null,{success:function(a,s,o){a&&a.get("imageID")?(Logger.info("Immagine letta correttamente"),function(a,s){if(a)for(var o,l,h,c="data:image/png;base64,"+a,u=function(){o=i[d],l=r[o.data.guid],e.updateDesignItemColors(l,s);var a=e.getMaskedImageRasterItem(o);h=a.matrix,a.crossOrigin="anonymous",a.source=c,a.onLoad=function(){a.matrix=h;for(var i=0;i<t.length;i++){var r=t[i];r instanceof MPlaza.ColorChange?l.changeColor(n,r.get("colorID"),r.get("code")):r.hasOwnProperty("colorID")&&r.hasOwnProperty("code")&&l.changeColor(n,r.colorID,r.code)}e.onItemUpdated(o),e.updateSelectionState(),e.paper.project.view.update(),e.fireImageLoadedEvent(),this.beginDesignOperation()}},d=0;d<i.length;d++)u()}(h.get("imageData"),h.get("imageColors"))):Logger.info("Errore nella lettura dei dati! "+a.get("message"))},error:function(t,e,i){Logger.info("Errore nella lettura dei dati")}})}catch(t){Logger.info(t)}}},setEditingItem:function(t,e){if(t&&null!=e&&(this.removeLoadingCircle(t),e)){var i=this.getAreasIntersectingOrContainingItem(t);i&&i.length>0&&this.createLoadingCircle(t,t.bounds.center)}},createLoadingCircle:function(t,e){if(!e)return null;var i=25/this.paper.view.zoom,n=Zakeke.config.baseUrl+"/images/customizer/loading-circle.png",r=new this.paper.Raster({source:n,position:e}),a=function(){var t=r.size,e=new this.paper.Size(i,i),n=1,a=1;Math.abs(t.width)>1e-7&&(n=e.width/t.width),Math.abs(t.height)>1e-7&&(a=e.height/t.height),r.scale(n,a)};return r.size.width>0&&r.size.height>0?a():r.onLoad=function(){a()},r.data.isLoadingCircle=!0,t.loadingCircle=r,this.loadingCircles.push(r),r},removeLoadingCircle:function(t){if(t&&t.hasOwnProperty("loadingCircle")&&t.loadingCircle){var e=t.loadingCircle;this.loadingCircles=this.loadingCircles.filter(function(t){return t!=e}),e.remove(),t.loadingCircle=null}},getItemIsImage:function(t){return this.isImage(t)||this.isMaskedImage(t)},scaleBgImage:function(t,e){this.beginDesignOperation();var i=this.getOrCreateBackgroundGroupItem(t).children.find(function(t){return t.data&&t.data.isImageForBackground});i&&(i.scaling=new this.paper.Point(e,e),this.onItemUpdated(i),this.updateSelectionState(),this.paper.view.update(),this.endDesignOperation())},insertImageAsBackground:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x=this;return __generator(this,function(b){switch(b.label){case 0:return n=null,r=null,t&&t instanceof MPlaza.Image?(a=this.findItemForArea(e),s=this.getOrCreateBackgroundGroupItem(a),(o=s.children.find(function(t){return t.data&&t.data.isAreaForBackground}))&&((d=this.findDesignItemForItem(o))&&(r=d.get("syncGuid")),o.remove(),this.onItemRemoved(o)),l="",!this.isImageScalingEnabled&&"svg"!=t.get("format").toLowerCase()&&"vector"!=t.get("type").toLowerCase()&&["png","jpg","jpeg"].find(function(e){return e==t.get("format").toLowerCase()})&&(l=t.get("url")),l||(l=t.get("previewUrl")),l?this.side&&e?(this.beginDesignOperation(),h=l,c=this.getDesignEffectForArea(e),[4,this.applyDesignEffectToImageUrl(c,l)]):[3,7]:[2,n]):[2,n];case 1:return l=b.sent(),i?[3,3]:[4,this.getImageDefaultColorMappings(l,null)];case 2:i=b.sent(),b.label=3;case 3:return i&&i.length>0?[4,this.recolorImage(l,i)]:[3,5];case 4:l=b.sent(),b.label=5;case 5:return[4,this.createRasterItem(l,!1)];case 6:(n=b.sent()).data.originalUrl=h,this.applyDesignEffectToItem(c,n),n.data.originalImageID=t.id,n.data.isImageForBackground=!0,n.data.areaGuid=s.data.areaGuid,u=null,s.children.forEach(function(t){if(t.data.isImageForBackground){var e=x.findDesignItemForItem(t);e&&(r=e.get("syncGuid"),u=e.get("constraints")),t.remove(),x.onItemRemoved(t)}}),this.onItemCreated(n,t),(d=this.findDesignItemForItem(n)).set("syncGuid",r),this.updateDesignItemColorMappings(d,i),u&&d.setConstraintsFromSource(u),a&&(n.position=a.position,f=n.bounds,((g=a.bounds).intersects(f)||f.contains(g))&&(p=g.clone(),m=1,v=1,Math.abs(p.width)>1e-7&&(m=p.width/f.width),Math.abs(p.height)>1e-7&&(v=p.height/f.height),_=m>0?1:-1,y=v>0?1:-1,m=v=Math.max(Math.abs(m),Math.abs(v)),m*=_,v*=y,n.scale(m,v),n.visible=!0,n.data.initialScaleX=m,n.data.initialScaleY=v,n.data.originalBounds=new this.paper.Rectangle(0,0,n.width,n.height),n.data.originalMatrix=n.matrix.clone())),s.addChild(n),this.updateItemsIndexes(),this.onItemUpdated(n),this.onDesignItemChanged(n),this.fireImageLoadedEvent(),this.endDesignOperation(),b.label=7;case 7:return[2,n]}})})},removeBackgroundColorArea:function(t){var e=this;this.beginDesignOperation(),this.getOrCreateBackgroundGroupItem(t).children.forEach(function(t){if(t.data.isImageForBackground||t.data.isAreaForBackground){var i=e.findDesignItemForItem(t);e.fireDesignItemRemovingEvent(i,t),t.remove(),e.onItemRemoved(t)}}),this.endDesignOperation()},changeBackgroundColorArea:function(t,e,i){this.beginDesignOperation();var n=this,r=null,a=this.getOrCreateBackgroundGroupItem(t);a.children.forEach(function(t){if(t.data.isImageForBackground||t.data.isAreaForBackground){var e=n.findDesignItemForItem(t);e&&(r=e.get("syncGuid")),t.remove(),i(t),n.onItemRemoved(t)}});var s=a.children.find(function(t){return t.data&&t.data.isAreaForBackground});if(!s){var o=Math.max(a.children[0].bounds.width,a.children[0].bounds.height);s=new this.paper.Path.Rectangle(a.children[0].bounds.point,new this.paper.Size(o,o));var l=new this.paper.Point(s.position.x-(o-a.children[0].bounds.width)/2,s.position.y-(o-a.children[0].bounds.height)/2);s.position=l,s.data={guid:MPlaza.generateUUID(),areaGuid:t.data.guid,isAreaForBackground:!0},s.strokeWidth=0,s.visible=!0,a.addChild(s),this.onItemCreated(s)}var h=n.findDesignItemForItem(s);h.set("syncGuid",r),s.fillColor=e;var c=this.getDesignEffectForDesignItem(h);return this.applyDesignEffectToItem(c,s),this.onItemUpdated(s),this.endDesignOperation(),s},getOrCreateBackgroundGroupItem:function(t){var e;if(function i(n){if(n.children)for(var r=0;r<n.children.length;r++){var a=n.children[r];if(a.data&&a.data.areaGuid===t.data.guid&&a.data.isGroupForBackground)return void(e=a);i(a)}}(this.masterGroup),!e){var i=t.clone();i.data={guid:MPlaza.generateUUID(),areaGuid:t.data.guid,isClippingAreaForBackground:!0},i.strokeWidth=0,i.visible=!0,(e=new this.paper.Group(i)).clipped=!0,e.data={guid:MPlaza.generateUUID(),areaGuid:t.data.guid,isGroupForBackground:!0},e.addChild(i),this.masterGroup.addChild(e),e.sendToBack()}return e},getAllTextItems:function(){var t=this;return this.getAllItems().filter(function(e){return t.getItemIsTextElement(e)})},setEditTextCallback:function(t){this.editTextCallback=t},textInfoModified:function(t){t&&this.mouseStartPos&&(this.element?this.modifyTextElement(this.element,t):this.addTextElement(this.mouseStartPos,t),this.element=null)},createText:function(t){if(this.canAddText()&&this.editTextCallback){var e={text:"",strokeColor:"#000000",strokeWidth:0,fillColor:"#000000",fontFamily:"Arial",fontSize:12,fontWeight:"normal",justification:"left",shadowColor:null,shadowBlur:0,shadowDistance:7,shadowAngle:45},i=this;this.editTextCallback(e,function(t){i.textInfoModified(t)})}},editText:function(){if(this.selectElement(),this.canEditSelection()&&this.element&&this.element instanceof this.paper.TextItem&&this.editTextCallback){var t={};t.text=this.element.content,t.strokeColor=this.element.strokeColor.toCSS(!0),t.strokeWidth=this.element.strokeWidth,t.fillColor=this.element.fillColor.toCSS(!0),t.fontFamily=this.element.fontFamily,t.fontSize=this.element.fontSize,t.fontWeight=this.element.fontWeight,t.justification=this.element.justification,t.shadowColor=this.element.shadowColor,t.shadowBlur=this.element.shadowBlur,t.shadowDistance=this.getOffsetDistance(this.element.shadowOffset),t.shadowAngle=this.getOffsetAngle(this.element.shadowOffset);var e=this;this.editTextCallback(t,function(t){e.textInfoModified(t)})}},addTextElement:function(t,e,i,n){var r=this;if(void 0===i&&(i=!1),void 0===n&&(n=null),!i&&!this.canAddText())return null;var a=null;if(this.side){var s=this.side.get("areas").getMaxArea();if(s){var o=this.getDesignEffectForArea(s);if(e&&e.text){this.beginDesignOperation(),this.deselectAll(),this.updateSelectionState(),this.allowShadows()||(e.shadowColor=null);var l=e.strokeColor||"#000000",h=e.fillColor||"#000000",c=e.shadowColor||null;if(l=this.forceColorInFixedPalette(null,l),h=this.forceColorInFixedPalette(null,h),c=this.forceColorInFixedPalette(null,c),e.shadowBlur=this.adjustInputShadowBlur(null,e.shadowBlur),e.shadowDistance=this.adjustInputShadowDistance(null,e.shadowDistance),e.shadowAngle=this.adjustInputShadowAngle(null,e.shadowAngle),null!=e.fontSize&&null!=e.fontSize&&"string"==typeof e.fontSize&&(e.fontSize=parseInt(e.fontSize)),(a=new this.paper.PointText({rotation:e.rotation||0,content:e.text,strokeColor:this.applyDesignEffectToTextColor(o,l),strokeWidth:null!=e.strokeWidth?e.strokeWidth:0,fillColor:this.applyDesignEffectToTextColor(o,h),fontFamily:this.sanitizeFontFamilyName(e.fontFamily)||"Verdana",fontWeight:e.fontWeight||"normal normal",fontStretch:e.fontStretch||"normal",fontStyle:e.fontStyle||"normal",fontSize:e.fontSize||48,justification:e.justification||"center",shadowColor:e.shadowColor||null,shadowBlur:e.shadowBlur||0,shadowOffset:this.getOffsetByDistanceAngle(e.shadowDistance,e.shadowAngle),lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing})).fontSize=this.adjustTextFontSize(a,a.fontSize),a.data={},a.data.isText=!0,a.data.originalStrokeColor=l,a.data.originalFillColor=h,a.data.originalShadowColor=c,this.applyDesignEffectToItem(o,a),this.masterGroup.addChild(a),this.onItemCreated(a),this.setItemSelection(a,!0),null==t)if(s){var u=this.findItemForArea(s);if(u){if(a.position=u.interiorPoint,!u.contains(a.position)){var d=this.side.get("areas").map(function(t){return r.findItemForArea(t)}).sort(function(t,e){return t.bounds.area-e.bounds.area}).at(0);if(d instanceof paper.CompoundPath&&d.children.length>0){var f=d.children.sort(function(t,e){return t.area-e.area}).at(0);a.position=f.interiorPoint}else a.position=d.interiorPoint}if(a.bounds.height>0&&u.bounds.height>0){if(a.bounds.height>u.bounds.height){var g=u.bounds.height/a.bounds.height;g=this.adjustTextFontScaling(a,g),a.scale(g)}if(!n&&a.bounds.height/u.bounds.height<.1){g=.1*u.bounds.height/a.bounds.height;g=this.adjustTextFontScaling(a,g),a.scale(g)}}if(!n){var p=this.getFontSizeList();if(p&&p.length>0)a.fontSize=p[0]/(4*a.scaling.x/3);else{var m=this.getDefaultTextFontSizeFromMinMaxInPx(a);m>0&&(a.fontSize=m)}}this.onItemUpdated(a),this.onDesignItemChanged(a)}}else a.position=this.paper.view.center;else a.position=t;if(this.isSafari){a.visible=!1;var v=this;setTimeout(function(){a.visible=!0,v.paper.project.view.update(!0),v.updateSelectionState()},2e3)}else this.updateSelectionState(),this.paper.project.view.update(!0);e.isTextOnPath&&(a=this.convertSelectedTextItemsToTextOnPath()),this.endDesignOperation()}}}return a},modifyTextElement:function(t,e,i){if(void 0===i&&(i=!0),this.canEditItem(t)&&t){if(this.beginDesignOperation(),t.data&&t.data.isTextOnPath)this.modifyTextOnPathInfo(t,e);else if(t.data&&t.data.isTextArea)this.modifyTextAreaInfo(t,e);else{var n=null,r=this.findDesignItemForItem(t);r&&(n=this.getDesignEffectForDesignItem(r));var a=this.getItemConstraints(t);if(t.content=this.adjustInputTextByConstraints(t,e.text)||t.content,!a||a.get("canChangeFontColor")){var s=e.strokeColor||this.convertColorToHex(t.strokeColor),o=e.fillColor||this.convertColorToHex(t.fillColor);s=this.forceColorInFixedPalette(t,s),o=this.forceColorInFixedPalette(t,o),t.strokeColor=this.applyDesignEffectToTextColor(n,s),t.fillColor=this.applyDesignEffectToTextColor(n,o),t.data.originalStrokeColor=s,t.data.originalFillColor=o}if(!a||a.get("canChangeShadowColor")){var l=e.shadowColor||this.convertColorToHex(t.shadowColor);l=this.forceColorInFixedPalette(t,l),t.shadowColor=this.applyDesignEffectToTextColor(n,l),t.data.originalShadowColor=l}this.allowShadows()||(t.shadowColor=null),t.shadowBlur=this.adjustInputShadowBlur(t,e.shadowBlur),t.shadowOffset=this.getOffsetByDistanceAngle(this.adjustInputShadowDistance(t,e.shadowDistance),this.adjustInputShadowAngle(t,e.shadowAngle)),t.strokeWidth=null!=e.strokeWidth?e.strokeWidth:t.strokeWidth,a&&!a.get("canChangeFontFamily")||(t.fontFamily=this.sanitizeFontFamilyName(e.fontFamily||t.fontFamily)),t.fontWeight=this.adjustInputFontWeightByConstraints(t,e.fontWeight,a),a&&!a.get("canChangeFontSize")||(t.fontSize=e.fontSize||t.fontSize),a&&!a.get("canChangeJustification")||(t.justification=e.justification||t.justification),e.scaling&&(t.scaling=e.scaling),e.rotation&&(t.rotation=e.rotation)}this.onItemUpdated(t),this.onDesignItemChanged(t),i&&this.setItemSelection(t,!0),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()}},modifyTextElements:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElement(t[i],e);else this.modifyTextElement(t,e)},modifyTextElementContentByGuid:function(t,e){var i=this.findItemByGuid(t);i&&this.modifyTextElementContent(i,e)},modifyTextElementContent:function(t,e){if(this.canEditItem(t)&&!this.sameTextElementContent(t,e)){var i=null;this.beginDesignOperation(),t&&t instanceof this.paper.TextItem?(t.content=this.adjustInputTextByConstraints(t,e),t.data.needsTransformsDataUpdate=!0,t.data.isProfanityCheckInvalid=!1,this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t),this.updateSelectionState(),this.paper.project.view.update(),this.onItemUpdated(t),this.onDesignItemChanged(t)):t&&t.data&&t.data.isTextOnPath?(i={text:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.onDesignItemChanged(t)):t&&t.data&&t.data.isTextArea&&(i={text:e},this.modifyTextAreaInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.onDesignItemChanged(t)),this.endDesignOperation()}},modifyTextElementsContent:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementContent(t[i],e);else this.modifyTextElementContent(t,e)},setIsPlaceHolderItem:function(t,e){t.data.isPlaceHolder=e;var i=this.findDesignItemByGuid(t.data.guid),n=t.exportJSON({asString:!0});i.set("json",n)},setIsPlaceHolderItems:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.setIsPlaceHolderItems(t[i],e);else this.setIsPlaceHolderItem(t,e)},sameTextElementContent:function(t,e){var i=this.getTextItemInfo(t);if(i){var n=this.adjustInputTextByConstraints(t,e);if(i.text===n)return!0}return!1},modifyTextElementFillColorByGuid:function(t,e){var i=this.findItemByGuid(t);i&&this.modifyTextElementFillColor(i,e)},modifyTextElementFillColor:function(t,e){if(this.canChangeItemFontColor(t)){var i=void 0,n=this.getTextItemInfo(t);if(n&&n.fillColor&&(n.fillColor instanceof this.paper.Color?i=n.fillColor.toCSS(!0):"string"==typeof n.fillColor&&(i=n.fillColor)),!i||i!==e){var r=null;this.beginDesignOperation();var a=null,s=this.findDesignItemForItem(t);if(s&&(a=this.getDesignEffectForDesignItem(s)),t&&t instanceof this.paper.TextItem){var o=e;o=this.forceColorInFixedPalette(t,o,i);var l=this.applyDesignEffectToTextColor(a,o);t.fillColor=l,t.data.needsTransformsDataUpdate=!0,t.data.originalFillColor=o,this.paper.project.view.update(),this.onItemUpdated(t)}else t&&t.data&&t.data.isTextOnPath?(r={fillColor:e},this.modifyTextOnPathInfo(t,r),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(r={fillColor:e},this.modifyTextAreaInfo(t,r),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t));this.endDesignOperation()}}},modifyTextElementsFillColor:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementFillColor(t[i],e);else this.modifyTextElementFillColor(t,e)},modifyTextElementShadowColorByGuid:function(t,e){var i=this.findItemByGuid(t);i&&this.modifyTextElementShadowColor(i,e)},modifyTextElementShadowColor:function(t,e){if(this.canChangeItemShadowColor(t)){this.allowShadows()||(e=null);var i=void 0,n=this.getTextItemInfo(t);if(n&&n.shadowColor&&(n.shadowColor instanceof this.paper.Color?i=n.shadowColor.toCSS(!0):"string"==typeof n.shadowColor&&(i=n.shadowColor)),!i||i!==e){var r=null;this.beginDesignOperation();var a=null,s=this.findDesignItemForItem(t);if(s&&(a=this.getDesignEffectForDesignItem(s)),t&&t instanceof this.paper.TextItem){var o=e;o=this.forceColorInFixedPalette(t,o,i);var l=this.applyDesignEffectToTextColor(a,o);t.shadowColor=l,t.data.needsTransformsDataUpdate=!0,t.data.originalShadowColor=o,this.paper.project.view.update(),this.onItemUpdated(t)}else t&&t.data&&t.data.isTextOnPath?(r={shadowColor:e},this.modifyTextOnPathInfo(t,r),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(r={shadowColor:e},this.modifyTextAreaInfo(t,r),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t));this.endDesignOperation()}}},modifyTextElementsShadowColor:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementShadowColor(t[i],e);else this.modifyTextElementShadowColor(t,e)},modifyTextElementShadowBlur:function(t,e){if(this.canChangeItemShadowBlur(t)){e=this.adjustInputShadowBlur(t,e);var i=null,n=this.getLastUndoOperationId();this.beginDesignOperation(),t&&t instanceof this.paper.TextItem?(t.shadowBlur=e,t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update()):t&&t.data&&t.data.isTextOnPath?(i={shadowBlur:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(i={shadowBlur:e},this.modifyTextAreaInfo(t,i),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n)}},modifyTextElementsShadowBlur:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementShadowBlur(t[i],e);else this.modifyTextElementShadowBlur(t,e)},modifyTextElementShadowDistance:function(t,e){if(this.canChangeItemShadowDistance(t)){e=this.adjustInputShadowDistance(t,e);var i=null,n=this.getLastUndoOperationId();if(this.beginDesignOperation(),t&&t instanceof this.paper.TextItem){var r=this.getOffsetAngle(t.shadowOffset);t.shadowOffset=this.getOffsetByDistanceAngle(e,r),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update()}else t&&t.data&&t.data.isTextOnPath?(i={shadowDistance:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(i={shadowDistance:e},this.modifyTextAreaInfo(t,i),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t));this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n)}},modifyTextElementsShadowDistance:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementShadowDistance(t[i],e);else this.modifyTextElementShadowDistance(t,e)},modifyTextElementShadowAngle:function(t,e){if(this.canChangeItemShadowAngle(t)){e=this.adjustInputShadowAngle(t,e);var i=null,n=this.getLastUndoOperationId();if(this.beginDesignOperation(),t&&t instanceof this.paper.TextItem){var r=this.getOffsetDistance(t.shadowOffset);t.shadowOffset=this.getOffsetByDistanceAngle(r,e),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update()}else t&&t.data&&t.data.isTextOnPath?(i={shadowAngle:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(i={shadowAngle:e},this.modifyTextAreaInfo(t,i),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t));this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n)}},modifyTextElementsShadowAngle:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementShadowAngle(t[i],e);else this.modifyTextElementShadowAngle(t,e)},resetTextElementShadow:function(t){if(t&&t.data&&t.data.guid){var e=this.findDesignItemForItem(t),i=this.getTextItemInfo(t);if(e&&i){var n=this.getLastUndoOperationId();if(this.beginDesignOperation(),this.allowShadows()||(i.shadowColor=null),i.shadowBlur=this.adjustInputShadowBlur(t,i.shadowBlur),i.shadowDistance=this.adjustInputShadowDistance(t,i.shadowDistance),i.shadowAngle=this.adjustInputShadowAngle(t,i.shadowAngle),t instanceof this.paper.TextItem){var r=this.getDesignEffectForDesignItem(e),a=i.shadowColor;a=this.forceColorInFixedPalette(t,a),i.shadowColor=this.applyDesignEffectToTextColor(r,a),t.shadowColor=i.shadowColor,t.shadowBlur=i.shadowBlur,t.shadowDistance=i.shadowDistance,t.shadowAngle=i.shadowAngle,t.data.needsTransformsDataUpdate=!0,t.data.originalShadowColor=a,this.paper.project.view.update(),this.onItemUpdated(t)}else t.data.isTextOnPath?(i={shadowColor:i.shadowColor,shadowBlur:i.shadowBlur,shadowDistance:i.shadowDistance,shadowAngle:i.shadowAngle},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t.data.isTextArea&&(i={shadowColor:i.shadowColor,shadowBlur:i.shadowBlur,shadowDistance:i.shadowDistance,shadowAngle:i.shadowAngle},this.modifyTextAreaInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t));this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n)}}},sanitizeFontFamilyName:function(t){return'"'+t.replace(/"/g,"")+'"'},modifyTextElementFontFamilyByGuid:function(t,e){var i=this.findItemByGuid(t);i&&this.modifyTextElementFontFamily(i,e)},modifyTextElementFontFamily:function(t,e){if(this.canChangeItemFontFamily(t)&&!this.sameTextElementFontFamily(t,e)){var i=null,n=this.getLastUndoOperationId();if(this.beginDesignOperation(),t&&t instanceof this.paper.TextItem)if(t.fontFamily=this.sanitizeFontFamilyName(e),t.data.needsTransformsDataUpdate=!0,this.isSafari){t.visible=!1;var r=this;setTimeout(function(){t.visible=!0,r.paper.project.view.update(!0),r.onItemUpdated(t),r.updateSelectionState()},2e3)}else this.paper.project.view.update(!0),this.onItemUpdated(t),this.updateSelectionState();else t&&t.data&&t.data.isTextOnPath?(i={fontFamily:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(i={fontFamily:e},this.modifyTextAreaInfo(t,i),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t));this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n)}},modifyTextElementsFontFamily:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementFontFamily(t[i],e);else this.modifyTextElementFontFamily(t,e)},sameTextElementFontFamily:function(t,e){var i=this.getTextItemInfo(t);if(i&&this.sanitizeFontFamilyName(i.fontFamily)===this.sanitizeFontFamilyName(e))return!0;return!1},modifyTextElementFontSize:function(t,e){if(this.canChangeItemFontSize(t)){var i=null,n=this.getLastUndoOperationId();this.beginDesignOperation(),t&&t instanceof this.paper.TextItem?(t.fontSize=e,t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update()):t&&t.data&&t.data.isTextOnPath?(i={fontSize:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(i={fontSize:e},this.modifyTextAreaInfo(t,i),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n)}},modifyTextElementsFontSize:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementFontSize(t[i],e);else this.modifyTextElementFontSize(t,e)},modifyTextElementFontWeight:function(t,e){if(this.canChangeItemFontWeight(t)){var i=this.getTextItemInfo(t);if(!i||i.fontWeight!==e){var n=null,r=this.getLastUndoOperationId();this.beginDesignOperation(),t&&t instanceof this.paper.TextItem?(t.fontWeight=e,t.data.needsTransformsDataUpdate=!0,this.paper.project.view.update(),this.onItemUpdated(t),this.updateSelectionState()):t&&t.data&&t.data.isTextOnPath?(n={fontWeight:e},this.modifyTextOnPathInfo(t,n),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(n={fontWeight:e},this.modifyTextAreaInfo(t,n),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(r)}}},modifyTextElementsFontWeight:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementFontWeight(t[i],e);else this.modifyTextElementFontWeight(t,e)},modifyTextElementFontStretch:function(t,e){var i=null,n=this.getTextItemInfo(t);if(!n||n.fontStretch!==e){var r=this.getLastUndoOperationId();this.beginDesignOperation(),this.beginDesignOperation(),t&&t instanceof this.paper.TextItem?(t.fontStretch=e,t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update()):t&&t.data&&t.data.isTextOnPath?(i={fontStretch:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(i={fontStretch:e},this.modifyTextAreaInfo(t,i),t.data.isTextBox&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(r)}},modifyTextElementsFontStretch:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementFontStretch(t[i],e);else this.modifyTextElementFontStretch(t,e)},modifyTextElementJustification:function(t,e){if(this.canChangeItemJustification(t)){this.beginDesignOperation();var i=null,n=this.getTextItemInfo(t);if(!n.justification||n.justification!=e){if(t&&t instanceof this.paper.TextItem&&(t=this.fromTextToTextArea(t)),t&&t.data&&t.data.isTextOnPath)i={justification:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t);else if(t&&t.data&&t.data.isTextArea){i={justification:e};var r=t.bounds.clone();this.modifyTextAreaInfo(t,i),t.data.isTextBox||(t.position.x=r.x+r.width/2,Math.abs(t.children[0].rotation)<=90?t.position.y=r.y+t.bounds.height/2:t.position.y=r.bottom-t.bounds.height/2),this.updateSelectionState(),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)}this.endDesignOperation()}}},modifyTextElementsJustification:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementJustification(t[i],e);else this.modifyTextElementJustification(t,e)},modifyTextElementVerticalAlign:function(t,e){if(this.canChangeItemVerticalAlignment(t)){this.beginDesignOperation();var i=null,n=this.getTextItemInfo(t);if(!n.verticalAlignment||n.verticalAlignment!=e){if(t&&t instanceof this.paper.TextItem&&(t=this.fromTextToTextArea(t)),t&&t.data&&t.data.isTextOnPath)i={verticalAlignment:e},this.modifyTextOnPathInfo(t,i),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t);else if(t&&t.data&&t.data.isTextArea){i={verticalAlignment:e};var r=t.bounds.clone();this.modifyTextAreaInfo(t,i),t.data.isTextBox||(t.position.x=r.x+r.width/2,Math.abs(t.children[0].rotation)<=90?t.position.y=r.y+t.bounds.height/2:t.position.y=r.bottom-t.bounds.height/2),this.updateSelectionState(),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)}this.endDesignOperation()}}},modifyTextElementsVerticalAlign:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementVerticalAlign(t[i],e);else this.modifyTextElementVerticalAlign(t,e)},modifyTextElementAdaptText:function(t,e){if(this.canChangeItemAdaptText(t)){var i=this.getTextItemInfo(t);if(!i||null==i.adaptText||i.adaptText!==e){var n=null,r=this.getLastUndoOperationId();this.beginDesignOperation(),t&&t instanceof this.paper.TextItem||t&&t.data&&t.data.isTextOnPath||t&&t.data&&t.data.isTextArea&&(n={adaptText:e},this.modifyTextAreaInfo(t,n),t.data.isTextBox&&!t.data.adaptText&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(r)}}},modifyTextElementsAdaptText:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementAdaptText(t[i],e);else this.modifyTextElementAdaptText(t,e)},modifyTextElementLetterSpacing:function(t,e){if(this.canChangeItemLetterSpacing(t)){var i=this.getTextItemInfo(t);if(!i||null==i.letterSpacing||i.letterSpacing!==e){var n=null,r=this.getLastUndoOperationId();this.beginDesignOperation(),t&&t instanceof this.paper.TextItem||(t&&t.data&&t.data.isTextOnPath?(n={letterSpacing:e},this.modifyTextOnPathInfo(t,n),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)):t&&t.data&&t.data.isTextArea&&(n={letterSpacing:e},this.modifyTextAreaInfo(t,n),t.data.isTextBox&&!t.data.adaptText&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t))),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(r)}}},modifyTextElementsLetterSpacing:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementLetterSpacing(t[i],e);else this.modifyTextElementLetterSpacing(t,e)},modifyTextElementLineSpacing:function(t,e){if(this.canChangeItemLineSpacing(t)){var i=this.getTextItemInfo(t);if(!i||null==i.lineSpacing||i.lineSpacing!==e){var n=null,r=this.getLastUndoOperationId();this.beginDesignOperation(),t&&t instanceof this.paper.TextItem||t&&t.data&&t.data.isTextOnPath||t&&t.data&&t.data.isTextArea&&(n={lineSpacing:e},this.modifyTextAreaInfo(t,n),t.data.isTextBox&&!t.data.adaptText&&t.children&&0==t.children.length&&this.adaptTextBoxFontSize(t),t.data.needsTransformsDataUpdate=!0,this.onItemUpdated(t)),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(r)}}},modifyTextElementsLineSpacing:function(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++)this.modifyTextElementLineSpacing(t[i],e);else this.modifyTextElementLineSpacing(t,e)},adjustTextFontScaling:function(t,e){var i=e;if(t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){var n=this.getItemMinFontSize(t),r=this.getItemMaxFontSize(t);if(null!=n||null!=n||null!=r||null!=r){var a=this.getTextItemInfo(t);a&&(null!=n&&null!=n&&(i=Math.min(i,n/(a.fontSize*a.scaling.x*4/3))),null!=r&&null!=r&&(i=Math.max(i,r/(a.fontSize*a.scaling.x*4/3))))}}return i},getDefaultTextFontSizeFromMinMaxInPx:function(t){var e=-1;if(t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){var i=this.getItemMinFontSize(t),n=this.getItemMaxFontSize(t);if(null!=i&&null!=i&&null!=n&&null!=n){var r=this.getTextItemInfo(t);r&&(e=(i/(4*r.scaling.x/3)+n/(4*r.scaling.x/3))/2)}}return e},adjustTextFontSize:function(t,e){var i=e;if(t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){var n=this.getItemMinFontSize(t),r=this.getItemMaxFontSize(t);if(null!=n||null!=n||null!=r||null!=r){var a=this.getTextItemInfo(t);a&&(null!=n&&null!=n&&(i=Math.max(i,n/(4*a.scaling.x/3))),null!=r&&null!=r&&(i=Math.min(i,r/(4*a.scaling.x/3))))}}return i},canScaleSelectedTextFont:function(t,e){for(var i=this.getSelectedItems(),n=0;n<i.length;n++){var r=i[n];if(!this.canScaleTextFont(r,t,e))return!1}return!0},getScaledTextFontSizePt:function(t,e,i){if(this.getItemIsTextElement(t)){var n=this.getItemMinFontSize(t),r=this.getItemMaxFontSize(t);if(null!=n||null!=n||null!=r||null!=r){var a=this.getTextItemInfo(t);if(a){var s=Math.max(e,i);return 4*(a.fontSize*a.scaling.x*s)/3}}}return 0},canScaleTextFont:function(t,e,i){if(t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){var n=this.getItemMinFontSize(t),r=this.getItemMaxFontSize(t);if(null!=n||null!=n||null!=r||null!=r){var a=this.getTextItemInfo(t);if(a){var s=Math.max(e,i),o=4*(a.fontSize*a.scaling.x*s)/3;if(null!=n&&null!=n&&o<n)return!1;if(null!=r&&null!=r&&o>r)return!1}}}return!0},canSetSelectedTextFontSizePx:function(t){for(var e=this.getSelectedItems(),i=0;i<e.length;i++){var n=e[i];if(!this.canSetTextFontSizePx(n,t))return!1}return!0},canSetTextFontSizePx:function(t,e){if(t&&t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){if(t.data.adaptText)return!0;var i=this.getItemMinFontSize(t),n=this.getItemMaxFontSize(t);if(null!=i||null!=i||null!=n||null!=n){var r=this.getTextItemInfo(t);if(r){r.fontSize,r.scaling.x;var a=4*e/3;if(null!=i&&null!=i&&a<i)return!1;if(null!=n&&null!=n&&a>n)return!1}}}return!0},canSetSelectedTextFontSizePt:function(t){var e=3*t/4;return this.canSetSelectedTextFontSizePx(e)},canSetTextFontSizePt:function(t,e){return this.canSetTextFontSizePx(t,e)},computeTotalFontSizePt:function(t,e){return t*e*4/3},getTextItemTotalFontSizePx:function(t){if(t&&t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){var e=this.getTextItemInfo(t);if(e)return e.fontSize*e.scaling.x}return 0},getTextItemTotalFontSizePt:function(t){return 4*this.getTextItemTotalFontSizePx(t)/3},modifySelectedTextItemsTotalFontSizePt:function(t){var e=3*t/4;this.modifySelectedTextItemsTotalFontSizePx(e)},modifyTextItemTotalFontSizePt:function(t,e){var i=3*e/4;this.modifyTextItemTotalFontSizePx(t,i)},modifySelectedTextItemsTotalFontSizePx:function(t){var e=this.getSelectedTextItems();if(e&&e.length>0){var i=e[0];this.modifyTextItemTotalFontSizePx(i,t)}},modifyTextItemTotalFontSizePx:function(t,e){if(t&&this.canEditItem(t)&&this.canResizeItem(t)&&this.canChangeItemFontSize(t)&&this.canSetTextFontSizePx(t,e)&&t.data&&(t instanceof this.paper.TextItem||t.data.isTextOnPath||t.data.isTextArea)){var i=this.getTextItemInfo(t);if(i){var n=i.fontSize*i.scaling.x;if(n>0){var r=e/n,a=this.getLastUndoOperationId();this.beginDesignOperation(),this.scaleItem(t,r,r,null),this.onItemUpdated(t),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(a)}}}},addTextOnPathElement:function(t,e,i){if(void 0===i&&(i=!1),i||this.canAddText()){var n=null;if(this.side){var r=this.side.get("areas").getMaxArea();if(r){var a=this.getDesignEffectForArea(r);this.beginDesignOperation();var s=!1;if(t||(t=this.paper.view.center,s=!0),e&&e.text){this.deselectAll(),this.updateSelectionState(),this.allowShadows()||(e.shadowColor=null);var o=e.strokeColor||"#000000",l=e.fillColor||"#000000",h=e.shadowColor||null;o=this.forceColorInFixedPalette(null,o),l=this.forceColorInFixedPalette(null,l),h=this.forceColorInFixedPalette(null,h),e.strokeColor=this.applyDesignEffectToTextColor(a,o),e.fillColor=this.applyDesignEffectToTextColor(a,l),e.shadowColor=this.applyDesignEffectToTextColor(a,h),e.shadowBlur=this.adjustInputShadowBlur(null,e.shadowBlur),e.shadowDistance=this.adjustInputShadowDistance(null,e.shadowDistance),e.shadowAngle=this.adjustInputShadowAngle(null,e.shadowAngle);var c=new this.paper.PointText({point:t,content:e.text,strokeColor:e.strokeColor,strokeWidth:null!=e.strokeWidth?e.strokeWidth:0,fillColor:e.fillColor,fontFamily:this.sanitizeFontFamilyName(e.fontFamily||"Verdana"),fontWeight:e.fontWeight||"normal",fontSize:e.fontSize||12,justification:e.justification||"center",shadowColor:e.shadowColor||null,shadowBlur:e.shadowBlur,shadowOffset:this.getOffsetByDistanceAngle(e.shadowDistance,e.shadowAngle)}),u=c.bounds;c.remove();var d=u.clone(),f=this.findItemForArea(r);f&&(d=f.bounds.expand(-50)),s||(d.center=t);var g=Math.min(d.width,d.height),p=new this.paper.Rectangle(d.x+(d.width-g)/2,d.y+(d.height-g)/2,g,g),m=new this.paper.Point(p.left,p.top+g/2),v=new this.paper.Point(p.center.x,p.topLeft.y),_=new this.paper.Point(p.right,p.top+g/2),y=new this.paper.Path.Arc(m,v,_);y.remove(),e.rotation&&(y.rotation=e.rotation,m=y.getPointAt(0*y.length),v=y.getPointAt(.5*y.length),_=y.getPointAt(1*y.length)),(n=new this.paper.Group).addChildren(this.createAlignedText(y,e)),n.data.isTextOnPath=!0,n.data.points=[m,v,_],n.data.text=e.text,n.data.inside=e.inside||!1,n.data.originalStrokeColor=o,n.data.originalFillColor=l,n.data.originalShadowColor=h,n.data.letterSpacing=this.adjustInputLetterSpacingByConstraints(n,e.letterSpacing),this.masterGroup.addChild(n),this.adaptPathToText(n);var x=d.center.subtract(n.position);n.position=d.center,n.data.needsTransformsDataUpdate=!0,this.applyDesignEffectToItem(a,n),this.updateTransformsData(n),this.onTextOnPathMoved(n,x),this.onItemCreated(n),this.setItemSelection(n,!0)}this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()}}return n}},getAllImageItems:function(){for(var t=[],e=this.getAllItems(),i=0;i<e.length;i++){var n=e[i],r=this.getMaskedImageRasterItem(n);n&&r&&n.data&&n.data.guid&&!n.data.isArea&&t.push(n)}return t},getAllDesignImageItems:function(){return this.design.get("designItems").models.filter(function(t){return""!==t.get("imageFormat")})},getAllTextOnPathItems:function(){var t=[];function e(i){if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=i.children[n];!r.guide&&r.data&&r.data.isTextOnPath&&t.push(r),e(r)}}for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=this.paper.project.layers[i];r.guide||e(r)}return t},setGrids:function(t){this.grids=t},updateGrids:function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(n){switch(n.label){case 0:return(t=this.design.get("areasGrids")&&this.design.get("areasGrids").models.find(function(t){return t.get("modelID")==i.getCurrentModel().id&&t.get("sideID")==i.side.id}))&&(e=this.grids.find(function(e){return e.id==t.get("gridID")}))?[4,this.createGridItem(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},addImageToGridBox:function(t,e,i){this.beginDesignOperation();var n=e.children.find(function(t){return t.data&&t.data.isGridIcon});n&&n.remove();var r=this.getItemBounds(t),a=e.bounds.clone();a.width*=1.1,a.height*=1.1;var s=1,o=1;Math.abs(a.width)>1e-7&&(s=a.width/r.width),Math.abs(a.height)>1e-7&&(o=a.height/r.height);var l=s>0?1:-1,h=o>0?1:-1;s=o=Math.max(Math.abs(s),Math.abs(o)),s*=l,o*=h,t.data.isGridImage||(t.position=e.position,t.scale(s,o),t.data.initialScaleX=s,t.data.initialScaleY=o,t.data.originalBounds=new this.paper.Rectangle(0,0,this.getImageWidth(t),this.getImageHeight(t)),t.data.originalMatrix=t.matrix.clone()),t.visible=!0,t.data.isGridImage=!0,t.data.gridBoxID=i>=0?i:e.parent.children.indexOf(e),this.isViewer||(this.updateSelectionState(),this.onItemUpdated(t),this.onDesignItemChanged(t));for(var c=0,u=e.children;c<u.length;c++){var d=u[c];d.data&&d.data.isGridBorderPath&&(d.fillColor=new paper.Color(1,1,1,0))}e.addChild(t),t.sendToBack(),this.endDesignOperation()},insertImageInGrid:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h=this;return __generator(this,function(c){switch(c.label){case 0:return i=null,t&&t instanceof MPlaza.Image?this.canAddImage()&&(n=this.getAllGridItems()[0])?!this.side||this.side.get(0=="areas".length)?[2,i]:(r=this.side.get("areas").at(0),this.beginDesignOperation(),a=n.children.find(function(t){return t.data&&t.data.isBoxSelected})||n.children.find(function(t){return t.children&&t.children.find(function(t){return t.data&&t.data.isGridIcon})})||n.children[0],s="",!this.isImageScalingEnabled&&"svg"!=t.get("format").toLowerCase()&&"vector"!=t.get("type").toLowerCase()&&["png","jpg","jpeg"].find(function(e){return e==t.get("format").toLowerCase()})&&(s=t.get("url")),s||(s=t.get("previewUrl")),s?(o=s,l=this.getDesignEffectForArea(r),[4,this.applyDesignEffectToImageUrl(l,s)]):[2,i]):[2,i]:[2,i];case 1:return s=c.sent(),e?[3,3]:[4,this.getImageDefaultColorMappings(s,null)];case 2:e=c.sent(),c.label=3;case 3:return e&&e.length>0?[4,this.recolorImage(s,e)]:[3,5];case 4:s=c.sent(),c.label=5;case 5:return[4,this.createRasterItem(s,!1)];case 6:return(i=c.sent()).data.originalUrl=o,this.applyDesignEffectToItem(l,i),i.data.originalImageID=t.id,i.data.areaGuid=a.data.areaGuid,a.children.forEach(function(t){t.data.isGridImage&&(t.remove(),h.onItemRemoved(t))}),this.onItemCreated(i,t),this.addImageToGridBox(i,a,n.children.indexOf(a)),this.onGridImageSelected(i),this.updateItemsIndexes(),this.onItemUpdated(i),this.onDesignItemChanged(i),this.fireImageLoadedEvent(),this.endDesignOperation(),[2,i]}})})},onGridImageSelected:function(t){this.deselectGridBoxes();var e=this.getMaskedImageRasterItem(t);t&&e&&t.data&&(t.data.isGridImage||t.data.isGridIcon)&&(this.selectGridBox(t.parent),this.fireGridImageSelectedEvent(t))},createGridBoxIcon:function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){var i=new t.paper.Raster({crossOrigin:"anonymous",source:Zakeke.config.baseUrl+"/images/other/camera_image_grids.png",onMouseEnter:function(){return t.paper.project.view.element.style.setProperty("cursor","pointer")},onMouseLeave:function(){return t.paper.project.view.element.style.setProperty("cursor",null)}});i.onLoad=function(){i.onLoad=void 0,e(i)}})]})})},deselectGridBoxes:function(){this.getAllGridItems().forEach(function(t){t.children.forEach(function(t){if(t.data&&t.data.isGridPathGroup){var e=t.children.find(function(t){return t.data&&t.data.isGridBorderPath});e&&(e.strokeWidth=0,t.data.isBoxSelected=!1)}})})},selectGridBox:function(t){if(t&&t.data&&t.data.isGridPathGroup){var e=t.children.find(function(t){return t.data&&t.data.isGridBorderPath});e&&(this.createPathDashes(e),t.data.isBoxSelected=!0,t.children.find(function(t){return t.data&&t.data.isGridImage})&&e.bringToFront())}},getAllGridItems:function(){var t=[];function e(i){if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=i.children[n];!r.guide&&r.data&&r.data.isGridGroup&&t.push(r),e(r)}}for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=this.paper.project.layers[i];r.guide||e(r)}return t},removeAllGridItems:function(){var t=!1;this.currentDesignOperation||(t=!0,this.beginDesignOperation());for(var e=0,i=this.getAllGridItems();e<i.length;e++){var n=i[e];n.remove();for(var r=0,a=n.children;r<a.length;r++)for(var s=0,o=a[r].children;s<o.length;s++){var l=o[s];l.data&&l.data.isGridImage&&(l.data.isGridImage=!1,this.masterGroup.addChild(l),this.onItemUpdated(l))}}this.paper.project.view.update(),t&&this.endDesignOperation()},createGridItem:function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x=this;return __generator(this,function(b){switch(b.label){case 0:return e=this,this.beginDesignOperation(),this.removeAllGridItems(),i=this.findItemForArea(this.side.get("areas").at(0)),t&&t.get("json")&&i?((n=this.paper.project.activeLayer.importJSON(t.get("json"))).visible=!1,[4,this.createGridBoxIcon()]):[2];case 1:for(r=b.sent(),n.scale(i.bounds.width/n.bounds.width,i.bounds.height/n.bounds.height),n.position.x=i.position.x,n.position.y=i.position.y,this.masterGroup.addChild(n),a=[],s=-1,o=0,l=n.children;o<l.length;o++)(h=l[o]).children.length>1&&(c=h.children.find(function(t){return t.data&&t.data.isGridBorderPath}))&&(c.strokeWidth=0,c.strokeColor="#000000",e.isViewer||(c.fillColor=new paper.Color(1,1,1,.9),(u=r.clone()).data.isGridIcon=!0,u.onMouseEnter=function(){return x.paper.project.view.element.style.setProperty("cursor","pointer")},u.onMouseLeave=function(){return x.paper.project.view.element.style.setProperty("cursor",null)},u.position.x=c.interiorPoint.x,u.position.y=c.interiorPoint.y,0,d=this.isMobile?Math.min(Math.min(h.bounds.width,h.bounds.height),180):Math.min(.8*Math.min(h.bounds.width,h.bounds.height),66),(-1==s||d<s)&&(s=this.isMobile?Math.max(d,60):Math.max(d,30)),a.push(u),h.addChild(u)));for(f=0,g=a;f<g.length;f++)(p=g[f]).scale(s/p.bounds.width,s/p.bounds.height);for(r.remove(),m=this.getAllImageItems().filter(function(t){return!t.data.isImageForBackground}),v=function(){var t=m[y],e=null,i=-1;if(t.data&&null!=t.data.gridBoxID&&(e=n.children[t.data.gridBoxID])&&(i=t.data.gridBoxID),!e){if(y>=n.children.length||t.data.gridBoxID>=n.children.length)return t.remove(),_.onItemRemoved(t),"continue";e=n.children[y],i=y}var r=null,a=_.findDesignItemForItem(t);if(a&&(r=a.get("constraints")),!r||(r.get("canEdit")||r.get("canMove")||r.get("canRotate")||r.get("canResize")||r.get("canDelete"))&&t.data&&!t.data.isGridIcon)if(t.loaded)_.addImageToGridBox(t,e,i);else{var s=t.onLoad||function(){};t.onLoad=function(){s(),x.addImageToGridBox(t,e,i)}}else t.data&&null!=t.data.gridBoxID&&(t.data.isGridImage=!1,t.data.gridBoxID=null,_.isViewer||(_.onItemUpdated(t),_.onDesignItemChanged(t)))},_=this,y=0;y<m.length;y++)v();return n.visible=!0,this.updateItemsIndexes(),this.paper.project.view.update(),this.endDesignOperation(),this.resetUndoRedo(),[2]}})})},updateTextOnPathGuides:function(t){t||(t=this.getAllTextOnPathItems());for(var e=0;e<t.length;e++){var i=t[e];this.updateTextOnPathGuide(i)}},updateTextOnPathGuide:function(t){t.data.selected?(this.drawTextOnPathGuide(t),this.drawTextOnPathHandles(t)):(this.removeTextOnPathGuide(t),this.removeTextOnPathHandles(t))},createPathDashes:function(t,e){if(void 0===e&&(e=[]),t){e&&0!=e.length||(e=["black","white"]);for(var i=[],n=e.length-1,r=0;r<1;r=Math.round(100*(r+.03))/100){var a=Math.min(Math.round(100*(r+.03))/100,1),s=e[n=(n+1)%e.length];i=__spreadArray(__spreadArray([],i,!0),[[s,r],[s,a]],!1)}var o=Math.max(t.bounds.width,t.bounds.height);t.strokeColor={gradient:{stops:i},origin:t.bounds.topLeft,destination:new paper.Point(t.bounds.topLeft.x+o,t.bounds.topLeft.y+o)},t.strokeWidth=1.5/this.paper.view.zoom,t.dashArray=[]}},drawTextOnPathGuide:function(t){if(this.removeTextOnPathGuide(t),t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length){var e=new this.paper.Path.Arc(t.data.points[0],t.data.points[1],t.data.points[2]);e.data.isTextOnPathGuide=!0,e.strokeWidth=2/this.paper.view.zoom,e.dashOffset=.5/this.paper.view.zoom,e.dashArray=[1/this.paper.view.zoom,1/this.paper.view.zoom],e.guide=!0,e.data.itemGuid=t.data.guid,this.isViewer||this.createPathDashes(e)}},findTextOnPathGuide:function(t){if(t&&t.data&&t.data.isTextOnPath&&t.data.guid)for(var e=t.data.guid.toUpperCase(),i=function(t,n){if(t.data&&t.data.isTextOnPathGuide&&t.data.itemGuid&&t.data.itemGuid.toUpperCase()==n)return t;if(t.children)for(var r=t.children.length-1;r>=0;r--){var a=t.children[r],s=i(a,e);if(s)return s}},n=0;n<this.paper.project.layers.length;n++){var r=this.paper.project.layers[n];if(!r.guide){var a=i(r,e);if(a)return a}}return null},removeTextOnPathGuide:function(t){var e=this.findTextOnPathGuide(t);e&&e.remove()},drawTextOnPathHandles:function(t){if(this.removeTextOnPathHandles(t),this.canMoveItem(t)&&t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length){var e=t.data.points[0],i=t.data.points[1],n=t.data.points[2],r=new this.paper.Rectangle(e,new this.paper.Point(n.x,i.y)),a=(this.getContrastedColor(r),this.selectionLateralResizeDimension/this.paper.view.zoom),s=new this.paper.Path.Circle(e,a);s.data.isTextOnPathHandle=!0,s.data.isTextOnPathFirstEndHandle=!0,s.strokeColor=new this.paper.Color(1,1,1,.5),s.strokeWidth=1,s.fillColor=new this.paper.Color(0,0,0,.5),s.data.itemGuid=t.data.guid;var o=new this.paper.Path.Circle(i,a);o.data.isTextOnPathHandle=!0,o.data.isTextOnPathMiddleEndHandle=!0,o.strokeColor=new this.paper.Color(1,1,1,.5),o.strokeWidth=1,o.fillColor=new this.paper.Color(0,0,0,.5),o.data.itemGuid=t.data.guid;var l=new this.paper.Path.Circle(n,a);l.data.isTextOnPathHandle=!0,l.data.isTextOnPathLastEndHandle=!0,l.strokeColor=new this.paper.Color(1,1,1,.5),l.strokeWidth=1,l.fillColor=new this.paper.Color(0,0,0,.5),l.data.itemGuid=t.data.guid,this.isViewer&&(s.visible=!1,o.visible=!1,l.visible=!1)}},findTextOnPathHandles:function(t){var e=[];if(t&&t.data&&t.data.isTextOnPath&&t.data.guid)for(var i=t.data.guid.toUpperCase(),n=function(t,r){if(t.data&&t.data.isTextOnPathHandle&&t.data.itemGuid&&t.data.itemGuid.toUpperCase()==r&&e.push(t),t.children)for(var a=t.children.length-1;a>=0;a--){var s=t.children[a];n(s,i)}},r=0;r<this.paper.project.layers.length;r++){var a=this.paper.project.layers[r];a.guide||n(a,i)}return e},removeTextOnPathHandles:function(t){for(var e=this.findTextOnPathHandles(t),i=0;i<e.length;i++){e[i].remove()}},onTextOnPathMoved:function(t,e){if(t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length){var i=t.data.points[0],n=t.data.points[1],r=t.data.points[2],a=new this.paper.Path.Arc(i,n,r);a.remove(),a.position.x+=e.x,a.position.y+=e.y,t.data.points[0]=a.getPointAt(0*a.length),t.data.points[1]=a.getPointAt(.5*a.length),t.data.points[2]=a.getPointAt(1*a.length)}},onTextOnPathRotated:function(t,e,i){if(t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length){var n=t.data.points[0],r=t.data.points[1],a=t.data.points[2],s=new this.paper.Path.Arc(n,r,a);s.remove(),s.rotate(e,i),t.data.points[0]=s.getPointAt(0*s.length),t.data.points[1]=s.getPointAt(.5*s.length),t.data.points[2]=s.getPointAt(1*s.length)}},onTextOnPathScaled:function(t,e,i,n){if(t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length){var r=t.data.points[0],a=t.data.points[1],s=t.data.points[2],o=new this.paper.Path.Arc(r,a,s);o.remove(),o.scale(e,i,n),t.data.points[0]=o.getPointAt(0*o.length),t.data.points[1]=o.getPointAt(.5*o.length),t.data.points[2]=o.getPointAt(1*o.length)}},moveTextOnPathFirstEnd:function(t){if(!this.frozen&&t.delta){var e=t.delta;this.hideCenterLines(),this.removeSelectionAlertItems();var i=this.getSelectedTextOnPathItems();if(i&&i.length>0){var n=i[0];n&&n.data&&n.data.isTextOnPath&&n.data.points&&"[object Array]"===Object.prototype.toString.call(n.data.points)&&3==n.data.points.length&&(n.data.points[0].x+=e.x,n.data.points[0].y+=e.y,n.data.needsTransformsDataUpdate=!0,this.drawTextOnPathGuide(n),this.drawTextOnPathHandles(n),this.updateTextOnPath(n))}}},moveTextOnPathMiddleEnd:function(t){if(!this.frozen&&t.delta){var e=t.delta;this.hideCenterLines(),this.removeSelectionAlertItems();var i=this.getSelectedTextOnPathItems();if(i&&i.length>0){var n=i[0];n&&n.data&&n.data.isTextOnPath&&n.data.points&&"[object Array]"===Object.prototype.toString.call(n.data.points)&&3==n.data.points.length&&(n.data.points[1].x+=e.x,n.data.points[1].y+=e.y,n.data.needsTransformsDataUpdate=!0,this.drawTextOnPathGuide(n),this.drawTextOnPathHandles(n),this.updateTextOnPath(n))}}},moveTextOnPathLastEnd:function(t){if(!this.frozen&&t.delta){var e=t.delta;this.hideCenterLines(),this.removeSelectionAlertItems();var i=this.getSelectedTextOnPathItems();if(i&&i.length>0){var n=i[0];n&&n.data&&n.data.isTextOnPath&&n.data.points&&"[object Array]"===Object.prototype.toString.call(n.data.points)&&3==n.data.points.length&&(n.data.points[2].x+=e.x,n.data.points[2].y+=e.y,n.data.needsTransformsDataUpdate=!0,this.drawTextOnPathGuide(n),this.drawTextOnPathHandles(n),this.updateTextOnPath(n))}}},modifyTextOnPathInfo:function(t,e){e&&(e.text=this.adjustInputTextByConstraints(t,null!=e.text?e.text:t.data.text),e.letterSpacing=this.adjustInputLetterSpacingByConstraints(t,e.letterSpacing?parseInt(e.letterSpacing):void 0),e.text&&(t.data.isProfanityCheckInvalid=!1,this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t))),this.removeAllAlertItems(),this.updateTextOnPath(t,e),this.adaptPathToText(t),this.updateTextOnPath(t,null),this.checkAllAlertItems(),this.checkImagesSizeLimit()},updateTextOnPath:function(t,e){if(this.beginDesignOperation(),t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0){var i=t.data.text;if(!i)for(var n=0;n<t.children.length;n++)i+=t.children[n].content;var r=this.getItemConstraints(t),a=null,s=this.findDesignItemForItem(t);s&&(a=this.getDesignEffectForDesignItem(s));var o=null,l=null,h=null;(e=e||{}).text=e.text||i,this.allowShadows()||(e.shadowColor=null),!r||r.get("canChangeFontColor")?(null!=e.strokeColor&&(o=e.strokeColor),null!=e.fillColor&&(l=e.fillColor),o=this.forceColorInFixedPalette(t,o),l=this.forceColorInFixedPalette(t,l),e.strokeColor=null!=e.strokeColor?this.applyDesignEffectToTextColor(a,o):t.children[0].strokeColor,e.fillColor=null!=e.fillColor?this.applyDesignEffectToTextColor(a,l):t.children[0].fillColor):(e.strokeColor=t.children[0].strokeColor,e.fillColor=t.children[0].fillColor),!r||r.get("canChangeShadowColor")?(void 0!==e.shadowColor&&(h=e.shadowColor),h=this.forceColorInFixedPalette(t,h),e.shadowColor=this.allowShadows()?void 0!==e.shadowColor?this.applyDesignEffectToTextColor(a,h):t.children[0].shadowColor:null):e.shadowColor=this.allowShadows()?t.children[0].shadowColor:null,e.strokeWidth=null!=e.strokeWidth?e.strokeWidth:t.children[0].strokeWidth,e.shadowBlur=null!=e.shadowBlur?e.shadowBlur:t.children[0].shadowBlur,e.shadowDistance=null!=e.shadowDistance?e.shadowDistance:this.getOffsetDistance(t.children[0].shadowOffset),e.shadowAngle=null!=e.shadowAngle?e.shadowAngle:this.getOffsetAngle(t.children[0].shadowOffset),e.shadowBlur=this.adjustInputShadowBlur(t,e.shadowBlur),e.shadowDistance=this.adjustInputShadowDistance(t,e.shadowDistance),e.shadowAngle=this.adjustInputShadowAngle(t,e.shadowAngle),!r||r.get("canChangeFontFamily")?e.fontFamily=null!=e.fontFamily?e.fontFamily:t.children[0].fontFamily:e.fontFamily=t.children[0].fontFamily,e.fontFamily=this.sanitizeFontFamilyName(e.fontFamily);var c=null!=e.fontWeight?e.fontWeight:t.children[0].fontWeight;e.fontWeight=this.adjustInputFontWeightByConstraints(t.children[0].fontWeight,c,r),e.fontStretch=null!=e.fontStretch?e.fontStretch:t.children[0].fontStretch,!r||r.get("canChangeFontSize")?e.fontSize=null!=e.fontSize?e.fontSize:t.children[0].fontSize:e.fontSize=t.children[0].fontSize,e.scaling=null!=e.scaling?e.scaling:t.children[0].scaling,t.data.text=e.text,o&&(t.data.originalStrokeColor=o),l&&(t.data.originalFillColor=l),h&&(t.data.originalShadowColor=h),e.letterSpacing=null!=e.letterSpacing?e.letterSpacing:null!=t.data.letterSpacing?t.data.letterSpacing:0,t.data.letterSpacing=e.letterSpacing,t.removeChildren();var u=t.data.points[0],d=t.data.points[1],f=t.data.points[2],g=new this.paper.Path.Arc(u,d,f);g.remove();var p=g.getPointAt(.5*g.length);t.data.points[1]=p,t.addChildren(this.createAlignedText(g,e,null)),this.applyDesignEffectToItem(a,t),this.updateSelectionState(),this.paper.project.view.update()}this.endDesignOperation()},adaptPathToText:function(t){performance.now();if(t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length){var e=t.data.text;if(!e)for(var i=0;i<t.children.length;i++)e+=t.children[i].content;var n=t.data.points[0],r=t.data.points[1],a=t.data.points[2],s=new this.paper.Path.Arc(n,r,a);s.remove();var o={};o.text=e,o.strokeColor=t.children[0].strokeColor,o.strokeWidth=t.children[0].strokeWidth,o.fillColor=t.children[0].fillColor,o.fontFamily=t.children[0].fontFamily,o.fontWeight=t.children[0].fontWeight,o.fontSize=t.children[0].fontSize,o.scaling=t.children[0].scaling,o.letterSpacing=null!=t.data.letterSpacing?t.data.letterSpacing:0,o.shadowColor=t.children[0].shadowColor,o.shadowBlur=t.children[0].shadowBlur,o.shadowDistance=this.getOffsetDistance(t.children[0].shadowOffset),o.shadowAngle=this.getOffsetAngle(t.children[0].shadowOffset);var l=0;if(this.isLetterSpacingSpecified(o)){var h=this.getTextExtraSpace(o),c=null;for(i=0;i<e.length;i++)i>0&&(l+=h),l+=(c=this.createPointText(e.substring(i,i+1),o)).bounds.width,c.remove()}else{var u=this.createPointText(e,o);u.remove(),l=u.bounds.width}if(Math.abs(l-s.length)<.001){performance.now();return}var d=this.getCircleCenter(n,a,r),f=n.getDistance(d),g=2*Math.PI*f,p=(s.length,(l-s.length)/g*360),m=this.getCircleAngleAtPoint(d.x,d.y,f,n.x,n.y),v=this.getCircleAngleAtPoint(d.x,d.y,f,a.x,a.y),_=this.getCircleAngleAtPoint(d.x,d.y,f,r.x,r.y),y=0,x=0;(m=this.getNormalizedAngle(m))>(v=this.getNormalizedAngle(v))?y=360-(x=m-v):x=360-(y=v-m),(_=this.getNormalizedAngle(_))<m?(p+x>359&&(p=359-x),m+=p/2,v-=p/2):(p+y>359&&(p=359-y),m-=p/2,v+=p/2),m=this.getNormalizedAngle(m),v=this.getNormalizedAngle(v);var b=this.getCirclePointAtAngle(d.x,d.y,f,m),I=this.getCirclePointAtAngle(d.x,d.y,f,v);t.data.points[0]=b,t.data.points[2]=I,this.updateSelectionState(),this.paper.project.view.update()}performance.now()},createAlignedText:function(t,e,i){performance.now();var n=[],r=[],a=e.inside||!1;if(e&&e.text&&e.text.length>0&&t){var s=e.text,o=(this.getSpaceWidth(e),this.getTextExtraSpace(e)),l=this.createPointText(s,e);l.remove();for(var h=l.bounds.width,c=0,u=0;u<s.length;u++)u>0&&(c+=o),r[u]=this.createPointText(s.substring(u,u+1),e),r[u].justification="center",c+=r[u].bounds.width;var d=this.isLetterSpacingSpecified(e)?c:h;i||(i=d<t.length+.05?(t.length-d)/2+r[0].bounds.width/2:0);var f=[i];for(u=1;u<s.length;u++){var g=this.createPointText(s.substring(u-1,u+1),e);g.remove(),f[u]=a?f[u-1]-(g.bounds.width-r[u-1].bounds.width/2-r[u].bounds.width/2+o):f[u-1]+(g.bounds.width-r[u-1].bounds.width/2-r[u].bounds.width/2+o)}for(u=0;u<s.length;u++){var p=f[u];if(p<0&&t.closed&&(p=t.length+p),t.length<p&&(t.closed?p%=t.length:p=void 0),void 0===p)r[u].remove();else{n.push(r[u]);var m=t.getPointAt(p);r[u].point=m;var v=t.getTangentAt(p);if(v){var _=v.angle;a&&(_-=180),r[u].rotate(_,m)}}}}performance.now();return n},createPointText:function(t,e){var i=new this.paper.PointText;return i.content=t,e&&(i.strokeColor=e.strokeColor||"black",i.strokeWidth=null!=e.strokeWidth?e.strokeWidth:0,i.fillColor=e.fillColor||"black",i.fontFamily=e.fontFamily||"Verdana",i.fontWeight=e.fontWeight||"normal",i.fontSize=e.fontSize||12,e.scaling&&(i.scaling=e.scaling),i.shadowColor=e.shadowColor,i.shadowBlur=e.shadowBlur,i.shadowOffset=this.getOffsetByDistanceAngle(e.shadowDistance,e.shadowAngle)),i},getCircleCenter:function(t,e,i){var n=Math.pow(e.x,2)+Math.pow(e.y,2),r=(Math.pow(t.x,2)+Math.pow(t.y,2)-n)/2,a=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,s=(t.x-e.x)*(e.y-i.y)-(e.x-i.x)*(t.y-e.y);return!(Math.abs(s)<1e-14)&&new this.paper.Point((r*(e.y-i.y)-a*(t.y-e.y))/s,((t.x-e.x)*a-(e.x-i.x)*r)/s)},getCirclePointAtAngle:function(t,e,i,n){var r=n*Math.PI/180,a=i*Math.cos(r)+t,s=i*Math.sin(r)+e;return new paper.Point(a,s)},getCircleAngleAtPoint:function(t,e,i,n,r){return 0==i?0:(180*Math.atan2(r-e,n-t)/Math.PI+360)%360},getNormalizedAngle:function(t){return t<0&&(t=360+t),t>360&&(t-=360),t},addTextAreaElement:function(t,e,i){if(void 0===i&&(i=!0),i||this.canAddText()){var n=null;if(this.side)if(r=this.side.get("areas").getMaxArea()){if(this.beginDesignOperation(),!t&&this.side){var r=this.side.get("areas").getMaxArea(),a=this.findItemForArea(r);a&&(t=a.bounds.expand(-50))}if(!t)return;if(e&&e.text){var s=this.getDesignEffectForArea(r);this.allowShadows()||(e.shadowColor=null);var o=e.strokeColor||"#000000",l=e.fillColor||"#000000",h=e.shadowColor||null;o=this.forceColorInFixedPalette(null,o),l=this.forceColorInFixedPalette(null,l),h=this.forceColorInFixedPalette(null,h),e.strokeColor=this.applyDesignEffectToTextColor(s,o),e.fillColor=this.applyDesignEffectToTextColor(s,l),e.shadowColor=this.applyDesignEffectToTextColor(s,h),e.shadowBlur=this.adjustInputShadowBlur(null,e.shadowBlur),e.shadowDistance=this.adjustInputShadowDistance(null,e.shadowDistance),e.shadowAngle=this.adjustInputShadowAngle(null,e.shadowAngle),e.letterSpacing=null!=e.letterSpacing?e.letterSpacing:0,e.lineSpacing=null!=e.lineSpacing?e.lineSpacing:0,this.deselectAll(),this.updateSelectionState(),(n=new this.paper.Group).addChildren(this.createWrappedText(t,e,!1).textItems),this.applyDesignEffectToItem(s,n),t=n.bounds,n.data.rect=t,n.data.isTextArea=!0,n.data.text=e.text,n.data.justification=null!=e.justification?e.justification:"justify",n.data.originalStrokeColor=o,n.data.originalFillColor=l,n.data.originalShadowColor=h,n.data.letterSpacing=e.letterSpacing,n.data.lineSpacing=e.lineSpacing,n.rotation=e.rotation,this.masterGroup.addChild(n);var c=t.center.subtract(n.position);n.position=t.center,n.data.needsTransformsDataUpdate=!0,this.updateTransformsData(n),this.onTextAreaMoved(n,c),this.forceTextAreaToBounds(n),this.onItemCreated(n),this.setItemSelection(n,!0)}this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()}return n}},isItemTextArea:function(t){return t&&t.data&&t.data.isTextArea},isItemTextBox:function(t){return this.isItemTextArea(t)&&t.data.isTextBox},isSimpleTextArea:function(t){return t&&t.data&&t.data.isTextArea&&!t.data.isTextBox},convertSelectedTextAreaToTextBox:function(){var t=this;this.getSelectedTextAreaItems().forEach(function(e){return t.convertTextAreaToTextBox(e)})},convertSelectedTextBoxToTextArea:function(){var t=this;this.getSelectedTextAreaItems().forEach(function(e){return t.convertTextBoxToTextArea(e)})},toggleSelectedTextArea:function(){var t=this;this.getSelectedTextAreaItems().forEach(function(e){e.data.isTextBox?t.convertTextBoxToTextArea(e):t.convertTextAreaToTextBox(e)})},convertTextAreaToTextBox:function(t){if(this.canChangeItemTextBoxMode(t)&&this.isSimpleTextArea(t)){var e=this.getLastUndoOperationId();this.beginDesignOperation(),t.data.isTextBox=!0,this.updateTextArea(t,null),this.onItemUpdated(t),this.fireSelectionChangedEvent(),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(e)}},convertTextBoxToTextArea:function(t){if(this.canChangeItemTextBoxMode(t)&&this.isItemTextBox(t)){var e=this.getLastUndoOperationId();this.beginDesignOperation(),t.data.isTextBox=!1,this.updateTextArea(t,null),this.onItemUpdated(t),this.fireSelectionChangedEvent(),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(e)}},getAllTextAreaItems:function(){var t=[];function e(i){if(i.children)for(var n=i.children.length-1;n>=0;n--){var r=i.children[n];!r.guide&&r.data&&r.data.isTextArea&&t.push(r),e(r)}}for(var i=0,n=this.paper.project.layers.length;i<n;i++){var r=this.paper.project.layers[i];r.guide||e(r)}return t},updateTextAreaGuides:function(t){t||(t=this.getAllTextAreaItems());for(var e=0;e<t.length;e++){var i=t[e];this.updateTextAreaGuide(i)}},updateTextAreaGuide:function(t){t.data.selected&&this.canEditItem(t)?(this.drawTextAreaGuide(t),this.drawTextAreaHandles(t)):(this.removeTextAreaGuide(t),this.removeTextAreaHandles(t))},drawTextAreaGuide:function(t){if(this.removeTextAreaGuide(t),t&&t.data&&t.data.isTextArea&&t.data.isTextBox&&t.data.rect){var e=new this.paper.Path.Rectangle(t.data.rect);e.data.isTextAreaGuide=!0,e.strokeWidth=1/this.paper.view.zoom,e.dashOffset=1/this.paper.view.zoom,e.dashArray=[2/this.paper.view.zoom,2/this.paper.view.zoom],e.guide=!0,e.data.itemGuid=t.data.guid,e.strokeColor=this.getContrastedColor(t.data.rect),t.children&&t.children.length>0?e.rotation=t.children[0].rotation:t.data.textInfo&&null!=t.data.textInfo.rotation&&(e.rotation=t.data.textInfo.rotation)}},findTextAreaGuide:function(t){if(t&&t.data&&t.data.isTextArea&&t.data.guid)for(var e=t.data.guid.toUpperCase(),i=function(t,n){if(t.data&&t.data.isTextAreaGuide&&t.data.itemGuid&&t.data.itemGuid.toUpperCase()==n)return t;if(t.children)for(var r=t.children.length-1;r>=0;r--){var a=t.children[r],s=i(a,e);if(s)return s}},n=0;n<this.paper.project.layers.length;n++){var r=this.paper.project.layers[n];if(!r.guide){var a=i(r,e);if(a)return a}}return null},removeTextAreaGuide:function(t){var e=this.findTextAreaGuide(t);e&&e.remove()},drawTextAreaHandles:function(t){if(this.removeTextAreaHandles(t),this.canResizeTextBoxItem(t)&&t&&t.data&&t.data.isTextArea&&t.data.isTextBox&&t.data.rect){var e=this.selectionLateralResizeDimension/this.paper.view.zoom,i=new this.paper.Path.Rectangle(t.data.rect);t.children&&t.children.length>0?i.rotation=t.children[0].rotation:t.data.textInfo&&null!=t.data.textInfo.rotation&&(i.rotation=t.data.textInfo.rotation),i.remove();var n=i.segments;if(4==n.length){var r=n[0].point,a=n[1].point,s=n[2].point,o=n[3].point,l=a.add(s.subtract(a).divide(2)),h=r.add(o.subtract(r).divide(2)),c=r.add(a.subtract(r).divide(2)),u=o.add(s.subtract(o).divide(2)),d=1.2*e,f=l.subtract(h).normalize(d);l=l.add(f),h=h.subtract(f),f=u.subtract(c).normalize(d),u=u.add(f),c=c.subtract(f);var g=new this.paper.Path.Circle(l,e);g.data.isTextAreaHandle=!0,g.data.isTextAreaTopEndHandle=!0,g.strokeColor=new this.paper.Color(1,1,1,.5),g.strokeWidth=1,g.fillColor=new this.paper.Color(0,0,0,.5),g.data.itemGuid=t.data.guid;var p=new this.paper.Path.Circle(u,e);p.data.isTextAreaHandle=!0,p.data.isTextAreaRightEndHandle=!0,p.strokeColor=new this.paper.Color(1,1,1,.5),p.strokeWidth=1,p.fillColor=new this.paper.Color(0,0,0,.5),p.data.itemGuid=t.data.guid;var m=new this.paper.Path.Circle(h,e);m.data.isTextAreaHandle=!0,m.data.isTextAreaBottomEndHandle=!0,m.strokeColor=new this.paper.Color(1,1,1,.5),m.strokeWidth=1,m.fillColor=new this.paper.Color(0,0,0,.5),m.data.itemGuid=t.data.guid;var v=new this.paper.Path.Circle(c,e);v.data.isTextAreaHandle=!0,v.data.isTextAreaLeftEndHandle=!0,v.strokeColor=new this.paper.Color(1,1,1,.5),v.strokeWidth=1,v.fillColor=new this.paper.Color(0,0,0,.5),v.data.itemGuid=t.data.guid}}},findTextAreaHandles:function(t){var e=[];if(t&&t.data&&t.data.isTextArea&&t.data.guid)for(var i=t.data.guid.toUpperCase(),n=function(t,r){if(t.data&&t.data.isTextAreaHandle&&t.data.itemGuid&&t.data.itemGuid.toUpperCase()==r&&e.push(t),t.children)for(var a=t.children.length-1;a>=0;a--){var s=t.children[a];n(s,i)}},r=0;r<this.paper.project.layers.length;r++){var a=this.paper.project.layers[r];a.guide||n(a,i)}return e},removeTextAreaHandles:function(t){for(var e=this.findTextAreaHandles(t),i=0;i<e.length;i++){e[i].remove()}},onTextAreaMoved:function(t,e){if(t&&t.data&&t.data.isTextArea&&t.data.rect){var i=t.data.rect.clone();i.x+=e.x,i.y+=e.y,t.data.rect=i}},onTextAreaRotated:function(t,e,i){t&&t.data&&t.data.isTextBox&&this.updateTextArea(t,null)},onTextAreaScaled:function(t,e,i,n){if(t&&t.data&&t.data.isTextArea&&t.data.rect)if(t.data.isTextBox)this.updateTextArea(t,null);else{var r=new this.paper.Path.Rectangle(t.data.rect);r.remove(),r.scale(e,i,n),t.data.rect=r.bounds.clone()}},canResizeSelectedTextAreas:function(t,e,i){for(var n=this.getSelectedItems(),r=0;r<n.length;r++){var a=n[r];if(!this.canResizeTextArea(a,t,e,i))return!1}return!0},canResizeTextArea:function(t,e,i,n){if(t&&t.data&&t.data.isTextArea&&t.data.isTextBox&&t.data.rect&&t.children&&t.children.length>0){var r=t.children[0].clone();r.scale(e,i,n);var a=r.scaling;r.remove();var s=this.getTextAreaItemInfo(t,null);s.scaling=a;var o=this.createWrappedText(t.data.rect.clone(),s,!0).textItems;if(console.log("children count: "+o.length),0==o.length)return!1;o.forEach(function(t){t.remove()})}return!0},moveTextAreaTopEnd:function(t){this.moveTextAreaEnd(t,"top")},moveTextAreaRightEnd:function(t){this.moveTextAreaEnd(t,"right")},moveTextAreaBottomEnd:function(t){this.moveTextAreaEnd(t,"bottom")},moveTextAreaLeftEnd:function(t){this.moveTextAreaEnd(t,"left")},moveTextAreaEnd:function(t,e){if(!this.frozen&&t.delta){var i=t.delta;this.hideCenterLines(),this.removeSelectionAlertItems();var n=this.getSelectedTextAreaItems();if(n&&n.length>0){var r=n[0];if(r&&r.data&&r.data.isTextArea&&r.data.rect){var a=r.data.rect.clone(),s="bottom";"top"==e?(r.data.rect.top+=i.y,s="bottom"):"right"==e?(r.data.rect.right+=i.x,s="left"):"bottom"==e?(r.data.rect.bottom+=i.y,s="top"):"left"==e&&(r.data.rect.left+=i.x,s="right"),this.correctTextBoxRectRotationError(r,a,s),r.data.needsTransformsDataUpdate=!0,this.drawTextAreaGuide(r),this.drawTextAreaHandles(r),this.updateTextArea(r,null),0==r.children.length&&r.data.text&&(r.data.rect=a.clone(),r.data.needsTransformsDataUpdate=!0,this.drawTextAreaGuide(r),this.drawTextAreaHandles(r),this.updateTextArea(r,null))}}}},correctTextBoxRectRotationError:function(t,e,i){if(t&&t.data&&t.data.isTextBox&&t.data.rect){var n=0;if(t.children&&t.children.length>0?n=t.children[0].rotation:t.data.textInfo&&null!=t.data.textInfo.rotation&&(n=t.data.textInfo.rotation),0!=n){var r=new this.paper.Path.Rectangle(e);r.rotate(n),r.remove();var a=r.segments,s=null,o=null,l=null,h=null;if(4==a.length){var c=a[0].point,u=a[1].point,d=a[2].point,f=a[3].point;s=u.add(d.subtract(u).divide(2)),o=c.add(f.subtract(c).divide(2)),l=c.add(u.subtract(c).divide(2)),h=f.add(d.subtract(f).divide(2))}var g=new this.paper.Path.Rectangle(t.data.rect);g.rotate(n),g.remove();var p=g.segments,m=null,v=null,_=null,y=null;if(4==p.length){var x=p[0].point,b=p[1].point,I=p[2].point,C=p[3].point;m=b.add(I.subtract(b).divide(2)),v=x.add(C.subtract(x).divide(2)),_=x.add(b.subtract(x).divide(2)),y=C.add(I.subtract(C).divide(2))}var w=null,S=null;if("bottom"==i?(w=o,S=v):"top"==i?(w=s,S=m):"right"==i?(w=h,S=y):"left"==i&&(w=l,S=_),w&&S){var M=S.subtract(w);t.data.rect.x-=M.x,t.data.rect.y-=M.y}}}},adaptTextBoxFontSize:function(t){if(this.isItemTextBox(t)){var e=this.getItemConstraints(t);if(e&&!e.get("canChangeFontSize"))return;var i=this.getTextAreaItemInfo(t,null);if(i.adaptText)return;for(var n=i.fontSize;i.text&&0==t.children.length&&n>=1;)n-=1,this.updateTextArea(t,{fontSize:n})}},modifyTextAreaInfo:function(t,e){e&&(e.text=this.adjustInputTextByConstraints(t,null!=e.text?e.text:t.data.text),e.letterSpacing=this.adjustInputLetterSpacingByConstraints(t,e.letterSpacing?parseInt(e.letterSpacing):void 0),e.lineSpacing=this.adjustInputLineSpacingByConstraints(t,e.lineSpacing?parseInt(e.lineSpacing):void 0),e.text&&(t.data.isProfanityCheckInvalid=!1,this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t))),this.removeAllAlertItems(),this.updateTextArea(t,e),this.checkImagesSizeLimit()},getTextAreaItemInfo:function(t,e){if(t&&t.data&&t.data.isTextArea){var i=null;if(t.children.length>0){var n=t.children[0];(i={}).strokeColor="string"==typeof n.strokeColor||n.strokeColor instanceof String?n.strokeColor:n.strokeColor.toCSS(!0),i.fillColor="string"==typeof n.fillColor||n.fillColor instanceof String?n.fillColor:n.fillColor.toCSS(!0),i.strokeWidth=n.strokeWidth,i.fontFamily=n.fontFamily,i.fontWeight=n.fontWeight,i.fontStretch=n.fontStretch,i.fontSize=n.fontSize,i.scaling=n.scaling,i.rotation=n.rotation,i.shadowColor=null,n.shadowColor&&(i.shadowColor="string"==typeof n.shadowColor||n.shadowColor instanceof String?n.shadowColor:n.shadowColor.toCSS(!0)),i.shadowBlur=n.shadowBlur,i.shadowDistance=this.getOffsetDistance(n.shadowOffset),i.shadowAngle=this.getOffsetAngle(n.shadowOffset)}i=i||{};var r=this.getItemConstraints(t);(e=e||{}).text=e.text||t.data.text;var a=t.data.textInfo||{};!r||r.get("canChangeFontColor")?(e.strokeColor=null!=e.strokeColor?e.strokeColor:null!=i.strokeColor?i.strokeColor:a.strokeColor,e.fillColor=null!=e.fillColor?e.fillColor:null!=i.fillColor?i.fillColor:a.fillColor):(e.strokeColor=null!=i.strokeColor?i.strokeColor:a.strokeColor,e.fillColor=null!=i.fillColor?i.fillColor:a.fillColor),e.strokeWidth=null!=e.strokeWidth?e.strokeWidth:null!=i.strokeWidth?i.strokeWidth:a.strokeWidth,!r||r.get("canChangeFontFamily")?e.fontFamily=null!=e.fontFamily?e.fontFamily:null!=i.fontFamily?i.fontFamily:a.fontFamily:e.fontFamily=null!=i.fontFamily?i.fontFamily:a.fontFamily,e.fontFamily=this.sanitizeFontFamilyName(e.fontFamily);var s=null!=e.fontWeight?e.fontWeight:null!=i.fontWeight?i.fontWeight:a.fontWeight;e.fontWeight=this.adjustInputFontWeightByConstraints(null!=i.fontWeight?i.fontWeight:a.fontWeight,s,r),e.fontStretch=null!=e.fontStretch?e.fontStretch:null!=i.fontStretch?i.fontStretch:a.fontStretch,!r||r.get("canChangeFontSize")?e.fontSize=null!=e.fontSize?e.fontSize:null!=i.fontSize?i.fontSize:a.fontSize:e.fontSize=null!=i.fontSize?i.fontSize:a.fontSize,e.scaling=null!=e.scaling?e.scaling:null!=i.scaling?i.scaling:a.scaling,e.scaling=e.scaling||1,e.justification=null!=e.justification?e.justification:null!=t.data.justification?t.data.justification:"justify",e.rotation=null!=i.rotation?i.rotation:a.rotation,e.rotation=e.rotation||0,e.isTextBox=t.data&&t.data.isTextBox,e.adaptText=null!=e.adaptText?e.adaptText:null!=t.data.adaptText&&t.data.adaptText,e.wrapTextOnAdaptText=this.canWrapTextOnAdaptText(t),!r||r.get("canChangeVerticalAlignment")?e.verticalAlignment=null!=e.verticalAlignment?e.verticalAlignment:null!=t.data.verticalAlignment?t.data.verticalAlignment:"top":e.verticalAlignment=null!=t.data.verticalAlignment?t.data.verticalAlignment:"top";null!=e.letterSpacing?e.letterSpacing:null!=t.data.letterSpacing&&t.data.letterSpacing;e.letterSpacing=this.adjustInputLetterSpacingByConstraints(t,e.letterSpacing);null!=e.lineSpacing?e.lineSpacing:null!=t.data.lineSpacing&&t.data.lineSpacing;return e.lineSpacing=this.adjustInputLineSpacingByConstraints(t,e.lineSpacing),!r||r.get("canChangeShadowColor")?e.shadowColor=void 0!==e.shadowColor?e.shadowColor:void 0!==i.shadowColor?i.shadowColor:a.shadowColor:e.shadowColor=void 0!==i.shadowColor?i.shadowColor:a.shadowColor,!r||r.get("canChangeShadowBlur")?e.shadowBlur=void 0!==e.shadowBlur?e.shadowBlur:null!=i.shadowBlur?i.shadowBlur:a.shadowBlur:e.shadowBlur=void 0!==i.shadowBlur?i.shadowBlur:a.shadowBlur,!r||r.get("canChangeShadowDistance")?e.shadowDistance=void 0!==e.shadowDistance?e.shadowDistance:null!=i.shadowDistance?i.shadowDistance:a.shadowDistance:e.shadowDistance=void 0!==i.shadowDistance?i.shadowDistance:a.shadowDistance,!r||r.get("canChangeShadowAngle")?e.shadowAngle=void 0!==e.shadowAngle?e.shadowAngle:null!=i.shadowAngle?i.shadowAngle:a.shadowAngle:e.shadowAngle=void 0!==i.shadowAngle?i.shadowAngle:a.shadowAngle,this.allowShadows()||(e.shadowColor=null),e.shadowBlur=this.adjustInputShadowBlur(t,e.shadowBlur),e.shadowDistance=this.adjustInputShadowDistance(t,e.shadowDistance),e.shadowAngle=this.adjustInputShadowAngle(t,e.shadowAngle),e}return null},setTextAreaItemInfo:function(t,e){t&&(t.data.textInfo=e)},updateTextArea:function(t,e){if(t&&t.data&&t.data.isTextArea&&t.data.rect){var i=t.data.text||e.text,n=this.getTextAreaItemInfo(t),r=null,a=this.findDesignItemForItem(t);a&&(r=this.getDesignEffectForDesignItem(a));var s=null,o=null,l=null;e&&null!=e.strokeColor&&(s=e.strokeColor,s=this.forceColorInFixedPalette(t,s,n.strokeColor),e.strokeColor=this.applyDesignEffectToTextColor(r,s),t.data.originalStrokeColor=s),e&&null!=e.fillColor&&(o=e.fillColor,o=this.forceColorInFixedPalette(t,o,n.fillColor),e.fillColor=this.applyDesignEffectToTextColor(r,o),t.data.originalFillColor=o),e&&void 0!==e.shadowColor&&(l=e.shadowColor,l=this.forceColorInFixedPalette(t,l,n.shadowColor),e.shadowColor=this.applyDesignEffectToTextColor(r,l),t.data.originalShadowColor=l),this.beginDesignOperation();var h=t.bounds.clone();if(e=this.getTextAreaItemInfo(t,e)){var c=e.text;t.data.justification=e.justification,t.data.text=e.text,t.data.adaptText=e.adaptText,t.data.letterSpacing=e.letterSpacing,t.data.lineSpacing=e.lineSpacing,t.data.verticalAlignment=e.verticalAlignment;var u=e.rotation;e.scaling.x,e.scaling.y,t.matrix.clone();if(t.data.isTextBox){var d=t.data.rect.center.clone();t.rotate(-u,d)}else t.rotate(0-u);var f=t.bounds.clone();if(t.removeChildren(),t.data.isTextBox)if(t.data.adaptText){var g=null;if(i&&i.length>0&&e.text&&Math.abs(i.length-e.text.length)>5){var p=Math.abs(i.length-e.text.length),m=e.fontSize,v=e.fontSize;for(i.length<e.text.length?(v=e.fontSize,(m=this.adjustTextFontSize(t,v-4*p))<1&&(m=1)):(m=e.fontSize,v=this.adjustTextFontSize(t,m+4*p)),e.fontSize=Math.round(m+(v-m)/2);e.fontSize-m>0&&v-e.fontSize>0;)g&&g.textItems.forEach(function(t){return t.remove()}),(g=this.createWrappedText(t.data.rect,e,!0)).limitsExceeded?v=e.fontSize:m=e.fontSize,e.fontSize=Math.round(m+(v-m)/2)}for(g||(g=this.createWrappedText(t.data.rect,e,!0));!g.limitsExceeded&&this.canSetTextFontSizePx(t,e.fontSize+1);)g.textItems.forEach(function(t){return t.remove()}),e.fontSize+=1,g=this.createWrappedText(t.data.rect,e,!0);for(;g.limitsExceeded&&e.fontSize>1&&this.canSetTextFontSizePx(t,e.fontSize-1);)g.textItems.forEach(function(t){return t.remove()}),e.fontSize-=1,g=this.createWrappedText(t.data.rect,e,!0);t.addChildren(g.textItems)}else t.addChildren(this.createWrappedText(t.data.rect.clone(),e,!0).textItems);else t.addChildren(this.createWrappedText(f,e,!1).textItems);if(this.applyDesignEffectToItem(r,t),t.data.isTextBox){d=t.data.rect.center.clone();t.rotate(u,d)}else t.rotate(u);t.data.isTextBox||this.alignTextAreaItem(t,u,e.justification,h,c),t.data.isTextBox||(t.data.rect=t.bounds.clone()),this.setTextAreaItemInfo(t,e),this.updateSelectionState(),this.paper.project.view.update()}this.endDesignOperation()}},alignTextAreaItem:function(t,e,i,n,r){if(null!=r){var a=new this.paper.Point(n.x+n.width/2,n.y+n.height/2);if("center"!=i&&"justify"!=i){var s=new this.paper.Point(n.left+t.bounds.width/2,n.top+t.bounds.height/2),o=new this.paper.Point(n.right-t.bounds.width/2,n.top+t.bounds.height/2),l=new this.paper.Point(n.left+t.bounds.width/2,n.bottom-t.bounds.height/2),h=new this.paper.Point(n.right-t.bounds.width/2,n.bottom-t.bounds.height/2);e>=0&&e<=90?a="left"==i?s:h:e>90&&e<=180?a="left"==i?o:l:e>=-90&&e<0?a="left"==i?l:o:e>-180&&e<-90&&(a="left"==i?h:s),t.position=a;var c=t.data.text.split("\n"),u=r.split("\n"),d=c.length-u.length;if(c.length!=u.length){var f=t.children[0].clone();f.visible=!1,f.rotate(0-e);var g=new this.paper.Path.Circle("left"==i?f.bounds.topLeft.clone():f.bounds.topRight.clone(),1);g.visible=!1,g.pivot=new this.paper.Point(f.position.x,f.position.y),g.rotate(e),g.pivot=null,e>=0&&e<=90?"left"==i?a.x-=(g.position.x-t.children[0].bounds.left)*d:a.y+=(t.children[0].bounds.bottom-g.position.y)*d:e>90&&e<=180?"left"==i?a.y-=(g.position.y-t.children[0].bounds.top)*d:a.x-=(g.position.x-t.children[0].bounds.left)*d:e>=-90&&e<0?"left"==i?a.y+=(t.children[0].bounds.bottom-g.position.y)*d:a.x+=(t.children[0].bounds.right-g.position.x)*d:e>-180&&e<-90&&("left"==i?a.x+=(t.children[0].bounds.right-g.position.x)*d:a.y-=(g.position.y-t.children[0].bounds.top)*d),g.remove(),f.remove()}}t.position=a}},onTextAreaGuidesUpdated:function(t){var e=this.getSelectedItems()[0];e&&e.data&&e.data.isTextArea&&(this.updateSelectionState(),this.updateTextArea(e,null),e.data.isTextBox||(e.data.rect=this.findTextAreaGuide(e).bounds.clone()))},forceSelectedTextAreasToBounds:function(){for(var t=this.getSelectedTextAreaItems(),e=0;e<t.length;e++)this.forceTextAreaToBounds(t[e])},forceTextAreaToBounds:function(t){if(t&&t.data&&t.data.isTextArea&&t.data.rect&&!t.data.isTextBox){var e=t.bounds.clone();e.isEmpty()||(t.data.rect=e)}},createWrappedText:function(t,e,i){var n=this,r=this,a=!1,s=[],o=e.text,l=/[\u0590-\u05ff\u0600-\u06ff]/.test(o),h=null!=e.justification?e.justification:"justify";if(i){var c=this.createPointText(".",e);if(c.remove(),c.bounds.width>t.width+.001)return Logger.info("text area too small for even a single text char"),{limitsExceeded:a=!0,textItems:s}}var u=this.getLineHeight(e);if(u>t.height+.001)return Logger.info("text area too small for even a single text char"),{limitsExceeded:a=!0,textItems:s};var d=this.getSpaceWidth(e),f=this.getTextExtraSpace(e),g=null,p=[],m=[],v=[],_=t.width,y=t.x+t.width,x=t.y+t.height;i||(y=Number.MAX_VALUE),i||(x=Number.MAX_VALUE);for(var b=t.x,I=t.y+u,C=!1,w=function(t){if(null===t||0===t.length)return 0;if(t instanceof r.paper.PointText)return t.bounds.width;var e=t[0].bounds.x,i=t[t.length-1].bounds.right;return Math.abs(i-e)},S=function(t,i){if(t)if(r.isLetterSpacingSpecified(e)){if(t&&t.length>=0){var n=r.createPointText(i,e);n.justification="center";var a=function(t,i){if(!r.isLetterSpacingSpecified(e))return 0;var n=0,a=r.createPointText(i,e);a.justification="center",a.remove(),null!==t&&0!==t.length||(n=b+a.bounds.width/2);var s=t[t.length-1],o=r.createPointText(s.content+i,e);return o.remove(),n=s.point.x+(o.bounds.width-s.bounds.width/2-a.bounds.width/2),n+=f,n=Math.max(n,s.point.x)}(t,i);n.point=new r.paper.Point(a,I),t.push(n),s.push(n)}}else t.content+=i},M=function(t){if(t)if(r.isLetterSpacingSpecified(e)){if(t.length>0)for(var i=0;i<t.length;i++)t[i].remove(),s.pop()}else t.remove(),s.pop()},A=function(t){if(t&&t.length>0){var i=t[0],n=t[t.length-1],a=0,s=0;if(r.isLetterSpacingSpecified(e)){if(0==i.length)return 0;if(0==n.length)return 0;a=i[0].bounds.x,s=n[n.length-1].bounds.right}else a=i.bounds.x,s=n.bounds.right;return Math.abs(s-a)}return 0},T=function(){g=null,p=[],!0!==e.adaptText||!1!==e.wrapTextOnAdaptText?(b=t.x,(I+=u+r.getLineExtraSpace(e))>x&&(C=!0,a=!0)):a=!0},k=function(){p.push(g),1===p.length&&(m.push(p),1===m.length&&v.push(m))},D=function(t){var i=r.createPointText(t,e);r.isLetterSpacingSpecified(e)&&(i.justification="center");var n=i.bounds.width;if(b+n>y&&(p&&p.length>0?T():a=!0),C||a)i.remove();else{if(r.isLetterSpacingSpecified(e)?i.point=new r.paper.Point(b+i.bounds.width/2,I):i.point=new r.paper.Point(b,I),0==v.length&&i.bounds.bottom>I){var o=i.bounds.bottom-I;I-=o,x-=o,r.isLetterSpacingSpecified(e)?i.point=new r.paper.Point(b+i.bounds.width/2,I):i.point=new r.paper.Point(b,I)}g=r.isLetterSpacingSpecified(e)?[i]:i,s.push(i),k()}},P=function(t){if(S(g,t),b+w(g)>y+1e-4)if(1==p.length||e.adaptText)if(e.adaptText)p.pop(),M(g),a=!0;else{if(r.isLetterSpacingSpecified(e))g.pop().remove(),s.pop();else g.content=g.content.substring(0,g.content.length-1);T(),D(t)}else{var i=g;p.pop(),T(),g=i,C?M(g):(!function(t,i,n){if(t)if(r.isLetterSpacingSpecified(e)){if(t.length>0)for(var a=t[0].bounds.x-i,s=0;s<t.length;s++)t[s].point=new r.paper.Point(t[s].point.x-a,n)}else t.point=new r.paper.Point(i,n)}(g,b,I),k())}},E=function(t){g&&0!==g.length?P(t):D(t)},z=0;z<o.length&&!C&&!a;z++){var O=o[z];"\n"==O?(T(),m=[]):" "===O?(g&&(b+=w(g)),g=null,b+d<=y?b+=d+f:T()):E(O)}var B=void 0,R=void 0;for(z=0;z<v.length;z++)for(var L=v[z],F=0;F<L.length;F++){if(0!==(Z=L[F]).length){for(var G=0;G<Z.length;G++){var N=Z[G];N instanceof r.paper.PointText?(B=null==B?N.bounds.top:Math.min(B,N.bounds.top),R=null==R?N.bounds.bottom:Math.max(R,N.bounds.bottom)):N.length>0&&N.forEach(function(t){B=null==B?t.bounds.top:Math.min(B,t.bounds.top),R=null==R?t.bounds.bottom:Math.max(R,t.bounds.bottom)})}if("justify"!=h||F!=L.length-1){var U=A(Z);U>_&&(_=U),l&&this.invertLineRtlWords(Z,t.x,t.x+t.width,d,e),this.justifyLine(Z,t,t.x+U,h,e)}}}var j=null==B||null==R?0:t.height-Math.abs(R-B);if(i&&j>0&&("middle"==e.verticalAlignment||"bottom"==e.verticalAlignment)){"middle"==e.verticalAlignment&&(j/=2);for(z=0;z<v.length;z++)for(L=v[z],F=0;F<L.length;F++){var Z;if(0!==(Z=L[F]).length)for(G=0;G<Z.length;G++){var W=Z[G];W instanceof r.paper.PointText?W.point=new this.paper.Point(W.point.x,W.point.y+j):W.length>0&&W.forEach(function(t){t.point=new n.paper.Point(t.point.x,t.point.y+j)})}}}return i||(t.width=_),{limitsExceeded:a||C,textItems:s}},justifyLine:function(t,e,i,n,r){var a=this,s=function(t,e,i){if(t)if(t instanceof a.paper.PointText)t.point=new a.paper.Point(e,i);else if(t.length>0)for(var n=t[0].bounds.x-e,r=0;r<t.length;r++)t[r].point=new a.paper.Point(t[r].point.x-n,i)};if(t.length>0){var o=i-e.x,l=e.width-o;if("justify"==n){if(t.length>1)for(var h=l/(t.length-1),c=1;c<t.length;c++){if((u=t[c])instanceof a.paper.PointText)u.point=new this.paper.Point(u.point.x+h*c,u.point.y);else s(u,u[0].bounds.x+h*c,u[0].point.y)}}else if("right"==n)for(c=0;c<t.length;c++){if((u=t[c])instanceof a.paper.PointText)u.point=new this.paper.Point(u.point.x+l,u.point.y);else s(u,u[0].bounds.x+l,u[0].point.y)}else if("center"==n)for(c=0;c<t.length;c++){var u;if((u=t[c])instanceof a.paper.PointText)u.point=new this.paper.Point(u.point.x+l/2,u.point.y);else s(u,u[0].bounds.x+l/2,u[0].point.y)}}},invertLineRtlWords:function(t,e,i,n,r){var a=this,s=(n=this.getSpaceWidth(r),this.getTextExtraSpace(r)),o=function(t){if(null===t||0===t.length)return 0;if(t instanceof a.paper.PointText)return t.bounds.width;for(var e=[],i=0;i<t.length;i++)e[i]=t[i];e.sort(function(t,e){return t.point.x>e.point.x?1:e.point.x>t.point.x?-1:0});var n=e[0].bounds.x,r=e[e.length-1].bounds.right;return Math.abs(r-n)},l=function(t,e,i){if(t&&e)if(t instanceof a.paper.PointText)t.point=new a.paper.Point(i,t.point.y);else if(e&&e.length>0)for(var n=e[0].bounds.x-i,r=0;r<e.length;r++)e[r].point=new a.paper.Point(e[r].point.x-n,e[r].point.y)},h=function(t){var e="";if(!t||0==t.length)return e;if(t instanceof a.paper.PointText)return t.content;for(var i=0;i<t.length;i++)e+=t[i].content;return e},c=function(t){return/[\u0590-\u05ff\u0600-\u06ff]/.test(t)},u=function(t){return/[!,.:;?]/g.test(t)},d=function(t){var e=h(t),i=e,n="",r="";if(c(e)){for(var a=e.length-1;a>=0&&(r=e.substring(a),!c(r));a--)n=r,i=e.substring(0,a);i&&n&&(t.content=n+i)}else{for(a=e.length-1;a>=0&&(r=e[a],u(r));a--)n=e.substring(a),i=e.substring(0,a);i&&n&&(t.content=n+i)}return t},f=function(t){var e=h(t),i=-1;if(c(e)){for(var o=t.length-1;o>=0;o--)if(c(h(t.slice(o)))){i=o+1;break}}else for(o=t.length-1;o>=0;o--)if(!u(t[o].content)){i=o+1;break}var l=t.slice(0);if(i>=0){l=[];for(o=i;o<t.length;o++)l[o-i]=t[o];for(o=0;o<i&&o<t.length;o++)l[t.length-1-o]=t[o];var d=t[0].bounds.x,f=d,g=null,p=null;for(o=0;o<l.length;o++){if(g=l[o],0==o)f=d+g.bounds.width/2;else{p=l[o-1];var m=a.createPointText(p.content+g.content,r);m.remove(),f=p.point.x+(m.bounds.width-p.bounds.width/2-g.bounds.width/2),f+=n*s,f=Math.max(f,p.point.x)}g.point.x=f}}return l};if(t.length>1)for(var g=e,p=t.length-1;p>=0;p--){var m=t[p],v=m;v=!a.isLetterSpacingSpecified(r)&&m instanceof a.paper.PointText?d(m):f(m),p<t.length-1&&(g+=n+s),l(m,v,g),g+=o(v)}else 1==t.length&&(a.isLetterSpacingSpecified(r)?f(t[0]):d(t[0]))},getLineHeight:function(t){var e=this.createPointText("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t);return e.remove(),e.bounds.height},getLineWidth:function(t,e){var i=this.createPointText(t,e);return i.remove(),i.bounds.width},getSpaceWidth:function(t){var e=this.createPointText(" ",t);return e.remove(),e.bounds.width},getFontAscent:function(t){var e=this.getShortcutFontProperty(t),i=this.fontAscentCache.hasOwnProperty(e)?this.fontAscentCache[e]:null,n=this.createPointText("M",t),r=n.bounds;n.remove();var a=Math.floor(r.width)+1,s=Math.floor(r.height)+1;if(!i){var o=$("<canvas>",{id:Math.floor(99999*Math.random()+1)}).attr({width:a,height:s})[0],l=o.getContext("2d");l.fillRect(0,0,o.width,o.height),l.textBaseline="top",l.fillStyle="white",l.font=e,l.fillText("M",0,0);for(var h=l.getImageData(0,0,o.width,o.height).data,c=-1,u=-1,d=0;d<o.height;d++)for(var f=0;f<o.width;f++){if(0!==h[4*(d*o.width+f)]){-1===c&&(c=d);break}if(f===o.width-1&&-1!==c){u=d,d=o.height;break}}i=u-c,this.fontAscentCache[e]=i}return i},getShortcutFontProperty:function(t){var e=t.fontSize+"px "+t.fontFamily;return t.fontStretch&&"normal"!=t.fontStretch&&(e=t.fontStretch+" "+e),t.fontWeight&&"normal"!=t.fontWeight&&(e=t.fontWeight+" "+e),t.fontStyle&&"normal"!=t.fontStyle&&(e=t.fontStyle+" "+e),e},getTextExtraSpace:function(t){return null!=t.letterSpacing?.75*t.letterSpacing:0},isLetterSpacingSpecified:function(t){return null!=t.letterSpacing&&0!=t.letterSpacing},getLineExtraSpace:function(t){return null!=t.lineSpacing?.75*t.lineSpacing:0},isLineSpacingSpecified:function(t){return null!=t.lineSpacing&&0!=t.lineSpacing},toggleSelectionTextOnPath:function(){for(var t=[],e=this.getSelectedTextItems(),i=0;i<e.length;i++){var n=this.toggleItemTextOnPath(e[i]);n&&t.push(n)}return t},convertSelectedTextItemsToTextOnPath:function(){return this.convertSelectionToTextOnPath()},convertSelectedTextOnPathItemsToText:function(){return this.convertSelectionToText()},convertSelectionToText:function(){for(var t=[],e=this.getSelectedTextItems(),i=0;i<e.length;i++){var n=this.convertToText(e[i]);n&&t.push(n)}return t},convertSelectionToTextOnPath:function(){for(var t=[],e=this.getSelectedTextItems(),i=0;i<e.length;i++){var n=this.convertToTextOnPath(e[i]);n&&(n.data.isTemplateElement=e[i].data&&e[i].data.isTemplateElement,t.push(n))}return t},convertSelectionToTextArea:function(){for(var t=[],e=this.getSelectedTextItems(),i=0;i<e.length;i++){var n=this.convertToTextArea(e[i]);n&&t.push(n)}return t},toggleItemTextOnPath:function(t){return t?t instanceof this.paper.TextItem||t&&t.data&&t.data.isTextArea?this.convertToTextOnPath(t):t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0?this.convertToTextArea(t):this.convertToText(t):null},convertToTextOnPath:function(t){return!this.canChangeItemTextPathMode(t)||t.data&&t.data.isTextOnPath?null:t&&t instanceof this.paper.TextItem?this.fromTextToTextOnPath(t):t&&t.data&&t.data.isTextArea&&t.data.rect?this.fromTextAreaToTextOnPath(t):void 0},convertToText:function(t){return!this.getItemIsTextArea(t)&&!this.canChangeItemTextPathMode(t)||this.getItemIsTextArea(t)&&!this.canChangeItemTextAreaMode(t)||t instanceof this.paper.TextItem?null:t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0?this.fromTextOnPathToText(t):t&&t.data&&t.data.isTextArea&&t.data.rect?this.fromTextAreaToText(t):void 0},convertToTextArea:function(t){return!this.canChangeItemTextAreaMode(t)||t.data&&t.data.isTextArea?null:t&&t instanceof this.paper.TextItem?this.fromTextToTextArea(t):t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0?this.fromTextOnPathToTextArea(t):void 0},fromTextToTextOnPath:function(t){if(!this.canChangeItemTextPathMode(t))return null;var e=null;if(this.beginDesignOperation(),t&&t instanceof this.paper.TextItem){var i=this.findDesignItemForItem(t),n=null,r=null;i&&(n=i.get("constraints"),r=i.get("syncGuid")),t.remove(),this.onItemRemoved(t);var a=null;t.shadowColor&&(a="string"==typeof t.shadowColor||t.shadowColor instanceof String?t.shadowColor:t.shadowColor.toCSS(!0));var s={};s.text=t.content,s.strokeColor=t.strokeColor,s.strokeWidth=t.strokeWidth,s.fillColor=t.fillColor,s.fontFamily=t.fontFamily,s.fontWeight=t.fontWeight,s.fontSize=t.fontSize,s.scaling=t.scaling,s.rotation=t.rotation,s.shadowColor=a,s.shadowBlur=t.shadowBlur,s.shadowDistance=this.getOffsetDistance(t.shadowOffset),s.shadowAngle=this.getOffsetAngle(t.shadowOffset),t.data&&(t.data.hasOwnProperty("originalStrokeColor")&&(s.strokeColor=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(s.fillColor=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(s.shadowColor=t.data.originalShadowColor));var o=(e=this.addTextOnPathElement(t.position,s,!0)).position.clone();if(e.position.y=t.bounds.top+e.bounds.height/2,o.x=0-o.x+e.position.x,o.y=0-o.y+e.position.y,this.onTextOnPathMoved(e,o),this.updateTextOnPathGuide(e),n){var l=this.findDesignItemForItem(e);l&&l.setConstraintsFromSource(n)}this.onItemUpdated(e),this.fireSelectionChangedEvent(),this.updateSelectionState(),this.paper.project.view.update(),this.updateItemSyncGuid(e,r)}return this.endDesignOperation(),this.mergeAllUndoItemsOperations(e),this.joinUndoChains(t,e),e},fromTextToTextArea:function(t){if(!this.canChangeItemTextAreaMode(t))return null;var e=null;if(this.beginDesignOperation(),t&&t instanceof this.paper.TextItem){var i=this.findDesignItemForItem(t),n=null,r=null;i&&(n=i.get("constraints"),r=i.get("syncGuid"));var a=t.bounds.clone();a.bottom=a.bottom,a.bottom+=5*a.height,t.remove(),this.onItemRemoved(t);var s=null;t.shadowColor&&(s="string"==typeof t.shadowColor||t.shadowColor instanceof String?t.shadowColor:t.shadowColor.toCSS(!0));var o={};if(o.text=t.content,o.strokeWidth=t.strokeWidth,o.strokeColor="string"==typeof t.strokeColor||t.strokeColor instanceof String?t.strokeColor:t.strokeColor.toCSS(!0),o.fillColor="string"==typeof t.fillColor||t.fillColor instanceof String?t.fillColor:t.fillColor.toCSS(!0),o.fontFamily=t.fontFamily,o.fontWeight=t.fontWeight,o.fontSize=t.fontSize,o.scaling=t.scaling,o.rotation=t.rotation,o.justification=t.data&&t.data.justification?t.data.justification:void 0!==t.justification?t.justification:"justify",o.shadowColor=s,o.shadowBlur=t.shadowBlur,o.shadowDistance=this.getOffsetDistance(t.shadowOffset),o.shadowAngle=this.getOffsetAngle(t.shadowOffset),o.lineSpacing=t.lineSpacing,o.letterSpacing=t.letterSpacing,t.data&&(t.data.hasOwnProperty("originalStrokeColor")&&(o.strokeColor=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(o.fillColor=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(o.shadowColor=t.data.originalShadowColor)),a.left=t.bounds.left,a.right=t.bounds.right,a.top=t.bounds.top,(e=this.addTextAreaElement(a,o,!0)).position.y=a.top+e.bounds.height/2,e.position.x=a.left+t.bounds.width/2,e.data.rect=e.bounds.clone(),this.updateTextAreaGuide(e),n){var l=this.findDesignItemForItem(e);l&&l.setConstraintsFromSource(n)}this.onItemUpdated(e),this.fireSelectionChangedEvent(),this.updateSelectionState(),this.paper.project.view.update(),this.updateItemSyncGuid(e,r)}return this.endDesignOperation(),this.mergeAllUndoItemsOperations(e),this.joinUndoChains(t,e),e},fromTextOnPathToText:function(t){if(!this.canChangeItemTextPathMode(t))return null;var e=null;if(this.beginDesignOperation(),t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0){var i=this.findDesignItemForItem(t),n=null,r=null;i&&(n=i.get("constraints"),r=i.get("syncGuid")),t.remove(),this.onItemRemoved(t);var a=t.data.text;if(!a)for(var s=0;s<t.children.length;s++)a+=t.children[s].content;var o=null,l=t.children[0].shadowColor;l&&(o="string"==typeof l||l instanceof String?l:l.toCSS(!0));var h={};h.text=a,h.strokeColor=t.children[0].strokeColor,h.strokeWidth=t.children[0].strokeWidth,h.fillColor=t.children[0].fillColor,h.fontFamily=t.children[0].fontFamily,h.fontWeight=t.children[0].fontWeight,h.fontStretch=t.children[0].fontStretch,h.fontSize=t.children[0].fontSize,h.scaling=t.children[0].scaling,h.shadowColor=o,h.shadowBlur=t.children[0].shadowBlur,h.shadowDistance=this.getOffsetDistance(t.children[0].shadowOffset),h.shadowAngle=this.getOffsetAngle(t.children[0].shadowOffset),t.data&&(t.data.hasOwnProperty("originalStrokeColor")&&(h.strokeColor=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(h.fillColor=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(h.shadowColor=t.data.originalShadowColor));var c=t.data.points[0],u=(t.data.points[1],t.data.points[2].subtract(c)),d=c.add(u.divide(2));if(h.rotation=u.angle,e=this.addTextElement(d,h,!0),n){var f=this.findDesignItemForItem(e);f&&(f.setConstraintsFromSource(n),this.updateSelectionState(),this.paper.project.view.update())}this.updateItemSyncGuid(e,r)}return this.endDesignOperation(),this.mergeAllUndoItemsOperations(e),this.joinUndoChains(t,e),e},fromTextOnPathToTextArea:function(t){if(!this.canChangeItemTextAreaMode(t)||!this.canChangeItemTextPathMode(t))return null;var e=null;if(this.beginDesignOperation(),t&&t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0){var i=this.findDesignItemForItem(t),n=null,r=null;i&&(n=i.get("constraints"),r=i.get("syncGuid"));var a=t.bounds.clone();a.bottom=a.bottom,a.bottom+=5*a.height,t.remove(),this.onItemRemoved(t);var s=t.data.text;if(!s)for(var o=0;o<t.children.length;o++)s+=t.children[o].content;var l=null,h=t.children[0].shadowColor;h&&(l="string"==typeof h||h instanceof String?h:h.toCSS(!0));var c={};c.text=s,c.strokeColor=t.children[0].strokeColor,c.strokeWidth=t.children[0].strokeWidth,c.fillColor=t.children[0].fillColor,c.fontFamily=t.children[0].fontFamily,c.fontWeight=t.children[0].fontWeight,c.fontStretch=t.children[0].fontStretch,c.fontSize=t.children[0].fontSize,c.scaling=t.children[0].scaling,c.justification=t.data&&t.data.justification?t.data.justification:"justify",c.shadowColor=l,c.shadowBlur=t.children[0].shadowBlur,c.shadowDistance=this.getOffsetDistance(t.children[0].shadowOffset),c.shadowAngle=this.getOffsetAngle(t.children[0].shadowOffset);var u=null,d=null,f=!1,g=null;if(t.data&&(t.data.hasOwnProperty("originalStrokeColor")&&(c.strokeColor=t.data.originalStrokeColor,u=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(c.fillColor=t.data.originalFillColor,d=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(f=!0,c.shadowColor=t.data.originalShadowColor,g=t.data.originalShadowColor)),a.left=t.bounds.left,a.right=t.bounds.right,a.top=t.bounds.top,e=this.addTextAreaElement(a,c,!0),u&&(e.data.originalStrokeColor=u),d&&(e.data.originalFillColor=d),f&&(e.data.originalShadowColor=g),e.position.y=a.top+e.bounds.height/2,e.position.x=a.left+t.bounds.width/2,e.data.rect=e.bounds.clone(),e.data.isTemplateElement=t.data&&t.data.isTemplateElement,this.updateTextAreaGuide(e),n){var p=this.findDesignItemForItem(e);p&&p.setConstraintsFromSource(n)}this.onItemUpdated(e),this.fireSelectionChangedEvent(),this.updateSelectionState(),this.paper.project.view.update(),this.updateItemSyncGuid(e,r)}return this.endDesignOperation(),this.mergeAllUndoItemsOperations(e),this.joinUndoChains(t,e),e},fromTextAreaToText:function(t){if(!this.canChangeItemTextAreaMode(t))return null;var e=null;if(this.beginDesignOperation(),t&&t.data&&t.data.isTextArea&&t.data.rect){var i=this.findDesignItemForItem(t),n=null,r=null;i&&(n=i.get("constraints"),r=i.get("syncGuid")),t.remove(),this.onItemRemoved(t);var a=t.data.text;if(!a)for(var s=0;s<t.children.length;s++)s>0&&(a+=" "),a+=t.children[s].content;var o=null,l=t.children[0].shadowColor;l&&(o="string"==typeof l||l instanceof String?l:l.toCSS(!0));var h={};h.text=a,h.strokeColor=t.children[0].strokeColor,h.strokeWidth=t.children[0].strokeWidth,h.fillColor=t.children[0].fillColor,h.fontFamily=t.children[0].fontFamily,h.fontWeight=t.children[0].fontWeight,h.fontStretch=t.children[0].fontStretch,h.fontSize=t.children[0].fontSize,h.scaling=t.children[0].scaling,h.shadowColor=o,h.shadowBlur=t.children[0].shadowBlur,h.shadowDistance=this.getOffsetDistance(t.children[0].shadowOffset),h.shadowAngle=this.getOffsetAngle(t.children[0].shadowOffset);var c=null,u=null,d=!1,f=null;t.data&&(t.data.hasOwnProperty("originalStrokeColor")&&(h.strokeColor=t.data.originalStrokeColor,c=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(h.fillColor=t.data.originalFillColor,u=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(d=!0,h.shadowColor=t.data.originalShadowColor,f=t.data.originalShadowColor));var g=t.children[0].point;if(e=this.addTextElement(g,h,!0),c&&(e.data.strokeColor=c),u&&(e.data.fillColor=u),d&&(e.data.originalShadowColor=f),n){var p=this.findDesignItemForItem(e);p&&(p.setConstraintsFromSource(n),this.updateSelectionState(),this.paper.project.view.update())}this.updateItemSyncGuid(e,r)}return this.endDesignOperation(),this.mergeAllUndoItemsOperations(e),this.joinUndoChains(t,e),e},fromTextAreaToTextOnPath:function(t){if(!this.canChangeItemTextPathMode(t)||!this.canChangeItemTextAreaMode(t))return null;var e=null;if(this.beginDesignOperation(),t&&t.data&&t.data.isTextArea&&t.data.rect){var i=this.findDesignItemForItem(t),n=null,r=null;i&&(n=i.get("constraints"),r=i.get("syncGuid")),t.remove(),this.onItemRemoved(t);var a=t.data.text;if(!a)for(var s=0;s<t.children.length;s++)s>0&&(a+=" "),a+=t.children[s].content;var o=null,l=t.children[0].shadowColor;l&&(o="string"==typeof l||l instanceof String?l:l.toCSS(!0));var h={};h.text=a,h.strokeColor=t.children[0].strokeColor.toCSS(!0),h.strokeWidth=t.children[0].strokeWidth,h.fillColor=t.children[0].fillColor.toCSS(!0),h.fontFamily=t.children[0].fontFamily,h.fontWeight=t.children[0].fontWeight,h.fontStretch=t.children[0].fontStretch,h.fontSize=t.children[0].fontSize,h.scaling=t.children[0].scaling,h.shadowColor=o,h.shadowBlur=t.children[0].shadowBlur,h.shadowDistance=this.getOffsetDistance(t.children[0].shadowOffset),h.shadowAngle=this.getOffsetAngle(t.children[0].shadowOffset);var c=null,u=null,d=!1,f=null;t.data&&(t.data.hasOwnProperty("originalStrokeColor")&&(h.strokeColor=t.data.originalStrokeColor,c=t.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(h.fillColor=t.data.originalFillColor,u=t.data.originalFillColor),t.data.hasOwnProperty("originalShadowColor")&&(d=!0,h.shadowColor=t.data.originalShadowColor,f=t.data.originalShadowColor));var g=this.getItemRealBounds(t),p=new this.paper.Point(g.x+g.width/2,t.children[0].point.y);e=this.addTextOnPathElement(p,h,!0),c&&(e.data.originalStrokeColor=c),u&&(e.data.originalFillColor=u),d&&(e.data.originalShadowColor=f),t.data&&t.data.justification&&(e.data.justification=t.data.justification);var m=e.position.clone();if(e.position.y=t.bounds.top+e.bounds.height/2,m.x=0-m.x+e.position.x,m.y=0-m.y+e.position.y,this.onTextOnPathMoved(e,m),this.updateTextOnPathGuide(e),n){var v=this.findDesignItemForItem(e);v&&v.setConstraintsFromSource(n)}this.onItemUpdated(e),this.fireSelectionChangedEvent(),this.updateSelectionState(),this.paper.project.view.update(),this.updateItemSyncGuid(e,r)}return this.endDesignOperation(),this.mergeAllUndoItemsOperations(e),this.joinUndoChains(t,e),e},removeSideBackColor:function(){if(this.side&&this.design){var t=this.design.getDesignSide(this.side);t&&this.design.get("sides").remove(t);var e=this;this.updateImageItem(function(){e.isViewer||e.updateAreaItemsColor(),e.updateSelectionState()})}},setSideBackColor:function(t){if(this.side&&this.design){var e=this.design.getDesignSide(this.side);e||((e=new MPlaza.DesignSide).set("modelID",this.design.get("modelID")),e.set("colorID",this.side.getColorID()),e.set("sideID",this.side.getSideID()),this.design.get("sides").add(e)),e.set("fillColor",t);var i=this;this.updateImageItem(function(){i.isViewer||i.updateAreaItemsColor(),i.updateSelectionState()})}},adjustInputFontWeightByConstraints:function(t,e,i){var n=e||t;if(i&&(!i.get("canChangeFontWeight")||!i.get("canChangeFontItalic"))){if("number"==typeof t)return t;n=n+="";var r=t&&-1!=t.indexOf("bold"),a=t&&-1!=t.indexOf("italic"),s=i.get("canChangeFontWeight")?-1!=n.indexOf("bold"):r,o=i.get("canChangeFontItalic")?-1!=n.indexOf("italic"):a,l=[];l.push(o?"italic":"normal"),l.push(s?"bold":"normal"),n=l.join(" ")}return n},adjustInputTextByConstraints:function(t,e){var i=e;if(t&&null!=e&&null!=e){var n=this.getItemConstraints(t);if(n&&n.get("canEdit")&&(n.get("keepNrChars")||n.get("minNrChars")>0||n.get("maxNrChars")>0)){var r="";if(t.data&&t.data.isTextOnPath&&t.data.points&&"[object Array]"===Object.prototype.toString.call(t.data.points)&&3==t.data.points.length&&t.children.length>0){if(!(r=t.data.text))for(var a=0;a<t.children.length;a++)r+=t.children[a].content}else t instanceof this.paper.TextItem?r=t.content:t.data&&t.data.isTextArt&&(r=this.getTextArtItemText(t));var s=r.length,o=n.get("minNrChars"),l=n.get("maxNrChars");if(n.get("keepNrChars")&&(o=s,l=s),o>0&&e.length<o){var h=n.get("paddingString");n.get("paddingTypeID")==MPlaza.PaddingType.Start?i=e.padStart(o,h):n.get("paddingTypeID")==MPlaza.PaddingType.End?i=e.padEnd(o,h):n.get("paddingTypeID")==MPlaza.PaddingType.StartEnd&&(i=e.padStartEnd(o,h))}l>0&&i.length>l&&(i=i.substring(0,l)),0==i.trim().length&&0==n.get("canDelete")&&(i=this.isConfigurator?"":r.substring(0,1))}}return this.isConfigurator&&""==i.trim()&&(i=""),i},adjustInputLetterSpacingByConstraints:function(t,e){var i=e;if(t){var n=null!=t.data.letterSpacing?t.data.letterSpacing:0;null==i&&(i=n);var r=this.getItemConstraints(t);r&&(r.get("canEdit")&&r.get("canChangeLetterSpacing")&&"number"==typeof e?(null!=r.get("minLetterSpacing")&&null!=r.get("minLetterSpacing")&&(i=Math.max(i,r.get("minLetterSpacing"))),null!=r.get("maxLetterSpacing")&&null!=r.get("maxLetterSpacing")&&(i=Math.min(i,r.get("maxLetterSpacing")))):i=n)}return i},adjustInputLineSpacingByConstraints:function(t,e){var i=e;if(t){var n=null!=t.data.lineSpacing?t.data.lineSpacing:0;null==i&&(i=n);var r=this.getItemConstraints(t);r&&(r.get("canEdit")&&r.get("canChangeLineSpacing")&&"number"==typeof e?(null!=r.get("minLineSpacing")&&null!=r.get("minLineSpacing")&&(i=Math.max(i,r.get("minLineSpacing"))),null!=r.get("maxLineSpacing")&&null!=r.get("maxLineSpacing")&&(i=Math.min(i,r.get("maxLineSpacing")))):i=n)}return i},highlightsCanvasItemFromDesignItems:function(t){var e=this;t.forEach(function(t){var i=e.findItemByGuid(t.get("itemGuid"));i&&e.createMaskAlertForItem(i)})},setInvalidItemsForProfanityCheck:function(t){this.preventAreasAndIndexUpdate=!0;var e=this;t.forEach(function(t){var i=e.getPaperItemFromDesignItem(t);i&&(i.data.isProfanityCheckInvalid=!0,e.onItemUpdated(i),i.remove())}),this.preventAreasAndIndexUpdate=!1},replaceProfanityTextFromItem:function(t,e){this.preventAreasAndIndexUpdate=!0;var i=this.paper.importJSON(t.get("json"));if(i){var n="",r=null;if(this.getItemIsTextArea(i)||this.getItemIsTextOnPath(i)?(r=this.getTextItemInfo(i),n=r.text):this.getItemIsTextArt(i)&&(r=this.getTextArtItemInfo(i),n=r.text),e.profanityList){var a=0;e.profanityList.forEach(function(t){(n=n.replace(t,t.replace(/./g,"x")))!==i.data.text&&a++}),0===a&&(n=n.replace(/./g,"x"))}this.getItemIsTextArea(i)||this.getItemIsTextOnPath(i)?this.modifyTextElementsContent(i,n):this.getItemIsTextArt(i),this.onItemUpdated(i)}this.preventAreasAndIndexUpdate=!1},undoRedoSupported:function(){return 0==this.getAllGridItems().length},beginDesignOperation:function(){this.undoRedoSupported()&&(this.currentDesignOperation&&this.currentDesignOperation.itemOperations.length>0&&this.undoStack.push(this.currentDesignOperation),this.currentDesignOperation={operationId:MPlaza.generateUUID(),itemOperations:[]})},endDesignOperation:function(){this.undoRedoSupported()&&this.currentDesignOperation&&this.currentDesignOperation.itemOperations.length>0&&(this.undoStack.push(this.currentDesignOperation),this.resetRedo(),this.currentDesignOperation=null)},registerItemOperation:function(t,e,i,n){if(this.undoRedoSupported()&&!this.executingUndoRedo){if(i&&n){var r=!1;i.get("colors").length!=n.get("colors").length&&(r=!0),n.get("colors").each(function(t,e){var n=i.get("colors").find(function(e){return e.get("colorID")==t.get("colorID")});n?n.get("colorCode")!=t.get("colorCode")&&(r=!0):r=!0});var a=i.get("index")!=n.get("index");if(i.get("json")==n.get("json")&&!r&&!a)return}var s={itemGuid:e,type:t,oldDesignItem:i,newDesignItem:n},o=!1;this.currentDesignOperation||(this.beginDesignOperation(),o=!0),this.updateDesignOperation(this.currentDesignOperation,s),o&&this.endDesignOperation()}},updateDesignOperation:function(t,e){for(var i=null,n=-1,r=0;r<t.itemOperations.length;r++){var a=t.itemOperations[r];if(a.itemGuid==e.itemGuid){n=r,i=a;break}}if(i&&n>=0){var s=this.mergeItemOperations(i,e);t.itemOperations[n]=s||e}else t.itemOperations.push(e)},mergeItemOperations:function(t,e){var i=null;return"create"===t.type?"update"===e.type&&(i={type:"create",itemGuid:t.itemGuid,oldDesignItem:null,newDesignItem:e.newDesignItem}):"update"===t.type&&"update"===e.type&&(i={type:"update",itemGuid:t.itemGuid,oldDesignItem:t.oldDesignItem,newDesignItem:e.newDesignItem}),i},undo:function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:if(this.executiongUndoRedo)return[2];if(!(this.undoStack.count()>0))return[3,7];this.executingUndoRedo=!0,n.label=1;case 1:n.trys.push([1,,6,7]),t=this.undoStack.pop(),e=0,n.label=2;case 2:return e<t.itemOperations.length?(i=t.itemOperations[e],[4,this.undoItemOperation(i)]):[3,5];case 3:n.sent(),n.label=4;case 4:return e++,[3,2];case 5:return this.redoStack.push(t),[3,7];case 6:return this.executingUndoRedo=!1,[7];case 7:return[2]}})})},redo:function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:if(this.executiongUndoRedo)return[2];if(!(this.redoStack.count()>0))return[3,7];this.executingUndoRedo=!0,n.label=1;case 1:n.trys.push([1,,6,7]),t=this.redoStack.pop(),e=0,n.label=2;case 2:return e<t.itemOperations.length?(i=t.itemOperations[e],[4,this.redoItemOperation(i)]):[3,5];case 3:n.sent(),n.label=4;case 4:return e++,[3,2];case 5:return this.undoStack.push(t),[3,7];case 6:return this.executingUndoRedo=!1,[7];case 7:return[2]}})})},undoItemOperation:function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r;return __generator(this,function(a){switch(a.label){case 0:return this.getSelectedItems().map(function(t){return t.data.guid}),e=null,"create"!=t.type?[3,1]:((i=this.findItemByGuid(t.itemGuid))&&(i.remove(),this._onItemRemovedInternal(i)),[3,6]);case 1:return"update"!==t.type?[3,4]:(n=this.findDesignItemByGuid(t.itemGuid))?(n.resetColors(),n.copyAttributes(t.oldDesignItem),[4,this.createItemForDesignItem(n)]):[3,3];case 2:e=a.sent(),a.label=3;case 3:return[3,6];case 4:return"delete"!==t.type?[3,6]:(r=t.oldDesignItem.clone(),this.design.get("designItems").add(r),[4,this.createItemForDesignItem(r)]);case 5:e=a.sent(),a.label=6;case 6:return this.updateItemsIndexes(),e&&this.isItemSelected(e)&&this.selectItems([e]),this.paper.project.view.update(),[2]}})})},redoItemOperation:function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r;return __generator(this,function(a){switch(a.label){case 0:return e=null,"create"!=t.type?[3,2]:(i=t.newDesignItem.clone(),this.design.get("designItems").add(i),[4,this.createItemForDesignItem(i)]);case 1:return e=a.sent(),[3,6];case 2:return"update"!==t.type?[3,5]:(n=this.findDesignItemByGuid(t.itemGuid))?(n.resetColors(),n.copyAttributes(t.newDesignItem),[4,this.createItemForDesignItem(n)]):[3,4];case 3:e=a.sent(),a.label=4;case 4:return[3,6];case 5:"delete"===t.type&&(r=this.findItemByGuid(t.itemGuid))&&(r.remove(),this._onItemRemovedInternal(r)),a.label=6;case 6:return this.updateItemsIndexes(),e&&this.isItemSelected(e)&&this.selectItems([e]),this.paper.project.view.update(),[2]}})})},hasUndo:function(){return this.undoRedoSupported()&&this.undoStack.count()>0},hasRedo:function(){return this.undoRedoSupported()&&this.redoStack.count()>0},resetUndoRedo:function(){this.detachUndoRedoEvents(),this.undoStack.clear(),this.redoStack.clear(),this.attachUndoRedoEvents(),this.fireUndoChangedEvent(),this.fireRedoChangedEvent()},resetUndo:function(){this.detachUndoRedoEvents(),this.undoStack.clear(),this.attachUndoRedoEvents(),this.fireUndoChangedEvent()},resetRedo:function(){this.detachUndoRedoEvents(),this.redoStack.clear(),this.attachUndoRedoEvents(),this.fireRedoChangedEvent()},removeLastUndoItemOperation:function(){if(this.undoStack.count()>0)return this.undoStack.pop()},removeFirstRedoItemOperation:function(){if(this.redoStack.count()>0)return this.redoStack.pop()},setupUndoRedoStacks:function(){this.attachUndoRedoEvents()},attachUndoRedoEvents:function(){this.undoStack.addChangedEventListener(this.bindedUndoStackChanged),this.redoStack.addChangedEventListener(this.bindedRedoStackChanged)},detachUndoRedoEvents:function(){this.undoStack.removeChangedEventListener(this.bindedUndoStackChanged),this.redoStack.removeChangedEventListener(this.bindedRedoStackChanged)},onUndoStackChanged:function(){this.fireUndoChangedEvent()},onRedoStackChanged:function(){this.fireRedoChangedEvent()},getUndoCount:function(){return this.undoStack.count()},getRedoCount:function(){return this.redoStack.count()},clearUndoForItem:function(t){this.clearOperationsStackForItem(this.undoStack,t)},clearRedoForItem:function(t){this.clearOperationsStackForItem(this.redoStack,t)},clearOperationsStackForItem:function(t,e){if(t&&e){for(var i=t.getAllData(),n=[],r=0;r<i.length;r++){for(var a=i[r],s=0;s<a.itemOperations.length;s++){a.itemOperations[s].itemGuid===e.data.guid&&a.itemOperations.splice(s--,1)}0==a.itemOperations.length&&n.push(a)}n.length>0&&t.removeDataArray(n)}},mergeAllUndoItemsOperations:function(t){if(t){for(var e=function(t,e){for(var i=0;i<t.itemOperations.length;i++)if(t.itemOperations[i].itemGuid==e.data.guid)return t.itemOperations[i];return null},i=function(t,e){for(var i=0;i<t.itemOperations.length;i++)t.itemOperations[i].itemGuid===e.data.guid&&t.itemOperations.splice(i--,1)},n=this.undoStack.getAllData(),r=[],a=null,s=null,o=n.length-1;o>=0;o--){var l=n[o],h=e(l,t);h&&(a&&s&&(this.updateDesignOperation(l,s),i(a,t),0==a.itemOperations.length&&r.push(a)),a=l,s=h)}r.length>0&&this.undoStack.removeDataArray(r)}},joinUndoChains:function(t,e){for(var i=function(t,e){for(var i=0;i<t.itemOperations.length;i++)if(t.itemOperations[i].itemGuid===e.data.guid)return!0;return!1},n=this.undoStack.getAllData(),r=null,a=null,s=0;s<n.length;s++){var o=n[s];i(o,t)&&(r=o),i(o,e)&&!a&&(a=o)}if(r&&a&&r!==a){var l=function(t,e){for(var i=0;i<t.itemOperations.length;i++)if(t.itemOperations[i].itemGuid==e.data.guid)return t.itemOperations[i];return null}(a,e);this.updateDesignOperation(r,l),function(t,e){for(var i=0;i<t.itemOperations.length;i++)t.itemOperations[i].itemGuid===e.data.guid&&t.itemOperations.splice(i--,1)}(a,e),0==a.itemOperations.length&&this.undoStack.removeData(a)}},getLastUndoOperationId:function(){var t=this.undoStack.getLastData();return t?t.operationId:null},mergeAllUndoOperationsAfterId:function(t){var e=null;if(t){var i=this.undoStack.getLastData(function(e){return e.operationId===t});e=this.undoStack.getAllDataAfter(i)}else e=this.undoStack.getAllData();e&&this.mergeUndoDesignOperations(e)},mergeUndoDesignOperations:function(t){var e=[];if(t.length>1)for(var i=t[0],n=1;n<t.length;n++){for(var r=t[n],a=0;a<r.itemOperations.length;a++){var s=r.itemOperations[a];this.updateDesignOperation(i,s),r.itemOperations.splice(a--,1)}e.push(r)}e.length>0&&this.undoStack.removeDataArray(e)},getUsedColorsWithCount:function(){var t=new Map;if(this.ignoreUsedColorsOnColorCheck)return t;for(var e=this.usedColorsItemsToCheck||this.getAllItems(),i=0;i<e.length;i++){var n,r=e[i],a=this.findDesignItemForItem(r);if(a&&a.get("colorMappings")&&a.get("colorMappings").length>0)a.get("colorMappings").toJSON().filter(function(t){return Boolean(t.dest)}).reduce(function(t,e){return t.add(e.dest)},new Set).forEach(function(e){return t.set(e,t.has(e)?t.get(e)+1:1)});if(this.getItemIsTextElement(r))(n=this.getTextItemInfo(r)).strokeColor&&n.strokeWidth>0&&t.set(n.strokeColor,t.has(n.strokeColor)?t.get(n.strokeColor)+1:1),n.fillColor&&t.set(n.fillColor,t.has(n.fillColor)?t.get(n.fillColor)+1:1),n.shadowColor&&t.set(n.shadowColor,t.has(n.shadowColor)?t.get(n.shadowColor)+1:1);if(this.getItemIsTextArt(r))(n=this.getTextArtItemInfo(r)).style.strokeColor&&n.style.strokeWidth>0&&t.set(n.style.strokeColor,t.has(n.style.strokeColor)?t.get(n.style.strokeColor)+1:1),n.style.fillColor&&t.set(n.style.fillColor,t.has(n.style.fillColor)?t.get(n.style.fillColor)+1:1),n.style.shadowColor&&t.set(n.style.shadowColor,t.has(n.style.shadowColor)?t.get(n.style.shadowColor)+1:1);if(this.isShape(r)||this.isMaskedImage(r)){var s=this.getShapeItemStyle(r);s&&(s.strokeColor&&s.strokeWidth>0&&t.set(s.strokeColor,t.has(s.strokeColor)?t.get(s.strokeColor)+1:1),s.fillColor&&t.set(s.fillColor,t.has(s.fillColor)?t.get(s.fillColor)+1:1))}if(r.data.isGroupForBackground){var o=r.children.find(function(t){return t.data.isAreaForBackground});if(o){if(o.strokeColor&&o.strokeWidth>0){var l=o.strokeColor instanceof paper.Color?o.strokeColor.toCSS(!0):o.strokeColor;t.set(l,t.has(l)?t.get(l)+1:1)}if(o.fillColor){l=o.fillColor instanceof paper.Color?o.fillColor.toCSS(!0):o.fillColor;t.set(l,t.has(l)?t.get(l)+1:1)}}}a&&a.get("colors").length>0&&(!a.get("colorMappings")||0==a.get("colorMappings").length)&&a.get("colors").forEach(function(e){var i=e.get("colorCode");t.set(i,t.has(i)?t.get(i)+1:1)})}return t},getUsedColors:function(){return Array.from(this.getUsedColorsWithCount().keys())},_getPrintTypeColorLimits:function(t,e){void 0===e&&(e=null);var i={maxColors:void 0,palette:[]};if(!this.side||!this.design)return i;var n=null;if(e)n=this.design.getSelectedPrintTypeForArea(e.get("areas").at(0));else{var r=this.findDesignItemForItem(t),a=null;if(r&&r instanceof MPlaza.DesignItem&&r.get("areas").length>0){var s=r.get("areas").at(0);a=this.side.findAreaByID(s.get("areaID"))}else a=this.side.get("areas").getMaxArea();n=this.design.getSelectedPrintTypeForArea(a)}var o=this.getModelPrintType(n);if(!o)return i;var l=o.get("paletteColors"),h=void 0;return null!=o.get("maxColors")&&null!=o.get("maxColors")&&o.get("maxColors")>0&&(h=o.get("maxColors")),l&&l.length>0&&(h=h?Math.min(h,l.length):l.length),h?(i.maxColors=h,i.palette=l||[],i):i},getSelectableColors:function(t,e){if(void 0===e&&(e=null),this.side&&this.design){var i=this._getPrintTypeColorLimits(t,e);if(void 0!==i.maxColors&&null!==i.maxColor){var n=i.maxColors,r=i.palette,a=this.getUsedColors();return a.length<n?r.length>0?r:void 0:a}}},getImageDefaultColorMappings:function(t,e,i,n){return void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var r,a,s,o,l,h,c;return __generator(this,function(u){switch(u.label){case 0:return this.side&&this.design?(r=this._getPrintTypeColorLimits(e,n),a=r.maxColors,s=r.palette,null==a||null==a?[2,[]]:(o=this.getUsedColors(),i?[3,2]:[4,Zakeke.Customizer.ImageProcessor.getImagePalette(t,10)])):[2,[]];case 1:i=u.sent(),u.label=2;case 2:for(l=[],h=function(){var t=i[c],e=t;o.find(function(e){return e===t})||(o.length<a?(s.length>0&&(e=Zakeke.Customizer.ImageProcessor.remapColor(t,s)),o.find(function(t){return t===e})||o.push(e)):e=Zakeke.Customizer.ImageProcessor.remapColor(t,o)),l.push({src:t,dest:e})},c=0;c<i.length;c++)h();return[2,l]}})})},_getColorMappingSourcePalette:function(t){return t.map(function(t){return t.src}).join(",")},_getColorMappingDestPalette:function(t){return t.map(function(t){return t.dest}).join(",")},createDesignEffectForRecoloring:function(t){var e=new MPlaza.DesignEffect;e.set("blendMode","normal"),e.set("opacity",1),e.set("imageEffectTypeName","reduce colors");var i=new MPlaza.ImageEffectParameterValue;return i.set("name","palette"),i.set("value",this._getColorMappingSourcePalette(t)),e.get("imageEffectParameterValues").add(i),(i=new MPlaza.ImageEffectParameterValue).set("name","replacementPalette"),i.set("value",this._getColorMappingDestPalette(t)),e.get("imageEffectParameterValues").add(i),e},recolorImage:function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return i=this.createDesignEffectForRecoloring(e),[4,this.applyDesignEffectToImageUrl(i,t)];case 1:return[2,n.sent()]}})})},changeColorMapping:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h;return __generator(this,function(c){switch(c.label){case 0:i=this.getLastUndoOperationId(),this.beginDesignOperation(),n=this.getAllItems(),this.usedColorsItemsToCheck=[],r=0,c.label=1;case 1:return r<n.length?(a=n[r],this.getItemIsTextArt(a)&&((s=this.getTextArtItemInfo(a)).style.strokeColor==t&&(s.style.strokeColor=e),s.style.fillColor==t&&(s.style.fillColor=e),s.style.shadowColor==t&&(s.style.shadowColor=e),this.changeTextArtStyle(a,s.style),this.onItemUpdated(a)),this.getItemIsTextOnPath(a)&&((s=this.getTextItemInfo(a)).strokeColor==t&&(s.strokeColor=e),s.fillColor==t&&(s.fillColor=e),s.shadowColor==t&&(s.shadowColor=e),this.modifyTextOnPathInfo(a,{strokeColor:s.strokeColor,fillColor:s.fillColor,shadowColor:s.shadowColor}),this.onItemUpdated(a)),this.getItemIsTextArea(a)&&((s=this.getTextItemInfo(a)).strokeColor==t&&(s.strokeColor=e),s.fillColor==t&&(s.fillColor=e),s.shadowColor==t&&(s.shadowColor=e),this.modifyTextAreaInfo(a,{strokeColor:s.strokeColor,fillColor:s.fillColor,shadowColor:s.shadowColor}),this.onItemUpdated(a)),a instanceof this.paper.Raster||this.isMaskedImage(a)?[4,this.changeImageItemColorMapping(a,null,t,e)]:[3,3]):[3,5];case 2:c.sent(),c.label=3;case 3:(this.isShape(a)||this.isMaskedImage(a))&&(o=this.isShape(a)?a:this.getMaskedImageShapeItem(a),(l=this.getShapeItemStyle(o)).strokeColor==t&&(l.strokeColor=e),l.fillColor==t&&(l.fillColor=e),this.changeShapeStyle(a,l),this.onItemUpdated(a)),a.data.isGroupForBackground&&(h=a.children.find(function(t){return t.data.isAreaForBackground}))&&((h.strokeColor instanceof paper.Color?h.strokeColor.toCSS(!0):h.strokeColor)==t&&(h.strokeColor=e),(h.fillColor instanceof paper.Color?h.fillColor.toCSS(!0):h.fillColor)==t&&(h.fillColor=e),this.onItemUpdated(h)),this.usedColorsItemsToCheck.push(a),c.label=4;case 4:return r++,[3,1];case 5:return this.usedColorsItemsToCheck=null,this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(i),[2]}})})},changeImageItemColorMapping:function(t,e,i,n){var r,a;return __awaiter(this,void 0,void 0,function(){var s,o,l,h,c,u,d,f,g,p,m,v,_,y,x;return __generator(this,function(b){switch(b.label){case 0:return t?(s=this.getImageItemInfo(t),o=this.findDesignItemByGuid(t.data.guid),l=this.getMaskedImageRasterItem(t),h=!1,s&&o&&l?(this.beginDesignOperation(),c=s.url,u=this.getDesignEffectForDesignItem(o),c,[4,this.applyDesignEffectToImageUrl(u,c)]):[3,4]):[3,4];case 1:for(c=b.sent(),d=null!==(a=null===(r=o.get("colorMappings"))||void 0===r?void 0:r.toJSON())&&void 0!==a?a:[],f=0,g=d;f<g.length;f++)p=g[f],m=e&&p.src==e&&p.dest!=n,v=i&&p.dest==i,(m||v)&&(p.dest=n,h=!0);return h?(_=this.createDesignEffectForRecoloring(d),[4,this.applyDesignEffectToImageUrl(_,c)]):[2,t];case 2:return c=b.sent(),[4,this.changeRasterItem(l,c)];case 3:b.sent(),this.applyDesignEffectToItem(u,t),this.updateDesignItemColorMappings(o,d),this.endDesignOperation(),y=this.createDummyImageFromDesignItem(o),x=this.createDummyShapeFromDesignItem(o),this.onImageItemUpdated(t,y,x),this.updateSelectionState(),this.paper.project.view.update(),b.label=4;case 4:return[2,t]}})})},forceColorInFixedPalette:function(t,e,i,n){if(void 0===n&&(n=null),!e)return e;i||(i=e),e instanceof this.paper.Color&&(e=e.toCSS(!0)),i instanceof this.paper.Color&&(i=e.toCSS(!0));var r=e,a=this.getSelectableColors(t,n),s=this.getUsedColorsWithCount(),o=!a||s.has(i)&&s.get(i)<=1&&-1!==a.indexOf(i);return a&&a.length>0&&!o&&(a.find(function(t){return t===e})||(r=Zakeke.Customizer.ImageProcessor.remapColor(e,a))),r},resetRecoloring:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o;return __generator(this,function(l){switch(l.label){case 0:i=this.getLastUndoOperationId(),this.beginDesignOperation(),this.usedColorsItemsToCheck=[],n=0,l.label=1;case 1:return n<t.length?(r=t[n],this.getItemIsTextArt(r)&&((a=this.getTextArtItemInfo(r)).style.strokeColor&&(a.style.strokeColor=this.forceColorInFixedPalette(r,a.style.strokeColor,null,e)),a.style.fillColor&&(a.style.fillColor=this.forceColorInFixedPalette(r,a.style.fillColor,null,e)),a.style.shadowColor&&(a.style.shadowColor=this.forceColorInFixedPalette(r,a.style.shadowColor,null,e)),this.changeTextArtStyle(r,a.style)),this.getItemIsTextOnPath(r)&&((a=this.getTextItemInfo(r)).strokeColor&&(a.strokeColor=this.forceColorInFixedPalette(r,a.strokeColor,null,e)),a.fillColor&&(a.fillColor=this.forceColorInFixedPalette(r,a.fillColor,null,e)),a.shadowColor&&(a.shadowColor=this.forceColorInFixedPalette(r,a.shadowColor,null,e)),this.modifyTextOnPathInfo(r,{strokeColor:a.strokeColor,fillColor:a.fillColor,shadowColor:a.shadowColor})),this.getItemIsTextArea(r)&&((a=this.getTextItemInfo(r)).strokeColor&&(a.strokeColor=this.forceColorInFixedPalette(r,a.strokeColor,null,e)),a.fillColor&&(a.fillColor=this.forceColorInFixedPalette(r,a.fillColor,null,e)),a.shadowColor&&(a.shadowColor=this.forceColorInFixedPalette(r,a.shadowColor,null,e)),this.modifyTextAreaInfo(r,{strokeColor:a.strokeColor,fillColor:a.fillColor,shadowColor:a.shadowColor})),r instanceof this.paper.Raster||this.isMaskedImage(r)?[4,this.resetImageColorMapping(r,e,null)]:[3,3]):[3,5];case 2:l.sent(),l.label=3;case 3:(this.isShape(r)||this.isMaskedImage(r))&&(s=this.isShape(r)?r:this.getMaskedImageShapeItem(r),(o=this.getShapeItemStyle(s)).strokeColor&&(o.strokeColor=this.forceColorInFixedPalette(r,o.strokeColor,null,e)),o.fillColor&&(o.fillColor=this.forceColorInFixedPalette(r,o.fillColor,null,e)),this.changeShapeStyle(r,o)),this.onItemUpdated(r),this.usedColorsItemsToCheck.push(r),l.label=4;case 4:return n++,[3,1];case 5:return this.usedColorsItemsToCheck=null,this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(i),[2]}})})},resetImageColorMapping:function(t,e,i){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var n,r,a,s,o,l,h;return __generator(this,function(c){switch(c.label){case 0:return t?(n=this.getImageItemInfo(t),r=this.findDesignItemByGuid(t.data.guid),a=this.getMaskedImageRasterItem(t),n&&r&&a?(this.beginDesignOperation(),s=n.url,o=this.getDesignEffectForDesignItem(r),s,[4,this.applyDesignEffectToImageUrl(o,s)]):[3,7]):[3,7];case 1:return s=c.sent(),i?[3,3]:[4,this.getImageDefaultColorMappings(s,t,null,e)];case 2:i=c.sent(),c.label=3;case 3:return i&&i.length>0?[4,this.recolorImage(s,i)]:[3,5];case 4:s=c.sent(),c.label=5;case 5:return[4,this.changeRasterItem(a,s)];case 6:c.sent(),this.applyDesignEffectToItem(o,t),this.updateDesignItemColorMappings(r,i),this.endDesignOperation(),l=this.createDummyImageFromDesignItem(r),h=this.createDummyShapeFromDesignItem(r),this.onImageItemUpdated(t,l,h),this.updateSelectionState(),this.paper.project.view.update(),c.label=7;case 7:return[2,t]}})})},getDesignEffectForArea:function(t){var e=this.getModelPrintType(this.design.getSelectedPrintTypeForArea(t));if(e)return e.get("previewDesignEffect")},applyDesignEffectToImageUrl:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x;return __generator(this,function(b){switch(b.label){case 0:return i=e,t&&t instanceof MPlaza.DesignEffect&&t.get("imageEffectTypeName")?(n=this._getCachedImageEffectResult(e,t))?(i=n,[3,21]):[3,1]:[3,21];case 1:if(r=null,a=t.get("imageEffectParameterValues").getValue("overlay color"),s=void 0,a&&(s=this.hex2rgb(a)),o=t.get("imageEffectParameterValues").getValue("halftone"),l=Zakeke.Customizer.HalfoneType.None,o)switch(o.toLowerCase()){case"errordiffusion":l=Zakeke.Customizer.HalfoneType.ErrorDiffusion;break;case"dithering":l=Zakeke.Customizer.HalfoneType.Dithering;break;default:l=Zakeke.Customizer.HalfoneType.None}switch(h=t.get("imageEffectParameterValues").getValueNumber("threshold level"),c=null,null!=h&&!isNaN(h)&&h>=0&&h<=255&&(c=h),u=t.get("imageEffectParameterValues").getValueBoolean("invert"),d=t.get("imageEffectParameterValues").getValue("dark color"),f={red:0,green:0,blue:0},d&&(f=this.hex2rgb(d)),g=t.get("imageEffectParameterValues").getValue("light color"),p={red:255,green:255,blue:255},g&&(p=this.hex2rgb(g)),m=t.get("imageEffectParameterValues").getValueBoolean("remove white"),v=t.get("imageEffectTypeName").toLowerCase(),v){case"greyscale":return[3,2];case"contrasted greyscale":return[3,4];case"soft greyscale":return[3,6];case"hard greyscale":return[3,8];case"black and white":return[3,10];case"black and transparent":return[3,12];case"dark and light":return[3,14];case"silhouette":return[3,16];case"reduce colors":return[3,18]}return[3,20];case 2:return[4,Zakeke.Customizer.ImageProcessor.greyScale(e,l,u,s)];case 3:return r=b.sent(),[3,20];case 4:return[4,Zakeke.Customizer.ImageProcessor.greyScalePlus(e,l,u,s)];case 5:return r=b.sent(),[3,20];case 6:return[4,Zakeke.Customizer.ImageProcessor.desaturate(e,l,u,s)];case 7:return r=b.sent(),[3,20];case 8:return[4,Zakeke.Customizer.ImageProcessor.blackAndWhite(e,l,u,s)];case 9:return r=b.sent(),[3,20];case 10:return[4,Zakeke.Customizer.ImageProcessor.thresholding(e,c,u,s)];case 11:return r=b.sent(),[3,20];case 12:return[4,Zakeke.Customizer.ImageProcessor.thresholdingTransparentWhite(e,c,u,s)];case 13:return r=b.sent(),[3,20];case 14:return[4,Zakeke.Customizer.ImageProcessor.thresholdingDarkAndLight(e,c,u,f,p)];case 15:return r=b.sent(),[3,20];case 16:return[4,Zakeke.Customizer.ImageProcessor.overlapColor(e,s,m)];case 17:return r=b.sent(),[3,20];case 18:return _=t.get("imageEffectParameterValues").getValueNumber("colors"),y=t.get("imageEffectParameterValues").getValue("palette"),x=t.get("imageEffectParameterValues").getValue("replacementPalette"),[4,Zakeke.Customizer.ImageProcessor.reduce(e,_,y,x)];case 19:return r=b.sent(),[3,20];case 20:r&&(i=URL.createObjectURL(r)),this._cacheImageEffectResult(e,t,i),b.label=21;case 21:return[2,i]}})})},applyDesignEffectToTextColor:function(t,e){return e&&t&&t.get("textColor")?t.get("textColor"):e},applyDesignEffectToShapeColor:function(t,e){return e&&t&&t.get("textColor")?t.get("textColor"):e},applyDesignEffectToItem:function(t,e,i){void 0===i&&(i=!1);var n=-1!=navigator.userAgent.indexOf("Firefox");if(e){var r="normal",a=!1,s=1;if(t&&t instanceof MPlaza.DesignEffect){var o=t.get("blendMode")||"normal";r=this.supportedBlendModes.find(function(t){return t==o.toLowerCase()})||"normal",i&&n&&(r="normal"),a=t.get("enhanceBlendMode"),null!=(s=t.get("opacity"))&&null!=s||(s=1),s=Math.max(Math.min(1,s),0)}if(e.blendMode=r,e.enhanceBlendMode=a,e.opacity=s,this.isMaskedImage(e)){var l=this.getMaskedImageShapeItem(e),h=this.getMaskedImageRasterItem(e);this.applyDesignEffectToItem(t,l,i),this.applyDesignEffectToItem(t,h,i)}}},hex2rgb:function(t){var e=String(t).match(this.RGB_HEX)||[],i=e[1],n=e[2],r=[0,0,0];if(n){var a=Number.parseInt(n,16);r=[a>>16,a>>8&255,255&a]}else i&&(r=Array.from(i,function(t){return Number.parseInt(t,16)}).map(function(t){return t<<4|t}));return{red:r[0],green:r[1],blue:r[2]}},getOrCreateItemFromDesignItem:function(t){var e,i,n,r;return __awaiter(this,void 0,void 0,function(){var a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C,w,S,M,A,T,k,D,P,E,z=this;return __generator(this,function(O){switch(O.label){case 0:return a=null,s=t.get("itemGuid"),o=null,l="",h=function(t){return"[object Array]"===Object.prototype.toString.call(t)&&t.length>0&&4==t.length&&"Color"==t[0]?t.slice(1,4):t},t&&t instanceof MPlaza.DesignItem?(l=t.get("json"),o=this.getDesignEffectForDesignItem(t),c=JSON.parse(l),t.get("imageID")>0?"[object Array]"===Object.prototype.toString.call(c)&&2==c.length&&"Raster"==c[0]&&c[1].source?(v=c[1].source,c[1].data&&c[1].data.originalUrl&&(v=c[1].data.originalUrl),[4,this.applyDesignEffectToImageUrl(o,v)]):[3,4]:[3,10]):[3,11];case 1:return _=O.sent(),(y=null!==(i=null===(e=t.get("colorMappings"))||void 0===e?void 0:e.toJSON())&&void 0!==i?i:[])&&y.length>0?[4,this.recolorImage(_,y)]:[3,3];case 2:_=O.sent(),O.label=3;case 3:return c[1].source=_,l=JSON.stringify(c),[3,9];case 4:return"[object Array]"===Object.prototype.toString.call(c)&&2==c.length&&"Group"==c[0]&&c[1].data&&c[1].data.isMaskedImageMainGroup?((u=c[1].children.filter(function(t){return"[object Array]"===Object.prototype.toString.call(t)&&2==t.length&&"CompoundPath"==t[0]}))&&(d=u[0],(C=d[1].strokeColor)&&(C=new this.paper.Color(C).toCSS(!0)),d[1].data&&d[1].data.originalStrokeColor&&(C=d[1].data.originalStrokeColor),A=this.applyDesignEffectToTextColor(o,C),d[1].data&&(d[1].data.originalStrokeColor=new this.paper.Color(C).toCSS(!0)),x=void 0,A&&(x=new this.paper.Color(A).components),d[1].strokeColor=x),(f=c[1].children.filter(function(t){return"[object Array]"===Object.prototype.toString.call(t)&&2==t.length&&"Group"==t[0]}))?(g=f[0],p=g[1].children.filter(function(t){return"[object Array]"===Object.prototype.toString.call(t)&&2==t.length&&"Raster"==t[0]}),m=p[0],v=m[1].source,m[1].data&&m[1].data.originalUrl&&(v=m[1].data.originalUrl),[4,this.applyDesignEffectToImageUrl(o,v)]):[3,8]):[3,9];case 5:return _=O.sent(),(y=null!==(r=null===(n=t.get("colorMappings"))||void 0===n?void 0:n.toJSON())&&void 0!==r?r:[])&&y.length>0?[4,this.recolorImage(_,y)]:[3,7];case 6:_=O.sent(),O.label=7;case 7:m[1].source=_,O.label=8;case 8:l=JSON.stringify(c),O.label=9;case 9:return[3,11];case 10:"[object Array]"===Object.prototype.toString.call(c)&&2==c.length&&"CompoundPath"==c[0]?(C=c[1].strokeColor,w=c[1].fillColor,S=c[1].shadowColor,C&&(C=new this.paper.Color(C).toCSS(!0)),w&&(w=new this.paper.Color(w).toCSS(!0)),S&&(S=new this.paper.Color(S).toCSS(!0)),c[1].data&&(c[1].data.originalStrokeColor&&(C=c[1].data.originalStrokeColor),c[1].data.originalFillColor&&(w=c[1].data.originalFillColor),c[1].data.originalShadowColor&&(S=c[1].data.originalShadowColor)),A=this.applyDesignEffectToTextColor(o,C),T=this.applyDesignEffectToTextColor(o,w),k=this.applyDesignEffectToTextColor(o,S),c[1].data&&(c[1].data.originalStrokeColor=new this.paper.Color(C).toCSS(!0),c[1].data.originalFillColor=new this.paper.Color(w).toCSS(!0),c[1].data.originalShadowColor=new this.paper.Color(S).toCSS(!0)),x=void 0,b=void 0,I=void 0,A&&(x=new this.paper.Color(A).components),T&&(b=new this.paper.Color(T).components),k&&(I=new this.paper.Color(k).components),c[1].strokeColor=x,c[1].fillColor=b,c[1].shadowColor=I,l=JSON.stringify(c)):"[object Array]"===Object.prototype.toString.call(c)&&2==c.length&&"Group"==c[0]&&c[1].data&&(c[1].data.isTextArea||c[1].data.isTextOnPath)&&(C=null,c[1].data&&c[1].data.hasOwnProperty("originalStrokeColor")?C=c[1].data.originalStrokeColor:c[1].data&&c[1].data.textInfo&&c[1].data.textInfo.hasOwnProperty("strokeColor")?C=new this.paper.Color(h(c[1].data.textInfo.strokeColor)).toCSS(!0):c[1].children&&"[object Array]"===Object.prototype.toString.call(c[1].children)&&c[1].children.length>0&&(M=c[1].children[0])&&"[object Array]"===Object.prototype.toString.call(M)&&2==M.length&&"PointText"==M[0]&&M[1].strokeColor&&(C=new this.paper.Color(M[1].strokeColor).toCSS(!0)),w=null,c[1].data&&c[1].data.hasOwnProperty("originalFillColor")?w=c[1].data.originalFillColor:c[1].data&&c[1].data.textInfo&&c[1].data.textInfo.hasOwnProperty("fillColor")?w=new this.paper.Color(h(c[1].data.textInfo.fillColor)).toCSS(!0):c[1].children&&"[object Array]"===Object.prototype.toString.call(c[1].children)&&c[1].children.length>0&&(M=c[1].children[0])&&"[object Array]"===Object.prototype.toString.call(M)&&2==M.length&&"PointText"==M[0]&&M[1].fillColor&&(w=new this.paper.Color(M[1].fillColor).toCSS(!0)),S=null,c[1].data&&c[1].data.hasOwnProperty("originalShadowColor")?S=c[1].data.originalShadowColor:c[1].data&&c[1].data.textInfo&&c[1].data.textInfo.hasOwnProperty("shadowColor")?S=new this.paper.Color(h(c[1].data.textInfo.shadowColor)).toCSS(!0):c[1].children&&"[object Array]"===Object.prototype.toString.call(c[1].children)&&c[1].children.length>0&&(M=c[1].children[0])&&"[object Array]"===Object.prototype.toString.call(M)&&2==M.length&&"PointText"==M[0]&&M[1].shadowColor&&(S=new this.paper.Color(M[1].shadowColor).toCSS(!0)),A=this.applyDesignEffectToTextColor(o,C),T=this.applyDesignEffectToTextColor(o,w),k=this.applyDesignEffectToTextColor(o,S),c[1].data&&(c[1].data.originalStrokeColor=new this.paper.Color(C).toCSS(!0),c[1].data.originalFillColor=new this.paper.Color(w).toCSS(!0),S&&(c[1].data.originalShadowColor=new this.paper.Color(S).toCSS(!0))),D=void 0,P=void 0,E=void 0,A&&(D=new this.paper.Color(A).components),T&&(P=new this.paper.Color(T).components),k&&(E=new this.paper.Color(k).components),this.isViewer&&(E=null),c[1].data.textInfo&&(c[1].data.textInfo.strokeColor=D,c[1].data.textInfo.fillColor=P,c[1].data.textInfo.shadowColor=E),c[1].children&&"[object Array]"===Object.prototype.toString.call(c[1].children)&&c[1].children.length>0&&c[1].children.forEach(function(t){"[object Array]"===Object.prototype.toString.call(t)&&2==t.length&&"PointText"==t[0]&&(t[1].strokeColor=D,t[1].fillColor=P,t[1].shadowColor=E)}),l=JSON.stringify(c)),O.label=11;case 11:return[4,new Promise(function(t){var e=z.findItemByGuid(s);!e&&l&&((e=z.paper.project.activeLayer.importJSON(l)).data.guid=s);var i=null;if(e){if(e instanceof z.paper.Raster&&(i=e),z.isMaskedImage(e)||z.isFilledShape(e)){i=z.getMaskedImageRasterItem(e);var n=z.getMaskedImageShapeItem(e);n.strokeColor||(n.strokeWidth=0)}z.isShape(e)&&z.isImagePlaceholder(e)&&z.updateShapeImagePlaceholder(e),i?i.onLoad=function(){t(e)}:t(e)}else t(e)})];case 12:return a=O.sent(),this.applyDesignEffectToItem(o,a),[2,a]}})})},getDesignEffectForDesignItem:function(t){var e=null;if(this.side&&t&&t instanceof MPlaza.DesignItem&&t.get("areas").length>0){var i=t.get("areas").at(0),n=this.side.findAreaByID(i.get("areaID"));e=this.getDesignEffectForArea(n)}return e},createRasterItem:function(t,e){var i=this;return void 0===e&&(e=!0),new Promise(function(n){var r=new i.paper.Raster({crossOrigin:"anonymous",source:t,visibile:e});r.onLoad=function(){r.onLoad=void 0,n(r)}})},changeRasterItem:function(t,e){return new Promise(function(i){t.crossOrigin="anonymous",t.source=e,t.onLoad=function(){t.onLoad=void 0,i()}})},convertColorToHex:function(t){var e=void 0;return t&&t instanceof this.paper.Color&&(e=t.toCSS(!0)),e},_getImageEffectCacheKey:function(t,e){var i="image_effect_"+t,n=JSON.stringify(e.toJSON());return i+="_"+CryptoJS.SHA1(n).toString()},_emptyImageEffectCache:function(){window.imageEffectCache={}},_getCachedImageEffectResult:function(t,e){var i=this._getImageEffectCacheKey(t,e);return window.imageEffectCache.hasOwnProperty(i)?window.imageEffectCache[i]:null},_cacheImageEffectResult:function(t,e,i){if(t&&e&&i){var n=this._getImageEffectCacheKey(t,e);window.imageEffectCache[n]=i}},isMaskedImage:function(t){return t&&t instanceof this.paper.Group&&t.data&&t.data.isMaskedImageMainGroup},isMaskedImageRasterItem:function(t){return this.isImage(t)&&this.isMaskedImageClipGroup(t.parent)},isImage:function(t){return t&&t instanceof this.paper.Raster},isMaskedImageClipGroup:function(t){return t&&t instanceof this.paper.Group&&t.data&&t.data.isMaskedImageClipGroup},isMaskedImageGuideRaster:function(t){return t&&t instanceof this.paper.Raster&&t.data&&t.data.isMaskedImageGuideRaster},isMaskedImageSelected:function(){var t=this;return this.getSelectedItems().some(function(e){return t.isMaskedImage(e)})},isMaskedImageShapeItem:function(t){return t&&t.data&&t.data.isMaskedImageShape},isMaskedImageMaskItem:function(t){return t&&t.data&&t.data.isMaskedImageMask},applyMaskToImageItemAsync:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r,a;return __generator(this,function(s){switch(s.label){case 0:return this.canEditItem(t)?this.isImage(t)&&!this.canMaskImages()?[2,t]:this.isImage(t)&&!this.canAddMask(t)?[2,t]:this.isMaskedImage(t)&&!this.canReplaceMask(t)?[2,t]:!this.isMaskedImage(t)||e||this.canDeleteMask(t)?(n=this.getLastUndoOperationId(),this.beginDesignOperation(),r=t,e?[3,1]:(r=this.removeMaskFromImage(t),[3,3])):[2,t]:[2,t];case 1:return[4,this._loadShapePathDataAsync(e)];case 2:a=s.sent(),t&&(this.isMaskedImage(t)?r=this.updateMaskedImage(t,e,a,i):t instanceof this.paper.Raster&&(r=this.createMaskedImage(t,e,a,i))),s.label=3;case 3:return this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n),[2,r]}})})},getMaskedImageRasterItem:function(t){var e=this;if(t&&t instanceof this.paper.Raster)return t;if(t&&t instanceof this.paper.Group&&t.data.isMaskedImageMainGroup){var i=t.children.find(function(t){return t instanceof e.paper.Group});if(i)return i.children.find(function(t){return t instanceof e.paper.Raster})}return t&&t instanceof this.paper.Group&&t.data.isMaskedImageClipGroup?t.children.find(function(t){return t instanceof e.paper.Raster}):null},getMaskedImageShapeItem:function(t){return t&&t instanceof this.paper.Group&&t.data.isMaskedImageMainGroup?t.children.find(function(t){return t.data&&t.data.isMaskedImageShape}):null},getMaskedImageMaskItem:function(t){var e=this;if(t&&t instanceof this.paper.Group&&t.data.isMaskedImageMainGroup){var i=t.children.find(function(t){return t instanceof e.paper.Group});if(i)return i.children.find(function(t){return t&&t.data&&t.data.isMaskedImageMask})}return t&&t instanceof this.paper.Group&&t.data.isMaskedImageClipGroup?t.children.find(function(t){return t&&t.data&&t.data.isMaskedImageMask}):null},getMaskedImageClipGroupItem:function(t){var e=this;return t&&t instanceof this.paper.Group&&t.data.isMaskedImageMainGroup?t.children.find(function(t){return t instanceof e.paper.Group}):t&&t instanceof this.paper.Group&&t.data.isMaskedImageClipGroup?t:null},getMaskedImageGuideRasterItem:function(t){return t&&t instanceof this.paper.Group&&t.data.isMaskedImageMainGroup?t.children.find(function(t){return t.data&&t.data.isMaskedImageGuideRaster}):null},getMaskedImageFromGuideRasterItem:function(t){if(t&&t instanceof this.paper.Raster&&t.data.isMaskedImageGuideRaster){var e=t.parent;if(e&&e instanceof this.paper.Group&&e.data&&e.data.isMaskedImageMainGroup)return e}return null},getMaskedImageGuideShapeItem:function(t){return t&&t instanceof this.paper.Group&&t.data.isMaskedImageMainGroup?t.children.find(function(t){return t.data&&t.data.isMaskedImageGuideShape}):null},getMaskedImageFromGuideShapeItem:function(t){if(t&&t instanceof this.paper.CompoundPath&&t.data.isMaskedImageGuideShapeItem){var e=t.parent;if(e&&e instanceof this.paper.Group&&e.data&&e.data.isMaskedImageMainGroup)return e}return null},getMaskedImageMaskPathStyle:function(t){var e=void 0;if(t){var i=this.getMaskedImageShapeItem(t);i&&(e={strokeColor:i.strokeColor?i.strokeColor.toCSS(!0):void 0,strokeWidth:i.strokeWidth,strokeCap:i.strokeCap,strokeJoin:i.strokeJoin,dashArray:i.dashArray,dashOffset:i.dashOffset},i.data.hasOwnProperty("originalStrokeColor")&&(e.strokeColor=i.data.originalStrokeColor))}return e},createMaskedImage:function(t,e,i,n){if(!this.canMaskImages()||!this.canAddMask(t))return t;if(t&&t instanceof this.paper.Raster&&i){var r=this.findDesignItemForItem(t);if(r){var a=this.getDesignEffectForDesignItem(r),s=this.isItemSelected(t),o=t.parent,l=t.bounds.width,h=t.bounds.height;delete t.data.selected;var c=this.boundPath(i,l,h),u=new this.paper.CompoundPath(c);u.position=t.position,u.data.isMaskedImageMask=!0;var d=u.clone();d.data.originalBounds=d.bounds,d.data.originalMatrix=new this.paper.Matrix,d.data.originalParentMatrix=new this.paper.Matrix,d.data.isMaskedImageShape=!0;var f=n.strokeColor;f=this.forceColorInFixedPalette(t,f),n.strokeColor=this.applyDesignEffectToTextColor(a,f),this.applyStyleToMaskShape(d,n),d.data.originalStrokeColor=f;var g=new this.paper.Group(u);g.clipped=!0,g.data.isMaskedImageClipGroup=!0;var p=new this.paper.Group(g,d);p.applyMatrix=!1,p.data.guid=t.data.guid,delete t.data.guid,p.data.isMaskedImageMainGroup=!0,p.data.originalBounds=d.bounds,p.data.originalMatrix=new this.paper.Matrix,t.data.maskPath&&t.data.maskPath.remove(),this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t),t.data.hasOwnProperty("isGridImage")&&(p.data.isGridImage=t.data.isGridImage,delete t.data.isGridImage),t.data.hasOwnProperty("gridBoxID")&&(p.data.gridBoxID=t.data.gridBoxID,delete t.data.gridBoxID),this.applyDesignEffectToItem(a,p,!0),o.addChild(p),p.insertAbove(t),g.addChild(t);var m=this.createDummyImageFromDesignItem(r);return this.onImageItemUpdated(p,m,e),t.data.selected=!1,p.data.selected=s,this.updateSelectionState(),p}}return t},updateMaskedImage:function(t,e,i,n){if(!this.canReplaceMask(t))return t;if(t&&this.isMaskedImage(t)){var r=this.findDesignItemForItem(t);if(r){var a=this.getDesignEffectForDesignItem(r),s=this.getMaskedImageShapeItem(t),o=this.getMaskedImageMaskItem(t),l=this.getMaskedImageRasterItem(t);if(s&&o&&l){delete l.data.selected;var h=n,c=this.getMaskedImageMaskPathStyle(t);this.canChangeMaskStrokeColor(t)&&h.strokeColor||(h.strokeColor=c.strokeColor),this.canChangeMaskStrokeWidth(t)&&h.strokeWidth||(h.strokeWidth=c.strokeWidth);var u=h.strokeColor;u=this.forceColorInFixedPalette(t,u),h.strokeColor=this.applyDesignEffectToTextColor(a,u);var d=s.bounds;if(s.data.originalBounds&&s.data.originalMatrix){d=s.data.originalBounds;var f=new this.paper.Path.Rectangle(0,0,d.width,d.height);f.visible=!1,f.matrix=s.data.originalMatrix.clone();var g=this.getRectangleItemSize(f);f.remove(),d=new this.paper.Rectangle(0,0,g.width,g.height)}else{var p=new this.paper.Path.Rectangle(0,0,l.width,l.height);p.remove(),p.scale(l.scaling),d=p.bounds}var m=l.position,v=s.data.originalParentMatrix?s.data.originalParentMatrix:s.matrix,_=d.width,y=d.height,x=this.boundPath(i,_,y),b=new this.paper.CompoundPath(x),I=b.clone();this.applyStyleToItem(I,h),o.removeChildren(),o.copyContent(b),s.removeChildren(),s.copyContent(I),s.data.originalStrokeColor=u,b.remove(),I.remove(),s.matrix=v.clone(),s.position=m.clone(),o.matrix=v.clone(),o.position=m.clone();var C=this.createDummyImageFromDesignItem(r);this.onImageItemUpdated(t,C,e),this.updateSelectionState()}}}},updateMakedImageMaskStyle:function(t,e){if(t&&this.isMaskedImage(t)){var i=this.findDesignItemForItem(t);if(i){var n=this.getDesignEffectForDesignItem(i),r=this.getMaskedImageShapeItem(t);if(r){this.beginDesignOperation();var a=this.getMaskedImageMaskPathStyle(t),s=a.strokeColor;this.canChangeMaskStrokeColor(t)&&null!=e.strokeColor&&(s=e.strokeColor),e.strokeColor=s;var o=a.strokeWidth;this.canChangeMaskStrokeWidth(t)&&null!=e.strokeWidth&&null!=e.strokeWidth&&(o=e.strokeWidth),e.strokeWidth=o,r.data.originalStrokeColor=null!=e.strokeWidth?e.strokeColor:void 0,r.data.originalStrokeColor=this.forceColorInFixedPalette(t,r.data.originalStrokeColor),e.strokeColor=this.applyDesignEffectToTextColor(n,r.data.originalStrokeColor),this.applyStyleToItem(r,e);var l=this.createDummyImageFromDesignItem(i),h=this.createDummyShapeFromDesignItem(i);this.onImageItemUpdated(t,l,h),this.endDesignOperation()}}}},removeMaskFromImage:function(t){var e=t;if(t&&this.isMaskedImage(t)&&!this.isFilledShape(t)){var i=this.isItemSelected(t),n=t.parent,r=this.findDesignItemForItem(t),a=this.getMaskedImageRasterItem(t);if(r&&a){var s=t.matrix;(e=a).data.guid=t.data.guid,n.insertChild(t.index,e),t.remove(),e.matrix.prepend(s),e.data.originalMatrix&&e.data.originalMatrix.prepend(s);var o=this.createDummyImageFromDesignItem(r);this.onImageItemUpdated(e,o,null),t.data.selected=!1,e.data.selected=i,this.updateSelectionState()}}return e},boundPath:function(t,e,i){var n=Raphael.pathBBox(t),r=e/n.width,a=i/n.height,s=Math.min(r,a);0===s&&(s=1);var o="s"+s+","+s+",0,0",l=Raphael.transformPath(t,"t"+-n.x+","+(i/s-n.y));return(l=Raphael.transformPath(l,o)).toString()},applyStyleToMaskShape:function(t,e){t&&t instanceof this.paper.Item&&(null!=e.strokeColor&&(t.strokeColor=e.strokeColor),null!=e.strokeWidth&&(t.strokeWidth=e.strokeWidth),e.strokeCap&&(t.strokeCap=e.strokeCap),e.strokeJoin&&(t.strokeJoin=e.strokeJoin),null!=e.dashOffset&&(t.dashOffset=e.dashOffset),e.dashArray&&(t.dashArray=e.dashArray))},getReferenceItemForSelectedItem:function(t){if(this.isMaskedImage(t)){var e=t;return this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster?e=this.getMaskedImageGuideRasterItem(t):this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask&&(e=this.getMaskedImageGuideShapeItem(t)),e}return t},getItemBounds:function(t){var e=t.bounds;if(this.isMaskedImage(t)){var i=this.getMaskedImageShapeItem(t);if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster){var n=this.getMaskedImageGuideRasterItem(t);n&&(i=n)}else if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask){var r=this.getMaskedImageGuideShapeItem(t);r&&(i=r)}if(i)if(t.applyMatrix)e=i.bounds;else{var a=i.clone();a.remove(),a.matrix=a.matrix.prepend(t.matrix),e=a.strokeBounds}}return e},getImageWidth:function(t){if(this.isMaskedImage(t)){var e=this.getMaskedImageShapeItem(t);if(e){if(!t.applyMatrix){var i=e.clone();return i.remove(),i.matrix=i.matrix.prepend(t.matrix),i.bounds.width}return e.bounds.width}}else if(this.isImage(t))return t.width;return 0},getImageHeight:function(t){if(this.isMaskedImage(t)){var e=this.getMaskedImageShape(t);if(e){if(!t.applyMatrix){var i=e.clone();return i.remove(),i.matrix=i.matrix.prepend(t.matrix),i.bounds.height}return e.bounds.height}}else if(this.isImage(t))return t.height;return 0},_loadShapePathDataAsync:function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return t&&t instanceof MPlaza.Shape&&(e=t.get("pathDataUrl"))?[4,this._loadFileAsync(e,!1)]:[3,2];case 1:return[2,i.sent()];case 2:return[2]}})})},_loadFileAsync:function(t,e){return void 0===e&&(e=!0),new Promise(function(i,n){FileTools.LoadFile(t,function(t){i(t)},void 0,void 0,e,function(t,e){n(e)})})},_loadRandomShapeAsync:function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=Math.floor(3e3*Math.random())+1,[4,this._loadShapeByIdAsync(t)];case 1:return[2,e.sent()]}})})},_loadShapeByIdAsync:function(t){return new Promise(function(e,i){new MPlaza.Shape({shapeID:t}).fetch({success:function(t,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e(t),[2]})})},error:function(t,e,n){Logger.info("Error while loading shape"),i()},data:{}})})},createMaskedImageGuideRaster:function(t){if(this.isMaskedImage(t)){var e=this.getMaskedImageGuideRasterItem(t);if(e)return e;var i=this.getMaskedImageRasterItem(t);return i&&(e=i.clone(),i.data.originalBounds&&(e.data.originalBounds=i.data.originalBounds.clone()),i.data.originalMatrix&&(e.data.originalMatrix=i.data.originalMatrix.clone()),e.parent=t,e.sendToBack(),e.opacity=.3,e.data.isMaskedImageGuideRaster=!0),e}},createMaskedImageGuideShape:function(t){if(this.isMaskedImage(t)){var e=this.getMaskedImageGuideShapeItem(t);if(e)return e;var i=this.getMaskedImageShapeItem(t);if(i){(e=i.clone()).blendMode="normal",e.opacity=1,i.data.originalBounds&&(e.data.originalBounds=i.data.originalBounds.clone()),i.data.originalMatrix&&(e.data.originalMatrix=i.data.originalMatrix.clone()),e.parent=t,e.bringToFront();var n="red";n=i.strokeWidth>0&&i.strokeColor?MPlaza.getContrastYIQ(255*i.strokeColor.red,255*i.strokeColor.green,255*i.strokeColor.blue):this.getContrastedColor(i.bounds),e.strokeColor=n,e.strokeWidth=2,e.dashArray=[4,10],e.data.isMaskedImageGuideShape=!0}return e}},removeMaskedImageGuideRaster:function(t){var e=this.getMaskedImageGuideRasterItem(t);e&&e.remove()},removeMaskedImageGuideShape:function(t){var e=this.getMaskedImageGuideShapeItem(t);e&&e.remove()},updateMaskedImageGuides:function(t){for(var e=this.getAllImageItems(),i=0;i<e.length;i++){t=e[i];this.isItemSelected(t)?this.isMaskedImage(t)&&(this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element?(this.createMaskedImageGuideRaster(t),this.createMaskedImageGuideShape(t)):(this.removeMaskedImageGuideRaster(t),this.removeMaskedImageGuideShape(t))):(this.removeMaskedImageGuideRaster(t),this.removeMaskedImageGuideShape(t))}},getSubItemsToChange:function(t){var e=[];if(t)if(this.isMaskedImage(t)&&this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element){if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Raster){var i=this.getMaskedImageGuideRasterItem(t);i&&e.push(i);var n=this.getMaskedImageRasterItem(t);n&&e.push(n)}else if(this.maskedImageSelectionMode==MaskedImageSelectionMode.Mask){var r=this.getMaskedImageGuideShapeItem(t);r&&e.push(r);var a=this.getMaskedImageShapeItem(t);a&&e.push(a);var s=this.getMaskedImageMaskItem(t);s&&e.push(s)}}else e.push(t);return e},switchMaskedImageSelectionMode:function(t){this.hitTest(t.point),this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element?this.setMaskedImageSelectionMode(MaskedImageSelectionMode.Element):this.hitItem==this.selectionMaskMoveShape?this.setMaskedImageSelectionMode(MaskedImageSelectionMode.Mask):this.hitItem==this.selectionMaskMoveImage&&this.setMaskedImageSelectionMode(MaskedImageSelectionMode.Raster)},setMaskedImageSelectionMode:function(t){var e=this.getSelectedMaskedImageItems();if(e.length>0){var i=e[0],n=!0;this.canEditItem(i)?(t!==MaskedImageSelectionMode.Mask||this.canEditMask(i)||(n=!1),t!==MaskedImageSelectionMode.Raster||this.canEditMaskedImage(i)||(n=!1)):n=!1,n?(this.applyTransformationsToMaskImageSubItems(),this.maskedImageSelectionMode=t,this.updateSelectionState()):this.maskedImageSelectionMode=MaskedImageSelectionMode.Element}else this.maskedImageSelectionMode=MaskedImageSelectionMode.Element},applyTransformationsToMaskImageSubItems:function(){for(var t=this,e=this.getSelectedImageItems().filter(function(e){return t.isMaskedImage(e)}),i=0;i<e.length;i++){var n=e[i];if(!n.applyMatrix){var r=n.matrix.clone();n.matrix=new this.paper.Matrix;var a=[];a.push(this.getMaskedImageShapeItem(n)),a.push(this.getMaskedImageMaskItem(n)),a.push(this.getMaskedImageRasterItem(n)),a.forEach(function(t){t.matrix.prepend(r),t.data.originalMatrix&&t.data.originalMatrix.prepend(r),t.data.originalPosition&&(t.data.originalPosition=t.data.originalPosition.transform(r)),t.data.originalParentMatrix&&t.data.originalParentMatrix.prepend(r)})}}},insertRandomShape:function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return e=t||{isImagePlaceholder:!0,style:{strokeColor:"black",strokeWidth:2,fillColor:"darkred"}},[4,this._loadRandomShapeAsync()];case 1:return i=n.sent(),[4,this.insertShape(i,e)];case 2:return[2,n.sent()]}})})},insertShape:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,a,s,o,l,h,c,u,d,f,g,p,m,v;return __generator(this,function(_){switch(_.label){case 0:return i=null,e?this.canAddShape()?(this.beginDesignOperation(),[4,this._loadShapePathDataAsync(t)]):[2,i]:[2];case 1:return(n=_.sent())&&this.side&&(r=this.side.get("areas").getMaxArea())&&(a=this.getDesignEffectForArea(r),s=e.style.strokeColor,o=e.style.fillColor,s=this.forceColorInFixedPalette(null,s),o=this.forceColorInFixedPalette(null,o),e.style.strokeColor=this.applyDesignEffectToTextColor(a,s),e.style.fillColor=this.applyDesignEffectToTextColor(a,o),i=new this.paper.CompoundPath(n),this.applyStyleToItem(i,e.style),i.data={},i.data.isShape=!0,i.data.originalBounds=i.bounds,i.data.originalMatrix=new this.paper.Matrix,i.data.originalPosition=i.position,i.data.originalStrokeColor=s,i.data.originalFillColor=o,i.data.isImagePlaceholder=e.isImagePlaceholder,this.applyDesignEffectToItem(a,i),this.onShapeItemCreated(i,t,e),(l=this.findItemForArea(r))&&(h=l.position.subtract(i.position),i.position.x+=h.x,i.position.y+=h.y,c=(new this.paper.Matrix).translate(h.x,h.y),i.data.originalMatrix.prepend(c),i.data.originalPosition=i.data.originalPosition.transform(c),u=i.bounds,((d=l.bounds).intersects(u)||u.contains(d))&&((f=d.clone()).width*=.8,f.height*=.8,g=1,p=1,Math.abs(f.width)>1e-7&&(g=f.width/u.width),Math.abs(f.height)>1e-7&&(p=f.height/u.height),m=g>0?1:-1,v=p>0?1:-1,g=p=Math.min(Math.abs(g),Math.abs(p)),g*=m,p*=v,i.scale(g,p),c=(new this.paper.Matrix).scale(g,p),i.data.originalMatrix.prepend(c),i.data.originalPosition=i.data.originalPosition.transform(c),this.masterGroup.addChild(i),this.onItemUpdated(i),this.updateItemsIndexes(),this.onDesignItemChanged(i),this.fireShapeLoadedEvent(),this.mask&&this.mask.bringToFront()))),this.endDesignOperation(),[2,i]}})})},replaceSelectedShape:function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(r){switch(r.label){case 0:return e&&this.design?(i=this.getSelectedShapeItems())&&i.length>0?(n=i[0],this.canEditItem(n)?[4,this.replaceShape(n,t,e)]:[2]):[3,2]:[2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},replaceShapeByGuid:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return(n=this.findItemByGuid(t))?[4,this.replaceShape(n,e,i)]:[3,2];case 1:return[2,r.sent()];case 2:return[2,null]}})})},replaceShape:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I;return __generator(this,function(C){switch(C.label){case 0:return this.canEditItem(t)?(this.beginDesignOperation(),(n=this.isShape(t)?t:this.getMaskedImageShapeItem(t))?[4,this._loadShapePathDataAsync(e)]:[2,t]):[2,t];case 1:return(r=C.sent())&&(a=this.findDesignItemByGuid(t.data.guid))&&(s=this.getDesignEffectForDesignItem(a),o=this.getShapeItemStyle(n),l=o.strokeColor,this.canChangeShapeStrokeColor(t)&&null!=i.style.strokeColor&&(l=i.style.strokeColor),i.style.strokeColor=l,h=o.strokeWidth,this.canChangeShapeStrokeWidth(t)&&null!=i.style.strokeWidth&&null!=i.style.strokeWidth&&(h=i.style.strokeWidth),i.style.strokeWidth=h,c=o.fillColor,this.canChangeShapeFillColor(t)&&null!=i.style.fillColor&&(c=i.style.fillColor),i.style.fillColor=c,u=null!=i.style.strokeWidth?i.style.strokeColor:void 0,d=i.style.fillColor,u=this.forceColorInFixedPalette(t,u),d=this.forceColorInFixedPalette(t,d),i.style.strokeColor=this.applyDesignEffectToTextColor(s,u),i.style.fillColor=this.applyDesignEffectToTextColor(s,d),f=t.bounds.width,g=t.bounds.height,(p=new this.paper.CompoundPath(r)).visible=!1,this.applyStyleToItem(p,i.style),p.transform(t.data.originalMatrix),p.position=t.position,t.removeChildren(),t.copyContent(p),m=t.data,t.copyAttributes(p),t.data=m,t.visible=!0,t.data.originalStrokeColor=u,t.data.originalFillColor=d,t.data.isImagePlaceholder=i.isImagePlaceholder,p.remove(),v=t.bounds.width,_=t.bounds.height,y=1,x=1,v>0&&Math.abs(f)>1e-7&&(y=f/v),_>0&&Math.abs(g)>1e-7&&(x=g/_),t.scale(y,x),b=(new this.paper.Matrix).scale(y,x),t.data.originalMatrix.prepend(b),I=this.createDummyImageFromDesignItem(a),this.onShapeItemUpdated(t,e,I),this.updateSelectionState(),this.paper.project.view.update(),this.fireShapeLoadedEvent()),this.endDesignOperation(),[2]}})})},changeShapeStyle:function(t,e){if(this.canEditItem(t)&&(this.isShape(t)||this.isFilledShape(t))){var i=this.isShape(t)?t:this.getMaskedImageShapeItem(t);if(i){var n=this.getShapeItemStyle(i),r=n.strokeColor;this.canChangeShapeStrokeColor(t)&&null!=e.strokeColor&&(r=e.strokeColor),e.strokeColor=r;var a=n.strokeWidth;this.canChangeShapeStrokeWidth(t)&&null!=e.strokeWidth&&null!=e.strokeWidth&&(a=e.strokeWidth),e.strokeWidth=a;var s=n.fillColor;if(this.canChangeShapeFillColor(t)&&null!=e.fillColor&&(s=e.fillColor),e.fillColor=s,t&&t instanceof this.paper.Item){this.beginDesignOperation();var o=this.findDesignItemByGuid(t.data.guid),l=this.getDesignEffectForDesignItem(o),h=e.strokeColor,c=e.fillColor;h=this.forceColorInFixedPalette(t,h),c=this.forceColorInFixedPalette(t,c),e.strokeColor=this.applyDesignEffectToTextColor(l,h),e.fillColor=this.applyDesignEffectToTextColor(l,c),this.applyStyleToItem(t,e),i.data.originalStrokeColor=h,i.data.originalFillColor=c,this.onItemUpdated(t),this.endDesignOperation()}}}},updateShapeImagePlaceholders:function(t){var e=this;t.forEach(function(t){e.updateShapeImagePlaceholder(t)})},_removeShapesReferenceBounds:function(){this.shapesReferenceBounds&&this.shapesReferenceBounds.forEach(function(t){return t.remove()}),this.shapesReferenceBounds=[]},_updateShapesReferenceBounds:function(){this.removeShapesReferenceBounds();for(var t=this.getAllShapeItems(),e=0;e<t.length;e++){var i=t[e],n=null;if(this.isFilledShape(i)?n=this.getMaskedImageShapeItem(i):this.isShape(i)&&(n=i),n&&n.data&&n.data.originalBounds&&n.data.originalMatrix&&n.data.originalPosition){var r=new this.paper.Path.Rectangle(n.data.originalBounds);r.strokeColor="red",r.strokeWidth=3,r.matrix=n.data.originalMatrix,r.position=n.data.originalPosition.clone(),this.shapesReferenceBounds.push(r);var a=new this.paper.Path.Circle(n.data.originalPosition,5);a.fillColor="red",this.shapesReferenceBounds.push(a);var s=n.clone(),o=s.position.clone();s.rotate(-n.data.originalMatrix.rotation,o);var l=s.bounds;s.remove();var h=new this.paper.Path.Rectangle(l);h.strokeColor="blue",h.strokeWidth=3,h.rotate(n.data.originalMatrix.rotation,o),this.shapesReferenceBounds.push(h)}}},updateShapeImagePlaceholder:function(t){var e=this;if(this.removeShapeImagePlaceholder(t),t instanceof this.paper.CompoundPath&&t.data&&t.data.isShape&&t.data.isImagePlaceholder&&!t.data.isMaskedImageShape){var i=t.clone();delete i.data.guid,i.data.isShapePlaceholderPath=!0,i.guide=!0,i.data.shapeGuid=t.data.guid,i.opacity=1,i.blendMode="normal",i.strokeColor="none",i.strokeWidth=0,i.fillColor="#ededed",i.onMouseEnter=function(){return e.paper.project.view.element.style.setProperty("cursor","pointer")},i.onMouseLeave=function(){return e.paper.project.view.element.style.setProperty("cursor",null)};var n=i.interiorPoint,r=new this.paper.Path.Circle(n,this.shapeImagePlaceholderIconFillerSize);r.fillColor="#ededed",r.data.isShapePlaceholderIcon=!0,r.data.shapeGuid=t.data.guid,r.onMouseEnter=function(){return e.paper.project.view.element.style.setProperty("cursor","pointer")},r.onMouseLeave=function(){return e.paper.project.view.element.style.setProperty("cursor",null)},r.onMouseUp=function(){return e.fireFillShapeRequestedEvent({itemGuid:t.data.guid})};var a=new this.paper.CompoundPath(this.shapeImagePlaceholderIconPathd),s=i.bounds.width/a.bounds.width>6?2:1;a.data.isShapePlaceholderIcon=!0,a.data.shapeGuid=t.data.guid,a.fillColor="#222222";var o=this.paper.view.zoom>.25?this.paper.view.zoom:3*this.paper.view.zoom;a.scaling=new this.paper.Size(s/o,s/o),a.onMouseEnter=function(){return e.paper.project.view.element.style.setProperty("cursor","pointer")},a.onMouseLeave=function(){return e.paper.project.view.element.style.setProperty("cursor",null)},a.onMouseUp=function(){return e.fireFillShapeRequestedEvent({itemGuid:t.data.guid})},a.position=n,i.insertAbove(t),a.insertAbove(i),r.insertAbove(i)}},removeShapeImagePlaceholder:function(t){this.getShapeImagePlaceholderElements(t).forEach(function(t){return t.remove()})},getShapeImagePlaceholderElements:function(t){var e=[];if(t&&t.data&&t.data.guid)for(var i=function(n){if(n.data&&(n.data.isShapePlaceholderPath||n.data.isShapePlaceholderIcon)&&n.data.shapeGuid==t.data.guid&&e.push(n),n.children)for(var r=n.children.length-1;r>=0;r--){var a=n.children[r];i(a)}},n=0;n<this.paper.project.layers.length;n++){var r=this.paper.project.layers[n];r.guide||i(r)}return e},isShape:function(t){return t&&t.data&&t.data.isShape},getShapeItemStyle:function(t){var e=void 0;if(!t)return e;var i=this.isShape(t)?t:this.getMaskedImageShapeItem(t);return i&&(e={},t.strokeColor&&(e.strokeColor=i.strokeColor.toCSS(!0)),e.strokeWidth=i.strokeWidth,e.strokeCap=i.strokeCap,e.strokeJoin=i.strokeJoin,e.dashArray=i.dashArray,e.dashOffset=i.dashOffset,i.fillColor&&(e.fillColor=i.fillColor.toCSS(!0)),i.data.hasOwnProperty("originalStrokeColor")&&(e.strokeColor=i.data.originalStrokeColor),t.data.hasOwnProperty("originalFillColor")&&(e.fillColor=i.data.originalFillColor)),e},isFilledShape:function(t){return this.isMaskedImage(t)&&t.data&&t.data.isFilledShape},isImagePlaceholder:function(t){return this.isShape(t)&&!this.isFilledShape(t)&&t.data&&t.data.isImagePlaceholder},fillShapeItemWithImageAsync:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(a){switch(a.label){case 0:return this.canEditItem(t)&&(this.isShape(t)||this.isFilledShape(t))?(this.isImagePlaceholder(t)&&this.changeShapeImagePlaceholder(t,!1),n=this.getLastUndoOperationId(),this.beginDesignOperation(),r=t,e?[3,1]:(r=this.removeImageFromShape(t),[3,5])):[2,t];case 1:return this.isFilledShape(t)?[4,this.updateFilledShapeAsync(t,e,i)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return this.isShape(t)?[4,this.createFilledShapeAsync(t,e,i)]:[3,5];case 4:r=a.sent(),a.label=5;case 5:return this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(n),[2,r]}})})},createFilledShapeAsync:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r,a,s,o,l,h,c,u,d,f,g,p,m,v,_,y,x,b,I,C;return __generator(this,function(w){switch(w.label){case 0:return this.isShape(t)&&(e&&e instanceof MPlaza.Image&&(t.data&&t.data.isImagePlaceholder||this.canFillShape(t)))?(n="",!this.isImageScalingEnabled&&"svg"!=e.get("format").toLowerCase()&&"vector"!=e.get("type").toLowerCase()&&["png","jpg","jpeg"].find(function(t){return t==e.get("format").toLowerCase()})&&(n=e.get("url")),n||(n=e.get("previewUrl")),n?t&&t instanceof this.paper.CompoundPath&&t.data&&t.data.isShape&&(r=this.findDesignItemForItem(t))?(a=this.getDesignEffectForDesignItem(r),s=this.isItemSelected(t),t.parent,o=n,[4,this.applyDesignEffectToImageUrl(a,n)]):[3,7]:[2,t]):[2,t];case 1:return n=w.sent(),i?[3,3]:[4,this.getImageDefaultColorMappings(n,t)];case 2:i=w.sent(),w.label=3;case 3:return i&&i.length>0?[4,this.recolorImage(n,i)]:[3,5];case 4:n=w.sent(),w.label=5;case 5:return[4,this.createRasterItem(n,!1)];case 6:return(l=w.sent()).data.originalUrl=o,this.applyDesignEffectToItem(a,l),h=t.bounds.clone(),c=new this.paper.Matrix,u=t.position,t.data.originalBounds&&t.data.originalMatrix&&t.data.originalPosition&&(d=t.clone(),f=d.position.clone(),d.rotate(-t.data.originalMatrix.rotation,f),g=d.bounds,h=g.clone(),d.remove(),(p=new this.paper.Path.Rectangle(g)).rotate(t.data.originalMatrix.rotation,f),u=p.position,p.remove(),c.rotate(t.data.originalMatrix.rotation),t.data.flips&&t.data.flips.forEach(function(t){return"X"==t?c.scale(-1,-1):c.scale(1,-1)})),m=1,v=1,h.width>1e-7&&l.bounds.width>0&&(m=h.width/l.bounds.width),h.height>1e-7&&l.bounds.height>0&&(v=h.height/l.bounds.height),m=v=Math.max(Math.abs(m),Math.abs(v)),l.scale(m,v),l.matrix.prepend(c),l.position=u,l.data.originalBounds=new this.paper.Rectangle(0,0,l.width,l.height),l.data.originalMatrix=l.matrix.clone(),t.fillColor=null,t.originalParentMatrix=new this.paper.Matrix,t.data.isMaskedImageShape=!0,(_=t.clone()).data={},_.position=t.position,_.data.isMaskedImageMask=!0,y=null!=t.data.originalStrokeColor?t.data.originalStrokeColor:void 0,y=this.forceColorInFixedPalette(t,y),x=this.applyDesignEffectToTextColor(a,y),t.strokeColor=x,t.data.originalStrokeColor=y,(b=new this.paper.Group(_,l)).clipped=!0,b.data.isMaskedImageClipGroup=!0,l.visibile=!0,(I=new this.paper.Group(b)).insertAbove(t),I.addChild(t),I.applyMatrix=!1,I.data.guid=t.data.guid,delete t.data.guid,I.data.isMaskedImageMainGroup=!0,I.data.isFilledShape=!0,I.data.originalBounds=t.bounds,I.data.originalMatrix=new this.paper.Matrix,t.data.maskPath&&t.data.maskPath.remove(),this.removeProfanityCheckInvalidOverlayAndEdgeForItem(t),this.applyDesignEffectToItem(a,I,!0),C=this.createDummyShapeFromDesignItem(r),this.onImageItemUpdated(I,e,C),t.data.selected=!1,I.data.selected=s,this.updateSelectionState(),this.updateShapeImagePlaceholder(I),this.updateItemsIndexes(),this.updateDesignItemColorMappings(r,i),[2,I];case 7:return[2,t]}})})},updateFilledShapeAsync:function(t,e,i){return __awaiter(this,void 0,void 0,function(){var n,r,a,s,o,l,h,c,u,d,f,g,p,m,v;return __generator(this,function(_){switch(_.label){case 0:return e&&e instanceof MPlaza.Image&&this.isFilledShape(t)?(n=this.getMaskedImageShapeItem(t),r=this.getMaskedImageRasterItem(t),n.data&&n.data.isImagePlaceholder||this.canReplaceShapeFilling(t)?(a="",!this.isImageScalingEnabled&&"svg"!=e.get("format").toLowerCase()&&"vector"!=e.get("type").toLowerCase()&&["png","jpg","jpeg"].find(function(t){return t==e.get("format").toLowerCase()})&&(a=e.get("url")),a||(a=e.get("previewUrl")),a?(this.applyTransformationsToMaskImageSubItems(t),(s=this.findDesignItemByGuid(t.data.guid))?s.get("imageID")===e.get("imageID")?[3,7]:r?(o=this.getDesignEffectForDesignItem(s),l=a,[4,this.applyDesignEffectToImageUrl(o,a)]):[3,7]:[3,7]):[2,t]):[2,t]):[2,t];case 1:return a=_.sent(),i?[3,3]:[4,this.getImageDefaultColorMappings(a,t)];case 2:i=_.sent(),_.label=3;case 3:return i&&i.length>0?[4,this.recolorImage(a,i)]:[3,5];case 4:a=_.sent(),_.label=5;case 5:return[4,this.changeRasterItem(r,a)];case 6:_.sent(),r.matrix=new this.paper.Matrix,r.data.originalUrl=l,this.applyDesignEffectToItem(o,t),h=t.bounds.clone(),c=new this.paper.Matrix,u=t.position,n.data.originalBounds&&n.data.originalMatrix&&n.data.originalPosition&&(d=n.clone(),f=d.position.clone(),d.rotate(-n.data.originalMatrix.rotation,f),g=d.bounds,h=g.clone(),d.remove(),(p=new this.paper.Path.Rectangle(g)).rotate(n.data.originalMatrix.rotation,f),u=p.position,p.remove(),c.rotate(n.data.originalMatrix.rotation),n.data.flips&&n.data.flips.forEach(function(t){return"X"==t?c.scale(-1,-1):c.scale(1,-1)})),m=1,v=1,h.width>1e-7&&r.bounds.width>0&&(m=h.width/r.bounds.width),h.height>1e-7&&r.bounds.height>0&&(v=h.height/r.bounds.height),m=v=Math.max(Math.abs(m),Math.abs(v)),r.scale(m,v),r.matrix.prepend(c),r.position=u,r.data.originalBounds=new this.paper.Rectangle(0,0,r.width,r.height),r.data.originalMatrix=r.matrix.clone(),this.onImageItemUpdated(t,e,this.createDummyShapeFromDesignItem(s)),this.updateDesignItemColorMappings(s,i),this.updateSelectionState(),this.paper.project.view.update(),this.fireImageLoadedEvent(),_.label=7;case 7:return[2,t]}})})},removeImageFromShape:function(t,e){var i=t;if(t&&this.isFilledShape(t)){var n=this.isItemSelected(t),r=t.parent,a=this.findDesignItemForItem(t),s=this.getMaskedImageShapeItem(t);if(!(s.data&&s.data.isImagePlaceholder||this.canDeleteShapeFilling(t)))return t;if(a&&s){var o=this.getDesignEffectForDesignItem(a),l=t.matrix;(i=s).data.guid=t.data.guid,r.addChild(i),t.remove();var h=s.data.originalStrokeColor||s.strokeColor,c=s.data.originalFillColor||s.fillColor;h=this.forceColorInFixedPalette(t,h),c=this.forceColorInFixedPalette(t,c),s.data.originalStrokeColor=h,s.data.originalFillColor=c,h=this.applyDesignEffectToTextColor(o,h),c=this.applyDesignEffectToTextColor(o,c),i.strokeColor=h,i.fillColor=c,i.data.isMaskedImageShape=!1,this.applyDesignEffectToItem(o,s),i.matrix.prepend(l),i.data.originalMatrix&&i.data.originalMatrix.prepend(l);var u=this.createDummyShapeFromDesignItem(a);this.onShapeItemUpdated(i,u,null),this.updateDesignItemColorMappings(a,[]),n&&this.maskedImageSelectionMode!=MaskedImageSelectionMode.Element&&(this.maskedImageSelectionMode=MaskedImageSelectionMode.Element),t.data.selected=!1,i.data.selected=n,this.updateSelectionState(),this.changeShapeImagePlaceholder(i,!0)}}return i},changeShapeImagePlaceholder:function(t,e){e?this.setImagePlaceholder(t):this.unsetImagePlaceholder(t)},setImagePlaceholder:function(t){if(this.isShape(t)||this.isFilledShape(t)){var e=this.findDesignItemForItem(t);if(e){var i=this.getLastUndoOperationId();this.beginDesignOperation();var n=this.isShape(t)?t:this.removeImageFromShape(t);if(n){n.data.isImagePlaceholder=!0;var r=this.createDummyImageFromDesignItem(e),a=this.createDummyShapeFromDesignItem(e);this.onShapeItemUpdated(t,a,r),this.updateSelectionState(),this.paper.project.view.update()}this.endDesignOperation(),this.mergeAllUndoOperationsAfterId(i)}}},unsetImagePlaceholder:function(t){if(this.isShape(t)&&t.data.isImagePlaceholder){var e=this.findDesignItemForItem(t);if(e){this.beginDesignOperation(),t.data.isImagePlaceholder=!1;var i=this.createDummyImageFromDesignItem(e),n=this.createDummyShapeFromDesignItem(e);this.onShapeItemUpdated(t,n,i),this.updateSelectionState(),this.paper.project.view.update(),this.endDesignOperation()}}},getItemIsShape:function(t){return this.isFilledShape(t)||this.isShape(t)},getOffsetDistance:function(t){return t&&t instanceof paper.Point?Math.round(t.length):0},getOffsetAngle:function(t){if(t&&t instanceof paper.Point){var e=t.angle;return e<0&&(e+=360),e=Math.round(e)}return 0},getOffsetByDistanceAngle:function(t,e){return null==t||null==e?new this.paper.Point(0,0):new this.paper.Point({length:t,angle:e})},updateTemplateItem:function(t){var e=JSON.parse(t.get("json"));if(e[1].data.isTemplateElement=!0,e[1].data.isTextArea&&e[1].data.text&&(e[1].data.defaultPlaceHolderText=e[1].data.text),e[1].data.isTextArt){var i=t.get("textArt");e[1].data.defaultPlaceHolderText=i.attributes.text}t.set("json",JSON.stringify(e))},applyDescToDesignAsync:function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,a=this;return __generator(this,function(s){switch(s.label){case 0:if(!this.design||!this.design.get("elementsDescs"))return[3,5];if(!(e=this.design.get("elementsDescs").getDescById(t)))return[3,5];i=this.getSelectedItems(),n=0,s.label=1;case 1:return n<e.get("elements").length?(r=e.get("elements").at(n),[4,this.applyDesignElementToDesignAsync(r)]):[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:this.deselectAll(),i.forEach(function(t){return a.setItemSelection(t,!0)}),s.label=5;case 5:return[2]}})})},applyDesignElementToDesignAsync:function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,a;return __generator(this,function(s){switch(s.label){case 0:if(!(t&&t instanceof MPlaza.DesignElement))return[3,4];e=t.get("tag"),i=this.findItemsByTag(e),n=0,r=i,s.label=1;case 1:return n<r.length?(a=r[n],[4,this.applyDesignElementToItemAsync(t,a)]):[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},applyDesignElementToItemAsync:function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.saveItemInitialInfo(e),this.getItemIsTextElement(e)?[4,this.applyDesignElementToTextItemAsync(t,e)]:[3,2];case 1:return i.sent(),[3,8];case 2:return this.getItemIsTextArt(e)?[4,this.applyDesignElementToTextArtItemAsync(t,e)]:[3,4];case 3:return i.sent(),[3,8];case 4:return this.getItemIsImage(e)?[4,this.applyDesignElementToImageItemAsync(t,e)]:[3,6];case 5:return i.sent(),[3,8];case 6:return this.getItemIsShape(e)?[4,this.applyDesignElementToShapeItemAsync(t,e)]:[3,8];case 7:i.sent(),i.label=8;case 8:return[2]}})})},applyDesignElementToTextItemAsync:function(t,e){var i=this.fromDesignElementToTextItemInfo(t);return i&&this.modifyTextElement(e,i,!1),Promise.resolve()},fromDesignElementToTextItemInfo:function(t){var e=null;if(t&&t.get("text")){for(var i in e=t.get("text").toJSON())null!==e[i]&&void 0!==e[i]||delete e[i];e.text=e.content,delete e.content}return e},applyDesignElementToTextArtItemAsync:function(t,e){return Promise.resolve()},applyDesignElementToImageItemAsync:function(t,e){return Promise.resolve()},applyDesignElementToShapeItemAsync:function(t,e){return Promise.resolve()},saveItemInitialInfo:function(t){if(t&&t.data&&t.data.guid&&!this.initialItemsInfo.hasOwnProperty(t.data.guid)){var e=null;this.getItemIsTextElement(t)?e=this.getTextItemInfo(t):this.getItemIsTextArt(t)?e=this.getTextArtItemInfo(t):this.getItemIsImage(t)?e=this.getImageItemInfo(t):this.getShapeItemInfo(t)&&(e=this.getShapeItemInfo(t)),this.initialItemsInfo[t.data.guid]=e}},resetItemsInitialStateAsync:function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,r;return __generator(this,function(a){switch(a.label){case 0:if(!this.initialItemsInfo)return[3,4];for(e in t=[],this.initialItemsInfo)t.push(e);i=0,a.label=1;case 1:return i<t.length?(n=t[i],r=this.findItemByGuid(n),[4,this.resetSingleItemInitialStateAsync(r)]):[3,4];case 2:a.sent(),a.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},resetSingleItemInitialStateAsync:function(t){if(t&&t.data&&t.data.guid){var e=null;this.initialItemsInfo.hasOwnProperty(t.data.guid)&&(e=this.initialItemsInfo[t.data.guid],this.getItemIsTextElement(t)?this.modifyTextElement(t,e,!1):this.getItemIsTextArt(t)||this.getItemIsImage(t)||this.getItemIsShape(t))}return Promise.resolve()},findItemsByTag:function(t){var e=[];if(this.design)for(var i=0,n=this.design.getDesignItemsByTag(t);i<n.length;i++){var r=n[i],a=this.findItemForDesignItem(r);a&&e.push(a)}return e},getBackgroundColorForArea:function(t){var e=this,i=null;return this.design.get("designItems").forEach(function(n){var r,a=JSON.parse(n.get("json"));a.length>1&&a[1].data&&a[1].data.isAreaForBackground&&a[1].fillColor&&t.get("guid")===a[1].data.areaGuid&&(i=(new((r=e.paper.Color).bind.apply(r,__spreadArray(__spreadArray([void 0],a[1].fillColor,!1),[0],!1)))).toCSS(!0))}),i},updateResizableProductSideImage:function(t,e,i,n){if(this.showSideImage){this.imageItem&&(this.imageItem.remove(),this.imageItem=null),this.resizableSideImageItem&&(this.resizableSideImageItem.remove(),this.resizableSideImageItem=null),this.resizableMeasuresItem&&(this.resizableMeasuresItem.remove(),this.resizableMeasuresItem=null),this.resizableSplitColumnsItem&&(this.resizableSplitColumnsItem.remove(),this.resizableSplitColumnsItem=null);var r=this.productImageGenerator.generateImage({width:t,height:e,shape:{borderColor:"#DDDDDD",borderRadius:0,fillColor:"#FFFFFF",shadowColor:"#00000055",shadowBlur:5,shadowOffset:{x:0,y:10}},splitColumns:{columns:i,rows:n,lineColor:"#CCC",lineWidth:1,lineDashArray:[10,10],marginHorizontal:0,marginVertical:0},measures:{lineColor:"#888",lineWidth:1,lineDashArray:[],distanceHorizontal:10,distanceVertical:10,widthLabel:Math.round(t/this.side.get("ppcm")*100)/100+"cm",heightLabel:Math.round(e/this.side.get("ppcm")*100)/100+"cm",labelFontSize:16,labelColor:"black"}}),a=r.shape,s=r.splitColumns,o=r.measures;this.resizableSideImageItem=this.imageLayer.importJSON(a.json),this.resizableMeasuresItem=this.imageLayer.importJSON(o.json),this.resizableSplitColumnsItem=this.imageLayer.importJSON(s.json),this.updateResizableProductTextZoom(),this.paper.project.view.update()}},setResizableProductSize:function(t,e,i,n,r){if(this.side){this.paper.activate();this.side.get("ppcm");var a=this.side.get("areas").at(0),s=this.findItemForArea(a),o=this.masterGroup.children.find(function(t){return t.data&&t.data.isClippingArea});if(s&&o){var l=this.productAreaGenerator.generateArea({width:t,height:e,borderRadius:i}),h=this.paper.project.importJSON(l.json);h.remove();var c=__assign({},s.style),u=__assign({},s.data),d=__assign({},o.data);s instanceof this.paper.Path?s.copyContent(h):s instanceof this.paper.CompoundPath&&s.children[0].copyContent(h),o.children[0].copyContent(h),o.removeChildren(1),s.style=c,s.data=u,o.data=d,this.updateResizableProductSideImage(t,e,n,r),this.fitToScreen(!1,!0)}}},updateResizableProductTextZoom:function(){var t=this;this.resizableMeasuresItem&&this.resizableMeasuresItem.children.filter(function(e){return e instanceof t.paper.PointText}).forEach(function(e){return e.scaling=new t.paper.Point(1/t.paper.view.zoom,1/t.paper.view.zoom)}),this.paper.project.view.update()},restoreResizable:function(){var t,e,i,n,r,a=this,s=null===(e=null===(t=this.design.get("designItems").at(0))||void 0===t?void 0:t.get("areas").at(0))||void 0===e?void 0:e.get("colorID");if(s){var o=null===(i=this.design.get("options"))||void 0===i?void 0:i.find(function(t){return t.get("colorID")==s&&(t.get("sideID")==a.side.get("id")||null==t.get("sideID"))});o&&o.get("width")&&o.get("height")&&this.setResizableProductSize(o.get("width"),o.get("height"),0,null!==(n=o.get("columns"))&&void 0!==n?n:1,null!==(r=o.get("rows"))&&void 0!==r?r:1)}}},(Zakeke=Zakeke||{}).generateUUID=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:7&i|8).toString(16)})},Zakeke.getEmptyUUID=function(){return"00000000-0000-0000-0000-000000000000"},Zakeke.makeID=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},Zakeke.ShaderInputType={Float:1,Int:2,Texture:3,Array2:4,Array3:5,Color3:6,Color4:7,Matrix:8,Matrix2x2:9,Matrix3x3:10,Vector2:11,Vector3:12,Vector4:13},Zakeke.ShaderOptionType={Attribute:1,Uniform:2,Sampler:3},Zakeke.IncrementalFileInfo=function(){this.name="",this.data=null,this.isScene=!1,this.dracoEncoded=!1},Zakeke.TextureUsage={Any:0,Desktop:1,Mobile:2},Zakeke.SceneCameraConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGroundConfig=Backbone.AssociatedModel.extend({defaults:{createGround:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSkyboxConfig=Backbone.AssociatedModel.extend({defaults:{createSkybox:!1},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneEnvironmentConfig=Backbone.AssociatedModel.extend({defaults:{skybox:null,ground:null},initialize:function(){this.get("skybox")&&(this.get("skybox").parentModel=this),this.get("ground")&&(this.get("ground").parentModel=this)},relations:[{type:Backbone.One,key:"skybox",relatedModel:Zakeke.SceneSkyboxConfig},{type:Backbone.One,key:"ground",relatedModel:Zakeke.SceneGroundConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGeneralConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneGlowConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneInfoPointsStyleConfig=Backbone.AssociatedModel.extend({defaults:{},initialize:function(){},relations:[],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneInfoPointsConfig=Backbone.AssociatedModel.extend({defaults:{pointsStyle:null},initialize:function(){this.get("pointsStyle")&&(this.get("pointsStyle").parentModel=this)},relations:[{type:Backbone.One,key:"pointsStyle",relatedModel:Zakeke.SceneInfoPointsStyleConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneConfig=Backbone.AssociatedModel.extend({defaults:{general:null,environment:null,camera:null,glow:null,infoPoints:null},initialize:function(){this.get("general")&&(this.get("general").parentModel=this),this.get("environment")&&(this.get("environment").parentModel=this),this.get("camera")&&(this.get("camera").parentModel=this),this.get("glow")&&(this.get("glow").parentModel=this),this.get("infoPoints")&&(this.get("infoPoints").parentModel=this)},relations:[{type:Backbone.One,key:"general",relatedModel:Zakeke.SceneGeneralConfig},{type:Backbone.One,key:"environment",relatedModel:Zakeke.SceneEnvironmentConfig},{type:Backbone.One,key:"camera",relatedModel:Zakeke.SceneCameraConfig},{type:Backbone.One,key:"glow",relatedModel:Zakeke.SceneGlowConfig},{type:Backbone.One,key:"infoPoints",relatedModel:Zakeke.SceneInfoPointsConfig}],getParentModel:function(){return this.parentModel},toString:function(){}}),Zakeke.SceneSourceTexture=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,url:""},idAttribute:"textureID",initialize:function(){},relations:[],getTextureID:function(){return this.get("textureID")},getSourceID:function(){return this.collection&&this.collection.getSourceID?this.collection.getSourceID():null},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneSourceTextures=Backbone.Collection.extend({model:Zakeke.SceneSourceTexture,getSourceID:function(){return this.parentModel&&this.parentModel.getSourceID?this.parentModel.getSourceID():null},getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findTexture:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("textureID")==t)return i}return null}}),Zakeke.SceneSource=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,url:"",rootUrl:"",sceneFileName:"",textures:[]},idAttribute:"sourceID",initialize:function(){this.get("textures").parentModel=this},relations:[{type:Backbone.Many,key:"textures",collectionType:Zakeke.SceneSourceTextures}],getSourceID:function(){return this.get("sourceID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneSources=Backbone.Collection.extend({model:Zakeke.SceneSource,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findSource:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sourceID")==t)return i}return null}}),Zakeke.SceneShaderMaterial=Backbone.AssociatedModel.extend({defaults:{materialID:"",name:"",vertex:"",fragment:""},idAttribute:"materialID",initialize:function(){},relations:[],getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneShaderMaterials=Backbone.Collection.extend({model:Zakeke.SceneShaderMaterial,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findShaderMaterial:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("materialID")==t)return i}return null}}),Zakeke.SceneTexture=Backbone.AssociatedModel.extend({defaults:{materialID:"",isDefaultEnvironment:!1,fileObjectID:-1,fileLength:-1,url:"",usage:Zakeke.TextureUsage.Any},idAttribute:"textureID",initialize:function(){},relations:[],getTextureID:function(){return this.get("textureID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneTextures=Backbone.Collection.extend({model:Zakeke.SceneTexture,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findTexture:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("textureID")==t)return i}return null}}),Zakeke.SceneMaterialPhoto=Backbone.AssociatedModel.extend({defaults:{materialID:"",displayOrder:0,fileObjectID:-1,fileLength:-1,url:""},idAttribute:"photoID",initialize:function(){},relations:[],getMaterialPhotoID:function(){return this.get("photoID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMaterialPhotos=Backbone.Collection.extend({model:Zakeke.SceneMaterialPhoto,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findMaterialPhoto:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("photoID")===t)return i}return null},getMaterialPhotoUrls:function(t){for(var e=[],i=0;i<this.length;i++)this.at(i).get("materialID")===t&&e.push(this.at(i).get("url"));return e}}),Zakeke.SceneCameraLocation=Backbone.AssociatedModel.extend({defaults:{name:"",px:0,py:0,pz:0,tx:0,ty:0,tz:0},idAttribute:"locationID",initialize:function(){this.get("locationID")||this.set("locationID",Zakeke.generateUUID())},relations:[],getLocationID:function(){return this.get("locationID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneCameraLocations=Backbone.Collection.extend({model:Zakeke.SceneCameraLocation,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findCameraLocation:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("locationID")==t)return i}return null}}),Zakeke.SceneMeshLocation=Backbone.AssociatedModel.extend({defaults:{name:"",tempImageFileKey:"",imageUrl:"",displayOrder:0,isCollapsed:!1,isExploded:!1,adjustCamera:!0,data:[]},idAttribute:"locationID",initialize:function(){this.get("locationID")||this.set("locationID",Zakeke.generateUUID())},relations:[],getLocationID:function(){return this.get("locationID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMeshLocations=Backbone.Collection.extend({model:Zakeke.SceneMeshLocation,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findMeshLocation:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("locationID")==t)return i}return null},getFirstExplodedMeshLocation:function(){for(var t=0;t<this.length;t++){var e=this.at(t);if(e.get("isExploded"))return e}return null},getFirstCollapsedMeshLocation:function(){for(var t=0;t<this.length;t++){var e=this.at(t);if(e.get("isCollapsed"))return e}return null},getOrCreateExplodedMeshLocation:function(){var t=this.getFirstExplodedMeshLocation();return t||((t=new Zakeke.SceneMeshLocation).set("name","exploded"),t.set("isExploded",!0),this.push(t)),t},getOrCreateCollapsedMeshLocation:function(){var t=this.getFirstCollapsedMeshLocation();return t||((t=new Zakeke.SceneMeshLocation).set("name","collapsed"),t.set("isCollapsed",!0),this.push(t)),t}}),Zakeke.SceneMaterialMapping=Backbone.AssociatedModel.extend({defaults:{libraryMaterialID:"",sceneMaterialID:""},initialize:function(){},relations:[],getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneMaterialMappings=Backbone.Collection.extend({model:Zakeke.SceneMaterialMapping,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},getMappingForSceneMaterial:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sceneMaterialID")==t)return i}},getMappingsForLibraryMaterial:function(t){for(var e=[],i=0;i<this.length;i++){var n=this.at(i);n.get("libraryMaterialID")==t&&e.push(n)}return e},getLibraryMaterialIDs:function(){for(var t=[],e={},i=0;i<this.length;i++)e[this.at(i).get("libraryMaterialID")]=!0;for(var n in e)t.push(n);return t}}),Zakeke.SceneARFile=Backbone.AssociatedModel.extend({defaults:{fileType:"",url:""},idAttribute:"fileID",initialize:function(){this.get("fileID")||this.set("fileID",Zakeke.generateUUID())},getFileID:function(){return this.get("fileID")},getSceneID:function(){return this.collection&&this.collection.getSceneID?this.collection.getSceneID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.SceneARFiles=Backbone.Collection.extend({model:Zakeke.SceneARFile,getSceneID:function(){return this.parentModel&&this.parentModel.getSceneID?this.parentModel.getSceneID():null},findFile:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("fileID")===t)return i}return null}}),Zakeke.Scene=Backbone.AssociatedModel.extend({defaults:{name:"",fileObjectID:-1,fileLength:-1,url:"",rootUrl:"",sceneFileName:"",manifestFileObjectID:-1,manifestFileLength:-1,manifestFileUrl:"",sellerID:-1,imageData:null,imageUrl:"",useDefaultEnvironmentTexture:!1,cameraLimitLowerRadius:!0,version:0,config:null,usedTextureUrls:null,sources:[],cameraLocations:[],materialMappings:[],textures:[],materialPhotos:[],shaderMaterials:[],meshLocations:[],arFiles:[]},idAttribute:"sceneID",getSceneID:function(){return null!=this.id&&null!=this.id?this.id:this.get("tempSceneID")},initialize:function(){this.get("tempSceneID")||this.set("tempSceneID",Zakeke.generateUUID());var t=this;this.get("config")&&(this.get("config").parentModel=this),this.get("sources").parentModel=this,this.get("sources").url=function(){return t.url()+"/"+t.getSceneID()+"/sources"},this.get("cameraLocations").parentModel=this,this.get("cameraLocations").url=function(){return t.url()+"/"+t.getSceneID()+"/cameraLocations"},this.get("meshLocations").parentModel=this,this.get("meshLocations").url=function(){return t.url()+"/"+t.getSceneID()+"/meshLocations"},this.get("materialMappings").parentModel=this,this.get("textures").parentModel=this,this.get("materialPhotos").parentModel=this,this.get("shaderMaterials").parentModel=this,this.get("arFiles").parentModel=this},relations:[{type:Backbone.One,key:"config",relatedModel:Zakeke.SceneConfig},{type:Backbone.Many,key:"sources",collectionType:Zakeke.SceneSources},{type:Backbone.Many,key:"cameraLocations",collectionType:Zakeke.SceneCameraLocations},{type:Backbone.Many,key:"meshLocations",collectionType:Zakeke.SceneMeshLocations},{type:Backbone.Many,key:"materialMappings",collectionType:Zakeke.SceneMaterialMappings},{type:Backbone.Many,key:"textures",collectionType:Zakeke.SceneTextures},{type:Backbone.Many,key:"materialPhotos",collectionType:Zakeke.SceneMaterialPhotos},{type:Backbone.Many,key:"shaderMaterials",collectionType:Zakeke.SceneShaderMaterials},{type:Backbone.Many,key:"arFiles",collectionType:Zakeke.SceneARFiles}],url:function(){var t=Zakeke.config.baseApiUrl+"scenes";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},getSceneFileUploadUrl:function(){return Zakeke.config.baseApiUrl+"scenes/"+this.getSceneID()+"/scenefile"},getSceneRootUrlApiUrl:function(){return Zakeke.config.baseApiUrl+"scenes/"+this.getSceneID()+"/rooturl"},getSceneIncrementalFileUploadUrl:function(){var t=this.getSceneFileUploadUrl();return t+="?incremental=true"},getSourceUrl:function(t){return Zakeke.config.baseApiUrl+"scenes/"+this.getSceneID()+"/sources/"+t},getSourceTasksUrl:function(){return Zakeke.config.baseImagesUploadApiUrl+"scenes/"+this.getSceneID()+"/sourcetasks"},getSourceTaskResultUrl:function(t){return Zakeke.config.baseImagesUploadApiUrl+"scenes/"+this.getSceneID()+"/sourcetaskresult/"+t},getTexturesUrl:function(t){return Zakeke.config.baseApiUrl+"scenes/"+this.getSceneID()+"/textures/"+t},getMaterialPhotosUrl:function(t){return Zakeke.config.baseApiUrl+"scenes/"+this.getSceneID()+"/materialphotos/"+t},getSourcesIDs:function(){for(var t=[],e=0;e<this.get("sources").length;e++){var i=this.get("sources").at(e);t.push(i.getSourceID())}return t},getMappingForSceneMaterial:function(t){return this.get("materialMappings").getMappingForSceneMaterial(t)},getMappingsForLibraryMaterial:function(t){return this.get("materialMappings").getMappingsForLibraryMaterial(t)},getLibraryMaterialIDs:function(){return this.get("materialMappings").getLibraryMaterialIDs()},mapLibraryMaterial:function(t,e){var i=new Zakeke.SceneMaterialMapping;i.set("libraryMaterialID",t),i.set("sceneMaterialID",e),this.get("materialMappings").push(i)},removeMappingForSceneMaterial:function(t){var e=this.get("materialMappings").getMappingForSceneMaterial(t);e&&this.get("materialMappings").remove(e)},registerShaderMaterial:function(t,e,i,n){var r=this.get("shaderMaterials").findWhere({materialID:t});r||((r=new Zakeke.SceneShaderMaterial).set("materialID",t),r.set("name",e),r.set("vertex",i),r.set("fragment",n),this.get("shaderMaterials").push(r))},getLibraryShaderMaterialIDForSceneMaterial:function(t){var e=this.getMappingForSceneMaterial(t);if(e)for(var i=e.get("libraryMaterialID"),n=0;n<this.get("shaderMaterials").length;n++)if(this.get("shaderMaterials").at(n).get("materialID")===i)return i;return null},unregisterShaderMaterial:function(t){var e=this.get("shaderMaterials").findWhere({materialID:t});e&&this.get("shaderMaterials").remove(e)},getCameraLocation:function(t){return this.get("cameraLocations").findCameraLocation(t)},getMeshLocation:function(t){return this.get("meshLocations").findMeshLocation(t)},getSceneConfig:function(){return this.get("config")},getOrCreateSceneConfig:function(){var t=this.getSceneConfig();return t||(t=new Zakeke.SceneConfig,this.set("config",t)),t},getGeneralConfig:function(){var t=this.getSceneConfig();return t&&t.get("general")&&t.get("general")instanceof Zakeke.SceneGeneralConfig?t.get("general"):null},getOrCreateGeneralConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("general");return e||(e=new Zakeke.SceneGeneralConfig,t.set("general",e)),e},getMatchSameNameTextures:function(){var t=this.getGeneralConfig();if(t)return t.get("matchSameNameTextures")},setMatchSameNameTextures:function(t){this.getOrCreateGeneralConfig().set("matchSameNameTextures",t)},getAntialiasEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("antialiasEnabled")},setAntialiasEnabled:function(t){this.getOrCreateGeneralConfig().set("antialiasEnabled",t)},getTryOnEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnEnabled")},setTryOnEnabled:function(t){this.getOrCreateGeneralConfig().set("tryOnEnabled",t)},getAREnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("arEnabled")},setAREnabled:function(t){this.getOrCreateGeneralConfig().set("arEnabled",t)},getArOnTheFly:function(){return this.getOrCreateGeneralConfig().get("arOnTheFly")},setArOnTheFly:function(t){this.getOrCreateGeneralConfig().set("arOnTheFly",t)},getTryOnEnabled:function(){var t=this.getGeneralConfig();if(t)return t.get("tryOnEnabled")},setTryOnEnabled:function(t){this.getOrCreateGeneralConfig().set("tryOnEnabled",t)},getARScale:function(){var t=this.getGeneralConfig();if(t){var e=t.get("arScale");return null==e||e}return!0},setARScale:function(t){this.getOrCreateGeneralConfig().set("arScale",t)},getUseDelayedTextureLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedTextureLoading")},setUseDelayedTextureLoading:function(t){this.getOrCreateGeneralConfig().set("useDelayedTextureLoading",t)},getUseDelayedMaterialLoading:function(){var t=this.getGeneralConfig();if(t)return t.get("useDelayedMaterialLoading")},setUseDelayedMaterialLoading:function(t){this.getOrCreateGeneralConfig().set("useDelayedMaterialLoading",t)},getUseMaterialOffloading:function(){var t=this.getGeneralConfig();if(t)return t.get("useMaterialOffloading")},setUseMaterialOffloading:function(t){this.getOrCreateGeneralConfig().set("useMaterialOffloading",t)},getPrefetchMeshes:function(){var t=this.getGeneralConfig();if(t)return t.get("prefetchMeshes")},setPrefetchMeshes:function(t){this.getOrCreateGeneralConfig().set("prefetchMeshes",t)},getPrefetchMaterials:function(){var t=this.getGeneralConfig();if(t)return t.get("prefetchMaterials")},setPrefetchMaterials:function(t){this.getOrCreateGeneralConfig().set("prefetchMaterials",t)},getEnvironmentConfig:function(){var t=this.getSceneConfig();return t&&t.get("environment")&&t.get("environment")instanceof Zakeke.SceneEnvironmentConfig?t.get("environment"):null},getOrCreateEnvironmentConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("environment");return e||(e=new Zakeke.SceneEnvironmentConfig,t.set("environment",e)),e},getSkyboxConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("skybox")&&t.get("skybox")instanceof Zakeke.SceneSkyboxConfig?t.get("skybox"):null},getOrCreateSkyboxConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("skybox");return e||(e=new Zakeke.SceneSkyboxConfig,t.set("skybox",e)),e},getGroundConfig:function(){var t=this.getEnvironmentConfig();return t&&t.get("ground")&&t.get("ground")instanceof Zakeke.SceneGroundConfig?t.get("ground"):null},getOrCreateGroundConfig:function(){var t=this.getOrCreateEnvironmentConfig(),e=t.get("ground");return e||(e=new Zakeke.SceneGroundConfig,t.set("ground",e)),e},getCameraConfig:function(){var t=this.getSceneConfig();return t&&t.get("camera")&&t.get("camera")instanceof Zakeke.SceneCameraConfig?t.get("camera"):null},getOrCreateCameraConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("camera");return e||(e=new Zakeke.SceneCameraConfig,t.set("camera",e)),e},getCameraPositionScale:function(){var t=this.getCameraConfig();if(t)return t.get("positionScale")},setCameraPositionScale:function(t){this.getOrCreateCameraConfig().set("positionScale",t)},getCameraLimitLowerRadius:function(){var t=this.getCameraConfig();if(t)return t.get("limitLowerRadius")},setCameraLimitLowerRadius:function(t){this.getOrCreateCameraConfig().set("limitLowerRadius",t)},getCameraZoomEnabled:function(){var t=this.getCameraConfig();if(t)return t.get("zoomEnabled")},setCameraZoomEnabled:function(t){this.getOrCreateCameraConfig().set("zoomEnabled",t)},getCameraUseMinZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("useMinZoomPerc")},setCameraUseMinZoomPerc:function(t){this.getOrCreateCameraConfig().set("useMinZoomPerc",t)},getCameraMinZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("minZoomPerc")},setCameraMinZoomPerc:function(t){this.getOrCreateCameraConfig().set("minZoomPerc",t)},getCameraUseMaxZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("useMaxZoomPerc")},setCameraUseMaxZoomPerc:function(t){this.getOrCreateCameraConfig().set("useMaxZoomPerc",t)},getCameraMaxZoomPerc:function(){var t=this.getCameraConfig();if(t)return t.get("maxZoomPerc")},setCameraMaxZoomPerc:function(t){this.getOrCreateCameraConfig().set("maxZoomPerc",t)},getCameraLowerAlphaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("lowerAlphaLimit")},setCameraLowerAlphaLimit:function(t){this.getOrCreateCameraConfig().set("lowerAlphaLimit",t)},getCameraUpperAlphaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("upperAlphaLimit")},setCameraUpperAlphaLimit:function(t){this.getOrCreateCameraConfig().set("upperAlphaLimit",t)},getCameraLowerBetaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("lowerBetaLimit")},setCameraLowerBetaLimit:function(t){this.getOrCreateCameraConfig().set("lowerBetaLimit",t)},getCameraUpperBetaLimit:function(){var t=this.getCameraConfig();if(t)return t.get("upperBetaLimit")},setCameraUpperBetaLimit:function(t){this.getOrCreateCameraConfig().set("upperBetaLimit",t)},getGlowConfig:function(){var t=this.getSceneConfig();return t&&t.get("glow")&&t.get("glow")instanceof Zakeke.SceneGlowConfig?t.get("glow"):null},getOrCreateGlowConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("glow");return e||(e=new Zakeke.SceneGlowConfig,t.set("glow",e)),e},getInfoPointsConfig:function(){var t=this.getSceneConfig();return t&&t.get("infoPoints")&&t.get("infoPoints")instanceof Zakeke.SceneInfoPointsConfig?t.get("infoPoints"):null},getOrCreateInfoPointsConfig:function(){var t=this.getOrCreateSceneConfig(),e=t.get("infoPoints");return e||(e=new Zakeke.SceneInfoPointsConfig,t.set("infoPoints",e)),e},getInfoPointsEnabled:function(){var t=!1,e=this.getInfoPointsConfig();return e&&(t=e.get("enabled")),null==t&&(t=!1),t},setInfoPointsEnabled:function(t){this.getOrCreateInfoPointsConfig().set("enabled",t)},getInfoPointsStyleConfig:function(){var t=this.getInfoPointsConfig();return t&&t.get("pointsStyle")&&t.get("pointsStyle")instanceof Zakeke.SceneInfoPointsStyleConfig?t.get("pointsStyle"):null},getOrCreateInfoPointsStyleConfig:function(){var t=this.getOrCreateInfoPointsConfig(),e=t.get("pointsStyle");return e||(e=new Zakeke.SceneInfoPointsStyleConfig,t.set("pointsStyle",e)),e},getInfoPointsBorderColor:function(){var t="#ffffff",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("borderColor")),t||(t="#ffffff"),t},setInfoPointsBorderColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("borderColor",t)},getInfoPointsInnerPointColor:function(){var t="#ffffff",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("innerPointColor")),t||(t="#ffffff"),t},setInfoPointsInnerPointColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("innerPointColor",t)},getInfoPointsColor:function(){var t="#a01c20",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("color")),t||(t="#a01c20"),t},setInfoPointsColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("color",t)},getInfoPointsHighlightColor:function(){var t="#bb2025",e=this.getInfoPointsStyleConfig();return e&&(t=e.get("highlightColor")),t||(t="#bb2025"),t},setInfoPointsHighlightColor:function(t){this.getOrCreateInfoPointsStyleConfig().set("highlightColor",t)},getFirstExplodedMeshLocation:function(){return this.get("meshLocations").getFirstExplodedMeshLocation()},getFirstCollapsedMeshLocation:function(){return this.get("meshLocations").getFirstCollapsedMeshLocation()},getOrCreateExplodedMeshLocation:function(){return this.get("meshLocations").getOrCreateExplodedMeshLocation()},getOrCreateCollapsedMeshLocation:function(){return this.get("meshLocations").getOrCreateCollapsedMeshLocation()}}),Zakeke.Scenes=Backbone.Collection.extend({model:Zakeke.Scene,url:function(){return Zakeke.config.baseApiUrl+"scenes"},getScene:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("sceneID")==t)return i}return null}}),Zakeke.MaterialSourceTextureImage=Backbone.AssociatedModel.extend({defaults:{sceneID:null,sourceID:null,materialID:null,fileObjectID:-1,fileLength:-1,url:""},initialize:function(){},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialSourceTextureImages=Backbone.Collection.extend({model:Zakeke.MaterialSourceTextureImage,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null}}),Zakeke.MaterialTextureImage=Backbone.AssociatedModel.extend({defaults:{fileObjectID:-1,fileLength:-1,imageUrl:""},idAttribute:"textureImageID",initialize:function(){},relations:[],getTextureImageID:function(){return this.get("textureImageID")},getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialTextureImages=Backbone.Collection.extend({model:Zakeke.MaterialTextureImage,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findTextureImage:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("textureImageID")==t)return i}return null}}),Zakeke.MaterialShaderOption=Backbone.AssociatedModel.extend({defaults:{name:"",shaderOptionTypeID:Zakeke.ShaderOptionType.Attribute},idAttribute:"optionID",initialize:function(){this.get("optionID")||this.set("optionID",Zakeke.generateUUID())},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialShaderOptions=Backbone.Collection.extend({model:Zakeke.MaterialShaderOption,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findShaderOption:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("optionID")==t)return i}return null}}),Zakeke.MaterialShaderInput=Backbone.AssociatedModel.extend({defaults:{name:"",shaderInputTypeID:Zakeke.ShaderInputType.Float},idAttribute:"inputID",initialize:function(){this.get("inputID")||this.set("inputID",Zakeke.generateUUID())},relations:[],getMaterialID:function(){return this.collection&&this.collection.getMaterialID?this.collection.getMaterialID():null},getParentModel:function(){return this.collection&&this.collection.parentModel?this.collection.parentModel:null},toString:function(){}}),Zakeke.MaterialShaderInputs=Backbone.Collection.extend({model:Zakeke.MaterialShaderInput,getMaterialID:function(){return this.parentModel&&this.parentModel.getMaterialID?this.parentModel.getMaterialID():null},findShaderInput:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("inputID")==t)return i}return null}}),Zakeke.MaterialShader=Backbone.AssociatedModel.extend({defaults:{name:"",vertex:"",fragment:""},idAttribute:"materialID",initialize:function(){},relations:[],getMaterialID:function(){return this.collection&&this.collection.getModelID?this.collection.getMaterialID():null},getParentModel:function(){return this.parentModel?this.parentModel:null},toString:function(){}}),Zakeke.Material=Backbone.AssociatedModel.extend({defaults:{name:"",JSON:"",url:"",rootUrl:"",materialFileName:"",sellerID:-1,imageData:null,imageUrl:"",fileLength:-1,sourceTextureImages:[],textureImages:[],shaders:null,shaderInputs:[],shaderOptions:[]},idAttribute:"materialID",getMaterialID:function(){return null!=this.id&&null!=this.id?this.id:this.get("tempMaterialID")},initialize:function(){this.set("tempMaterialID",Zakeke.generateUUID());var t=this;this.get("textureImages").parentModel=this,this.get("textureImages").url=function(){return t.url()+"/"+t.getMaterialID()+"/textures"},this.get("sourceTextureImages").parentModel=this,this.get("shaders")&&(this.get("shaders").parentModel=this),this.get("shaderInputs").parentModel=this,this.get("shaderOptions").parentModel=this},relations:[{type:Backbone.Many,key:"sourceTextureImages",collectionType:Zakeke.MaterialSourceTextureImages},{type:Backbone.Many,key:"textureImages",collectionType:Zakeke.MaterialTextureImages},{type:Backbone.One,key:"shaders",relatedModel:Zakeke.MaterialShader},{type:Backbone.Many,key:"shaderInputs",collectionType:Zakeke.MaterialShaderInputs},{type:Backbone.Many,key:"shaderOptions",collectionType:Zakeke.MaterialShaderOptions}],url:function(){var t=Zakeke.config.baseApiUrl+"materials";return null!=this.id&&null!=this.id&&(t=t+"/"+this.id),t},toString:function(){},getTexturesUrl:function(){return Zakeke.config.baseApiUrl+"materials/"+this.getMaterialID()+"/textures"},getClonedContentForSceneUrl:function(t){return Zakeke.config.baseApiUrl+"materials/"+this.getMaterialID()+"/clonedContentForScene/"+t},getShaderAttributeOptions:function(t){for(var e=[],i=0;i<this.get("shaderOptions").length;i++){var n=this.get("shaderOptions").at(i);n.get("shaderOptionTypeID")===t&&e.push(n.get("name"))}return e}}),Zakeke.Materials=Backbone.Collection.extend({model:Zakeke.Material,url:function(){return Zakeke.config.baseApiUrl+"materials"},getMaterial:function(t){for(var e=0;e<this.length;e++){var i=this.at(e);if(i.get("materialID")==t)return i}return null},comparator:function(t){return t.get("name")}}),(Zakeke=Zakeke||{}).cloudFlareApiUrl=function(){return"string"==typeof Zakeke.config.cloudFlareApiUrl&&null!==Zakeke.config.cloudFlareApiUrl&&""!==Zakeke.config.cloudFlareApiUrl.trim()?Zakeke.config.cloudFlareApiUrl:null},Zakeke.ComposerModels=Backbone.AssociatedModel.extend({defaults:{model:null,scene:null},idAttribute:"modelID",initialize:function(){},sceneIDSuccessfull:function(t,e,i,n){var r=n.sceneID,a=new MPlaza.Model;a.set("modelID",this.get("modelID")),this.set("model",a);var s=t.get("model").fetch({data:e.data}),o=new Zakeke.Scene;o.set("sceneID",r),t.set("scene",o);var l=t.get("scene").fetch({data:e.data});$.when(s,l).done(function(n){e.success&&e.success(t,n,e),t.trigger("sync",t,n,e),i.resolve()}).fail(function(){i.reject()})},getSceneID:function(t,e){var i=this,n=i.get("modelID"),r=!0,a=Zakeke.cloudFlareApiUrl(),s=Zakeke.config.baseApiUrl;null==e&&(e=$.Deferred()),null!==a&&r&&(s=a,r=!1);var o=s+"models/"+n+"/defaultSceneId";return null!=t&&(o+="?c="+t),$.get(o).then(function(t){e.resolve(t)},function(){!1===r?i.getSceneID(t,e):e.reject()}),e.promise()},fetch:function(t){t=t||{};var e=$.Deferred(),i=void 0!==t.data?t.data.c:void 0;return this.getSceneID(i).then(this.sceneIDSuccessfull.bind(this,this,t,e),function(){e.reject()}),e.promise()},relations:[{type:Backbone.One,key:"model",relatedModel:MPlaza.Model},{type:Backbone.One,key:"scene",relatedModel:Zakeke.Scene}]}),(Zakeke=Zakeke||{}).OptionSelection=Backbone.Model.extend({defaults:{optionID:-1,attributeID:-1,optionGuid:"",optionCode:"",name:"",selected:!1,enabled:!0},idAttribute:"optionID",initialize:function(){}}),Zakeke.OptionSelectionCollection=Backbone.Collection.extend({model:Zakeke.OptionSelection}),Zakeke.AttributeSelection=Backbone.Model.extend({idAttribute:"attributeID",initialize:function(){myDefaults={attributeID:-1,attributeGuid:"",attributeCode:"",attributeTypeID:MPlaza.AttributeType.Options,groupID:-1,name:"",enabled:!0,selectedValue:null,optionPreviewShapeID:MPlaza.AttributeOptionPreviewShape.Rectangle,options:new Zakeke.OptionSelectionCollection},this.set(myDefaults)},getOptionSelection:function(t){return this.get("options").findWhere({optionID:t})},getOptionSelectionByGuid:function(t){return this.get("options").findWhere({optionGuid:t})},getOptionSelectionsByName:function(t){for(var e=[],i=0;i<this.get("options").length;i++)this.get("options").at(i).get("name")==t&&e.push(this.get("options").at(i));return e},getOptionIDsByName:function(t){for(var e=[],i=0;i<this.get("options").length;i++)this.get("options").at(i).get("name")==t&&e.push(this.get("options").at(i).get("optionID"));return e},getSelectedOption:function(){return this.get("options").findWhere({selected:!0})},getUnselectedOptions:function(){return this.get("options").where({selected:!1})},getUnselectedEnabledOptions:function(){return this.get("options").where({selected:!1,enabled:!0})},getEnabledOptions:function(){return this.get("options").where({enabled:!0})}}),Zakeke.AttributeSelectionCollection=Backbone.Collection.extend({model:Zakeke.AttributeSelection}),Zakeke.TemplateCompositionSelection=Backbone.Model.extend({idAttribute:"compositionID",defaults:{compositionID:-1,name:"",previewImageUrl:""},initialize:function(){}}),Zakeke.TemplateCompositionSelectionCollection=Backbone.Collection.extend({model:Zakeke.TemplateCompositionSelection}),Zakeke.CategorySelection=Backbone.Model.extend({idAttribute:"categoryID",initialize:function(){myDefaults={categoryID:-1,name:"",composition:new Zakeke.TemplateCompositionSelectionCollection},this.set(myDefaults)}}),Zakeke.CategorySelectionCollection=Backbone.Collection.extend({model:Zakeke.CategorySelection}),Zakeke.MacroCategorySelection=Backbone.Model.extend({idAttribute:"macroCategoryID",initialize:function(){myDefaults={macroCategoryID:-1,name:"",category:new Zakeke.CategorySelectionCollection},this.set(myDefaults)}}),Zakeke.MacroCategorySelectionCollection=Backbone.Collection.extend({model:Zakeke.MacroCategorySelection}),Zakeke.TemplateGroupSelection=Backbone.Model.extend({idAttribute:"templateGroupID",initialize:function(){myDefaults={templateGroupID:-1,name:"",groupID:-1,stepID:-1,displayOrder:0,macrocategory:new Zakeke.MacroCategorySelectionCollection},this.set(myDefaults)}}),Zakeke.TemplateGroupSelectionCollection=Backbone.Collection.extend({model:Zakeke.TemplateGroupSelection}),Zakeke.AttributeGroupSelection=Backbone.Model.extend({idAttribute:"groupID",initialize:function(){myDefaults={groupID:-1,groupGuid:"",name:"",attributes:new Zakeke.AttributeSelectionCollection,templateGroups:new Zakeke.TemplateGroupSelectionCollection},this.set(myDefaults)},containsAttributeSelection:function(t){return!!this.get("attributes").findWhere({attributeID:t})},countEnabledAttributeSelections:function(){return this.get("attributes").where({enabled:!0}).length}}),Zakeke.AttributeGroupSelectionCollection=Backbone.Collection.extend({model:Zakeke.AttributeGroupSelection}),Zakeke.ComposerSelection=Backbone.Model.extend({initialize:function(){myDefaults={zkModel:null,groups:new Zakeke.AttributeGroupSelectionCollection,attributeDependencies:{},optionDependencies:{},suggestions:{},currentModelColorID:null},this.set(myDefaults)},buildDependencies:function(){var t=this.get("zkModel");if(t&&t instanceof MPlaza.Model)for(var e=0;e<t.get("attributes").length;e++){var i=t.get("attributes").at(e);if(h=i.get("constraintExpression"))for(var n=i.get("attributeGuid"),r=h.getAllAttributeGuids(),a=0;a<r.length;a++){var s=r[a];if(this.get("attributeDependencies").hasOwnProperty(s)){var o=this.get("attributeDependencies")[s];Zakeke.arrayContains(o,n)||o.push(n)}else this.get("attributeDependencies")[s]=[n]}for(var l=0;l<i.get("options").length;l++){var h,c=i.get("options").at(l);if(h=c.get("constraintExpression")){n=c.get("optionGuid"),r=h.getAllAttributeGuids();for(var u=0;u<r.length;u++){s=r[u];if(this.get("optionDependencies").hasOwnProperty(s)){o=this.get("optionDependencies")[s];Zakeke.arrayContains(o,n)||o.push(n)}else this.get("optionDependencies")[s]=[n]}}}}},checkAllConstraintExpressions:function(){var t=this.get("zkModel");if(t&&t instanceof MPlaza.Model){for(var e=this.getDependenceAwareAttributeSelections(),i=[],n=0;n<e.length;n++){var r=e[n],a=t.getAttribute(r.get("attributeID"));this.checkConstraintExpression(r);for(var s=0;s<r.get("options").length;s++){var o=r.get("options").at(s);a.getOption(o.get("optionID")).get("constraintExpression")&&i.push(o)}}for(n=0;n<i.length;n++){o=i[n];this.checkOptionConstraintExpression(o)}}},checkConstraintExpression:function(t){var e=this.get("zkModel");if(e&&e instanceof MPlaza.Model){var i=e.getAttribute(t.get("attributeID")).get("constraintExpression");if(i){var n=this.evaluateAttributeExpression(i);t.set("enabled",n)}}},checkDependentConstraintExpressions:function(t){var e=this.getAttributeSelection(t);if(e){var i=e.get("attributeGuid"),n=this.get("attributeDependencies");if(n.hasOwnProperty(i))for(var r=n[i],a=0;a<r.length;a++){var s=r[a],o=this.getAttributeSelectionByGuid(s);this.checkConstraintExpression(o)}var l=[],h=this.get("optionDependencies");if(h.hasOwnProperty(i))for(r=h[i],a=0;a<r.length;a++){s=r[a];var c=this.getOptionSelectionByGuid(s);this.checkOptionConstraintExpression(c);var u=c.get("attributeID");Zakeke.arrayContains(l,u)||l.push(u)}for(a=0;a<l.length;a++){var d=l[a];this.getAttributeSelection(d).getSelectedOption().get("enabled")||this.selectFirstEnabledOption(d)}}},checkOptionConstraintExpression:function(t){var e=this.get("zkModel");if(e&&e instanceof MPlaza.Model){var i=e.getOption(t.get("optionID")).get("constraintExpression");if(i){var n=this.evaluateAttributeExpression(i);t.set("enabled",n)}}},selectFirstEnabledOption:function(t){var e=this.getAttributeSelection(t);if(e){var i=e.getEnabledOptions(),n=null;i&&i.length>0&&(n=i[0]);var r=e.getSelectedOption();!n||null!=r&&r.get("optionID")==n.get("optionID")||(null!=r&&r.set("selected",!1),n.set("selected",!0))}},evaluateAttributeExpression:function(t){if(!(t&&t instanceof MPlaza.AttributeExpression))return!1;for(var e=t.get("op"),i=e==MPlaza.LogicalOperator.AND,n=0;n<t.get("propositions").length;n++){var r=t.get("propositions")[n],a=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}for(n=0;n<t.get("expressions").length;n++){var s=t.get("expressions")[n];a=this.evaluateChildAttributeExpression(s);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}return i},evaluateChildAttributeExpression:function(t){for(var e=t.op,i=e==MPlaza.LogicalOperator.AND,n=0;n<t.propositions.length;n++){var r=t.propositions[n],a=this.evaluateAttributeProposition(r);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}for(n=0;n<t.expressions.length;n++){var s=t.expressions[n];a=this.evaluateChildAttributeExpression(s);if(e==MPlaza.LogicalOperator.AND){if(!(i=i&&a))return!1}else if(i=i||a)return!0}return i},evaluateAttributeProposition:function(t){if(t&&t.hasOwnProperty("attributeGuid")&&t.hasOwnProperty("op")&&t.hasOwnProperty("value")){var e=t.attributeGuid,i=this.getAttributeSelectionByGuid(e);if(i&&i.get("enabled")){var n=i.get("selectedValue");if(i.get("attributeTypeID")==MPlaza.AttributeType.Options){var r=i.getSelectedOption();r&&(n=r.get("optionGuid"))}var a=!1;if(t.op==MPlaza.ComparisonOperator.Equal)a=n==t.value;else if(t.op==MPlaza.ComparisonOperator.NotEqual)a=n!=t.value;else if(t.op==MPlaza.ComparisonOperator.In||t.op==MPlaza.ComparisonOperator.NotIn){var s=t.value.split(";");a=t.op==MPlaza.ComparisonOperator.In?Zakeke.arrayContains(s,n):!Zakeke.arrayContains(s,n)}return a}}return!1},getAttributeGroupSelection:function(t){var e=this.get("zkModel");if(e){var i=e.get("attributes").findWhere({attributeID:t});if(i){var n=i.get("groupID");return this.get("groups").findWhere({groupID:n})}}return null},getAttributeSelection:function(t){var e=this.get("zkModel");if(e){var i=e.get("attributes").findWhere({attributeID:t});if(i){var n=i.get("groupID"),r=this.get("groups").findWhere({groupID:n});if(r)return r.get("attributes").findWhere({attributeID:t})}}return null},getAttributeSelectionByGuid:function(t){var e=this.get("zkModel");if(e){var i=e.get("attributes").findWhere({attributeGuid:t});if(i){var n=i.get("groupID"),r=this.get("groups").findWhere({groupID:n});if(r)return r.get("attributes").findWhere({attributeGuid:t})}}return null},getAttributeSelectionByOptionID:function(t){var e=this.getOptionSelection(t);if(e){var i=e.get("attributeID");return this.getAttributeSelection(i)}return null},getAllAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);t.push(r)}return t},getDependenceAwareAttributeSelections:function(){for(var t={},e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i].get("attributeGuid");t.hasOwnProperty(n)||(t[n]=0);for(var r=this.getFullDependencyChain(n),a=0;a<r.length;a++){var s=r[a];t.hasOwnProperty(s)?t[s]+=1:t[s]=1}}return e.sort(function(e,i){var n=t[e.get("attributeGuid")],r=t[i.get("attributeGuid")];return n<r?-1:n>r?1:0}),e},getFullDependencyChain:function(t){var e=this.get("attributeDependencies"),i=function(n,r){if(n===t||Zakeke.arrayContains(r,n)||r.push(n),e.hasOwnProperty(n))for(var a=e[n],s=0;s<a.length;s++)i(a[s],r)},n=[];if(e.hasOwnProperty(t)){n=e[t].slice(0);for(var r=0;r<n.length;r++)i(n[r],n)}return n},getAllAttributeIDs:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);t.push(r.get("attributeID"))}return t},getEnabledAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);r.get("enabled")&&t.push(r)}return t},getEnabledAttributeIDs:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);r.get("enabled")&&t.push(r.get("attributeID"))}return t},getDisabledAttributeSelections:function(){for(var t=[],e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++){var r=i.get("attributes").at(n);r.get("enabled")||t.push(r)}return t},getAttributeOptionSelection:function(t,e){var i=this.getAttributeSelection(t);return i?i.getOptionSelection(e):null},getOptionSelection:function(t){for(var e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++)for(var r=i.get("attributes").at(n),a=0;a<r.get("options").length;a++){var s=r.get("options").at(a);if(s.get("optionID")==t)return s}return null},getOptionSelectionByGuid:function(t){for(var e=0;e<this.get("groups").length;e++)for(var i=this.get("groups").at(e),n=0;n<i.get("attributes").length;n++)for(var r=i.get("attributes").at(n),a=0;a<r.get("options").length;a++){var s=r.get("options").at(a);if(s.get("optionGuid")==t)return s}return null},getAllAttributeTransformationScript:function(){for(var t=[],e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i];if(n.get("enabled")){var r=this.getAttributeTransformationScript(n.get("attributeID"));r&&t.push(r)}}return t},getAttributeTransformationScript:function(t){var e=null,i=this.getAttributeSelection(t);if(i&&i.get("enabled"))if(e={attributeID:t,selectedValue:"",actions:this.getAttributeSceneActions(t)},i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=i.getSelectedOption();n&&n.get("enabled")?e.selectedValue=n.get("optionID").toString():e=null}else e.selectedValue=i.get("selectedValue");return e},getAttributeSceneActions:function(t){var e=[],i=this.get("zkModel");if(i&&i instanceof MPlaza.Model){var n=i.getAttribute(t),r=this.getAttributeSelection(t),a=n.get("preActions").sortBy(function(t){return t.get("execOrder")});if(Array.prototype.push.apply(e,a),r&&n)if(r.get("attributeTypeID")==MPlaza.AttributeType.Options){var s=r.getSelectedOption();if(s){var o=n.get("options").findWhere({optionID:s.get("optionID")});if(o){var l=o.get("actions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,l)}}}else{var h=n.get("valueActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,h)}var c=n.get("postActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,c)}return e},getAttributeUnselectedOptionsSceneActions:function(t){var e=[],i=this.get("zkModel");if(i&&i instanceof MPlaza.Model){var n=i.getAttribute(t),r=this.getAttributeSelection(t),a=n.get("preActions").sortBy(function(t){return t.get("execOrder")});if(Array.prototype.push.apply(e,a),r&&n&&r.get("attributeTypeID")==MPlaza.AttributeType.Options)for(var s=r.getUnselectedEnabledOptions(),o=0;o<s.length;o++){var l=s[o],h=n.get("options").findWhere({optionID:l.get("optionID")});if(h){var c=h.get("actions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,c)}}var u=n.get("postActions").sortBy(function(t){return t.get("execOrder")});Array.prototype.push.apply(e,u)}return e},getAllAttributesUnselectedOptionsSceneActions:function(){for(var t=[],e=this.getEnabledAttributeSelections(),i=0;i<e.length;i++){var n=e[i],r=this.getAttributeUnselectedOptionsSceneActions(n.get("attributeID"));Array.prototype.push.apply(t,r)}return t},detachEvents:function(){for(var t=this.getAllAttributeSelections(),e=0;e<t.length;e++){var i=t[e];i.get("attributeID");i.off("change:selectedValue"),i.off("change:enabled");for(var n=0;n<i.get("options").length;n++){var r=i.get("options").at(n);r.get("optionID");r.off("change:selected"),r.off("change:enabled")}}},attachEvents:function(){for(var t=this,e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i];n.get("attributeID");n.on("change:selectedValue",function(){t.onAttributeSelectedValueChanged(this.get("attributeID"))}),n.on("change:enabled",function(){t.onAttributeEnablingChanged(this.get("attributeID"))});for(var r=0;r<n.get("options").length;r++){var a=n.get("options").at(r);a.get("optionID");a.on("change:selected",function(){t.onAttributeSelectedOptionChanged(this.get("attributeID"),this.get("optionID"))}),a.on("change:enabled",function(){t.onAttributeOptionEnablingChanged(this.get("attributeID"),this.get("optionID"))})}}},onAttributeSelectedValueChanged:function(t){var e=this.getAttributeSelection(t),i=this.getAttributeSceneActions(t),n={attributeID:t,selectedValue:e.get("selectedValue"),actions:i};this.trigger("attributeSelectionChanged",n),this.checkCurrentModelColor(),this.checkDependentConstraintExpressions(t)},onAttributeSelectedOptionChanged:function(t,e){this.getAttributeSelection(t);var i=this.getAttributeOptionSelection(t,e);if(i&&i.get("selected")){var n=this.getAttributeSceneActions(t),r={attributeID:t,selectedValue:e.toString(),actions:n};this.trigger("attributeSelectionChanged",r),this.checkCurrentModelColor(),this.checkDependentConstraintExpressions(t)}},onAttributeEnablingChanged:function(t){var e={attributeID:t},i=this.getAttributeSelection(t);if(i.get("enabled")?this.trigger("attributeEnabled",e):this.trigger("attributeDisabled",e),i.get("enabled")){i.get("selectedValue");if(i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=!1,r=this.getSuggestions(t);if(r){this.removeSuggestions(t);for(var a=0;a<r.length;a++){var s=r[a],o=i.getOptionSelection(s);if(o&&o.get("enabled")){n=!0,this.selectAttributeValue(t,s);break}}}if(!n){var l=i.getSelectedOption();l?this.onAttributeSelectedOptionChanged(t,l.get("optionID")):this.onAttributeSelectedValueChanged(t)}}}this.checkDependentConstraintExpressions(t)},onAttributeOptionEnablingChanged:function(t,e){var i=this.getAttributeOptionSelection(t,e),n={attributeID:t,optionID:e},r=!1,a=!1;i&&(r=i.get("enabled"),a=i.get("selected")),r?this.trigger("attributeOptionEnabled",n):this.trigger("attributeOptionDisabled",n),a&&r&&this.onAttributeSelectedOptionChanged(t,e),this.checkDependentConstraintExpressions(t)},selectAttributeOptionByGuid:function(t,e){var i=this.getAttributeSelectionByGuid(t);if(i&&i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=i.getOptionSelectionByGuid(e);n&&this._selectAttributeOption(i,n)}},selectAttributeValue:function(t,e){var i=this.getAttributeSelection(t);if(i)if(i.get("attributeTypeID")==MPlaza.AttributeType.Options){var n=-1;if(e&&!isNaN(e)){n=parseInt(e);var r=i.getOptionSelection(n);r&&this._selectAttributeOption(i,r)}}else i.set("selectedValue",e)},_selectAttributeOption:function(t,e){if(t&&e){-1!==t.get("attributeID")&&this.saveSuggestionsForSelectedOption(t.get("attributeID"),e.get("optionID"));var i=t.getSelectedOption();i&&i.set("selected",!1),e.set("selected",!0)}},checkCurrentModelColor:function(){var t=this.getModelColorIDForSelection(),e=null!=t&&null!=t,i=null!=this.currentModelColorID&&null!=this.currentModelColorID;if(e&&i&&t!=this.currentModelColorID||!e&&i||e&&!i){var n={colorID:t};this.trigger("modelColorChanged",n)}},saveSuggestionsForSelectedOption:function(t,e){this.get("suggestions")[t]=[e]},getSuggestions:function(t){return this.get("suggestions").hasOwnProperty(t)?this.get("suggestions")[t]:null},removeSuggestions:function(t){this.get("suggestions").hasOwnProperty(t)&&delete this.get("suggestions")[t]},setupOnComposition:function(t){var e=this.get("zkModel");if(e&&t&&e.get("modelID")==t.get("modelID")){this.detachEvents();for(var i=0;i<t.get("compositionItems").length;i++){var n=t.get("compositionItems").at(i),r=n.get("attributeID"),a=n.get("selectedValue");n.get("attributeTypeID")==MPlaza.AttributeType.Options&&null!=n.get("selectedOptionID")&&null!=n.get("selectedOptionID")&&(a=n.get("selectedOptionID")),this.selectAttributeValue(r,a)}this.buildDependencies(),this.checkAllConstraintExpressions(),this.attachEvents()}},buildComposition:function(){var t=new MPlaza.Composition;return this.updateComposition(t),t},updateComposition:function(t){var e=this.get("zkModel");t.set("modelID",e.get("modelID")),t.set("modelName",e.get("name")),t.set("modelPrice",e.get("price")),this.updateCompositionItems(t)},updateCompositionItems:function(t){for(var e=[],i=0;i<t.get("compositionItems").length;i++){var n=t.get("compositionItems").at(i);(a=this.getAttributeSelection(n.get("attributeID")))&&a.get("enabled")?this.updateCompositionItem(n,a):e.push(n)}var r=this.getEnabledAttributeSelections();for(i=0;i<r.length;i++){var a=r[i];(n=t.getCompositionItemByAttributeID(a.get("attributeID")))||(n=new MPlaza.CompositionItem,this.updateCompositionItem(n,a),t.get("compositionItems").push(n))}e.length>0&&t.get("compositionItems").remove(e)},updateCompositionItem:function(t,e){if(t.set("attributeID",e.get("attributeID")),t.set("attributeGuid",e.get("attributeGuid")),t.set("attributeTypeID",e.get("attributeTypeID")),t.set("attributeName",e.get("name")),t.set("attributeCode",e.get("attributeCode")),e.get("attributeTypeID")==MPlaza.AttributeType.Options){var i=e.getSelectedOption();i&&(t.set("selectedOptionID",i.get("optionID")),t.set("selectedOptionGuid",i.get("optionGuid")),t.set("selectedOptionCode",i.get("optionCode")),t.set("selectedOptionName",i.get("name")),t.set("selectedValue",null))}else{var n=e.get("selectedValue");t.set("selectedOptionID",null),t.set("selectedOptionGuid",null),t.set("selectedOptionCode",null),t.set("selectedValue",n)}},getModelColorIDForSelection:function(){if(this.get("zkModel")){var t=this.get("zkModel").get("attributeSelectionColors");if(t)for(var e=0;e<t.length;e++){var i=t[e],n=i.get("selectionExpression"),r=i.get("colorID");if(n&&this.evaluateAttributeExpression(n))return r}}return null},getCompositionBaseJSON:function(){for(var t={items:[]},e=this.getAllAttributeSelections(),i=0;i<e.length;i++){var n=e[i],r={code:n.get("attributeID"),value:""};if(n.get("enabled"))if(n.get("attributeTypeID")===MPlaza.AttributeType.Options){var a=n.getSelectedOption();a&&(r.value=a.get("optionID").toString())}else r.value=n.get("selectedValue");else r.value="disabled";t.items.push(r)}return JSON.stringify(t)},getCompositionHashCode:function(){var t=this.getCompositionBaseJSON();return CryptoJS.SHA1(t).toString()},refresh:function(){this.detachEvents(),this._resetProperties();var t=this.get("zkModel"),e=this;if(t&&t instanceof MPlaza.Model){var i=function(t,e){var i=new Zakeke.AttributeSelection;i.set("attributeID",t.get("attributeID")),i.set("attributeGuid",t.get("attributeGuid")),i.set("attributeCode",t.get("attributeCode")),i.set("attributeTypeID",t.get("attributeTypeID")),i.set("groupID",e.get("groupID")),i.set("name",t.get("name")),i.set("optionPreviewShapeID",t.get("optionPreviewShapeID")),e.get("attributes").add(i);var n=t.get("defaultValue");if(t.get("attributeTypeID")==MPlaza.AttributeType.Options){for(var r=t.get("options").sortBy(function(t){return t.get("displayOrder")}),a=null,s=0;s<r.length;s++){var o=r[s],l=o.get("isDefault")&&null==a,h=new Zakeke.OptionSelection;h.set("optionID",o.get("optionID")),h.set("optionGuid",o.get("optionGuid")),h.set("optionCode",o.get("optionCode")),h.set("attributeID",t.get("attributeID")),h.set("name",o.get("name")),h.set("selected",l),h.set("enabled",!0),l&&(a=h),i.get("options").add(h)}null==a&&i.get("options").length>0&&i.get("options").at(0).set("selected",!0)}else t.get("attributeTypeID")==MPlaza.AttributeType.Color?n?i.set("selectedValue",n):i.selectedValue="#ffffff":t.get("attributeTypeID")==MPlaza.AttributeType.Number?n&&!isNaN(n)?i.set("selectedValue",n):i.selectedValue=0:t.get("attributeTypeID")==MPlaza.AttributeType.Number&&(n?i.set("selectedValue",n):i.selectedValue="")};t.get("attributeGroups").sortBy(function(t){return t.get("displayOrder")}).forEach(function(n){var r=n.get("groupID"),a=new Zakeke.AttributeGroupSelection;a.set("groupID",n.get("groupID")),a.set("groupGuid",n.get("groupGuid")),a.set("name",n.get("name")),e.get("groups").add(a);for(var s=t.get("attributes").where({groupID:r}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")}),o=0;o<s.length;o++){var l=s[o];i(l,a)}});var n=t.getAttributesWithoutGroup();if(n.length>0){var r=new Zakeke.AttributeGroupSelection;r.set("groupID",-1),r.set("groupGuid",""),r.set("name","default"),e.get("groups").add(r);for(var a=0;a<n.length;a++){var s=n[a];i(s,r)}}}this.buildDependencies(),this.checkAllConstraintExpressions(),this.attachEvents()},_resetProperties:function(){this.set("groups",new Zakeke.AttributeGroupSelectionCollection),this.set("attributeDependencies",{}),this.set("optionDependencies",{}),this.set("suggestions",{}),this.set("currentModelColorID",null)}},{CreateComposerSelection:function(t){var e=new Zakeke.ComposerSelection;if(e.set("zkModel",t),t&&t instanceof MPlaza.Model){var i=function(t,e){var i=new Zakeke.AttributeSelection;i.set("attributeID",t.get("attributeID")),i.set("attributeGuid",t.get("attributeGuid")),i.set("attributeCode",t.get("attributeCode")),i.set("attributeTypeID",t.get("attributeTypeID")),i.set("groupID",e.get("groupID")),i.set("name",t.get("name")),i.set("optionPreviewShapeID",t.get("optionPreviewShapeID")),e.get("attributes").add(i);var n=t.get("defaultValue");if(t.get("attributeTypeID")==MPlaza.AttributeType.Options){for(var r=t.get("options").sortBy(function(t){return t.get("displayOrder")}),a=null,s=0;s<r.length;s++){var o=r[s],l=o.get("isDefault")&&null==a,h=new Zakeke.OptionSelection;h.set("optionID",o.get("optionID")),h.set("optionGuid",o.get("optionGuid")),h.set("optionCode",o.get("optionCode")),h.set("attributeID",t.get("attributeID")),h.set("name",o.get("name")),h.set("selected",l),h.set("enabled",!0),l&&(a=h),i.get("options").add(h)}null==a&&i.get("options").length>0&&i.get("options").at(0).set("selected",!0)}else t.get("attributeTypeID")==MPlaza.AttributeType.Color?n?i.set("selectedValue",n):i.selectedValue="#ffffff":t.get("attributeTypeID")==MPlaza.AttributeType.Number?n&&!isNaN(n)?i.set("selectedValue",n):i.selectedValue=0:t.get("attributeTypeID")==MPlaza.AttributeType.Number&&(n?i.set("selectedValue",n):i.selectedValue="")},n=function(t,e){var i=new Zakeke.TemplateGroupSelection;i.set("templateGroupID",t.get("templateGroupID")),i.set("name",t.get("name")),i.set("groupID",t.get("groupID")),i.set("stepID",t.get("stepID")),i.set("displayOrder",t.get("displayOrder")),e.get("templateGroups").add(i);for(var n=t.get("macrocategory"),r=0;r<n.length;r++){var a=n.at(r),s=new Zakeke.MacroCategorySelection;s.set("macroCategoryID",a.get("macroCategoryID")),s.set("name",a.get("name"));for(var o=a.get("category"),l=0;l<o.length;l++){var h=o.at(l),c=new Zakeke.CategorySelection;c.set("categoryID",h.get("categoryID")),c.set("name",h.get("name"));for(var u=h.get("composition"),d=0;d<u.length;d++){var f=u.at(d),g=new Zakeke.TemplateCompositionSelection;g.set("compositionID",f.get("compositionID")),g.set("name",f.get("name")),g.set("previewImageUrl",f.get("previewImageUrl")),c.get("composition").add(g)}s.get("category").add(c)}i.get("macrocategory").add(s)}};t.get("attributeGroups").sortBy(function(t){return t.get("displayOrder")}).forEach(function(r){var a=r.get("groupID"),s=new Zakeke.AttributeGroupSelection;s.set("groupID",r.get("groupID")),s.set("groupGuid",r.get("groupGuid")),s.set("name",r.get("name")),e.get("groups").add(s);for(var o=t.get("attributes").where({groupID:a}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")}),l=0;l<o.length;l++){var h=o[l];i(h,s)}var c=t.get("templateGroups").where({groupID:a}).sort(function(t,e){return t.get("displayOrder")-e.get("displayOrder")});for(l=0;l<c.length;l++){var u=c[l];n(u,s)}});var r=t.getAttributesWithoutGroup(),a=t.getTemplateGroupsWithoutGroup(),s=new Zakeke.AttributeGroupSelection;if(s.set("groupID",-1),s.set("groupGuid",""),s.set("name","default"),e.get("groups").add(s),r.length>0)for(var o=0;o<r.length;o++){var l=r[o];i(l,s)}if(a.length>0)for(o=0;o<a.length;o++){var h=a[o];n(h,s)}}return e.buildDependencies(),e.checkAllConstraintExpressions(),e.attachEvents(),e}}),BABYLON.Tmp=BABYLON.TmpColors;var Zakeke,_0xc101=["setPrototypeOf","__proto__","hasOwnProperty","constructor","prototype","create","length","getOwnPropertyDescriptor","object","decorate","function","defineProperty","Tools","Init","SetupCustomShaders","IncludesShadersStore","Effect","ShadersStore","DefinePBRMaterial","call","p7H5BeNo","Gs62Hcg4","a9ERn52W","Ex48Hyb7","Zn2m8STd","Xy5f3FMb","Nz52Qcg9","Ta63Acf7","Hp4m2BWf","Qs3b9W2T","o6GAc9s7","o6PJw98D","a2SBj8y3","Pn4m8W9E","n7D3EjXm","Gf4i3Y8S","o3JZj2y8","Yj98FwZn","w9C3Yen4","t7PWe2w6","j2WBy59Z","r6YWy23J","d5Q8Nsw9","Pa6s3WGq","j5AHb8g6","Qt36CfDy","Ec42CdYz","INSTANCES","b8W4Fyq9","Da9i4ZXt","Bs27JiWq","NUM_BONE_INFLUENCERS","BonesPerMesh","rebuild","_albedoColor","_reflectionColor","_specularColor","_glossiness","_ambientLight","_reflectivity","_microsurface","_aoPower","_rimColor","_rimPower","_rimBias","_aoExposure","_cameraContrast","_cameraExposure","_enableEnvCap","_useAOTextureAsLightmap","_useAlphaFromAlbedoTexture","_disableLighting","_maxSimultaneousLights","_renderTargets","_grayWeights","_lumCoeff","_renderMatrix","enableMatCap","apply","_markAllSubMeshesAsTexturesDirty","_markAllSubMeshesAsLightsDirty","enableEnvCap","_shouldUseAlphaFromAlbedoTexture","_albedoTexture","hasAlpha","_buildLightUniformLayout","_pbrUniformBuffer","getEngine","Qn65Tbq4","addUniform","Yp32BjTy","f3JFn69D","_prepareDefinesForLights","_lightSources","d2EKz65X","getTypeID","Go89WqCn","Tx62Nto7","Gf78Toj6","Xf36Cge2","Qr8j3M7B","Wn9y8EQr","Po32Jtb9","Hj6m7P5D","LINEARDEPTH","receiveShadows","shadowsEnabled","shadowEnabled","getShadowGenerator","DirectionalLight","getCaps","textureFloatRender","textureFloatLinearFiltering","textureHalfFloatRender","textureHalfFloatLinearFiltering","_prepareUniformsAndSamplersList","Gw84QdRo","t6M8KsPq","g2ASa4p9","z2J8Dek4","f6T5RbLa","Ja84RmPc","x9R4Dcn7","d8A9QxLe","Kd6a5DEk","push","i5PBq6d4","d3T8Meb7","Ez2g9L3K","q6E4ZmWa","_bindLightShadow","getTransformMatrix","setMatrix","getShadowMap","setTexture","","info","_bindLightProperties","PointLight","computeTransformedInformation","x","transformedPosition","y","z","updateFloat3","position","transformedDirection","direction","PBRMaterial: Attempt to bind light properties for an unhandled light type. PBR only supports Pointlight and DirectionalLight.","_bindLights","bindToEffect","intensity","Color3","Tmp","scaleToRef","diffuse","updateColor3","specular","update","_doNothing","getClassName","Zakeke.PBRMaterial","getRenderTargetTextures","reset","_reflectionTexture","isRenderTarget","needAlphaBlending","alpha","_opacityTexture","_opacityFresnelParameters","isEnabled","needAlphaTesting","getAlphaTestTexture","isReadyForSubMesh","isFrozen","_wasPreviouslyReady","effect","_materialDefines","getScene","checkReadyOnEveryCall","_renderId","getRenderId","_areLightsDirty","lightsEnabled","_needNormals","_areTexturesDirty","_needUVs","texturesEnabled","textureLOD","isReadyOrNotBlocking","standardDerivatives","_bumpTexture","_reflectivityTexture","_microsurfaceTexture","_parallaxReflectionCenter","_parallaxReflectionBBoxMin","_parallaxReflectionBBoxMax","getAlphaFromRGB","_aoTexture","_ambientTexture","_matCapReflectionTexture","_backFaceCulling","_areFresnelDirty","_areMiscDirty","_areAttributesDirty","_normals","_uvs","VertexBuffer","isVerticesDataPresent","useBones","computeBonesUsingShaders","numBoneInfluencers","bones","skeleton","markAsUnprocessed","isDirty","markAsProcessed","resetCachedMaterial","EffectFallbacks","MaterialHelper","PositionKind","zk_pbr","_cachedDefines","name","world","view","viewProjection","vEyePositionW","Lk8x5T3G","Ji23KzMd","Xo8q4A2R","Wr5i8R3S","Lj7q8H2K","Gr2p3S4T","q4A5Diy8","f8E2Wxc3","i5LEp3e8","Ez4g6PHc","t3GQn4m8","r8TLa3t5","f2THw8s5","n5J8Afy2","Lr45JbEi","c9F4XmDi","x4S6Ljt2","Dy84Brw6","Xm86Bye7","He9c4X2M","Em94Zxs7","j2N4DfKp","z9E8Dre3","o9EDt87H","Ew46Kes3","b4M3HcSi","Gk97Wqd5","Bt52Znx8","z9LGq35P","Ji6x8KYz","b6B9Wjf2","Ge69Pir7","mBones","Wq6t4DBe","g8G2Wfc4","z9C8Bsn3","g3BZx5e9","q6KWt97C","Hw43Jya6","Ei5b7ADy","Nz2n3DZs","Nd7m3WXn","Dg68CpMb","Fw64Rni2","m7MHk3b4","Material","Scene","onCompiled","onError","createEffect","setEffect","buildUniformLayout","isReady","_uniformBuffer","unbind","_activeEffect","bindForSubMesh","bindOnlyWorldMatrix","visibility","bindViewProjection","useUbo","isSync","toLuminance","leftColor","rightColor","bias","power","updateColor4","coordinatesIndex","level","updateFloat2","getTextureMatrix","updateMatrix","updateFloat","width","getSize","log","LOG2E","round","updateVector3","activeCamera","setVector3","bindView","dispose","getActiveTextures","hasTexture","clone","SerializationHelper","id","createPBRBlendMaterial","serialize","customType","Parse","albedoColor","serializeAsColor3","expandToProperty","reflectionColor","specularColor","glossiness","ambientLight","indirectLightPower","rimColor","rimBias","albedoTexture","serializeAsTexture","bumpTexture","reflectivityTexture","reflectivity","microsurfaceTexture","microsurface","reflectionTexture","parallaxReflectionCenter","serializeAsVector3","parallaxReflectionBBoxMin","parallaxReflectionBBoxMax","opacityTexture","aoTexture","AOTexture","aoPower","AOPower","aoExposure","AOExposure","matCapAmbientTexture","ambientTexture","matCapReflectionTexture","useAOTextureAsLightmap","useAlphaFromAlbedoTexture","opacityFresnelParameters","serializeAsFresnelParameters","_markAllSubMeshesAsFresnelDirty","rimPower","_markAllSubMeshesAsMiscDirty","cameraContrast","cameraExposure","disableLighting","maxSimultaneousLights","PBRMaterial","PBRMaterialDefines","DefineCustomMaterials","#ifdef Hp4m2BWf\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef Nz52Qcg9\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__zk_pbrFragment>\n\nconst float PI=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale = 0.1;\nconst float kRougnhessToAlphaOffset = 0.29248125;\nconst float kMinimumVariance = 0.0005;\nconst float fact_1=1.0;\nconst float fact_2=0.0;\n\n#ifdef p7H5BeNo\n#include<__decl__zk_pbrLightFragment>[0..maxSimultaneousLights]\n#endif\n\n#ifdef Ta63Acf7\nuniform sampler2D g3BZx5e9;\n#endif\n#ifdef Hp4m2BWf\nuniform sampler2D q6KWt97C;\n#endif\n#ifdef Qs3b9W2T\nuniform sampler2D Hw43Jya6;\n#endif\n#ifdef o6GAc9s7\nuniform sampler2D Ei5b7ADy;\n#endif\n#ifdef o6PJw98D\nuniform samplerCube Nd7m3WXn;\n#endif\n#ifdef Pn4m8W9E\nuniform sampler2D Fw64Rni2;\n#endif\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\nuniform sampler2D m7MHk3b4;\n#endif\n#ifdef t7PWe2w6\nuniform sampler2D Dg68CpMb;\n#endif\n#ifdef j2WBy59Z\nuniform sampler2D Nz2n3DZs;\n#endif\n\nconst float lf_1 = 1.0;\nconst float lf_2 = 0.0;\n\nuniform vec3 vEyePositionW;\nvarying vec3 vPositionW;\n\n#ifdef b8W4Fyq9\nvarying vec3 vNormalW;\n#endif\n#ifdef Ta63Acf7\nvarying vec2 j9F5Mmw7;\n#endif\n#ifdef Hp4m2BWf\nvarying vec2 Hg32Nkz6;\n#else\n#ifdef w9C3Yen4\nvarying vec2 a3X4SpHq;\n#endif\n#endif\n#ifdef Qs3b9W2T\nvarying vec2 Ho7e5M6N;\n#endif\n#ifdef o6GAc9s7\nvarying vec2 Bp4q3S8E;\n#endif\n#ifdef Pn4m8W9E\nvarying vec2 Zj26Aby4;\n#endif\n#ifdef Gf4i3Y8S\nvarying vec2 Za9r4XMn;\n#endif\n#ifdef Yj98FwZn\nvarying vec3 n9RMw7b2;\n#endif\n\n#include<zk_w8NZg34MyJx59GeB>\n#include<zk_g9X4Qdz2LJb67MyT>\n#include<zk_Ar2w4FRs58Jpc3W6>\n#include<zk_n8Q2Bzi9LXc5p6RG>\n\nvoid main(void)\n{\nvec3 finalColor=vec3(1.0,1.0,1.0);\nvec3 V=normalize(vEyePositionW-vPositionW);\nfloat alpha=Lk8x5T3G.a;\nvec3 albedoBlend=Lk8x5T3G.rgb;\n#ifdef Ta63Acf7\nvec4 albedoTextureColor=texture2D(g3BZx5e9,j9F5Mmw7);\n#ifdef Ec42CdYz\nif (albedoTextureColor.a<z9C8Bsn3[3][1]){discard;}\n#endif\n\n#ifdef r6YWy23J\nalpha*=albedoTextureColor.a;\n#endif\nalbedoBlend*=albedoTextureColor.rgb*Ji23KzMd.y;\n#endif\n\n#ifdef Pn4m8W9E\n#ifdef n7D3EjXm\nvec3 opColor = texture2D(Fw64Rni2,Zj26Aby4).rgb;\nfloat luminance=dot(Wq6t4DBe,opColor);\nalpha*=luminance*x4S6Ljt2.y;\n#else\nfloat opacity=texture2D(Fw64Rni2,Zj26Aby4).a;\nalpha*=opacity*x4S6Ljt2.y;\n#endif\n#endif\n\n#ifdef b8W4Fyq9\nvec3 N=normalize(vNormalW);\nfloat NdotV=dot(N,V);\n#ifdef Hp4m2BWf\nvec2 vv_1 = vec2(fact_1, fact_1);\nvec2 vv_2 = vec2(fact_2, fact_2);\nN=perturbNormal(V,vNormalW, vv_1, vv_2);\n#endif\n#else\n\nvec3 N=normalize(vec3(1.0));\n#endif\n\n#ifdef d5Q8Nsw9\nN=gl_FrontFacing ? N : -N;\n#endif\n\n#ifdef Pa6s3WGq\nfloat opacityFresnelTerm=clamp(pow(Ji6x8KYz.z+abs(NdotV),Ji6x8KYz.w),0.0,1.0);\nalpha+=Ji6x8KYz.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*Ji6x8KYz.y;\n#endif\n\nfloat reflectivityBlend=Gr2p3S4T;\n#ifdef Qs3b9W2T\nfloat reflectivityValue=texture2D(Hw43Jya6,Ho7e5M6N).r*q4A5Diy8.y;\nreflectivityBlend*=reflectivityValue;\n#endif\n\nvec3 specularBlend=b6B9Wjf2;\n#ifdef Qs3b9W2T\nspecularBlend*=reflectivityValue;\n#endif\n\nfloat microsurfaceBlend=i5LEp3e8;\n#ifdef o6GAc9s7\nmicrosurfaceBlend*=texture2D(Ei5b7ADy,Bp4q3S8E).r*Ez4g6PHc.y;\n#endif\n\n#if defined(j2WBy59Z) || defined(o6PJw98D)\n// Go mat -> ...\n#ifdef Nz52Qcg9\n// Adapt ...\nmicrosurfaceBlend=clamp(microsurfaceBlend,0.,1.)*0.98;\n// Compute ...\nfloat roughness=clamp(1.-microsurfaceBlend, 0.000001, 1.0);\nfloat alphaG=microsurfaceBlend*microsurfaceBlend+kMinimumVariance;\n//Beckamm roughness to Blinn exponent\nfloat maxMipLevel=Ge69Pir7;\nfloat lodReflection=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alphaG));\nlodReflection = clamp(lodReflection, 0., maxMipLevel);\n#else\nfloat biasReflection=(Ge69Pir7+2.0)*microsurfaceBlend;\n#endif\n#endif\n\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\nfloat AOShadowTexel=1.0;\n#ifdef Gf4i3Y8S\nvec3 AOValue=texture2D(m7MHk3b4,Za9r4XMn).rgb*He9c4X2M.y;\n#ifdef o3JZj2y8\nfloat aoGrayLevel=dot(g8G2Wfc4,AOValue);\nif (aoGrayLevel<Xm86Bye7){AOValue/=Xm86Bye7;}else{AOValue-=Xm86Bye7;AOValue/=1.0-Xm86Bye7;}\n#endif\nvec3 AOLightTexel=mix(vec3(1.0),AOValue,He9c4X2M.z);\n#endif\n#ifdef Yj98FwZn\nvec2 screenCoordinates=vec2(0.0);\nscreenCoordinates=n9RMw7b2.xy/n9RMw7b2.z/2.0+vec2(0.5);\nAOShadowTexel=mix(1.0,texture2D(m7MHk3b4,screenCoordinates).r,j2N4DfKp);\nfloat AOLightTexel=mix(1.0,texture2D(m7MHk3b4,screenCoordinates).g,j2N4DfKp);\n#endif\n#endif\n#ifdef w9C3Yen4\n#ifdef Hp4m2BWf\nvec2 a3X4SpHq=vec2(view*vec4(N,0.0))*0.5+vec2(0.5,0.5);\n#endif\nfinalColor=albedoBlend;\n#ifdef j2WBy59Z\n// For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n// For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\nfloat reflectance0=reflectivityBlend; // normal\nfloat reflectance90=clamp(reflectivityBlend*25.0,0.0,1.0); // grazing\nfloat schlick=reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-NdotV,0.,1.), 5.0);\n#ifdef Nz52Qcg9\nvec3 reflection=texture2DLodEXT(Nz2n3DZs,a3X4SpHq,lodReflection).rgb*r8TLa3t5*o9EDt87H;\n#else\nvec3 reflection=texture2D(Nz2n3DZs,a3X4SpHq,biasReflection).rgb*r8TLa3t5*o9EDt87H;\n#endif\nfinalColor*=1.0-schlick;\nfinalColor+=reflection*schlick;\n#endif\n#ifdef t7PWe2w6\nvec3 ambient=texture2D(Dg68CpMb,a3X4SpHq).rgb*z9E8Dre3;\nfloat albedoLevel=g8G2Wfc4.r*Lk8x5T3G.r+g8G2Wfc4.g*Lk8x5T3G.g+g8G2Wfc4.b*Lk8x5T3G.b;\nfloat lightExposure=mix(0.85,0.99,pow(albedoLevel,2.0));\nfloat ambientGreyLevel=g8G2Wfc4.r*ambient.r+g8G2Wfc4.g*ambient.g+g8G2Wfc4.b*ambient.b;\nif (ambientGreyLevel<lightExposure){finalColor*=ambient/lightExposure;}\nelse{\nambient-=lightExposure;ambient/=1.0-lightExposure;ambientGreyLevel-=lightExposure;ambientGreyLevel/=1.0-lightExposure;\nvec3 desatAmbient=mix(vec3(ambientGreyLevel),ambient,1.1-lightExposure);\nfinalColor+=desatAmbient*clamp(3.0*(1.0-lightExposure),0.0,1.0);\n}\n#endif\n#ifdef Gf4i3Y8S\nfinalColor*=AOLightTexel;\n#endif\n#ifdef Yj98FwZn\nfinalColor*=AOShadowTexel;\n#endif\n#else\n\n#ifdef o6PJw98D\nvec3 vReflectionUVW=2.0*NdotV*N-V; \n#ifdef a2SBj8y3\nvec3 firstPlaneIntersect=(c9F4XmDi-vPositionW)/vReflectionUVW;\nvec3 secondPlaneIntersect=(Lr45JbEi-vPositionW)/vReflectionUVW;\nvec3 furthestPlane=max(firstPlaneIntersect,secondPlaneIntersect);\nfloat distance=min(min(furthestPlane.x,furthestPlane.y),furthestPlane.z);\nvec3 intersectPositionW=vPositionW+vReflectionUVW*distance;\nvReflectionUVW=intersectPositionW-n5J8Afy2;\nvReflectionUVW.y=-vReflectionUVW.y;\n#endif\n#ifdef Nz52Qcg9\nvec3 environmentRadiance=textureCubeLodEXT(Nd7m3WXn,vReflectionUVW,lodReflection).rgb*r8TLa3t5*f2THw8s5;\n#else\nvec3 environmentRadiance=textureCube(Nd7m3WXn,vReflectionUVW,biasReflection).rgb*r8TLa3t5*f2THw8s5;\n#endif\n#endif\n\nvec3 directSpecularFactor=vec3(0.0);\nvec3 directDiffuseFactor=vec3(0.0);\n#ifdef p7H5BeNo\n#ifdef Gs62Hcg4\nfloat shadowTotal=1.0;\n#endif\n#include<zk_Dp84Pxj2MTr7q6FW>[0..maxSimultaneousLights]\n#endif\nvec3 finalDiffuse=albedoBlend;\nvec3 energy=vec3(0.0);\n#ifdef o6PJw98D\nfloat reflectionPower=clamp(reflectivityBlend*2.0-NdotV,0.0,1.0);\nenergy=vec3(reflectionPower);\n#endif\nenergy+=(directSpecularFactor*specularBlend).r;\nenergy=clamp(energy,0.0,1.0);\nfinalDiffuse*=vec3(1.0)-energy;\nfinalColor=finalDiffuse;\nvec3 finalSpecular=directSpecularFactor*specularBlend;\n#ifdef o6PJw98D\nfinalSpecular+=environmentRadiance*reflectionPower;\n#endif\nfinalColor+=finalSpecular;\nvec3 finalLighting=directDiffuseFactor;\n#if defined(Yj98FwZn) || defined(Gf4i3Y8S)\n#ifdef Gs62Hcg4\nfinalLighting+=z9LGq35P*mix(1.0,AOShadowTexel,1.0-shadowTotal);\n#else\nfinalLighting+=z9LGq35P;\n#endif\nfinalLighting*=AOLightTexel;\n#else\nfinalLighting+=z9LGq35P;\n#endif\n#ifdef Qt36CfDy\nfinalLighting=pow(finalLighting,vec3(Gk97Wqd5.x));\nfinalLighting+=Gk97Wqd5.y-1.0;\nfinalLighting=clamp(finalLighting,0.0,2.0);\n#endif\n#ifdef o3JZj2y8\nif (aoGrayLevel<Xm86Bye7){finalColor*=finalLighting;}\nelse {finalColor+=finalLighting*clamp(3.0*(1.0-Xm86Bye7),0.0,1.0);}\n#else\nfinalColor*=finalLighting;\n#endif\n#endif\n\n#ifdef j5AHb8g6\nfloat rimPower=b4M3HcSi.x;\nfloat rimBias=b4M3HcSi.y;\nfloat rimFactor=clamp(rimBias*2.0-NdotV,0.0,1.0);\n#ifdef Qs3b9W2T\nrimFactor*=reflectivityValue;\n#endif\nfinalColor+=Ew46Kes3*rimFactor*rimPower;\n#endif\n\ngl_FragColor=vec4(vec3(finalColor),alpha);\n}","precision highp float;\n#include<__decl__zk_pbrVertex>\n\nattribute vec3 position;\n#ifdef b8W4Fyq9\nattribute vec3 normal;\n#endif\n#ifdef Da9i4ZXt\nattribute vec2 uv;\n#endif\n#ifdef Bs27JiWq\nattribute vec2 uv2;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n\n#ifdef p7H5BeNo\n#include<__decl__zk_pbrLightFragment>[0..maxSimultaneousLights]\n#endif\n\nvarying vec3 vPositionW;\n#ifdef b8W4Fyq9\nvarying vec3 vNormalW;\n#endif\n#ifdef Ta63Acf7\nvarying vec2 j9F5Mmw7;\n#endif\n#ifdef Hp4m2BWf\nvarying vec2 Hg32Nkz6;\n#else\n#ifdef w9C3Yen4\nvarying vec2 a3X4SpHq;\n#endif\n#endif\n#ifdef Qs3b9W2T\nvarying vec2 Ho7e5M6N;\n#endif\n#ifdef o6GAc9s7\nvarying vec2 Bp4q3S8E;\n#endif\n#ifdef Pn4m8W9E\nvarying vec2 Zj26Aby4;\n#endif\n#ifdef Gf4i3Y8S\nvarying vec2 Za9r4XMn;\n#endif\n#ifdef Yj98FwZn\nvarying vec3 n9RMw7b2;\n#endif\n\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef b8W4Fyq9\nvec3 normalUpdated=normal;\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPosition=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=worldPosition.xyz;\nvec4 finalPosition=viewProjection*worldPosition;\n#ifdef Yj98FwZn\nn9RMw7b2=finalPosition.xyw;\n#endif\ngl_Position=finalPosition;\n#ifdef b8W4Fyq9\nvec4 worldNormal=finalWorld*vec4(normalUpdated,0.0);\nvNormalW=normalize(worldNormal.xyz);\n#endif\n\n#ifndef Da9i4ZXt\nvec2 uv=vec2(0.0,0.0);\n#endif\n#ifndef Bs27JiWq\nvec2 uv2=vec2(0.0,0.0);\n#endif\n#ifdef Ta63Acf7\nif (Ji23KzMd.x == 0.0)\n{\nj9F5Mmw7=vec2(Xo8q4A2R*vec4(uv,1.0,0.0));\n}\nelse\n{\nj9F5Mmw7=vec2(Xo8q4A2R*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Hp4m2BWf\nif (Wr5i8R3S.x == 0.0)\n{\nHg32Nkz6=vec2(Lj7q8H2K*vec4(uv,1.0,0.0));\n}\nelse\n{\nHg32Nkz6=vec2(Lj7q8H2K*vec4(uv2,1.0,0.0));\n}\n#else\n#ifdef w9C3Yen4\na3X4SpHq=vec2(view*vec4(vNormalW,0.0))*0.5+vec2(0.5,0.5);\n#endif\n#endif\n#ifdef Qs3b9W2T\nif (q4A5Diy8.x == 0.0)\n{\nHo7e5M6N=vec2(f8E2Wxc3*vec4(uv,1.0,0.0));\n}\nelse\n{\nHo7e5M6N=vec2(f8E2Wxc3*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef o6GAc9s7\nif (Ez4g6PHc.x == 0.0)\n{\nBp4q3S8E=vec2(t3GQn4m8*vec4(uv,1.0,0.0));\n}\nelse\n{\nBp4q3S8E=vec2(t3GQn4m8*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Pn4m8W9E\nif (x4S6Ljt2.x == 0.0)\n{\nZj26Aby4=vec2(Dy84Brw6*vec4(uv,1.0,0.0));\n}\nelse\n{\nZj26Aby4=vec2(Dy84Brw6*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef Gf4i3Y8S\nif (He9c4X2M.x == 0.0)\n{\nZa9r4XMn=vec2(Em94Zxs7*vec4(uv,1.0,0.0));\n}\nelse\n{\nZa9r4XMn=vec2(Em94Zxs7*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#ifdef Gs62Hcg4\n#include<zk_Gi39AdTg7y5B2JfL>[0..maxSimultaneousLights]\n#endif\n}","#ifdef Hp4m2BWf\nmat3 cotangent_frame(vec3 norm,vec3 poss,vec2 uvmapping, float coeff_1, float coeff_2)\n{\nvec3 dp1=coeff_1*dFdx(poss);\nvec3 dp2=coeff_1*dFdy(poss);\nvec2 duv1=dFdx(uvmapping)+vec2(coeff_2, coeff_2);\nvec2 duv2=dFdy(uvmapping)+vec2(coeff_2, coeff_2);\nvec3 dp2perp=cross(dp2,norm);\nvec3 dp1perp=cross(norm,dp1);\nvec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\nfloat invmax=inversesqrt(max(dot(T,T),dot(B,B)));\nreturn mat3(T * invmax, B * invmax, norm);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 vNormalW, vec2 vv1, vec2 vv2)\n{\nvec3 map=texture2D(q6KWt97C,Hg32Nkz6).xyz*Wr5i8R3S.y;\nmap = (map*(255.0/127.0))-(128.0/127.0);\nmat3 TBN=cotangent_frame(vNormalW,viewDir,Hg32Nkz6, vv1.x, vv2.y);\nreturn normalize(TBN*map);\n}\n#endif","#if defined(w9C3Yen4) && defined(Hp4m2BWf)\nuniform mat4 view;\n#endif\nuniform vec4 Lk8x5T3G;\nuniform vec3 r8TLa3t5;\nuniform vec3 b6B9Wjf2;\nuniform float Gr2p3S4T;\nuniform float i5LEp3e8;\nuniform float Bt52Znx8;\nuniform float z9LGq35P;\n\n#ifdef Ta63Acf7\nuniform vec2 Ji23KzMd;\n#endif\n#ifdef Hp4m2BWf\nuniform vec2 Wr5i8R3S;\n#endif\n#ifdef o6GAc9s7\nuniform vec2 Ez4g6PHc;\n#endif\n#ifdef o6PJw98D\nuniform float f2THw8s5;\nuniform float Ge69Pir7;\n#ifdef a2SBj8y3\nuniform vec3 n5J8Afy2;\nuniform vec3 Lr45JbEi;\nuniform vec3 c9F4XmDi;\n#endif\n#endif\n#ifdef Qs3b9W2T\nuniform vec2 q4A5Diy8;\n#endif\n#ifdef Gf4i3Y8S\nuniform vec3 He9c4X2M;\n#ifdef o3JZj2y8\nuniform float Xm86Bye7;\n#endif\n#endif\n#ifdef Yj98FwZn\nuniform float j2N4DfKp;\n#endif\n#ifdef t7PWe2w6\nuniform float z9E8Dre3;\n#endif\n#ifdef j2WBy59Z\nuniform float o9EDt87H;\nuniform float Ge69Pir7;\n#endif\n#ifdef Pn4m8W9E\nuniform vec2 x4S6Ljt2;\n#endif\n\n#ifdef Pa6s3WGq\nuniform vec4 Ji6x8KYz;\n#endif\n\nuniform vec3 Wq6t4DBe;\nuniform vec3 g8G2Wfc4;\nuniform mat4 z9C8Bsn3;\n\n#ifdef j5AHb8g6\nuniform vec3 Ew46Kes3;\nuniform vec2 b4M3HcSi;\n#endif\n#ifdef Qt36CfDy\nuniform vec2 Gk97Wqd5;\n#endif\n","#ifdef d2EKz65X{X}\nuniform vec3 Qn65Tbq4{X};\nuniform vec3 Yp32BjTy{X};\nuniform vec3 f3JFn69D{X};\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\nuniform float z2J8Dek4{X};\n#ifdef Wn9y8EQr{X}\nuniform mat4 t6M8KsPq{X};\nuniform samplerCube q6E4ZmWa{X};\nuniform vec2 g2ASa4p9{X};\nvarying vec3 q2ENg8n9{X};\n#else\nuniform mat4 Gw84QdRo{X};\nuniform sampler2D q6E4ZmWa{X};\nvarying vec4 a3WFm87R{X};\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n\n#else\nuniform sampler2D d3T8Meb7{X};\nuniform sampler2D q6E4ZmWa{X};\n#ifndef Po32Jtb9{X}\nuniform sampler2D Ez2g9L3K{X};\n#endif\n#endif\nuniform mat4 Gw84QdRo{X};\nuniform mat4 t6M8KsPq{X};\nuniform vec2 g2ASa4p9{X};\nuniform vec2 x9R4Dcn7{X};\nuniform vec2 d8A9QxLe{X};\nuniform float Ja84RmPc{X};\nuniform float f6T5RbLa{X};\nuniform float z2J8Dek4{X};\nvarying vec4 a3WFm87R{X};\nvarying vec3 q2ENg8n9{X};\n#else\n#ifdef Tx62Nto7{X}\nuniform sampler2D d3T8Meb7{X};\nuniform mat4 Kd6a5DEk{X};\nvarying vec4 a3WFm87R{X};\nvarying float q8NLm2b4{X};\n#endif\n#endif\n#endif\n#endif\n#endif\n","#ifdef p7H5BeNo\nstruct lightingInfo {\nvec3 diffuse;\nvec3 specular;\n};\nlightingInfo getPointLighting(vec3 worldPosition,vec3 lightPosition,vec3 N,vec3 V,vec3 lightDiffuse,vec3 lightSpecular,float Bt52Znx8, float plight1, float plight2)\n{\nlightingInfo result;\nvec3 lightDir=lightPosition-worldPosition;\nvec3 L=normalize(lightDir);\nfloat distance=length(lightDir);\nfloat lightAttenuation=sqrt(1.0/distance + (plight1*plight2));\nvec3 diffuse=vec3(0.0);\nfloat NdotL = dot(N,L);\nfloat lightPower=clamp(NdotL, 0.0, 1.0);\ndiffuse=lightPower*lightPower*lightAttenuation*lightDiffuse;\nresult.diffuse=diffuse;\nvec3 specular=vec3(0.0);\nvec3 H=normalize(V+L);\nfloat NdotH=max(dot(N,H),0.0);\nspecular=(pow(NdotH,max(1.0 ,Bt52Znx8))*2.0)*lightAttenuation*lightSpecular;\nresult.specular=specular;\nreturn result;\n}\nlightingInfo getDirectionalLighting(vec3 lightDir,vec3 N,vec3 V,vec3 lightDiffuse,vec3 lightSpecular,float Bt52Znx8, float dlight1, float dlight2)\n{\nlightingInfo result;\nvec3 L=normalize(lightDir);\nvec3 diffuse=vec3(0.0);\nfloat NdotL = dot(N,L);\nfloat lightPower=clamp(NdotL, 0.0, 1.0);\ndiffuse=(lightPower*lightDiffuse)+(dlight1*dlight2);\nresult.diffuse=diffuse;\nvec3 specular=vec3(0.0);\nvec3 H=normalize(V+L);\nfloat NdotH=max(dot(N,H),0.0);\nspecular=(pow(NdotH,max(1.0 ,Bt52Znx8))*2.0)*lightSpecular;\nresult.specular=specular;\nreturn result;\n}\n#endif\n","#ifdef d2EKz65X{X}\nfloat coef_dynb_3{X}=1.0;\n#ifdef Tx62Nto7{X}\nvec3 L{X}=normalize(-light{X}.Qn65Tbq4);\n#else\nvec3 L{X}=normalize(light{X}.Qn65Tbq4-vPositionW);\n#endif\nvec3 H{X}=normalize(V+L{X});\n#ifdef Go89WqCn{X}\nlightingInfo Qb46TxBo{X}=getPointLighting(vPositionW,light{X}.Qn65Tbq4,N,V,light{X}.Yp32BjTy,light{X}.f3JFn69D,Bt52Znx8,lf_1,lf_2);\n#else\n#ifdef Tx62Nto7{X}\nlightingInfo Qb46TxBo{X}=getDirectionalLighting(L{X},N,V,light{X}.Yp32BjTy,light{X}.f3JFn69D,Bt52Znx8,lf_1,lf_2);\n#else\nlightingInfo Qb46TxBo{X};\nQb46TxBo{X}.diffuse=vec3(0.0);\nQb46TxBo{X}.specular=vec3(0.0);\n#endif\n#endif\n#ifdef Gf78Toj6{X}\nfloat shadow{X}=1.0;\nfloat coef_dynb_2{X}=0.0;\nfloat dynamicBias{X}=computeDynamicBias(z2J8Dek4{X},shadow{X},coef_dynb_2{X},coef_dynb_3{X},N,L{X});\n#ifdef Hj6m7P5D{X}\nfloat outsideLuminance{X}=0.0;\n#else\nfloat outsideLuminance{X}=1.0;\n#endif\nfloat depth{X};\n#ifdef LINEARDEPTH{X}\n\ndepth{X}=length(vPositionW-light{X}.Qn65Tbq4);\ndepth{X}=(depth{X}-g2ASa4p9{X}.x)/(g2ASa4p9{X}.y-g2ASa4p9{X}.x);\n#else\ndepth{X}=0.5*(a3WFm87R{X}.z/a3WFm87R{X}.w)+0.5;\n#endif\n#ifdef Xf36Cge2{X}\n#ifdef Wn9y8EQr{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadowFromPrecomputedPCSS_FFCube(light{X}.Qn65Tbq4,q6E4ZmWa{X},-L{X},g2ASa4p9{X},dynamicBias{X});\n\n#else\nshadow{X}=0.0;\n\n#endif\n#else\nvec2 uv{X}=a3WFm87R{X}.xy/a3WFm87R{X}.w;\nuv{X}=0.5*uv{X}+vec2(0.5);\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadowFromPrecomputedPCSS(depth{X},uv{X},\nq6E4ZmWa{X},\ndynamicBias{X},\noutsideLuminance{X},\ntrue);\n#else\nshadow{X}=getShadowFromPrecomputedPCSS(depth{X},uv{X},\nq6E4ZmWa{X},\ndynamicBias{X},\noutsideLuminance{X},\nfalse);\n#endif\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=0.0;\n\n#else\nshadow{X}=0.0;\n\n#endif\n#else\nvec2 uv{X}=a3WFm87R{X}.xy/a3WFm87R{X}.w;\nuv{X}=0.5*uv{X}+vec2(0.5);\n#ifdef Po32Jtb9{X}\nshadow{X}=getShadow(f6T5RbLa{X},\ndepth{X},uv{X},q2ENg8n9{X},\nx9R4Dcn7{X},d8A9QxLe{X},g2ASa4p9{X},Ja84RmPc{X},\nd3T8Meb7{X},d3T8Meb7{X},q6E4ZmWa{X},\ndynamicBias{X},outsideLuminance{X},\ntrue);\n#else\nshadow{X}=getShadow(f6T5RbLa{X},\ndepth{X},uv{X},q2ENg8n9{X},\nx9R4Dcn7{X},d8A9QxLe{X},g2ASa4p9{X},Ja84RmPc{X},\nd3T8Meb7{X},Ez2g9L3K{X},q6E4ZmWa{X},\ndynamicBias{X},outsideLuminance{X},\nfalse);\n#endif\n#endif\n#else\n#ifdef Tx62Nto7{X}\n#ifdef Po32Jtb9{X}\nshadow{X}=computeShadow(a3WFm87R{X},\nq8NLm2b4{X},\nd3T8Meb7{X},dynamicBias{X},true);\n#else\nshadow{X}=computeShadow(a3WFm87R{X},\nq8NLm2b4{X},\nd3T8Meb7{X},dynamicBias{X},false);\n#endif\n#endif\n#endif\n#endif\nQb46TxBo{X}.diffuse*=shadow{X};\nQb46TxBo{X}.specular*=shadow{X};\nshadowTotal*=shadow{X};\n#endif\ndirectDiffuseFactor+=Qb46TxBo{X}.diffuse;\ndirectSpecularFactor+=Qb46TxBo{X}.specular;\n#endif\n","#ifdef d2EKz65X{X}\nuniform i5PBq6d4{X}\n{\nvec3 Qn65Tbq4;\nvec3 Yp32BjTy;\nvec3 f3JFn69D;\n} light{X};\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\nuniform float z2J8Dek4{X};\n#ifdef Wn9y8EQr{X}\nuniform mat4 t6M8KsPq{X};\nuniform samplerCube q6E4ZmWa{X};\nuniform vec2 g2ASa4p9{X};\nvarying vec3 q2ENg8n9{X};\n#else\nuniform sampler2D q6E4ZmWa{X};\nuniform mat4 Gw84QdRo{X};\nvarying vec4 a3WFm87R{X};\n#endif\n#else\n#ifdef Qr8j3M7B{X}\n#ifdef Wn9y8EQr{X}\n\n\n\n\n\n\n#else\nuniform sampler2D d3T8Meb7{X};\nuniform sampler2D q6E4ZmWa{X};\n#ifndef Po32Jtb9{X}\nuniform sampler2D Ez2g9L3K{X};\n#endif\n#endif\nuniform mat4 Gw84QdRo{X};\nuniform mat4 t6M8KsPq{X};\nuniform vec2 g2ASa4p9{X};\nuniform vec2 x9R4Dcn7{X};\nuniform vec2 d8A9QxLe{X};\nuniform float Ja84RmPc{X};\nuniform float f6T5RbLa{X};\nuniform float z2J8Dek4{X};\nvarying vec4 a3WFm87R{X};\nvarying vec3 q2ENg8n9{X};\n#else\n#ifdef Tx62Nto7{X}\nuniform sampler2D d3T8Meb7{X};\nuniform mat4 Kd6a5DEk{X};\nvarying vec4 a3WFm87R{X};\nvarying float q8NLm2b4{X};\n#endif\n#endif\n#endif\n#endif\n#endif\n","#ifdef Gs62Hcg4\n\n#if defined(a9ERn52W)\nconst int poissonDiskSize=4;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.94201624,-0.39906216 );\npoissonDisk[1]=vec2(0.94558609,-0.76890725 );\npoissonDisk[2]=vec2(-0.094184101,-0.92938870 );\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#elif defined(Ex48Hyb7)\nconst int poissonDiskSize=16;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.94201624,-0.39906216 );\npoissonDisk[1]=vec2(0.94558609,-0.76890725 );\npoissonDisk[2]=vec2(-0.094184101,-0.92938870 );\npoissonDisk[3]=vec2(0.34495938,0.29387760 );\npoissonDisk[4]=vec2(-0.91588581,0.45771432 );\npoissonDisk[5]=vec2(-0.81544232,-0.87912464 );\npoissonDisk[6]=vec2(-0.38277543,0.27676845 );\npoissonDisk[7]=vec2(0.97484398,0.75648379 );\npoissonDisk[8]=vec2(0.44323325,-0.97511554 );\npoissonDisk[9]=vec2(0.53742981,-0.47373420 );\npoissonDisk[10]=vec2(-0.26496911,-0.41893023 );\npoissonDisk[11]=vec2(0.79197514,0.19090188 );\npoissonDisk[12]=vec2(-0.24188840,0.99706507 );\npoissonDisk[13]=vec2(-0.81409955,0.91437590 );\npoissonDisk[14]=vec2(0.19984126,0.78641367 );\npoissonDisk[15]=vec2(0.14383161,-0.14100790 );\n\n#elif defined(Zn2m8STd) \nconst int poissonDiskSize=25;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.978698,-0.0884121);\npoissonDisk[1]=vec2(-0.841121,0.521165);\npoissonDisk[2]=vec2(-0.71746,-0.50322);\npoissonDisk[3]=vec2(-0.702933,0.903134);\npoissonDisk[4]=vec2(-0.663198,0.15482);\npoissonDisk[5]=vec2(-0.495102,-0.232887);\npoissonDisk[6]=vec2(-0.364238,-0.961791);\npoissonDisk[7]=vec2(-0.345866,-0.564379);\npoissonDisk[8]=vec2(-0.325663,0.64037);\npoissonDisk[9]=vec2(-0.182714,0.321329);\npoissonDisk[10]=vec2(-0.142613,-0.0227363);\npoissonDisk[11]=vec2(-0.0564287,-0.36729);\npoissonDisk[12]=vec2(-0.0185858,0.918882);\npoissonDisk[13]=vec2(0.0381787,-0.728996);\npoissonDisk[14]=vec2(0.16599,0.093112);\npoissonDisk[15]=vec2(0.253639,0.719535);\npoissonDisk[16]=vec2(0.369549,-0.655019);\npoissonDisk[17]=vec2(0.423627,0.429975);\npoissonDisk[18]=vec2(0.530747,-0.364971);\npoissonDisk[19]=vec2(0.566027,-0.940489);\npoissonDisk[20]=vec2(0.639332,0.0284127);\npoissonDisk[21]=vec2(0.652089,0.669668);\npoissonDisk[22]=vec2(0.773797,0.345012);\npoissonDisk[23]=vec2(0.968871,0.840449);\npoissonDisk[24]=vec2(0.991882,-0.657338);\n\n#elif defined(Xy5f3FMb)\nconst int poissonDiskSize=64;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0] = vec2(-0.613392, 0.617481);\npoissonDisk[1] = vec2(0.170019, -0.040254);\npoissonDisk[2] = vec2(-0.299417, 0.791925);\npoissonDisk[3] = vec2(0.645680, 0.493210);\npoissonDisk[4] = vec2(-0.651784, 0.717887);\npoissonDisk[5] = vec2(0.421003, 0.027070);\npoissonDisk[6] = vec2(-0.817194, -0.271096);\npoissonDisk[7] = vec2(-0.705374, -0.668203);\npoissonDisk[8] = vec2(0.977050, -0.108615);\npoissonDisk[9] = vec2(0.063326, 0.142369);\npoissonDisk[10] = vec2(0.203528, 0.214331);\npoissonDisk[11] = vec2(-0.667531, 0.326090);\npoissonDisk[12] = vec2(-0.098422, -0.295755);\npoissonDisk[13] = vec2(-0.885922, 0.215369);\npoissonDisk[14] = vec2(0.566637, 0.605213);\npoissonDisk[15] = vec2(0.039766, -0.396100);\npoissonDisk[16] = vec2(0.751946, 0.453352);\npoissonDisk[17] = vec2(0.078707, -0.715323);\npoissonDisk[18] = vec2(-0.075838, -0.529344);\npoissonDisk[19] = vec2(0.724479, -0.580798);\npoissonDisk[20] = vec2(0.222999, -0.215125);\npoissonDisk[21] = vec2(-0.467574, -0.405438);\npoissonDisk[22] = vec2(-0.248268, -0.814753);\npoissonDisk[23] = vec2(0.354411, -0.887570);\npoissonDisk[24] = vec2(0.175817, 0.382366);\npoissonDisk[25] = vec2(0.487472, -0.063082);\npoissonDisk[26] = vec2(-0.084078, 0.898312);\npoissonDisk[27] = vec2(0.488876, -0.783441);\npoissonDisk[28] = vec2(0.470016, 0.217933);\npoissonDisk[29] = vec2(-0.696890, -0.549791);\npoissonDisk[30] = vec2(-0.149693, 0.605762);\npoissonDisk[31] = vec2(0.034211, 0.979980);\npoissonDisk[32] = vec2(0.503098, -0.308878);\npoissonDisk[33] = vec2(-0.016205, -0.872921);\npoissonDisk[34] = vec2(0.385784, -0.393902);\npoissonDisk[35] = vec2(-0.146886, -0.859249);\npoissonDisk[36] = vec2(0.643361, 0.164098);\npoissonDisk[37] = vec2(0.634388, -0.049471);\npoissonDisk[38] = vec2(-0.688894, 0.007843);\npoissonDisk[39] = vec2(0.464034, -0.188818);\npoissonDisk[40] = vec2(-0.440840, 0.137486);\npoissonDisk[41] = vec2(0.364483, 0.511704);\npoissonDisk[42] = vec2(0.034028, 0.325968);\npoissonDisk[43] = vec2(0.099094, -0.308023);\npoissonDisk[44] = vec2(0.693960, -0.366253);\npoissonDisk[45] = vec2(0.678884, -0.204688);\npoissonDisk[46] = vec2(0.001801, 0.780328);\npoissonDisk[47] = vec2(0.145177, -0.898984);\npoissonDisk[48] = vec2(0.062655, -0.611866);\npoissonDisk[49] = vec2(0.315226, -0.604297);\npoissonDisk[50] = vec2(-0.780145, 0.486251);\npoissonDisk[51] = vec2(-0.371868, 0.882138);\npoissonDisk[52] = vec2(0.200476, 0.494430);\npoissonDisk[53] = vec2(-0.494552, -0.711051);\npoissonDisk[54] = vec2(0.612476, 0.705252);\npoissonDisk[55] = vec2(-0.578845, -0.768792);\npoissonDisk[56] = vec2(-0.772454, -0.090976);\npoissonDisk[57] = vec2(0.504440, 0.372295);\npoissonDisk[58] = vec2(0.155736, 0.065157);\npoissonDisk[59] = vec2(0.391522, 0.849605);\npoissonDisk[60] = vec2(-0.620106, -0.328104);\npoissonDisk[61] = vec2(0.789239, -0.419965);\npoissonDisk[62] = vec2(-0.545396, 0.538133);\npoissonDisk[63] = vec2(-0.178564, -0.596057);\n#else\n\nconst int poissonDiskSize=25;\nvec2 poissonDisk[poissonDiskSize];\n\npoissonDisk[0]=vec2(-0.978698,-0.0884121);\npoissonDisk[1]=vec2(-0.841121,0.521165);\npoissonDisk[2]=vec2(-0.71746,-0.50322);\npoissonDisk[3]=vec2(-0.702933,0.903134);\npoissonDisk[4]=vec2(-0.663198,0.15482);\npoissonDisk[5]=vec2(-0.495102,-0.232887);\npoissonDisk[6]=vec2(-0.364238,-0.961791);\npoissonDisk[7]=vec2(-0.345866,-0.564379);\npoissonDisk[8]=vec2(-0.325663,0.64037);\npoissonDisk[9]=vec2(-0.182714,0.321329);\npoissonDisk[10]=vec2(-0.142613,-0.0227363);\npoissonDisk[11]=vec2(-0.0564287,-0.36729);\npoissonDisk[12]=vec2(-0.0185858,0.918882);\npoissonDisk[13]=vec2(0.0381787,-0.728996);\npoissonDisk[14]=vec2(0.16599,0.093112);\npoissonDisk[15]=vec2(0.253639,0.719535);\npoissonDisk[16]=vec2(0.369549,-0.655019);\npoissonDisk[17]=vec2(0.423627,0.429975);\npoissonDisk[18]=vec2(0.530747,-0.364971);\npoissonDisk[19]=vec2(0.566027,-0.940489);\npoissonDisk[20]=vec2(0.639332,0.0284127);\npoissonDisk[21]=vec2(0.652089,0.669668);\npoissonDisk[22]=vec2(0.773797,0.345012);\npoissonDisk[23]=vec2(0.968871,0.840449);\npoissonDisk[24]=vec2(0.991882,-0.657338);\n#endif\n\n#endif","#ifdef Gs62Hcg4\nfloat getRandomNumber(vec3 seed, int inputI){\nvec4 seed4 = vec4(seed,inputI);\nfloat dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\nreturn fract(sin(dot_product) * 43758.5453);\n}\nbool isOutLimits(vec2 uv, float receiverDepth) {return (uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0 || receiverDepth<0.0);}\nbool isUVOutLimits(vec2 uv) {return (uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0);}\nfloat computeDynamicBias(float bias,float dynb_1,float dynb_2,float dynb_3,vec3 N,vec3 L) \n{\nvec3 N_1 = dynb_1*N;\nfloat cosTheta=clamp(dot(N,L)+dynb_2,0.0,1.0);\nfloat dynamicBias=bias*tan(acos(cosTheta));\nreturn dynamicBias*dynb_3;\n}\nfloat convertFromScreenToViewSpace(float depthS,vec2 g2ASa4p9)\n{\nfloat depthNDC=depthS*2.0-1.0;\nreturn -2.0*g2ASa4p9.x*g2ASa4p9.y/(depthNDC*(g2ASa4p9.y-g2ASa4p9.x)-(g2ASa4p9.y+g2ASa4p9.x));\n}\nfloat unpack24Bits(vec3 color)\n{\nconst vec3 bit_shift=vec3(1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nfloat linstep(float low,float high,float v) {return clamp((v-low)/(high-low),0.0,1.0);}\nfloat texture2DCompare(sampler2D depths, vec2 uv, float compare)\n{\nfloat depth = texture2D(depths, uv).r;\nreturn step(compare, depth);\n}\nfloat texture2DShadowLerp(sampler2D depths, vec2 size, vec2 uv, float compare)\n{\nvec2 texelSize = vec2(1.0)/size;\nvec2 f = fract(uv*size+0.5);\nvec2 centroidUV = floor(uv*size+0.5)/size;\nfloat lb = texture2DCompare(depths, centroidUV+texelSize*vec2(0.0, 0.0), compare);\nfloat lt = texture2DCompare(depths, centroidUV+texelSize*vec2(0.0, 1.0), compare);\nfloat rb = texture2DCompare(depths, centroidUV+texelSize*vec2(1.0, 0.0), compare);\nfloat rt = texture2DCompare(depths, centroidUV+texelSize*vec2(1.0, 1.0), compare);\nfloat a = mix(lb, lt, f.y);\nfloat b = mix(rb, rt, f.y);\nfloat c = mix(a, b, f.x);\nreturn c;\n}\nfloat PercentageCloserFiltering(sampler2D depths, vec2 size, vec2 uv, float compare){\nfloat result = 0.0;\nfor(int x=-2; x<=2; x++){\nfor(int y=-2; y<=2; y++){\nvec2 off = vec2(x,y)/size;\nresult += texture2DCompare(depths, uv+off, compare);\n}\n}\nreturn result/25.0;\n}\nfloat InterpolatedPercentageCloserFiltering(sampler2D depths, vec2 size, vec2 uv, float compare){\nfloat result = 0.0;\nfor(int x=-1; x<=1; x++){\nfor(int y=-1; y<=1; y++){\nvec2 off = vec2(x,y)/size;\nresult += texture2DShadowLerp(depths, size, uv+off, compare);\n}\n}\nreturn result/9.0;\n}\nfloat VSM(sampler2D depths, vec2 uv, float compare){\nvec2 moments = texture2D(depths, uv).xy;\nfloat p = smoothstep(compare-0.02, compare, moments.x);\nfloat variance = max(moments.y - moments.x*moments.x, -0.001);\nfloat d = compare - moments.x;\nfloat p_max = linstep(0.2, 1.0, variance / (variance + d*d));\nreturn clamp(max(p, p_max), 0.0, 1.0);\n}\nfloat chebyshev(vec2 moments,float depth)\n{\nfloat d=depth; float p=0.0;\np=smoothstep(d-0.02,d,moments.x);\nfloat variance=max(moments.y-(moments.x*moments.x), 0.000001);\nfloat diff=(d-moments.x);\nfloat p_max=variance/(variance+diff*diff);\np_max=linstep(0.1,1.0,p_max);\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat exponential(float Ja84RmPc,float moment,float depth) {return clamp(exp(Ja84RmPc*(moment-depth)),0.0,1.0);}\nvec4 getTexel(vec2 uv,sampler2D sampler) {return texture2D(sampler,uv);}\nvec2 getMoments(vec2 uv,sampler2D sampler,sampler2D secondSampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler);if(isFullFloat) {return texel.xy;} else {vec4 secondTexel=getTexel(uv,secondSampler); return vec2(unpack(texel),unpack(secondTexel));}\n}\nfloat getPCSSVisibility(vec2 uv,sampler2D sampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler); if(isFullFloat) {return texel.g;} else {return texel.a;}\n}\nfloat getBlockerDepth(vec2 uv,sampler2D sampler,bool isFullFloat)\n{\nvec4 texel=getTexel(uv,sampler); if(isFullFloat) {return texel.r;} else {return unpack24Bits(texel.rgb);}\n}\nfloat getShadowFromPrecomputedPCSS(float receiverDepth,vec2 uv,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif(isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat visibility=getPCSSVisibility(uv,shadowSampler,isFullFloat);\nfloat blockerDepth=getBlockerDepth(uv,shadowSampler,isFullFloat);\nif (blockerDepth+dynamicBias>receiverDepth) {return 1.0;}\nreturn visibility;\n}\nfloat getShadowFromPCSS(float receiverDepth,vec2 uv,vec3 positionFromLightV,vec2 x9R4Dcn7,vec2 d8A9QxLe,vec2 g2ASa4p9,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif(isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat blockerDepth=getBlockerDepth(uv,shadowSampler,isFullFloat);\nfloat avgBlockerDepthV=0.0;\nfloat numBlockers=0.0;\nfloat blockerSum=0.0;\nvec2 lightSizeUV=x9R4Dcn7/d8A9QxLe;\nvec2 searchRegionRadiusUV=lightSizeUV*(positionFromLightV.z-g2ASa4p9.x)/positionFromLightV.z;\nfor (int i=0; i<poissonDiskSize; i++) {\nfloat otherBlockerDepth=getBlockerDepth(uv+poissonDisk[i]*searchRegionRadiusUV,shadowSampler,isFullFloat);\nfloat otherBlockerDepthV=convertFromScreenToViewSpace(otherBlockerDepth,g2ASa4p9);\nif (otherBlockerDepthV<positionFromLightV.z) {\nblockerSum+=otherBlockerDepthV;\nnumBlockers++;\n}\n}\navgBlockerDepthV=blockerSum/numBlockers;\nif (numBlockers<1.0) {return 1.0;}\nelse\n{\nfloat penumbraRatio=(positionFromLightV.z-avgBlockerDepthV)/avgBlockerDepthV;\nvec2 filterRadiusUV=penumbraRatio*lightSizeUV*g2ASa4p9.x/positionFromLightV.z;\nfloat sum=0.0;\nfor (int i=0; i<poissonDiskSize; i++) {\nvec2 offset=poissonDisk[i]*filterRadiusUV;\nfloat otherBlockerDepth=getBlockerDepth(uv+offset,shadowSampler,isFullFloat);\nif (otherBlockerDepth<receiverDepth) {\nsum+=1.0;\n}\n}\nfloat darkness=sum/float(poissonDiskSize);\nfloat visibility=1.0-darkness;\nreturn visibility;\n}\n}\nfloat getShadowFromExponential(float receiverDepth,vec2 uv,float Ja84RmPc,sampler2D shadowSampler,sampler2D secondShadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat moment=getMoments(uv,shadowSampler,secondShadowSampler,isFullFloat).x;\nreturn exponential(Ja84RmPc,moment,receiverDepth);\n}\nfloat getShadowFromVSM(float receiverDepth,vec2 uv,sampler2D shadowSampler,sampler2D secondShadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)){return outsideLuminance;}\nvec2 moments=getMoments(uv,shadowSampler,secondShadowSampler,isFullFloat);\nreturn chebyshev(moments,receiverDepth);\n}\nfloat getHardShadow(float receiverDepth,vec2 uv,sampler2D shadowSampler,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nif (isOutLimits(uv, receiverDepth)) {return outsideLuminance;}\nfloat blockerDepth=getMoments(uv,shadowSampler,shadowSampler,isFullFloat).x;\nif(blockerDepth+dynamicBias>receiverDepth) return 1.0; else return 0.0;\n}\nfloat getShadow(float f6T5RbLa,float receiverDepth,vec2 uv,vec3 positionFromLightV,vec2 x9R4Dcn7,vec2 d8A9QxLe,vec2 g2ASa4p9,float Ja84RmPc,\nsampler2D d3T8Meb7,sampler2D Ez2g9L3K,sampler2D q6E4ZmWa,float dynamicBias,float outsideLuminance,bool isFullFloat)\n{\nfloat visibility=1.0;\nif(f6T5RbLa<1.0) {visibility=getHardShadow(receiverDepth,uv,d3T8Meb7,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<2.0) {visibility=getShadowFromExponential(receiverDepth,uv,Ja84RmPc,d3T8Meb7,Ez2g9L3K,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<3.0) {visibility=getShadowFromVSM(receiverDepth,uv,d3T8Meb7,Ez2g9L3K,dynamicBias,outsideLuminance,isFullFloat);}\nelse if(f6T5RbLa<4.0) {visibility=getShadowFromPrecomputedPCSS(receiverDepth,uv,q6E4ZmWa,dynamicBias,outsideLuminance,isFullFloat);}\nelse {visibility=getShadowFromPCSS(receiverDepth,uv,positionFromLightV,x9R4Dcn7,d8A9QxLe,g2ASa4p9,d3T8Meb7,dynamicBias,outsideLuminance,isFullFloat);}\nreturn visibility;\n}\nfloat computeShadow(vec4 positionFromLight,float depthMetric,sampler2D shadowSampler,float dynamicBias,bool isFullFloat) \n{\nvec3 depth=positionFromLight.xyz/positionFromLight.w;\nvec2 uv=0.5*depth.xy+vec2(0.5);\nif (isUVOutLimits(uv)) {return 1.0;}\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nfloat shadow=0;\nif (isFullFloat) {shadow=texture2D(shadowSampler,uv).r;} else {shadow=unpack(texture2D(shadowSampler,uv));}\nif (shadowPixelDepth>shadow+dynamicBias){return 0.0;} \nreturn 1.0;\n}\n#endif\n","#ifdef d2EKz65X{X}\n#ifdef Gf78Toj6{X}\n#ifdef Xf36Cge2{X}\n#ifdef Wn9y8EQr{X}\nq2ENg8n9{X}=vec3(t6M8KsPq{X}*worldPosition);\n#else\na3WFm87R{X}=Gw84QdRo{X}*worldPosition;\n#endif\n#else\n#ifdef Qr8j3M7B{X}\na3WFm87R{X}=Gw84QdRo{X}*worldPosition;\nq2ENg8n9{X}=vec3(t6M8KsPq{X}*worldPosition);\n#else\n#ifdef Tx62Nto7{X}\na3WFm87R{X}=Kd6a5DEk{X}*worldPosition;\nq8NLm2b4{X}=a3WFm87R{X}.z*0.5+0.5;\n#endif\n#endif\n#endif\n#endif\n#endif\n","uniform mat4 viewProjection;\n#ifdef w9C3Yen4\n#ifndef Hp4m2BWf\nuniform mat4 view;\n#endif\n#endif\n#ifdef Ta63Acf7\nuniform mat4 Xo8q4A2R;\nuniform vec2 Ji23KzMd;\n#endif\n#ifdef Hp4m2BWf\nuniform mat4 Lj7q8H2K;\nuniform vec2 Wr5i8R3S;\n#endif\n#ifdef Qs3b9W2T\nuniform mat4 f8E2Wxc3;\nuniform vec2 q4A5Diy8;\n#endif\n#ifdef o6GAc9s7\nuniform mat4 t3GQn4m8;\nuniform vec2 Ez4g6PHc;\n#endif\n#ifdef Pn4m8W9E\nuniform mat4 Dy84Brw6;\nuniform vec2 x4S6Ljt2;\n#endif\n#ifdef Gf4i3Y8S\nuniform mat4 Em94Zxs7;\nuniform vec3 He9c4X2M;\n#endif\n","layout(std140,column_major) uniform;\nuniform Material {\nvec2 Ji23KzMd;\nvec2 Wr5i8R3S;\nvec2 q4A5Diy8;\nvec2 Ez4g6PHc;\nfloat f2THw8s5;\nvec2 x4S6Ljt2;\nvec3 He9c4X2M;\nfloat j2N4DfKp;\nfloat z9E8Dre3;\nfloat o9EDt87H;\nmat4 Xo8q4A2R;\nmat4 Lj7q8H2K;\nmat4 f8E2Wxc3;\nmat4 t3GQn4m8;\nmat4 Dy84Brw6;\nmat4 Em94Zxs7;\nvec4 Lk8x5T3G;\nvec3 r8TLa3t5;\nvec3 b6B9Wjf2;\nfloat Gr2p3S4T;\nfloat i5LEp3e8;\nfloat Bt52Znx8;\nfloat z9LGq35P;\nfloat Xm86Bye7;\nfloat Ge69Pir7;\nvec3 Ew46Kes3;\nvec2 b4M3HcSi;\nvec2 Gk97Wqd5;\nvec3 n5J8Afy2;\nvec3 Lr45JbEi;\nvec3 c9F4XmDi;\nvec4 Ji6x8KYz;\nvec3 Wq6t4DBe;\nvec3 g8G2Wfc4;\nmat4 z9C8Bsn3;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};"],extendStatics=function(t,e){return(extendStatics=Object[_0xc101[0]]||{__proto__:[]}instanceof Array&&function(t,e){t[_0xc101[1]]=e}||function(t,e){for(var i in e)e[_0xc101[2]](i)&&(t[i]=e[i])})(t,e)};function __extends(t,e){function i(){this[_0xc101[3]]=t}extendStatics(t,e),t[_0xc101[4]]=null===e?Object[_0xc101[5]](e):(i[_0xc101[4]]=e[_0xc101[4]],new i)}function __decorate(t,e,i,n){var r,a=arguments[_0xc101[6]],s=a<3?e:null===n?n=Object[_0xc101[7]](e,i):n;if(typeof Reflect===_0xc101[8]&&typeof Reflect[_0xc101[9]]===_0xc101[10])s=Reflect[_0xc101[9]](t,e,i,n);else for(var o=t[_0xc101[6]]-1;o>=0;o--)(r=t[o])&&(s=(a<3?r(s):a>3?r(e,i,s):r(e,i))||s);return a>3&&s&&Object[_0xc101[11]](e,i,s),s}(Zakeke=Zakeke||{})[_0xc101[12]]={},Zakeke[_0xc101[12]][_0xc101[13]]=function(){Zakeke[_0xc101[12]].SetupCustomShaders(),Zakeke[_0xc101[12]].DefineCustomMaterials()},Zakeke[_0xc101[12]][_0xc101[14]]=function(){if(Zakeke[_0xc101[15]])for(var t in Zakeke[_0xc101[15]])BABYLON[_0xc101[16]][_0xc101[15]][t]=Zakeke[_0xc101[15]][t];if(Zakeke[_0xc101[17]])for(var t in Zakeke[_0xc101[17]])BABYLON[_0xc101[16]][_0xc101[17]][t]=Zakeke[_0xc101[17]][t]},function(t){t[_0xc101[12]][_0xc101[18]]=function(){var e=function(t){function e(){var e=t[_0xc101[19]](this)||this;return e[_0xc101[20]]=!1,e[_0xc101[21]]=!1,e[_0xc101[22]]=!1,e[_0xc101[23]]=!1,e[_0xc101[24]]=!0,e[_0xc101[25]]=!1,e[_0xc101[26]]=!1,e[_0xc101[27]]=!1,e[_0xc101[28]]=!1,e[_0xc101[29]]=!1,e[_0xc101[30]]=!1,e[_0xc101[31]]=!1,e[_0xc101[32]]=!1,e[_0xc101[33]]=!1,e[_0xc101[34]]=!1,e[_0xc101[35]]=!1,e[_0xc101[36]]=!1,e[_0xc101[37]]=!1,e[_0xc101[38]]=!1,e[_0xc101[39]]=!1,e[_0xc101[40]]=!1,e[_0xc101[41]]=!1,e[_0xc101[42]]=!1,e[_0xc101[43]]=!1,e[_0xc101[44]]=!1,e[_0xc101[45]]=!1,e[_0xc101[46]]=!1,e[_0xc101[47]]=!1,e[_0xc101[48]]=!1,e[_0xc101[49]]=!1,e[_0xc101[50]]=!1,e[_0xc101[51]]=0,e[_0xc101[52]]=0,e[_0xc101[53]](),e}return __extends(e,t),e}(BABYLON.MaterialDefines),i=function(i){function n(t,e){var n=i[_0xc101[19]](this,t,e)||this;return n[_0xc101[54]]=new BABYLON.Color3(1,1,1),n[_0xc101[55]]=new BABYLON.Color3(1,1,1),n[_0xc101[56]]=new BABYLON.Color3(0,0,0),n[_0xc101[57]]=50,n[_0xc101[58]]=.6,n[_0xc101[59]]=.5,n[_0xc101[60]]=0,n[_0xc101[61]]=1,n[_0xc101[62]]=new BABYLON.Color3(1,1,1),n[_0xc101[63]]=0,n[_0xc101[64]]=.5,n[_0xc101[65]]=0,n[_0xc101[66]]=1,n[_0xc101[67]]=1,n[_0xc101[68]]=!1,n[_0xc101[69]]=!1,n[_0xc101[70]]=!1,n[_0xc101[71]]=!1,n[_0xc101[72]]=4,n[_0xc101[73]]=new BABYLON.SmartArray(16),n[_0xc101[74]]=new BABYLON.Vector3(.3,.59,.11),n[_0xc101[75]]=new BABYLON.Vector3(.2125,.7154,.0721),n[_0xc101[76]]=new BABYLON.Matrix(.3,.59,.11,.4,.2125,.7154,.0721,0,0,0,0,0,0,0,0,0),n}return __extends(n,i),Object[_0xc101[11]](n[_0xc101[4]],_0xc101[77],{get:function(){return this[_0xc101[68]]},set:function(t){this[_0xc101[68]]!==t&&(this[_0xc101[68]]=t,this[_0xc101[79]][_0xc101[78]](this),this[_0xc101[80]][_0xc101[78]](this))},enumerable:!0,configurable:!0}),Object[_0xc101[11]](n[_0xc101[4]],_0xc101[81],{get:function(){return this[_0xc101[68]]},set:function(t){this[_0xc101[68]]!==t&&(this[_0xc101[68]]=t,this[_0xc101[79]][_0xc101[78]](this),this[_0xc101[80]][_0xc101[78]](this))},enumerable:!0,configurable:!0}),n[_0xc101[4]][_0xc101[82]]=function(){return this[_0xc101[83]]&&this[_0xc101[83]][_0xc101[84]]&&this[_0xc101[70]]},n[_0xc101[4]][_0xc101[85]]=function(t,e){t[_0xc101[86]]||(t[_0xc101[86]]=new BABYLON.UniformBuffer(e[_0xc101[87]]())),t[_0xc101[86]][_0xc101[89]](_0xc101[88],3),t[_0xc101[86]][_0xc101[89]](_0xc101[90],3),t[_0xc101[86]][_0xc101[89]](_0xc101[91],3),t[_0xc101[86]][_0xc101[5]]()},n[_0xc101[4]][_0xc101[92]]=function(t,e,i,n){void 0===n&&(n=4);for(var r=0,a=!1,s=!1,o=!1,l=0,h=e[_0xc101[93]];l<h[_0xc101[6]];l++){var c=h[l];if(void 0===i[_0xc101[94]+r]&&(a=!0),!(c[_0xc101[95]]()>1)){switch(s=!0,i[_0xc101[94]+r]=!0,i[_0xc101[96]+r]=!1,i[_0xc101[97]+r]=!1,c[_0xc101[95]]()){case 0:i[_0xc101[96]+r]=!0;break;case 1:i[_0xc101[97]+r]=!0}if(i[_0xc101[98]+r]=!1,i[_0xc101[99]+r]=!1,i[_0xc101[100]+r]=!1,i[_0xc101[101]+r]=!1,i[_0xc101[102]+r]=!1,i[_0xc101[103]+r]=!1,i[_0xc101[104]+r]=!1,e&&e[_0xc101[105]]&&t[_0xc101[106]]&&c[_0xc101[107]])if(c[_0xc101[108]]()&&c instanceof BABYLON[_0xc101[109]]){var u=t[_0xc101[87]]()[_0xc101[110]]();i[_0xc101[98]+r]=!0,i[_0xc101[102]+r]=!(!u[_0xc101[111]]||!u[_0xc101[112]])||!(!u[_0xc101[113]]||!u[_0xc101[114]]),o=!0}if(this._buildLightUniformLayout(c,t),++r===n)break}}i[_0xc101[20]]=s,i[_0xc101[21]]=o;for(var d=r;n>d;d++)void 0!==i[_0xc101[94]+d]&&(i[_0xc101[94]+d]=!1);a&&i[_0xc101[53]]()},n[_0xc101[4]][_0xc101[115]]=function(t,e,i,n,r){void 0===r&&(r=4);for(var a=0;r>a&&n[_0xc101[94]+a];a++)t[_0xc101[125]](_0xc101[88]+a,_0xc101[90]+a,_0xc101[91]+a,_0xc101[116]+a,_0xc101[117]+a,_0xc101[118]+a,_0xc101[119]+a,_0xc101[120]+a,_0xc101[121]+a,_0xc101[122]+a,_0xc101[123]+a,_0xc101[124]+a),e&&e[_0xc101[125]](_0xc101[126]+a),i[_0xc101[125]](_0xc101[127]+a),i[_0xc101[125]](_0xc101[128]+a),i[_0xc101[125]](_0xc101[129]+a)},n[_0xc101[4]][_0xc101[130]]=function(t,e,i,n,r){if(i[_0xc101[105]]&&t[_0xc101[107]]){var a=t[_0xc101[108]]();a&&(t instanceof BABYLON[_0xc101[109]]?(r[_0xc101[132]](_0xc101[124]+n,a[_0xc101[131]]()),r[_0xc101[134]](_0xc101[127]+n,a[_0xc101[133]]())):Logger[_0xc101[136]](_0xc101[135]))}},n[_0xc101[4]][_0xc101[137]]=function(t,e,i){t instanceof BABYLON[_0xc101[138]]?t[_0xc101[139]]()?t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[141]][_0xc101[140]],t[_0xc101[141]][_0xc101[142]],t[_0xc101[141]][_0xc101[143]],i):t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[145]][_0xc101[140]],t[_0xc101[145]][_0xc101[142]],t[_0xc101[145]][_0xc101[143]],i):t instanceof BABYLON[_0xc101[109]]?t[_0xc101[139]]()?t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[146]][_0xc101[140]],t[_0xc101[146]][_0xc101[142]],t[_0xc101[146]][_0xc101[143]],i):t[_0xc101[86]][_0xc101[144]](_0xc101[88],t[_0xc101[147]][_0xc101[140]],t[_0xc101[147]][_0xc101[142]],t[_0xc101[147]][_0xc101[143]],i):Logger[_0xc101[136]](_0xc101[148])},n[_0xc101[4]][_0xc101[149]]=function(t,e,i,n,r){void 0===n&&(n=4);for(var a=0,s=0,o=e[_0xc101[93]];s<o[_0xc101[6]];s++){var l=o[s];if(!(l[_0xc101[95]]()>1)&&(l[_0xc101[86]][_0xc101[150]](i,_0xc101[126]+a),this._bindLightProperties(l,i,a),l[_0xc101[155]][_0xc101[154]](l[_0xc101[151]],BABYLON[_0xc101[153]][_0xc101[152]][0]),l[_0xc101[86]][_0xc101[156]](_0xc101[90],BABYLON[_0xc101[153]][_0xc101[152]][0],a+_0xc101[135]),l[_0xc101[157]][_0xc101[154]](l[_0xc101[151]],BABYLON[_0xc101[153]][_0xc101[152]][1]),l[_0xc101[86]][_0xc101[156]](_0xc101[91],BABYLON[_0xc101[153]][_0xc101[152]][1],a+_0xc101[135]),r[_0xc101[21]]&&r[_0xc101[98]+a]&&this._bindLightShadow(l,t,e,a+_0xc101[135],i),l[_0xc101[86]][_0xc101[158]](),++a===n))break}},n[_0xc101[4]][_0xc101[159]]=function(){},n[_0xc101[4]][_0xc101[160]]=function(){return _0xc101[161]},n[_0xc101[4]][_0xc101[162]]=function(){return this[_0xc101[73]][_0xc101[163]](),this[_0xc101[164]]&&this[_0xc101[164]][_0xc101[165]]&&this[_0xc101[73]][_0xc101[125]](this._reflectionTexture),this[_0xc101[73]]},n[_0xc101[4]][_0xc101[166]]=function(){return this[_0xc101[167]]<1||this[_0xc101[168]]||this._shouldUseAlphaFromAlbedoTexture()||this[_0xc101[169]]&&this[_0xc101[169]][_0xc101[170]]},n[_0xc101[4]][_0xc101[171]]=function(){return this[_0xc101[83]]&&this[_0xc101[83]][_0xc101[84]]},n[_0xc101[4]][_0xc101[172]]=function(){return this[_0xc101[83]]},n[_0xc101[4]][_0xc101[173]]=function(t,i,n){if(this[_0xc101[174]]&&this[_0xc101[175]]&&i[_0xc101[176]])return!0;i[_0xc101[177]]?i[_0xc101[177]]instanceof e||(Logger[_0xc101[136]](_0xc101[135]),i[_0xc101[177]]=new e):i[_0xc101[177]]=new e;var r=this[_0xc101[178]](),a=i[_0xc101[177]],s=r[_0xc101[87]]();if(!this[_0xc101[179]]&&i[_0xc101[176]]&&a[_0xc101[180]]===r[_0xc101[181]]())return!0;if(a[_0xc101[182]])if(!r[_0xc101[183]]||this[_0xc101[71]]||this[_0xc101[68]]){a[_0xc101[20]]=!1,a[_0xc101[21]]=!1;for(var o=0;o<this[_0xc101[72]];o++)void 0!==a[_0xc101[94]+o]&&(a[_0xc101[94]+o]=!1)}else a[_0xc101[184]]=!0,this._prepareDefinesForLights(r,t,a,this._maxSimultaneousLights);if(a[_0xc101[185]])if(a[_0xc101[186]]=!1,r[_0xc101[187]]){if(a[_0xc101[26]]=!!s[_0xc101[110]]()[_0xc101[188]],this[_0xc101[83]]){if(!this[_0xc101[83]][_0xc101[189]]())return!1;a[_0xc101[186]]=!0,a[_0xc101[27]]=!0}else a[_0xc101[27]]=!1;if(s[_0xc101[110]]()[_0xc101[190]]&&this[_0xc101[191]]){if(!this[_0xc101[191]][_0xc101[189]]())return!1;a[_0xc101[186]]=!0,a[_0xc101[184]]=!0,a[_0xc101[28]]=!0}else a[_0xc101[28]]=!1;if(this[_0xc101[192]]&&this[_0xc101[59]]){if(!this[_0xc101[192]][_0xc101[189]]())return!1;a[_0xc101[186]]=!0,a[_0xc101[29]]=!0}else a[_0xc101[29]]=!1;if(this[_0xc101[193]]&&this[_0xc101[60]]){if(!this[_0xc101[193]][_0xc101[189]]())return!1;a[_0xc101[186]]=!0,a[_0xc101[30]]=!0}else a[_0xc101[30]]=!1;if(this[_0xc101[164]]&&!this[_0xc101[68]]&&this[_0xc101[59]]){if(!this[_0xc101[164]][_0xc101[189]]())return!1;a[_0xc101[184]]=!0,a[_0xc101[31]]=!0,a[_0xc101[32]]=this[_0xc101[194]]&&this[_0xc101[195]]&&this[_0xc101[196]]}else a[_0xc101[31]]=!1,a[_0xc101[32]]=!1;if(this[_0xc101[168]]){if(!this[_0xc101[168]][_0xc101[189]]())return!1;a[_0xc101[186]]=!0,a[_0xc101[33]]=!0,a[_0xc101[34]]=this[_0xc101[168]][_0xc101[197]]}else a[_0xc101[33]]=!1,a[_0xc101[34]]=!1;if(this[_0xc101[198]]&&this[_0xc101[61]]){if(!this[_0xc101[198]][_0xc101[189]]())return!1;this[_0xc101[69]]?(a[_0xc101[186]]=!0,a[_0xc101[35]]=!0,a[_0xc101[37]]=!1,a[_0xc101[36]]=!!(this[_0xc101[65]]&&this[_0xc101[65]]-1)):(a[_0xc101[37]]=!0,a[_0xc101[35]]=!1,a[_0xc101[36]]=!1)}else a[_0xc101[35]]=!1,a[_0xc101[37]]=!1,a[_0xc101[36]]=!1;if(this[_0xc101[68]]){if(a[_0xc101[38]]=!0,a[_0xc101[184]]=!0,this[_0xc101[199]]){if(!this[_0xc101[199]][_0xc101[189]]())return!1;a[_0xc101[39]]=!0}else a[_0xc101[39]]=!1;if(this[_0xc101[200]]){if(!this[_0xc101[200]][_0xc101[189]]())return!1;a[_0xc101[40]]=!0}else a[_0xc101[40]]=!1}else a[_0xc101[38]]=!1,a[_0xc101[39]]=!1,a[_0xc101[40]]=!1;a[_0xc101[41]]=this._shouldUseAlphaFromAlbedoTexture(),a[_0xc101[42]]=!this[_0xc101[201]]}else a[_0xc101[26]]=!1,a[_0xc101[27]]=!1,a[_0xc101[28]]=!1,a[_0xc101[29]]=!1,a[_0xc101[30]]=!1,a[_0xc101[31]]=!1,a[_0xc101[32]]=!1,a[_0xc101[33]]=!1,a[_0xc101[34]]=!1,a[_0xc101[35]]=!1,a[_0xc101[37]]=!1,a[_0xc101[36]]=!1,a[_0xc101[38]]=!1,a[_0xc101[39]]=!1,a[_0xc101[40]]=!1,a[_0xc101[41]]=!1,a[_0xc101[42]]=!1;if(a[_0xc101[202]]&&(this[_0xc101[169]]&&this[_0xc101[169]][_0xc101[170]]?(a[_0xc101[184]]=!0,a[_0xc101[43]]=!0):a[_0xc101[43]]=!1),a[_0xc101[203]]&&(this[_0xc101[63]]?(a[_0xc101[44]]=!0,a[_0xc101[184]]=!0):a[_0xc101[44]]=!1,a[_0xc101[45]]=1!==this[_0xc101[66]]||1!==this[_0xc101[67]]),(a[_0xc101[204]]||a[_0xc101[184]]===a[_0xc101[205]]||a[_0xc101[186]]===a[_0xc101[206]])&&(a[_0xc101[205]]=a[_0xc101[184]],a[_0xc101[206]]=a[_0xc101[186]],a[_0xc101[184]]?(a[_0xc101[48]]=t[_0xc101[208]](BABYLON[_0xc101[207]].NormalKind))||(Logger[_0xc101[136]](_0xc101[135]),a[_0xc101[28]]=!1,a[_0xc101[31]]=!1,a[_0xc101[32]]=!1,a[_0xc101[38]]=!1,a[_0xc101[39]]=!1,a[_0xc101[43]]=!1,a[_0xc101[44]]=!1,a[_0xc101[20]]=!1,a[_0xc101[21]]=!1):a[_0xc101[48]]=!1,a[_0xc101[186]]?(a[_0xc101[49]]=t[_0xc101[208]](BABYLON[_0xc101[207]].UVKind),a[_0xc101[50]]=t[_0xc101[208]](BABYLON[_0xc101[207]].UV2Kind)):(a[_0xc101[49]]=!1,a[_0xc101[50]]=!1),t[_0xc101[209]]&&t[_0xc101[210]]?(a[_0xc101[51]]=t[_0xc101[211]],a[_0xc101[52]]=t[_0xc101[213]][_0xc101[212]][_0xc101[6]]+1):(a[_0xc101[51]]=0,a[_0xc101[52]]=0)),!1!==a[_0xc101[46]]&&(a[_0xc101[46]]=!a[_0xc101[46]],a[_0xc101[214]]()),a[_0xc101[47]]!==n&&(a[_0xc101[47]]=n,a[_0xc101[214]]()),a[_0xc101[215]]){a[_0xc101[216]](),r[_0xc101[217]]();var l=new BABYLON[_0xc101[218]];BABYLON[_0xc101[219]].HandleFallbacksForShadows(a,l,this._maxSimultaneousLights);var h=[BABYLON[_0xc101[207]][_0xc101[220]]];a[_0xc101[48]]&&h[_0xc101[125]](BABYLON[_0xc101[207]].NormalKind),a[_0xc101[49]]&&h[_0xc101[125]](BABYLON[_0xc101[207]].UVKind),a[_0xc101[50]]&&h[_0xc101[125]](BABYLON[_0xc101[207]].UV2Kind),BABYLON[_0xc101[219]].PrepareAttributesForBones(h,t,a,l),BABYLON[_0xc101[219]].PrepareAttributesForInstances(h,a);var c=_0xc101[221],u=a.toString();if(i[_0xc101[222]]!==u+this[_0xc101[223]]||!i[_0xc101[176]]){i[_0xc101[222]]=u+this[_0xc101[223]];var d=[_0xc101[224],_0xc101[225],_0xc101[226],_0xc101[227],_0xc101[228],_0xc101[229],_0xc101[230],_0xc101[231],_0xc101[232],_0xc101[233],_0xc101[234],_0xc101[235],_0xc101[236],_0xc101[237],_0xc101[238],_0xc101[239],_0xc101[240],_0xc101[241],_0xc101[242],_0xc101[243],_0xc101[244],_0xc101[245],_0xc101[246],_0xc101[247],_0xc101[248],_0xc101[249],_0xc101[250],_0xc101[251],_0xc101[252],_0xc101[253],_0xc101[254],_0xc101[255],_0xc101[256],_0xc101[257],_0xc101[258],_0xc101[259],_0xc101[260],_0xc101[261],_0xc101[262],_0xc101[263]],f=[_0xc101[264],_0xc101[265],_0xc101[266],_0xc101[267],_0xc101[268],_0xc101[269],_0xc101[270],_0xc101[271],_0xc101[272]],g=[_0xc101[273],_0xc101[274]];this._prepareUniformsAndSamplersList(d,g,f,a,this._maxSimultaneousLights),i[_0xc101[278]](r[_0xc101[87]]()[_0xc101[277]](c,{attributes:h,uniformsNames:d,uniformBuffersNames:g,samplers:f,defines:u,fallbacks:l,onCompiled:this[_0xc101[275]],onError:this[_0xc101[276]],indexParameters:{maxSimultaneousLights:this[_0xc101[72]]}},s),a),this[_0xc101[279]]()}}return!!i[_0xc101[176]][_0xc101[280]]()&&(a[_0xc101[180]]=r[_0xc101[181]](),this[_0xc101[175]]=!0,!0)},n[_0xc101[4]][_0xc101[279]]=function(){this[_0xc101[281]][_0xc101[89]](_0xc101[229],2),this[_0xc101[281]][_0xc101[89]](_0xc101[231],2),this[_0xc101[281]][_0xc101[89]](_0xc101[234],2),this[_0xc101[281]][_0xc101[89]](_0xc101[237],2),this[_0xc101[281]][_0xc101[89]](_0xc101[240],1),this[_0xc101[281]][_0xc101[89]](_0xc101[244],2),this[_0xc101[281]][_0xc101[89]](_0xc101[247],3),this[_0xc101[281]][_0xc101[89]](_0xc101[249],1),this[_0xc101[281]][_0xc101[89]](_0xc101[250],1),this[_0xc101[281]][_0xc101[89]](_0xc101[251],1),this[_0xc101[281]][_0xc101[89]](_0xc101[230],16),this[_0xc101[281]][_0xc101[89]](_0xc101[232],16),this[_0xc101[281]][_0xc101[89]](_0xc101[235],16),this[_0xc101[281]][_0xc101[89]](_0xc101[238],16),this[_0xc101[281]][_0xc101[89]](_0xc101[245],16),this[_0xc101[281]][_0xc101[89]](_0xc101[248],16),this[_0xc101[281]][_0xc101[89]](_0xc101[228],4),this[_0xc101[281]][_0xc101[89]](_0xc101[239],3),this[_0xc101[281]][_0xc101[89]](_0xc101[258],3),this[_0xc101[281]][_0xc101[89]](_0xc101[233],1),this[_0xc101[281]][_0xc101[89]](_0xc101[236],1),this[_0xc101[281]][_0xc101[89]](_0xc101[255],1),this[_0xc101[281]][_0xc101[89]](_0xc101[256],1),this[_0xc101[281]][_0xc101[89]](_0xc101[246],1),this[_0xc101[281]][_0xc101[89]](_0xc101[259],1),this[_0xc101[281]][_0xc101[89]](_0xc101[252],3),this[_0xc101[281]][_0xc101[89]](_0xc101[253],2),this[_0xc101[281]][_0xc101[89]](_0xc101[254],2),this[_0xc101[281]][_0xc101[89]](_0xc101[241],3),this[_0xc101[281]][_0xc101[89]](_0xc101[242],3),this[_0xc101[281]][_0xc101[89]](_0xc101[243],3),this[_0xc101[281]][_0xc101[89]](_0xc101[257],4),this[_0xc101[281]][_0xc101[89]](_0xc101[261],3),this[_0xc101[281]][_0xc101[89]](_0xc101[262],3),this[_0xc101[281]][_0xc101[89]](_0xc101[263],16),this[_0xc101[281]][_0xc101[5]]()},n[_0xc101[4]][_0xc101[282]]=function(){this[_0xc101[283]]&&this[_0xc101[164]]&&this[_0xc101[164]][_0xc101[165]]&&this[_0xc101[283]][_0xc101[134]](_0xc101[269],null),i[_0xc101[4]][_0xc101[282]][_0xc101[19]](this)},n[_0xc101[4]][_0xc101[284]]=function(t,e,i){var n=this[_0xc101[178]](),r=i[_0xc101[176]],a=i[_0xc101[177]];a&&(this[_0xc101[283]]=r,this[_0xc101[285]](t),BABYLON[_0xc101[219]].BindBonesParameters(e,r),this._mustRebind(n,r,e[_0xc101[286]])&&(this[_0xc101[281]][_0xc101[150]](r,_0xc101[273]),this[_0xc101[287]](r),this[_0xc101[281]][_0xc101[288]]&&this[_0xc101[174]]&&this[_0xc101[281]][_0xc101[289]]||(a[_0xc101[43]]&&this[_0xc101[281]][_0xc101[295]](_0xc101[257],new BABYLON.Color3(this[_0xc101[169]][_0xc101[291]][_0xc101[290]](),this[_0xc101[169]][_0xc101[292]][_0xc101[290]](),this[_0xc101[169]][_0xc101[293]]),this[_0xc101[169]][_0xc101[294]]),n[_0xc101[187]]&&(a[_0xc101[27]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[229],this[_0xc101[83]][_0xc101[296]],this[_0xc101[83]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[230],this[_0xc101[83]][_0xc101[299]]())),a[_0xc101[28]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[231],this[_0xc101[191]][_0xc101[296]],1/this[_0xc101[191]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[232],this[_0xc101[191]][_0xc101[299]]())),a[_0xc101[29]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[234],this[_0xc101[192]][_0xc101[296]],this[_0xc101[192]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[235],this[_0xc101[192]][_0xc101[299]]())),a[_0xc101[30]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[237],this[_0xc101[193]][_0xc101[296]],this[_0xc101[193]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[238],this[_0xc101[193]][_0xc101[299]]())),a[_0xc101[31]]&&(this[_0xc101[281]][_0xc101[301]](_0xc101[240],this[_0xc101[164]][_0xc101[297]]),this[_0xc101[281]][_0xc101[301]](_0xc101[259],Math[_0xc101[306]](Math[_0xc101[304]](this[_0xc101[164]][_0xc101[303]]()[_0xc101[302]])*Math[_0xc101[305]])),a[_0xc101[32]]&&(this[_0xc101[281]][_0xc101[307]](_0xc101[241],this._parallaxReflectionCenter),this[_0xc101[281]][_0xc101[307]](_0xc101[242],this._parallaxReflectionBBoxMin),this[_0xc101[281]][_0xc101[307]](_0xc101[243],this._parallaxReflectionBBoxMax))),a[_0xc101[33]]&&(this[_0xc101[281]][_0xc101[298]](_0xc101[244],this[_0xc101[168]][_0xc101[296]],this[_0xc101[168]][_0xc101[297]]),this[_0xc101[281]][_0xc101[300]](_0xc101[245],this[_0xc101[168]][_0xc101[299]]())),a[_0xc101[35]]?(this[_0xc101[281]][_0xc101[144]](_0xc101[247],this[_0xc101[198]][_0xc101[296]],this[_0xc101[198]][_0xc101[297]],this._aoPower),this[_0xc101[281]][_0xc101[300]](_0xc101[248],this[_0xc101[198]][_0xc101[299]]()),a[_0xc101[36]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[246],1-this[_0xc101[65]])):a[_0xc101[37]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[249],this._aoPower),a[_0xc101[39]]&&this[_0xc101[281]][_0xc101[301]](_0xc101[250],this[_0xc101[199]][_0xc101[297]]),a[_0xc101[40]]&&(this[_0xc101[281]][_0xc101[301]](_0xc101[251],this[_0xc101[200]][_0xc101[297]]),this[_0xc101[281]][_0xc101[301]](_0xc101[259],Math[_0xc101[306]](Math[_0xc101[304]](this[_0xc101[200]][_0xc101[303]]()[_0xc101[302]])*Math[_0xc101[305]])))),a[_0xc101[44]]&&(this[_0xc101[281]][_0xc101[156]](_0xc101[252],this._rimColor),this[_0xc101[281]][_0xc101[298]](_0xc101[253],this._rimPower,this[_0xc101[64]]||0)),a[_0xc101[45]]&&this[_0xc101[281]][_0xc101[298]](_0xc101[254],this[_0xc101[66]]||1,this[_0xc101[67]]||1),this[_0xc101[281]][_0xc101[295]](_0xc101[228],this._albedoColor,this[_0xc101[167]]*e[_0xc101[286]]),this[_0xc101[281]][_0xc101[156]](_0xc101[239],this._reflectionColor),this[_0xc101[281]][_0xc101[156]](_0xc101[258],this._specularColor),this[_0xc101[281]][_0xc101[301]](_0xc101[233],this._reflectivity),this[_0xc101[281]][_0xc101[301]](_0xc101[236],this._microsurface),this[_0xc101[281]][_0xc101[301]](_0xc101[255],this._glossiness),this[_0xc101[281]][_0xc101[301]](_0xc101[256],this._ambientLight)),this[_0xc101[281]][_0xc101[307]](_0xc101[261],this._grayWeights),this[_0xc101[281]][_0xc101[307]](_0xc101[262],this._lumCoeff),this[_0xc101[281]][_0xc101[300]](_0xc101[263],this._renderMatrix),n[_0xc101[187]]&&(a[_0xc101[27]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[264],this._albedoTexture),a[_0xc101[28]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[265],this._bumpTexture),a[_0xc101[29]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[266],this._reflectivityTexture),a[_0xc101[30]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[267],this._microsurfaceTexture),a[_0xc101[31]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[269],this._reflectionTexture),a[_0xc101[33]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[271],this._opacityTexture),(a[_0xc101[35]]||a[_0xc101[37]])&&this[_0xc101[281]][_0xc101[134]](_0xc101[272],this._aoTexture),a[_0xc101[38]]&&(a[_0xc101[39]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[270],this._ambientTexture),a[_0xc101[40]]&&this[_0xc101[281]][_0xc101[134]](_0xc101[268],this._matCapReflectionTexture))),r[_0xc101[309]](_0xc101[227],n[_0xc101[308]][_0xc101[145]])),(this._mustRebind(n,r)||!this[_0xc101[174]])&&(a[_0xc101[20]]&&this._bindLights(n,e,r,this._maxSimultaneousLights,a),a[_0xc101[38]]&&this[_0xc101[310]](r)),this[_0xc101[281]][_0xc101[158]](),this._afterBind(e,this._activeEffect))},n[_0xc101[4]][_0xc101[311]]=function(t,e){e&&(this[_0xc101[83]]&&(this[_0xc101[83]][_0xc101[311]](),this[_0xc101[83]]=null),this[_0xc101[191]]&&(this[_0xc101[191]][_0xc101[311]](),this[_0xc101[191]]=null),this[_0xc101[192]]&&(this[_0xc101[192]][_0xc101[311]](),this[_0xc101[192]]=null),this[_0xc101[193]]&&(this[_0xc101[193]][_0xc101[311]](),this[_0xc101[193]]=null),this[_0xc101[164]]&&(this[_0xc101[164]][_0xc101[311]](),this[_0xc101[164]]=null),this[_0xc101[168]]&&(this[_0xc101[168]][_0xc101[311]](),this[_0xc101[168]]=null),this[_0xc101[198]]&&(this[_0xc101[198]][_0xc101[311]](),this[_0xc101[198]]=null),this[_0xc101[199]]&&(this[_0xc101[199]][_0xc101[311]](),this[_0xc101[199]]=null),this[_0xc101[200]]&&(this[_0xc101[200]][_0xc101[311]](),this[_0xc101[200]]=null)),i[_0xc101[4]][_0xc101[311]][_0xc101[19]](this,t,e)},n[_0xc101[4]][_0xc101[312]]=function(){var t=i[_0xc101[4]][_0xc101[312]][_0xc101[19]](this);return this[_0xc101[83]]&&t[_0xc101[125]](this._albedoTexture),this[_0xc101[191]]&&t[_0xc101[125]](this._bumpTexture),this[_0xc101[192]]&&t[_0xc101[125]](this._reflectivityTexture),this[_0xc101[193]]&&t[_0xc101[125]](this._microsurfaceTexture),this[_0xc101[164]]&&t[_0xc101[125]](this._reflectionTexture),this[_0xc101[168]]&&t[_0xc101[125]](this._opacityTexture),this[_0xc101[198]]&&t[_0xc101[125]](this._aoTexture),this[_0xc101[199]]&&t[_0xc101[125]](this._ambientTexture),this[_0xc101[200]]&&t[_0xc101[125]](this._matCapReflectionTexture),t},n[_0xc101[4]][_0xc101[313]]=function(t){return!!i[_0xc101[4]][_0xc101[313]][_0xc101[19]](this,t)||(this[_0xc101[83]]===t||(this[_0xc101[191]]===t||(this[_0xc101[192]]===t||(this[_0xc101[193]]===t||(this[_0xc101[164]]===t||(this[_0xc101[168]]===t||(this[_0xc101[198]]===t||(this[_0xc101[199]]===t||this[_0xc101[200]]===t))))))))},n[_0xc101[4]][_0xc101[314]]=function(t){var e=this,i=BABYLON[_0xc101[315]].Clone(function(){return new Zakeke.PBRMaterial(t,e[_0xc101[178]]())},this);return i[_0xc101[316]]=t,i[_0xc101[223]]=t,i},n[_0xc101[4]][_0xc101[317]]=function(e){var i=this,n=BABYLON[_0xc101[315]].Clone(function(){return new t.PBRBlendMaterial(e,i[_0xc101[178]]())},this);return n[_0xc101[223]]=e,n[_0xc101[316]]=e,n},n[_0xc101[4]][_0xc101[318]]=function(){var t=BABYLON[_0xc101[315]].Serialize(this);return t[_0xc101[319]]=_0xc101[161],t},n[_0xc101[320]]=function(t,e,i){return BABYLON[_0xc101[315]].Parse(function(){return new Zakeke.PBRMaterial(t[_0xc101[223]],e)},t,e,i)},n}(BABYLON.PushMaterial);__decorate([BABYLON[_0xc101[322]](_0xc101[321])],i[_0xc101[4]],_0xc101[54],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[54])],i[_0xc101[4]],_0xc101[321],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[324])],i[_0xc101[4]],_0xc101[55],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[55])],i[_0xc101[4]],_0xc101[324],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[325])],i[_0xc101[4]],_0xc101[56],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[56])],i[_0xc101[4]],_0xc101[325],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[326])],i[_0xc101[4]],_0xc101[57],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[57])],i[_0xc101[4]],_0xc101[326],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[327])],i[_0xc101[4]],_0xc101[58],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[58])],i[_0xc101[4]],_0xc101[327],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[58])],i[_0xc101[4]],_0xc101[328],void 0),__decorate([BABYLON[_0xc101[322]](_0xc101[329])],i[_0xc101[4]],_0xc101[62],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[62])],i[_0xc101[4]],_0xc101[329],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[330])],i[_0xc101[4]],_0xc101[64],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[159],_0xc101[64])],i[_0xc101[4]],_0xc101[330],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[81])],i[_0xc101[4]],_0xc101[68],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[331])],i[_0xc101[4]],_0xc101[83],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[83])],i[_0xc101[4]],_0xc101[331],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[333])],i[_0xc101[4]],_0xc101[191],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[191])],i[_0xc101[4]],_0xc101[333],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[334])],i[_0xc101[4]],_0xc101[192],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[192])],i[_0xc101[4]],_0xc101[334],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[335])],i[_0xc101[4]],_0xc101[59],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[59])],i[_0xc101[4]],_0xc101[335],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[336])],i[_0xc101[4]],_0xc101[193],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[193])],i[_0xc101[4]],_0xc101[336],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[337])],i[_0xc101[4]],_0xc101[60],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[60])],i[_0xc101[4]],_0xc101[337],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[338])],i[_0xc101[4]],_0xc101[164],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[164])],i[_0xc101[4]],_0xc101[338],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[339])],i[_0xc101[4]],_0xc101[194],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[194])],i[_0xc101[4]],_0xc101[339],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[341])],i[_0xc101[4]],_0xc101[195],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[195])],i[_0xc101[4]],_0xc101[341],void 0),__decorate([BABYLON[_0xc101[340]](_0xc101[342])],i[_0xc101[4]],_0xc101[196],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[196])],i[_0xc101[4]],_0xc101[342],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[343])],i[_0xc101[4]],_0xc101[168],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[168])],i[_0xc101[4]],_0xc101[343],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[344])],i[_0xc101[4]],_0xc101[198],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[198])],i[_0xc101[4]],_0xc101[344],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[198])],i[_0xc101[4]],_0xc101[345],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[346])],i[_0xc101[4]],_0xc101[61],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[61])],i[_0xc101[4]],_0xc101[346],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[61])],i[_0xc101[4]],_0xc101[347],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[348])],i[_0xc101[4]],_0xc101[65],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[65])],i[_0xc101[4]],_0xc101[348],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[65])],i[_0xc101[4]],_0xc101[349],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[350])],i[_0xc101[4]],_0xc101[199],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[199])],i[_0xc101[4]],_0xc101[351],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[199])],i[_0xc101[4]],_0xc101[350],void 0),__decorate([BABYLON[_0xc101[332]](_0xc101[352])],i[_0xc101[4]],_0xc101[200],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[200])],i[_0xc101[4]],_0xc101[352],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[353])],i[_0xc101[4]],_0xc101[69],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[69])],i[_0xc101[4]],_0xc101[353],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[354])],i[_0xc101[4]],_0xc101[70],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[79],_0xc101[70])],i[_0xc101[4]],_0xc101[354],void 0),__decorate([BABYLON[_0xc101[356]](_0xc101[355])],i[_0xc101[4]],_0xc101[169],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[357],_0xc101[169])],i[_0xc101[4]],_0xc101[355],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[358])],i[_0xc101[4]],_0xc101[63],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[63])],i[_0xc101[4]],_0xc101[358],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[360])],i[_0xc101[4]],_0xc101[66],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[66])],i[_0xc101[4]],_0xc101[360],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[361])],i[_0xc101[4]],_0xc101[67],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[359],_0xc101[67])],i[_0xc101[4]],_0xc101[361],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[362])],i[_0xc101[4]],_0xc101[71],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[80],_0xc101[71])],i[_0xc101[4]],_0xc101[362],void 0),__decorate([BABYLON[_0xc101[318]](_0xc101[363])],i[_0xc101[4]],_0xc101[72],void 0),__decorate([BABYLON[_0xc101[323]](_0xc101[80],_0xc101[72])],i[_0xc101[4]],_0xc101[363],void 0),t[_0xc101[364]]=i,t[_0xc101[365]]=e}}(Zakeke||(Zakeke={})),function(t){t[_0xc101[12]][_0xc101[366]]=function(){t[_0xc101[12]].DefinePBRMaterial()}}(Zakeke||(Zakeke={})),Zakeke[_0xc101[17]]={zk_pbrPixelShader:_0xc101[367],zk_pbrVertexShader:_0xc101[368]},Zakeke[_0xc101[15]]={zk_n8Q2Bzi9LXc5p6RG:_0xc101[369],zk_pbrFragmentDeclaration:_0xc101[370],zk_pbrLightFragmentDeclaration:_0xc101[371],zk_w8NZg34MyJx59GeB:_0xc101[372],zk_Dp84Pxj2MTr7q6FW:_0xc101[373],zk_pbrLightUboDeclaration:_0xc101[374],zk_g9X4Qdz2LJb67MyT:_0xc101[375],zk_Ar2w4FRs58Jpc3W6:_0xc101[376],zk_Gi39AdTg7y5B2JfL:_0xc101[377],zk_pbrVertexDeclaration:_0xc101[378],zk_pbrUboDeclaration:_0xc101[379]};